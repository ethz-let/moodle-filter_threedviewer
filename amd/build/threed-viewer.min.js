function _typeof(e){"@babel/helpers - typeof";if("function"==typeof Symbol&&"symbol"==typeof Symbol.iterator){_typeof=function(e){return typeof e}}else{_typeof=function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e}}return _typeof(e)}function _wrapNativeSuper(e){var t="function"==typeof Map?new Map:void 0;_wrapNativeSuper=function(e){if(null===e||!_isNativeFunction(e))return e;if("function"!=typeof e){throw new TypeError("Super expression must either be null or a function")}if("undefined"!=typeof t){if(t.has(e))return t.get(e);t.set(e,a)}function a(){return _construct(e,arguments,_getPrototypeOf(this).constructor)}a.prototype=Object.create(e.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}});return _setPrototypeOf(a,e)};return _wrapNativeSuper(e)}function _construct(){if(_isNativeReflectConstruct()){_construct=Reflect.construct}else{_construct=function(e,t,r){var i=[null];i.push.apply(i,t);var a=Function.bind.apply(e,i),n=new a;if(r)_setPrototypeOf(n,r.prototype);return n}}return _construct.apply(null,arguments)}function _isNativeFunction(e){return-1!==Function.toString.call(e).indexOf("[native code]")}function asyncGeneratorStep(e,t,a,r,i,n,o){try{var s=e[n](o),l=s.value}catch(e){a(e);return}if(s.done){t(l)}else{Promise.resolve(l).then(r,i)}}function _asyncToGenerator(e){return function(){var t=this,a=arguments;return new Promise(function(r,i){var s=e.apply(t,a);function n(e){asyncGeneratorStep(s,r,i,n,o,"next",e)}function o(e){asyncGeneratorStep(s,r,i,n,o,"throw",e)}n(void 0)})}}function _createForOfIteratorHelper(e){if("undefined"==typeof Symbol||null==e[Symbol.iterator]){if(Array.isArray(e)||(e=_unsupportedIterableToArray(e))){var t=0,a=function(){};return{s:a,n:function n(){if(t>=e.length)return{done:!0};return{done:!1,value:e[t++]}},e:function e(e){throw e},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var r,n=!0,s=!1,l;return{s:function s(){r=e[Symbol.iterator]()},n:function n(){var e=r.next();n=e.done;return e},e:function e(e){s=!0;l=e},f:function f(){try{if(!n&&null!=r.return)r.return()}finally{if(s)throw l}}}}function _slicedToArray2(e,t){return _arrayWithHoles2(e)||_iterableToArrayLimit2(e,t)||_unsupportedIterableToArray(e,t)||_nonIterableRest2()}function _nonIterableRest2(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function _unsupportedIterableToArray(e,t){if(!e)return;if("string"==typeof e)return _arrayLikeToArray(e,t);var a=Object.prototype.toString.call(e).slice(8,-1);if("Object"===a&&e.constructor)a=e.constructor.name;if("Map"===a||"Set"===a)return Array.from(a);if("Arguments"===a||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a))return _arrayLikeToArray(e,t)}function _arrayLikeToArray(e,t){if(null==t||t>e.length)t=e.length;for(var a=0,r=Array(t);a<t;a++){r[a]=e[a]}return r}function _iterableToArrayLimit2(e,t){if("undefined"==typeof Symbol||!(Symbol.iterator in Object(e)))return;var a=[],r=!0,i=!1,n=void 0;try{for(var o=e[Symbol.iterator](),s;!(r=(s=o.next()).done);r=!0){a.push(s.value);if(t&&a.length===t)break}}catch(e){i=!0;n=e}finally{try{if(!r&&null!=o["return"])o["return"]()}finally{if(i)throw n}}return a}function _arrayWithHoles2(e){if(Array.isArray(e))return e}function _get(e,t,a){if("undefined"!=typeof Reflect&&Reflect.get){_get=Reflect.get}else{_get=function(e,t,a){var r=_superPropBase(e,t);if(!r)return;var i=Object.getOwnPropertyDescriptor(r,t);if(i.get){return i.get.call(a)}return i.value}}return _get(e,t,a||e)}function _superPropBase(e,t){while(!Object.prototype.hasOwnProperty.call(e,t)){e=_getPrototypeOf(e);if(null===e)break}return e}function ownKeys(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);if(t)r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable});a.push.apply(a,r)}return a}function _objectSpread2(e){for(var t=1,a;t<arguments.length;t++){a=null!=arguments[t]?arguments[t]:{};if(t%2){ownKeys(Object(a),!0).forEach(function(t){_defineProperty2(e,t,a[t])})}else if(Object.getOwnPropertyDescriptors){Object.defineProperties(e,Object.getOwnPropertyDescriptors(a))}else{ownKeys(Object(a)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))})}}return e}function _defineProperty2(e,t,a){if(t in e){Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0})}else{e[t]=a}return e}function _inherits(e,t){if("function"!=typeof t&&null!==t){throw new TypeError("Super expression must either be null or a function")}e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}});if(t)_setPrototypeOf(e,t)}function _setPrototypeOf(e,t){_setPrototypeOf=Object.setPrototypeOf||function(e,t){e.__proto__=t;return e};return _setPrototypeOf(e,t)}function _createSuper(e){return function(){var t=_getPrototypeOf(e),a;if(_isNativeReflectConstruct()){var r=_getPrototypeOf(this).constructor;a=Reflect.construct(t,arguments,r)}else{a=t.apply(this,arguments)}return _possibleConstructorReturn(this,a)}}function _possibleConstructorReturn(e,t){if(t&&("object"===_typeof(t)||"function"==typeof t)){return t}return _assertThisInitialized(e)}function _assertThisInitialized(e){if(void 0===e){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return e}function _isNativeReflectConstruct(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{Date.prototype.toString.call(Reflect.construct(Date,[],function(){}));return!0}catch(t){return!1}}function _getPrototypeOf(e){_getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)};return _getPrototypeOf(e)}function _classCallCheck2(e,t){if(!(e instanceof t)){throw new TypeError("Cannot call a class as a function")}}function _defineProperties(e,t){for(var a=0,r;a<t.length;a++){r=t[a];r.enumerable=r.enumerable||!1;r.configurable=!0;if("value"in r)r.writable=!0;Object.defineProperty(e,r.key,r)}}function _createClass2(e,t,a){if(t)_defineProperties(e.prototype,t);if(a)_defineProperties(e,a);return e}(function(e){"function"==typeof define&&define.amd?define ("filter_threedviewer/threed-viewer",e):e()})(function(){'use strict';for(var fr,hr="135",vr=0,yr=1,_r=2,xr=1,br=2,Sr=3,Mr=0,Tr=1,Er=2,wr=1,Ar=0,kr=1,Cr=2,Lr=3,Rr=4,Pr=5,Dr=100,Ir=101,zr=102,Nr=103,Or=104,Fr=200,Ur=201,Br=202,Hr=203,Gr=204,Vr=205,Wr=206,jr=207,qr=208,Xr=209,Yr=210,Zr=0,Jr=1,Qr=2,Kr=3,$r=4,ei=5,ti=6,ai=7,ri=0,ii=1,ni=2,oi=0,si=1,li=2,di=3,ci=4,ui=5,pi=300,mi=301,gi=302,fi=303,hi=304,vi=306,yi=307,_i=1e3,xi=1001,bi=1002,Si=1003,Mi=1004,Ti=1005,Ei=1006,wi=1007,Ai=1008,ki=1009,Ci=1010,Li=1011,Ri=1012,Pi=1013,Di=1014,Ii=1015,zi=1016,Ni=1017,Oi=1018,Fi=1019,Ui=1020,Bi=1021,Hi=1022,Gi=1023,Vi=1024,Wi=1025,ji=Gi,qi=1026,Xi=1027,Yi=1028,Zi=1029,Ji=1030,Qi=1031,Ki=1032,$i=1033,en=33776,tn=33777,an=33778,rn=33779,nn=35840,on=35841,sn=35842,ln=35843,dn=36196,cn=37492,un=37496,pn=37808,mn=37809,gn=37810,fn=37811,hn=37812,vn=37813,yn=37814,_n=37815,xn=37816,bn=37817,Sn=37818,Mn=37819,Tn=37820,En=37821,wn=36492,An=37840,kn=37841,Cn=37842,Ln=37843,Rn=37844,Pn=37845,Dn=37846,In=37847,zn=37848,Nn=37849,On=37850,Fn=37851,Un=37852,Bn=37853,Hn=2200,Gn=2201,Vn=2202,Wn=2300,jn=2301,qn=2302,Xn=2400,Yn=2401,Zn=2402,Jn=2500,Qn=2501,Kn=0,$n=3e3,eo=3001,to=3007,ao=3002,ro=3004,io=3005,no=3006,oo=3200,so=3201,lo=0,co=1,uo=7680,po=519,mo=35044,go=35048,fo="300 es",ho=function(){function e(){_classCallCheck2(this,e)}_createClass2(e,[{key:"addEventListener",value:function addEventListener(e,t){if(this._listeners===void 0)this._listeners={};var a=this._listeners;if(a[e]===void 0){a[e]=[]}if(-1===a[e].indexOf(t)){a[e].push(t)}}},{key:"hasEventListener",value:function hasEventListener(e,t){if(this._listeners===void 0)return!1;var a=this._listeners;return a[e]!==void 0&&-1!==a[e].indexOf(t)}},{key:"removeEventListener",value:function removeEventListener(e,t){if(this._listeners===void 0)return;var a=this._listeners,r=a[e];if(r!==void 0){var i=r.indexOf(t);if(-1!==i){r.splice(i,1)}}}},{key:"dispatchEvent",value:function dispatchEvent(e){if(this._listeners===void 0)return;var t=this._listeners,a=t[e.type];if(a!==void 0){e.target=this;for(var r=a.slice(0),n=0,o=r.length;n<o;n++){r[n].call(this,e)}e.target=null}}}]);return e}(),vo=[],yo=0;256>yo;yo++){vo[yo]=(16>yo?"0":"")+yo.toString(16)}var l=1234567,j=Math.PI/180,_o=180/Math.PI;function e(){var e=0|4294967295*Math.random(),t=0|4294967295*Math.random(),a=0|4294967295*Math.random(),r=0|4294967295*Math.random(),i=vo[255&e]+vo[255&e>>8]+vo[255&e>>16]+vo[255&e>>24]+"-"+vo[255&t]+vo[255&t>>8]+"-"+vo[64|15&t>>16]+vo[255&t>>24]+"-"+vo[128|63&a]+vo[255&a>>8]+"-"+vo[255&a>>16]+vo[255&a>>24]+vo[255&r]+vo[255&r>>8]+vo[255&r>>16]+vo[255&r>>24];return i.toUpperCase()}function t(e,t,a){return Math.max(t,Math.min(a,e))}function a(e,t){return(e%t+t)%t}function r(e,a,r){return(1-r)*e+r*a}function n(e){if(e!==void 0)l=e%2147483647;l=16807*l%2147483647;return(l-1)/2147483646}function o(e){return 0==(e&e-1)&&0!==e}function s(e){return Math.pow(2,Math.floor(Math.log(e)/Math.LN2))}var xo=Object.freeze({__proto__:null,DEG2RAD:j,RAD2DEG:_o,generateUUID:e,clamp:t,euclideanModulo:a,mapLinear:function(e,t,a,r,i){return r+(e-t)*(i-r)/(a-t)},inverseLerp:function(e,t,a){if(e!==t){return(a-e)/(t-e)}else{return 0}},lerp:r,damp:function(e,t,a,i){return r(e,t,1-Math.exp(-a*i))},pingpong:function(e){var t=1<arguments.length&&arguments[1]!==void 0?arguments[1]:1;return t-Math.abs(a(e,2*t)-t)},smoothstep:function(e,t,a){if(e<=t)return 0;if(e>=a)return 1;e=(e-t)/(a-t);return e*e*(3-2*e)},smootherstep:function(e,t,a){if(e<=t)return 0;if(e>=a)return 1;e=(e-t)/(a-t);return e*e*e*(e*(6*e-15)+10)},randInt:function(e,t){return e+Math.floor(Math.random()*(t-e+1))},randFloat:function(e,t){return e+Math.random()*(t-e)},randFloatSpread:function(e){return e*(.5-Math.random())},seededRandom:n,degToRad:function(e){return e*j},radToDeg:function(e){return e*_o},isPowerOfTwo:o,ceilPowerOfTwo:function(e){return Math.pow(2,Math.ceil(Math.log(e)/Math.LN2))},floorPowerOfTwo:s,setQuaternionFromProperEuler:function(e,t,a,r,i){var n=Math.cos,o=Math.sin,s=n(a/2),l=o(a/2),d=n((t+r)/2),c=o((t+r)/2),u=n((t-r)/2),p=o((t-r)/2),m=n((r-t)/2),g=o((r-t)/2);switch(i){case"XYX":e.set(s*c,l*u,l*p,s*d);break;case"YZY":e.set(l*p,s*c,l*u,s*d);break;case"ZXZ":e.set(l*u,l*p,s*c,s*d);break;case"XZX":e.set(s*c,l*g,l*m,s*d);break;case"YXY":e.set(l*m,s*c,l*g,s*d);break;case"ZYZ":e.set(l*g,l*m,s*c,s*d);break;default:console.warn("THREE.MathUtils: .setQuaternionFromProperEuler() encountered an unknown order: "+i);}}}),bo=function(){function e(){var t=0<arguments.length&&arguments[0]!==void 0?arguments[0]:0,a=1<arguments.length&&arguments[1]!==void 0?arguments[1]:0;_classCallCheck2(this,e);this.x=t;this.y=a}_createClass2(e,[{key:"set",value:function set(e,t){this.x=e;this.y=t;return this}},{key:"setScalar",value:function setScalar(e){this.x=e;this.y=e;return this}},{key:"setX",value:function setX(e){this.x=e;return this}},{key:"setY",value:function setY(e){this.y=e;return this}},{key:"setComponent",value:function setComponent(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;default:throw new Error("index is out of range: "+e);}return this}},{key:"getComponent",value:function getComponent(e){switch(e){case 0:return this.x;case 1:return this.y;default:throw new Error("index is out of range: "+e);}}},{key:"clone",value:function clone(){return new this.constructor(this.x,this.y)}},{key:"copy",value:function copy(e){this.x=e.x;this.y=e.y;return this}},{key:"add",value:function add(e,t){if(t!==void 0){console.warn("THREE.Vector2: .add() now only accepts one argument. Use .addVectors( a, b ) instead.");return this.addVectors(e,t)}this.x+=e.x;this.y+=e.y;return this}},{key:"addScalar",value:function addScalar(e){this.x+=e;this.y+=e;return this}},{key:"addVectors",value:function addVectors(e,t){this.x=e.x+t.x;this.y=e.y+t.y;return this}},{key:"addScaledVector",value:function addScaledVector(e,t){this.x+=e.x*t;this.y+=e.y*t;return this}},{key:"sub",value:function sub(e,t){if(t!==void 0){console.warn("THREE.Vector2: .sub() now only accepts one argument. Use .subVectors( a, b ) instead.");return this.subVectors(e,t)}this.x-=e.x;this.y-=e.y;return this}},{key:"subScalar",value:function subScalar(e){this.x-=e;this.y-=e;return this}},{key:"subVectors",value:function subVectors(e,t){this.x=e.x-t.x;this.y=e.y-t.y;return this}},{key:"multiply",value:function multiply(e){this.x*=e.x;this.y*=e.y;return this}},{key:"multiplyScalar",value:function multiplyScalar(e){this.x*=e;this.y*=e;return this}},{key:"divide",value:function divide(e){this.x/=e.x;this.y/=e.y;return this}},{key:"divideScalar",value:function divideScalar(e){return this.multiplyScalar(1/e)}},{key:"applyMatrix3",value:function applyMatrix3(t){var a=this.x,r=this.y,i=t.elements;this.x=i[0]*a+i[3]*r+i[6];this.y=i[1]*a+i[4]*r+i[7];return this}},{key:"min",value:function min(e){this.x=Math.min(this.x,e.x);this.y=Math.min(this.y,e.y);return this}},{key:"max",value:function max(e){this.x=Math.max(this.x,e.x);this.y=Math.max(this.y,e.y);return this}},{key:"clamp",value:function(e,t){this.x=Math.max(e.x,Math.min(t.x,this.x));this.y=Math.max(e.y,Math.min(t.y,this.y));return this}},{key:"clampScalar",value:function clampScalar(e,t){this.x=Math.max(e,Math.min(t,this.x));this.y=Math.max(e,Math.min(t,this.y));return this}},{key:"clampLength",value:function clampLength(e,t){var a=this.length();return this.divideScalar(a||1).multiplyScalar(Math.max(e,Math.min(t,a)))}},{key:"floor",value:function floor(){this.x=Math.floor(this.x);this.y=Math.floor(this.y);return this}},{key:"ceil",value:function ceil(){this.x=Math.ceil(this.x);this.y=Math.ceil(this.y);return this}},{key:"round",value:function round(){this.x=Math.round(this.x);this.y=Math.round(this.y);return this}},{key:"roundToZero",value:function roundToZero(){this.x=0>this.x?Math.ceil(this.x):Math.floor(this.x);this.y=0>this.y?Math.ceil(this.y):Math.floor(this.y);return this}},{key:"negate",value:function negate(){this.x=-this.x;this.y=-this.y;return this}},{key:"dot",value:function dot(e){return this.x*e.x+this.y*e.y}},{key:"cross",value:function cross(e){return this.x*e.y-this.y*e.x}},{key:"lengthSq",value:function lengthSq(){return this.x*this.x+this.y*this.y}},{key:"length",value:function length(){return Math.sqrt(this.x*this.x+this.y*this.y)}},{key:"manhattanLength",value:function manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)}},{key:"normalize",value:function normalize(){return this.divideScalar(this.length()||1)}},{key:"angle",value:function(){var e=Math.atan2(-this.y,-this.x)+Math.PI;return e}},{key:"distanceTo",value:function distanceTo(e){return Math.sqrt(this.distanceToSquared(e))}},{key:"distanceToSquared",value:function distanceToSquared(e){var t=this.x-e.x,a=this.y-e.y;return t*t+a*a}},{key:"manhattanDistanceTo",value:function manhattanDistanceTo(e){return Math.abs(this.x-e.x)+Math.abs(this.y-e.y)}},{key:"setLength",value:function setLength(e){return this.normalize().multiplyScalar(e)}},{key:"lerp",value:function(e,t){this.x+=(e.x-this.x)*t;this.y+=(e.y-this.y)*t;return this}},{key:"lerpVectors",value:function lerpVectors(e,t,a){this.x=e.x+(t.x-e.x)*a;this.y=e.y+(t.y-e.y)*a;return this}},{key:"equals",value:function(e){return e.x===this.x&&e.y===this.y}},{key:"fromArray",value:function fromArray(e){var t=1<arguments.length&&arguments[1]!==void 0?arguments[1]:0;this.x=e[t];this.y=e[t+1];return this}},{key:"toArray",value:function toArray(){var e=0<arguments.length&&arguments[0]!==void 0?arguments[0]:[],t=1<arguments.length&&arguments[1]!==void 0?arguments[1]:0;e[t]=this.x;e[t+1]=this.y;return e}},{key:"fromBufferAttribute",value:function fromBufferAttribute(e,t,a){if(a!==void 0){console.warn("THREE.Vector2: offset has been removed from .fromBufferAttribute().")}this.x=e.getX(t);this.y=e.getY(t);return this}},{key:"rotateAround",value:function rotateAround(e,t){var a=Math.cos(t),r=Math.sin(t),i=this.x-e.x,n=this.y-e.y;this.x=i*a-n*r+e.x;this.y=i*r+n*a+e.y;return this}},{key:"random",value:function random(){this.x=Math.random();this.y=Math.random();return this}},{key:Symbol.iterator,value:regeneratorRuntime.mark(function value(){return regeneratorRuntime.wrap(function(e){while(1){switch(e.prev=e.next){case 0:e.next=2;return this.x;case 2:e.next=4;return this.y;case 4:case"end":return e.stop();}}},value,this)})},{key:"width",get:function get(){return this.x},set:function set(e){this.x=e}},{key:"height",get:function get(){return this.y},set:function set(e){this.y=e}}]);return e}();bo.prototype.isVector2=!0;var So=function(){function e(){_classCallCheck2(this,e);this.elements=[1,0,0,0,1,0,0,0,1];if(0<arguments.length){console.error("THREE.Matrix3: the constructor no longer reads arguments. use .set() instead.")}}_createClass2(e,[{key:"set",value:function set(e,t,a,r,i,n,o,s,l){var d=this.elements;d[0]=e;d[1]=r;d[2]=o;d[3]=t;d[4]=i;d[5]=s;d[6]=a;d[7]=n;d[8]=l;return this}},{key:"identity",value:function identity(){this.set(1,0,0,0,1,0,0,0,1);return this}},{key:"copy",value:function copy(e){var t=this.elements,a=e.elements;t[0]=a[0];t[1]=a[1];t[2]=a[2];t[3]=a[3];t[4]=a[4];t[5]=a[5];t[6]=a[6];t[7]=a[7];t[8]=a[8];return this}},{key:"extractBasis",value:function extractBasis(e,t,a){e.setFromMatrix3Column(this,0);t.setFromMatrix3Column(this,1);a.setFromMatrix3Column(this,2);return this}},{key:"setFromMatrix4",value:function setFromMatrix4(e){var t=e.elements;this.set(t[0],t[4],t[8],t[1],t[5],t[9],t[2],t[6],t[10]);return this}},{key:"multiply",value:function multiply(e){return this.multiplyMatrices(this,e)}},{key:"premultiply",value:function premultiply(e){return this.multiplyMatrices(e,this)}},{key:"multiplyMatrices",value:function multiplyMatrices(e,t){var a=e.elements,r=t.elements,i=this.elements,n=a[0],o=a[3],s=a[6],l=a[1],d=a[4],c=a[7],u=a[2],p=a[5],m=a[8],g=r[0],f=r[3],h=r[6],v=r[1],y=r[4],_=r[7],x=r[2],b=r[5],S=r[8];i[0]=n*g+o*v+s*x;i[3]=n*f+o*y+s*b;i[6]=n*h+o*_+s*S;i[1]=l*g+d*v+c*x;i[4]=l*f+d*y+c*b;i[7]=l*h+d*_+c*S;i[2]=u*g+p*v+m*x;i[5]=u*f+p*y+m*b;i[8]=u*h+p*_+m*S;return this}},{key:"multiplyScalar",value:function multiplyScalar(e){var t=this.elements;t[0]*=e;t[3]*=e;t[6]*=e;t[1]*=e;t[4]*=e;t[7]*=e;t[2]*=e;t[5]*=e;t[8]*=e;return this}},{key:"determinant",value:function determinant(){var t=this.elements,r=t[0],a=t[1],n=t[2],o=t[3],s=t[4],e=t[5],l=t[6],d=t[7],c=t[8];return r*s*c-r*e*d-a*o*c+a*e*l+n*o*d-n*s*l}},{key:"invert",value:function invert(){var e=this.elements,t=e[0],a=e[1],r=e[2],i=e[3],n=e[4],o=e[5],s=e[6],l=e[7],d=e[8],c=d*n-o*l,u=o*s-d*i,p=l*i-n*s,m=t*c+a*u+r*p;if(0==m)return this.set(0,0,0,0,0,0,0,0,0);var g=1/m;e[0]=c*g;e[1]=(r*l-d*a)*g;e[2]=(o*a-r*n)*g;e[3]=u*g;e[4]=(d*t-r*s)*g;e[5]=(r*i-o*t)*g;e[6]=p*g;e[7]=(a*s-l*t)*g;e[8]=(n*t-a*i)*g;return this}},{key:"transpose",value:function transpose(){var e,t=this.elements;e=t[1];t[1]=t[3];t[3]=e;e=t[2];t[2]=t[6];t[6]=e;e=t[5];t[5]=t[7];t[7]=e;return this}},{key:"getNormalMatrix",value:function getNormalMatrix(e){return this.setFromMatrix4(e).invert().transpose()}},{key:"transposeIntoArray",value:function transposeIntoArray(e){var t=this.elements;e[0]=t[0];e[1]=t[3];e[2]=t[6];e[3]=t[1];e[4]=t[4];e[5]=t[7];e[6]=t[2];e[7]=t[5];e[8]=t[8];return this}},{key:"setUvTransform",value:function setUvTransform(e,t,a,r,i,n,o){var l=Math.cos(i),d=Math.sin(i);this.set(a*l,a*d,-a*(l*n+d*o)+n+e,-r*d,r*l,-r*(-d*n+l*o)+o+t,0,0,1);return this}},{key:"scale",value:function scale(e,t){var a=this.elements;a[0]*=e;a[3]*=e;a[6]*=e;a[1]*=t;a[4]*=t;a[7]*=t;return this}},{key:"rotate",value:function rotate(e){var t=Math.cos(e),a=Math.sin(e),r=this.elements,i=r[0],n=r[3],o=r[6],s=r[1],l=r[4],d=r[7];r[0]=t*i+a*s;r[3]=t*n+a*l;r[6]=t*o+a*d;r[1]=-a*i+t*s;r[4]=-a*n+t*l;r[7]=-a*o+t*d;return this}},{key:"translate",value:function translate(e,t){var a=this.elements;a[0]+=e*a[2];a[3]+=e*a[5];a[6]+=e*a[8];a[1]+=t*a[2];a[4]+=t*a[5];a[7]+=t*a[8];return this}},{key:"equals",value:function(e){for(var t=this.elements,a=e.elements,r=0;9>r;r++){if(t[r]!==a[r])return!1}return!0}},{key:"fromArray",value:function fromArray(e){for(var t=1<arguments.length&&arguments[1]!==void 0?arguments[1]:0,a=0;9>a;a++){this.elements[a]=e[a+t]}return this}},{key:"toArray",value:function toArray(){var e=0<arguments.length&&arguments[0]!==void 0?arguments[0]:[],t=1<arguments.length&&arguments[1]!==void 0?arguments[1]:0,a=this.elements;e[t]=a[0];e[t+1]=a[1];e[t+2]=a[2];e[t+3]=a[3];e[t+4]=a[4];e[t+5]=a[5];e[t+6]=a[6];e[t+7]=a[7];e[t+8]=a[8];return e}},{key:"clone",value:function clone(){return new this.constructor().fromArray(this.elements)}}]);return e}();So.prototype.isMatrix3=!0;function d(e){if(0===e.length)return-Infinity;for(var t=e[0],a=1,r=e.length;a<r;++a){if(e[a]>t)t=e[a]}return t}function c(e){return document.createElementNS("http://www.w3.org/1999/xhtml",e)}function u(e){for(var t=1<arguments.length&&arguments[1]!==void 0?arguments[1]:0,a=3735928559^t,r=1103547991^t,i=0,n;i<e.length;i++){n=e.charCodeAt(i);a=Math.imul(a^n,2654435761);r=Math.imul(r^n,1597334677)}a=Math.imul(a^a>>>16,2246822507)^Math.imul(r^r>>>13,3266489909);r=Math.imul(r^r>>>16,2246822507)^Math.imul(a^a>>>13,3266489909);return 4294967296*(2097151&r)+(a>>>0)}var Mo,To=function(){function e(){_classCallCheck2(this,e)}_createClass2(e,null,[{key:"getDataURL",value:function getDataURL(e){if(/^data:/i.test(e.src)){return e.src}if("undefined"==typeof HTMLCanvasElement){return e.src}var t;if(e instanceof HTMLCanvasElement){t=e}else{if(Mo===void 0)Mo=c("canvas");Mo.width=e.width;Mo.height=e.height;var a=Mo.getContext("2d");if(e instanceof ImageData){a.putImageData(e,0,0)}else{a.drawImage(e,0,0,e.width,e.height)}t=Mo}if(2048<t.width||2048<t.height){console.warn("THREE.ImageUtils.getDataURL: Image converted to jpg for performance reasons",e);return t.toDataURL("image/jpeg",.6)}else{return t.toDataURL("image/png")}}}]);return e}(),Eo=0,wo=function(t){_inherits(a,t);var r=_createSuper(a);function a(){var t,i=0<arguments.length&&arguments[0]!==void 0?arguments[0]:a.DEFAULT_IMAGE,n=1<arguments.length&&arguments[1]!==void 0?arguments[1]:a.DEFAULT_MAPPING,o=2<arguments.length&&arguments[2]!==void 0?arguments[2]:xi,s=3<arguments.length&&arguments[3]!==void 0?arguments[3]:xi,l=4<arguments.length&&arguments[4]!==void 0?arguments[4]:Ei,d=5<arguments.length&&arguments[5]!==void 0?arguments[5]:Ai,c=6<arguments.length&&arguments[6]!==void 0?arguments[6]:Gi,u=7<arguments.length&&arguments[7]!==void 0?arguments[7]:ki,p=8<arguments.length&&arguments[8]!==void 0?arguments[8]:1,m=9<arguments.length&&arguments[9]!==void 0?arguments[9]:$n;_classCallCheck2(this,a);t=r.call(this);Object.defineProperty(_assertThisInitialized(t),"id",{value:Eo++});t.uuid=e();t.name="";t.image=i;t.mipmaps=[];t.mapping=n;t.wrapS=o;t.wrapT=s;t.magFilter=l;t.minFilter=d;t.anisotropy=p;t.format=c;t.internalFormat=null;t.type=u;t.offset=new bo(0,0);t.repeat=new bo(1,1);t.center=new bo(0,0);t.rotation=0;t.matrixAutoUpdate=!0;t.matrix=new So;t.generateMipmaps=!0;t.premultiplyAlpha=!1;t.flipY=!0;t.unpackAlignment=4;t.encoding=m;t.userData={};t.version=0;t.onUpdate=null;t.isRenderTargetTexture=!1;return t}_createClass2(a,[{key:"updateMatrix",value:function updateMatrix(){this.matrix.setUvTransform(this.offset.x,this.offset.y,this.repeat.x,this.repeat.y,this.rotation,this.center.x,this.center.y)}},{key:"clone",value:function clone(){return new this.constructor().copy(this)}},{key:"copy",value:function copy(e){this.name=e.name;this.image=e.image;this.mipmaps=e.mipmaps.slice(0);this.mapping=e.mapping;this.wrapS=e.wrapS;this.wrapT=e.wrapT;this.magFilter=e.magFilter;this.minFilter=e.minFilter;this.anisotropy=e.anisotropy;this.format=e.format;this.internalFormat=e.internalFormat;this.type=e.type;this.offset.copy(e.offset);this.repeat.copy(e.repeat);this.center.copy(e.center);this.rotation=e.rotation;this.matrixAutoUpdate=e.matrixAutoUpdate;this.matrix.copy(e.matrix);this.generateMipmaps=e.generateMipmaps;this.premultiplyAlpha=e.premultiplyAlpha;this.flipY=e.flipY;this.unpackAlignment=e.unpackAlignment;this.encoding=e.encoding;this.userData=JSON.parse(JSON.stringify(e.userData));return this}},{key:"toJSON",value:function toJSON(t){var a=t===void 0||"string"==typeof t;if(!a&&t.textures[this.uuid]!==void 0){return t.textures[this.uuid]}var r={metadata:{version:4.5,type:"Texture",generator:"Texture.toJSON"},uuid:this.uuid,name:this.name,mapping:this.mapping,repeat:[this.repeat.x,this.repeat.y],offset:[this.offset.x,this.offset.y],center:[this.center.x,this.center.y],rotation:this.rotation,wrap:[this.wrapS,this.wrapT],format:this.format,type:this.type,encoding:this.encoding,minFilter:this.minFilter,magFilter:this.magFilter,anisotropy:this.anisotropy,flipY:this.flipY,premultiplyAlpha:this.premultiplyAlpha,unpackAlignment:this.unpackAlignment};if(this.image!==void 0){var i=this.image;if(i.uuid===void 0){i.uuid=e()}if(!a&&t.images[i.uuid]===void 0){var n;if(Array.isArray(i)){n=[];for(var o=0,s=i.length;o<s;o++){if(i[o].isDataTexture){n.push(p(i[o].image))}else{n.push(p(i[o]))}}}else{n=p(i)}t.images[i.uuid]={uuid:i.uuid,url:n}}r.image=i.uuid}if("{}"!==JSON.stringify(this.userData))r.userData=this.userData;if(!a){t.textures[this.uuid]=r}return r}},{key:"dispose",value:function dispose(){this.dispatchEvent({type:"dispose"})}},{key:"transformUv",value:function transformUv(e){if(this.mapping!==pi)return e;e.applyMatrix3(this.matrix);if(0>e.x||1<e.x){switch(this.wrapS){case _i:e.x=e.x-Math.floor(e.x);break;case xi:e.x=0>e.x?0:1;break;case bi:if(1===Math.abs(Math.floor(e.x)%2)){e.x=Math.ceil(e.x)-e.x}else{e.x=e.x-Math.floor(e.x)}break;}}if(0>e.y||1<e.y){switch(this.wrapT){case _i:e.y=e.y-Math.floor(e.y);break;case xi:e.y=0>e.y?0:1;break;case bi:if(1===Math.abs(Math.floor(e.y)%2)){e.y=Math.ceil(e.y)-e.y}else{e.y=e.y-Math.floor(e.y)}break;}}if(this.flipY){e.y=1-e.y}return e}},{key:"needsUpdate",set:function set(e){if(!0===e)this.version++}}]);return a}(ho);wo.DEFAULT_IMAGE=void 0;wo.DEFAULT_MAPPING=pi;wo.prototype.isTexture=!0;function p(e){if("undefined"!=typeof HTMLImageElement&&e instanceof HTMLImageElement||"undefined"!=typeof HTMLCanvasElement&&e instanceof HTMLCanvasElement||"undefined"!=typeof ImageBitmap&&e instanceof ImageBitmap){return To.getDataURL(e)}else{if(e.data){return{data:Array.prototype.slice.call(e.data),width:e.width,height:e.height,type:e.data.constructor.name}}else{console.warn("THREE.Texture: Unable to serialize Texture.");return{}}}}var Ao=function(){function e(){var t=0<arguments.length&&arguments[0]!==void 0?arguments[0]:0,a=1<arguments.length&&arguments[1]!==void 0?arguments[1]:0,r=2<arguments.length&&arguments[2]!==void 0?arguments[2]:0,i=3<arguments.length&&arguments[3]!==void 0?arguments[3]:1;_classCallCheck2(this,e);this.x=t;this.y=a;this.z=r;this.w=i}_createClass2(e,[{key:"set",value:function set(e,t,a,r){this.x=e;this.y=t;this.z=a;this.w=r;return this}},{key:"setScalar",value:function setScalar(e){this.x=e;this.y=e;this.z=e;this.w=e;return this}},{key:"setX",value:function setX(e){this.x=e;return this}},{key:"setY",value:function setY(e){this.y=e;return this}},{key:"setZ",value:function setZ(e){this.z=e;return this}},{key:"setW",value:function setW(e){this.w=e;return this}},{key:"setComponent",value:function setComponent(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;case 2:this.z=t;break;case 3:this.w=t;break;default:throw new Error("index is out of range: "+e);}return this}},{key:"getComponent",value:function getComponent(e){switch(e){case 0:return this.x;case 1:return this.y;case 2:return this.z;case 3:return this.w;default:throw new Error("index is out of range: "+e);}}},{key:"clone",value:function clone(){return new this.constructor(this.x,this.y,this.z,this.w)}},{key:"copy",value:function copy(e){this.x=e.x;this.y=e.y;this.z=e.z;this.w=e.w!==void 0?e.w:1;return this}},{key:"add",value:function add(e,t){if(t!==void 0){console.warn("THREE.Vector4: .add() now only accepts one argument. Use .addVectors( a, b ) instead.");return this.addVectors(e,t)}this.x+=e.x;this.y+=e.y;this.z+=e.z;this.w+=e.w;return this}},{key:"addScalar",value:function addScalar(e){this.x+=e;this.y+=e;this.z+=e;this.w+=e;return this}},{key:"addVectors",value:function addVectors(e,t){this.x=e.x+t.x;this.y=e.y+t.y;this.z=e.z+t.z;this.w=e.w+t.w;return this}},{key:"addScaledVector",value:function addScaledVector(e,t){this.x+=e.x*t;this.y+=e.y*t;this.z+=e.z*t;this.w+=e.w*t;return this}},{key:"sub",value:function sub(e,t){if(t!==void 0){console.warn("THREE.Vector4: .sub() now only accepts one argument. Use .subVectors( a, b ) instead.");return this.subVectors(e,t)}this.x-=e.x;this.y-=e.y;this.z-=e.z;this.w-=e.w;return this}},{key:"subScalar",value:function subScalar(e){this.x-=e;this.y-=e;this.z-=e;this.w-=e;return this}},{key:"subVectors",value:function subVectors(e,t){this.x=e.x-t.x;this.y=e.y-t.y;this.z=e.z-t.z;this.w=e.w-t.w;return this}},{key:"multiply",value:function multiply(e){this.x*=e.x;this.y*=e.y;this.z*=e.z;this.w*=e.w;return this}},{key:"multiplyScalar",value:function multiplyScalar(e){this.x*=e;this.y*=e;this.z*=e;this.w*=e;return this}},{key:"applyMatrix4",value:function applyMatrix4(t){var a=this.x,r=this.y,i=this.z,n=this.w,o=t.elements;this.x=o[0]*a+o[4]*r+o[8]*i+o[12]*n;this.y=o[1]*a+o[5]*r+o[9]*i+o[13]*n;this.z=o[2]*a+o[6]*r+o[10]*i+o[14]*n;this.w=o[3]*a+o[7]*r+o[11]*i+o[15]*n;return this}},{key:"divideScalar",value:function divideScalar(e){return this.multiplyScalar(1/e)}},{key:"setAxisAngleFromQuaternion",value:function setAxisAngleFromQuaternion(e){this.w=2*Math.acos(e.w);var t=Math.sqrt(1-e.w*e.w);if(1e-4>t){this.x=1;this.y=0;this.z=0}else{this.x=e.x/t;this.y=e.y/t;this.z=e.z/t}return this}},{key:"setAxisAngleFromRotationMatrix",value:function setAxisAngleFromRotationMatrix(e){var t,a,r,i,n=.01,o=.1,l=e.elements,d=l[0],c=l[4],u=l[8],p=l[1],m=l[5],g=l[9],f=l[2],h=l[6],v=l[10];if(Math.abs(c-p)<n&&Math.abs(u-f)<n&&Math.abs(g-h)<n){if(Math.abs(c+p)<o&&Math.abs(u+f)<o&&Math.abs(g+h)<o&&Math.abs(d+m+v-3)<o){this.set(1,0,0,0);return this}t=Math.PI;var _=(d+1)/2,b=(m+1)/2,S=(v+1)/2,M=(c+p)/4,T=(u+f)/4,E=(g+h)/4;if(_>b&&_>S){if(_<n){a=0;r=.707106781;i=.707106781}else{a=Math.sqrt(_);r=M/a;i=T/a}}else if(b>S){if(b<n){a=.707106781;r=0;i=.707106781}else{r=Math.sqrt(b);a=M/r;i=E/r}}else{if(S<n){a=.707106781;r=.707106781;i=0}else{i=Math.sqrt(S);a=T/i;r=E/i}}this.set(a,r,i,t);return this}var w=Math.sqrt((h-g)*(h-g)+(u-f)*(u-f)+(p-c)*(p-c));if(.001>Math.abs(w))w=1;this.x=(h-g)/w;this.y=(u-f)/w;this.z=(p-c)/w;this.w=Math.acos((d+m+v-1)/2);return this}},{key:"min",value:function min(e){this.x=Math.min(this.x,e.x);this.y=Math.min(this.y,e.y);this.z=Math.min(this.z,e.z);this.w=Math.min(this.w,e.w);return this}},{key:"max",value:function max(e){this.x=Math.max(this.x,e.x);this.y=Math.max(this.y,e.y);this.z=Math.max(this.z,e.z);this.w=Math.max(this.w,e.w);return this}},{key:"clamp",value:function(e,t){this.x=Math.max(e.x,Math.min(t.x,this.x));this.y=Math.max(e.y,Math.min(t.y,this.y));this.z=Math.max(e.z,Math.min(t.z,this.z));this.w=Math.max(e.w,Math.min(t.w,this.w));return this}},{key:"clampScalar",value:function clampScalar(e,t){this.x=Math.max(e,Math.min(t,this.x));this.y=Math.max(e,Math.min(t,this.y));this.z=Math.max(e,Math.min(t,this.z));this.w=Math.max(e,Math.min(t,this.w));return this}},{key:"clampLength",value:function clampLength(e,t){var a=this.length();return this.divideScalar(a||1).multiplyScalar(Math.max(e,Math.min(t,a)))}},{key:"floor",value:function floor(){this.x=Math.floor(this.x);this.y=Math.floor(this.y);this.z=Math.floor(this.z);this.w=Math.floor(this.w);return this}},{key:"ceil",value:function ceil(){this.x=Math.ceil(this.x);this.y=Math.ceil(this.y);this.z=Math.ceil(this.z);this.w=Math.ceil(this.w);return this}},{key:"round",value:function round(){this.x=Math.round(this.x);this.y=Math.round(this.y);this.z=Math.round(this.z);this.w=Math.round(this.w);return this}},{key:"roundToZero",value:function roundToZero(){this.x=0>this.x?Math.ceil(this.x):Math.floor(this.x);this.y=0>this.y?Math.ceil(this.y):Math.floor(this.y);this.z=0>this.z?Math.ceil(this.z):Math.floor(this.z);this.w=0>this.w?Math.ceil(this.w):Math.floor(this.w);return this}},{key:"negate",value:function negate(){this.x=-this.x;this.y=-this.y;this.z=-this.z;this.w=-this.w;return this}},{key:"dot",value:function dot(e){return this.x*e.x+this.y*e.y+this.z*e.z+this.w*e.w}},{key:"lengthSq",value:function lengthSq(){return this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w}},{key:"length",value:function length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w)}},{key:"manhattanLength",value:function manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)+Math.abs(this.w)}},{key:"normalize",value:function normalize(){return this.divideScalar(this.length()||1)}},{key:"setLength",value:function setLength(e){return this.normalize().multiplyScalar(e)}},{key:"lerp",value:function(e,t){this.x+=(e.x-this.x)*t;this.y+=(e.y-this.y)*t;this.z+=(e.z-this.z)*t;this.w+=(e.w-this.w)*t;return this}},{key:"lerpVectors",value:function lerpVectors(e,t,a){this.x=e.x+(t.x-e.x)*a;this.y=e.y+(t.y-e.y)*a;this.z=e.z+(t.z-e.z)*a;this.w=e.w+(t.w-e.w)*a;return this}},{key:"equals",value:function(e){return e.x===this.x&&e.y===this.y&&e.z===this.z&&e.w===this.w}},{key:"fromArray",value:function fromArray(e){var t=1<arguments.length&&arguments[1]!==void 0?arguments[1]:0;this.x=e[t];this.y=e[t+1];this.z=e[t+2];this.w=e[t+3];return this}},{key:"toArray",value:function toArray(){var e=0<arguments.length&&arguments[0]!==void 0?arguments[0]:[],t=1<arguments.length&&arguments[1]!==void 0?arguments[1]:0;e[t]=this.x;e[t+1]=this.y;e[t+2]=this.z;e[t+3]=this.w;return e}},{key:"fromBufferAttribute",value:function fromBufferAttribute(e,t,a){if(a!==void 0){console.warn("THREE.Vector4: offset has been removed from .fromBufferAttribute().")}this.x=e.getX(t);this.y=e.getY(t);this.z=e.getZ(t);this.w=e.getW(t);return this}},{key:"random",value:function random(){this.x=Math.random();this.y=Math.random();this.z=Math.random();this.w=Math.random();return this}},{key:Symbol.iterator,value:regeneratorRuntime.mark(function value(){return regeneratorRuntime.wrap(function(e){while(1){switch(e.prev=e.next){case 0:e.next=2;return this.x;case 2:e.next=4;return this.y;case 4:e.next=6;return this.z;case 6:e.next=8;return this.w;case 8:case"end":return e.stop();}}},value,this)})},{key:"width",get:function get(){return this.z},set:function set(e){this.z=e}},{key:"height",get:function get(){return this.w},set:function set(e){this.w=e}}]);return e}();Ao.prototype.isVector4=!0;var ko=function(e){_inherits(t,e);var a=_createSuper(t);function t(e,r){var i,n=2<arguments.length&&arguments[2]!==void 0?arguments[2]:{};_classCallCheck2(this,t);i=a.call(this);i.width=e;i.height=r;i.depth=1;i.scissor=new Ao(0,0,e,r);i.scissorTest=!1;i.viewport=new Ao(0,0,e,r);i.texture=new wo(void 0,n.mapping,n.wrapS,n.wrapT,n.magFilter,n.minFilter,n.format,n.type,n.anisotropy,n.encoding);i.texture.isRenderTargetTexture=!0;i.texture.image={width:e,height:r,depth:1};i.texture.generateMipmaps=n.generateMipmaps!==void 0?n.generateMipmaps:!1;i.texture.internalFormat=n.internalFormat!==void 0?n.internalFormat:null;i.texture.minFilter=n.minFilter!==void 0?n.minFilter:Ei;i.depthBuffer=n.depthBuffer!==void 0?n.depthBuffer:!0;i.stencilBuffer=n.stencilBuffer!==void 0?n.stencilBuffer:!1;i.depthTexture=n.depthTexture!==void 0?n.depthTexture:null;return i}_createClass2(t,[{key:"setTexture",value:function setTexture(e){e.image={width:this.width,height:this.height,depth:this.depth};this.texture=e}},{key:"setSize",value:function setSize(e,t){var a=2<arguments.length&&arguments[2]!==void 0?arguments[2]:1;if(this.width!==e||this.height!==t||this.depth!==a){this.width=e;this.height=t;this.depth=a;this.texture.image.width=e;this.texture.image.height=t;this.texture.image.depth=a;this.dispose()}this.viewport.set(0,0,e,t);this.scissor.set(0,0,e,t)}},{key:"clone",value:function clone(){return new this.constructor().copy(this)}},{key:"copy",value:function copy(e){this.width=e.width;this.height=e.height;this.depth=e.depth;this.viewport.copy(e.viewport);this.texture=e.texture.clone();this.texture.image=_objectSpread2({},this.texture.image);this.depthBuffer=e.depthBuffer;this.stencilBuffer=e.stencilBuffer;this.depthTexture=e.depthTexture;return this}},{key:"dispose",value:function dispose(){this.dispatchEvent({type:"dispose"})}}]);return t}(ho);ko.prototype.isWebGLRenderTarget=!0;var Co=function(e){_inherits(t,e);var a=_createSuper(t);function t(e,r,i){var n;_classCallCheck2(this,t);n=a.call(this,e,r);var o=n.texture;n.texture=[];for(var s=0;s<i;s++){n.texture[s]=o.clone()}return n}_createClass2(t,[{key:"setSize",value:function setSize(e,t){var a=2<arguments.length&&arguments[2]!==void 0?arguments[2]:1;if(this.width!==e||this.height!==t||this.depth!==a){this.width=e;this.height=t;this.depth=a;for(var r=0,i=this.texture.length;r<i;r++){this.texture[r].image.width=e;this.texture[r].image.height=t;this.texture[r].image.depth=a}this.dispose()}this.viewport.set(0,0,e,t);this.scissor.set(0,0,e,t);return this}},{key:"copy",value:function copy(e){this.dispose();this.width=e.width;this.height=e.height;this.depth=e.depth;this.viewport.set(0,0,this.width,this.height);this.scissor.set(0,0,this.width,this.height);this.depthBuffer=e.depthBuffer;this.stencilBuffer=e.stencilBuffer;this.depthTexture=e.depthTexture;this.texture.length=0;for(var t=0,a=e.texture.length;t<a;t++){this.texture[t]=e.texture[t].clone()}return this}}]);return t}(ko);Co.prototype.isWebGLMultipleRenderTargets=!0;var Lo=function(e){_inherits(t,e);var a=_createSuper(t);function t(e,r){var i,n=2<arguments.length&&arguments[2]!==void 0?arguments[2]:{};_classCallCheck2(this,t);i=a.call(this,e,r,n);i.samples=4;i.ignoreDepthForMultisampleCopy=n.ignoreDepth!==void 0?n.ignoreDepth:!0;i.useRenderToTexture=n.useRenderToTexture!==void 0?n.useRenderToTexture:!1;i.useRenderbuffer=!1===i.useRenderToTexture;return i}_createClass2(t,[{key:"copy",value:function copy(e){_get(_getPrototypeOf(t.prototype),"copy",this).call(this,e);this.samples=e.samples;this.useRenderToTexture=e.useRenderToTexture;this.useRenderbuffer=e.useRenderbuffer;return this}}]);return t}(ko);Lo.prototype.isWebGLMultisampleRenderTarget=!0;var Ro=function(){function e(){var t=0<arguments.length&&arguments[0]!==void 0?arguments[0]:0,a=1<arguments.length&&arguments[1]!==void 0?arguments[1]:0,r=2<arguments.length&&arguments[2]!==void 0?arguments[2]:0,i=3<arguments.length&&arguments[3]!==void 0?arguments[3]:1;_classCallCheck2(this,e);this._x=t;this._y=a;this._z=r;this._w=i}_createClass2(e,[{key:"set",value:function set(e,t,a,r){this._x=e;this._y=t;this._z=a;this._w=r;this._onChangeCallback();return this}},{key:"clone",value:function clone(){return new this.constructor(this._x,this._y,this._z,this._w)}},{key:"copy",value:function copy(e){this._x=e.x;this._y=e.y;this._z=e.z;this._w=e.w;this._onChangeCallback();return this}},{key:"setFromEuler",value:function setFromEuler(e,t){if(!(e&&e.isEuler)){throw new Error("THREE.Quaternion: .setFromEuler() now expects an Euler rotation rather than a Vector3 and order.")}var a=e._x,r=e._y,i=e._z,n=e._order,o=Math.cos,s=Math.sin,l=o(a/2),d=o(r/2),c=o(i/2),u=s(a/2),p=s(r/2),m=s(i/2);switch(n){case"XYZ":this._x=u*d*c+l*p*m;this._y=l*p*c-u*d*m;this._z=l*d*m+u*p*c;this._w=l*d*c-u*p*m;break;case"YXZ":this._x=u*d*c+l*p*m;this._y=l*p*c-u*d*m;this._z=l*d*m-u*p*c;this._w=l*d*c+u*p*m;break;case"ZXY":this._x=u*d*c-l*p*m;this._y=l*p*c+u*d*m;this._z=l*d*m+u*p*c;this._w=l*d*c-u*p*m;break;case"ZYX":this._x=u*d*c-l*p*m;this._y=l*p*c+u*d*m;this._z=l*d*m-u*p*c;this._w=l*d*c+u*p*m;break;case"YZX":this._x=u*d*c+l*p*m;this._y=l*p*c+u*d*m;this._z=l*d*m-u*p*c;this._w=l*d*c-u*p*m;break;case"XZY":this._x=u*d*c-l*p*m;this._y=l*p*c-u*d*m;this._z=l*d*m+u*p*c;this._w=l*d*c+u*p*m;break;default:console.warn("THREE.Quaternion: .setFromEuler() encountered an unknown order: "+n);}if(!1!==t)this._onChangeCallback();return this}},{key:"setFromAxisAngle",value:function setFromAxisAngle(e,t){var a=t/2,r=Math.sin(a);this._x=e.x*r;this._y=e.y*r;this._z=e.z*r;this._w=Math.cos(a);this._onChangeCallback();return this}},{key:"setFromRotationMatrix",value:function setFromRotationMatrix(e){var t=e.elements,a=t[0],r=t[4],i=t[8],n=t[1],o=t[5],l=t[9],d=t[2],c=t[6],u=t[10],p=a+o+u;if(0<p){var m=.5/Math.sqrt(p+1);this._w=.25/m;this._x=(c-l)*m;this._y=(i-d)*m;this._z=(n-r)*m}else if(a>o&&a>u){var s=2*Math.sqrt(1+a-o-u);this._w=(c-l)/s;this._x=.25*s;this._y=(r+n)/s;this._z=(i+d)/s}else if(o>u){var g=2*Math.sqrt(1+o-a-u);this._w=(i-d)/g;this._x=(r+n)/g;this._y=.25*g;this._z=(l+c)/g}else{var f=2*Math.sqrt(1+u-a-o);this._w=(n-r)/f;this._x=(i+d)/f;this._y=(l+c)/f;this._z=.25*f}this._onChangeCallback();return this}},{key:"setFromUnitVectors",value:function setFromUnitVectors(e,t){var a=e.dot(t)+1;if(a<Number.EPSILON){a=0;if(Math.abs(e.x)>Math.abs(e.z)){this._x=-e.y;this._y=e.x;this._z=0;this._w=a}else{this._x=0;this._y=-e.z;this._z=e.y;this._w=a}}else{this._x=e.y*t.z-e.z*t.y;this._y=e.z*t.x-e.x*t.z;this._z=e.x*t.y-e.y*t.x;this._w=a}return this.normalize()}},{key:"angleTo",value:function angleTo(e){return 2*Math.acos(Math.abs(t(this.dot(e),-1,1)))}},{key:"rotateTowards",value:function rotateTowards(e,a){var r=this.angleTo(e);if(0===r)return this;var i=Math.min(1,a/r);this.slerp(e,i);return this}},{key:"identity",value:function identity(){return this.set(0,0,0,1)}},{key:"invert",value:function invert(){return this.conjugate()}},{key:"conjugate",value:function conjugate(){this._x*=-1;this._y*=-1;this._z*=-1;this._onChangeCallback();return this}},{key:"dot",value:function dot(e){return this._x*e._x+this._y*e._y+this._z*e._z+this._w*e._w}},{key:"lengthSq",value:function lengthSq(){return this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w}},{key:"length",value:function length(){return Math.sqrt(this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w)}},{key:"normalize",value:function normalize(){var e=this.length();if(0===e){this._x=0;this._y=0;this._z=0;this._w=1}else{e=1/e;this._x=this._x*e;this._y=this._y*e;this._z=this._z*e;this._w=this._w*e}this._onChangeCallback();return this}},{key:"multiply",value:function multiply(e,t){if(t!==void 0){console.warn("THREE.Quaternion: .multiply() now only accepts one argument. Use .multiplyQuaternions( a, b ) instead.");return this.multiplyQuaternions(e,t)}return this.multiplyQuaternions(this,e)}},{key:"premultiply",value:function premultiply(e){return this.multiplyQuaternions(e,this)}},{key:"multiplyQuaternions",value:function multiplyQuaternions(e,t){var a=e._x,r=e._y,i=e._z,n=e._w,o=t._x,s=t._y,l=t._z,d=t._w;this._x=a*d+n*o+r*l-i*s;this._y=r*d+n*s+i*o-a*l;this._z=i*d+n*l+a*s-r*o;this._w=n*d-a*o-r*s-i*l;this._onChangeCallback();return this}},{key:"slerp",value:function slerp(e,a){if(0===a)return this;if(1===a)return this.copy(e);var t=this._x,r=this._y,i=this._z,n=this._w,o=n*e._w+t*e._x+r*e._y+i*e._z;if(0>o){this._w=-e._w;this._x=-e._x;this._y=-e._y;this._z=-e._z;o=-o}else{this.copy(e)}if(1<=o){this._w=n;this._x=t;this._y=r;this._z=i;return this}var l=1-o*o;if(l<=Number.EPSILON){var m=1-a;this._w=m*n+a*this._w;this._x=m*t+a*this._x;this._y=m*r+a*this._y;this._z=m*i+a*this._z;this.normalize();this._onChangeCallback();return this}var d=Math.sqrt(l),c=Math.atan2(d,o),u=Math.sin((1-a)*c)/d,p=Math.sin(a*c)/d;this._w=n*u+this._w*p;this._x=t*u+this._x*p;this._y=r*u+this._y*p;this._z=i*u+this._z*p;this._onChangeCallback();return this}},{key:"slerpQuaternions",value:function slerpQuaternions(e,a,r){this.copy(e).slerp(a,r)}},{key:"random",value:function random(){var e=Math.random(),t=Math.sqrt(1-e),a=Math.sqrt(e),r=2*Math.PI*Math.random(),i=2*Math.PI*Math.random();return this.set(t*Math.cos(r),a*Math.sin(i),a*Math.cos(i),t*Math.sin(r))}},{key:"equals",value:function(e){return e._x===this._x&&e._y===this._y&&e._z===this._z&&e._w===this._w}},{key:"fromArray",value:function fromArray(e){var t=1<arguments.length&&arguments[1]!==void 0?arguments[1]:0;this._x=e[t];this._y=e[t+1];this._z=e[t+2];this._w=e[t+3];this._onChangeCallback();return this}},{key:"toArray",value:function toArray(){var e=0<arguments.length&&arguments[0]!==void 0?arguments[0]:[],t=1<arguments.length&&arguments[1]!==void 0?arguments[1]:0;e[t]=this._x;e[t+1]=this._y;e[t+2]=this._z;e[t+3]=this._w;return e}},{key:"fromBufferAttribute",value:function fromBufferAttribute(e,t){this._x=e.getX(t);this._y=e.getY(t);this._z=e.getZ(t);this._w=e.getW(t);return this}},{key:"_onChange",value:function _onChange(e){this._onChangeCallback=e;return this}},{key:"_onChangeCallback",value:function _onChangeCallback(){}},{key:"x",get:function get(){return this._x},set:function set(e){this._x=e;this._onChangeCallback()}},{key:"y",get:function get(){return this._y},set:function set(e){this._y=e;this._onChangeCallback()}},{key:"z",get:function get(){return this._z},set:function set(e){this._z=e;this._onChangeCallback()}},{key:"w",get:function get(){return this._w},set:function set(e){this._w=e;this._onChangeCallback()}}],[{key:"slerp",value:function slerp(e,a,r,i){console.warn("THREE.Quaternion: Static .slerp() has been deprecated. Use qm.slerpQuaternions( qa, qb, t ) instead.");return r.slerpQuaternions(e,a,i)}},{key:"slerpFlat",value:function slerpFlat(e,a,r,i,n,o,l){var d=r[i+0],c=r[i+1],u=r[i+2],p=r[i+3],m=n[o+0],g=n[o+1],h=n[o+2],v=n[o+3];if(0===l){e[a+0]=d;e[a+1]=c;e[a+2]=u;e[a+3]=p;return}if(1===l){e[a+0]=m;e[a+1]=g;e[a+2]=h;e[a+3]=v;return}if(p!==v||d!==m||c!==g||u!==h){var y=1-l,_=d*m+c*g+u*h+p*v,x=0<=_?1:-1,b=1-_*_;if(b>Number.EPSILON){var S=Math.sqrt(b),M=Math.atan2(S,_*x);y=Math.sin(y*M)/S;l=Math.sin(l*M)/S}var T=l*x;d=d*y+m*T;c=c*y+g*T;u=u*y+h*T;p=p*y+v*T;if(y==1-l){var E=1/Math.sqrt(d*d+c*c+u*u+p*p);d*=E;c*=E;u*=E;p*=E}}e[a]=d;e[a+1]=c;e[a+2]=u;e[a+3]=p}},{key:"multiplyQuaternionsFlat",value:function multiplyQuaternionsFlat(e,t,a,r,i,n){var o=a[r],s=a[r+1],l=a[r+2],d=a[r+3],c=i[n],u=i[n+1],p=i[n+2],m=i[n+3];e[t]=o*m+d*c+s*p-l*u;e[t+1]=s*m+d*u+l*c-o*p;e[t+2]=l*m+d*p+o*u-s*c;e[t+3]=d*m-o*c-s*u-l*p;return e}}]);return e}();Ro.prototype.isQuaternion=!0;var Po=function(){function e(){var t=0<arguments.length&&arguments[0]!==void 0?arguments[0]:0,a=1<arguments.length&&arguments[1]!==void 0?arguments[1]:0,r=2<arguments.length&&arguments[2]!==void 0?arguments[2]:0;_classCallCheck2(this,e);this.x=t;this.y=a;this.z=r}_createClass2(e,[{key:"set",value:function set(e,t,a){if(a===void 0)a=this.z;this.x=e;this.y=t;this.z=a;return this}},{key:"setScalar",value:function setScalar(e){this.x=e;this.y=e;this.z=e;return this}},{key:"setX",value:function setX(e){this.x=e;return this}},{key:"setY",value:function setY(e){this.y=e;return this}},{key:"setZ",value:function setZ(e){this.z=e;return this}},{key:"setComponent",value:function setComponent(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;case 2:this.z=t;break;default:throw new Error("index is out of range: "+e);}return this}},{key:"getComponent",value:function getComponent(e){switch(e){case 0:return this.x;case 1:return this.y;case 2:return this.z;default:throw new Error("index is out of range: "+e);}}},{key:"clone",value:function clone(){return new this.constructor(this.x,this.y,this.z)}},{key:"copy",value:function copy(e){this.x=e.x;this.y=e.y;this.z=e.z;return this}},{key:"add",value:function add(e,t){if(t!==void 0){console.warn("THREE.Vector3: .add() now only accepts one argument. Use .addVectors( a, b ) instead.");return this.addVectors(e,t)}this.x+=e.x;this.y+=e.y;this.z+=e.z;return this}},{key:"addScalar",value:function addScalar(e){this.x+=e;this.y+=e;this.z+=e;return this}},{key:"addVectors",value:function addVectors(e,t){this.x=e.x+t.x;this.y=e.y+t.y;this.z=e.z+t.z;return this}},{key:"addScaledVector",value:function addScaledVector(e,t){this.x+=e.x*t;this.y+=e.y*t;this.z+=e.z*t;return this}},{key:"sub",value:function sub(e,t){if(t!==void 0){console.warn("THREE.Vector3: .sub() now only accepts one argument. Use .subVectors( a, b ) instead.");return this.subVectors(e,t)}this.x-=e.x;this.y-=e.y;this.z-=e.z;return this}},{key:"subScalar",value:function subScalar(e){this.x-=e;this.y-=e;this.z-=e;return this}},{key:"subVectors",value:function subVectors(e,t){this.x=e.x-t.x;this.y=e.y-t.y;this.z=e.z-t.z;return this}},{key:"multiply",value:function multiply(e,t){if(t!==void 0){console.warn("THREE.Vector3: .multiply() now only accepts one argument. Use .multiplyVectors( a, b ) instead.");return this.multiplyVectors(e,t)}this.x*=e.x;this.y*=e.y;this.z*=e.z;return this}},{key:"multiplyScalar",value:function multiplyScalar(e){this.x*=e;this.y*=e;this.z*=e;return this}},{key:"multiplyVectors",value:function multiplyVectors(e,t){this.x=e.x*t.x;this.y=e.y*t.y;this.z=e.z*t.z;return this}},{key:"applyEuler",value:function applyEuler(e){if(!(e&&e.isEuler)){console.error("THREE.Vector3: .applyEuler() now expects an Euler rotation rather than a Vector3 and order.")}return this.applyQuaternion(Io.setFromEuler(e))}},{key:"applyAxisAngle",value:function applyAxisAngle(e,t){return this.applyQuaternion(Io.setFromAxisAngle(e,t))}},{key:"applyMatrix3",value:function applyMatrix3(t){var a=this.x,r=this.y,i=this.z,n=t.elements;this.x=n[0]*a+n[3]*r+n[6]*i;this.y=n[1]*a+n[4]*r+n[7]*i;this.z=n[2]*a+n[5]*r+n[8]*i;return this}},{key:"applyNormalMatrix",value:function applyNormalMatrix(e){return this.applyMatrix3(e).normalize()}},{key:"applyMatrix4",value:function applyMatrix4(t){var a=this.x,r=this.y,i=this.z,n=t.elements,e=1/(n[3]*a+n[7]*r+n[11]*i+n[15]);this.x=(n[0]*a+n[4]*r+n[8]*i+n[12])*e;this.y=(n[1]*a+n[5]*r+n[9]*i+n[13])*e;this.z=(n[2]*a+n[6]*r+n[10]*i+n[14])*e;return this}},{key:"applyQuaternion",value:function applyQuaternion(e){var t=this.x,a=this.y,r=this.z,i=e.x,n=e.y,o=e.z,s=e.w,l=s*t+n*r-o*a,d=s*a+o*t-i*r,c=s*r+i*a-n*t,u=-i*t-n*a-o*r;this.x=l*s+u*-i+d*-o-c*-n;this.y=d*s+u*-n+c*-i-l*-o;this.z=c*s+u*-o+l*-n-d*-i;return this}},{key:"project",value:function project(e){return this.applyMatrix4(e.matrixWorldInverse).applyMatrix4(e.projectionMatrix)}},{key:"unproject",value:function unproject(e){return this.applyMatrix4(e.projectionMatrixInverse).applyMatrix4(e.matrixWorld)}},{key:"transformDirection",value:function transformDirection(t){var a=this.x,r=this.y,i=this.z,n=t.elements;this.x=n[0]*a+n[4]*r+n[8]*i;this.y=n[1]*a+n[5]*r+n[9]*i;this.z=n[2]*a+n[6]*r+n[10]*i;return this.normalize()}},{key:"divide",value:function divide(e){this.x/=e.x;this.y/=e.y;this.z/=e.z;return this}},{key:"divideScalar",value:function divideScalar(e){return this.multiplyScalar(1/e)}},{key:"min",value:function min(e){this.x=Math.min(this.x,e.x);this.y=Math.min(this.y,e.y);this.z=Math.min(this.z,e.z);return this}},{key:"max",value:function max(e){this.x=Math.max(this.x,e.x);this.y=Math.max(this.y,e.y);this.z=Math.max(this.z,e.z);return this}},{key:"clamp",value:function(e,t){this.x=Math.max(e.x,Math.min(t.x,this.x));this.y=Math.max(e.y,Math.min(t.y,this.y));this.z=Math.max(e.z,Math.min(t.z,this.z));return this}},{key:"clampScalar",value:function clampScalar(e,t){this.x=Math.max(e,Math.min(t,this.x));this.y=Math.max(e,Math.min(t,this.y));this.z=Math.max(e,Math.min(t,this.z));return this}},{key:"clampLength",value:function clampLength(e,t){var a=this.length();return this.divideScalar(a||1).multiplyScalar(Math.max(e,Math.min(t,a)))}},{key:"floor",value:function floor(){this.x=Math.floor(this.x);this.y=Math.floor(this.y);this.z=Math.floor(this.z);return this}},{key:"ceil",value:function ceil(){this.x=Math.ceil(this.x);this.y=Math.ceil(this.y);this.z=Math.ceil(this.z);return this}},{key:"round",value:function round(){this.x=Math.round(this.x);this.y=Math.round(this.y);this.z=Math.round(this.z);return this}},{key:"roundToZero",value:function roundToZero(){this.x=0>this.x?Math.ceil(this.x):Math.floor(this.x);this.y=0>this.y?Math.ceil(this.y):Math.floor(this.y);this.z=0>this.z?Math.ceil(this.z):Math.floor(this.z);return this}},{key:"negate",value:function negate(){this.x=-this.x;this.y=-this.y;this.z=-this.z;return this}},{key:"dot",value:function dot(e){return this.x*e.x+this.y*e.y+this.z*e.z}},{key:"lengthSq",value:function lengthSq(){return this.x*this.x+this.y*this.y+this.z*this.z}},{key:"length",value:function length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)}},{key:"manhattanLength",value:function manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)}},{key:"normalize",value:function normalize(){return this.divideScalar(this.length()||1)}},{key:"setLength",value:function setLength(e){return this.normalize().multiplyScalar(e)}},{key:"lerp",value:function(e,t){this.x+=(e.x-this.x)*t;this.y+=(e.y-this.y)*t;this.z+=(e.z-this.z)*t;return this}},{key:"lerpVectors",value:function lerpVectors(e,t,a){this.x=e.x+(t.x-e.x)*a;this.y=e.y+(t.y-e.y)*a;this.z=e.z+(t.z-e.z)*a;return this}},{key:"cross",value:function cross(e,t){if(t!==void 0){console.warn("THREE.Vector3: .cross() now only accepts one argument. Use .crossVectors( a, b ) instead.");return this.crossVectors(e,t)}return this.crossVectors(this,e)}},{key:"crossVectors",value:function crossVectors(e,t){var a=e.x,r=e.y,i=e.z,n=t.x,o=t.y,s=t.z;this.x=r*s-i*o;this.y=i*n-a*s;this.z=a*o-r*n;return this}},{key:"projectOnVector",value:function projectOnVector(e){var t=e.lengthSq();if(0===t)return this.set(0,0,0);var a=e.dot(this)/t;return this.copy(e).multiplyScalar(a)}},{key:"projectOnPlane",value:function projectOnPlane(e){Do.copy(this).projectOnVector(e);return this.sub(Do)}},{key:"reflect",value:function reflect(e){return this.sub(Do.copy(e).multiplyScalar(2*this.dot(e)))}},{key:"angleTo",value:function angleTo(e){var a=Math.sqrt(this.lengthSq()*e.lengthSq());if(0===a)return Math.PI/2;var r=this.dot(e)/a;return Math.acos(t(r,-1,1))}},{key:"distanceTo",value:function distanceTo(e){return Math.sqrt(this.distanceToSquared(e))}},{key:"distanceToSquared",value:function distanceToSquared(e){var t=this.x-e.x,a=this.y-e.y,r=this.z-e.z;return t*t+a*a+r*r}},{key:"manhattanDistanceTo",value:function manhattanDistanceTo(e){return Math.abs(this.x-e.x)+Math.abs(this.y-e.y)+Math.abs(this.z-e.z)}},{key:"setFromSpherical",value:function setFromSpherical(e){return this.setFromSphericalCoords(e.radius,e.phi,e.theta)}},{key:"setFromSphericalCoords",value:function setFromSphericalCoords(e,t,a){var r=Math.sin(t)*e;this.x=r*Math.sin(a);this.y=Math.cos(t)*e;this.z=r*Math.cos(a);return this}},{key:"setFromCylindrical",value:function setFromCylindrical(e){return this.setFromCylindricalCoords(e.radius,e.theta,e.y)}},{key:"setFromCylindricalCoords",value:function setFromCylindricalCoords(e,t,a){this.x=e*Math.sin(t);this.y=a;this.z=e*Math.cos(t);return this}},{key:"setFromMatrixPosition",value:function setFromMatrixPosition(t){var a=t.elements;this.x=a[12];this.y=a[13];this.z=a[14];return this}},{key:"setFromMatrixScale",value:function setFromMatrixScale(e){var t=this.setFromMatrixColumn(e,0).length(),a=this.setFromMatrixColumn(e,1).length(),r=this.setFromMatrixColumn(e,2).length();this.x=t;this.y=a;this.z=r;return this}},{key:"setFromMatrixColumn",value:function setFromMatrixColumn(e,t){return this.fromArray(e.elements,4*t)}},{key:"setFromMatrix3Column",value:function setFromMatrix3Column(e,t){return this.fromArray(e.elements,3*t)}},{key:"equals",value:function(e){return e.x===this.x&&e.y===this.y&&e.z===this.z}},{key:"fromArray",value:function fromArray(e){var t=1<arguments.length&&arguments[1]!==void 0?arguments[1]:0;this.x=e[t];this.y=e[t+1];this.z=e[t+2];return this}},{key:"toArray",value:function toArray(){var e=0<arguments.length&&arguments[0]!==void 0?arguments[0]:[],t=1<arguments.length&&arguments[1]!==void 0?arguments[1]:0;e[t]=this.x;e[t+1]=this.y;e[t+2]=this.z;return e}},{key:"fromBufferAttribute",value:function fromBufferAttribute(e,t,a){if(a!==void 0){console.warn("THREE.Vector3: offset has been removed from .fromBufferAttribute().")}this.x=e.getX(t);this.y=e.getY(t);this.z=e.getZ(t);return this}},{key:"random",value:function random(){this.x=Math.random();this.y=Math.random();this.z=Math.random();return this}},{key:"randomDirection",value:function randomDirection(){var e=2*(Math.random()-.5),a=2*(Math.random()*Math.PI),t=Math.sqrt(1-Math.pow(e,2));this.x=t*Math.cos(a);this.y=t*Math.sin(a);this.z=e;return this}},{key:Symbol.iterator,value:regeneratorRuntime.mark(function value(){return regeneratorRuntime.wrap(function(e){while(1){switch(e.prev=e.next){case 0:e.next=2;return this.x;case 2:e.next=4;return this.y;case 4:e.next=6;return this.z;case 6:case"end":return e.stop();}}},value,this)})}]);return e}();Po.prototype.isVector3=!0;var Do=new Po,Io=new Ro,zo=function(){function e(){var t=0<arguments.length&&arguments[0]!==void 0?arguments[0]:new Po(+Infinity,+Infinity,+Infinity),a=1<arguments.length&&arguments[1]!==void 0?arguments[1]:new Po(-Infinity,-Infinity,-Infinity);_classCallCheck2(this,e);this.min=t;this.max=a}_createClass2(e,[{key:"set",value:function set(e,t){this.min.copy(e);this.max.copy(t);return this}},{key:"setFromArray",value:function setFromArray(e){for(var t=+Infinity,a=+Infinity,r=+Infinity,i=-Infinity,n=-Infinity,o=-Infinity,s=0,d=e.length;s<d;s+=3){var l=e[s],c=e[s+1],u=e[s+2];if(l<t)t=l;if(c<a)a=c;if(u<r)r=u;if(l>i)i=l;if(c>n)n=c;if(u>o)o=u}this.min.set(t,a,r);this.max.set(i,n,o);return this}},{key:"setFromBufferAttribute",value:function setFromBufferAttribute(e){for(var t=+Infinity,a=+Infinity,r=+Infinity,i=-Infinity,n=-Infinity,o=-Infinity,s=0,d=e.count;s<d;s++){var l=e.getX(s),c=e.getY(s),u=e.getZ(s);if(l<t)t=l;if(c<a)a=c;if(u<r)r=u;if(l>i)i=l;if(c>n)n=c;if(u>o)o=u}this.min.set(t,a,r);this.max.set(i,n,o);return this}},{key:"setFromPoints",value:function setFromPoints(e){this.makeEmpty();for(var t=0,a=e.length;t<a;t++){this.expandByPoint(e[t])}return this}},{key:"setFromCenterAndSize",value:function setFromCenterAndSize(e,t){var a=Oo.copy(t).multiplyScalar(.5);this.min.copy(e).sub(a);this.max.copy(e).add(a);return this}},{key:"setFromObject",value:function setFromObject(e){this.makeEmpty();return this.expandByObject(e)}},{key:"clone",value:function clone(){return new this.constructor().copy(this)}},{key:"copy",value:function copy(e){this.min.copy(e.min);this.max.copy(e.max);return this}},{key:"makeEmpty",value:function makeEmpty(){this.min.x=this.min.y=this.min.z=+Infinity;this.max.x=this.max.y=this.max.z=-Infinity;return this}},{key:"isEmpty",value:function isEmpty(){return this.max.x<this.min.x||this.max.y<this.min.y||this.max.z<this.min.z}},{key:"getCenter",value:function getCenter(e){return this.isEmpty()?e.set(0,0,0):e.addVectors(this.min,this.max).multiplyScalar(.5)}},{key:"getSize",value:function getSize(e){return this.isEmpty()?e.set(0,0,0):e.subVectors(this.max,this.min)}},{key:"expandByPoint",value:function expandByPoint(e){this.min.min(e);this.max.max(e);return this}},{key:"expandByVector",value:function expandByVector(e){this.min.sub(e);this.max.add(e);return this}},{key:"expandByScalar",value:function expandByScalar(e){this.min.addScalar(-e);this.max.addScalar(e);return this}},{key:"expandByObject",value:function expandByObject(e){e.updateWorldMatrix(!1,!1);var t=e.geometry;if(t!==void 0){if(null===t.boundingBox){t.computeBoundingBox()}Fo.copy(t.boundingBox);Fo.applyMatrix4(e.matrixWorld);this.union(Fo)}for(var a=e.children,r=0,i=a.length;r<i;r++){this.expandByObject(a[r])}return this}},{key:"containsPoint",value:function containsPoint(e){return e.x<this.min.x||e.x>this.max.x||e.y<this.min.y||e.y>this.max.y||e.z<this.min.z||e.z>this.max.z?!1:!0}},{key:"containsBox",value:function containsBox(e){return this.min.x<=e.min.x&&e.max.x<=this.max.x&&this.min.y<=e.min.y&&e.max.y<=this.max.y&&this.min.z<=e.min.z&&e.max.z<=this.max.z}},{key:"getParameter",value:function getParameter(e,t){return t.set((e.x-this.min.x)/(this.max.x-this.min.x),(e.y-this.min.y)/(this.max.y-this.min.y),(e.z-this.min.z)/(this.max.z-this.min.z))}},{key:"intersectsBox",value:function intersectsBox(e){return e.max.x<this.min.x||e.min.x>this.max.x||e.max.y<this.min.y||e.min.y>this.max.y||e.max.z<this.min.z||e.min.z>this.max.z?!1:!0}},{key:"intersectsSphere",value:function intersectsSphere(e){this.clampPoint(e.center,Oo);return Oo.distanceToSquared(e.center)<=e.radius*e.radius}},{key:"intersectsPlane",value:function intersectsPlane(e){var t,a;if(0<e.normal.x){t=e.normal.x*this.min.x;a=e.normal.x*this.max.x}else{t=e.normal.x*this.max.x;a=e.normal.x*this.min.x}if(0<e.normal.y){t+=e.normal.y*this.min.y;a+=e.normal.y*this.max.y}else{t+=e.normal.y*this.max.y;a+=e.normal.y*this.min.y}if(0<e.normal.z){t+=e.normal.z*this.min.z;a+=e.normal.z*this.max.z}else{t+=e.normal.z*this.max.z;a+=e.normal.z*this.min.z}return t<=-e.constant&&a>=-e.constant}},{key:"intersectsTriangle",value:function intersectsTriangle(e){if(this.isEmpty()){return!1}this.getCenter(jo);qo.subVectors(this.max,jo);Uo.subVectors(e.a,jo);Bo.subVectors(e.b,jo);Ho.subVectors(e.c,jo);Go.subVectors(Bo,Uo);Vo.subVectors(Ho,Bo);Wo.subVectors(Uo,Ho);var t=[0,-Go.z,Go.y,0,-Vo.z,Vo.y,0,-Wo.z,Wo.y,Go.z,0,-Go.x,Vo.z,0,-Vo.x,Wo.z,0,-Wo.x,-Go.y,Go.x,0,-Vo.y,Vo.x,0,-Wo.y,Wo.x,0];if(!m(t,Uo,Bo,Ho,qo)){return!1}t=[1,0,0,0,1,0,0,0,1];if(!m(t,Uo,Bo,Ho,qo)){return!1}Xo.crossVectors(Go,Vo);t=[Xo.x,Xo.y,Xo.z];return m(t,Uo,Bo,Ho,qo)}},{key:"clampPoint",value:function clampPoint(e,t){return t.copy(e).clamp(this.min,this.max)}},{key:"distanceToPoint",value:function distanceToPoint(e){var t=Oo.copy(e).clamp(this.min,this.max);return t.sub(e).length()}},{key:"getBoundingSphere",value:function getBoundingSphere(e){this.getCenter(e.center);e.radius=.5*this.getSize(Oo).length();return e}},{key:"intersect",value:function intersect(e){this.min.max(e.min);this.max.min(e.max);if(this.isEmpty())this.makeEmpty();return this}},{key:"union",value:function union(e){this.min.min(e.min);this.max.max(e.max);return this}},{key:"applyMatrix4",value:function applyMatrix4(e){if(this.isEmpty())return this;No[0].set(this.min.x,this.min.y,this.min.z).applyMatrix4(e);No[1].set(this.min.x,this.min.y,this.max.z).applyMatrix4(e);No[2].set(this.min.x,this.max.y,this.min.z).applyMatrix4(e);No[3].set(this.min.x,this.max.y,this.max.z).applyMatrix4(e);No[4].set(this.max.x,this.min.y,this.min.z).applyMatrix4(e);No[5].set(this.max.x,this.min.y,this.max.z).applyMatrix4(e);No[6].set(this.max.x,this.max.y,this.min.z).applyMatrix4(e);No[7].set(this.max.x,this.max.y,this.max.z).applyMatrix4(e);this.setFromPoints(No);return this}},{key:"translate",value:function translate(e){this.min.add(e);this.max.add(e);return this}},{key:"equals",value:function(e){return e.min.equals(this.min)&&e.max.equals(this.max)}}]);return e}();zo.prototype.isBox3=!0;var No=[new Po,new Po,new Po,new Po,new Po,new Po,new Po,new Po],Oo=new Po,Fo=new zo,Uo=new Po,Bo=new Po,Ho=new Po,Go=new Po,Vo=new Po,Wo=new Po,jo=new Po,qo=new Po,Xo=new Po,Yo=new Po;function m(e,t,a,i,n){for(var d=0,c=e.length-3;d<=c;d+=3){Yo.fromArray(e,d);var o=n.x*Math.abs(Yo.x)+n.y*Math.abs(Yo.y)+n.z*Math.abs(Yo.z),r=t.dot(Yo),s=a.dot(Yo),l=i.dot(Yo);if(Math.max(-Math.max(r,s,l),Math.min(r,s,l))>o){return!1}}return!0}var Zo=new zo,Jo=new Po,Qo=new Po,Ko=new Po,$o=function(){function e(){var t=0<arguments.length&&arguments[0]!==void 0?arguments[0]:new Po,a=1<arguments.length&&arguments[1]!==void 0?arguments[1]:-1;_classCallCheck2(this,e);this.center=t;this.radius=a}_createClass2(e,[{key:"set",value:function set(e,t){this.center.copy(e);this.radius=t;return this}},{key:"setFromPoints",value:function setFromPoints(e,t){var a=this.center;if(t!==void 0){a.copy(t)}else{Zo.setFromPoints(e).getCenter(a)}for(var r=0,i=0,n=e.length;i<n;i++){r=Math.max(r,a.distanceToSquared(e[i]))}this.radius=Math.sqrt(r);return this}},{key:"copy",value:function copy(e){this.center.copy(e.center);this.radius=e.radius;return this}},{key:"isEmpty",value:function isEmpty(){return 0>this.radius}},{key:"makeEmpty",value:function makeEmpty(){this.center.set(0,0,0);this.radius=-1;return this}},{key:"containsPoint",value:function containsPoint(e){return e.distanceToSquared(this.center)<=this.radius*this.radius}},{key:"distanceToPoint",value:function distanceToPoint(e){return e.distanceTo(this.center)-this.radius}},{key:"intersectsSphere",value:function intersectsSphere(e){var t=this.radius+e.radius;return e.center.distanceToSquared(this.center)<=t*t}},{key:"intersectsBox",value:function intersectsBox(e){return e.intersectsSphere(this)}},{key:"intersectsPlane",value:function intersectsPlane(e){return Math.abs(e.distanceToPoint(this.center))<=this.radius}},{key:"clampPoint",value:function clampPoint(e,t){var a=this.center.distanceToSquared(e);t.copy(e);if(a>this.radius*this.radius){t.sub(this.center).normalize();t.multiplyScalar(this.radius).add(this.center)}return t}},{key:"getBoundingBox",value:function getBoundingBox(e){if(this.isEmpty()){e.makeEmpty();return e}e.set(this.center,this.center);e.expandByScalar(this.radius);return e}},{key:"applyMatrix4",value:function applyMatrix4(e){this.center.applyMatrix4(e);this.radius=this.radius*e.getMaxScaleOnAxis();return this}},{key:"translate",value:function translate(e){this.center.add(e);return this}},{key:"expandByPoint",value:function expandByPoint(e){Ko.subVectors(e,this.center);var t=Ko.lengthSq();if(t>this.radius*this.radius){var a=Math.sqrt(t),r=.5*(a-this.radius);this.center.add(Ko.multiplyScalar(r/a));this.radius+=r}return this}},{key:"union",value:function union(e){Qo.subVectors(e.center,this.center).normalize().multiplyScalar(e.radius);this.expandByPoint(Jo.copy(e.center).add(Qo));this.expandByPoint(Jo.copy(e.center).sub(Qo));return this}},{key:"equals",value:function(e){return e.center.equals(this.center)&&e.radius===this.radius}},{key:"clone",value:function clone(){return new this.constructor().copy(this)}}]);return e}(),es=new Po,ts=new Po,as=new Po,rs=new Po,is=new Po,ns=new Po,os=new Po,ss=function(){function e(){var t=0<arguments.length&&arguments[0]!==void 0?arguments[0]:new Po,a=1<arguments.length&&arguments[1]!==void 0?arguments[1]:new Po(0,0,-1);_classCallCheck2(this,e);this.origin=t;this.direction=a}_createClass2(e,[{key:"set",value:function set(e,t){this.origin.copy(e);this.direction.copy(t);return this}},{key:"copy",value:function copy(e){this.origin.copy(e.origin);this.direction.copy(e.direction);return this}},{key:"at",value:function at(e,t){return t.copy(this.direction).multiplyScalar(e).add(this.origin)}},{key:"lookAt",value:function lookAt(e){this.direction.copy(e).sub(this.origin).normalize();return this}},{key:"recast",value:function recast(e){this.origin.copy(this.at(e,es));return this}},{key:"closestPointToPoint",value:function closestPointToPoint(e,t){t.subVectors(e,this.origin);var a=t.dot(this.direction);if(0>a){return t.copy(this.origin)}return t.copy(this.direction).multiplyScalar(a).add(this.origin)}},{key:"distanceToPoint",value:function distanceToPoint(e){return Math.sqrt(this.distanceSqToPoint(e))}},{key:"distanceSqToPoint",value:function distanceSqToPoint(e){var t=es.subVectors(e,this.origin).dot(this.direction);if(0>t){return this.origin.distanceToSquared(e)}es.copy(this.direction).multiplyScalar(t).add(this.origin);return es.distanceToSquared(e)}},{key:"distanceSqToSegment",value:function distanceSqToSegment(e,t,a,r){ts.copy(e).add(t).multiplyScalar(.5);as.copy(t).sub(e).normalize();rs.copy(this.origin).sub(ts);var i=.5*e.distanceTo(t),n=-this.direction.dot(as),o=rs.dot(this.direction),s=-rs.dot(as),l=rs.lengthSq(),d=Math.abs(1-n*n),c,u,p,m;if(0<d){c=n*s-o;u=n*o-s;m=i*d;if(0<=c){if(u>=-m){if(u<=m){var g=1/d;c*=g;u*=g;p=c*(c+n*u+2*o)+u*(n*c+u+2*s)+l}else{u=i;c=Math.max(0,-(n*u+o));p=-c*c+u*(u+2*s)+l}}else{u=-i;c=Math.max(0,-(n*u+o));p=-c*c+u*(u+2*s)+l}}else{if(u<=-m){c=Math.max(0,-(-n*i+o));u=0<c?-i:Math.min(Math.max(-i,-s),i);p=-c*c+u*(u+2*s)+l}else if(u<=m){c=0;u=Math.min(Math.max(-i,-s),i);p=u*(u+2*s)+l}else{c=Math.max(0,-(n*i+o));u=0<c?i:Math.min(Math.max(-i,-s),i);p=-c*c+u*(u+2*s)+l}}}else{u=0<n?-i:i;c=Math.max(0,-(n*u+o));p=-c*c+u*(u+2*s)+l}if(a){a.copy(this.direction).multiplyScalar(c).add(this.origin)}if(r){r.copy(as).multiplyScalar(u).add(ts)}return p}},{key:"intersectSphere",value:function intersectSphere(e,t){es.subVectors(e.center,this.origin);var a=es.dot(this.direction),r=es.dot(es)-a*a,i=e.radius*e.radius;if(r>i)return null;var n=Math.sqrt(i-r),o=a-n,s=a+n;if(0>o&&0>s)return null;if(0>o)return this.at(s,t);return this.at(o,t)}},{key:"intersectsSphere",value:function intersectsSphere(e){return this.distanceSqToPoint(e.center)<=e.radius*e.radius}},{key:"distanceToPlane",value:function distanceToPlane(e){var a=e.normal.dot(this.direction);if(0===a){if(0===e.distanceToPoint(this.origin)){return 0}return null}var r=-(this.origin.dot(e.normal)+e.constant)/a;return 0<=r?r:null}},{key:"intersectPlane",value:function intersectPlane(e,a){var r=this.distanceToPlane(e);if(null===r){return null}return this.at(r,a)}},{key:"intersectsPlane",value:function intersectsPlane(e){var t=e.distanceToPoint(this.origin);if(0===t){return!0}var a=e.normal.dot(this.direction);if(0>a*t){return!0}return!1}},{key:"intersectBox",value:function intersectBox(e,t){var a,r,i,n,o,s,l=1/this.direction.x,d=1/this.direction.y,c=1/this.direction.z,u=this.origin;if(0<=l){a=(e.min.x-u.x)*l;r=(e.max.x-u.x)*l}else{a=(e.max.x-u.x)*l;r=(e.min.x-u.x)*l}if(0<=d){i=(e.min.y-u.y)*d;n=(e.max.y-u.y)*d}else{i=(e.max.y-u.y)*d;n=(e.min.y-u.y)*d}if(a>n||i>r)return null;if(i>a||a!==a)a=i;if(n<r||r!==r)r=n;if(0<=c){o=(e.min.z-u.z)*c;s=(e.max.z-u.z)*c}else{o=(e.max.z-u.z)*c;s=(e.min.z-u.z)*c}if(a>s||o>r)return null;if(o>a||a!==a)a=o;if(s<r||r!==r)r=s;if(0>r)return null;return this.at(0<=a?a:r,t)}},{key:"intersectsBox",value:function intersectsBox(e){return null!==this.intersectBox(e,es)}},{key:"intersectTriangle",value:function intersectTriangle(e,t,a,r,i){is.subVectors(t,e);ns.subVectors(a,e);os.crossVectors(is,ns);var n=this.direction.dot(os),o;if(0<n){if(r)return null;o=1}else if(0>n){o=-1;n=-n}else{return null}rs.subVectors(this.origin,e);var s=o*this.direction.dot(ns.crossVectors(rs,ns));if(0>s){return null}var l=o*this.direction.dot(is.cross(rs));if(0>l){return null}if(s+l>n){return null}var d=-o*rs.dot(os);if(0>d){return null}return this.at(d/n,i)}},{key:"applyMatrix4",value:function applyMatrix4(e){this.origin.applyMatrix4(e);this.direction.transformDirection(e);return this}},{key:"equals",value:function(e){return e.origin.equals(this.origin)&&e.direction.equals(this.direction)}},{key:"clone",value:function clone(){return new this.constructor().copy(this)}}]);return e}(),ls=function(){function e(){_classCallCheck2(this,e);this.elements=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1];if(0<arguments.length){console.error("THREE.Matrix4: the constructor no longer reads arguments. use .set() instead.")}}_createClass2(e,[{key:"set",value:function set(e,t,a,r,i,n,o,s,l,d,c,u,p,m,g,f){var h=this.elements;h[0]=e;h[4]=t;h[8]=a;h[12]=r;h[1]=i;h[5]=n;h[9]=o;h[13]=s;h[2]=l;h[6]=d;h[10]=c;h[14]=u;h[3]=p;h[7]=m;h[11]=g;h[15]=f;return this}},{key:"identity",value:function identity(){this.set(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1);return this}},{key:"clone",value:function clone(){return new e().fromArray(this.elements)}},{key:"copy",value:function copy(e){var t=this.elements,a=e.elements;t[0]=a[0];t[1]=a[1];t[2]=a[2];t[3]=a[3];t[4]=a[4];t[5]=a[5];t[6]=a[6];t[7]=a[7];t[8]=a[8];t[9]=a[9];t[10]=a[10];t[11]=a[11];t[12]=a[12];t[13]=a[13];t[14]=a[14];t[15]=a[15];return this}},{key:"copyPosition",value:function copyPosition(e){var t=this.elements,a=e.elements;t[12]=a[12];t[13]=a[13];t[14]=a[14];return this}},{key:"setFromMatrix3",value:function setFromMatrix3(e){var t=e.elements;this.set(t[0],t[3],t[6],0,t[1],t[4],t[7],0,t[2],t[5],t[8],0,0,0,0,1);return this}},{key:"extractBasis",value:function extractBasis(e,t,a){e.setFromMatrixColumn(this,0);t.setFromMatrixColumn(this,1);a.setFromMatrixColumn(this,2);return this}},{key:"makeBasis",value:function makeBasis(e,t,a){this.set(e.x,t.x,a.x,0,e.y,t.y,a.y,0,e.z,t.z,a.z,0,0,0,0,1);return this}},{key:"extractRotation",value:function extractRotation(e){var t=this.elements,a=e.elements,r=1/ds.setFromMatrixColumn(e,0).length(),i=1/ds.setFromMatrixColumn(e,1).length(),n=1/ds.setFromMatrixColumn(e,2).length();t[0]=a[0]*r;t[1]=a[1]*r;t[2]=a[2]*r;t[3]=0;t[4]=a[4]*i;t[5]=a[5]*i;t[6]=a[6]*i;t[7]=0;t[8]=a[8]*n;t[9]=a[9]*n;t[10]=a[10]*n;t[11]=0;t[12]=0;t[13]=0;t[14]=0;t[15]=1;return this}},{key:"makeRotationFromEuler",value:function makeRotationFromEuler(t){if(!(t&&t.isEuler)){console.error("THREE.Matrix4: .makeRotationFromEuler() now expects a Euler rotation rather than a Vector3 and order.")}var r=this.elements,i=t.x,n=t.y,o=t.z,s=Math.cos(i),a=Math.sin(i),l=Math.cos(n),c=Math.sin(n),d=Math.cos(o),e=Math.sin(o);if("XYZ"===t.order){var u=s*d,p=s*e,m=a*d,g=a*e;r[0]=l*d;r[4]=-l*e;r[8]=c;r[1]=p+m*c;r[5]=u-g*c;r[9]=-a*l;r[2]=g-u*c;r[6]=m+p*c;r[10]=s*l}else if("YXZ"===t.order){var f=l*d,h=l*e,v=c*d,y=c*e;r[0]=f+y*a;r[4]=v*a-h;r[8]=s*c;r[1]=s*e;r[5]=s*d;r[9]=-a;r[2]=h*a-v;r[6]=y+f*a;r[10]=s*l}else if("ZXY"===t.order){var _=l*d,x=l*e,b=c*d,S=c*e;r[0]=_-S*a;r[4]=-s*e;r[8]=b+x*a;r[1]=x+b*a;r[5]=s*d;r[9]=S-_*a;r[2]=-s*c;r[6]=a;r[10]=s*l}else if("ZYX"===t.order){var M=s*d,T=s*e,E=a*d,w=a*e;r[0]=l*d;r[4]=E*c-T;r[8]=M*c+w;r[1]=l*e;r[5]=w*c+M;r[9]=T*c-E;r[2]=-c;r[6]=a*l;r[10]=s*l}else if("YZX"===t.order){var A=s*l,k=s*c,C=a*l,L=a*c;r[0]=l*d;r[4]=L-A*e;r[8]=C*e+k;r[1]=e;r[5]=s*d;r[9]=-a*d;r[2]=-c*d;r[6]=k*e+C;r[10]=A-L*e}else if("XZY"===t.order){var R=s*l,P=s*c,D=a*l,I=a*c;r[0]=l*d;r[4]=-e;r[8]=c*d;r[1]=R*e+I;r[5]=s*d;r[9]=P*e-D;r[2]=D*e-P;r[6]=a*d;r[10]=I*e+R}r[3]=0;r[7]=0;r[11]=0;r[12]=0;r[13]=0;r[14]=0;r[15]=1;return this}},{key:"makeRotationFromQuaternion",value:function makeRotationFromQuaternion(e){return this.compose(us,e,ps)}},{key:"lookAt",value:function lookAt(e,t,a){var r=this.elements;fs.subVectors(e,t);if(0===fs.lengthSq()){fs.z=1}fs.normalize();ms.crossVectors(a,fs);if(0===ms.lengthSq()){if(1===Math.abs(a.z)){fs.x+=1e-4}else{fs.z+=1e-4}fs.normalize();ms.crossVectors(a,fs)}ms.normalize();gs.crossVectors(fs,ms);r[0]=ms.x;r[4]=gs.x;r[8]=fs.x;r[1]=ms.y;r[5]=gs.y;r[9]=fs.y;r[2]=ms.z;r[6]=gs.z;r[10]=fs.z;return this}},{key:"multiply",value:function multiply(e,t){if(t!==void 0){console.warn("THREE.Matrix4: .multiply() now only accepts one argument. Use .multiplyMatrices( a, b ) instead.");return this.multiplyMatrices(e,t)}return this.multiplyMatrices(this,e)}},{key:"premultiply",value:function premultiply(e){return this.multiplyMatrices(e,this)}},{key:"multiplyMatrices",value:function multiplyMatrices(e,t){var a=e.elements,r=t.elements,i=this.elements,n=a[0],o=a[4],s=a[8],l=a[12],d=a[1],c=a[5],u=a[9],p=a[13],m=a[2],g=a[6],f=a[10],h=a[14],v=a[3],y=a[7],_=a[11],x=a[15],b=r[0],S=r[4],M=r[8],T=r[12],E=r[1],w=r[5],A=r[9],k=r[13],C=r[2],L=r[6],R=r[10],P=r[14],D=r[3],I=r[7],z=r[11],N=r[15];i[0]=n*b+o*E+s*C+l*D;i[4]=n*S+o*w+s*L+l*I;i[8]=n*M+o*A+s*R+l*z;i[12]=n*T+o*k+s*P+l*N;i[1]=d*b+c*E+u*C+p*D;i[5]=d*S+c*w+u*L+p*I;i[9]=d*M+c*A+u*R+p*z;i[13]=d*T+c*k+u*P+p*N;i[2]=m*b+g*E+f*C+h*D;i[6]=m*S+g*w+f*L+h*I;i[10]=m*M+g*A+f*R+h*z;i[14]=m*T+g*k+f*P+h*N;i[3]=v*b+y*E+_*C+x*D;i[7]=v*S+y*w+_*L+x*I;i[11]=v*M+y*A+_*R+x*z;i[15]=v*T+y*k+_*P+x*N;return this}},{key:"multiplyScalar",value:function multiplyScalar(e){var t=this.elements;t[0]*=e;t[4]*=e;t[8]*=e;t[12]*=e;t[1]*=e;t[5]*=e;t[9]*=e;t[13]*=e;t[2]*=e;t[6]*=e;t[10]*=e;t[14]*=e;t[3]*=e;t[7]*=e;t[11]*=e;t[15]*=e;return this}},{key:"determinant",value:function determinant(){var e=this.elements,t=e[0],a=e[4],r=e[8],i=e[12],n=e[1],o=e[5],s=e[9],l=e[13],d=e[2],c=e[6],u=e[10],p=e[14],m=e[3],g=e[7],f=e[11],h=e[15];return m*(+i*s*c-r*l*c-i*o*u+a*l*u+r*o*p-a*s*p)+g*(+t*s*p-t*l*u+i*n*u-r*n*p+r*l*d-i*s*d)+f*(+t*l*c-t*o*p-i*n*c+a*n*p+i*o*d-a*l*d)+h*(-r*o*d-t*s*c+t*o*u+r*n*c-a*n*u+a*s*d)}},{key:"transpose",value:function transpose(){var e=this.elements,t;t=e[1];e[1]=e[4];e[4]=t;t=e[2];e[2]=e[8];e[8]=t;t=e[6];e[6]=e[9];e[9]=t;t=e[3];e[3]=e[12];e[12]=t;t=e[7];e[7]=e[13];e[13]=t;t=e[11];e[11]=e[14];e[14]=t;return this}},{key:"setPosition",value:function setPosition(e,t,a){var r=this.elements;if(e.isVector3){r[12]=e.x;r[13]=e.y;r[14]=e.z}else{r[12]=e;r[13]=t;r[14]=a}return this}},{key:"invert",value:function invert(){var e=this.elements,t=e[0],a=e[1],r=e[2],i=e[3],n=e[4],o=e[5],s=e[6],l=e[7],d=e[8],c=e[9],u=e[10],p=e[11],m=e[12],g=e[13],f=e[14],h=e[15],v=c*f*l-g*u*l+g*s*p-o*f*p-c*s*h+o*u*h,y=m*u*l-d*f*l-m*s*p+n*f*p+d*s*h-n*u*h,_=d*g*l-m*c*l+m*o*p-n*g*p-d*o*h+n*c*h,x=m*c*s-d*g*s-m*o*u+n*g*u+d*o*f-n*c*f,b=t*v+a*y+r*_+i*x;if(0===b)return this.set(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0);var S=1/b;e[0]=v*S;e[1]=(g*u*i-c*f*i-g*r*p+a*f*p+c*r*h-a*u*h)*S;e[2]=(o*f*i-g*s*i+g*r*l-a*f*l-o*r*h+a*s*h)*S;e[3]=(c*s*i-o*u*i-c*r*l+a*u*l+o*r*p-a*s*p)*S;e[4]=y*S;e[5]=(d*f*i-m*u*i+m*r*p-t*f*p-d*r*h+t*u*h)*S;e[6]=(m*s*i-n*f*i-m*r*l+t*f*l+n*r*h-t*s*h)*S;e[7]=(n*u*i-d*s*i+d*r*l-t*u*l-n*r*p+t*s*p)*S;e[8]=_*S;e[9]=(m*c*i-d*g*i-m*a*p+t*g*p+d*a*h-t*c*h)*S;e[10]=(n*g*i-m*o*i+m*a*l-t*g*l-n*a*h+t*o*h)*S;e[11]=(d*o*i-n*c*i-d*a*l+t*c*l+n*a*p-t*o*p)*S;e[12]=x*S;e[13]=(d*g*r-m*c*r+m*a*u-t*g*u-d*a*f+t*c*f)*S;e[14]=(m*o*r-n*g*r-m*a*s+t*g*s+n*a*f-t*o*f)*S;e[15]=(n*c*r-d*o*r+d*a*s-t*c*s-n*a*u+t*o*u)*S;return this}},{key:"scale",value:function scale(e){var t=this.elements,a=e.x,r=e.y,i=e.z;t[0]*=a;t[4]*=r;t[8]*=i;t[1]*=a;t[5]*=r;t[9]*=i;t[2]*=a;t[6]*=r;t[10]*=i;t[3]*=a;t[7]*=r;t[11]*=i;return this}},{key:"getMaxScaleOnAxis",value:function getMaxScaleOnAxis(){var e=this.elements,t=e[0]*e[0]+e[1]*e[1]+e[2]*e[2],a=e[4]*e[4]+e[5]*e[5]+e[6]*e[6],r=e[8]*e[8]+e[9]*e[9]+e[10]*e[10];return Math.sqrt(Math.max(t,a,r))}},{key:"makeTranslation",value:function makeTranslation(e,t,a){this.set(1,0,0,e,0,1,0,t,0,0,1,a,0,0,0,1);return this}},{key:"makeRotationX",value:function makeRotationX(e){var t=Math.cos(e),a=Math.sin(e);this.set(1,0,0,0,0,t,-a,0,0,a,t,0,0,0,0,1);return this}},{key:"makeRotationY",value:function makeRotationY(e){var t=Math.cos(e),a=Math.sin(e);this.set(t,0,a,0,0,1,0,0,-a,0,t,0,0,0,0,1);return this}},{key:"makeRotationZ",value:function makeRotationZ(e){var t=Math.cos(e),a=Math.sin(e);this.set(t,-a,0,0,a,t,0,0,0,0,1,0,0,0,0,1);return this}},{key:"makeRotationAxis",value:function makeRotationAxis(e,a){var r=Math.cos(a),i=Math.sin(a),n=1-r,t=e.x,o=e.y,s=e.z,l=n*t,d=n*o;this.set(l*t+r,l*o-i*s,l*s+i*o,0,l*o+i*s,d*o+r,d*s-i*t,0,l*s-i*o,d*s+i*t,n*s*s+r,0,0,0,0,1);return this}},{key:"makeScale",value:function makeScale(e,t,a){this.set(e,0,0,0,0,t,0,0,0,0,a,0,0,0,0,1);return this}},{key:"makeShear",value:function makeShear(e,t,a,r,i,n){this.set(1,a,i,0,e,1,n,0,t,r,1,0,0,0,0,1);return this}},{key:"compose",value:function compose(e,t,a){var r=this.elements,i=t._x,n=t._y,o=t._z,s=t._w,l=i+i,d=n+n,c=o+o,u=i*l,p=i*d,m=i*c,g=n*d,f=n*c,h=o*c,v=s*l,y=s*d,_=s*c,x=a.x,b=a.y,S=a.z;r[0]=(1-(g+h))*x;r[1]=(p+_)*x;r[2]=(m-y)*x;r[3]=0;r[4]=(p-_)*b;r[5]=(1-(u+h))*b;r[6]=(f+v)*b;r[7]=0;r[8]=(m+y)*S;r[9]=(f-v)*S;r[10]=(1-(u+g))*S;r[11]=0;r[12]=e.x;r[13]=e.y;r[14]=e.z;r[15]=1;return this}},{key:"decompose",value:function decompose(e,t,a){var r=this.elements,i=ds.set(r[0],r[1],r[2]).length(),n=ds.set(r[4],r[5],r[6]).length(),o=ds.set(r[8],r[9],r[10]).length(),s=this.determinant();if(0>s)i=-i;e.x=r[12];e.y=r[13];e.z=r[14];cs.copy(this);var l=1/i,d=1/n,c=1/o;cs.elements[0]*=l;cs.elements[1]*=l;cs.elements[2]*=l;cs.elements[4]*=d;cs.elements[5]*=d;cs.elements[6]*=d;cs.elements[8]*=c;cs.elements[9]*=c;cs.elements[10]*=c;t.setFromRotationMatrix(cs);a.x=i;a.y=n;a.z=o;return this}},{key:"makePerspective",value:function makePerspective(e,t,a,r,i,n){if(n===void 0){console.warn("THREE.Matrix4: .makePerspective() has been redefined and has a new signature. Please check the docs.")}var o=this.elements;o[0]=2*i/(t-e);o[4]=0;o[8]=(t+e)/(t-e);o[12]=0;o[1]=0;o[5]=2*i/(a-r);o[9]=(a+r)/(a-r);o[13]=0;o[2]=0;o[6]=0;o[10]=-(n+i)/(n-i);o[14]=-2*n*i/(n-i);o[3]=0;o[7]=0;o[11]=-1;o[15]=0;return this}},{key:"makeOrthographic",value:function makeOrthographic(e,t,a,r,i,n){var o=this.elements,s=1/(t-e),l=1/(a-r),d=1/(n-i);o[0]=2*s;o[4]=0;o[8]=0;o[12]=-((t+e)*s);o[1]=0;o[5]=2*l;o[9]=0;o[13]=-((a+r)*l);o[2]=0;o[6]=0;o[10]=-2*d;o[14]=-((n+i)*d);o[3]=0;o[7]=0;o[11]=0;o[15]=1;return this}},{key:"equals",value:function(e){for(var t=this.elements,a=e.elements,r=0;16>r;r++){if(t[r]!==a[r])return!1}return!0}},{key:"fromArray",value:function fromArray(e){for(var t=1<arguments.length&&arguments[1]!==void 0?arguments[1]:0,a=0;16>a;a++){this.elements[a]=e[a+t]}return this}},{key:"toArray",value:function toArray(){var e=0<arguments.length&&arguments[0]!==void 0?arguments[0]:[],t=1<arguments.length&&arguments[1]!==void 0?arguments[1]:0,a=this.elements;e[t]=a[0];e[t+1]=a[1];e[t+2]=a[2];e[t+3]=a[3];e[t+4]=a[4];e[t+5]=a[5];e[t+6]=a[6];e[t+7]=a[7];e[t+8]=a[8];e[t+9]=a[9];e[t+10]=a[10];e[t+11]=a[11];e[t+12]=a[12];e[t+13]=a[13];e[t+14]=a[14];e[t+15]=a[15];return e}}]);return e}();ls.prototype.isMatrix4=!0;var ds=new Po,cs=new ls,us=new Po(0,0,0),ps=new Po(1,1,1),ms=new Po,gs=new Po,fs=new Po,hs=new ls,vs=new Ro,ys=function(){function e(){var t=0<arguments.length&&arguments[0]!==void 0?arguments[0]:0,a=1<arguments.length&&arguments[1]!==void 0?arguments[1]:0,r=2<arguments.length&&arguments[2]!==void 0?arguments[2]:0,i=3<arguments.length&&arguments[3]!==void 0?arguments[3]:e.DefaultOrder;_classCallCheck2(this,e);this._x=t;this._y=a;this._z=r;this._order=i}_createClass2(e,[{key:"set",value:function set(e,t,a){var r=3<arguments.length&&arguments[3]!==void 0?arguments[3]:this._order;this._x=e;this._y=t;this._z=a;this._order=r;this._onChangeCallback();return this}},{key:"clone",value:function clone(){return new this.constructor(this._x,this._y,this._z,this._order)}},{key:"copy",value:function copy(e){this._x=e._x;this._y=e._y;this._z=e._z;this._order=e._order;this._onChangeCallback();return this}},{key:"setFromRotationMatrix",value:function setFromRotationMatrix(e){var a=1<arguments.length&&arguments[1]!==void 0?arguments[1]:this._order,r=2<arguments.length&&arguments[2]!==void 0?arguments[2]:!0,i=e.elements,n=i[0],o=i[4],s=i[8],l=i[1],d=i[5],c=i[9],u=i[2],p=i[6],m=i[10];switch(a){case"XYZ":this._y=Math.asin(t(s,-1,1));if(.9999999>Math.abs(s)){this._x=Math.atan2(-c,m);this._z=Math.atan2(-o,n)}else{this._x=Math.atan2(p,d);this._z=0}break;case"YXZ":this._x=Math.asin(-t(c,-1,1));if(.9999999>Math.abs(c)){this._y=Math.atan2(s,m);this._z=Math.atan2(l,d)}else{this._y=Math.atan2(-u,n);this._z=0}break;case"ZXY":this._x=Math.asin(t(p,-1,1));if(.9999999>Math.abs(p)){this._y=Math.atan2(-u,m);this._z=Math.atan2(-o,d)}else{this._y=0;this._z=Math.atan2(l,n)}break;case"ZYX":this._y=Math.asin(-t(u,-1,1));if(.9999999>Math.abs(u)){this._x=Math.atan2(p,m);this._z=Math.atan2(l,n)}else{this._x=0;this._z=Math.atan2(-o,d)}break;case"YZX":this._z=Math.asin(t(l,-1,1));if(.9999999>Math.abs(l)){this._x=Math.atan2(-c,d);this._y=Math.atan2(-u,n)}else{this._x=0;this._y=Math.atan2(s,m)}break;case"XZY":this._z=Math.asin(-t(o,-1,1));if(.9999999>Math.abs(o)){this._x=Math.atan2(p,d);this._y=Math.atan2(s,n)}else{this._x=Math.atan2(-c,m);this._y=0}break;default:console.warn("THREE.Euler: .setFromRotationMatrix() encountered an unknown order: "+a);}this._order=a;if(!0===r)this._onChangeCallback();return this}},{key:"setFromQuaternion",value:function setFromQuaternion(e,t,a){hs.makeRotationFromQuaternion(e);return this.setFromRotationMatrix(hs,t,a)}},{key:"setFromVector3",value:function setFromVector3(e){var t=1<arguments.length&&arguments[1]!==void 0?arguments[1]:this._order;return this.set(e.x,e.y,e.z,t)}},{key:"reorder",value:function reorder(e){vs.setFromEuler(this);return this.setFromQuaternion(vs,e)}},{key:"equals",value:function(e){return e._x===this._x&&e._y===this._y&&e._z===this._z&&e._order===this._order}},{key:"fromArray",value:function fromArray(e){this._x=e[0];this._y=e[1];this._z=e[2];if(e[3]!==void 0)this._order=e[3];this._onChangeCallback();return this}},{key:"toArray",value:function toArray(){var e=0<arguments.length&&arguments[0]!==void 0?arguments[0]:[],t=1<arguments.length&&arguments[1]!==void 0?arguments[1]:0;e[t]=this._x;e[t+1]=this._y;e[t+2]=this._z;e[t+3]=this._order;return e}},{key:"toVector3",value:function toVector3(e){if(e){return e.set(this._x,this._y,this._z)}else{return new Po(this._x,this._y,this._z)}}},{key:"_onChange",value:function _onChange(e){this._onChangeCallback=e;return this}},{key:"_onChangeCallback",value:function _onChangeCallback(){}},{key:"x",get:function get(){return this._x},set:function set(e){this._x=e;this._onChangeCallback()}},{key:"y",get:function get(){return this._y},set:function set(e){this._y=e;this._onChangeCallback()}},{key:"z",get:function get(){return this._z},set:function set(e){this._z=e;this._onChangeCallback()}},{key:"order",get:function get(){return this._order},set:function set(e){this._order=e;this._onChangeCallback()}}]);return e}();ys.prototype.isEuler=!0;ys.DefaultOrder="XYZ";ys.RotationOrders=["XYZ","YZX","ZXY","XZY","YXZ","ZYX"];var _s=function(){function e(){_classCallCheck2(this,e);this.mask=1}_createClass2(e,[{key:"set",value:function set(e){this.mask=(0|1<<e)>>>0}},{key:"enable",value:function enable(e){this.mask|=0|1<<e}},{key:"enableAll",value:function enableAll(){this.mask=-1}},{key:"toggle",value:function toggle(e){this.mask^=0|1<<e}},{key:"disable",value:function disable(e){this.mask&=~(0|1<<e)}},{key:"disableAll",value:function disableAll(){this.mask=0}},{key:"test",value:function test(e){return 0!=(this.mask&e.mask)}},{key:"isEnabled",value:function isEnabled(e){return 0!=(this.mask&(0|1<<e))}}]);return e}(),xs=0,bs=new Po,Ss=new Ro,Ms=new ls,Ts=new Po,Es=new Po,ws=new Po,As=new Ro,ks=new Po(1,0,0),Cs=new Po(0,1,0),Ls=new Po(0,0,1),Rs={type:"added"},Ps={type:"removed"},Ds=function(t){_inherits(a,t);var r=_createSuper(a);function a(){var t;_classCallCheck2(this,a);t=r.call(this);Object.defineProperty(_assertThisInitialized(t),"id",{value:xs++});t.uuid=e();t.name="";t.type="Object3D";t.parent=null;t.children=[];t.up=a.DefaultUp.clone();var i=new Po,n=new ys,o=new Ro,s=new Po(1,1,1);n._onChange(function(){o.setFromEuler(n,!1)});o._onChange(function(){n.setFromQuaternion(o,void 0,!1)});Object.defineProperties(_assertThisInitialized(t),{position:{configurable:!0,enumerable:!0,value:i},rotation:{configurable:!0,enumerable:!0,value:n},quaternion:{configurable:!0,enumerable:!0,value:o},scale:{configurable:!0,enumerable:!0,value:s},modelViewMatrix:{value:new ls},normalMatrix:{value:new So}});t.matrix=new ls;t.matrixWorld=new ls;t.matrixAutoUpdate=a.DefaultMatrixAutoUpdate;t.matrixWorldNeedsUpdate=!1;t.layers=new _s;t.visible=!0;t.castShadow=!1;t.receiveShadow=!1;t.frustumCulled=!0;t.renderOrder=0;t.animations=[];t.userData={};return t}_createClass2(a,[{key:"onBeforeRender",value:function onBeforeRender(){}},{key:"onAfterRender",value:function onAfterRender(){}},{key:"applyMatrix4",value:function applyMatrix4(e){if(this.matrixAutoUpdate)this.updateMatrix();this.matrix.premultiply(e);this.matrix.decompose(this.position,this.quaternion,this.scale)}},{key:"applyQuaternion",value:function applyQuaternion(e){this.quaternion.premultiply(e);return this}},{key:"setRotationFromAxisAngle",value:function setRotationFromAxisAngle(e,t){this.quaternion.setFromAxisAngle(e,t)}},{key:"setRotationFromEuler",value:function setRotationFromEuler(e){this.quaternion.setFromEuler(e,!0)}},{key:"setRotationFromMatrix",value:function setRotationFromMatrix(e){this.quaternion.setFromRotationMatrix(e)}},{key:"setRotationFromQuaternion",value:function setRotationFromQuaternion(e){this.quaternion.copy(e)}},{key:"rotateOnAxis",value:function rotateOnAxis(e,t){Ss.setFromAxisAngle(e,t);this.quaternion.multiply(Ss);return this}},{key:"rotateOnWorldAxis",value:function rotateOnWorldAxis(e,t){Ss.setFromAxisAngle(e,t);this.quaternion.premultiply(Ss);return this}},{key:"rotateX",value:function rotateX(e){return this.rotateOnAxis(ks,e)}},{key:"rotateY",value:function rotateY(e){return this.rotateOnAxis(Cs,e)}},{key:"rotateZ",value:function rotateZ(e){return this.rotateOnAxis(Ls,e)}},{key:"translateOnAxis",value:function translateOnAxis(e,t){bs.copy(e).applyQuaternion(this.quaternion);this.position.add(bs.multiplyScalar(t));return this}},{key:"translateX",value:function translateX(e){return this.translateOnAxis(ks,e)}},{key:"translateY",value:function translateY(e){return this.translateOnAxis(Cs,e)}},{key:"translateZ",value:function translateZ(e){return this.translateOnAxis(Ls,e)}},{key:"localToWorld",value:function localToWorld(e){return e.applyMatrix4(this.matrixWorld)}},{key:"worldToLocal",value:function worldToLocal(e){return e.applyMatrix4(Ms.copy(this.matrixWorld).invert())}},{key:"lookAt",value:function lookAt(e,t,a){if(e.isVector3){Ts.copy(e)}else{Ts.set(e,t,a)}var r=this.parent;this.updateWorldMatrix(!0,!1);Es.setFromMatrixPosition(this.matrixWorld);if(this.isCamera||this.isLight){Ms.lookAt(Es,Ts,this.up)}else{Ms.lookAt(Ts,Es,this.up)}this.quaternion.setFromRotationMatrix(Ms);if(r){Ms.extractRotation(r.matrixWorld);Ss.setFromRotationMatrix(Ms);this.quaternion.premultiply(Ss.invert())}}},{key:"add",value:function add(e){if(1<arguments.length){for(var t=0;t<arguments.length;t++){this.add(arguments[t])}return this}if(e===this){console.error("THREE.Object3D.add: object can't be added as a child of itself.",e);return this}if(e&&e.isObject3D){if(null!==e.parent){e.parent.remove(e)}e.parent=this;this.children.push(e);e.dispatchEvent(Rs)}else{console.error("THREE.Object3D.add: object not an instance of THREE.Object3D.",e)}return this}},{key:"remove",value:function remove(e){if(1<arguments.length){for(var a=0;a<arguments.length;a++){this.remove(arguments[a])}return this}var t=this.children.indexOf(e);if(-1!==t){e.parent=null;this.children.splice(t,1);e.dispatchEvent(Ps)}return this}},{key:"removeFromParent",value:function removeFromParent(){var e=this.parent;if(null!==e){e.remove(this)}return this}},{key:"clear",value:function clear(){for(var e=0,t;e<this.children.length;e++){t=this.children[e];t.parent=null;t.dispatchEvent(Ps)}this.children.length=0;return this}},{key:"attach",value:function attach(e){this.updateWorldMatrix(!0,!1);Ms.copy(this.matrixWorld).invert();if(null!==e.parent){e.parent.updateWorldMatrix(!0,!1);Ms.multiply(e.parent.matrixWorld)}e.applyMatrix4(Ms);this.add(e);e.updateWorldMatrix(!1,!0);return this}},{key:"getObjectById",value:function getObjectById(e){return this.getObjectByProperty("id",e)}},{key:"getObjectByName",value:function getObjectByName(e){return this.getObjectByProperty("name",e)}},{key:"getObjectByProperty",value:function getObjectByProperty(e,t){if(this[e]===t)return this;for(var i=0,n=this.children.length;i<n;i++){var a=this.children[i],r=a.getObjectByProperty(e,t);if(r!==void 0){return r}}}},{key:"getWorldPosition",value:function getWorldPosition(e){this.updateWorldMatrix(!0,!1);return e.setFromMatrixPosition(this.matrixWorld)}},{key:"getWorldQuaternion",value:function getWorldQuaternion(e){this.updateWorldMatrix(!0,!1);this.matrixWorld.decompose(Es,e,ws);return e}},{key:"getWorldScale",value:function getWorldScale(e){this.updateWorldMatrix(!0,!1);this.matrixWorld.decompose(Es,As,e);return e}},{key:"getWorldDirection",value:function getWorldDirection(t){this.updateWorldMatrix(!0,!1);var a=this.matrixWorld.elements;return t.set(a[8],a[9],a[10]).normalize()}},{key:"raycast",value:function raycast(){}},{key:"traverse",value:function traverse(e){e(this);for(var t=this.children,a=0,r=t.length;a<r;a++){t[a].traverse(e)}}},{key:"traverseVisible",value:function traverseVisible(e){if(!1===this.visible)return;e(this);for(var t=this.children,a=0,r=t.length;a<r;a++){t[a].traverseVisible(e)}}},{key:"traverseAncestors",value:function traverseAncestors(e){var t=this.parent;if(null!==t){e(t);t.traverseAncestors(e)}}},{key:"updateMatrix",value:function updateMatrix(){this.matrix.compose(this.position,this.quaternion,this.scale);this.matrixWorldNeedsUpdate=!0}},{key:"updateMatrixWorld",value:function updateMatrixWorld(e){if(this.matrixAutoUpdate)this.updateMatrix();if(this.matrixWorldNeedsUpdate||e){if(null===this.parent){this.matrixWorld.copy(this.matrix)}else{this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix)}this.matrixWorldNeedsUpdate=!1;e=!0}for(var t=this.children,a=0,r=t.length;a<r;a++){t[a].updateMatrixWorld(e)}}},{key:"updateWorldMatrix",value:function updateWorldMatrix(e,t){var a=this.parent;if(!0===e&&null!==a){a.updateWorldMatrix(!0,!1)}if(this.matrixAutoUpdate)this.updateMatrix();if(null===this.parent){this.matrixWorld.copy(this.matrix)}else{this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix)}if(!0===t){for(var r=this.children,i=0,n=r.length;i<n;i++){r[i].updateWorldMatrix(!1,!0)}}}},{key:"toJSON",value:function toJSON(e){var r=e===void 0||"string"==typeof e,i={};if(r){e={geometries:{},materials:{},textures:{},images:{},shapes:{},skeletons:{},animations:{}};i.metadata={version:4.5,type:"Object",generator:"Object3D.toJSON"}}var n={uuid:this.uuid,type:this.type};if(""!==this.name)n.name=this.name;if(!0===this.castShadow)n.castShadow=!0;if(!0===this.receiveShadow)n.receiveShadow=!0;if(!1===this.visible)n.visible=!1;if(!1===this.frustumCulled)n.frustumCulled=!1;if(0!==this.renderOrder)n.renderOrder=this.renderOrder;if("{}"!==JSON.stringify(this.userData))n.userData=this.userData;n.layers=this.layers.mask;n.matrix=this.matrix.toArray();if(!1===this.matrixAutoUpdate)n.matrixAutoUpdate=!1;if(this.isInstancedMesh){n.type="InstancedMesh";n.count=this.count;n.instanceMatrix=this.instanceMatrix.toJSON();if(null!==this.instanceColor)n.instanceColor=this.instanceColor.toJSON()}function t(t,a){if(t[a.uuid]===void 0){t[a.uuid]=a.toJSON(e)}return a.uuid}if(this.isScene){if(this.background){if(this.background.isColor){n.background=this.background.toJSON()}else if(this.background.isTexture){n.background=this.background.toJSON(e).uuid}}if(this.environment&&this.environment.isTexture){n.environment=this.environment.toJSON(e).uuid}}else if(this.isMesh||this.isLine||this.isPoints){n.geometry=t(e.geometries,this.geometry);var v=this.geometry.parameters;if(v!==void 0&&v.shapes!==void 0){var y=v.shapes;if(Array.isArray(y)){for(var _=0,x=y.length,l;_<x;_++){l=y[_];t(e.shapes,l)}}else{t(e.shapes,y)}}}if(this.isSkinnedMesh){n.bindMode=this.bindMode;n.bindMatrix=this.bindMatrix.toArray();if(this.skeleton!==void 0){t(e.skeletons,this.skeleton);n.skeleton=this.skeleton.uuid}}if(this.material!==void 0){if(Array.isArray(this.material)){for(var o=[],s=0,d=this.material.length;s<d;s++){o.push(t(e.materials,this.material[s]))}n.material=o}else{n.material=t(e.materials,this.material)}}if(0<this.children.length){n.children=[];for(var b=0;b<this.children.length;b++){n.children.push(this.children[b].toJSON(e).object)}}if(0<this.animations.length){n.animations=[];for(var S=0,M;S<this.animations.length;S++){M=this.animations[S];n.animations.push(t(e.animations,M))}}if(r){var c=a(e.geometries),u=a(e.materials),p=a(e.textures),m=a(e.images),g=a(e.shapes),f=a(e.skeletons),h=a(e.animations);if(0<c.length)i.geometries=c;if(0<u.length)i.materials=u;if(0<p.length)i.textures=p;if(0<m.length)i.images=m;if(0<g.length)i.shapes=g;if(0<f.length)i.skeletons=f;if(0<h.length)i.animations=h}i.object=n;return i;function a(e){var t=[];for(var a in e){var r=e[a];delete r.metadata;t.push(r)}return t}}},{key:"clone",value:function clone(e){return new this.constructor().copy(this,e)}},{key:"copy",value:function copy(e){var t=1<arguments.length&&arguments[1]!==void 0?arguments[1]:!0;this.name=e.name;this.up.copy(e.up);this.position.copy(e.position);this.rotation.order=e.rotation.order;this.quaternion.copy(e.quaternion);this.scale.copy(e.scale);this.matrix.copy(e.matrix);this.matrixWorld.copy(e.matrixWorld);this.matrixAutoUpdate=e.matrixAutoUpdate;this.matrixWorldNeedsUpdate=e.matrixWorldNeedsUpdate;this.layers.mask=e.layers.mask;this.visible=e.visible;this.castShadow=e.castShadow;this.receiveShadow=e.receiveShadow;this.frustumCulled=e.frustumCulled;this.renderOrder=e.renderOrder;this.userData=JSON.parse(JSON.stringify(e.userData));if(!0===t){for(var a=0,r;a<e.children.length;a++){r=e.children[a];this.add(r.clone())}}return this}}]);return a}(ho);Ds.DefaultUp=new Po(0,1,0);Ds.DefaultMatrixAutoUpdate=!0;Ds.prototype.isObject3D=!0;var Is=new Po,zs=new Po,Ns=new Po,Os=new Po,Fs=new Po,Us=new Po,Bs=new Po,Hs=new Po,Gs=new Po,Vs=new Po,Ws=function(){function e(){var t=0<arguments.length&&arguments[0]!==void 0?arguments[0]:new Po,a=1<arguments.length&&arguments[1]!==void 0?arguments[1]:new Po,r=2<arguments.length&&arguments[2]!==void 0?arguments[2]:new Po;_classCallCheck2(this,e);this.a=t;this.b=a;this.c=r}_createClass2(e,[{key:"set",value:function set(e,t,a){this.a.copy(e);this.b.copy(t);this.c.copy(a);return this}},{key:"setFromPointsAndIndices",value:function setFromPointsAndIndices(e,t,a,r){this.a.copy(e[t]);this.b.copy(e[a]);this.c.copy(e[r]);return this}},{key:"setFromAttributeAndIndices",value:function setFromAttributeAndIndices(e,t,a,r){this.a.fromBufferAttribute(e,t);this.b.fromBufferAttribute(e,a);this.c.fromBufferAttribute(e,r);return this}},{key:"clone",value:function clone(){return new this.constructor().copy(this)}},{key:"copy",value:function copy(e){this.a.copy(e.a);this.b.copy(e.b);this.c.copy(e.c);return this}},{key:"getArea",value:function getArea(){Is.subVectors(this.c,this.b);zs.subVectors(this.a,this.b);return .5*Is.cross(zs).length()}},{key:"getMidpoint",value:function getMidpoint(e){return e.addVectors(this.a,this.b).add(this.c).multiplyScalar(1/3)}},{key:"getNormal",value:function getNormal(t){return e.getNormal(this.a,this.b,this.c,t)}},{key:"getPlane",value:function getPlane(e){return e.setFromCoplanarPoints(this.a,this.b,this.c)}},{key:"getBarycoord",value:function getBarycoord(t,a){return e.getBarycoord(t,this.a,this.b,this.c,a)}},{key:"getUV",value:function getUV(t,a,r,i,n){return e.getUV(t,this.a,this.b,this.c,a,r,i,n)}},{key:"containsPoint",value:function containsPoint(t){return e.containsPoint(t,this.a,this.b,this.c)}},{key:"isFrontFacing",value:function isFrontFacing(t){return e.isFrontFacing(this.a,this.b,this.c,t)}},{key:"intersectsBox",value:function intersectsBox(e){return e.intersectsTriangle(this)}},{key:"closestPointToPoint",value:function closestPointToPoint(e,t){var r=this.a,a=this.b,i=this.c,n,o;Fs.subVectors(a,r);Us.subVectors(i,r);Hs.subVectors(e,r);var s=Fs.dot(Hs),l=Us.dot(Hs);if(0>=s&&0>=l){return t.copy(r)}Gs.subVectors(e,a);var d=Fs.dot(Gs),c=Us.dot(Gs);if(0<=d&&c<=d){return t.copy(a)}var u=s*c-d*l;if(0>=u&&0<=s&&0>=d){n=s/(s-d);return t.copy(r).addScaledVector(Fs,n)}Vs.subVectors(e,i);var p=Fs.dot(Vs),m=Us.dot(Vs);if(0<=m&&p<=m){return t.copy(i)}var g=p*l-s*m;if(0>=g&&0<=l&&0>=m){o=l/(l-m);return t.copy(r).addScaledVector(Us,o)}var f=d*m-p*c;if(0>=f&&0<=c-d&&0<=p-m){Bs.subVectors(i,a);o=(c-d)/(c-d+(p-m));return t.copy(a).addScaledVector(Bs,o)}var h=1/(f+g+u);n=g*h;o=u*h;return t.copy(r).addScaledVector(Fs,n).addScaledVector(Us,o)}},{key:"equals",value:function(e){return e.a.equals(this.a)&&e.b.equals(this.b)&&e.c.equals(this.c)}}],[{key:"getNormal",value:function getNormal(e,t,a,r){r.subVectors(a,t);Is.subVectors(e,t);r.cross(Is);var i=r.lengthSq();if(0<i){return r.multiplyScalar(1/Math.sqrt(i))}return r.set(0,0,0)}},{key:"getBarycoord",value:function getBarycoord(e,t,a,r,i){Is.subVectors(r,t);zs.subVectors(a,t);Ns.subVectors(e,t);var n=Is.dot(Is),o=Is.dot(zs),s=Is.dot(Ns),l=zs.dot(zs),d=zs.dot(Ns),c=n*l-o*o;if(0===c){return i.set(-2,-1,-1)}var p=1/c,m=(l*s-o*d)*p,u=(n*d-o*s)*p;return i.set(1-m-u,u,m)}},{key:"containsPoint",value:function containsPoint(e,t,a,r){this.getBarycoord(e,t,a,r,Os);return 0<=Os.x&&0<=Os.y&&1>=Os.x+Os.y}},{key:"getUV",value:function getUV(e,t,a,r,i,n,o,s){this.getBarycoord(e,t,a,r,Os);s.set(0,0);s.addScaledVector(i,Os.x);s.addScaledVector(n,Os.y);s.addScaledVector(o,Os.z);return s}},{key:"isFrontFacing",value:function isFrontFacing(e,t,a,r){Is.subVectors(a,t);zs.subVectors(e,t);return 0>Is.cross(zs).dot(r)?!0:!1}}]);return e}(),js=0,qs=function(t){_inherits(a,t);var r=_createSuper(a);function a(){var t;_classCallCheck2(this,a);t=r.call(this);Object.defineProperty(_assertThisInitialized(t),"id",{value:js++});t.uuid=e();t.name="";t.type="Material";t.fog=!0;t.blending=kr;t.side=Mr;t.vertexColors=!1;t.opacity=1;t.format=Gi;t.transparent=!1;t.blendSrc=Gr;t.blendDst=Vr;t.blendEquation=Dr;t.blendSrcAlpha=null;t.blendDstAlpha=null;t.blendEquationAlpha=null;t.depthFunc=Kr;t.depthTest=!0;t.depthWrite=!0;t.stencilWriteMask=255;t.stencilFunc=po;t.stencilRef=0;t.stencilFuncMask=255;t.stencilFail=uo;t.stencilZFail=uo;t.stencilZPass=uo;t.stencilWrite=!1;t.clippingPlanes=null;t.clipIntersection=!1;t.clipShadows=!1;t.shadowSide=null;t.colorWrite=!0;t.precision=null;t.polygonOffset=!1;t.polygonOffsetFactor=0;t.polygonOffsetUnits=0;t.dithering=!1;t.alphaToCoverage=!1;t.premultipliedAlpha=!1;t.visible=!0;t.toneMapped=!0;t.userData={};t.version=0;t._alphaTest=0;return t}_createClass2(a,[{key:"onBuild",value:function onBuild(){}},{key:"onBeforeRender",value:function onBeforeRender(){}},{key:"onBeforeCompile",value:function onBeforeCompile(){}},{key:"customProgramCacheKey",value:function customProgramCacheKey(){return this.onBeforeCompile.toString()}},{key:"setValues",value:function setValues(e){if(e===void 0)return;for(var t in e){var a=e[t];if(a===void 0){console.warn("THREE.Material: '"+t+"' parameter is undefined.");continue}if("shading"==t){console.warn("THREE."+this.type+": .shading has been removed. Use the boolean .flatShading instead.");this.flatShading=a===wr?!0:!1;continue}var r=this[t];if(r===void 0){console.warn("THREE."+this.type+": '"+t+"' is not a property of this material.");continue}if(r&&r.isColor){r.set(a)}else if(r&&r.isVector3&&a&&a.isVector3){r.copy(a)}else{this[t]=a}}}},{key:"toJSON",value:function toJSON(e){var a=e===void 0||"string"==typeof e;if(a){e={textures:{},images:{}}}var r={metadata:{version:4.5,type:"Material",generator:"Material.toJSON"},uuid:this.uuid,type:this.type};if(""!==this.name)r.name=this.name;if(this.color&&this.color.isColor)r.color=this.color.getHex();if(this.roughness!==void 0)r.roughness=this.roughness;if(this.metalness!==void 0)r.metalness=this.metalness;if(this.sheen!==void 0)r.sheen=this.sheen;if(this.sheenColor&&this.sheenColor.isColor)r.sheenColor=this.sheenColor.getHex();if(this.sheenRoughness!==void 0)r.sheenRoughness=this.sheenRoughness;if(this.emissive&&this.emissive.isColor)r.emissive=this.emissive.getHex();if(this.emissiveIntensity&&1!==this.emissiveIntensity)r.emissiveIntensity=this.emissiveIntensity;if(this.specular&&this.specular.isColor)r.specular=this.specular.getHex();if(this.specularIntensity!==void 0)r.specularIntensity=this.specularIntensity;if(this.specularColor&&this.specularColor.isColor)r.specularColor=this.specularColor.getHex();if(this.shininess!==void 0)r.shininess=this.shininess;if(this.clearcoat!==void 0)r.clearcoat=this.clearcoat;if(this.clearcoatRoughness!==void 0)r.clearcoatRoughness=this.clearcoatRoughness;if(this.clearcoatMap&&this.clearcoatMap.isTexture){r.clearcoatMap=this.clearcoatMap.toJSON(e).uuid}if(this.clearcoatRoughnessMap&&this.clearcoatRoughnessMap.isTexture){r.clearcoatRoughnessMap=this.clearcoatRoughnessMap.toJSON(e).uuid}if(this.clearcoatNormalMap&&this.clearcoatNormalMap.isTexture){r.clearcoatNormalMap=this.clearcoatNormalMap.toJSON(e).uuid;r.clearcoatNormalScale=this.clearcoatNormalScale.toArray()}if(this.map&&this.map.isTexture)r.map=this.map.toJSON(e).uuid;if(this.matcap&&this.matcap.isTexture)r.matcap=this.matcap.toJSON(e).uuid;if(this.alphaMap&&this.alphaMap.isTexture)r.alphaMap=this.alphaMap.toJSON(e).uuid;if(this.lightMap&&this.lightMap.isTexture){r.lightMap=this.lightMap.toJSON(e).uuid;r.lightMapIntensity=this.lightMapIntensity}if(this.aoMap&&this.aoMap.isTexture){r.aoMap=this.aoMap.toJSON(e).uuid;r.aoMapIntensity=this.aoMapIntensity}if(this.bumpMap&&this.bumpMap.isTexture){r.bumpMap=this.bumpMap.toJSON(e).uuid;r.bumpScale=this.bumpScale}if(this.normalMap&&this.normalMap.isTexture){r.normalMap=this.normalMap.toJSON(e).uuid;r.normalMapType=this.normalMapType;r.normalScale=this.normalScale.toArray()}if(this.displacementMap&&this.displacementMap.isTexture){r.displacementMap=this.displacementMap.toJSON(e).uuid;r.displacementScale=this.displacementScale;r.displacementBias=this.displacementBias}if(this.roughnessMap&&this.roughnessMap.isTexture)r.roughnessMap=this.roughnessMap.toJSON(e).uuid;if(this.metalnessMap&&this.metalnessMap.isTexture)r.metalnessMap=this.metalnessMap.toJSON(e).uuid;if(this.emissiveMap&&this.emissiveMap.isTexture)r.emissiveMap=this.emissiveMap.toJSON(e).uuid;if(this.specularMap&&this.specularMap.isTexture)r.specularMap=this.specularMap.toJSON(e).uuid;if(this.specularIntensityMap&&this.specularIntensityMap.isTexture)r.specularIntensityMap=this.specularIntensityMap.toJSON(e).uuid;if(this.specularColorMap&&this.specularColorMap.isTexture)r.specularColorMap=this.specularColorMap.toJSON(e).uuid;if(this.envMap&&this.envMap.isTexture){r.envMap=this.envMap.toJSON(e).uuid;if(this.combine!==void 0)r.combine=this.combine}if(this.envMapIntensity!==void 0)r.envMapIntensity=this.envMapIntensity;if(this.reflectivity!==void 0)r.reflectivity=this.reflectivity;if(this.refractionRatio!==void 0)r.refractionRatio=this.refractionRatio;if(this.gradientMap&&this.gradientMap.isTexture){r.gradientMap=this.gradientMap.toJSON(e).uuid}if(this.transmission!==void 0)r.transmission=this.transmission;if(this.transmissionMap&&this.transmissionMap.isTexture)r.transmissionMap=this.transmissionMap.toJSON(e).uuid;if(this.thickness!==void 0)r.thickness=this.thickness;if(this.thicknessMap&&this.thicknessMap.isTexture)r.thicknessMap=this.thicknessMap.toJSON(e).uuid;if(this.attenuationDistance!==void 0)r.attenuationDistance=this.attenuationDistance;if(this.attenuationColor!==void 0)r.attenuationColor=this.attenuationColor.getHex();if(this.size!==void 0)r.size=this.size;if(null!==this.shadowSide)r.shadowSide=this.shadowSide;if(this.sizeAttenuation!==void 0)r.sizeAttenuation=this.sizeAttenuation;if(this.blending!==kr)r.blending=this.blending;if(this.side!==Mr)r.side=this.side;if(this.vertexColors)r.vertexColors=!0;if(1>this.opacity)r.opacity=this.opacity;if(this.format!==Gi)r.format=this.format;if(!0===this.transparent)r.transparent=this.transparent;r.depthFunc=this.depthFunc;r.depthTest=this.depthTest;r.depthWrite=this.depthWrite;r.colorWrite=this.colorWrite;r.stencilWrite=this.stencilWrite;r.stencilWriteMask=this.stencilWriteMask;r.stencilFunc=this.stencilFunc;r.stencilRef=this.stencilRef;r.stencilFuncMask=this.stencilFuncMask;r.stencilFail=this.stencilFail;r.stencilZFail=this.stencilZFail;r.stencilZPass=this.stencilZPass;if(this.rotation&&0!==this.rotation)r.rotation=this.rotation;if(!0===this.polygonOffset)r.polygonOffset=!0;if(0!==this.polygonOffsetFactor)r.polygonOffsetFactor=this.polygonOffsetFactor;if(0!==this.polygonOffsetUnits)r.polygonOffsetUnits=this.polygonOffsetUnits;if(this.linewidth&&1!==this.linewidth)r.linewidth=this.linewidth;if(this.dashSize!==void 0)r.dashSize=this.dashSize;if(this.gapSize!==void 0)r.gapSize=this.gapSize;if(this.scale!==void 0)r.scale=this.scale;if(!0===this.dithering)r.dithering=!0;if(0<this.alphaTest)r.alphaTest=this.alphaTest;if(!0===this.alphaToCoverage)r.alphaToCoverage=this.alphaToCoverage;if(!0===this.premultipliedAlpha)r.premultipliedAlpha=this.premultipliedAlpha;if(!0===this.wireframe)r.wireframe=this.wireframe;if(1<this.wireframeLinewidth)r.wireframeLinewidth=this.wireframeLinewidth;if("round"!==this.wireframeLinecap)r.wireframeLinecap=this.wireframeLinecap;if("round"!==this.wireframeLinejoin)r.wireframeLinejoin=this.wireframeLinejoin;if(!0===this.flatShading)r.flatShading=this.flatShading;if(!1===this.visible)r.visible=!1;if(!1===this.toneMapped)r.toneMapped=!1;if("{}"!==JSON.stringify(this.userData))r.userData=this.userData;function t(e){var t=[];for(var a in e){var r=e[a];delete r.metadata;t.push(r)}return t}if(a){var i=t(e.textures),n=t(e.images);if(0<i.length)r.textures=i;if(0<n.length)r.images=n}return r}},{key:"clone",value:function clone(){return new this.constructor().copy(this)}},{key:"copy",value:function copy(e){this.name=e.name;this.fog=e.fog;this.blending=e.blending;this.side=e.side;this.vertexColors=e.vertexColors;this.opacity=e.opacity;this.format=e.format;this.transparent=e.transparent;this.blendSrc=e.blendSrc;this.blendDst=e.blendDst;this.blendEquation=e.blendEquation;this.blendSrcAlpha=e.blendSrcAlpha;this.blendDstAlpha=e.blendDstAlpha;this.blendEquationAlpha=e.blendEquationAlpha;this.depthFunc=e.depthFunc;this.depthTest=e.depthTest;this.depthWrite=e.depthWrite;this.stencilWriteMask=e.stencilWriteMask;this.stencilFunc=e.stencilFunc;this.stencilRef=e.stencilRef;this.stencilFuncMask=e.stencilFuncMask;this.stencilFail=e.stencilFail;this.stencilZFail=e.stencilZFail;this.stencilZPass=e.stencilZPass;this.stencilWrite=e.stencilWrite;var t=e.clippingPlanes,a=null;if(null!==t){var r=t.length;a=Array(r);for(var i=0;i!==r;++i){a[i]=t[i].clone()}}this.clippingPlanes=a;this.clipIntersection=e.clipIntersection;this.clipShadows=e.clipShadows;this.shadowSide=e.shadowSide;this.colorWrite=e.colorWrite;this.precision=e.precision;this.polygonOffset=e.polygonOffset;this.polygonOffsetFactor=e.polygonOffsetFactor;this.polygonOffsetUnits=e.polygonOffsetUnits;this.dithering=e.dithering;this.alphaTest=e.alphaTest;this.alphaToCoverage=e.alphaToCoverage;this.premultipliedAlpha=e.premultipliedAlpha;this.visible=e.visible;this.toneMapped=e.toneMapped;this.userData=JSON.parse(JSON.stringify(e.userData));return this}},{key:"dispose",value:function dispose(){this.dispatchEvent({type:"dispose"})}},{key:"alphaTest",get:function get(){return this._alphaTest},set:function set(e){if(0<this._alphaTest!=0<e){this.version++}this._alphaTest=e}},{key:"needsUpdate",set:function set(e){if(!0===e)this.version++}}]);return a}(ho);qs.prototype.isMaterial=!0;var Xs={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074},Ys={h:0,s:0,l:0},Zs={h:0,s:0,l:0};function g(e,a,r){if(0>r)r+=1;if(1<r)r-=1;if(r<1/6)return e+6*(a-e)*r;if(r<1/2)return a;if(r<2/3)return e+6*(a-e)*(2/3-r);return e}function f(e){return .04045>e?.0773993808*e:Math.pow(.9478672986*e+.0521327014,2.4)}function h(e){return .0031308>e?12.92*e:1.055*Math.pow(e,.41666)-.055}var Js=function(){function e(t,a,r){_classCallCheck2(this,e);if(a===void 0&&r===void 0){return this.set(t)}return this.setRGB(t,a,r)}_createClass2(e,[{key:"set",value:function set(e){if(e&&e.isColor){this.copy(e)}else if("number"==typeof e){this.setHex(e)}else if("string"==typeof e){this.setStyle(e)}return this}},{key:"setScalar",value:function setScalar(e){this.r=e;this.g=e;this.b=e;return this}},{key:"setHex",value:function setHex(e){e=Math.floor(e);this.r=(255&e>>16)/255;this.g=(255&e>>8)/255;this.b=(255&e)/255;return this}},{key:"setRGB",value:function setRGB(e,t,a){this.r=e;this.g=t;this.b=a;return this}},{key:"setHSL",value:function setHSL(e,r,i){e=a(e,1);r=t(r,0,1);i=t(i,0,1);if(0===r){this.r=this.g=this.b=i}else{var n=.5>=i?i*(1+r):i+r-i*r,o=2*i-n;this.r=g(o,n,e+1/3);this.g=g(o,n,e);this.b=g(o,n,e-1/3)}return this}},{key:"setStyle",value:function setStyle(e){function t(t){if(t===void 0)return;if(1>parseFloat(t)){console.warn("THREE.Color: Alpha component of "+e+" will be ignored.")}}var a;if(a=/^((?:rgb|hsl)a?)\(([^\)]*)\)/.exec(e)){var r,i=a[1],n=a[2];switch(i){case"rgb":case"rgba":if(r=/^\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(n)){this.r=Math.min(255,parseInt(r[1],10))/255;this.g=Math.min(255,parseInt(r[2],10))/255;this.b=Math.min(255,parseInt(r[3],10))/255;t(r[4]);return this}if(r=/^\s*(\d+)\%\s*,\s*(\d+)\%\s*,\s*(\d+)\%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(n)){this.r=Math.min(100,parseInt(r[1],10))/100;this.g=Math.min(100,parseInt(r[2],10))/100;this.b=Math.min(100,parseInt(r[3],10))/100;t(r[4]);return this}break;case"hsl":case"hsla":if(r=/^\s*(\d*\.?\d+)\s*,\s*(\d+)\%\s*,\s*(\d+)\%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(n)){var o=parseFloat(r[1])/360,d=parseInt(r[2],10)/100,s=parseInt(r[3],10)/100;t(r[4]);return this.setHSL(o,d,s)}break;}}else if(a=/^\#([A-Fa-f\d]+)$/.exec(e)){var l=a[1],c=l.length;if(3===c){this.r=parseInt(l.charAt(0)+l.charAt(0),16)/255;this.g=parseInt(l.charAt(1)+l.charAt(1),16)/255;this.b=parseInt(l.charAt(2)+l.charAt(2),16)/255;return this}else if(6===c){this.r=parseInt(l.charAt(0)+l.charAt(1),16)/255;this.g=parseInt(l.charAt(2)+l.charAt(3),16)/255;this.b=parseInt(l.charAt(4)+l.charAt(5),16)/255;return this}}if(e&&0<e.length){return this.setColorName(e)}return this}},{key:"setColorName",value:function setColorName(e){var t=Xs[e.toLowerCase()];if(t!==void 0){this.setHex(t)}else{console.warn("THREE.Color: Unknown color "+e)}return this}},{key:"clone",value:function clone(){return new this.constructor(this.r,this.g,this.b)}},{key:"copy",value:function copy(e){this.r=e.r;this.g=e.g;this.b=e.b;return this}},{key:"copyGammaToLinear",value:function copyGammaToLinear(e){var t=1<arguments.length&&arguments[1]!==void 0?arguments[1]:2;this.r=Math.pow(e.r,t);this.g=Math.pow(e.g,t);this.b=Math.pow(e.b,t);return this}},{key:"copyLinearToGamma",value:function copyLinearToGamma(e){var t=1<arguments.length&&arguments[1]!==void 0?arguments[1]:2,a=0<t?1/t:1;this.r=Math.pow(e.r,a);this.g=Math.pow(e.g,a);this.b=Math.pow(e.b,a);return this}},{key:"convertGammaToLinear",value:function convertGammaToLinear(e){this.copyGammaToLinear(this,e);return this}},{key:"convertLinearToGamma",value:function convertLinearToGamma(e){this.copyLinearToGamma(this,e);return this}},{key:"copySRGBToLinear",value:function copySRGBToLinear(e){this.r=f(e.r);this.g=f(e.g);this.b=f(e.b);return this}},{key:"copyLinearToSRGB",value:function copyLinearToSRGB(e){this.r=h(e.r);this.g=h(e.g);this.b=h(e.b);return this}},{key:"convertSRGBToLinear",value:function convertSRGBToLinear(){this.copySRGBToLinear(this);return this}},{key:"convertLinearToSRGB",value:function convertLinearToSRGB(){this.copyLinearToSRGB(this);return this}},{key:"getHex",value:function getHex(){return 255*this.r<<16^255*this.g<<8^255*this.b<<0}},{key:"getHexString",value:function getHexString(){return("000000"+this.getHex().toString(16)).slice(-6)}},{key:"getHSL",value:function getHSL(e){var t=this.r,a=this.g,r=this.b,i=Math.max(t,a,r),n=Math.min(t,a,r),o,s,l=(n+i)/2;if(n===i){o=0;s=0}else{var d=i-n;s=.5>=l?d/(i+n):d/(2-i-n);switch(i){case t:o=(a-r)/d+(a<r?6:0);break;case a:o=(r-t)/d+2;break;case r:o=(t-a)/d+4;break;}o/=6}e.h=o;e.s=s;e.l=l;return e}},{key:"getStyle",value:function getStyle(){return"rgb("+(0|255*this.r)+","+(0|255*this.g)+","+(0|255*this.b)+")"}},{key:"offsetHSL",value:function offsetHSL(e,t,a){this.getHSL(Ys);Ys.h+=e;Ys.s+=t;Ys.l+=a;this.setHSL(Ys.h,Ys.s,Ys.l);return this}},{key:"add",value:function add(e){this.r+=e.r;this.g+=e.g;this.b+=e.b;return this}},{key:"addColors",value:function addColors(e,t){this.r=e.r+t.r;this.g=e.g+t.g;this.b=e.b+t.b;return this}},{key:"addScalar",value:function addScalar(e){this.r+=e;this.g+=e;this.b+=e;return this}},{key:"sub",value:function sub(e){this.r=Math.max(0,this.r-e.r);this.g=Math.max(0,this.g-e.g);this.b=Math.max(0,this.b-e.b);return this}},{key:"multiply",value:function multiply(e){this.r*=e.r;this.g*=e.g;this.b*=e.b;return this}},{key:"multiplyScalar",value:function multiplyScalar(e){this.r*=e;this.g*=e;this.b*=e;return this}},{key:"lerp",value:function(e,t){this.r+=(e.r-this.r)*t;this.g+=(e.g-this.g)*t;this.b+=(e.b-this.b)*t;return this}},{key:"lerpColors",value:function lerpColors(e,t,a){this.r=e.r+(t.r-e.r)*a;this.g=e.g+(t.g-e.g)*a;this.b=e.b+(t.b-e.b)*a;return this}},{key:"lerpHSL",value:function lerpHSL(e,t){this.getHSL(Ys);e.getHSL(Zs);var a=r(Ys.h,Zs.h,t),i=r(Ys.s,Zs.s,t),n=r(Ys.l,Zs.l,t);this.setHSL(a,i,n);return this}},{key:"equals",value:function(e){return e.r===this.r&&e.g===this.g&&e.b===this.b}},{key:"fromArray",value:function fromArray(e){var t=1<arguments.length&&arguments[1]!==void 0?arguments[1]:0;this.r=e[t];this.g=e[t+1];this.b=e[t+2];return this}},{key:"toArray",value:function toArray(){var e=0<arguments.length&&arguments[0]!==void 0?arguments[0]:[],t=1<arguments.length&&arguments[1]!==void 0?arguments[1]:0;e[t]=this.r;e[t+1]=this.g;e[t+2]=this.b;return e}},{key:"fromBufferAttribute",value:function fromBufferAttribute(e,t){this.r=e.getX(t);this.g=e.getY(t);this.b=e.getZ(t);if(!0===e.normalized){this.r/=255;this.g/=255;this.b/=255}return this}},{key:"toJSON",value:function toJSON(){return this.getHex()}}]);return e}();Js.NAMES=Xs;Js.prototype.isColor=!0;Js.prototype.r=1;Js.prototype.g=1;Js.prototype.b=1;var Qs=function(e){_inherits(t,e);var a=_createSuper(t);function t(e){var r;_classCallCheck2(this,t);r=a.call(this);r.type="MeshBasicMaterial";r.color=new Js(16777215);r.map=null;r.lightMap=null;r.lightMapIntensity=1;r.aoMap=null;r.aoMapIntensity=1;r.specularMap=null;r.alphaMap=null;r.envMap=null;r.combine=ri;r.reflectivity=1;r.refractionRatio=.98;r.wireframe=!1;r.wireframeLinewidth=1;r.wireframeLinecap="round";r.wireframeLinejoin="round";r.setValues(e);return r}_createClass2(t,[{key:"copy",value:function copy(e){_get(_getPrototypeOf(t.prototype),"copy",this).call(this,e);this.color.copy(e.color);this.map=e.map;this.lightMap=e.lightMap;this.lightMapIntensity=e.lightMapIntensity;this.aoMap=e.aoMap;this.aoMapIntensity=e.aoMapIntensity;this.specularMap=e.specularMap;this.alphaMap=e.alphaMap;this.envMap=e.envMap;this.combine=e.combine;this.reflectivity=e.reflectivity;this.refractionRatio=e.refractionRatio;this.wireframe=e.wireframe;this.wireframeLinewidth=e.wireframeLinewidth;this.wireframeLinecap=e.wireframeLinecap;this.wireframeLinejoin=e.wireframeLinejoin;return this}}]);return t}(qs);Qs.prototype.isMeshBasicMaterial=!0;var Ks=new Po,$s=new bo,el=function(){function e(t,a,r){_classCallCheck2(this,e);if(Array.isArray(t)){throw new TypeError("THREE.BufferAttribute: array should be a Typed Array.")}this.name="";this.array=t;this.itemSize=a;this.count=t!==void 0?t.length/a:0;this.normalized=!0===r;this.usage=mo;this.updateRange={offset:0,count:-1};this.version=0}_createClass2(e,[{key:"onUploadCallback",value:function onUploadCallback(){}},{key:"setUsage",value:function setUsage(e){this.usage=e;return this}},{key:"copy",value:function copy(e){this.name=e.name;this.array=new e.array.constructor(e.array);this.itemSize=e.itemSize;this.count=e.count;this.normalized=e.normalized;this.usage=e.usage;return this}},{key:"copyAt",value:function copyAt(e,t,a){e*=this.itemSize;a*=t.itemSize;for(var r=0,i=this.itemSize;r<i;r++){this.array[e+r]=t.array[a+r]}return this}},{key:"copyArray",value:function(e){this.array.set(e);return this}},{key:"copyColorsArray",value:function copyColorsArray(e){for(var t=this.array,a=0,r=0,i=e.length,n;r<i;r++){n=e[r];if(n===void 0){console.warn("THREE.BufferAttribute.copyColorsArray(): color is undefined",r);n=new Js}t[a++]=n.r;t[a++]=n.g;t[a++]=n.b}return this}},{key:"copyVector2sArray",value:function copyVector2sArray(e){for(var t=this.array,a=0,r=0,i=e.length,n;r<i;r++){n=e[r];if(n===void 0){console.warn("THREE.BufferAttribute.copyVector2sArray(): vector is undefined",r);n=new bo}t[a++]=n.x;t[a++]=n.y}return this}},{key:"copyVector3sArray",value:function copyVector3sArray(e){for(var t=this.array,a=0,r=0,i=e.length,n;r<i;r++){n=e[r];if(n===void 0){console.warn("THREE.BufferAttribute.copyVector3sArray(): vector is undefined",r);n=new Po}t[a++]=n.x;t[a++]=n.y;t[a++]=n.z}return this}},{key:"copyVector4sArray",value:function copyVector4sArray(e){for(var t=this.array,a=0,r=0,i=e.length,n;r<i;r++){n=e[r];if(n===void 0){console.warn("THREE.BufferAttribute.copyVector4sArray(): vector is undefined",r);n=new Ao}t[a++]=n.x;t[a++]=n.y;t[a++]=n.z;t[a++]=n.w}return this}},{key:"applyMatrix3",value:function applyMatrix3(e){if(2===this.itemSize){for(var t=0,a=this.count;t<a;t++){$s.fromBufferAttribute(this,t);$s.applyMatrix3(e);this.setXY(t,$s.x,$s.y)}}else if(3===this.itemSize){for(var r=0,i=this.count;r<i;r++){Ks.fromBufferAttribute(this,r);Ks.applyMatrix3(e);this.setXYZ(r,Ks.x,Ks.y,Ks.z)}}return this}},{key:"applyMatrix4",value:function applyMatrix4(e){for(var t=0,a=this.count;t<a;t++){Ks.x=this.getX(t);Ks.y=this.getY(t);Ks.z=this.getZ(t);Ks.applyMatrix4(e);this.setXYZ(t,Ks.x,Ks.y,Ks.z)}return this}},{key:"applyNormalMatrix",value:function applyNormalMatrix(e){for(var t=0,a=this.count;t<a;t++){Ks.x=this.getX(t);Ks.y=this.getY(t);Ks.z=this.getZ(t);Ks.applyNormalMatrix(e);this.setXYZ(t,Ks.x,Ks.y,Ks.z)}return this}},{key:"transformDirection",value:function transformDirection(e){for(var t=0,a=this.count;t<a;t++){Ks.x=this.getX(t);Ks.y=this.getY(t);Ks.z=this.getZ(t);Ks.transformDirection(e);this.setXYZ(t,Ks.x,Ks.y,Ks.z)}return this}},{key:"set",value:function set(e){var t=1<arguments.length&&arguments[1]!==void 0?arguments[1]:0;this.array.set(e,t);return this}},{key:"getX",value:function getX(e){return this.array[e*this.itemSize]}},{key:"setX",value:function setX(e,t){this.array[e*this.itemSize]=t;return this}},{key:"getY",value:function getY(e){return this.array[e*this.itemSize+1]}},{key:"setY",value:function setY(e,t){this.array[e*this.itemSize+1]=t;return this}},{key:"getZ",value:function getZ(e){return this.array[e*this.itemSize+2]}},{key:"setZ",value:function setZ(e,t){this.array[e*this.itemSize+2]=t;return this}},{key:"getW",value:function getW(e){return this.array[e*this.itemSize+3]}},{key:"setW",value:function setW(e,t){this.array[e*this.itemSize+3]=t;return this}},{key:"setXY",value:function setXY(e,t,a){e*=this.itemSize;this.array[e+0]=t;this.array[e+1]=a;return this}},{key:"setXYZ",value:function setXYZ(e,t,a,r){e*=this.itemSize;this.array[e+0]=t;this.array[e+1]=a;this.array[e+2]=r;return this}},{key:"setXYZW",value:function setXYZW(e,t,a,r,i){e*=this.itemSize;this.array[e+0]=t;this.array[e+1]=a;this.array[e+2]=r;this.array[e+3]=i;return this}},{key:"onUpload",value:function onUpload(e){this.onUploadCallback=e;return this}},{key:"clone",value:function clone(){return new this.constructor(this.array,this.itemSize).copy(this)}},{key:"toJSON",value:function toJSON(){var e={itemSize:this.itemSize,type:this.array.constructor.name,array:Array.prototype.slice.call(this.array),normalized:this.normalized};if(""!==this.name)e.name=this.name;if(this.usage!==mo)e.usage=this.usage;if(0!==this.updateRange.offset||-1!==this.updateRange.count)e.updateRange=this.updateRange;return e}},{key:"needsUpdate",set:function set(e){if(!0===e)this.version++}}]);return e}();el.prototype.isBufferAttribute=!0;var tl=function(e){_inherits(t,e);var a=_createSuper(t);function t(e,r,i){_classCallCheck2(this,t);return a.call(this,new Uint16Array(e),r,i)}return t}(el),al=function(e){_inherits(t,e);var a=_createSuper(t);function t(e,r,i){_classCallCheck2(this,t);return a.call(this,new Uint32Array(e),r,i)}return t}(el),rl=function(e){_inherits(t,e);var a=_createSuper(t);function t(e,r,i){_classCallCheck2(this,t);return a.call(this,new Uint16Array(e),r,i)}return t}(el);rl.prototype.isFloat16BufferAttribute=!0;var il=function(e){_inherits(t,e);var a=_createSuper(t);function t(e,r,i){_classCallCheck2(this,t);return a.call(this,new Float32Array(e),r,i)}return t}(el),nl=0,ol=new ls,sl=new Ds,ll=new Po,dl=new zo,cl=new zo,ul=new Po,pl=function(t){_inherits(a,t);var r=_createSuper(a);function a(){var t;_classCallCheck2(this,a);t=r.call(this);Object.defineProperty(_assertThisInitialized(t),"id",{value:nl++});t.uuid=e();t.name="";t.type="BufferGeometry";t.index=null;t.attributes={};t.morphAttributes={};t.morphTargetsRelative=!1;t.groups=[];t.boundingBox=null;t.boundingSphere=null;t.drawRange={start:0,count:1/0};t.userData={};return t}_createClass2(a,[{key:"getIndex",value:function getIndex(){return this.index}},{key:"setIndex",value:function setIndex(e){if(Array.isArray(e)){this.index=new(65535<d(e)?al:tl)(e,1)}else{this.index=e}return this}},{key:"getAttribute",value:function getAttribute(e){return this.attributes[e]}},{key:"setAttribute",value:function setAttribute(e,t){this.attributes[e]=t;return this}},{key:"deleteAttribute",value:function deleteAttribute(e){delete this.attributes[e];return this}},{key:"hasAttribute",value:function hasAttribute(e){return this.attributes[e]!==void 0}},{key:"addGroup",value:function addGroup(e,t){var a=2<arguments.length&&arguments[2]!==void 0?arguments[2]:0;this.groups.push({start:e,count:t,materialIndex:a})}},{key:"clearGroups",value:function clearGroups(){this.groups=[]}},{key:"setDrawRange",value:function setDrawRange(e,t){this.drawRange.start=e;this.drawRange.count=t}},{key:"applyMatrix4",value:function applyMatrix4(e){var t=this.attributes.position;if(t!==void 0){t.applyMatrix4(e);t.needsUpdate=!0}var a=this.attributes.normal;if(a!==void 0){var i=new So().getNormalMatrix(e);a.applyNormalMatrix(i);a.needsUpdate=!0}var r=this.attributes.tangent;if(r!==void 0){r.transformDirection(e);r.needsUpdate=!0}if(null!==this.boundingBox){this.computeBoundingBox()}if(null!==this.boundingSphere){this.computeBoundingSphere()}return this}},{key:"applyQuaternion",value:function applyQuaternion(e){ol.makeRotationFromQuaternion(e);this.applyMatrix4(ol);return this}},{key:"rotateX",value:function rotateX(e){ol.makeRotationX(e);this.applyMatrix4(ol);return this}},{key:"rotateY",value:function rotateY(e){ol.makeRotationY(e);this.applyMatrix4(ol);return this}},{key:"rotateZ",value:function rotateZ(e){ol.makeRotationZ(e);this.applyMatrix4(ol);return this}},{key:"translate",value:function translate(e,t,a){ol.makeTranslation(e,t,a);this.applyMatrix4(ol);return this}},{key:"scale",value:function scale(e,t,a){ol.makeScale(e,t,a);this.applyMatrix4(ol);return this}},{key:"lookAt",value:function lookAt(e){sl.lookAt(e);sl.updateMatrix();this.applyMatrix4(sl.matrix);return this}},{key:"center",value:function center(){this.computeBoundingBox();this.boundingBox.getCenter(ll).negate();this.translate(ll.x,ll.y,ll.z);return this}},{key:"setFromPoints",value:function setFromPoints(e){for(var t=[],a=0,r=e.length,i;a<r;a++){i=e[a];t.push(i.x,i.y,i.z||0)}this.setAttribute("position",new il(t,3));return this}},{key:"computeBoundingBox",value:function computeBoundingBox(){if(null===this.boundingBox){this.boundingBox=new zo}var e=this.attributes.position,t=this.morphAttributes.position;if(e&&e.isGLBufferAttribute){console.error("THREE.BufferGeometry.computeBoundingBox(): GLBufferAttribute requires a manual bounding box. Alternatively set \"mesh.frustumCulled\" to \"false\".",this);this.boundingBox.set(new Po(-Infinity,-Infinity,-Infinity),new Po(+Infinity,+Infinity,+Infinity));return}if(e!==void 0){this.boundingBox.setFromBufferAttribute(e);if(t){for(var a=0,r=t.length,i;a<r;a++){i=t[a];dl.setFromBufferAttribute(i);if(this.morphTargetsRelative){ul.addVectors(this.boundingBox.min,dl.min);this.boundingBox.expandByPoint(ul);ul.addVectors(this.boundingBox.max,dl.max);this.boundingBox.expandByPoint(ul)}else{this.boundingBox.expandByPoint(dl.min);this.boundingBox.expandByPoint(dl.max)}}}}else{this.boundingBox.makeEmpty()}if(isNaN(this.boundingBox.min.x)||isNaN(this.boundingBox.min.y)||isNaN(this.boundingBox.min.z)){console.error("THREE.BufferGeometry.computeBoundingBox(): Computed min/max have NaN values. The \"position\" attribute is likely to have NaN values.",this)}}},{key:"computeBoundingSphere",value:function computeBoundingSphere(){if(null===this.boundingSphere){this.boundingSphere=new $o}var e=this.attributes.position,t=this.morphAttributes.position;if(e&&e.isGLBufferAttribute){console.error("THREE.BufferGeometry.computeBoundingSphere(): GLBufferAttribute requires a manual bounding sphere. Alternatively set \"mesh.frustumCulled\" to \"false\".",this);this.boundingSphere.set(new Po,1/0);return}if(e){var d=this.boundingSphere.center;dl.setFromBufferAttribute(e);if(t){for(var c=0,u=t.length,p;c<u;c++){p=t[c];cl.setFromBufferAttribute(p);if(this.morphTargetsRelative){ul.addVectors(dl.min,cl.min);dl.expandByPoint(ul);ul.addVectors(dl.max,cl.max);dl.expandByPoint(ul)}else{dl.expandByPoint(cl.min);dl.expandByPoint(cl.max)}}}dl.getCenter(d);for(var a=0,r=0,i=e.count;r<i;r++){ul.fromBufferAttribute(e,r);a=Math.max(a,d.distanceToSquared(ul))}if(t){for(var m=0,g=t.length;m<g;m++){for(var n=t[m],o=this.morphTargetsRelative,s=0,l=n.count;s<l;s++){ul.fromBufferAttribute(n,s);if(o){ll.fromBufferAttribute(e,s);ul.add(ll)}a=Math.max(a,d.distanceToSquared(ul))}}}this.boundingSphere.radius=Math.sqrt(a);if(isNaN(this.boundingSphere.radius)){console.error("THREE.BufferGeometry.computeBoundingSphere(): Computed radius is NaN. The \"position\" attribute is likely to have NaN values.",this)}}}},{key:"computeTangents",value:function computeTangents(){var a=this.index,r=this.attributes;if(null===a||r.position===void 0||r.normal===void 0||r.uv===void 0){console.error("THREE.BufferGeometry: .computeTangents() failed. Missing required attributes (index, position, normal or uv)");return}var i=a.array,o=r.position.array,s=r.normal.array,l=r.uv.array,d=o.length/3;if(r.tangent===void 0){this.setAttribute("tangent",new el(new Float32Array(4*d),4))}for(var c=r.tangent.array,u=[],p=[],m=0;m<d;m++){u[m]=new Po;p[m]=new Po}var g=new Po,f=new Po,h=new Po,v=new bo,y=new bo,_=new bo,x=new Po,S=new Po;function e(e,t,a){g.fromArray(o,3*e);f.fromArray(o,3*t);h.fromArray(o,3*a);v.fromArray(l,2*e);y.fromArray(l,2*t);_.fromArray(l,2*a);f.sub(g);h.sub(g);y.sub(v);_.sub(v);var i=1/(y.x*_.y-_.x*y.y);if(!isFinite(i))return;x.copy(f).multiplyScalar(_.y).addScaledVector(h,-y.y).multiplyScalar(i);S.copy(h).multiplyScalar(y.x).addScaledVector(f,-_.x).multiplyScalar(i);u[e].add(x);u[t].add(x);u[a].add(x);p[e].add(S);p[t].add(S);p[a].add(S)}var M=this.groups;if(0===M.length){M=[{start:0,count:i.length}]}for(var I=0,z=M.length;I<z;++I){for(var T=M[I],E=T.start,w=T.count,A=E;A<E+w;A+=3){e(i[A+0],i[A+1],i[A+2])}}var b=new Po,k=new Po,C=new Po,n=new Po;function t(e){C.fromArray(s,3*e);n.copy(C);var a=u[e];b.copy(a);b.sub(C.multiplyScalar(C.dot(a))).normalize();k.crossVectors(n,a);var t=k.dot(p[e]),r=0>t?-1:1;c[4*e]=b.x;c[4*e+1]=b.y;c[4*e+2]=b.z;c[4*e+3]=r}for(var N=0,O=M.length;N<O;++N){for(var L=M[N],R=L.start,P=L.count,D=R;D<R+P;D+=3){t(i[D+0]);t(i[D+1]);t(i[D+2])}}}},{key:"computeVertexNormals",value:function computeVertexNormals(){var e=this.index,t=this.getAttribute("position");if(t!==void 0){var m=this.getAttribute("normal");if(m===void 0){m=new el(new Float32Array(3*t.count),3);this.setAttribute("normal",m)}else{for(var g=0,f=m.count;g<f;g++){m.setXYZ(g,0,0,0)}}var a=new Po,r=new Po,i=new Po,n=new Po,o=new Po,s=new Po,l=new Po,d=new Po;if(e){for(var h=0,v=e.count;h<v;h+=3){var c=e.getX(h+0),u=e.getX(h+1),p=e.getX(h+2);a.fromBufferAttribute(t,c);r.fromBufferAttribute(t,u);i.fromBufferAttribute(t,p);l.subVectors(i,r);d.subVectors(a,r);l.cross(d);n.fromBufferAttribute(m,c);o.fromBufferAttribute(m,u);s.fromBufferAttribute(m,p);n.add(l);o.add(l);s.add(l);m.setXYZ(c,n.x,n.y,n.z);m.setXYZ(u,o.x,o.y,o.z);m.setXYZ(p,s.x,s.y,s.z)}}else{for(var y=0,_=t.count;y<_;y+=3){a.fromBufferAttribute(t,y+0);r.fromBufferAttribute(t,y+1);i.fromBufferAttribute(t,y+2);l.subVectors(i,r);d.subVectors(a,r);l.cross(d);m.setXYZ(y+0,l.x,l.y,l.z);m.setXYZ(y+1,l.x,l.y,l.z);m.setXYZ(y+2,l.x,l.y,l.z)}}this.normalizeNormals();m.needsUpdate=!0}}},{key:"merge",value:function merge(e,t){if(!(e&&e.isBufferGeometry)){console.error("THREE.BufferGeometry.merge(): geometry not an instance of THREE.BufferGeometry.",e);return}if(t===void 0){t=0;console.warn("THREE.BufferGeometry.merge(): Overwriting original geometry, starting at offset=0. Use BufferGeometryUtils.mergeBufferGeometries() for lossless merge.")}var a=this.attributes;for(var u in a){if(e.attributes[u]===void 0)continue;for(var r=a[u],i=r.array,n=e.attributes[u],o=n.array,s=n.itemSize*t,l=Math.min(o.length,i.length-s),d=0,c=s;d<l;d++,c++){i[c]=o[d]}}return this}},{key:"normalizeNormals",value:function normalizeNormals(){for(var e=this.attributes.normal,t=0,a=e.count;t<a;t++){ul.fromBufferAttribute(e,t);ul.normalize();e.setXYZ(t,ul.x,ul.y,ul.z)}}},{key:"toNonIndexed",value:function toNonIndexed(){function e(e,t){for(var a=e.array,r=e.itemSize,i=e.normalized,n=new a.constructor(t.length*r),o=0,s=0,d=0,c=t.length;d<c;d++){if(e.isInterleavedBufferAttribute){o=t[d]*e.data.stride+e.offset}else{o=t[d]*r}for(var l=0;l<r;l++){n[s++]=a[o++]}}return new el(n,r,i)}if(null===this.index){console.warn("THREE.BufferGeometry.toNonIndexed(): BufferGeometry is already non-indexed.");return this}var t=new a,r=this.index.array,i=this.attributes;for(var y in i){var n=i[y],o=e(n,r);t.setAttribute(y,o)}var s=this.morphAttributes;for(var _ in s){for(var d=[],c=s[_],u=0,p=c.length;u<p;u++){var m=c[u],g=e(m,r);d.push(g)}t.morphAttributes[_]=d}t.morphTargetsRelative=this.morphTargetsRelative;for(var f=this.groups,h=0,v=f.length,l;h<v;h++){l=f[h];t.addGroup(l.start,l.count,l.materialIndex)}return t}},{key:"toJSON",value:function toJSON(){var e={metadata:{version:4.5,type:"BufferGeometry",generator:"BufferGeometry.toJSON"},uuid:this.uuid,type:this.type};if(""!==this.name)e.name=this.name;if(0<Object.keys(this.userData).length)e.userData=this.userData;if(this.parameters!==void 0){var p=this.parameters;for(var m in p){if(p[m]!==void 0)e[m]=p[m]}return e}e.data={attributes:{}};var t=this.index;if(null!==t){e.data.index={type:t.array.constructor.name,array:Array.prototype.slice.call(t.array)}}var a=this.attributes;for(var g in a){var f=a[g];e.data.attributes[g]=f.toJSON(e.data)}var r={},i=!1;for(var h in this.morphAttributes){for(var n=this.morphAttributes[h],o=[],s=0,l=n.length,d;s<l;s++){d=n[s];o.push(d.toJSON(e.data))}if(0<o.length){r[h]=o;i=!0}}if(i){e.data.morphAttributes=r;e.data.morphTargetsRelative=this.morphTargetsRelative}var c=this.groups;if(0<c.length){e.data.groups=JSON.parse(JSON.stringify(c))}var u=this.boundingSphere;if(null!==u){e.data.boundingSphere={center:u.center.toArray(),radius:u.radius}}return e}},{key:"clone",value:function clone(){return new this.constructor().copy(this)}},{key:"copy",value:function copy(e){this.index=null;this.attributes={};this.morphAttributes={};this.groups=[];this.boundingBox=null;this.boundingSphere=null;var t={};this.name=e.name;var a=e.index;if(null!==a){this.setIndex(a.clone(t))}var r=e.attributes;for(var f in r){var h=r[f];this.setAttribute(f,h.clone(t))}var i=e.morphAttributes;for(var v in i){for(var n=[],o=i[v],s=0,d=o.length;s<d;s++){n.push(o[s].clone(t))}this.morphAttributes[v]=n}this.morphTargetsRelative=e.morphTargetsRelative;for(var l=e.groups,c=0,u=l.length,p;c<u;c++){p=l[c];this.addGroup(p.start,p.count,p.materialIndex)}var m=e.boundingBox;if(null!==m){this.boundingBox=m.clone()}var g=e.boundingSphere;if(null!==g){this.boundingSphere=g.clone()}this.drawRange.start=e.drawRange.start;this.drawRange.count=e.drawRange.count;this.userData=e.userData;if(e.parameters!==void 0)this.parameters=Object.assign({},e.parameters);return this}},{key:"dispose",value:function dispose(){this.dispatchEvent({type:"dispose"})}}]);return a}(ho);pl.prototype.isBufferGeometry=!0;var ml=new ls,gl=new ss,fl=new $o,hl=new Po,vl=new Po,yl=new Po,_l=new Po,xl=new Po,bl=new Po,Sl=new Po,Ml=new Po,Tl=new Po,El=new bo,wl=new bo,Al=new bo,kl=new Po,Cl=new Po,Ll=function(e){_inherits(t,e);var a=_createSuper(t);function t(){var e,r=0<arguments.length&&arguments[0]!==void 0?arguments[0]:new pl,i=1<arguments.length&&arguments[1]!==void 0?arguments[1]:new Qs;_classCallCheck2(this,t);e=a.call(this);e.type="Mesh";e.geometry=r;e.material=i;e.updateMorphTargets();return e}_createClass2(t,[{key:"copy",value:function copy(e){_get(_getPrototypeOf(t.prototype),"copy",this).call(this,e);if(e.morphTargetInfluences!==void 0){this.morphTargetInfluences=e.morphTargetInfluences.slice()}if(e.morphTargetDictionary!==void 0){this.morphTargetDictionary=Object.assign({},e.morphTargetDictionary)}this.material=e.material;this.geometry=e.geometry;return this}},{key:"updateMorphTargets",value:function updateMorphTargets(){var e=this.geometry;if(e.isBufferGeometry){var t=e.morphAttributes,a=Object.keys(t);if(0<a.length){var r=t[a[0]];if(r!==void 0){this.morphTargetInfluences=[];this.morphTargetDictionary={};for(var i=0,n=r.length,o;i<n;i++){o=r[i].name||i+"";this.morphTargetInfluences.push(0);this.morphTargetDictionary[o]=i}}}}else{var s=e.morphTargets;if(s!==void 0&&0<s.length){console.error("THREE.Mesh.updateMorphTargets() no longer supports THREE.Geometry. Use THREE.BufferGeometry instead.")}}}},{key:"raycast",value:function raycast(e,t){var r=this.geometry,i=this.material,n=this.matrixWorld;if(i===void 0)return;if(null===r.boundingSphere)r.computeBoundingSphere();fl.copy(r.boundingSphere);fl.applyMatrix4(n);if(!1===e.ray.intersectsSphere(fl))return;ml.copy(n).invert();gl.copy(e.ray).applyMatrix4(ml);if(null!==r.boundingBox){if(!1===gl.intersectsBox(r.boundingBox))return}var o;if(r.isBufferGeometry){var s=r.index,l=r.attributes.position,d=r.morphAttributes.position,u=r.morphTargetsRelative,p=r.attributes.uv,m=r.attributes.uv2,g=r.groups,f=r.drawRange;if(null!==s){if(Array.isArray(i)){for(var V=0,W=g.length;V<W;V++){for(var h=g[V],v=i[h.materialIndex],_=Math.max(h.start,f.start),x=Math.min(s.count,Math.min(h.start+h.count,f.start+f.count)),S=_;S<x;S+=3){var M=s.getX(S),a=s.getX(S+1),b=s.getX(S+2);o=y(this,v,e,gl,l,d,u,p,m,M,a,b);if(o){o.faceIndex=Math.floor(S/3);o.face.materialIndex=h.materialIndex;t.push(o)}}}}else{for(var c=Math.max(0,f.start),T=Math.min(s.count,f.start+f.count),E=c;E<T;E+=3){var w=s.getX(E),A=s.getX(E+1),k=s.getX(E+2);o=y(this,i,e,gl,l,d,u,p,m,w,A,k);if(o){o.faceIndex=Math.floor(E/3);t.push(o)}}}}else if(l!==void 0){if(Array.isArray(i)){for(var q=0,X=g.length;q<X;q++){for(var C=g[q],L=i[C.materialIndex],R=Math.max(C.start,f.start),P=Math.min(l.count,Math.min(C.start+C.count,f.start+f.count)),D=R;D<P;D+=3){var I=D,z=D+1,N=D+2;o=y(this,L,e,gl,l,d,u,p,m,I,z,N);if(o){o.faceIndex=Math.floor(D/3);o.face.materialIndex=C.materialIndex;t.push(o)}}}}else{for(var O=Math.max(0,f.start),F=Math.min(l.count,f.start+f.count),U=O;U<F;U+=3){var B=U,H=U+1,G=U+2;o=y(this,i,e,gl,l,d,u,p,m,B,H,G);if(o){o.faceIndex=Math.floor(U/3);t.push(o)}}}}}else if(r.isGeometry){console.error("THREE.Mesh.raycast() no longer supports THREE.Geometry. Use THREE.BufferGeometry instead.")}}}]);return t}(Ds);Ll.prototype.isMesh=!0;function v(e,t,a,r,i,n,o,s){var l;if(t.side===Tr){l=r.intersectTriangle(o,n,i,!0,s)}else{l=r.intersectTriangle(i,n,o,t.side!==Er,s)}if(null===l)return null;Cl.copy(s);Cl.applyMatrix4(e.matrixWorld);var d=a.ray.origin.distanceTo(Cl);if(d<a.near||d>a.far)return null;return{distance:d,point:Cl.clone(),object:e}}function y(e,t,r,i,n,o,s,l,d,u,a,p){hl.fromBufferAttribute(n,u);vl.fromBufferAttribute(n,a);yl.fromBufferAttribute(n,p);var c=e.morphTargetInfluences;if(o&&c){Sl.set(0,0,0);Ml.set(0,0,0);Tl.set(0,0,0);for(var h=0,y=o.length;h<y;h++){var m=c[h],g=o[h];if(0===m)continue;_l.fromBufferAttribute(g,u);xl.fromBufferAttribute(g,a);bl.fromBufferAttribute(g,p);if(s){Sl.addScaledVector(_l,m);Ml.addScaledVector(xl,m);Tl.addScaledVector(bl,m)}else{Sl.addScaledVector(_l.sub(hl),m);Ml.addScaledVector(xl.sub(vl),m);Tl.addScaledVector(bl.sub(yl),m)}}hl.add(Sl);vl.add(Ml);yl.add(Tl)}if(e.isSkinnedMesh){e.boneTransform(u,hl);e.boneTransform(a,vl);e.boneTransform(p,yl)}var f=v(e,t,r,i,hl,vl,yl,kl);if(f){if(l){El.fromBufferAttribute(l,u);wl.fromBufferAttribute(l,a);Al.fromBufferAttribute(l,p);f.uv=Ws.getUV(kl,hl,vl,yl,El,wl,Al,new bo)}if(d){El.fromBufferAttribute(d,u);wl.fromBufferAttribute(d,a);Al.fromBufferAttribute(d,p);f.uv2=Ws.getUV(kl,hl,vl,yl,El,wl,Al,new bo)}var _={a:u,b:a,c:p,normal:new Po,materialIndex:0};Ws.getNormal(hl,vl,yl,_.normal);f.face=_}return f}var Rl=function(e){_inherits(t,e);var a=_createSuper(t);function t(){var r,i=0<arguments.length&&arguments[0]!==void 0?arguments[0]:1,n=1<arguments.length&&arguments[1]!==void 0?arguments[1]:1,o=2<arguments.length&&arguments[2]!==void 0?arguments[2]:1,s=3<arguments.length&&arguments[3]!==void 0?arguments[3]:1,l=4<arguments.length&&arguments[4]!==void 0?arguments[4]:1,d=5<arguments.length&&arguments[5]!==void 0?arguments[5]:1;_classCallCheck2(this,t);r=a.call(this);r.type="BoxGeometry";r.parameters={width:i,height:n,depth:o,widthSegments:s,heightSegments:l,depthSegments:d};var p=_assertThisInitialized(r);s=Math.floor(s);l=Math.floor(l);d=Math.floor(d);var m=[],g=[],f=[],h=[],_=0,S=0;e("z","y","x",-1,-1,o,n,i,d,l,0);e("z","y","x",1,-1,o,n,-i,d,l,1);e("x","z","y",1,1,i,o,n,s,d,2);e("x","z","y",1,-1,i,o,-n,s,d,3);e("x","y","z",1,-1,i,n,o,s,l,4);e("x","y","z",-1,-1,i,n,-o,s,l,5);r.setIndex(m);r.setAttribute("position",new il(g,3));r.setAttribute("normal",new il(f,3));r.setAttribute("uv",new il(h,2));function e(e,t,r,i,n,o,s,l,u,v,M){for(var T=u+1,E=0,w=0,A=new Po,k=0,C;k<v+1;k++){C=k*(s/v)-s/2;for(var d=0,R;d<T;d++){R=d*(o/u)-o/2;A[e]=R*i;A[t]=C*n;A[r]=l/2;g.push(A.x,A.y,A.z);A[e]=0;A[t]=0;A[r]=0<l?1:-1;f.push(A.x,A.y,A.z);h.push(d/u);h.push(1-k/v);E+=1}}for(var x=0;x<v;x++){for(var P=0;P<u;P++){var L=_+P+T*x,a=_+P+T*(x+1),b=_+(P+1)+T*(x+1),c=_+(P+1)+T*x;m.push(L,a,c);m.push(a,b,c);w+=6}}p.addGroup(S,w,M);S+=w;_+=E}return r}_createClass2(t,null,[{key:"fromJSON",value:function fromJSON(e){return new t(e.width,e.height,e.depth,e.widthSegments,e.heightSegments,e.depthSegments)}}]);return t}(pl);function _(e){var t={};for(var a in e){t[a]={};for(var r in e[a]){var i=e[a][r];if(i&&(i.isColor||i.isMatrix3||i.isMatrix4||i.isVector2||i.isVector3||i.isVector4||i.isTexture||i.isQuaternion)){t[a][r]=i.clone()}else if(Array.isArray(i)){t[a][r]=i.slice()}else{t[a][r]=i}}}return t}function x(e){for(var t={},a=0,r;a<e.length;a++){r=_(e[a]);for(var i in r){t[i]=r[i]}}return t}var Pl={clone:_,merge:x},Dl=function(e){_inherits(t,e);var a=_createSuper(t);function t(e){var r;_classCallCheck2(this,t);r=a.call(this);r.type="ShaderMaterial";r.defines={};r.uniforms={};r.vertexShader="void main() {\n\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n}";r.fragmentShader="void main() {\n\tgl_FragColor = vec4( 1.0, 0.0, 0.0, 1.0 );\n}";r.linewidth=1;r.wireframe=!1;r.wireframeLinewidth=1;r.fog=!1;r.lights=!1;r.clipping=!1;r.extensions={derivatives:!1,fragDepth:!1,drawBuffers:!1,shaderTextureLOD:!1};r.defaultAttributeValues={color:[1,1,1],uv:[0,0],uv2:[0,0]};r.index0AttributeName=void 0;r.uniformsNeedUpdate=!1;r.glslVersion=null;if(e!==void 0){if(e.attributes!==void 0){console.error("THREE.ShaderMaterial: attributes should now be defined in THREE.BufferGeometry instead.")}r.setValues(e)}return r}_createClass2(t,[{key:"copy",value:function copy(e){_get(_getPrototypeOf(t.prototype),"copy",this).call(this,e);this.fragmentShader=e.fragmentShader;this.vertexShader=e.vertexShader;this.uniforms=_(e.uniforms);this.defines=Object.assign({},e.defines);this.wireframe=e.wireframe;this.wireframeLinewidth=e.wireframeLinewidth;this.lights=e.lights;this.clipping=e.clipping;this.extensions=Object.assign({},e.extensions);this.glslVersion=e.glslVersion;return this}},{key:"toJSON",value:function toJSON(e){var a=_get(_getPrototypeOf(t.prototype),"toJSON",this).call(this,e);a.glslVersion=this.glslVersion;a.uniforms={};for(var o in this.uniforms){var r=this.uniforms[o],i=r.value;if(i&&i.isTexture){a.uniforms[o]={type:"t",value:i.toJSON(e).uuid}}else if(i&&i.isColor){a.uniforms[o]={type:"c",value:i.getHex()}}else if(i&&i.isVector2){a.uniforms[o]={type:"v2",value:i.toArray()}}else if(i&&i.isVector3){a.uniforms[o]={type:"v3",value:i.toArray()}}else if(i&&i.isVector4){a.uniforms[o]={type:"v4",value:i.toArray()}}else if(i&&i.isMatrix3){a.uniforms[o]={type:"m3",value:i.toArray()}}else if(i&&i.isMatrix4){a.uniforms[o]={type:"m4",value:i.toArray()}}else{a.uniforms[o]={value:i}}}if(0<Object.keys(this.defines).length)a.defines=this.defines;a.vertexShader=this.vertexShader;a.fragmentShader=this.fragmentShader;var n={};for(var s in this.extensions){if(!0===this.extensions[s])n[s]=!0}if(0<Object.keys(n).length)a.extensions=n;return a}}]);return t}(qs);Dl.prototype.isShaderMaterial=!0;var Il=function(e){_inherits(t,e);var a=_createSuper(t);function t(){var e;_classCallCheck2(this,t);e=a.call(this);e.type="Camera";e.matrixWorldInverse=new ls;e.projectionMatrix=new ls;e.projectionMatrixInverse=new ls;return e}_createClass2(t,[{key:"copy",value:function copy(e,a){_get(_getPrototypeOf(t.prototype),"copy",this).call(this,e,a);this.matrixWorldInverse.copy(e.matrixWorldInverse);this.projectionMatrix.copy(e.projectionMatrix);this.projectionMatrixInverse.copy(e.projectionMatrixInverse);return this}},{key:"getWorldDirection",value:function getWorldDirection(t){this.updateWorldMatrix(!0,!1);var a=this.matrixWorld.elements;return t.set(-a[8],-a[9],-a[10]).normalize()}},{key:"updateMatrixWorld",value:function updateMatrixWorld(e){_get(_getPrototypeOf(t.prototype),"updateMatrixWorld",this).call(this,e);this.matrixWorldInverse.copy(this.matrixWorld).invert()}},{key:"updateWorldMatrix",value:function updateWorldMatrix(e,a){_get(_getPrototypeOf(t.prototype),"updateWorldMatrix",this).call(this,e,a);this.matrixWorldInverse.copy(this.matrixWorld).invert()}},{key:"clone",value:function clone(){return new this.constructor().copy(this)}}]);return t}(Ds);Il.prototype.isCamera=!0;var zl=function(e){_inherits(t,e);var a=_createSuper(t);function t(){var e,r=0<arguments.length&&arguments[0]!==void 0?arguments[0]:50,i=1<arguments.length&&arguments[1]!==void 0?arguments[1]:1,n=2<arguments.length&&arguments[2]!==void 0?arguments[2]:.1,o=3<arguments.length&&arguments[3]!==void 0?arguments[3]:2e3;_classCallCheck2(this,t);e=a.call(this);e.type="PerspectiveCamera";e.fov=r;e.zoom=1;e.near=n;e.far=o;e.focus=10;e.aspect=i;e.view=null;e.filmGauge=35;e.filmOffset=0;e.updateProjectionMatrix();return e}_createClass2(t,[{key:"copy",value:function copy(e,a){_get(_getPrototypeOf(t.prototype),"copy",this).call(this,e,a);this.fov=e.fov;this.zoom=e.zoom;this.near=e.near;this.far=e.far;this.focus=e.focus;this.aspect=e.aspect;this.view=null===e.view?null:Object.assign({},e.view);this.filmGauge=e.filmGauge;this.filmOffset=e.filmOffset;return this}},{key:"setFocalLength",value:function setFocalLength(e){var t=.5*this.getFilmHeight()/e;this.fov=2*_o*Math.atan(t);this.updateProjectionMatrix()}},{key:"getFocalLength",value:function getFocalLength(){var e=Math.tan(.5*j*this.fov);return .5*this.getFilmHeight()/e}},{key:"getEffectiveFOV",value:function getEffectiveFOV(){return 2*_o*Math.atan(Math.tan(.5*j*this.fov)/this.zoom)}},{key:"getFilmWidth",value:function getFilmWidth(){return this.filmGauge*Math.min(this.aspect,1)}},{key:"getFilmHeight",value:function getFilmHeight(){return this.filmGauge/Math.max(this.aspect,1)}},{key:"setViewOffset",value:function setViewOffset(e,t,a,r,i,n){this.aspect=e/t;if(null===this.view){this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}}this.view.enabled=!0;this.view.fullWidth=e;this.view.fullHeight=t;this.view.offsetX=a;this.view.offsetY=r;this.view.width=i;this.view.height=n;this.updateProjectionMatrix()}},{key:"clearViewOffset",value:function clearViewOffset(){if(null!==this.view){this.view.enabled=!1}this.updateProjectionMatrix()}},{key:"updateProjectionMatrix",value:function updateProjectionMatrix(){var e=this.near,t=e*Math.tan(.5*j*this.fov)/this.zoom,a=2*t,r=this.aspect*a,i=-.5*r,n=this.view;if(null!==this.view&&this.view.enabled){var s=n.fullWidth,l=n.fullHeight;i+=n.offsetX*r/s;t-=n.offsetY*a/l;r*=n.width/s;a*=n.height/l}var o=this.filmOffset;if(0!==o)i+=e*o/this.getFilmWidth();this.projectionMatrix.makePerspective(i,i+r,t,t-a,e,this.far);this.projectionMatrixInverse.copy(this.projectionMatrix).invert()}},{key:"toJSON",value:function toJSON(e){var a=_get(_getPrototypeOf(t.prototype),"toJSON",this).call(this,e);a.object.fov=this.fov;a.object.zoom=this.zoom;a.object.near=this.near;a.object.far=this.far;a.object.focus=this.focus;a.object.aspect=this.aspect;if(null!==this.view)a.object.view=Object.assign({},this.view);a.object.filmGauge=this.filmGauge;a.object.filmOffset=this.filmOffset;return a}}]);return t}(Il);zl.prototype.isPerspectiveCamera=!0;var Nl=function(e){_inherits(t,e);var a=_createSuper(t);function t(e,r,i){var n;_classCallCheck2(this,t);n=a.call(this);n.type="CubeCamera";if(!0!==i.isWebGLCubeRenderTarget){console.error("THREE.CubeCamera: The constructor now expects an instance of WebGLCubeRenderTarget as third parameter.");return _possibleConstructorReturn(n)}n.renderTarget=i;var o=new zl(90,1,e,r);o.layers=n.layers;o.up.set(0,-1,0);o.lookAt(new Po(1,0,0));n.add(o);var s=new zl(90,1,e,r);s.layers=n.layers;s.up.set(0,-1,0);s.lookAt(new Po(-1,0,0));n.add(s);var l=new zl(90,1,e,r);l.layers=n.layers;l.up.set(0,0,1);l.lookAt(new Po(0,1,0));n.add(l);var d=new zl(90,1,e,r);d.layers=n.layers;d.up.set(0,0,-1);d.lookAt(new Po(0,-1,0));n.add(d);var c=new zl(90,1,e,r);c.layers=n.layers;c.up.set(0,-1,0);c.lookAt(new Po(0,0,1));n.add(c);var u=new zl(90,1,e,r);u.layers=n.layers;u.up.set(0,-1,0);u.lookAt(new Po(0,0,-1));n.add(u);return n}_createClass2(t,[{key:"update",value:function update(e,t){if(null===this.parent)this.updateMatrixWorld();var a=this.renderTarget,r=_slicedToArray2(this.children,6),i=r[0],n=r[1],o=r[2],s=r[3],l=r[4],d=r[5],c=e.xr.enabled,u=e.getRenderTarget();e.xr.enabled=!1;var p=a.texture.generateMipmaps;a.texture.generateMipmaps=!1;e.setRenderTarget(a,0);e.render(t,i);e.setRenderTarget(a,1);e.render(t,n);e.setRenderTarget(a,2);e.render(t,o);e.setRenderTarget(a,3);e.render(t,s);e.setRenderTarget(a,4);e.render(t,l);a.texture.generateMipmaps=p;e.setRenderTarget(a,5);e.render(t,d);e.setRenderTarget(u);e.xr.enabled=c}}]);return t}(Ds),Ol=function(e){_inherits(t,e);var a=_createSuper(t);function t(e,r,i,n,o,s,l,d,c,u){var p;_classCallCheck2(this,t);e=e!==void 0?e:[];r=r!==void 0?r:mi;p=a.call(this,e,r,i,n,o,s,l,d,c,u);p.flipY=!1;return p}_createClass2(t,[{key:"images",get:function get(){return this.image},set:function set(e){this.image=e}}]);return t}(wo);Ol.prototype.isCubeTexture=!0;var Fl=function(e){_inherits(t,e);var a=_createSuper(t);function t(e,r,i){var n;_classCallCheck2(this,t);if(Number.isInteger(r)){console.warn("THREE.WebGLCubeRenderTarget: constructor signature is now WebGLCubeRenderTarget( size, options )");r=i}n=a.call(this,e,e,r);r=r||{};n.texture=new Ol(void 0,r.mapping,r.wrapS,r.wrapT,r.magFilter,r.minFilter,r.format,r.type,r.anisotropy,r.encoding);n.texture.isRenderTargetTexture=!0;n.texture.generateMipmaps=r.generateMipmaps!==void 0?r.generateMipmaps:!1;n.texture.minFilter=r.minFilter!==void 0?r.minFilter:Ei;n.texture._needsFlipEnvMap=!1;return n}_createClass2(t,[{key:"fromEquirectangularTexture",value:function fromEquirectangularTexture(e,t){this.texture.type=t.type;this.texture.format=Gi;this.texture.encoding=t.encoding;this.texture.generateMipmaps=t.generateMipmaps;this.texture.minFilter=t.minFilter;this.texture.magFilter=t.magFilter;var a={uniforms:{tEquirect:{value:null}},vertexShader:"\n\n\t\t\t\tvarying vec3 vWorldDirection;\n\n\t\t\t\tvec3 transformDirection( in vec3 dir, in mat4 matrix ) {\n\n\t\t\t\t\treturn normalize( ( matrix * vec4( dir, 0.0 ) ).xyz );\n\n\t\t\t\t}\n\n\t\t\t\tvoid main() {\n\n\t\t\t\t\tvWorldDirection = transformDirection( position, modelMatrix );\n\n\t\t\t\t\t#include <begin_vertex>\n\t\t\t\t\t#include <project_vertex>\n\n\t\t\t\t}\n\t\t\t",fragmentShader:"\n\n\t\t\t\tuniform sampler2D tEquirect;\n\n\t\t\t\tvarying vec3 vWorldDirection;\n\n\t\t\t\t#include <common>\n\n\t\t\t\tvoid main() {\n\n\t\t\t\t\tvec3 direction = normalize( vWorldDirection );\n\n\t\t\t\t\tvec2 sampleUV = equirectUv( direction );\n\n\t\t\t\t\tgl_FragColor = texture2D( tEquirect, sampleUV );\n\n\t\t\t\t}\n\t\t\t"},r=new Rl(5,5,5),i=new Dl({name:"CubemapFromEquirect",uniforms:_(a.uniforms),vertexShader:a.vertexShader,fragmentShader:a.fragmentShader,side:Tr,blending:Ar});i.uniforms.tEquirect.value=t;var n=new Ll(r,i),o=t.minFilter;if(t.minFilter===Ai)t.minFilter=Ei;var s=new Nl(1,10,this);s.update(e,n);t.minFilter=o;n.geometry.dispose();n.material.dispose();return this}},{key:"clear",value:function clear(e,t,a,r){for(var i=e.getRenderTarget(),n=0;6>n;n++){e.setRenderTarget(this,n);e.clear(t,a,r)}e.setRenderTarget(i)}}]);return t}(ko);Fl.prototype.isWebGLCubeRenderTarget=!0;var Ul=new Po,Bl=new Po,Hl=new So,Gl=function(){function e(){var t=0<arguments.length&&arguments[0]!==void 0?arguments[0]:new Po(1,0,0),a=1<arguments.length&&arguments[1]!==void 0?arguments[1]:0;_classCallCheck2(this,e);this.normal=t;this.constant=a}_createClass2(e,[{key:"set",value:function set(e,t){this.normal.copy(e);this.constant=t;return this}},{key:"setComponents",value:function setComponents(e,t,a,r){this.normal.set(e,t,a);this.constant=r;return this}},{key:"setFromNormalAndCoplanarPoint",value:function setFromNormalAndCoplanarPoint(e,t){this.normal.copy(e);this.constant=-t.dot(this.normal);return this}},{key:"setFromCoplanarPoints",value:function setFromCoplanarPoints(e,t,a){var r=Ul.subVectors(a,t).cross(Bl.subVectors(e,t)).normalize();this.setFromNormalAndCoplanarPoint(r,e);return this}},{key:"copy",value:function copy(e){this.normal.copy(e.normal);this.constant=e.constant;return this}},{key:"normalize",value:function normalize(){var e=1/this.normal.length();this.normal.multiplyScalar(e);this.constant*=e;return this}},{key:"negate",value:function negate(){this.constant*=-1;this.normal.negate();return this}},{key:"distanceToPoint",value:function distanceToPoint(e){return this.normal.dot(e)+this.constant}},{key:"distanceToSphere",value:function distanceToSphere(e){return this.distanceToPoint(e.center)-e.radius}},{key:"projectPoint",value:function projectPoint(e,t){return t.copy(this.normal).multiplyScalar(-this.distanceToPoint(e)).add(e)}},{key:"intersectLine",value:function intersectLine(e,a){var r=e.delta(Ul),i=this.normal.dot(r);if(0===i){if(0===this.distanceToPoint(e.start)){return a.copy(e.start)}return null}var n=-(e.start.dot(this.normal)+this.constant)/i;if(0>n||1<n){return null}return a.copy(r).multiplyScalar(n).add(e.start)}},{key:"intersectsLine",value:function intersectsLine(e){var t=this.distanceToPoint(e.start),a=this.distanceToPoint(e.end);return 0>t&&0<a||0>a&&0<t}},{key:"intersectsBox",value:function intersectsBox(e){return e.intersectsPlane(this)}},{key:"intersectsSphere",value:function intersectsSphere(e){return e.intersectsPlane(this)}},{key:"coplanarPoint",value:function coplanarPoint(e){return e.copy(this.normal).multiplyScalar(-this.constant)}},{key:"applyMatrix4",value:function applyMatrix4(e,t){var a=t||Hl.getNormalMatrix(e),r=this.coplanarPoint(Ul).applyMatrix4(e),i=this.normal.applyMatrix3(a).normalize();this.constant=-r.dot(i);return this}},{key:"translate",value:function translate(e){this.constant-=e.dot(this.normal);return this}},{key:"equals",value:function(e){return e.normal.equals(this.normal)&&e.constant===this.constant}},{key:"clone",value:function clone(){return new this.constructor().copy(this)}}]);return e}();Gl.prototype.isPlane=!0;var Vl=new $o,Wl=new Po,jl=function(){function e(){var t=0<arguments.length&&arguments[0]!==void 0?arguments[0]:new Gl,a=1<arguments.length&&arguments[1]!==void 0?arguments[1]:new Gl,r=2<arguments.length&&arguments[2]!==void 0?arguments[2]:new Gl,i=3<arguments.length&&arguments[3]!==void 0?arguments[3]:new Gl,n=4<arguments.length&&arguments[4]!==void 0?arguments[4]:new Gl,o=5<arguments.length&&arguments[5]!==void 0?arguments[5]:new Gl;_classCallCheck2(this,e);this.planes=[t,a,r,i,n,o]}_createClass2(e,[{key:"set",value:function set(e,t,a,r,i,n){var o=this.planes;o[0].copy(e);o[1].copy(t);o[2].copy(a);o[3].copy(r);o[4].copy(i);o[5].copy(n);return this}},{key:"copy",value:function copy(e){for(var t=this.planes,a=0;6>a;a++){t[a].copy(e.planes[a])}return this}},{key:"setFromProjectionMatrix",value:function setFromProjectionMatrix(e){var t=this.planes,a=e.elements,r=a[0],i=a[1],n=a[2],o=a[3],s=a[4],l=a[5],d=a[6],c=a[7],u=a[8],p=a[9],m=a[10],g=a[11],f=a[12],h=a[13],v=a[14],y=a[15];t[0].setComponents(o-r,c-s,g-u,y-f).normalize();t[1].setComponents(o+r,c+s,g+u,y+f).normalize();t[2].setComponents(o+i,c+l,g+p,y+h).normalize();t[3].setComponents(o-i,c-l,g-p,y-h).normalize();t[4].setComponents(o-n,c-d,g-m,y-v).normalize();t[5].setComponents(o+n,c+d,g+m,y+v).normalize();return this}},{key:"intersectsObject",value:function intersectsObject(e){var t=e.geometry;if(null===t.boundingSphere)t.computeBoundingSphere();Vl.copy(t.boundingSphere).applyMatrix4(e.matrixWorld);return this.intersectsSphere(Vl)}},{key:"intersectsSprite",value:function intersectsSprite(e){Vl.center.set(0,0,0);Vl.radius=.7071067811865476;Vl.applyMatrix4(e.matrixWorld);return this.intersectsSphere(Vl)}},{key:"intersectsSphere",value:function intersectsSphere(e){for(var t=this.planes,a=e.center,r=-e.radius,i=0,n;6>i;i++){n=t[i].distanceToPoint(a);if(n<r){return!1}}return!0}},{key:"intersectsBox",value:function intersectsBox(e){for(var t=this.planes,a=0,r;6>a;a++){r=t[a];Wl.x=0<r.normal.x?e.max.x:e.min.x;Wl.y=0<r.normal.y?e.max.y:e.min.y;Wl.z=0<r.normal.z?e.max.z:e.min.z;if(0>r.distanceToPoint(Wl)){return!1}}return!0}},{key:"containsPoint",value:function containsPoint(e){for(var t=this.planes,a=0;6>a;a++){if(0>t[a].distanceToPoint(e)){return!1}}return!0}},{key:"clone",value:function clone(){return new this.constructor().copy(this)}}]);return e}();function b(){var t=null,a=!1,r=null,i=null;function e(a,n){r(a,n);i=t.requestAnimationFrame(e)}return{start:function start(){if(!0===a)return;if(null===r)return;i=t.requestAnimationFrame(e);a=!0},stop:function stop(){t.cancelAnimationFrame(i);a=!1},setAnimationLoop:function setAnimationLoop(e){r=e},setContext:function setContext(e){t=e}}}function S(e,t){var i=t.isWebGL2,n=new WeakMap;function a(t,a){var r=t.array,n=t.usage,o=e.createBuffer();e.bindBuffer(a,o);e.bufferData(a,r,n);t.onUploadCallback();var s=5126;if(r instanceof Float32Array){s=5126}else if(r instanceof Float64Array){console.warn("THREE.WebGLAttributes: Unsupported data buffer format: Float64Array.")}else if(r instanceof Uint16Array){if(t.isFloat16BufferAttribute){if(i){s=5131}else{console.warn("THREE.WebGLAttributes: Usage of Float16BufferAttribute requires WebGL2.")}}else{s=5123}}else if(r instanceof Int16Array){s=5122}else if(r instanceof Uint32Array){s=5125}else if(r instanceof Int32Array){s=5124}else if(r instanceof Int8Array){s=5120}else if(r instanceof Uint8Array){s=5121}else if(r instanceof Uint8ClampedArray){s=5121}return{buffer:o,type:s,bytesPerElement:r.BYTES_PER_ELEMENT,version:t.version}}function r(t,a,r){var n=a.array,o=a.updateRange;e.bindBuffer(r,t);if(-1===o.count){e.bufferSubData(r,0,n)}else{if(i){e.bufferSubData(r,o.offset*n.BYTES_PER_ELEMENT,n,o.offset,o.count)}else{e.bufferSubData(r,o.offset*n.BYTES_PER_ELEMENT,n.subarray(o.offset,o.offset+o.count))}o.count=-1}}return{get:function(e){if(e.isInterleavedBufferAttribute)e=e.data;return n.get(e)},remove:function(t){if(t.isInterleavedBufferAttribute)t=t.data;var a=n.get(t);if(a){e.deleteBuffer(a.buffer);n.delete(t)}},update:function(e,t){if(e.isGLBufferAttribute){var o=n.get(e);if(!o||o.version<e.version){n.set(e,{buffer:e.buffer,type:e.type,bytesPerElement:e.elementSize,version:e.version})}return}if(e.isInterleavedBufferAttribute)e=e.data;var i=n.get(e);if(i===void 0){n.set(e,a(e,t))}else if(i.version<e.version){r(i.buffer,e,t);i.version=e.version}}}}var ql=function(e){_inherits(t,e);var r=_createSuper(t);function t(){var e,i=0<arguments.length&&arguments[0]!==void 0?arguments[0]:1,n=1<arguments.length&&arguments[1]!==void 0?arguments[1]:1,o=2<arguments.length&&arguments[2]!==void 0?arguments[2]:1,s=3<arguments.length&&arguments[3]!==void 0?arguments[3]:1;_classCallCheck2(this,t);e=r.call(this);e.type="PlaneGeometry";e.parameters={width:i,height:n,widthSegments:o,heightSegments:s};for(var l=Math.floor(o),u=Math.floor(s),p=l+1,m=[],g=[],f=[],h=[],v=0,_;v<u+1;v++){_=v*(n/u)-n/2;for(var d=0,M;d<p;d++){M=d*(i/l)-i/2;g.push(M,-_,0);f.push(0,0,1);h.push(d/l);h.push(1-v/u)}}for(var x=0;x<u;x++){for(var T=0;T<l;T++){var S=T+p*x,a=T+p*(x+1),b=T+1+p*(x+1),c=T+1+p*x;m.push(S,a,c);m.push(a,b,c)}}e.setIndex(m);e.setAttribute("position",new il(g,3));e.setAttribute("normal",new il(f,3));e.setAttribute("uv",new il(h,2));return e}_createClass2(t,null,[{key:"fromJSON",value:function fromJSON(e){return new t(e.width,e.height,e.widthSegments,e.heightSegments)}}]);return t}(pl),Xl={alphamap_fragment:"#ifdef USE_ALPHAMAP\n\tdiffuseColor.a *= texture2D( alphaMap, vUv ).g;\n#endif",alphamap_pars_fragment:"#ifdef USE_ALPHAMAP\n\tuniform sampler2D alphaMap;\n#endif",alphatest_fragment:"#ifdef USE_ALPHATEST\n\tif ( diffuseColor.a < alphaTest ) discard;\n#endif",alphatest_pars_fragment:"#ifdef USE_ALPHATEST\n\tuniform float alphaTest;\n#endif",aomap_fragment:"#ifdef USE_AOMAP\n\tfloat ambientOcclusion = ( texture2D( aoMap, vUv2 ).r - 1.0 ) * aoMapIntensity + 1.0;\n\treflectedLight.indirectDiffuse *= ambientOcclusion;\n\t#if defined( USE_ENVMAP ) && defined( STANDARD )\n\t\tfloat dotNV = saturate( dot( geometry.normal, geometry.viewDir ) );\n\t\treflectedLight.indirectSpecular *= computeSpecularOcclusion( dotNV, ambientOcclusion, material.roughness );\n\t#endif\n#endif",aomap_pars_fragment:"#ifdef USE_AOMAP\n\tuniform sampler2D aoMap;\n\tuniform float aoMapIntensity;\n#endif",begin_vertex:"vec3 transformed = vec3( position );",beginnormal_vertex:"vec3 objectNormal = vec3( normal );\n#ifdef USE_TANGENT\n\tvec3 objectTangent = vec3( tangent.xyz );\n#endif",bsdfs:"vec3 BRDF_Lambert( const in vec3 diffuseColor ) {\n\treturn RECIPROCAL_PI * diffuseColor;\n}\nvec3 F_Schlick( const in vec3 f0, const in float f90, const in float dotVH ) {\n\tfloat fresnel = exp2( ( - 5.55473 * dotVH - 6.98316 ) * dotVH );\n\treturn f0 * ( 1.0 - fresnel ) + ( f90 * fresnel );\n}\nfloat V_GGX_SmithCorrelated( const in float alpha, const in float dotNL, const in float dotNV ) {\n\tfloat a2 = pow2( alpha );\n\tfloat gv = dotNL * sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNV ) );\n\tfloat gl = dotNV * sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNL ) );\n\treturn 0.5 / max( gv + gl, EPSILON );\n}\nfloat D_GGX( const in float alpha, const in float dotNH ) {\n\tfloat a2 = pow2( alpha );\n\tfloat denom = pow2( dotNH ) * ( a2 - 1.0 ) + 1.0;\n\treturn RECIPROCAL_PI * a2 / pow2( denom );\n}\nvec3 BRDF_GGX( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, const in vec3 f0, const in float f90, const in float roughness ) {\n\tfloat alpha = pow2( roughness );\n\tvec3 halfDir = normalize( lightDir + viewDir );\n\tfloat dotNL = saturate( dot( normal, lightDir ) );\n\tfloat dotNV = saturate( dot( normal, viewDir ) );\n\tfloat dotNH = saturate( dot( normal, halfDir ) );\n\tfloat dotVH = saturate( dot( viewDir, halfDir ) );\n\tvec3 F = F_Schlick( f0, f90, dotVH );\n\tfloat V = V_GGX_SmithCorrelated( alpha, dotNL, dotNV );\n\tfloat D = D_GGX( alpha, dotNH );\n\treturn F * ( V * D );\n}\nvec2 LTC_Uv( const in vec3 N, const in vec3 V, const in float roughness ) {\n\tconst float LUT_SIZE = 64.0;\n\tconst float LUT_SCALE = ( LUT_SIZE - 1.0 ) / LUT_SIZE;\n\tconst float LUT_BIAS = 0.5 / LUT_SIZE;\n\tfloat dotNV = saturate( dot( N, V ) );\n\tvec2 uv = vec2( roughness, sqrt( 1.0 - dotNV ) );\n\tuv = uv * LUT_SCALE + LUT_BIAS;\n\treturn uv;\n}\nfloat LTC_ClippedSphereFormFactor( const in vec3 f ) {\n\tfloat l = length( f );\n\treturn max( ( l * l + f.z ) / ( l + 1.0 ), 0.0 );\n}\nvec3 LTC_EdgeVectorFormFactor( const in vec3 v1, const in vec3 v2 ) {\n\tfloat x = dot( v1, v2 );\n\tfloat y = abs( x );\n\tfloat a = 0.8543985 + ( 0.4965155 + 0.0145206 * y ) * y;\n\tfloat b = 3.4175940 + ( 4.1616724 + y ) * y;\n\tfloat v = a / b;\n\tfloat theta_sintheta = ( x > 0.0 ) ? v : 0.5 * inversesqrt( max( 1.0 - x * x, 1e-7 ) ) - v;\n\treturn cross( v1, v2 ) * theta_sintheta;\n}\nvec3 LTC_Evaluate( const in vec3 N, const in vec3 V, const in vec3 P, const in mat3 mInv, const in vec3 rectCoords[ 4 ] ) {\n\tvec3 v1 = rectCoords[ 1 ] - rectCoords[ 0 ];\n\tvec3 v2 = rectCoords[ 3 ] - rectCoords[ 0 ];\n\tvec3 lightNormal = cross( v1, v2 );\n\tif( dot( lightNormal, P - rectCoords[ 0 ] ) < 0.0 ) return vec3( 0.0 );\n\tvec3 T1, T2;\n\tT1 = normalize( V - N * dot( V, N ) );\n\tT2 = - cross( N, T1 );\n\tmat3 mat = mInv * transposeMat3( mat3( T1, T2, N ) );\n\tvec3 coords[ 4 ];\n\tcoords[ 0 ] = mat * ( rectCoords[ 0 ] - P );\n\tcoords[ 1 ] = mat * ( rectCoords[ 1 ] - P );\n\tcoords[ 2 ] = mat * ( rectCoords[ 2 ] - P );\n\tcoords[ 3 ] = mat * ( rectCoords[ 3 ] - P );\n\tcoords[ 0 ] = normalize( coords[ 0 ] );\n\tcoords[ 1 ] = normalize( coords[ 1 ] );\n\tcoords[ 2 ] = normalize( coords[ 2 ] );\n\tcoords[ 3 ] = normalize( coords[ 3 ] );\n\tvec3 vectorFormFactor = vec3( 0.0 );\n\tvectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 0 ], coords[ 1 ] );\n\tvectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 1 ], coords[ 2 ] );\n\tvectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 2 ], coords[ 3 ] );\n\tvectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 3 ], coords[ 0 ] );\n\tfloat result = LTC_ClippedSphereFormFactor( vectorFormFactor );\n\treturn vec3( result );\n}\nfloat G_BlinnPhong_Implicit( ) {\n\treturn 0.25;\n}\nfloat D_BlinnPhong( const in float shininess, const in float dotNH ) {\n\treturn RECIPROCAL_PI * ( shininess * 0.5 + 1.0 ) * pow( dotNH, shininess );\n}\nvec3 BRDF_BlinnPhong( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, const in vec3 specularColor, const in float shininess ) {\n\tvec3 halfDir = normalize( lightDir + viewDir );\n\tfloat dotNH = saturate( dot( normal, halfDir ) );\n\tfloat dotVH = saturate( dot( viewDir, halfDir ) );\n\tvec3 F = F_Schlick( specularColor, 1.0, dotVH );\n\tfloat G = G_BlinnPhong_Implicit( );\n\tfloat D = D_BlinnPhong( shininess, dotNH );\n\treturn F * ( G * D );\n}\n#if defined( USE_SHEEN )\nfloat D_Charlie( float roughness, float dotNH ) {\n\tfloat alpha = pow2( roughness );\n\tfloat invAlpha = 1.0 / alpha;\n\tfloat cos2h = dotNH * dotNH;\n\tfloat sin2h = max( 1.0 - cos2h, 0.0078125 );\n\treturn ( 2.0 + invAlpha ) * pow( sin2h, invAlpha * 0.5 ) / ( 2.0 * PI );\n}\nfloat V_Neubelt( float dotNV, float dotNL ) {\n\treturn saturate( 1.0 / ( 4.0 * ( dotNL + dotNV - dotNL * dotNV ) ) );\n}\nvec3 BRDF_Sheen( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, vec3 sheenColor, const in float sheenRoughness ) {\n\tvec3 halfDir = normalize( lightDir + viewDir );\n\tfloat dotNL = saturate( dot( normal, lightDir ) );\n\tfloat dotNV = saturate( dot( normal, viewDir ) );\n\tfloat dotNH = saturate( dot( normal, halfDir ) );\n\tfloat D = D_Charlie( sheenRoughness, dotNH );\n\tfloat V = V_Neubelt( dotNV, dotNL );\n\treturn sheenColor * ( D * V );\n}\n#endif",bumpmap_pars_fragment:"#ifdef USE_BUMPMAP\n\tuniform sampler2D bumpMap;\n\tuniform float bumpScale;\n\tvec2 dHdxy_fwd() {\n\t\tvec2 dSTdx = dFdx( vUv );\n\t\tvec2 dSTdy = dFdy( vUv );\n\t\tfloat Hll = bumpScale * texture2D( bumpMap, vUv ).x;\n\t\tfloat dBx = bumpScale * texture2D( bumpMap, vUv + dSTdx ).x - Hll;\n\t\tfloat dBy = bumpScale * texture2D( bumpMap, vUv + dSTdy ).x - Hll;\n\t\treturn vec2( dBx, dBy );\n\t}\n\tvec3 perturbNormalArb( vec3 surf_pos, vec3 surf_norm, vec2 dHdxy, float faceDirection ) {\n\t\tvec3 vSigmaX = vec3( dFdx( surf_pos.x ), dFdx( surf_pos.y ), dFdx( surf_pos.z ) );\n\t\tvec3 vSigmaY = vec3( dFdy( surf_pos.x ), dFdy( surf_pos.y ), dFdy( surf_pos.z ) );\n\t\tvec3 vN = surf_norm;\n\t\tvec3 R1 = cross( vSigmaY, vN );\n\t\tvec3 R2 = cross( vN, vSigmaX );\n\t\tfloat fDet = dot( vSigmaX, R1 ) * faceDirection;\n\t\tvec3 vGrad = sign( fDet ) * ( dHdxy.x * R1 + dHdxy.y * R2 );\n\t\treturn normalize( abs( fDet ) * surf_norm - vGrad );\n\t}\n#endif",clipping_planes_fragment:"#if NUM_CLIPPING_PLANES > 0\n\tvec4 plane;\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < UNION_CLIPPING_PLANES; i ++ ) {\n\t\tplane = clippingPlanes[ i ];\n\t\tif ( dot( vClipPosition, plane.xyz ) > plane.w ) discard;\n\t}\n\t#pragma unroll_loop_end\n\t#if UNION_CLIPPING_PLANES < NUM_CLIPPING_PLANES\n\t\tbool clipped = true;\n\t\t#pragma unroll_loop_start\n\t\tfor ( int i = UNION_CLIPPING_PLANES; i < NUM_CLIPPING_PLANES; i ++ ) {\n\t\t\tplane = clippingPlanes[ i ];\n\t\t\tclipped = ( dot( vClipPosition, plane.xyz ) > plane.w ) && clipped;\n\t\t}\n\t\t#pragma unroll_loop_end\n\t\tif ( clipped ) discard;\n\t#endif\n#endif",clipping_planes_pars_fragment:"#if NUM_CLIPPING_PLANES > 0\n\tvarying vec3 vClipPosition;\n\tuniform vec4 clippingPlanes[ NUM_CLIPPING_PLANES ];\n#endif",clipping_planes_pars_vertex:"#if NUM_CLIPPING_PLANES > 0\n\tvarying vec3 vClipPosition;\n#endif",clipping_planes_vertex:"#if NUM_CLIPPING_PLANES > 0\n\tvClipPosition = - mvPosition.xyz;\n#endif",color_fragment:"#if defined( USE_COLOR_ALPHA )\n\tdiffuseColor *= vColor;\n#elif defined( USE_COLOR )\n\tdiffuseColor.rgb *= vColor;\n#endif",color_pars_fragment:"#if defined( USE_COLOR_ALPHA )\n\tvarying vec4 vColor;\n#elif defined( USE_COLOR )\n\tvarying vec3 vColor;\n#endif",color_pars_vertex:"#if defined( USE_COLOR_ALPHA )\n\tvarying vec4 vColor;\n#elif defined( USE_COLOR ) || defined( USE_INSTANCING_COLOR )\n\tvarying vec3 vColor;\n#endif",color_vertex:"#if defined( USE_COLOR_ALPHA )\n\tvColor = vec4( 1.0 );\n#elif defined( USE_COLOR ) || defined( USE_INSTANCING_COLOR )\n\tvColor = vec3( 1.0 );\n#endif\n#ifdef USE_COLOR\n\tvColor *= color;\n#endif\n#ifdef USE_INSTANCING_COLOR\n\tvColor.xyz *= instanceColor.xyz;\n#endif",common:"#define PI 3.141592653589793\n#define PI2 6.283185307179586\n#define PI_HALF 1.5707963267948966\n#define RECIPROCAL_PI 0.3183098861837907\n#define RECIPROCAL_PI2 0.15915494309189535\n#define EPSILON 1e-6\n#ifndef saturate\n#define saturate( a ) clamp( a, 0.0, 1.0 )\n#endif\n#define whiteComplement( a ) ( 1.0 - saturate( a ) )\nfloat pow2( const in float x ) { return x*x; }\nfloat pow3( const in float x ) { return x*x*x; }\nfloat pow4( const in float x ) { float x2 = x*x; return x2*x2; }\nfloat max3( const in vec3 v ) { return max( max( v.x, v.y ), v.z ); }\nfloat average( const in vec3 color ) { return dot( color, vec3( 0.3333 ) ); }\nhighp float rand( const in vec2 uv ) {\n\tconst highp float a = 12.9898, b = 78.233, c = 43758.5453;\n\thighp float dt = dot( uv.xy, vec2( a,b ) ), sn = mod( dt, PI );\n\treturn fract( sin( sn ) * c );\n}\n#ifdef HIGH_PRECISION\n\tfloat precisionSafeLength( vec3 v ) { return length( v ); }\n#else\n\tfloat precisionSafeLength( vec3 v ) {\n\t\tfloat maxComponent = max3( abs( v ) );\n\t\treturn length( v / maxComponent ) * maxComponent;\n\t}\n#endif\nstruct IncidentLight {\n\tvec3 color;\n\tvec3 direction;\n\tbool visible;\n};\nstruct ReflectedLight {\n\tvec3 directDiffuse;\n\tvec3 directSpecular;\n\tvec3 indirectDiffuse;\n\tvec3 indirectSpecular;\n};\nstruct GeometricContext {\n\tvec3 position;\n\tvec3 normal;\n\tvec3 viewDir;\n#ifdef USE_CLEARCOAT\n\tvec3 clearcoatNormal;\n#endif\n};\nvec3 transformDirection( in vec3 dir, in mat4 matrix ) {\n\treturn normalize( ( matrix * vec4( dir, 0.0 ) ).xyz );\n}\nvec3 inverseTransformDirection( in vec3 dir, in mat4 matrix ) {\n\treturn normalize( ( vec4( dir, 0.0 ) * matrix ).xyz );\n}\nmat3 transposeMat3( const in mat3 m ) {\n\tmat3 tmp;\n\ttmp[ 0 ] = vec3( m[ 0 ].x, m[ 1 ].x, m[ 2 ].x );\n\ttmp[ 1 ] = vec3( m[ 0 ].y, m[ 1 ].y, m[ 2 ].y );\n\ttmp[ 2 ] = vec3( m[ 0 ].z, m[ 1 ].z, m[ 2 ].z );\n\treturn tmp;\n}\nfloat linearToRelativeLuminance( const in vec3 color ) {\n\tvec3 weights = vec3( 0.2126, 0.7152, 0.0722 );\n\treturn dot( weights, color.rgb );\n}\nbool isPerspectiveMatrix( mat4 m ) {\n\treturn m[ 2 ][ 3 ] == - 1.0;\n}\nvec2 equirectUv( in vec3 dir ) {\n\tfloat u = atan( dir.z, dir.x ) * RECIPROCAL_PI2 + 0.5;\n\tfloat v = asin( clamp( dir.y, - 1.0, 1.0 ) ) * RECIPROCAL_PI + 0.5;\n\treturn vec2( u, v );\n}",cube_uv_reflection_fragment:"#ifdef ENVMAP_TYPE_CUBE_UV\n\t#define cubeUV_maxMipLevel 8.0\n\t#define cubeUV_minMipLevel 4.0\n\t#define cubeUV_maxTileSize 256.0\n\t#define cubeUV_minTileSize 16.0\n\tfloat getFace( vec3 direction ) {\n\t\tvec3 absDirection = abs( direction );\n\t\tfloat face = - 1.0;\n\t\tif ( absDirection.x > absDirection.z ) {\n\t\t\tif ( absDirection.x > absDirection.y )\n\t\t\t\tface = direction.x > 0.0 ? 0.0 : 3.0;\n\t\t\telse\n\t\t\t\tface = direction.y > 0.0 ? 1.0 : 4.0;\n\t\t} else {\n\t\t\tif ( absDirection.z > absDirection.y )\n\t\t\t\tface = direction.z > 0.0 ? 2.0 : 5.0;\n\t\t\telse\n\t\t\t\tface = direction.y > 0.0 ? 1.0 : 4.0;\n\t\t}\n\t\treturn face;\n\t}\n\tvec2 getUV( vec3 direction, float face ) {\n\t\tvec2 uv;\n\t\tif ( face == 0.0 ) {\n\t\t\tuv = vec2( direction.z, direction.y ) / abs( direction.x );\n\t\t} else if ( face == 1.0 ) {\n\t\t\tuv = vec2( - direction.x, - direction.z ) / abs( direction.y );\n\t\t} else if ( face == 2.0 ) {\n\t\t\tuv = vec2( - direction.x, direction.y ) / abs( direction.z );\n\t\t} else if ( face == 3.0 ) {\n\t\t\tuv = vec2( - direction.z, direction.y ) / abs( direction.x );\n\t\t} else if ( face == 4.0 ) {\n\t\t\tuv = vec2( - direction.x, direction.z ) / abs( direction.y );\n\t\t} else {\n\t\t\tuv = vec2( direction.x, direction.y ) / abs( direction.z );\n\t\t}\n\t\treturn 0.5 * ( uv + 1.0 );\n\t}\n\tvec3 bilinearCubeUV( sampler2D envMap, vec3 direction, float mipInt ) {\n\t\tfloat face = getFace( direction );\n\t\tfloat filterInt = max( cubeUV_minMipLevel - mipInt, 0.0 );\n\t\tmipInt = max( mipInt, cubeUV_minMipLevel );\n\t\tfloat faceSize = exp2( mipInt );\n\t\tfloat texelSize = 1.0 / ( 3.0 * cubeUV_maxTileSize );\n\t\tvec2 uv = getUV( direction, face ) * ( faceSize - 1.0 );\n\t\tvec2 f = fract( uv );\n\t\tuv += 0.5 - f;\n\t\tif ( face > 2.0 ) {\n\t\t\tuv.y += faceSize;\n\t\t\tface -= 3.0;\n\t\t}\n\t\tuv.x += face * faceSize;\n\t\tif ( mipInt < cubeUV_maxMipLevel ) {\n\t\t\tuv.y += 2.0 * cubeUV_maxTileSize;\n\t\t}\n\t\tuv.y += filterInt * 2.0 * cubeUV_minTileSize;\n\t\tuv.x += 3.0 * max( 0.0, cubeUV_maxTileSize - 2.0 * faceSize );\n\t\tuv *= texelSize;\n\t\tvec3 tl = envMapTexelToLinear( texture2D( envMap, uv ) ).rgb;\n\t\tuv.x += texelSize;\n\t\tvec3 tr = envMapTexelToLinear( texture2D( envMap, uv ) ).rgb;\n\t\tuv.y += texelSize;\n\t\tvec3 br = envMapTexelToLinear( texture2D( envMap, uv ) ).rgb;\n\t\tuv.x -= texelSize;\n\t\tvec3 bl = envMapTexelToLinear( texture2D( envMap, uv ) ).rgb;\n\t\tvec3 tm = mix( tl, tr, f.x );\n\t\tvec3 bm = mix( bl, br, f.x );\n\t\treturn mix( tm, bm, f.y );\n\t}\n\t#define r0 1.0\n\t#define v0 0.339\n\t#define m0 - 2.0\n\t#define r1 0.8\n\t#define v1 0.276\n\t#define m1 - 1.0\n\t#define r4 0.4\n\t#define v4 0.046\n\t#define m4 2.0\n\t#define r5 0.305\n\t#define v5 0.016\n\t#define m5 3.0\n\t#define r6 0.21\n\t#define v6 0.0038\n\t#define m6 4.0\n\tfloat roughnessToMip( float roughness ) {\n\t\tfloat mip = 0.0;\n\t\tif ( roughness >= r1 ) {\n\t\t\tmip = ( r0 - roughness ) * ( m1 - m0 ) / ( r0 - r1 ) + m0;\n\t\t} else if ( roughness >= r4 ) {\n\t\t\tmip = ( r1 - roughness ) * ( m4 - m1 ) / ( r1 - r4 ) + m1;\n\t\t} else if ( roughness >= r5 ) {\n\t\t\tmip = ( r4 - roughness ) * ( m5 - m4 ) / ( r4 - r5 ) + m4;\n\t\t} else if ( roughness >= r6 ) {\n\t\t\tmip = ( r5 - roughness ) * ( m6 - m5 ) / ( r5 - r6 ) + m5;\n\t\t} else {\n\t\t\tmip = - 2.0 * log2( 1.16 * roughness );\t\t}\n\t\treturn mip;\n\t}\n\tvec4 textureCubeUV( sampler2D envMap, vec3 sampleDir, float roughness ) {\n\t\tfloat mip = clamp( roughnessToMip( roughness ), m0, cubeUV_maxMipLevel );\n\t\tfloat mipF = fract( mip );\n\t\tfloat mipInt = floor( mip );\n\t\tvec3 color0 = bilinearCubeUV( envMap, sampleDir, mipInt );\n\t\tif ( mipF == 0.0 ) {\n\t\t\treturn vec4( color0, 1.0 );\n\t\t} else {\n\t\t\tvec3 color1 = bilinearCubeUV( envMap, sampleDir, mipInt + 1.0 );\n\t\t\treturn vec4( mix( color0, color1, mipF ), 1.0 );\n\t\t}\n\t}\n#endif",defaultnormal_vertex:"vec3 transformedNormal = objectNormal;\n#ifdef USE_INSTANCING\n\tmat3 m = mat3( instanceMatrix );\n\ttransformedNormal /= vec3( dot( m[ 0 ], m[ 0 ] ), dot( m[ 1 ], m[ 1 ] ), dot( m[ 2 ], m[ 2 ] ) );\n\ttransformedNormal = m * transformedNormal;\n#endif\ntransformedNormal = normalMatrix * transformedNormal;\n#ifdef FLIP_SIDED\n\ttransformedNormal = - transformedNormal;\n#endif\n#ifdef USE_TANGENT\n\tvec3 transformedTangent = ( modelViewMatrix * vec4( objectTangent, 0.0 ) ).xyz;\n\t#ifdef FLIP_SIDED\n\t\ttransformedTangent = - transformedTangent;\n\t#endif\n#endif",displacementmap_pars_vertex:"#ifdef USE_DISPLACEMENTMAP\n\tuniform sampler2D displacementMap;\n\tuniform float displacementScale;\n\tuniform float displacementBias;\n#endif",displacementmap_vertex:"#ifdef USE_DISPLACEMENTMAP\n\ttransformed += normalize( objectNormal ) * ( texture2D( displacementMap, vUv ).x * displacementScale + displacementBias );\n#endif",emissivemap_fragment:"#ifdef USE_EMISSIVEMAP\n\tvec4 emissiveColor = texture2D( emissiveMap, vUv );\n\temissiveColor.rgb = emissiveMapTexelToLinear( emissiveColor ).rgb;\n\ttotalEmissiveRadiance *= emissiveColor.rgb;\n#endif",emissivemap_pars_fragment:"#ifdef USE_EMISSIVEMAP\n\tuniform sampler2D emissiveMap;\n#endif",encodings_fragment:"gl_FragColor = linearToOutputTexel( gl_FragColor );",encodings_pars_fragment:"\nvec4 LinearToLinear( in vec4 value ) {\n\treturn value;\n}\nvec4 GammaToLinear( in vec4 value, in float gammaFactor ) {\n\treturn vec4( pow( value.rgb, vec3( gammaFactor ) ), value.a );\n}\nvec4 LinearToGamma( in vec4 value, in float gammaFactor ) {\n\treturn vec4( pow( value.rgb, vec3( 1.0 / gammaFactor ) ), value.a );\n}\nvec4 sRGBToLinear( in vec4 value ) {\n\treturn vec4( mix( pow( value.rgb * 0.9478672986 + vec3( 0.0521327014 ), vec3( 2.4 ) ), value.rgb * 0.0773993808, vec3( lessThanEqual( value.rgb, vec3( 0.04045 ) ) ) ), value.a );\n}\nvec4 LinearTosRGB( in vec4 value ) {\n\treturn vec4( mix( pow( value.rgb, vec3( 0.41666 ) ) * 1.055 - vec3( 0.055 ), value.rgb * 12.92, vec3( lessThanEqual( value.rgb, vec3( 0.0031308 ) ) ) ), value.a );\n}\nvec4 RGBEToLinear( in vec4 value ) {\n\treturn vec4( value.rgb * exp2( value.a * 255.0 - 128.0 ), 1.0 );\n}\nvec4 LinearToRGBE( in vec4 value ) {\n\tfloat maxComponent = max( max( value.r, value.g ), value.b );\n\tfloat fExp = clamp( ceil( log2( maxComponent ) ), -128.0, 127.0 );\n\treturn vec4( value.rgb / exp2( fExp ), ( fExp + 128.0 ) / 255.0 );\n}\nvec4 RGBMToLinear( in vec4 value, in float maxRange ) {\n\treturn vec4( value.rgb * value.a * maxRange, 1.0 );\n}\nvec4 LinearToRGBM( in vec4 value, in float maxRange ) {\n\tfloat maxRGB = max( value.r, max( value.g, value.b ) );\n\tfloat M = clamp( maxRGB / maxRange, 0.0, 1.0 );\n\tM = ceil( M * 255.0 ) / 255.0;\n\treturn vec4( value.rgb / ( M * maxRange ), M );\n}\nvec4 RGBDToLinear( in vec4 value, in float maxRange ) {\n\treturn vec4( value.rgb * ( ( maxRange / 255.0 ) / value.a ), 1.0 );\n}\nvec4 LinearToRGBD( in vec4 value, in float maxRange ) {\n\tfloat maxRGB = max( value.r, max( value.g, value.b ) );\n\tfloat D = max( maxRange / maxRGB, 1.0 );\n\tD = clamp( floor( D ) / 255.0, 0.0, 1.0 );\n\treturn vec4( value.rgb * ( D * ( 255.0 / maxRange ) ), D );\n}",envmap_fragment:"#ifdef USE_ENVMAP\n\t#ifdef ENV_WORLDPOS\n\t\tvec3 cameraToFrag;\n\t\tif ( isOrthographic ) {\n\t\t\tcameraToFrag = normalize( vec3( - viewMatrix[ 0 ][ 2 ], - viewMatrix[ 1 ][ 2 ], - viewMatrix[ 2 ][ 2 ] ) );\n\t\t} else {\n\t\t\tcameraToFrag = normalize( vWorldPosition - cameraPosition );\n\t\t}\n\t\tvec3 worldNormal = inverseTransformDirection( normal, viewMatrix );\n\t\t#ifdef ENVMAP_MODE_REFLECTION\n\t\t\tvec3 reflectVec = reflect( cameraToFrag, worldNormal );\n\t\t#else\n\t\t\tvec3 reflectVec = refract( cameraToFrag, worldNormal, refractionRatio );\n\t\t#endif\n\t#else\n\t\tvec3 reflectVec = vReflect;\n\t#endif\n\t#ifdef ENVMAP_TYPE_CUBE\n\t\tvec4 envColor = textureCube( envMap, vec3( flipEnvMap * reflectVec.x, reflectVec.yz ) );\n\t\tenvColor = envMapTexelToLinear( envColor );\n\t#elif defined( ENVMAP_TYPE_CUBE_UV )\n\t\tvec4 envColor = textureCubeUV( envMap, reflectVec, 0.0 );\n\t#else\n\t\tvec4 envColor = vec4( 0.0 );\n\t#endif\n\t#ifdef ENVMAP_BLENDING_MULTIPLY\n\t\toutgoingLight = mix( outgoingLight, outgoingLight * envColor.xyz, specularStrength * reflectivity );\n\t#elif defined( ENVMAP_BLENDING_MIX )\n\t\toutgoingLight = mix( outgoingLight, envColor.xyz, specularStrength * reflectivity );\n\t#elif defined( ENVMAP_BLENDING_ADD )\n\t\toutgoingLight += envColor.xyz * specularStrength * reflectivity;\n\t#endif\n#endif",envmap_common_pars_fragment:"#ifdef USE_ENVMAP\n\tuniform float envMapIntensity;\n\tuniform float flipEnvMap;\n\t#ifdef ENVMAP_TYPE_CUBE\n\t\tuniform samplerCube envMap;\n\t#else\n\t\tuniform sampler2D envMap;\n\t#endif\n\t\n#endif",envmap_pars_fragment:"#ifdef USE_ENVMAP\n\tuniform float reflectivity;\n\t#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG )\n\t\t#define ENV_WORLDPOS\n\t#endif\n\t#ifdef ENV_WORLDPOS\n\t\tvarying vec3 vWorldPosition;\n\t\tuniform float refractionRatio;\n\t#else\n\t\tvarying vec3 vReflect;\n\t#endif\n#endif",envmap_pars_vertex:"#ifdef USE_ENVMAP\n\t#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) ||defined( PHONG )\n\t\t#define ENV_WORLDPOS\n\t#endif\n\t#ifdef ENV_WORLDPOS\n\t\t\n\t\tvarying vec3 vWorldPosition;\n\t#else\n\t\tvarying vec3 vReflect;\n\t\tuniform float refractionRatio;\n\t#endif\n#endif",envmap_physical_pars_fragment:"#if defined( USE_ENVMAP )\n\t#ifdef ENVMAP_MODE_REFRACTION\n\t\tuniform float refractionRatio;\n\t#endif\n\tvec3 getIBLIrradiance( const in vec3 normal ) {\n\t\t#if defined( ENVMAP_TYPE_CUBE_UV )\n\t\t\tvec3 worldNormal = inverseTransformDirection( normal, viewMatrix );\n\t\t\tvec4 envMapColor = textureCubeUV( envMap, worldNormal, 1.0 );\n\t\t\treturn PI * envMapColor.rgb * envMapIntensity;\n\t\t#else\n\t\t\treturn vec3( 0.0 );\n\t\t#endif\n\t}\n\tvec3 getIBLRadiance( const in vec3 viewDir, const in vec3 normal, const in float roughness ) {\n\t\t#if defined( ENVMAP_TYPE_CUBE_UV )\n\t\t\tvec3 reflectVec;\n\t\t\t#ifdef ENVMAP_MODE_REFLECTION\n\t\t\t\treflectVec = reflect( - viewDir, normal );\n\t\t\t\treflectVec = normalize( mix( reflectVec, normal, roughness * roughness) );\n\t\t\t#else\n\t\t\t\treflectVec = refract( - viewDir, normal, refractionRatio );\n\t\t\t#endif\n\t\t\treflectVec = inverseTransformDirection( reflectVec, viewMatrix );\n\t\t\tvec4 envMapColor = textureCubeUV( envMap, reflectVec, roughness );\n\t\t\treturn envMapColor.rgb * envMapIntensity;\n\t\t#else\n\t\t\treturn vec3( 0.0 );\n\t\t#endif\n\t}\n#endif",envmap_vertex:"#ifdef USE_ENVMAP\n\t#ifdef ENV_WORLDPOS\n\t\tvWorldPosition = worldPosition.xyz;\n\t#else\n\t\tvec3 cameraToVertex;\n\t\tif ( isOrthographic ) {\n\t\t\tcameraToVertex = normalize( vec3( - viewMatrix[ 0 ][ 2 ], - viewMatrix[ 1 ][ 2 ], - viewMatrix[ 2 ][ 2 ] ) );\n\t\t} else {\n\t\t\tcameraToVertex = normalize( worldPosition.xyz - cameraPosition );\n\t\t}\n\t\tvec3 worldNormal = inverseTransformDirection( transformedNormal, viewMatrix );\n\t\t#ifdef ENVMAP_MODE_REFLECTION\n\t\t\tvReflect = reflect( cameraToVertex, worldNormal );\n\t\t#else\n\t\t\tvReflect = refract( cameraToVertex, worldNormal, refractionRatio );\n\t\t#endif\n\t#endif\n#endif",fog_vertex:"#ifdef USE_FOG\n\tvFogDepth = - mvPosition.z;\n#endif",fog_pars_vertex:"#ifdef USE_FOG\n\tvarying float vFogDepth;\n#endif",fog_fragment:"#ifdef USE_FOG\n\t#ifdef FOG_EXP2\n\t\tfloat fogFactor = 1.0 - exp( - fogDensity * fogDensity * vFogDepth * vFogDepth );\n\t#else\n\t\tfloat fogFactor = smoothstep( fogNear, fogFar, vFogDepth );\n\t#endif\n\tgl_FragColor.rgb = mix( gl_FragColor.rgb, fogColor, fogFactor );\n#endif",fog_pars_fragment:"#ifdef USE_FOG\n\tuniform vec3 fogColor;\n\tvarying float vFogDepth;\n\t#ifdef FOG_EXP2\n\t\tuniform float fogDensity;\n\t#else\n\t\tuniform float fogNear;\n\t\tuniform float fogFar;\n\t#endif\n#endif",gradientmap_pars_fragment:"#ifdef USE_GRADIENTMAP\n\tuniform sampler2D gradientMap;\n#endif\nvec3 getGradientIrradiance( vec3 normal, vec3 lightDirection ) {\n\tfloat dotNL = dot( normal, lightDirection );\n\tvec2 coord = vec2( dotNL * 0.5 + 0.5, 0.0 );\n\t#ifdef USE_GRADIENTMAP\n\t\treturn texture2D( gradientMap, coord ).rgb;\n\t#else\n\t\treturn ( coord.x < 0.7 ) ? vec3( 0.7 ) : vec3( 1.0 );\n\t#endif\n}",lightmap_fragment:"#ifdef USE_LIGHTMAP\n\tvec4 lightMapTexel = texture2D( lightMap, vUv2 );\n\tvec3 lightMapIrradiance = lightMapTexelToLinear( lightMapTexel ).rgb * lightMapIntensity;\n\t#ifndef PHYSICALLY_CORRECT_LIGHTS\n\t\tlightMapIrradiance *= PI;\n\t#endif\n\treflectedLight.indirectDiffuse += lightMapIrradiance;\n#endif",lightmap_pars_fragment:"#ifdef USE_LIGHTMAP\n\tuniform sampler2D lightMap;\n\tuniform float lightMapIntensity;\n#endif",lights_lambert_vertex:"vec3 diffuse = vec3( 1.0 );\nGeometricContext geometry;\ngeometry.position = mvPosition.xyz;\ngeometry.normal = normalize( transformedNormal );\ngeometry.viewDir = ( isOrthographic ) ? vec3( 0, 0, 1 ) : normalize( -mvPosition.xyz );\nGeometricContext backGeometry;\nbackGeometry.position = geometry.position;\nbackGeometry.normal = -geometry.normal;\nbackGeometry.viewDir = geometry.viewDir;\nvLightFront = vec3( 0.0 );\nvIndirectFront = vec3( 0.0 );\n#ifdef DOUBLE_SIDED\n\tvLightBack = vec3( 0.0 );\n\tvIndirectBack = vec3( 0.0 );\n#endif\nIncidentLight directLight;\nfloat dotNL;\nvec3 directLightColor_Diffuse;\nvIndirectFront += getAmbientLightIrradiance( ambientLightColor );\nvIndirectFront += getLightProbeIrradiance( lightProbe, geometry.normal );\n#ifdef DOUBLE_SIDED\n\tvIndirectBack += getAmbientLightIrradiance( ambientLightColor );\n\tvIndirectBack += getLightProbeIrradiance( lightProbe, backGeometry.normal );\n#endif\n#if NUM_POINT_LIGHTS > 0\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_POINT_LIGHTS; i ++ ) {\n\t\tgetPointLightInfo( pointLights[ i ], geometry, directLight );\n\t\tdotNL = dot( geometry.normal, directLight.direction );\n\t\tdirectLightColor_Diffuse = directLight.color;\n\t\tvLightFront += saturate( dotNL ) * directLightColor_Diffuse;\n\t\t#ifdef DOUBLE_SIDED\n\t\t\tvLightBack += saturate( - dotNL ) * directLightColor_Diffuse;\n\t\t#endif\n\t}\n\t#pragma unroll_loop_end\n#endif\n#if NUM_SPOT_LIGHTS > 0\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_SPOT_LIGHTS; i ++ ) {\n\t\tgetSpotLightInfo( spotLights[ i ], geometry, directLight );\n\t\tdotNL = dot( geometry.normal, directLight.direction );\n\t\tdirectLightColor_Diffuse = directLight.color;\n\t\tvLightFront += saturate( dotNL ) * directLightColor_Diffuse;\n\t\t#ifdef DOUBLE_SIDED\n\t\t\tvLightBack += saturate( - dotNL ) * directLightColor_Diffuse;\n\t\t#endif\n\t}\n\t#pragma unroll_loop_end\n#endif\n#if NUM_DIR_LIGHTS > 0\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_DIR_LIGHTS; i ++ ) {\n\t\tgetDirectionalLightInfo( directionalLights[ i ], geometry, directLight );\n\t\tdotNL = dot( geometry.normal, directLight.direction );\n\t\tdirectLightColor_Diffuse = directLight.color;\n\t\tvLightFront += saturate( dotNL ) * directLightColor_Diffuse;\n\t\t#ifdef DOUBLE_SIDED\n\t\t\tvLightBack += saturate( - dotNL ) * directLightColor_Diffuse;\n\t\t#endif\n\t}\n\t#pragma unroll_loop_end\n#endif\n#if NUM_HEMI_LIGHTS > 0\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_HEMI_LIGHTS; i ++ ) {\n\t\tvIndirectFront += getHemisphereLightIrradiance( hemisphereLights[ i ], geometry.normal );\n\t\t#ifdef DOUBLE_SIDED\n\t\t\tvIndirectBack += getHemisphereLightIrradiance( hemisphereLights[ i ], backGeometry.normal );\n\t\t#endif\n\t}\n\t#pragma unroll_loop_end\n#endif",lights_pars_begin:"uniform bool receiveShadow;\nuniform vec3 ambientLightColor;\nuniform vec3 lightProbe[ 9 ];\nvec3 shGetIrradianceAt( in vec3 normal, in vec3 shCoefficients[ 9 ] ) {\n\tfloat x = normal.x, y = normal.y, z = normal.z;\n\tvec3 result = shCoefficients[ 0 ] * 0.886227;\n\tresult += shCoefficients[ 1 ] * 2.0 * 0.511664 * y;\n\tresult += shCoefficients[ 2 ] * 2.0 * 0.511664 * z;\n\tresult += shCoefficients[ 3 ] * 2.0 * 0.511664 * x;\n\tresult += shCoefficients[ 4 ] * 2.0 * 0.429043 * x * y;\n\tresult += shCoefficients[ 5 ] * 2.0 * 0.429043 * y * z;\n\tresult += shCoefficients[ 6 ] * ( 0.743125 * z * z - 0.247708 );\n\tresult += shCoefficients[ 7 ] * 2.0 * 0.429043 * x * z;\n\tresult += shCoefficients[ 8 ] * 0.429043 * ( x * x - y * y );\n\treturn result;\n}\nvec3 getLightProbeIrradiance( const in vec3 lightProbe[ 9 ], const in vec3 normal ) {\n\tvec3 worldNormal = inverseTransformDirection( normal, viewMatrix );\n\tvec3 irradiance = shGetIrradianceAt( worldNormal, lightProbe );\n\treturn irradiance;\n}\nvec3 getAmbientLightIrradiance( const in vec3 ambientLightColor ) {\n\tvec3 irradiance = ambientLightColor;\n\treturn irradiance;\n}\nfloat getDistanceAttenuation( const in float lightDistance, const in float cutoffDistance, const in float decayExponent ) {\n\t#if defined ( PHYSICALLY_CORRECT_LIGHTS )\n\t\tfloat distanceFalloff = 1.0 / max( pow( lightDistance, decayExponent ), 0.01 );\n\t\tif ( cutoffDistance > 0.0 ) {\n\t\t\tdistanceFalloff *= pow2( saturate( 1.0 - pow4( lightDistance / cutoffDistance ) ) );\n\t\t}\n\t\treturn distanceFalloff;\n\t#else\n\t\tif ( cutoffDistance > 0.0 && decayExponent > 0.0 ) {\n\t\t\treturn pow( saturate( - lightDistance / cutoffDistance + 1.0 ), decayExponent );\n\t\t}\n\t\treturn 1.0;\n\t#endif\n}\nfloat getSpotAttenuation( const in float coneCosine, const in float penumbraCosine, const in float angleCosine ) {\n\treturn smoothstep( coneCosine, penumbraCosine, angleCosine );\n}\n#if NUM_DIR_LIGHTS > 0\n\tstruct DirectionalLight {\n\t\tvec3 direction;\n\t\tvec3 color;\n\t};\n\tuniform DirectionalLight directionalLights[ NUM_DIR_LIGHTS ];\n\tvoid getDirectionalLightInfo( const in DirectionalLight directionalLight, const in GeometricContext geometry, out IncidentLight light ) {\n\t\tlight.color = directionalLight.color;\n\t\tlight.direction = directionalLight.direction;\n\t\tlight.visible = true;\n\t}\n#endif\n#if NUM_POINT_LIGHTS > 0\n\tstruct PointLight {\n\t\tvec3 position;\n\t\tvec3 color;\n\t\tfloat distance;\n\t\tfloat decay;\n\t};\n\tuniform PointLight pointLights[ NUM_POINT_LIGHTS ];\n\tvoid getPointLightInfo( const in PointLight pointLight, const in GeometricContext geometry, out IncidentLight light ) {\n\t\tvec3 lVector = pointLight.position - geometry.position;\n\t\tlight.direction = normalize( lVector );\n\t\tfloat lightDistance = length( lVector );\n\t\tlight.color = pointLight.color;\n\t\tlight.color *= getDistanceAttenuation( lightDistance, pointLight.distance, pointLight.decay );\n\t\tlight.visible = ( light.color != vec3( 0.0 ) );\n\t}\n#endif\n#if NUM_SPOT_LIGHTS > 0\n\tstruct SpotLight {\n\t\tvec3 position;\n\t\tvec3 direction;\n\t\tvec3 color;\n\t\tfloat distance;\n\t\tfloat decay;\n\t\tfloat coneCos;\n\t\tfloat penumbraCos;\n\t};\n\tuniform SpotLight spotLights[ NUM_SPOT_LIGHTS ];\n\tvoid getSpotLightInfo( const in SpotLight spotLight, const in GeometricContext geometry, out IncidentLight light ) {\n\t\tvec3 lVector = spotLight.position - geometry.position;\n\t\tlight.direction = normalize( lVector );\n\t\tfloat angleCos = dot( light.direction, spotLight.direction );\n\t\tfloat spotAttenuation = getSpotAttenuation( spotLight.coneCos, spotLight.penumbraCos, angleCos );\n\t\tif ( spotAttenuation > 0.0 ) {\n\t\t\tfloat lightDistance = length( lVector );\n\t\t\tlight.color = spotLight.color * spotAttenuation;\n\t\t\tlight.color *= getDistanceAttenuation( lightDistance, spotLight.distance, spotLight.decay );\n\t\t\tlight.visible = ( light.color != vec3( 0.0 ) );\n\t\t} else {\n\t\t\tlight.color = vec3( 0.0 );\n\t\t\tlight.visible = false;\n\t\t}\n\t}\n#endif\n#if NUM_RECT_AREA_LIGHTS > 0\n\tstruct RectAreaLight {\n\t\tvec3 color;\n\t\tvec3 position;\n\t\tvec3 halfWidth;\n\t\tvec3 halfHeight;\n\t};\n\tuniform sampler2D ltc_1;\tuniform sampler2D ltc_2;\n\tuniform RectAreaLight rectAreaLights[ NUM_RECT_AREA_LIGHTS ];\n#endif\n#if NUM_HEMI_LIGHTS > 0\n\tstruct HemisphereLight {\n\t\tvec3 direction;\n\t\tvec3 skyColor;\n\t\tvec3 groundColor;\n\t};\n\tuniform HemisphereLight hemisphereLights[ NUM_HEMI_LIGHTS ];\n\tvec3 getHemisphereLightIrradiance( const in HemisphereLight hemiLight, const in vec3 normal ) {\n\t\tfloat dotNL = dot( normal, hemiLight.direction );\n\t\tfloat hemiDiffuseWeight = 0.5 * dotNL + 0.5;\n\t\tvec3 irradiance = mix( hemiLight.groundColor, hemiLight.skyColor, hemiDiffuseWeight );\n\t\treturn irradiance;\n\t}\n#endif",lights_toon_fragment:"ToonMaterial material;\nmaterial.diffuseColor = diffuseColor.rgb;",lights_toon_pars_fragment:"varying vec3 vViewPosition;\nstruct ToonMaterial {\n\tvec3 diffuseColor;\n};\nvoid RE_Direct_Toon( const in IncidentLight directLight, const in GeometricContext geometry, const in ToonMaterial material, inout ReflectedLight reflectedLight ) {\n\tvec3 irradiance = getGradientIrradiance( geometry.normal, directLight.direction ) * directLight.color;\n\treflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n}\nvoid RE_IndirectDiffuse_Toon( const in vec3 irradiance, const in GeometricContext geometry, const in ToonMaterial material, inout ReflectedLight reflectedLight ) {\n\treflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n}\n#define RE_Direct\t\t\t\tRE_Direct_Toon\n#define RE_IndirectDiffuse\t\tRE_IndirectDiffuse_Toon\n#define Material_LightProbeLOD( material )\t(0)",lights_phong_fragment:"BlinnPhongMaterial material;\nmaterial.diffuseColor = diffuseColor.rgb;\nmaterial.specularColor = specular;\nmaterial.specularShininess = shininess;\nmaterial.specularStrength = specularStrength;",lights_phong_pars_fragment:"varying vec3 vViewPosition;\nstruct BlinnPhongMaterial {\n\tvec3 diffuseColor;\n\tvec3 specularColor;\n\tfloat specularShininess;\n\tfloat specularStrength;\n};\nvoid RE_Direct_BlinnPhong( const in IncidentLight directLight, const in GeometricContext geometry, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {\n\tfloat dotNL = saturate( dot( geometry.normal, directLight.direction ) );\n\tvec3 irradiance = dotNL * directLight.color;\n\treflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n\treflectedLight.directSpecular += irradiance * BRDF_BlinnPhong( directLight.direction, geometry.viewDir, geometry.normal, material.specularColor, material.specularShininess ) * material.specularStrength;\n}\nvoid RE_IndirectDiffuse_BlinnPhong( const in vec3 irradiance, const in GeometricContext geometry, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {\n\treflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n}\n#define RE_Direct\t\t\t\tRE_Direct_BlinnPhong\n#define RE_IndirectDiffuse\t\tRE_IndirectDiffuse_BlinnPhong\n#define Material_LightProbeLOD( material )\t(0)",lights_physical_fragment:"PhysicalMaterial material;\nmaterial.diffuseColor = diffuseColor.rgb * ( 1.0 - metalnessFactor );\nvec3 dxy = max( abs( dFdx( geometryNormal ) ), abs( dFdy( geometryNormal ) ) );\nfloat geometryRoughness = max( max( dxy.x, dxy.y ), dxy.z );\nmaterial.roughness = max( roughnessFactor, 0.0525 );material.roughness += geometryRoughness;\nmaterial.roughness = min( material.roughness, 1.0 );\n#ifdef IOR\n\t#ifdef SPECULAR\n\t\tfloat specularIntensityFactor = specularIntensity;\n\t\tvec3 specularColorFactor = specularColor;\n\t\t#ifdef USE_SPECULARINTENSITYMAP\n\t\t\tspecularIntensityFactor *= texture2D( specularIntensityMap, vUv ).a;\n\t\t#endif\n\t\t#ifdef USE_SPECULARCOLORMAP\n\t\t\tspecularColorFactor *= specularColorMapTexelToLinear( texture2D( specularColorMap, vUv ) ).rgb;\n\t\t#endif\n\t\tmaterial.specularF90 = mix( specularIntensityFactor, 1.0, metalnessFactor );\n\t#else\n\t\tfloat specularIntensityFactor = 1.0;\n\t\tvec3 specularColorFactor = vec3( 1.0 );\n\t\tmaterial.specularF90 = 1.0;\n\t#endif\n\tmaterial.specularColor = mix( min( pow2( ( ior - 1.0 ) / ( ior + 1.0 ) ) * specularColorFactor, vec3( 1.0 ) ) * specularIntensityFactor, diffuseColor.rgb, metalnessFactor );\n#else\n\tmaterial.specularColor = mix( vec3( 0.04 ), diffuseColor.rgb, metalnessFactor );\n\tmaterial.specularF90 = 1.0;\n#endif\n#ifdef USE_CLEARCOAT\n\tmaterial.clearcoat = clearcoat;\n\tmaterial.clearcoatRoughness = clearcoatRoughness;\n\tmaterial.clearcoatF0 = vec3( 0.04 );\n\tmaterial.clearcoatF90 = 1.0;\n\t#ifdef USE_CLEARCOATMAP\n\t\tmaterial.clearcoat *= texture2D( clearcoatMap, vUv ).x;\n\t#endif\n\t#ifdef USE_CLEARCOAT_ROUGHNESSMAP\n\t\tmaterial.clearcoatRoughness *= texture2D( clearcoatRoughnessMap, vUv ).y;\n\t#endif\n\tmaterial.clearcoat = saturate( material.clearcoat );\tmaterial.clearcoatRoughness = max( material.clearcoatRoughness, 0.0525 );\n\tmaterial.clearcoatRoughness += geometryRoughness;\n\tmaterial.clearcoatRoughness = min( material.clearcoatRoughness, 1.0 );\n#endif\n#ifdef USE_SHEEN\n\tmaterial.sheenColor = sheenColor;\n\t#ifdef USE_SHEENCOLORMAP\n\t\tmaterial.sheenColor *= sheenColorMapTexelToLinear( texture2D( sheenColorMap, vUv ) ).rgb;\n\t#endif\n\tmaterial.sheenRoughness = clamp( sheenRoughness, 0.07, 1.0 );\n\t#ifdef USE_SHEENROUGHNESSMAP\n\t\tmaterial.sheenRoughness *= texture2D( sheenRoughnessMap, vUv ).a;\n\t#endif\n#endif",lights_physical_pars_fragment:"struct PhysicalMaterial {\n\tvec3 diffuseColor;\n\tfloat roughness;\n\tvec3 specularColor;\n\tfloat specularF90;\n\t#ifdef USE_CLEARCOAT\n\t\tfloat clearcoat;\n\t\tfloat clearcoatRoughness;\n\t\tvec3 clearcoatF0;\n\t\tfloat clearcoatF90;\n\t#endif\n\t#ifdef USE_SHEEN\n\t\tvec3 sheenColor;\n\t\tfloat sheenRoughness;\n\t#endif\n};\nvec3 clearcoatSpecular = vec3( 0.0 );\nvec2 DFGApprox( const in vec3 normal, const in vec3 viewDir, const in float roughness ) {\n\tfloat dotNV = saturate( dot( normal, viewDir ) );\n\tconst vec4 c0 = vec4( - 1, - 0.0275, - 0.572, 0.022 );\n\tconst vec4 c1 = vec4( 1, 0.0425, 1.04, - 0.04 );\n\tvec4 r = roughness * c0 + c1;\n\tfloat a004 = min( r.x * r.x, exp2( - 9.28 * dotNV ) ) * r.x + r.y;\n\tvec2 fab = vec2( - 1.04, 1.04 ) * a004 + r.zw;\n\treturn fab;\n}\nvec3 EnvironmentBRDF( const in vec3 normal, const in vec3 viewDir, const in vec3 specularColor, const in float specularF90, const in float roughness ) {\n\tvec2 fab = DFGApprox( normal, viewDir, roughness );\n\treturn specularColor * fab.x + specularF90 * fab.y;\n}\nvoid computeMultiscattering( const in vec3 normal, const in vec3 viewDir, const in vec3 specularColor, const in float specularF90, const in float roughness, inout vec3 singleScatter, inout vec3 multiScatter ) {\n\tvec2 fab = DFGApprox( normal, viewDir, roughness );\n\tvec3 FssEss = specularColor * fab.x + specularF90 * fab.y;\n\tfloat Ess = fab.x + fab.y;\n\tfloat Ems = 1.0 - Ess;\n\tvec3 Favg = specularColor + ( 1.0 - specularColor ) * 0.047619;\tvec3 Fms = FssEss * Favg / ( 1.0 - Ems * Favg );\n\tsingleScatter += FssEss;\n\tmultiScatter += Fms * Ems;\n}\n#if NUM_RECT_AREA_LIGHTS > 0\n\tvoid RE_Direct_RectArea_Physical( const in RectAreaLight rectAreaLight, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {\n\t\tvec3 normal = geometry.normal;\n\t\tvec3 viewDir = geometry.viewDir;\n\t\tvec3 position = geometry.position;\n\t\tvec3 lightPos = rectAreaLight.position;\n\t\tvec3 halfWidth = rectAreaLight.halfWidth;\n\t\tvec3 halfHeight = rectAreaLight.halfHeight;\n\t\tvec3 lightColor = rectAreaLight.color;\n\t\tfloat roughness = material.roughness;\n\t\tvec3 rectCoords[ 4 ];\n\t\trectCoords[ 0 ] = lightPos + halfWidth - halfHeight;\t\trectCoords[ 1 ] = lightPos - halfWidth - halfHeight;\n\t\trectCoords[ 2 ] = lightPos - halfWidth + halfHeight;\n\t\trectCoords[ 3 ] = lightPos + halfWidth + halfHeight;\n\t\tvec2 uv = LTC_Uv( normal, viewDir, roughness );\n\t\tvec4 t1 = texture2D( ltc_1, uv );\n\t\tvec4 t2 = texture2D( ltc_2, uv );\n\t\tmat3 mInv = mat3(\n\t\t\tvec3( t1.x, 0, t1.y ),\n\t\t\tvec3(    0, 1,    0 ),\n\t\t\tvec3( t1.z, 0, t1.w )\n\t\t);\n\t\tvec3 fresnel = ( material.specularColor * t2.x + ( vec3( 1.0 ) - material.specularColor ) * t2.y );\n\t\treflectedLight.directSpecular += lightColor * fresnel * LTC_Evaluate( normal, viewDir, position, mInv, rectCoords );\n\t\treflectedLight.directDiffuse += lightColor * material.diffuseColor * LTC_Evaluate( normal, viewDir, position, mat3( 1.0 ), rectCoords );\n\t}\n#endif\nvoid RE_Direct_Physical( const in IncidentLight directLight, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {\n\tfloat dotNL = saturate( dot( geometry.normal, directLight.direction ) );\n\tvec3 irradiance = dotNL * directLight.color;\n\t#ifdef USE_CLEARCOAT\n\t\tfloat dotNLcc = saturate( dot( geometry.clearcoatNormal, directLight.direction ) );\n\t\tvec3 ccIrradiance = dotNLcc * directLight.color;\n\t\tclearcoatSpecular += ccIrradiance * BRDF_GGX( directLight.direction, geometry.viewDir, geometry.clearcoatNormal, material.clearcoatF0, material.clearcoatF90, material.clearcoatRoughness );\n\t#endif\n\t#ifdef USE_SHEEN\n\t\treflectedLight.directSpecular += irradiance * BRDF_Sheen( directLight.direction, geometry.viewDir, geometry.normal, material.sheenColor, material.sheenRoughness );\n\t#endif\n\treflectedLight.directSpecular += irradiance * BRDF_GGX( directLight.direction, geometry.viewDir, geometry.normal, material.specularColor, material.specularF90, material.roughness );\n\treflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n}\nvoid RE_IndirectDiffuse_Physical( const in vec3 irradiance, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {\n\treflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n}\nvoid RE_IndirectSpecular_Physical( const in vec3 radiance, const in vec3 irradiance, const in vec3 clearcoatRadiance, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight) {\n\t#ifdef USE_CLEARCOAT\n\t\tclearcoatSpecular += clearcoatRadiance * EnvironmentBRDF( geometry.clearcoatNormal, geometry.viewDir, material.clearcoatF0, material.clearcoatF90, material.clearcoatRoughness );\n\t#endif\n\tvec3 singleScattering = vec3( 0.0 );\n\tvec3 multiScattering = vec3( 0.0 );\n\tvec3 cosineWeightedIrradiance = irradiance * RECIPROCAL_PI;\n\tcomputeMultiscattering( geometry.normal, geometry.viewDir, material.specularColor, material.specularF90, material.roughness, singleScattering, multiScattering );\n\tvec3 diffuse = material.diffuseColor * ( 1.0 - ( singleScattering + multiScattering ) );\n\treflectedLight.indirectSpecular += radiance * singleScattering;\n\treflectedLight.indirectSpecular += multiScattering * cosineWeightedIrradiance;\n\treflectedLight.indirectDiffuse += diffuse * cosineWeightedIrradiance;\n}\n#define RE_Direct\t\t\t\tRE_Direct_Physical\n#define RE_Direct_RectArea\t\tRE_Direct_RectArea_Physical\n#define RE_IndirectDiffuse\t\tRE_IndirectDiffuse_Physical\n#define RE_IndirectSpecular\t\tRE_IndirectSpecular_Physical\nfloat computeSpecularOcclusion( const in float dotNV, const in float ambientOcclusion, const in float roughness ) {\n\treturn saturate( pow( dotNV + ambientOcclusion, exp2( - 16.0 * roughness - 1.0 ) ) - 1.0 + ambientOcclusion );\n}",lights_fragment_begin:"\nGeometricContext geometry;\ngeometry.position = - vViewPosition;\ngeometry.normal = normal;\ngeometry.viewDir = ( isOrthographic ) ? vec3( 0, 0, 1 ) : normalize( vViewPosition );\n#ifdef USE_CLEARCOAT\n\tgeometry.clearcoatNormal = clearcoatNormal;\n#endif\nIncidentLight directLight;\n#if ( NUM_POINT_LIGHTS > 0 ) && defined( RE_Direct )\n\tPointLight pointLight;\n\t#if defined( USE_SHADOWMAP ) && NUM_POINT_LIGHT_SHADOWS > 0\n\tPointLightShadow pointLightShadow;\n\t#endif\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_POINT_LIGHTS; i ++ ) {\n\t\tpointLight = pointLights[ i ];\n\t\tgetPointLightInfo( pointLight, geometry, directLight );\n\t\t#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_POINT_LIGHT_SHADOWS )\n\t\tpointLightShadow = pointLightShadows[ i ];\n\t\tdirectLight.color *= all( bvec2( directLight.visible, receiveShadow ) ) ? getPointShadow( pointShadowMap[ i ], pointLightShadow.shadowMapSize, pointLightShadow.shadowBias, pointLightShadow.shadowRadius, vPointShadowCoord[ i ], pointLightShadow.shadowCameraNear, pointLightShadow.shadowCameraFar ) : 1.0;\n\t\t#endif\n\t\tRE_Direct( directLight, geometry, material, reflectedLight );\n\t}\n\t#pragma unroll_loop_end\n#endif\n#if ( NUM_SPOT_LIGHTS > 0 ) && defined( RE_Direct )\n\tSpotLight spotLight;\n\t#if defined( USE_SHADOWMAP ) && NUM_SPOT_LIGHT_SHADOWS > 0\n\tSpotLightShadow spotLightShadow;\n\t#endif\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_SPOT_LIGHTS; i ++ ) {\n\t\tspotLight = spotLights[ i ];\n\t\tgetSpotLightInfo( spotLight, geometry, directLight );\n\t\t#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS )\n\t\tspotLightShadow = spotLightShadows[ i ];\n\t\tdirectLight.color *= all( bvec2( directLight.visible, receiveShadow ) ) ? getShadow( spotShadowMap[ i ], spotLightShadow.shadowMapSize, spotLightShadow.shadowBias, spotLightShadow.shadowRadius, vSpotShadowCoord[ i ] ) : 1.0;\n\t\t#endif\n\t\tRE_Direct( directLight, geometry, material, reflectedLight );\n\t}\n\t#pragma unroll_loop_end\n#endif\n#if ( NUM_DIR_LIGHTS > 0 ) && defined( RE_Direct )\n\tDirectionalLight directionalLight;\n\t#if defined( USE_SHADOWMAP ) && NUM_DIR_LIGHT_SHADOWS > 0\n\tDirectionalLightShadow directionalLightShadow;\n\t#endif\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_DIR_LIGHTS; i ++ ) {\n\t\tdirectionalLight = directionalLights[ i ];\n\t\tgetDirectionalLightInfo( directionalLight, geometry, directLight );\n\t\t#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_DIR_LIGHT_SHADOWS )\n\t\tdirectionalLightShadow = directionalLightShadows[ i ];\n\t\tdirectLight.color *= all( bvec2( directLight.visible, receiveShadow ) ) ? getShadow( directionalShadowMap[ i ], directionalLightShadow.shadowMapSize, directionalLightShadow.shadowBias, directionalLightShadow.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;\n\t\t#endif\n\t\tRE_Direct( directLight, geometry, material, reflectedLight );\n\t}\n\t#pragma unroll_loop_end\n#endif\n#if ( NUM_RECT_AREA_LIGHTS > 0 ) && defined( RE_Direct_RectArea )\n\tRectAreaLight rectAreaLight;\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_RECT_AREA_LIGHTS; i ++ ) {\n\t\trectAreaLight = rectAreaLights[ i ];\n\t\tRE_Direct_RectArea( rectAreaLight, geometry, material, reflectedLight );\n\t}\n\t#pragma unroll_loop_end\n#endif\n#if defined( RE_IndirectDiffuse )\n\tvec3 iblIrradiance = vec3( 0.0 );\n\tvec3 irradiance = getAmbientLightIrradiance( ambientLightColor );\n\tirradiance += getLightProbeIrradiance( lightProbe, geometry.normal );\n\t#if ( NUM_HEMI_LIGHTS > 0 )\n\t\t#pragma unroll_loop_start\n\t\tfor ( int i = 0; i < NUM_HEMI_LIGHTS; i ++ ) {\n\t\t\tirradiance += getHemisphereLightIrradiance( hemisphereLights[ i ], geometry.normal );\n\t\t}\n\t\t#pragma unroll_loop_end\n\t#endif\n#endif\n#if defined( RE_IndirectSpecular )\n\tvec3 radiance = vec3( 0.0 );\n\tvec3 clearcoatRadiance = vec3( 0.0 );\n#endif",lights_fragment_maps:"#if defined( RE_IndirectDiffuse )\n\t#ifdef USE_LIGHTMAP\n\t\tvec4 lightMapTexel = texture2D( lightMap, vUv2 );\n\t\tvec3 lightMapIrradiance = lightMapTexelToLinear( lightMapTexel ).rgb * lightMapIntensity;\n\t\t#ifndef PHYSICALLY_CORRECT_LIGHTS\n\t\t\tlightMapIrradiance *= PI;\n\t\t#endif\n\t\tirradiance += lightMapIrradiance;\n\t#endif\n\t#if defined( USE_ENVMAP ) && defined( STANDARD ) && defined( ENVMAP_TYPE_CUBE_UV )\n\t\tiblIrradiance += getIBLIrradiance( geometry.normal );\n\t#endif\n#endif\n#if defined( USE_ENVMAP ) && defined( RE_IndirectSpecular )\n\tradiance += getIBLRadiance( geometry.viewDir, geometry.normal, material.roughness );\n\t#ifdef USE_CLEARCOAT\n\t\tclearcoatRadiance += getIBLRadiance( geometry.viewDir, geometry.clearcoatNormal, material.clearcoatRoughness );\n\t#endif\n#endif",lights_fragment_end:"#if defined( RE_IndirectDiffuse )\n\tRE_IndirectDiffuse( irradiance, geometry, material, reflectedLight );\n#endif\n#if defined( RE_IndirectSpecular )\n\tRE_IndirectSpecular( radiance, iblIrradiance, clearcoatRadiance, geometry, material, reflectedLight );\n#endif",logdepthbuf_fragment:"#if defined( USE_LOGDEPTHBUF ) && defined( USE_LOGDEPTHBUF_EXT )\n\tgl_FragDepthEXT = vIsPerspective == 0.0 ? gl_FragCoord.z : log2( vFragDepth ) * logDepthBufFC * 0.5;\n#endif",logdepthbuf_pars_fragment:"#if defined( USE_LOGDEPTHBUF ) && defined( USE_LOGDEPTHBUF_EXT )\n\tuniform float logDepthBufFC;\n\tvarying float vFragDepth;\n\tvarying float vIsPerspective;\n#endif",logdepthbuf_pars_vertex:"#ifdef USE_LOGDEPTHBUF\n\t#ifdef USE_LOGDEPTHBUF_EXT\n\t\tvarying float vFragDepth;\n\t\tvarying float vIsPerspective;\n\t#else\n\t\tuniform float logDepthBufFC;\n\t#endif\n#endif",logdepthbuf_vertex:"#ifdef USE_LOGDEPTHBUF\n\t#ifdef USE_LOGDEPTHBUF_EXT\n\t\tvFragDepth = 1.0 + gl_Position.w;\n\t\tvIsPerspective = float( isPerspectiveMatrix( projectionMatrix ) );\n\t#else\n\t\tif ( isPerspectiveMatrix( projectionMatrix ) ) {\n\t\t\tgl_Position.z = log2( max( EPSILON, gl_Position.w + 1.0 ) ) * logDepthBufFC - 1.0;\n\t\t\tgl_Position.z *= gl_Position.w;\n\t\t}\n\t#endif\n#endif",map_fragment:"#ifdef USE_MAP\n\tvec4 texelColor = texture2D( map, vUv );\n\ttexelColor = mapTexelToLinear( texelColor );\n\tdiffuseColor *= texelColor;\n#endif",map_pars_fragment:"#ifdef USE_MAP\n\tuniform sampler2D map;\n#endif",map_particle_fragment:"#if defined( USE_MAP ) || defined( USE_ALPHAMAP )\n\tvec2 uv = ( uvTransform * vec3( gl_PointCoord.x, 1.0 - gl_PointCoord.y, 1 ) ).xy;\n#endif\n#ifdef USE_MAP\n\tvec4 mapTexel = texture2D( map, uv );\n\tdiffuseColor *= mapTexelToLinear( mapTexel );\n#endif\n#ifdef USE_ALPHAMAP\n\tdiffuseColor.a *= texture2D( alphaMap, uv ).g;\n#endif",map_particle_pars_fragment:"#if defined( USE_MAP ) || defined( USE_ALPHAMAP )\n\tuniform mat3 uvTransform;\n#endif\n#ifdef USE_MAP\n\tuniform sampler2D map;\n#endif\n#ifdef USE_ALPHAMAP\n\tuniform sampler2D alphaMap;\n#endif",metalnessmap_fragment:"float metalnessFactor = metalness;\n#ifdef USE_METALNESSMAP\n\tvec4 texelMetalness = texture2D( metalnessMap, vUv );\n\tmetalnessFactor *= texelMetalness.b;\n#endif",metalnessmap_pars_fragment:"#ifdef USE_METALNESSMAP\n\tuniform sampler2D metalnessMap;\n#endif",morphnormal_vertex:"#ifdef USE_MORPHNORMALS\n\tobjectNormal *= morphTargetBaseInfluence;\n\t#ifdef MORPHTARGETS_TEXTURE\n\t\tfor ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {\n\t\t\tif ( morphTargetInfluences[ i ] > 0.0 ) objectNormal += getMorph( gl_VertexID, i, 1, 2 ) * morphTargetInfluences[ i ];\n\t\t}\n\t#else\n\t\tobjectNormal += morphNormal0 * morphTargetInfluences[ 0 ];\n\t\tobjectNormal += morphNormal1 * morphTargetInfluences[ 1 ];\n\t\tobjectNormal += morphNormal2 * morphTargetInfluences[ 2 ];\n\t\tobjectNormal += morphNormal3 * morphTargetInfluences[ 3 ];\n\t#endif\n#endif",morphtarget_pars_vertex:"#ifdef USE_MORPHTARGETS\n\tuniform float morphTargetBaseInfluence;\n\t#ifdef MORPHTARGETS_TEXTURE\n\t\tuniform float morphTargetInfluences[ MORPHTARGETS_COUNT ];\n\t\tuniform sampler2DArray morphTargetsTexture;\n\t\tuniform vec2 morphTargetsTextureSize;\n\t\tvec3 getMorph( const in int vertexIndex, const in int morphTargetIndex, const in int offset, const in int stride ) {\n\t\t\tfloat texelIndex = float( vertexIndex * stride + offset );\n\t\t\tfloat y = floor( texelIndex / morphTargetsTextureSize.x );\n\t\t\tfloat x = texelIndex - y * morphTargetsTextureSize.x;\n\t\t\tvec3 morphUV = vec3( ( x + 0.5 ) / morphTargetsTextureSize.x, y / morphTargetsTextureSize.y, morphTargetIndex );\n\t\t\treturn texture( morphTargetsTexture, morphUV ).xyz;\n\t\t}\n\t#else\n\t\t#ifndef USE_MORPHNORMALS\n\t\t\tuniform float morphTargetInfluences[ 8 ];\n\t\t#else\n\t\t\tuniform float morphTargetInfluences[ 4 ];\n\t\t#endif\n\t#endif\n#endif",morphtarget_vertex:"#ifdef USE_MORPHTARGETS\n\ttransformed *= morphTargetBaseInfluence;\n\t#ifdef MORPHTARGETS_TEXTURE\n\t\tfor ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {\n\t\t\t#ifndef USE_MORPHNORMALS\n\t\t\t\tif ( morphTargetInfluences[ i ] > 0.0 ) transformed += getMorph( gl_VertexID, i, 0, 1 ) * morphTargetInfluences[ i ];\n\t\t\t#else\n\t\t\t\tif ( morphTargetInfluences[ i ] > 0.0 ) transformed += getMorph( gl_VertexID, i, 0, 2 ) * morphTargetInfluences[ i ];\n\t\t\t#endif\n\t\t}\n\t#else\n\t\ttransformed += morphTarget0 * morphTargetInfluences[ 0 ];\n\t\ttransformed += morphTarget1 * morphTargetInfluences[ 1 ];\n\t\ttransformed += morphTarget2 * morphTargetInfluences[ 2 ];\n\t\ttransformed += morphTarget3 * morphTargetInfluences[ 3 ];\n\t\t#ifndef USE_MORPHNORMALS\n\t\t\ttransformed += morphTarget4 * morphTargetInfluences[ 4 ];\n\t\t\ttransformed += morphTarget5 * morphTargetInfluences[ 5 ];\n\t\t\ttransformed += morphTarget6 * morphTargetInfluences[ 6 ];\n\t\t\ttransformed += morphTarget7 * morphTargetInfluences[ 7 ];\n\t\t#endif\n\t#endif\n#endif",normal_fragment_begin:"float faceDirection = gl_FrontFacing ? 1.0 : - 1.0;\n#ifdef FLAT_SHADED\n\tvec3 fdx = vec3( dFdx( vViewPosition.x ), dFdx( vViewPosition.y ), dFdx( vViewPosition.z ) );\n\tvec3 fdy = vec3( dFdy( vViewPosition.x ), dFdy( vViewPosition.y ), dFdy( vViewPosition.z ) );\n\tvec3 normal = normalize( cross( fdx, fdy ) );\n#else\n\tvec3 normal = normalize( vNormal );\n\t#ifdef DOUBLE_SIDED\n\t\tnormal = normal * faceDirection;\n\t#endif\n\t#ifdef USE_TANGENT\n\t\tvec3 tangent = normalize( vTangent );\n\t\tvec3 bitangent = normalize( vBitangent );\n\t\t#ifdef DOUBLE_SIDED\n\t\t\ttangent = tangent * faceDirection;\n\t\t\tbitangent = bitangent * faceDirection;\n\t\t#endif\n\t\t#if defined( TANGENTSPACE_NORMALMAP ) || defined( USE_CLEARCOAT_NORMALMAP )\n\t\t\tmat3 vTBN = mat3( tangent, bitangent, normal );\n\t\t#endif\n\t#endif\n#endif\nvec3 geometryNormal = normal;",normal_fragment_maps:"#ifdef OBJECTSPACE_NORMALMAP\n\tnormal = texture2D( normalMap, vUv ).xyz * 2.0 - 1.0;\n\t#ifdef FLIP_SIDED\n\t\tnormal = - normal;\n\t#endif\n\t#ifdef DOUBLE_SIDED\n\t\tnormal = normal * faceDirection;\n\t#endif\n\tnormal = normalize( normalMatrix * normal );\n#elif defined( TANGENTSPACE_NORMALMAP )\n\tvec3 mapN = texture2D( normalMap, vUv ).xyz * 2.0 - 1.0;\n\tmapN.xy *= normalScale;\n\t#ifdef USE_TANGENT\n\t\tnormal = normalize( vTBN * mapN );\n\t#else\n\t\tnormal = perturbNormal2Arb( - vViewPosition, normal, mapN, faceDirection );\n\t#endif\n#elif defined( USE_BUMPMAP )\n\tnormal = perturbNormalArb( - vViewPosition, normal, dHdxy_fwd(), faceDirection );\n#endif",normal_pars_fragment:"#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n\t#ifdef USE_TANGENT\n\t\tvarying vec3 vTangent;\n\t\tvarying vec3 vBitangent;\n\t#endif\n#endif",normal_pars_vertex:"#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n\t#ifdef USE_TANGENT\n\t\tvarying vec3 vTangent;\n\t\tvarying vec3 vBitangent;\n\t#endif\n#endif",normal_vertex:"#ifndef FLAT_SHADED\n\tvNormal = normalize( transformedNormal );\n\t#ifdef USE_TANGENT\n\t\tvTangent = normalize( transformedTangent );\n\t\tvBitangent = normalize( cross( vNormal, vTangent ) * tangent.w );\n\t#endif\n#endif",normalmap_pars_fragment:"#ifdef USE_NORMALMAP\n\tuniform sampler2D normalMap;\n\tuniform vec2 normalScale;\n#endif\n#ifdef OBJECTSPACE_NORMALMAP\n\tuniform mat3 normalMatrix;\n#endif\n#if ! defined ( USE_TANGENT ) && ( defined ( TANGENTSPACE_NORMALMAP ) || defined ( USE_CLEARCOAT_NORMALMAP ) )\n\tvec3 perturbNormal2Arb( vec3 eye_pos, vec3 surf_norm, vec3 mapN, float faceDirection ) {\n\t\tvec3 q0 = vec3( dFdx( eye_pos.x ), dFdx( eye_pos.y ), dFdx( eye_pos.z ) );\n\t\tvec3 q1 = vec3( dFdy( eye_pos.x ), dFdy( eye_pos.y ), dFdy( eye_pos.z ) );\n\t\tvec2 st0 = dFdx( vUv.st );\n\t\tvec2 st1 = dFdy( vUv.st );\n\t\tvec3 N = surf_norm;\n\t\tvec3 q1perp = cross( q1, N );\n\t\tvec3 q0perp = cross( N, q0 );\n\t\tvec3 T = q1perp * st0.x + q0perp * st1.x;\n\t\tvec3 B = q1perp * st0.y + q0perp * st1.y;\n\t\tfloat det = max( dot( T, T ), dot( B, B ) );\n\t\tfloat scale = ( det == 0.0 ) ? 0.0 : faceDirection * inversesqrt( det );\n\t\treturn normalize( T * ( mapN.x * scale ) + B * ( mapN.y * scale ) + N * mapN.z );\n\t}\n#endif",clearcoat_normal_fragment_begin:"#ifdef USE_CLEARCOAT\n\tvec3 clearcoatNormal = geometryNormal;\n#endif",clearcoat_normal_fragment_maps:"#ifdef USE_CLEARCOAT_NORMALMAP\n\tvec3 clearcoatMapN = texture2D( clearcoatNormalMap, vUv ).xyz * 2.0 - 1.0;\n\tclearcoatMapN.xy *= clearcoatNormalScale;\n\t#ifdef USE_TANGENT\n\t\tclearcoatNormal = normalize( vTBN * clearcoatMapN );\n\t#else\n\t\tclearcoatNormal = perturbNormal2Arb( - vViewPosition, clearcoatNormal, clearcoatMapN, faceDirection );\n\t#endif\n#endif",clearcoat_pars_fragment:"#ifdef USE_CLEARCOATMAP\n\tuniform sampler2D clearcoatMap;\n#endif\n#ifdef USE_CLEARCOAT_ROUGHNESSMAP\n\tuniform sampler2D clearcoatRoughnessMap;\n#endif\n#ifdef USE_CLEARCOAT_NORMALMAP\n\tuniform sampler2D clearcoatNormalMap;\n\tuniform vec2 clearcoatNormalScale;\n#endif",output_fragment:"#ifdef OPAQUE\ndiffuseColor.a = 1.0;\n#endif\n#ifdef USE_TRANSMISSION\ndiffuseColor.a *= transmissionAlpha + 0.1;\n#endif\ngl_FragColor = vec4( outgoingLight, diffuseColor.a );",packing:"vec3 packNormalToRGB( const in vec3 normal ) {\n\treturn normalize( normal ) * 0.5 + 0.5;\n}\nvec3 unpackRGBToNormal( const in vec3 rgb ) {\n\treturn 2.0 * rgb.xyz - 1.0;\n}\nconst float PackUpscale = 256. / 255.;const float UnpackDownscale = 255. / 256.;\nconst vec3 PackFactors = vec3( 256. * 256. * 256., 256. * 256., 256. );\nconst vec4 UnpackFactors = UnpackDownscale / vec4( PackFactors, 1. );\nconst float ShiftRight8 = 1. / 256.;\nvec4 packDepthToRGBA( const in float v ) {\n\tvec4 r = vec4( fract( v * PackFactors ), v );\n\tr.yzw -= r.xyz * ShiftRight8;\treturn r * PackUpscale;\n}\nfloat unpackRGBAToDepth( const in vec4 v ) {\n\treturn dot( v, UnpackFactors );\n}\nvec4 pack2HalfToRGBA( vec2 v ) {\n\tvec4 r = vec4( v.x, fract( v.x * 255.0 ), v.y, fract( v.y * 255.0 ) );\n\treturn vec4( r.x - r.y / 255.0, r.y, r.z - r.w / 255.0, r.w );\n}\nvec2 unpackRGBATo2Half( vec4 v ) {\n\treturn vec2( v.x + ( v.y / 255.0 ), v.z + ( v.w / 255.0 ) );\n}\nfloat viewZToOrthographicDepth( const in float viewZ, const in float near, const in float far ) {\n\treturn ( viewZ + near ) / ( near - far );\n}\nfloat orthographicDepthToViewZ( const in float linearClipZ, const in float near, const in float far ) {\n\treturn linearClipZ * ( near - far ) - near;\n}\nfloat viewZToPerspectiveDepth( const in float viewZ, const in float near, const in float far ) {\n\treturn ( ( near + viewZ ) * far ) / ( ( far - near ) * viewZ );\n}\nfloat perspectiveDepthToViewZ( const in float invClipZ, const in float near, const in float far ) {\n\treturn ( near * far ) / ( ( far - near ) * invClipZ - far );\n}",premultiplied_alpha_fragment:"#ifdef PREMULTIPLIED_ALPHA\n\tgl_FragColor.rgb *= gl_FragColor.a;\n#endif",project_vertex:"vec4 mvPosition = vec4( transformed, 1.0 );\n#ifdef USE_INSTANCING\n\tmvPosition = instanceMatrix * mvPosition;\n#endif\nmvPosition = modelViewMatrix * mvPosition;\ngl_Position = projectionMatrix * mvPosition;",dithering_fragment:"#ifdef DITHERING\n\tgl_FragColor.rgb = dithering( gl_FragColor.rgb );\n#endif",dithering_pars_fragment:"#ifdef DITHERING\n\tvec3 dithering( vec3 color ) {\n\t\tfloat grid_position = rand( gl_FragCoord.xy );\n\t\tvec3 dither_shift_RGB = vec3( 0.25 / 255.0, -0.25 / 255.0, 0.25 / 255.0 );\n\t\tdither_shift_RGB = mix( 2.0 * dither_shift_RGB, -2.0 * dither_shift_RGB, grid_position );\n\t\treturn color + dither_shift_RGB;\n\t}\n#endif",roughnessmap_fragment:"float roughnessFactor = roughness;\n#ifdef USE_ROUGHNESSMAP\n\tvec4 texelRoughness = texture2D( roughnessMap, vUv );\n\troughnessFactor *= texelRoughness.g;\n#endif",roughnessmap_pars_fragment:"#ifdef USE_ROUGHNESSMAP\n\tuniform sampler2D roughnessMap;\n#endif",shadowmap_pars_fragment:"#ifdef USE_SHADOWMAP\n\t#if NUM_DIR_LIGHT_SHADOWS > 0\n\t\tuniform sampler2D directionalShadowMap[ NUM_DIR_LIGHT_SHADOWS ];\n\t\tvarying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHT_SHADOWS ];\n\t\tstruct DirectionalLightShadow {\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t};\n\t\tuniform DirectionalLightShadow directionalLightShadows[ NUM_DIR_LIGHT_SHADOWS ];\n\t#endif\n\t#if NUM_SPOT_LIGHT_SHADOWS > 0\n\t\tuniform sampler2D spotShadowMap[ NUM_SPOT_LIGHT_SHADOWS ];\n\t\tvarying vec4 vSpotShadowCoord[ NUM_SPOT_LIGHT_SHADOWS ];\n\t\tstruct SpotLightShadow {\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t};\n\t\tuniform SpotLightShadow spotLightShadows[ NUM_SPOT_LIGHT_SHADOWS ];\n\t#endif\n\t#if NUM_POINT_LIGHT_SHADOWS > 0\n\t\tuniform sampler2D pointShadowMap[ NUM_POINT_LIGHT_SHADOWS ];\n\t\tvarying vec4 vPointShadowCoord[ NUM_POINT_LIGHT_SHADOWS ];\n\t\tstruct PointLightShadow {\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t\tfloat shadowCameraNear;\n\t\t\tfloat shadowCameraFar;\n\t\t};\n\t\tuniform PointLightShadow pointLightShadows[ NUM_POINT_LIGHT_SHADOWS ];\n\t#endif\n\tfloat texture2DCompare( sampler2D depths, vec2 uv, float compare ) {\n\t\treturn step( compare, unpackRGBAToDepth( texture2D( depths, uv ) ) );\n\t}\n\tvec2 texture2DDistribution( sampler2D shadow, vec2 uv ) {\n\t\treturn unpackRGBATo2Half( texture2D( shadow, uv ) );\n\t}\n\tfloat VSMShadow (sampler2D shadow, vec2 uv, float compare ){\n\t\tfloat occlusion = 1.0;\n\t\tvec2 distribution = texture2DDistribution( shadow, uv );\n\t\tfloat hard_shadow = step( compare , distribution.x );\n\t\tif (hard_shadow != 1.0 ) {\n\t\t\tfloat distance = compare - distribution.x ;\n\t\t\tfloat variance = max( 0.00000, distribution.y * distribution.y );\n\t\t\tfloat softness_probability = variance / (variance + distance * distance );\t\t\tsoftness_probability = clamp( ( softness_probability - 0.3 ) / ( 0.95 - 0.3 ), 0.0, 1.0 );\t\t\tocclusion = clamp( max( hard_shadow, softness_probability ), 0.0, 1.0 );\n\t\t}\n\t\treturn occlusion;\n\t}\n\tfloat getShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowBias, float shadowRadius, vec4 shadowCoord ) {\n\t\tfloat shadow = 1.0;\n\t\tshadowCoord.xyz /= shadowCoord.w;\n\t\tshadowCoord.z += shadowBias;\n\t\tbvec4 inFrustumVec = bvec4 ( shadowCoord.x >= 0.0, shadowCoord.x <= 1.0, shadowCoord.y >= 0.0, shadowCoord.y <= 1.0 );\n\t\tbool inFrustum = all( inFrustumVec );\n\t\tbvec2 frustumTestVec = bvec2( inFrustum, shadowCoord.z <= 1.0 );\n\t\tbool frustumTest = all( frustumTestVec );\n\t\tif ( frustumTest ) {\n\t\t#if defined( SHADOWMAP_TYPE_PCF )\n\t\t\tvec2 texelSize = vec2( 1.0 ) / shadowMapSize;\n\t\t\tfloat dx0 = - texelSize.x * shadowRadius;\n\t\t\tfloat dy0 = - texelSize.y * shadowRadius;\n\t\t\tfloat dx1 = + texelSize.x * shadowRadius;\n\t\t\tfloat dy1 = + texelSize.y * shadowRadius;\n\t\t\tfloat dx2 = dx0 / 2.0;\n\t\t\tfloat dy2 = dy0 / 2.0;\n\t\t\tfloat dx3 = dx1 / 2.0;\n\t\t\tfloat dy3 = dy1 / 2.0;\n\t\t\tshadow = (\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, dy0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, dy0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, dy2 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy2 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, dy2 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, dy3 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy3 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, dy3 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, dy1 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy1 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, dy1 ), shadowCoord.z )\n\t\t\t) * ( 1.0 / 17.0 );\n\t\t#elif defined( SHADOWMAP_TYPE_PCF_SOFT )\n\t\t\tvec2 texelSize = vec2( 1.0 ) / shadowMapSize;\n\t\t\tfloat dx = texelSize.x;\n\t\t\tfloat dy = texelSize.y;\n\t\t\tvec2 uv = shadowCoord.xy;\n\t\t\tvec2 f = fract( uv * shadowMapSize + 0.5 );\n\t\t\tuv -= f * texelSize;\n\t\t\tshadow = (\n\t\t\t\ttexture2DCompare( shadowMap, uv, shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, uv + vec2( dx, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, uv + vec2( 0.0, dy ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, uv + texelSize, shadowCoord.z ) +\n\t\t\t\tmix( texture2DCompare( shadowMap, uv + vec2( -dx, 0.0 ), shadowCoord.z ), \n\t\t\t\t\t texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, 0.0 ), shadowCoord.z ),\n\t\t\t\t\t f.x ) +\n\t\t\t\tmix( texture2DCompare( shadowMap, uv + vec2( -dx, dy ), shadowCoord.z ), \n\t\t\t\t\t texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, dy ), shadowCoord.z ),\n\t\t\t\t\t f.x ) +\n\t\t\t\tmix( texture2DCompare( shadowMap, uv + vec2( 0.0, -dy ), shadowCoord.z ), \n\t\t\t\t\t texture2DCompare( shadowMap, uv + vec2( 0.0, 2.0 * dy ), shadowCoord.z ),\n\t\t\t\t\t f.y ) +\n\t\t\t\tmix( texture2DCompare( shadowMap, uv + vec2( dx, -dy ), shadowCoord.z ), \n\t\t\t\t\t texture2DCompare( shadowMap, uv + vec2( dx, 2.0 * dy ), shadowCoord.z ),\n\t\t\t\t\t f.y ) +\n\t\t\t\tmix( mix( texture2DCompare( shadowMap, uv + vec2( -dx, -dy ), shadowCoord.z ), \n\t\t\t\t\t\t  texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, -dy ), shadowCoord.z ),\n\t\t\t\t\t\t  f.x ),\n\t\t\t\t\t mix( texture2DCompare( shadowMap, uv + vec2( -dx, 2.0 * dy ), shadowCoord.z ), \n\t\t\t\t\t\t  texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, 2.0 * dy ), shadowCoord.z ),\n\t\t\t\t\t\t  f.x ),\n\t\t\t\t\t f.y )\n\t\t\t) * ( 1.0 / 9.0 );\n\t\t#elif defined( SHADOWMAP_TYPE_VSM )\n\t\t\tshadow = VSMShadow( shadowMap, shadowCoord.xy, shadowCoord.z );\n\t\t#else\n\t\t\tshadow = texture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z );\n\t\t#endif\n\t\t}\n\t\treturn shadow;\n\t}\n\tvec2 cubeToUV( vec3 v, float texelSizeY ) {\n\t\tvec3 absV = abs( v );\n\t\tfloat scaleToCube = 1.0 / max( absV.x, max( absV.y, absV.z ) );\n\t\tabsV *= scaleToCube;\n\t\tv *= scaleToCube * ( 1.0 - 2.0 * texelSizeY );\n\t\tvec2 planar = v.xy;\n\t\tfloat almostATexel = 1.5 * texelSizeY;\n\t\tfloat almostOne = 1.0 - almostATexel;\n\t\tif ( absV.z >= almostOne ) {\n\t\t\tif ( v.z > 0.0 )\n\t\t\t\tplanar.x = 4.0 - v.x;\n\t\t} else if ( absV.x >= almostOne ) {\n\t\t\tfloat signX = sign( v.x );\n\t\t\tplanar.x = v.z * signX + 2.0 * signX;\n\t\t} else if ( absV.y >= almostOne ) {\n\t\t\tfloat signY = sign( v.y );\n\t\t\tplanar.x = v.x + 2.0 * signY + 2.0;\n\t\t\tplanar.y = v.z * signY - 2.0;\n\t\t}\n\t\treturn vec2( 0.125, 0.25 ) * planar + vec2( 0.375, 0.75 );\n\t}\n\tfloat getPointShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowBias, float shadowRadius, vec4 shadowCoord, float shadowCameraNear, float shadowCameraFar ) {\n\t\tvec2 texelSize = vec2( 1.0 ) / ( shadowMapSize * vec2( 4.0, 2.0 ) );\n\t\tvec3 lightToPosition = shadowCoord.xyz;\n\t\tfloat dp = ( length( lightToPosition ) - shadowCameraNear ) / ( shadowCameraFar - shadowCameraNear );\t\tdp += shadowBias;\n\t\tvec3 bd3D = normalize( lightToPosition );\n\t\t#if defined( SHADOWMAP_TYPE_PCF ) || defined( SHADOWMAP_TYPE_PCF_SOFT ) || defined( SHADOWMAP_TYPE_VSM )\n\t\t\tvec2 offset = vec2( - 1, 1 ) * shadowRadius * texelSize.y;\n\t\t\treturn (\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xyy, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yyy, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xyx, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yyx, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xxy, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yxy, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xxx, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yxx, texelSize.y ), dp )\n\t\t\t) * ( 1.0 / 9.0 );\n\t\t#else\n\t\t\treturn texture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), dp );\n\t\t#endif\n\t}\n#endif",shadowmap_pars_vertex:"#ifdef USE_SHADOWMAP\n\t#if NUM_DIR_LIGHT_SHADOWS > 0\n\t\tuniform mat4 directionalShadowMatrix[ NUM_DIR_LIGHT_SHADOWS ];\n\t\tvarying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHT_SHADOWS ];\n\t\tstruct DirectionalLightShadow {\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t};\n\t\tuniform DirectionalLightShadow directionalLightShadows[ NUM_DIR_LIGHT_SHADOWS ];\n\t#endif\n\t#if NUM_SPOT_LIGHT_SHADOWS > 0\n\t\tuniform mat4 spotShadowMatrix[ NUM_SPOT_LIGHT_SHADOWS ];\n\t\tvarying vec4 vSpotShadowCoord[ NUM_SPOT_LIGHT_SHADOWS ];\n\t\tstruct SpotLightShadow {\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t};\n\t\tuniform SpotLightShadow spotLightShadows[ NUM_SPOT_LIGHT_SHADOWS ];\n\t#endif\n\t#if NUM_POINT_LIGHT_SHADOWS > 0\n\t\tuniform mat4 pointShadowMatrix[ NUM_POINT_LIGHT_SHADOWS ];\n\t\tvarying vec4 vPointShadowCoord[ NUM_POINT_LIGHT_SHADOWS ];\n\t\tstruct PointLightShadow {\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t\tfloat shadowCameraNear;\n\t\t\tfloat shadowCameraFar;\n\t\t};\n\t\tuniform PointLightShadow pointLightShadows[ NUM_POINT_LIGHT_SHADOWS ];\n\t#endif\n#endif",shadowmap_vertex:"#ifdef USE_SHADOWMAP\n\t#if NUM_DIR_LIGHT_SHADOWS > 0 || NUM_SPOT_LIGHT_SHADOWS > 0 || NUM_POINT_LIGHT_SHADOWS > 0\n\t\tvec3 shadowWorldNormal = inverseTransformDirection( transformedNormal, viewMatrix );\n\t\tvec4 shadowWorldPosition;\n\t#endif\n\t#if NUM_DIR_LIGHT_SHADOWS > 0\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_DIR_LIGHT_SHADOWS; i ++ ) {\n\t\tshadowWorldPosition = worldPosition + vec4( shadowWorldNormal * directionalLightShadows[ i ].shadowNormalBias, 0 );\n\t\tvDirectionalShadowCoord[ i ] = directionalShadowMatrix[ i ] * shadowWorldPosition;\n\t}\n\t#pragma unroll_loop_end\n\t#endif\n\t#if NUM_SPOT_LIGHT_SHADOWS > 0\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_SPOT_LIGHT_SHADOWS; i ++ ) {\n\t\tshadowWorldPosition = worldPosition + vec4( shadowWorldNormal * spotLightShadows[ i ].shadowNormalBias, 0 );\n\t\tvSpotShadowCoord[ i ] = spotShadowMatrix[ i ] * shadowWorldPosition;\n\t}\n\t#pragma unroll_loop_end\n\t#endif\n\t#if NUM_POINT_LIGHT_SHADOWS > 0\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_POINT_LIGHT_SHADOWS; i ++ ) {\n\t\tshadowWorldPosition = worldPosition + vec4( shadowWorldNormal * pointLightShadows[ i ].shadowNormalBias, 0 );\n\t\tvPointShadowCoord[ i ] = pointShadowMatrix[ i ] * shadowWorldPosition;\n\t}\n\t#pragma unroll_loop_end\n\t#endif\n#endif",shadowmask_pars_fragment:"float getShadowMask() {\n\tfloat shadow = 1.0;\n\t#ifdef USE_SHADOWMAP\n\t#if NUM_DIR_LIGHT_SHADOWS > 0\n\tDirectionalLightShadow directionalLight;\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_DIR_LIGHT_SHADOWS; i ++ ) {\n\t\tdirectionalLight = directionalLightShadows[ i ];\n\t\tshadow *= receiveShadow ? getShadow( directionalShadowMap[ i ], directionalLight.shadowMapSize, directionalLight.shadowBias, directionalLight.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;\n\t}\n\t#pragma unroll_loop_end\n\t#endif\n\t#if NUM_SPOT_LIGHT_SHADOWS > 0\n\tSpotLightShadow spotLight;\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_SPOT_LIGHT_SHADOWS; i ++ ) {\n\t\tspotLight = spotLightShadows[ i ];\n\t\tshadow *= receiveShadow ? getShadow( spotShadowMap[ i ], spotLight.shadowMapSize, spotLight.shadowBias, spotLight.shadowRadius, vSpotShadowCoord[ i ] ) : 1.0;\n\t}\n\t#pragma unroll_loop_end\n\t#endif\n\t#if NUM_POINT_LIGHT_SHADOWS > 0\n\tPointLightShadow pointLight;\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_POINT_LIGHT_SHADOWS; i ++ ) {\n\t\tpointLight = pointLightShadows[ i ];\n\t\tshadow *= receiveShadow ? getPointShadow( pointShadowMap[ i ], pointLight.shadowMapSize, pointLight.shadowBias, pointLight.shadowRadius, vPointShadowCoord[ i ], pointLight.shadowCameraNear, pointLight.shadowCameraFar ) : 1.0;\n\t}\n\t#pragma unroll_loop_end\n\t#endif\n\t#endif\n\treturn shadow;\n}",skinbase_vertex:"#ifdef USE_SKINNING\n\tmat4 boneMatX = getBoneMatrix( skinIndex.x );\n\tmat4 boneMatY = getBoneMatrix( skinIndex.y );\n\tmat4 boneMatZ = getBoneMatrix( skinIndex.z );\n\tmat4 boneMatW = getBoneMatrix( skinIndex.w );\n#endif",skinning_pars_vertex:"#ifdef USE_SKINNING\n\tuniform mat4 bindMatrix;\n\tuniform mat4 bindMatrixInverse;\n\t#ifdef BONE_TEXTURE\n\t\tuniform highp sampler2D boneTexture;\n\t\tuniform int boneTextureSize;\n\t\tmat4 getBoneMatrix( const in float i ) {\n\t\t\tfloat j = i * 4.0;\n\t\t\tfloat x = mod( j, float( boneTextureSize ) );\n\t\t\tfloat y = floor( j / float( boneTextureSize ) );\n\t\t\tfloat dx = 1.0 / float( boneTextureSize );\n\t\t\tfloat dy = 1.0 / float( boneTextureSize );\n\t\t\ty = dy * ( y + 0.5 );\n\t\t\tvec4 v1 = texture2D( boneTexture, vec2( dx * ( x + 0.5 ), y ) );\n\t\t\tvec4 v2 = texture2D( boneTexture, vec2( dx * ( x + 1.5 ), y ) );\n\t\t\tvec4 v3 = texture2D( boneTexture, vec2( dx * ( x + 2.5 ), y ) );\n\t\t\tvec4 v4 = texture2D( boneTexture, vec2( dx * ( x + 3.5 ), y ) );\n\t\t\tmat4 bone = mat4( v1, v2, v3, v4 );\n\t\t\treturn bone;\n\t\t}\n\t#else\n\t\tuniform mat4 boneMatrices[ MAX_BONES ];\n\t\tmat4 getBoneMatrix( const in float i ) {\n\t\t\tmat4 bone = boneMatrices[ int(i) ];\n\t\t\treturn bone;\n\t\t}\n\t#endif\n#endif",skinning_vertex:"#ifdef USE_SKINNING\n\tvec4 skinVertex = bindMatrix * vec4( transformed, 1.0 );\n\tvec4 skinned = vec4( 0.0 );\n\tskinned += boneMatX * skinVertex * skinWeight.x;\n\tskinned += boneMatY * skinVertex * skinWeight.y;\n\tskinned += boneMatZ * skinVertex * skinWeight.z;\n\tskinned += boneMatW * skinVertex * skinWeight.w;\n\ttransformed = ( bindMatrixInverse * skinned ).xyz;\n#endif",skinnormal_vertex:"#ifdef USE_SKINNING\n\tmat4 skinMatrix = mat4( 0.0 );\n\tskinMatrix += skinWeight.x * boneMatX;\n\tskinMatrix += skinWeight.y * boneMatY;\n\tskinMatrix += skinWeight.z * boneMatZ;\n\tskinMatrix += skinWeight.w * boneMatW;\n\tskinMatrix = bindMatrixInverse * skinMatrix * bindMatrix;\n\tobjectNormal = vec4( skinMatrix * vec4( objectNormal, 0.0 ) ).xyz;\n\t#ifdef USE_TANGENT\n\t\tobjectTangent = vec4( skinMatrix * vec4( objectTangent, 0.0 ) ).xyz;\n\t#endif\n#endif",specularmap_fragment:"float specularStrength;\n#ifdef USE_SPECULARMAP\n\tvec4 texelSpecular = texture2D( specularMap, vUv );\n\tspecularStrength = texelSpecular.r;\n#else\n\tspecularStrength = 1.0;\n#endif",specularmap_pars_fragment:"#ifdef USE_SPECULARMAP\n\tuniform sampler2D specularMap;\n#endif",tonemapping_fragment:"#if defined( TONE_MAPPING )\n\tgl_FragColor.rgb = toneMapping( gl_FragColor.rgb );\n#endif",tonemapping_pars_fragment:"#ifndef saturate\n#define saturate( a ) clamp( a, 0.0, 1.0 )\n#endif\nuniform float toneMappingExposure;\nvec3 LinearToneMapping( vec3 color ) {\n\treturn toneMappingExposure * color;\n}\nvec3 ReinhardToneMapping( vec3 color ) {\n\tcolor *= toneMappingExposure;\n\treturn saturate( color / ( vec3( 1.0 ) + color ) );\n}\nvec3 OptimizedCineonToneMapping( vec3 color ) {\n\tcolor *= toneMappingExposure;\n\tcolor = max( vec3( 0.0 ), color - 0.004 );\n\treturn pow( ( color * ( 6.2 * color + 0.5 ) ) / ( color * ( 6.2 * color + 1.7 ) + 0.06 ), vec3( 2.2 ) );\n}\nvec3 RRTAndODTFit( vec3 v ) {\n\tvec3 a = v * ( v + 0.0245786 ) - 0.000090537;\n\tvec3 b = v * ( 0.983729 * v + 0.4329510 ) + 0.238081;\n\treturn a / b;\n}\nvec3 ACESFilmicToneMapping( vec3 color ) {\n\tconst mat3 ACESInputMat = mat3(\n\t\tvec3( 0.59719, 0.07600, 0.02840 ),\t\tvec3( 0.35458, 0.90834, 0.13383 ),\n\t\tvec3( 0.04823, 0.01566, 0.83777 )\n\t);\n\tconst mat3 ACESOutputMat = mat3(\n\t\tvec3(  1.60475, -0.10208, -0.00327 ),\t\tvec3( -0.53108,  1.10813, -0.07276 ),\n\t\tvec3( -0.07367, -0.00605,  1.07602 )\n\t);\n\tcolor *= toneMappingExposure / 0.6;\n\tcolor = ACESInputMat * color;\n\tcolor = RRTAndODTFit( color );\n\tcolor = ACESOutputMat * color;\n\treturn saturate( color );\n}\nvec3 CustomToneMapping( vec3 color ) { return color; }",transmission_fragment:"#ifdef USE_TRANSMISSION\n\tfloat transmissionAlpha = 1.0;\n\tfloat transmissionFactor = transmission;\n\tfloat thicknessFactor = thickness;\n\t#ifdef USE_TRANSMISSIONMAP\n\t\ttransmissionFactor *= texture2D( transmissionMap, vUv ).r;\n\t#endif\n\t#ifdef USE_THICKNESSMAP\n\t\tthicknessFactor *= texture2D( thicknessMap, vUv ).g;\n\t#endif\n\tvec3 pos = vWorldPosition;\n\tvec3 v = normalize( cameraPosition - pos );\n\tvec3 n = inverseTransformDirection( normal, viewMatrix );\n\tvec4 transmission = getIBLVolumeRefraction(\n\t\tn, v, roughnessFactor, material.diffuseColor, material.specularColor, material.specularF90,\n\t\tpos, modelMatrix, viewMatrix, projectionMatrix, ior, thicknessFactor,\n\t\tattenuationColor, attenuationDistance );\n\ttotalDiffuse = mix( totalDiffuse, transmission.rgb, transmissionFactor );\n\ttransmissionAlpha = mix( transmissionAlpha, transmission.a, transmissionFactor );\n#endif",transmission_pars_fragment:"#ifdef USE_TRANSMISSION\n\tuniform float transmission;\n\tuniform float thickness;\n\tuniform float attenuationDistance;\n\tuniform vec3 attenuationColor;\n\t#ifdef USE_TRANSMISSIONMAP\n\t\tuniform sampler2D transmissionMap;\n\t#endif\n\t#ifdef USE_THICKNESSMAP\n\t\tuniform sampler2D thicknessMap;\n\t#endif\n\tuniform vec2 transmissionSamplerSize;\n\tuniform sampler2D transmissionSamplerMap;\n\tuniform mat4 modelMatrix;\n\tuniform mat4 projectionMatrix;\n\tvarying vec3 vWorldPosition;\n\tvec3 getVolumeTransmissionRay( vec3 n, vec3 v, float thickness, float ior, mat4 modelMatrix ) {\n\t\tvec3 refractionVector = refract( - v, normalize( n ), 1.0 / ior );\n\t\tvec3 modelScale;\n\t\tmodelScale.x = length( vec3( modelMatrix[ 0 ].xyz ) );\n\t\tmodelScale.y = length( vec3( modelMatrix[ 1 ].xyz ) );\n\t\tmodelScale.z = length( vec3( modelMatrix[ 2 ].xyz ) );\n\t\treturn normalize( refractionVector ) * thickness * modelScale;\n\t}\n\tfloat applyIorToRoughness( float roughness, float ior ) {\n\t\treturn roughness * clamp( ior * 2.0 - 2.0, 0.0, 1.0 );\n\t}\n\tvec4 getTransmissionSample( vec2 fragCoord, float roughness, float ior ) {\n\t\tfloat framebufferLod = log2( transmissionSamplerSize.x ) * applyIorToRoughness( roughness, ior );\n\t\t#ifdef TEXTURE_LOD_EXT\n\t\t\treturn texture2DLodEXT( transmissionSamplerMap, fragCoord.xy, framebufferLod );\n\t\t#else\n\t\t\treturn texture2D( transmissionSamplerMap, fragCoord.xy, framebufferLod );\n\t\t#endif\n\t}\n\tvec3 applyVolumeAttenuation( vec3 radiance, float transmissionDistance, vec3 attenuationColor, float attenuationDistance ) {\n\t\tif ( attenuationDistance == 0.0 ) {\n\t\t\treturn radiance;\n\t\t} else {\n\t\t\tvec3 attenuationCoefficient = -log( attenuationColor ) / attenuationDistance;\n\t\t\tvec3 transmittance = exp( - attenuationCoefficient * transmissionDistance );\t\t\treturn transmittance * radiance;\n\t\t}\n\t}\n\tvec4 getIBLVolumeRefraction( vec3 n, vec3 v, float roughness, vec3 diffuseColor, vec3 specularColor, float specularF90,\n\t\tvec3 position, mat4 modelMatrix, mat4 viewMatrix, mat4 projMatrix, float ior, float thickness,\n\t\tvec3 attenuationColor, float attenuationDistance ) {\n\t\tvec3 transmissionRay = getVolumeTransmissionRay( n, v, thickness, ior, modelMatrix );\n\t\tvec3 refractedRayExit = position + transmissionRay;\n\t\tvec4 ndcPos = projMatrix * viewMatrix * vec4( refractedRayExit, 1.0 );\n\t\tvec2 refractionCoords = ndcPos.xy / ndcPos.w;\n\t\trefractionCoords += 1.0;\n\t\trefractionCoords /= 2.0;\n\t\tvec4 transmittedLight = getTransmissionSample( refractionCoords, roughness, ior );\n\t\tvec3 attenuatedColor = applyVolumeAttenuation( transmittedLight.rgb, length( transmissionRay ), attenuationColor, attenuationDistance );\n\t\tvec3 F = EnvironmentBRDF( n, v, specularColor, specularF90, roughness );\n\t\treturn vec4( ( 1.0 - F ) * attenuatedColor * diffuseColor, transmittedLight.a );\n\t}\n#endif",uv_pars_fragment:"#if ( defined( USE_UV ) && ! defined( UVS_VERTEX_ONLY ) )\n\tvarying vec2 vUv;\n#endif",uv_pars_vertex:"#ifdef USE_UV\n\t#ifdef UVS_VERTEX_ONLY\n\t\tvec2 vUv;\n\t#else\n\t\tvarying vec2 vUv;\n\t#endif\n\tuniform mat3 uvTransform;\n#endif",uv_vertex:"#ifdef USE_UV\n\tvUv = ( uvTransform * vec3( uv, 1 ) ).xy;\n#endif",uv2_pars_fragment:"#if defined( USE_LIGHTMAP ) || defined( USE_AOMAP )\n\tvarying vec2 vUv2;\n#endif",uv2_pars_vertex:"#if defined( USE_LIGHTMAP ) || defined( USE_AOMAP )\n\tattribute vec2 uv2;\n\tvarying vec2 vUv2;\n\tuniform mat3 uv2Transform;\n#endif",uv2_vertex:"#if defined( USE_LIGHTMAP ) || defined( USE_AOMAP )\n\tvUv2 = ( uv2Transform * vec3( uv2, 1 ) ).xy;\n#endif",worldpos_vertex:"#if defined( USE_ENVMAP ) || defined( DISTANCE ) || defined ( USE_SHADOWMAP ) || defined ( USE_TRANSMISSION )\n\tvec4 worldPosition = vec4( transformed, 1.0 );\n\t#ifdef USE_INSTANCING\n\t\tworldPosition = instanceMatrix * worldPosition;\n\t#endif\n\tworldPosition = modelMatrix * worldPosition;\n#endif",background_vert:"varying vec2 vUv;\nuniform mat3 uvTransform;\nvoid main() {\n\tvUv = ( uvTransform * vec3( uv, 1 ) ).xy;\n\tgl_Position = vec4( position.xy, 1.0, 1.0 );\n}",background_frag:"uniform sampler2D t2D;\nvarying vec2 vUv;\nvoid main() {\n\tvec4 texColor = texture2D( t2D, vUv );\n\tgl_FragColor = mapTexelToLinear( texColor );\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n}",cube_vert:"varying vec3 vWorldDirection;\n#include <common>\nvoid main() {\n\tvWorldDirection = transformDirection( position, modelMatrix );\n\t#include <begin_vertex>\n\t#include <project_vertex>\n\tgl_Position.z = gl_Position.w;\n}",cube_frag:"#include <envmap_common_pars_fragment>\nuniform float opacity;\nvarying vec3 vWorldDirection;\n#include <cube_uv_reflection_fragment>\nvoid main() {\n\tvec3 vReflect = vWorldDirection;\n\t#include <envmap_fragment>\n\tgl_FragColor = envColor;\n\tgl_FragColor.a *= opacity;\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n}",depth_vert:"#include <common>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvarying vec2 vHighPrecisionZW;\nvoid main() {\n\t#include <uv_vertex>\n\t#include <skinbase_vertex>\n\t#ifdef USE_DISPLACEMENTMAP\n\t\t#include <beginnormal_vertex>\n\t\t#include <morphnormal_vertex>\n\t\t#include <skinnormal_vertex>\n\t#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\tvHighPrecisionZW = gl_Position.zw;\n}",depth_frag:"#if DEPTH_PACKING == 3200\n\tuniform float opacity;\n#endif\n#include <common>\n#include <packing>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvarying vec2 vHighPrecisionZW;\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( 1.0 );\n\t#if DEPTH_PACKING == 3200\n\t\tdiffuseColor.a = opacity;\n\t#endif\n\t#include <map_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <logdepthbuf_fragment>\n\tfloat fragCoordZ = 0.5 * vHighPrecisionZW[0] / vHighPrecisionZW[1] + 0.5;\n\t#if DEPTH_PACKING == 3200\n\t\tgl_FragColor = vec4( vec3( 1.0 - fragCoordZ ), opacity );\n\t#elif DEPTH_PACKING == 3201\n\t\tgl_FragColor = packDepthToRGBA( fragCoordZ );\n\t#endif\n}",distanceRGBA_vert:"#define DISTANCE\nvarying vec3 vWorldPosition;\n#include <common>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <skinbase_vertex>\n\t#ifdef USE_DISPLACEMENTMAP\n\t\t#include <beginnormal_vertex>\n\t\t#include <morphnormal_vertex>\n\t\t#include <skinnormal_vertex>\n\t#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <worldpos_vertex>\n\t#include <clipping_planes_vertex>\n\tvWorldPosition = worldPosition.xyz;\n}",distanceRGBA_frag:"#define DISTANCE\nuniform vec3 referencePosition;\nuniform float nearDistance;\nuniform float farDistance;\nvarying vec3 vWorldPosition;\n#include <common>\n#include <packing>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main () {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( 1.0 );\n\t#include <map_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\tfloat dist = length( vWorldPosition - referencePosition );\n\tdist = ( dist - nearDistance ) / ( farDistance - nearDistance );\n\tdist = saturate( dist );\n\tgl_FragColor = packDepthToRGBA( dist );\n}",equirect_vert:"varying vec3 vWorldDirection;\n#include <common>\nvoid main() {\n\tvWorldDirection = transformDirection( position, modelMatrix );\n\t#include <begin_vertex>\n\t#include <project_vertex>\n}",equirect_frag:"uniform sampler2D tEquirect;\nvarying vec3 vWorldDirection;\n#include <common>\nvoid main() {\n\tvec3 direction = normalize( vWorldDirection );\n\tvec2 sampleUV = equirectUv( direction );\n\tvec4 texColor = texture2D( tEquirect, sampleUV );\n\tgl_FragColor = mapTexelToLinear( texColor );\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n}",linedashed_vert:"uniform float scale;\nattribute float lineDistance;\nvarying float vLineDistance;\n#include <common>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\tvLineDistance = scale * lineDistance;\n\t#include <color_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <fog_vertex>\n}",linedashed_frag:"uniform vec3 diffuse;\nuniform float opacity;\nuniform float dashSize;\nuniform float totalSize;\nvarying float vLineDistance;\n#include <common>\n#include <color_pars_fragment>\n#include <fog_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tif ( mod( vLineDistance, totalSize ) > dashSize ) {\n\t\tdiscard;\n\t}\n\tvec3 outgoingLight = vec3( 0.0 );\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <logdepthbuf_fragment>\n\t#include <color_fragment>\n\toutgoingLight = diffuseColor.rgb;\n\t#include <output_fragment>\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n}",meshbasic_vert:"#include <common>\n#include <uv_pars_vertex>\n#include <uv2_pars_vertex>\n#include <envmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <uv2_vertex>\n\t#include <color_vertex>\n\t#if defined ( USE_ENVMAP ) || defined ( USE_SKINNING )\n\t\t#include <beginnormal_vertex>\n\t\t#include <morphnormal_vertex>\n\t\t#include <skinbase_vertex>\n\t\t#include <skinnormal_vertex>\n\t\t#include <defaultnormal_vertex>\n\t#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <worldpos_vertex>\n\t#include <envmap_vertex>\n\t#include <fog_vertex>\n}",meshbasic_frag:"uniform vec3 diffuse;\nuniform float opacity;\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n#endif\n#include <common>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <uv2_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <envmap_common_pars_fragment>\n#include <envmap_pars_fragment>\n#include <cube_uv_reflection_fragment>\n#include <fog_pars_fragment>\n#include <specularmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <specularmap_fragment>\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\t#ifdef USE_LIGHTMAP\n\t\tvec4 lightMapTexel= texture2D( lightMap, vUv2 );\n\t\treflectedLight.indirectDiffuse += lightMapTexelToLinear( lightMapTexel ).rgb * lightMapIntensity;\n\t#else\n\t\treflectedLight.indirectDiffuse += vec3( 1.0 );\n\t#endif\n\t#include <aomap_fragment>\n\treflectedLight.indirectDiffuse *= diffuseColor.rgb;\n\tvec3 outgoingLight = reflectedLight.indirectDiffuse;\n\t#include <envmap_fragment>\n\t#include <output_fragment>\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",meshlambert_vert:"#define LAMBERT\nvarying vec3 vLightFront;\nvarying vec3 vIndirectFront;\n#ifdef DOUBLE_SIDED\n\tvarying vec3 vLightBack;\n\tvarying vec3 vIndirectBack;\n#endif\n#include <common>\n#include <uv_pars_vertex>\n#include <uv2_pars_vertex>\n#include <envmap_pars_vertex>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <uv2_vertex>\n\t#include <color_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <worldpos_vertex>\n\t#include <envmap_vertex>\n\t#include <lights_lambert_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n}",meshlambert_frag:"uniform vec3 diffuse;\nuniform vec3 emissive;\nuniform float opacity;\nvarying vec3 vLightFront;\nvarying vec3 vIndirectFront;\n#ifdef DOUBLE_SIDED\n\tvarying vec3 vLightBack;\n\tvarying vec3 vIndirectBack;\n#endif\n#include <common>\n#include <packing>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <uv2_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <envmap_common_pars_fragment>\n#include <envmap_pars_fragment>\n#include <cube_uv_reflection_fragment>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <fog_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <shadowmask_pars_fragment>\n#include <specularmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\tvec3 totalEmissiveRadiance = emissive;\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <specularmap_fragment>\n\t#include <emissivemap_fragment>\n\t#ifdef DOUBLE_SIDED\n\t\treflectedLight.indirectDiffuse += ( gl_FrontFacing ) ? vIndirectFront : vIndirectBack;\n\t#else\n\t\treflectedLight.indirectDiffuse += vIndirectFront;\n\t#endif\n\t#include <lightmap_fragment>\n\treflectedLight.indirectDiffuse *= BRDF_Lambert( diffuseColor.rgb );\n\t#ifdef DOUBLE_SIDED\n\t\treflectedLight.directDiffuse = ( gl_FrontFacing ) ? vLightFront : vLightBack;\n\t#else\n\t\treflectedLight.directDiffuse = vLightFront;\n\t#endif\n\treflectedLight.directDiffuse *= BRDF_Lambert( diffuseColor.rgb ) * getShadowMask();\n\t#include <aomap_fragment>\n\tvec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + totalEmissiveRadiance;\n\t#include <envmap_fragment>\n\t#include <output_fragment>\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",meshmatcap_vert:"#define MATCAP\nvarying vec3 vViewPosition;\n#include <common>\n#include <uv_pars_vertex>\n#include <color_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <fog_pars_vertex>\n#include <normal_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <color_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <normal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <fog_vertex>\n\tvViewPosition = - mvPosition.xyz;\n}",meshmatcap_frag:"#define MATCAP\nuniform vec3 diffuse;\nuniform float opacity;\nuniform sampler2D matcap;\nvarying vec3 vViewPosition;\n#include <common>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <fog_pars_fragment>\n#include <normal_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\tvec3 viewDir = normalize( vViewPosition );\n\tvec3 x = normalize( vec3( viewDir.z, 0.0, - viewDir.x ) );\n\tvec3 y = cross( viewDir, x );\n\tvec2 uv = vec2( dot( x, normal ), dot( y, normal ) ) * 0.495 + 0.5;\n\t#ifdef USE_MATCAP\n\t\tvec4 matcapColor = texture2D( matcap, uv );\n\t\tmatcapColor = matcapTexelToLinear( matcapColor );\n\t#else\n\t\tvec4 matcapColor = vec4( 1.0 );\n\t#endif\n\tvec3 outgoingLight = diffuseColor.rgb * matcapColor.rgb;\n\t#include <output_fragment>\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",meshnormal_vert:"#define NORMAL\n#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( TANGENTSPACE_NORMALMAP )\n\tvarying vec3 vViewPosition;\n#endif\n#include <common>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <normal_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <normal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( TANGENTSPACE_NORMALMAP )\n\tvViewPosition = - mvPosition.xyz;\n#endif\n}",meshnormal_frag:"#define NORMAL\nuniform float opacity;\n#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( TANGENTSPACE_NORMALMAP )\n\tvarying vec3 vViewPosition;\n#endif\n#include <packing>\n#include <uv_pars_fragment>\n#include <normal_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\t#include <logdepthbuf_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\tgl_FragColor = vec4( packNormalToRGB( normal ), opacity );\n}",meshphong_vert:"#define PHONG\nvarying vec3 vViewPosition;\n#include <common>\n#include <uv_pars_vertex>\n#include <uv2_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <envmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <normal_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <uv2_vertex>\n\t#include <color_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <normal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\tvViewPosition = - mvPosition.xyz;\n\t#include <worldpos_vertex>\n\t#include <envmap_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n}",meshphong_frag:"#define PHONG\nuniform vec3 diffuse;\nuniform vec3 emissive;\nuniform vec3 specular;\nuniform float shininess;\nuniform float opacity;\n#include <common>\n#include <packing>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <uv2_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <envmap_common_pars_fragment>\n#include <envmap_pars_fragment>\n#include <cube_uv_reflection_fragment>\n#include <fog_pars_fragment>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <normal_pars_fragment>\n#include <lights_phong_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <specularmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\tvec3 totalEmissiveRadiance = emissive;\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <specularmap_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\t#include <emissivemap_fragment>\n\t#include <lights_phong_fragment>\n\t#include <lights_fragment_begin>\n\t#include <lights_fragment_maps>\n\t#include <lights_fragment_end>\n\t#include <aomap_fragment>\n\tvec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + reflectedLight.directSpecular + reflectedLight.indirectSpecular + totalEmissiveRadiance;\n\t#include <envmap_fragment>\n\t#include <output_fragment>\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",meshphysical_vert:"#define STANDARD\nvarying vec3 vViewPosition;\n#ifdef USE_TRANSMISSION\n\tvarying vec3 vWorldPosition;\n#endif\n#include <common>\n#include <uv_pars_vertex>\n#include <uv2_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <normal_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <uv2_vertex>\n\t#include <color_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <normal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\tvViewPosition = - mvPosition.xyz;\n\t#include <worldpos_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n#ifdef USE_TRANSMISSION\n\tvWorldPosition = worldPosition.xyz;\n#endif\n}",meshphysical_frag:"#define STANDARD\n#ifdef PHYSICAL\n\t#define IOR\n\t#define SPECULAR\n#endif\nuniform vec3 diffuse;\nuniform vec3 emissive;\nuniform float roughness;\nuniform float metalness;\nuniform float opacity;\n#ifdef IOR\n\tuniform float ior;\n#endif\n#ifdef SPECULAR\n\tuniform float specularIntensity;\n\tuniform vec3 specularColor;\n\t#ifdef USE_SPECULARINTENSITYMAP\n\t\tuniform sampler2D specularIntensityMap;\n\t#endif\n\t#ifdef USE_SPECULARCOLORMAP\n\t\tuniform sampler2D specularColorMap;\n\t#endif\n#endif\n#ifdef USE_CLEARCOAT\n\tuniform float clearcoat;\n\tuniform float clearcoatRoughness;\n#endif\n#ifdef USE_SHEEN\n\tuniform vec3 sheenColor;\n\tuniform float sheenRoughness;\n\t#ifdef USE_SHEENCOLORMAP\n\t\tuniform sampler2D sheenColorMap;\n\t#endif\n\t#ifdef USE_SHEENROUGHNESSMAP\n\t\tuniform sampler2D sheenRoughnessMap;\n\t#endif\n#endif\nvarying vec3 vViewPosition;\n#include <common>\n#include <packing>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <uv2_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <bsdfs>\n#include <cube_uv_reflection_fragment>\n#include <envmap_common_pars_fragment>\n#include <envmap_physical_pars_fragment>\n#include <fog_pars_fragment>\n#include <lights_pars_begin>\n#include <normal_pars_fragment>\n#include <lights_physical_pars_fragment>\n#include <transmission_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <clearcoat_pars_fragment>\n#include <roughnessmap_pars_fragment>\n#include <metalnessmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\tvec3 totalEmissiveRadiance = emissive;\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <roughnessmap_fragment>\n\t#include <metalnessmap_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\t#include <clearcoat_normal_fragment_begin>\n\t#include <clearcoat_normal_fragment_maps>\n\t#include <emissivemap_fragment>\n\t#include <lights_physical_fragment>\n\t#include <lights_fragment_begin>\n\t#include <lights_fragment_maps>\n\t#include <lights_fragment_end>\n\t#include <aomap_fragment>\n\tvec3 totalDiffuse = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse;\n\tvec3 totalSpecular = reflectedLight.directSpecular + reflectedLight.indirectSpecular;\n\t#include <transmission_fragment>\n\tvec3 outgoingLight = totalDiffuse + totalSpecular + totalEmissiveRadiance;\n\t#ifdef USE_CLEARCOAT\n\t\tfloat dotNVcc = saturate( dot( geometry.clearcoatNormal, geometry.viewDir ) );\n\t\tvec3 Fcc = F_Schlick( material.clearcoatF0, material.clearcoatF90, dotNVcc );\n\t\toutgoingLight = outgoingLight * ( 1.0 - material.clearcoat * Fcc ) + clearcoatSpecular * material.clearcoat;\n\t#endif\n\t#include <output_fragment>\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",meshtoon_vert:"#define TOON\nvarying vec3 vViewPosition;\n#include <common>\n#include <uv_pars_vertex>\n#include <uv2_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <normal_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <uv2_vertex>\n\t#include <color_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <normal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\tvViewPosition = - mvPosition.xyz;\n\t#include <worldpos_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n}",meshtoon_frag:"#define TOON\nuniform vec3 diffuse;\nuniform vec3 emissive;\nuniform float opacity;\n#include <common>\n#include <packing>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <uv2_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <gradientmap_pars_fragment>\n#include <fog_pars_fragment>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <normal_pars_fragment>\n#include <lights_toon_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\tvec3 totalEmissiveRadiance = emissive;\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\t#include <emissivemap_fragment>\n\t#include <lights_toon_fragment>\n\t#include <lights_fragment_begin>\n\t#include <lights_fragment_maps>\n\t#include <lights_fragment_end>\n\t#include <aomap_fragment>\n\tvec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + totalEmissiveRadiance;\n\t#include <output_fragment>\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",points_vert:"uniform float size;\nuniform float scale;\n#include <common>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <color_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <project_vertex>\n\tgl_PointSize = size;\n\t#ifdef USE_SIZEATTENUATION\n\t\tbool isPerspective = isPerspectiveMatrix( projectionMatrix );\n\t\tif ( isPerspective ) gl_PointSize *= ( scale / - mvPosition.z );\n\t#endif\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <worldpos_vertex>\n\t#include <fog_vertex>\n}",points_frag:"uniform vec3 diffuse;\nuniform float opacity;\n#include <common>\n#include <color_pars_fragment>\n#include <map_particle_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <fog_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec3 outgoingLight = vec3( 0.0 );\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <logdepthbuf_fragment>\n\t#include <map_particle_fragment>\n\t#include <color_fragment>\n\t#include <alphatest_fragment>\n\toutgoingLight = diffuseColor.rgb;\n\t#include <output_fragment>\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n}",shadow_vert:"#include <common>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\nvoid main() {\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <project_vertex>\n\t#include <worldpos_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n}",shadow_frag:"uniform vec3 color;\nuniform float opacity;\n#include <common>\n#include <packing>\n#include <fog_pars_fragment>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <shadowmap_pars_fragment>\n#include <shadowmask_pars_fragment>\nvoid main() {\n\tgl_FragColor = vec4( color, opacity * ( 1.0 - getShadowMask() ) );\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n}",sprite_vert:"uniform float rotation;\nuniform vec2 center;\n#include <common>\n#include <uv_pars_vertex>\n#include <fog_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\tvec4 mvPosition = modelViewMatrix * vec4( 0.0, 0.0, 0.0, 1.0 );\n\tvec2 scale;\n\tscale.x = length( vec3( modelMatrix[ 0 ].x, modelMatrix[ 0 ].y, modelMatrix[ 0 ].z ) );\n\tscale.y = length( vec3( modelMatrix[ 1 ].x, modelMatrix[ 1 ].y, modelMatrix[ 1 ].z ) );\n\t#ifndef USE_SIZEATTENUATION\n\t\tbool isPerspective = isPerspectiveMatrix( projectionMatrix );\n\t\tif ( isPerspective ) scale *= - mvPosition.z;\n\t#endif\n\tvec2 alignedPosition = ( position.xy - ( center - vec2( 0.5 ) ) ) * scale;\n\tvec2 rotatedPosition;\n\trotatedPosition.x = cos( rotation ) * alignedPosition.x - sin( rotation ) * alignedPosition.y;\n\trotatedPosition.y = sin( rotation ) * alignedPosition.x + cos( rotation ) * alignedPosition.y;\n\tmvPosition.xy += rotatedPosition;\n\tgl_Position = projectionMatrix * mvPosition;\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <fog_vertex>\n}",sprite_frag:"uniform vec3 diffuse;\nuniform float opacity;\n#include <common>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <fog_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec3 outgoingLight = vec3( 0.0 );\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\toutgoingLight = diffuseColor.rgb;\n\t#include <output_fragment>\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n}"},Yl={common:{diffuse:{value:new Js(16777215)},opacity:{value:1},map:{value:null},uvTransform:{value:new So},uv2Transform:{value:new So},alphaMap:{value:null},alphaTest:{value:0}},specularmap:{specularMap:{value:null}},envmap:{envMap:{value:null},flipEnvMap:{value:-1},reflectivity:{value:1},ior:{value:1.5},refractionRatio:{value:.98}},aomap:{aoMap:{value:null},aoMapIntensity:{value:1}},lightmap:{lightMap:{value:null},lightMapIntensity:{value:1}},emissivemap:{emissiveMap:{value:null}},bumpmap:{bumpMap:{value:null},bumpScale:{value:1}},normalmap:{normalMap:{value:null},normalScale:{value:new bo(1,1)}},displacementmap:{displacementMap:{value:null},displacementScale:{value:1},displacementBias:{value:0}},roughnessmap:{roughnessMap:{value:null}},metalnessmap:{metalnessMap:{value:null}},gradientmap:{gradientMap:{value:null}},fog:{fogDensity:{value:25e-5},fogNear:{value:1},fogFar:{value:2e3},fogColor:{value:new Js(16777215)}},lights:{ambientLightColor:{value:[]},lightProbe:{value:[]},directionalLights:{value:[],properties:{direction:{},color:{}}},directionalLightShadows:{value:[],properties:{shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{}}},directionalShadowMap:{value:[]},directionalShadowMatrix:{value:[]},spotLights:{value:[],properties:{color:{},position:{},direction:{},distance:{},coneCos:{},penumbraCos:{},decay:{}}},spotLightShadows:{value:[],properties:{shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{}}},spotShadowMap:{value:[]},spotShadowMatrix:{value:[]},pointLights:{value:[],properties:{color:{},position:{},decay:{},distance:{}}},pointLightShadows:{value:[],properties:{shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{},shadowCameraNear:{},shadowCameraFar:{}}},pointShadowMap:{value:[]},pointShadowMatrix:{value:[]},hemisphereLights:{value:[],properties:{direction:{},skyColor:{},groundColor:{}}},rectAreaLights:{value:[],properties:{color:{},position:{},width:{},height:{}}},ltc_1:{value:null},ltc_2:{value:null}},points:{diffuse:{value:new Js(16777215)},opacity:{value:1},size:{value:1},scale:{value:1},map:{value:null},alphaMap:{value:null},alphaTest:{value:0},uvTransform:{value:new So}},sprite:{diffuse:{value:new Js(16777215)},opacity:{value:1},center:{value:new bo(.5,.5)},rotation:{value:0},map:{value:null},alphaMap:{value:null},alphaTest:{value:0},uvTransform:{value:new So}}},Zl={basic:{uniforms:x([Yl.common,Yl.specularmap,Yl.envmap,Yl.aomap,Yl.lightmap,Yl.fog]),vertexShader:Xl.meshbasic_vert,fragmentShader:Xl.meshbasic_frag},lambert:{uniforms:x([Yl.common,Yl.specularmap,Yl.envmap,Yl.aomap,Yl.lightmap,Yl.emissivemap,Yl.fog,Yl.lights,{emissive:{value:new Js(0)}}]),vertexShader:Xl.meshlambert_vert,fragmentShader:Xl.meshlambert_frag},phong:{uniforms:x([Yl.common,Yl.specularmap,Yl.envmap,Yl.aomap,Yl.lightmap,Yl.emissivemap,Yl.bumpmap,Yl.normalmap,Yl.displacementmap,Yl.fog,Yl.lights,{emissive:{value:new Js(0)},specular:{value:new Js(1118481)},shininess:{value:30}}]),vertexShader:Xl.meshphong_vert,fragmentShader:Xl.meshphong_frag},standard:{uniforms:x([Yl.common,Yl.envmap,Yl.aomap,Yl.lightmap,Yl.emissivemap,Yl.bumpmap,Yl.normalmap,Yl.displacementmap,Yl.roughnessmap,Yl.metalnessmap,Yl.fog,Yl.lights,{emissive:{value:new Js(0)},roughness:{value:1},metalness:{value:0},envMapIntensity:{value:1}}]),vertexShader:Xl.meshphysical_vert,fragmentShader:Xl.meshphysical_frag},toon:{uniforms:x([Yl.common,Yl.aomap,Yl.lightmap,Yl.emissivemap,Yl.bumpmap,Yl.normalmap,Yl.displacementmap,Yl.gradientmap,Yl.fog,Yl.lights,{emissive:{value:new Js(0)}}]),vertexShader:Xl.meshtoon_vert,fragmentShader:Xl.meshtoon_frag},matcap:{uniforms:x([Yl.common,Yl.bumpmap,Yl.normalmap,Yl.displacementmap,Yl.fog,{matcap:{value:null}}]),vertexShader:Xl.meshmatcap_vert,fragmentShader:Xl.meshmatcap_frag},points:{uniforms:x([Yl.points,Yl.fog]),vertexShader:Xl.points_vert,fragmentShader:Xl.points_frag},dashed:{uniforms:x([Yl.common,Yl.fog,{scale:{value:1},dashSize:{value:1},totalSize:{value:2}}]),vertexShader:Xl.linedashed_vert,fragmentShader:Xl.linedashed_frag},depth:{uniforms:x([Yl.common,Yl.displacementmap]),vertexShader:Xl.depth_vert,fragmentShader:Xl.depth_frag},normal:{uniforms:x([Yl.common,Yl.bumpmap,Yl.normalmap,Yl.displacementmap,{opacity:{value:1}}]),vertexShader:Xl.meshnormal_vert,fragmentShader:Xl.meshnormal_frag},sprite:{uniforms:x([Yl.sprite,Yl.fog]),vertexShader:Xl.sprite_vert,fragmentShader:Xl.sprite_frag},background:{uniforms:{uvTransform:{value:new So},t2D:{value:null}},vertexShader:Xl.background_vert,fragmentShader:Xl.background_frag},cube:{uniforms:x([Yl.envmap,{opacity:{value:1}}]),vertexShader:Xl.cube_vert,fragmentShader:Xl.cube_frag},equirect:{uniforms:{tEquirect:{value:null}},vertexShader:Xl.equirect_vert,fragmentShader:Xl.equirect_frag},distanceRGBA:{uniforms:x([Yl.common,Yl.displacementmap,{referencePosition:{value:new Po},nearDistance:{value:1},farDistance:{value:1e3}}]),vertexShader:Xl.distanceRGBA_vert,fragmentShader:Xl.distanceRGBA_frag},shadow:{uniforms:x([Yl.lights,Yl.fog,{color:{value:new Js(0)},opacity:{value:1}}]),vertexShader:Xl.shadow_vert,fragmentShader:Xl.shadow_frag}};Zl.physical={uniforms:x([Zl.standard.uniforms,{clearcoat:{value:0},clearcoatMap:{value:null},clearcoatRoughness:{value:0},clearcoatRoughnessMap:{value:null},clearcoatNormalScale:{value:new bo(1,1)},clearcoatNormalMap:{value:null},sheen:{value:0},sheenColor:{value:new Js(0)},sheenColorMap:{value:null},sheenRoughness:{value:0},sheenRoughnessMap:{value:null},transmission:{value:0},transmissionMap:{value:null},transmissionSamplerSize:{value:new bo},transmissionSamplerMap:{value:null},thickness:{value:0},thicknessMap:{value:null},attenuationDistance:{value:0},attenuationColor:{value:new Js(0)},specularIntensity:{value:0},specularIntensityMap:{value:null},specularColor:{value:new Js(1,1,1)},specularColorMap:{value:null}}]),vertexShader:Xl.meshphysical_vert,fragmentShader:Xl.meshphysical_frag};function M(e,t,a,r,i){var s=new Js(0),l=0,d,c,u=null,p=0,m=null;function n(a,i){var n=!1,g=!0===i.isScene?i.background:null;if(g&&g.isTexture){g=t.get(g)}var f=e.xr,h=f.getSession&&f.getSession();if(h&&"additive"===h.environmentBlendMode){g=null}if(null===g){o(s,l)}else if(g&&g.isColor){o(g,1);n=!0}if(e.autoClear||n){e.clear(e.autoClearColor,e.autoClearDepth,e.autoClearStencil)}if(g&&(g.isCubeTexture||g.mapping===vi)){if(c===void 0){c=new Ll(new Rl(1,1,1),new Dl({name:"BackgroundCubeMaterial",uniforms:_(Zl.cube.uniforms),vertexShader:Zl.cube.vertexShader,fragmentShader:Zl.cube.fragmentShader,side:Tr,depthTest:!1,depthWrite:!1,fog:!1}));c.geometry.deleteAttribute("normal");c.geometry.deleteAttribute("uv");c.onBeforeRender=function(e,t,a){this.matrixWorld.copyPosition(a.matrixWorld)};Object.defineProperty(c.material,"envMap",{get:function get(){return this.uniforms.envMap.value}});r.update(c)}c.material.uniforms.envMap.value=g;c.material.uniforms.flipEnvMap.value=g.isCubeTexture&&!1===g.isRenderTargetTexture?-1:1;if(u!==g||p!==g.version||m!==e.toneMapping){c.material.needsUpdate=!0;u=g;p=g.version;m=e.toneMapping}a.unshift(c,c.geometry,c.material,0,0,null)}else if(g&&g.isTexture){if(d===void 0){d=new Ll(new ql(2,2),new Dl({name:"BackgroundMaterial",uniforms:_(Zl.background.uniforms),vertexShader:Zl.background.vertexShader,fragmentShader:Zl.background.fragmentShader,side:Mr,depthTest:!1,depthWrite:!1,fog:!1}));d.geometry.deleteAttribute("normal");Object.defineProperty(d.material,"map",{get:function get(){return this.uniforms.t2D.value}});r.update(d)}d.material.uniforms.t2D.value=g;if(!0===g.matrixAutoUpdate){g.updateMatrix()}d.material.uniforms.uvTransform.value.copy(g.matrix);if(u!==g||p!==g.version||m!==e.toneMapping){d.material.needsUpdate=!0;u=g;p=g.version;m=e.toneMapping}a.unshift(d,d.geometry,d.material,0,0,null)}}function o(e,t){a.buffers.color.setClear(e.r,e.g,e.b,t,i)}return{getClearColor:function getClearColor(){return s},setClearColor:function setClearColor(e){var t=1<arguments.length&&arguments[1]!==void 0?arguments[1]:1;s.set(e);l=t;o(s,l)},getClearAlpha:function getClearAlpha(){return l},setClearAlpha:function setClearAlpha(e){l=e;o(s,l)},render:n}}function T(e,t,a,r){var x=e.getParameter(34921),b=r.isWebGL2?null:t.get("OES_vertex_array_object"),S=r.isWebGL2||null!==b,M={},T=d(null),E=T;function i(t,r,i,n,s){var d=!1;if(S){var p=l(n,i,r);if(E!==p){E=p;o(E.object)}d=c(n,s);if(d)u(n,s)}else{var m=!0===r.wireframe;if(E.geometry!==n.id||E.program!==i.id||E.wireframe!==m){E.geometry=n.id;E.program=i.id;E.wireframe=m;d=!0}}if(!0===t.isInstancedMesh){d=!0}if(null!==s){a.update(s,34963)}if(d){v(t,r,i,n);if(null!==s){e.bindBuffer(34963,a.get(s).buffer)}}}function n(){if(r.isWebGL2)return e.createVertexArray();return b.createVertexArrayOES()}function o(t){if(r.isWebGL2)return e.bindVertexArray(t);return b.bindVertexArrayOES(t)}function s(t){if(r.isWebGL2)return e.deleteVertexArray(t);return b.deleteVertexArrayOES(t)}function l(e,t,a){var r=!0===a.wireframe,i=M[e.id];if(i===void 0){i={};M[e.id]=i}var o=i[t.id];if(o===void 0){o={};i[t.id]=o}var s=o[r];if(s===void 0){s=d(n());o[r]=s}return s}function d(e){for(var t=[],a=[],r=[],i=0;i<x;i++){t[i]=0;a[i]=0;r[i]=0}return{geometry:null,program:null,wireframe:!1,newAttributes:t,enabledAttributes:a,attributeDivisors:r,object:e,attributes:{},index:null}}function c(e,t){var a=E.attributes,r=e.attributes,i=0;for(var s in r){var n=a[s],o=r[s];if(n===void 0)return!0;if(n.attribute!==o)return!0;if(n.data!==o.data)return!0;i++}if(E.attributesNum!==i)return!0;if(E.index!==t)return!0;return!1}function u(e,t){var a={},r=e.attributes,i=0;for(var s in r){var n=r[s],o={};o.attribute=n;if(n.data){o.data=n.data}a[s]=o;i++}E.attributes=a;E.attributesNum=i;E.index=t}function p(){for(var e=E.newAttributes,t=0,a=e.length;t<a;t++){e[t]=0}}function m(e){g(e,0)}function g(a,i){var n=E.newAttributes,o=E.enabledAttributes,s=E.attributeDivisors;n[a]=1;if(0===o[a]){e.enableVertexAttribArray(a);o[a]=1}if(s[a]!==i){var l=r.isWebGL2?e:t.get("ANGLE_instanced_arrays");l[r.isWebGL2?"vertexAttribDivisor":"vertexAttribDivisorANGLE"](a,i);s[a]=i}}function f(){for(var t=E.newAttributes,a=E.enabledAttributes,r=0,i=a.length;r<i;r++){if(a[r]!==t[r]){e.disableVertexAttribArray(r);a[r]=0}}}function h(t,a,i,n,o,s){if(!0===r.isWebGL2&&(5124===i||5125===i)){e.vertexAttribIPointer(t,a,i,o,s)}else{e.vertexAttribPointer(t,a,i,n,o,s)}}function v(i,n,o,s){if(!1===r.isWebGL2&&(i.isInstancedMesh||s.isInstancedBufferGeometry)){if(null===t.get("ANGLE_instanced_arrays"))return}p();var l=s.attributes,d=o.getAttributes(),c=n.defaultAttributeValues;for(var E in d){var w=d[E];if(0<=w.location){var A=l[E];if(A===void 0){if("instanceMatrix"===E&&i.instanceMatrix)A=i.instanceMatrix;if("instanceColor"===E&&i.instanceColor)A=i.instanceColor}if(A!==void 0){var u=A.normalized,v=A.itemSize,y=a.get(A);if(y===void 0)continue;var _=y.buffer,x=y.type,b=y.bytesPerElement;if(A.isInterleavedBufferAttribute){var S=A.data,M=S.stride,T=A.offset;if(S&&S.isInstancedInterleavedBuffer){for(var k=0;k<w.locationSize;k++){g(w.location+k,S.meshPerAttribute)}if(!0!==i.isInstancedMesh&&s._maxInstanceCount===void 0){s._maxInstanceCount=S.meshPerAttribute*S.count}}else{for(var C=0;C<w.locationSize;C++){m(w.location+C)}}e.bindBuffer(34962,_);for(var L=0;L<w.locationSize;L++){h(w.location+L,v/w.locationSize,x,u,M*b,(T+v/w.locationSize*L)*b)}}else{if(A.isInstancedBufferAttribute){for(var R=0;R<w.locationSize;R++){g(w.location+R,A.meshPerAttribute)}if(!0!==i.isInstancedMesh&&s._maxInstanceCount===void 0){s._maxInstanceCount=A.meshPerAttribute*A.count}}else{for(var P=0;P<w.locationSize;P++){m(w.location+P)}}e.bindBuffer(34962,_);for(var D=0;D<w.locationSize;D++){h(w.location+D,v/w.locationSize,x,u,v*b,v/w.locationSize*D*b)}}}else if(c!==void 0){var I=c[E];if(I!==void 0){switch(I.length){case 2:e.vertexAttrib2fv(w.location,I);break;case 3:e.vertexAttrib3fv(w.location,I);break;case 4:e.vertexAttrib4fv(w.location,I);break;default:e.vertexAttrib1fv(w.location,I);}}}}}f()}function y(){_();if(E===T)return;E=T;o(E.object)}function _(){T.geometry=null;T.program=null;T.wireframe=!1}return{setup:i,reset:y,resetDefaultState:_,dispose:function(){y();for(var e in M){var t=M[e];for(var a in t){var r=t[a];for(var i in r){s(r[i].object);delete r[i]}delete t[a]}delete M[e]}},releaseStatesOfGeometry:function(e){if(M[e.id]===void 0)return;var t=M[e.id];for(var a in t){var r=t[a];for(var i in r){s(r[i].object);delete r[i]}delete t[a]}delete M[e.id]},releaseStatesOfProgram:function(e){for(var t in M){var a=M[t];if(a[e.id]===void 0)continue;var r=a[e.id];for(var i in r){s(r[i].object);delete r[i]}delete a[e.id]}},initAttributes:p,enableAttribute:m,disableUnusedAttributes:f}}function E(e,t,a,r){var o=r.isWebGL2,s;function i(t,r){e.drawArrays(s,t,r);a.update(r,s,1)}function n(r,i,n){if(0===n)return;var l,d;if(o){l=e;d="drawArraysInstanced"}else{l=t.get("ANGLE_instanced_arrays");d="drawArraysInstancedANGLE";if(null===l){console.error("THREE.WebGLBufferRenderer: using THREE.InstancedBufferGeometry but hardware does not support extension ANGLE_instanced_arrays.");return}}l[d](s,r,i,n);a.update(i,s,n)}this.setMode=function(e){s=e};this.render=i;this.renderInstances=n}function A(e,t,a){var n;function r(){if(n!==void 0)return n;if(!0===t.has("EXT_texture_filter_anisotropic")){var a=t.get("EXT_texture_filter_anisotropic");n=e.getParameter(a.MAX_TEXTURE_MAX_ANISOTROPY_EXT)}else{n=0}return n}function i(t){if("highp"===t){if(0<e.getShaderPrecisionFormat(35633,36338).precision&&0<e.getShaderPrecisionFormat(35632,36338).precision){return"highp"}t="mediump"}if("mediump"===t){if(0<e.getShaderPrecisionFormat(35633,36337).precision&&0<e.getShaderPrecisionFormat(35632,36337).precision){return"mediump"}}return"lowp"}var o="undefined"!=typeof WebGL2RenderingContext&&e instanceof WebGL2RenderingContext||"undefined"!=typeof WebGL2ComputeRenderingContext&&e instanceof WebGL2ComputeRenderingContext,s=a.precision!==void 0?a.precision:"highp",l=i(s);if(l!==s){console.warn("THREE.WebGLRenderer:",s,"not supported, using",l,"instead.");s=l}var d=o||t.has("WEBGL_draw_buffers"),c=!0===a.logarithmicDepthBuffer,u=e.getParameter(34930),p=e.getParameter(35660),m=e.getParameter(3379),g=e.getParameter(34076),f=e.getParameter(34921),h=e.getParameter(36347),v=e.getParameter(36348),y=e.getParameter(36349),_=0<p,x=o||t.has("OES_texture_float"),b=o?e.getParameter(36183):0;return{isWebGL2:o,drawBuffers:d,getMaxAnisotropy:r,getMaxPrecision:i,precision:s,logarithmicDepthBuffer:c,maxTextures:u,maxVertexTextures:p,maxTextureSize:m,maxCubemapSize:g,maxAttributes:f,maxVertexUniforms:h,maxVaryings:v,maxFragmentUniforms:y,vertexTextures:_,floatFragmentTextures:x,floatVertexTextures:_&&x,maxSamples:b}}function k(e){var r=this,i=null,n=0,o=!1,s=!1,l=new Gl,d=new So,c={value:null,needsUpdate:!1};this.uniform=c;this.numPlanes=0;this.numIntersection=0;this.init=function(e,t,r){var s=0!==e.length||t||0!==n||o;o=t;i=a(e,r,0);n=e.length;return s};this.beginShadows=function(){s=!0;a(null)};this.endShadows=function(){s=!1;t()};this.setState=function(r,l,d){var u=r.clippingPlanes,p=r.clipIntersection,m=r.clipShadows,g=e.get(r);if(!o||null===u||0===u.length||s&&!m){if(s){a(null)}else{t()}}else{var f=s?0:n,h=4*f,v=g.clippingState||null;c.value=v;v=a(u,l,h,d);for(var y=0;y!=h;++y){v[y]=i[y]}g.clippingState=v;this.numIntersection=p?this.numPlanes:0;this.numPlanes+=f}};function t(){if(c.value!==i){c.value=i;c.needsUpdate=0<n}r.numPlanes=n;r.numIntersection=0}function a(e,t,a,i){var n=null!==e?e.length:0,o=null;if(0!==n){o=c.value;if(!0!==i||null===o){var s=a+4*n,u=t.matrixWorldInverse;d.getNormalMatrix(u);if(null===o||o.length<s){o=new Float32Array(s)}for(var p=0,m=a;p!==n;++p,m+=4){l.copy(e[p]).applyMatrix4(u,d);l.normal.toArray(o,m);o[m+3]=l.constant}}c.value=o;c.needsUpdate=!0}r.numPlanes=n;r.numIntersection=0;return o}}function C(e){var i=new WeakMap;function t(e,t){if(t===fi){e.mapping=mi}else if(t===hi){e.mapping=gi}return e}function a(a){if(a&&a.isTexture&&!1===a.isRenderTargetTexture){var s=a.mapping;if(s===fi||s===hi){if(i.has(a)){var l=i.get(a).texture;return t(l,a.mapping)}else{var d=a.image;if(d&&0<d.height){var n=e.getRenderTarget(),o=new Fl(d.height/2);o.fromEquirectangularTexture(e,a);i.set(a,o);e.setRenderTarget(n);a.addEventListener("dispose",r);return t(o.texture,a.mapping)}else{return null}}}}return a}function r(e){var t=e.target;t.removeEventListener("dispose",r);var a=i.get(t);if(a!==void 0){i.delete(t);a.dispose()}}return{get:a,dispose:function(){i=new WeakMap}}}var Jl=function(e){_inherits(t,e);var a=_createSuper(t);function t(){var e,r=0<arguments.length&&arguments[0]!==void 0?arguments[0]:-1,i=1<arguments.length&&arguments[1]!==void 0?arguments[1]:1,n=2<arguments.length&&arguments[2]!==void 0?arguments[2]:1,o=3<arguments.length&&arguments[3]!==void 0?arguments[3]:-1,s=4<arguments.length&&arguments[4]!==void 0?arguments[4]:.1,l=5<arguments.length&&arguments[5]!==void 0?arguments[5]:2e3;_classCallCheck2(this,t);e=a.call(this);e.type="OrthographicCamera";e.zoom=1;e.view=null;e.left=r;e.right=i;e.top=n;e.bottom=o;e.near=s;e.far=l;e.updateProjectionMatrix();return e}_createClass2(t,[{key:"copy",value:function copy(e,a){_get(_getPrototypeOf(t.prototype),"copy",this).call(this,e,a);this.left=e.left;this.right=e.right;this.top=e.top;this.bottom=e.bottom;this.near=e.near;this.far=e.far;this.zoom=e.zoom;this.view=null===e.view?null:Object.assign({},e.view);return this}},{key:"setViewOffset",value:function setViewOffset(e,t,a,r,i,n){if(null===this.view){this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}}this.view.enabled=!0;this.view.fullWidth=e;this.view.fullHeight=t;this.view.offsetX=a;this.view.offsetY=r;this.view.width=i;this.view.height=n;this.updateProjectionMatrix()}},{key:"clearViewOffset",value:function clearViewOffset(){if(null!==this.view){this.view.enabled=!1}this.updateProjectionMatrix()}},{key:"updateProjectionMatrix",value:function updateProjectionMatrix(){var e=(this.right-this.left)/(2*this.zoom),t=(this.top-this.bottom)/(2*this.zoom),a=(this.right+this.left)/2,r=(this.top+this.bottom)/2,i=a-e,n=a+e,o=r+t,s=r-t;if(null!==this.view&&this.view.enabled){var l=(this.right-this.left)/this.view.fullWidth/this.zoom,d=(this.top-this.bottom)/this.view.fullHeight/this.zoom;i+=l*this.view.offsetX;n=i+l*this.view.width;o-=d*this.view.offsetY;s=o-d*this.view.height}this.projectionMatrix.makeOrthographic(i,n,o,s,this.near,this.far);this.projectionMatrixInverse.copy(this.projectionMatrix).invert()}},{key:"toJSON",value:function toJSON(e){var a=_get(_getPrototypeOf(t.prototype),"toJSON",this).call(this,e);a.object.zoom=this.zoom;a.object.left=this.left;a.object.right=this.right;a.object.top=this.top;a.object.bottom=this.bottom;a.object.near=this.near;a.object.far=this.far;if(null!==this.view)a.object.view=Object.assign({},this.view);return a}}]);return t}(Il);Jl.prototype.isOrthographicCamera=!0;var Ql=function(e){_inherits(t,e);var a=_createSuper(t);function t(e){var r;_classCallCheck2(this,t);r=a.call(this,e);r.type="RawShaderMaterial";return r}return t}(Dl);Ql.prototype.isRawShaderMaterial=!0;var Kl=8,$l=Math.pow(2,Kl),ed=[.125,.215,.35,.446,.526,.582],td=Kl-4+1+ed.length,ad=20,rd=(fr={},_defineProperty2(fr,$n,0),_defineProperty2(fr,eo,1),_defineProperty2(fr,ao,2),_defineProperty2(fr,ro,3),_defineProperty2(fr,io,4),_defineProperty2(fr,no,5),_defineProperty2(fr,to,6),fr),id=new Jl,nd=function(){for(var e=[],t=[],a=[],r=Kl,i=0,n;i<td;i++){n=Math.pow(2,r);t.push(n);var y=1/n;if(i>Kl-4){y=ed[i-Kl+4-1]}else if(0==i){y=0}a.push(y);for(var o=1/(n-1),s=-o/2,l=1+o/2,d=[s,s,l,s,l,l,s,s,l,l,s,l],c=6,u=6,p=3,m=2,g=1,f=new Float32Array(p*u*c),h=new Float32Array(m*u*c),v=new Float32Array(g*u*c),_=0;_<c;_++){var b=2*(_%3)/3-1,x=2<_?0:-1;f.set([b,x,0,b+2/3,x,0,b+2/3,x+1,0,b,x,0,b+2/3,x+1,0,b,x+1,0],p*u*_);h.set(d,m*u*_);var S=[_,_,_,_,_,_];v.set(S,g*u*_)}var M=new pl;M.setAttribute("position",new el(f,p));M.setAttribute("uv",new el(h,m));M.setAttribute("faceIndex",new el(v,g));e.push(M);if(r>4){r--}}return{_lodPlanes:e,_sizeLods:t,_sigmas:a}}(),od=nd._lodPlanes,sd=nd._sizeLods,ld=nd._sigmas,dd=new Js,cd=null,ud=(1+Math.sqrt(5))/2,pd=1/ud,md=[new Po(1,1,1),new Po(-1,1,1),new Po(1,1,-1),new Po(-1,1,-1),new Po(0,ud,pd),new Po(0,ud,-pd),new Po(pd,0,ud),new Po(-pd,0,ud),new Po(ud,pd,0),new Po(-ud,pd,0)],gd=function(){function e(t){_classCallCheck2(this,e);this._renderer=t;this._pingPongRenderTarget=null;this._blurMaterial=D(ad);this._equirectShader=null;this._cubemapShader=null;this._compileMaterial(this._blurMaterial)}_createClass2(e,[{key:"fromScene",value:function fromScene(e){var t=1<arguments.length&&arguments[1]!==void 0?arguments[1]:0,a=2<arguments.length&&arguments[2]!==void 0?arguments[2]:.1,r=3<arguments.length&&arguments[3]!==void 0?arguments[3]:100;cd=this._renderer.getRenderTarget();var i=this._allocateTargets();this._sceneToCubeUV(e,a,r,i);if(0<t){this._blur(i,0,0,t)}this._applyPMREM(i);this._cleanup(i);return i}},{key:"fromEquirectangular",value:function fromEquirectangular(e){return this._fromTexture(e)}},{key:"fromCubemap",value:function fromCubemap(e){return this._fromTexture(e)}},{key:"compileCubemapShader",value:function compileCubemapShader(){if(null===this._cubemapShader){this._cubemapShader=z();this._compileMaterial(this._cubemapShader)}}},{key:"compileEquirectangularShader",value:function compileEquirectangularShader(){if(null===this._equirectShader){this._equirectShader=I();this._compileMaterial(this._equirectShader)}}},{key:"dispose",value:function dispose(){this._blurMaterial.dispose();if(null!==this._cubemapShader)this._cubemapShader.dispose();if(null!==this._equirectShader)this._equirectShader.dispose();for(var e=0;e<od.length;e++){od[e].dispose()}}},{key:"_cleanup",value:function _cleanup(e){this._pingPongRenderTarget.dispose();this._renderer.setRenderTarget(cd);e.scissorTest=!1;P(e,0,0,e.width,e.height)}},{key:"_fromTexture",value:function _fromTexture(e){cd=this._renderer.getRenderTarget();var t=this._allocateTargets(e);this._textureToCubeUV(e,t);this._applyPMREM(t);this._cleanup(t);return t}},{key:"_allocateTargets",value:function _allocateTargets(e){var t={magFilter:Si,minFilter:Si,generateMipmaps:!1,type:ki,format:ji,encoding:L(e)?e.encoding:ao,depthBuffer:!1},a=R(t);a.depthBuffer=e?!1:!0;this._pingPongRenderTarget=R(t);return a}},{key:"_compileMaterial",value:function _compileMaterial(e){var t=new Ll(od[0],e);this._renderer.compile(t,id)}},{key:"_sceneToCubeUV",value:function _sceneToCubeUV(e,t,a,r){var i=new zl(90,1,t,a),n=[1,-1,1,1,1,1],o=[1,1,1,-1,-1,-1],s=this._renderer,l=s.autoClear,d=s.outputEncoding,c=s.toneMapping;s.getClearColor(dd);s.toneMapping=oi;s.outputEncoding=$n;s.autoClear=!1;var u=new Qs({name:"PMREM.Background",side:Tr,depthWrite:!1,depthTest:!1}),p=new Ll(new Rl(),u),m=!1,g=e.background;if(g){if(g.isColor){u.color.copy(g);e.background=null;m=!0}}else{u.color.copy(dd);m=!0}for(var f=0,h;6>f;f++){h=f%3;if(0==h){i.up.set(0,n[f],0);i.lookAt(o[f],0,0)}else if(1==h){i.up.set(0,0,n[f]);i.lookAt(0,o[f],0)}else{i.up.set(0,n[f],0);i.lookAt(0,0,o[f])}P(r,h*$l,2<f?$l:0,$l,$l);s.setRenderTarget(r);if(m){s.render(p,i)}s.render(e,i)}p.geometry.dispose();p.material.dispose();s.toneMapping=c;s.outputEncoding=d;s.autoClear=l;e.background=g}},{key:"_setEncoding",value:function _setEncoding(e,t){e.value=rd[t.encoding]}},{key:"_textureToCubeUV",value:function _textureToCubeUV(e,t){var a=this._renderer,r=e.mapping===mi||e.mapping===gi;if(r){if(null==this._cubemapShader){this._cubemapShader=z()}}else{if(null==this._equirectShader){this._equirectShader=I()}}var i=r?this._cubemapShader:this._equirectShader,n=new Ll(od[0],i),o=i.uniforms;o.envMap.value=e;if(!r){o.texelSize.value.set(1/e.image.width,1/e.image.height)}this._setEncoding(o.inputEncoding,e);this._setEncoding(o.outputEncoding,t.texture);P(t,0,0,3*$l,2*$l);a.setRenderTarget(t);a.render(n,id)}},{key:"_applyPMREM",value:function _applyPMREM(e){var t=this._renderer,a=t.autoClear;t.autoClear=!1;for(var n=1;n<td;n++){var r=Math.sqrt(ld[n]*ld[n]-ld[n-1]*ld[n-1]),i=md[(n-1)%md.length];this._blur(e,n-1,n,r,i)}t.autoClear=a}},{key:"_blur",value:function _blur(e,t,a,r,i){var n=this._pingPongRenderTarget;this._halfBlur(e,n,t,a,r,"latitudinal",i);this._halfBlur(n,e,a,a,r,"longitudinal",i)}},{key:"_halfBlur",value:function _halfBlur(e,t,a,r,i,n,o){var s=this._renderer,l=this._blurMaterial;if("latitudinal"!==n&&"longitudinal"!==n){console.error("blur direction must be either latitudinal or longitudinal!")}var d=new Ll(od[r],l),c=l.uniforms,u=sd[a]-1,p=isFinite(i)?Math.PI/(2*u):2*Math.PI/(2*ad-1),m=i/p,g=isFinite(i)?1+Math.floor(3*m):ad;if(g>ad){console.warn("sigmaRadians, ".concat(i,", is too large and will clip, as it requested ").concat(g," samples when the maximum is set to ").concat(ad))}for(var f=[],h=0,v=0;v<ad;++v){var _=v/m,b=Math.exp(-_*_/2);f.push(b);if(0==v){h+=b}else if(v<g){h+=2*b}}for(var y=0;y<f.length;y++){f[y]=f[y]/h}c.envMap.value=e.texture;c.samples.value=g;c.weights.value=f;c.latitudinal.value="latitudinal"===n;if(o){c.poleAxis.value=o}c.dTheta.value=p;c.mipInt.value=Kl-a;this._setEncoding(c.inputEncoding,e.texture);this._setEncoding(c.outputEncoding,e.texture);var S=sd[r],M=3*Math.max(0,$l-2*S),x=(0===r?0:2*$l)+2*S*(r>Kl-4?r-Kl+4:0);P(t,M,x,3*S,2*S);s.setRenderTarget(t);s.render(d,id)}}]);return e}();function L(e){if(e===void 0||e.type!==ki)return!1;return e.encoding===$n||e.encoding===eo||e.encoding===to}function R(e){var t=new ko(3*$l,3*$l,e);t.texture.mapping=vi;t.texture.name="PMREM.cubeUv";t.scissorTest=!0;return t}function P(e,t,a,r,i){e.viewport.set(t,a,r,i);e.scissor.set(t,a,r,i)}function D(e){var t=new Float32Array(e),a=new Po(0,1,0),r=new Ql({name:"SphericalGaussianBlur",defines:{n:e},uniforms:{envMap:{value:null},samples:{value:1},weights:{value:t},latitudinal:{value:!1},dTheta:{value:0},mipInt:{value:0},poleAxis:{value:a},inputEncoding:{value:rd[$n]},outputEncoding:{value:rd[$n]}},vertexShader:N(),fragmentShader:"\n\n\t\t\tprecision mediump float;\n\t\t\tprecision mediump int;\n\n\t\t\tvarying vec3 vOutputDirection;\n\n\t\t\tuniform sampler2D envMap;\n\t\t\tuniform int samples;\n\t\t\tuniform float weights[ n ];\n\t\t\tuniform bool latitudinal;\n\t\t\tuniform float dTheta;\n\t\t\tuniform float mipInt;\n\t\t\tuniform vec3 poleAxis;\n\n\t\t\t".concat(O(),"\n\n\t\t\t#define ENVMAP_TYPE_CUBE_UV\n\t\t\t#include <cube_uv_reflection_fragment>\n\n\t\t\tvec3 getSample( float theta, vec3 axis ) {\n\n\t\t\t\tfloat cosTheta = cos( theta );\n\t\t\t\t// Rodrigues' axis-angle rotation\n\t\t\t\tvec3 sampleDirection = vOutputDirection * cosTheta\n\t\t\t\t\t+ cross( axis, vOutputDirection ) * sin( theta )\n\t\t\t\t\t+ axis * dot( axis, vOutputDirection ) * ( 1.0 - cosTheta );\n\n\t\t\t\treturn bilinearCubeUV( envMap, sampleDirection, mipInt );\n\n\t\t\t}\n\n\t\t\tvoid main() {\n\n\t\t\t\tvec3 axis = latitudinal ? poleAxis : cross( poleAxis, vOutputDirection );\n\n\t\t\t\tif ( all( equal( axis, vec3( 0.0 ) ) ) ) {\n\n\t\t\t\t\taxis = vec3( vOutputDirection.z, 0.0, - vOutputDirection.x );\n\n\t\t\t\t}\n\n\t\t\t\taxis = normalize( axis );\n\n\t\t\t\tgl_FragColor = vec4( 0.0, 0.0, 0.0, 1.0 );\n\t\t\t\tgl_FragColor.rgb += weights[ 0 ] * getSample( 0.0, axis );\n\n\t\t\t\tfor ( int i = 1; i < n; i++ ) {\n\n\t\t\t\t\tif ( i >= samples ) {\n\n\t\t\t\t\t\tbreak;\n\n\t\t\t\t\t}\n\n\t\t\t\t\tfloat theta = dTheta * float( i );\n\t\t\t\t\tgl_FragColor.rgb += weights[ i ] * getSample( -1.0 * theta, axis );\n\t\t\t\t\tgl_FragColor.rgb += weights[ i ] * getSample( theta, axis );\n\n\t\t\t\t}\n\n\t\t\t\tgl_FragColor = linearToOutputTexel( gl_FragColor );\n\n\t\t\t}\n\t\t"),blending:Ar,depthTest:!1,depthWrite:!1});return r}function I(){var e=new bo(1,1),t=new Ql({name:"EquirectangularToCubeUV",uniforms:{envMap:{value:null},texelSize:{value:e},inputEncoding:{value:rd[$n]},outputEncoding:{value:rd[$n]}},vertexShader:N(),fragmentShader:"\n\n\t\t\tprecision mediump float;\n\t\t\tprecision mediump int;\n\n\t\t\tvarying vec3 vOutputDirection;\n\n\t\t\tuniform sampler2D envMap;\n\t\t\tuniform vec2 texelSize;\n\n\t\t\t".concat(O(),"\n\n\t\t\t#include <common>\n\n\t\t\tvoid main() {\n\n\t\t\t\tgl_FragColor = vec4( 0.0, 0.0, 0.0, 1.0 );\n\n\t\t\t\tvec3 outputDirection = normalize( vOutputDirection );\n\t\t\t\tvec2 uv = equirectUv( outputDirection );\n\n\t\t\t\tvec2 f = fract( uv / texelSize - 0.5 );\n\t\t\t\tuv -= f * texelSize;\n\t\t\t\tvec3 tl = envMapTexelToLinear( texture2D ( envMap, uv ) ).rgb;\n\t\t\t\tuv.x += texelSize.x;\n\t\t\t\tvec3 tr = envMapTexelToLinear( texture2D ( envMap, uv ) ).rgb;\n\t\t\t\tuv.y += texelSize.y;\n\t\t\t\tvec3 br = envMapTexelToLinear( texture2D ( envMap, uv ) ).rgb;\n\t\t\t\tuv.x -= texelSize.x;\n\t\t\t\tvec3 bl = envMapTexelToLinear( texture2D ( envMap, uv ) ).rgb;\n\n\t\t\t\tvec3 tm = mix( tl, tr, f.x );\n\t\t\t\tvec3 bm = mix( bl, br, f.x );\n\t\t\t\tgl_FragColor.rgb = mix( tm, bm, f.y );\n\n\t\t\t\tgl_FragColor = linearToOutputTexel( gl_FragColor );\n\n\t\t\t}\n\t\t"),blending:Ar,depthTest:!1,depthWrite:!1});return t}function z(){var e=new Ql({name:"CubemapToCubeUV",uniforms:{envMap:{value:null},inputEncoding:{value:rd[$n]},outputEncoding:{value:rd[$n]}},vertexShader:N(),fragmentShader:"\n\n\t\t\tprecision mediump float;\n\t\t\tprecision mediump int;\n\n\t\t\tvarying vec3 vOutputDirection;\n\n\t\t\tuniform samplerCube envMap;\n\n\t\t\t".concat(O(),"\n\n\t\t\tvoid main() {\n\n\t\t\t\tgl_FragColor = vec4( 0.0, 0.0, 0.0, 1.0 );\n\t\t\t\tgl_FragColor.rgb = envMapTexelToLinear( textureCube( envMap, vec3( - vOutputDirection.x, vOutputDirection.yz ) ) ).rgb;\n\t\t\t\tgl_FragColor = linearToOutputTexel( gl_FragColor );\n\n\t\t\t}\n\t\t"),blending:Ar,depthTest:!1,depthWrite:!1});return e}function N(){return"\n\n\t\tprecision mediump float;\n\t\tprecision mediump int;\n\n\t\tattribute vec3 position;\n\t\tattribute vec2 uv;\n\t\tattribute float faceIndex;\n\n\t\tvarying vec3 vOutputDirection;\n\n\t\t// RH coordinate system; PMREM face-indexing convention\n\t\tvec3 getDirection( vec2 uv, float face ) {\n\n\t\t\tuv = 2.0 * uv - 1.0;\n\n\t\t\tvec3 direction = vec3( uv, 1.0 );\n\n\t\t\tif ( face == 0.0 ) {\n\n\t\t\t\tdirection = direction.zyx; // ( 1, v, u ) pos x\n\n\t\t\t} else if ( face == 1.0 ) {\n\n\t\t\t\tdirection = direction.xzy;\n\t\t\t\tdirection.xz *= -1.0; // ( -u, 1, -v ) pos y\n\n\t\t\t} else if ( face == 2.0 ) {\n\n\t\t\t\tdirection.x *= -1.0; // ( -u, v, 1 ) pos z\n\n\t\t\t} else if ( face == 3.0 ) {\n\n\t\t\t\tdirection = direction.zyx;\n\t\t\t\tdirection.xz *= -1.0; // ( -1, v, -u ) neg x\n\n\t\t\t} else if ( face == 4.0 ) {\n\n\t\t\t\tdirection = direction.xzy;\n\t\t\t\tdirection.xy *= -1.0; // ( -u, -1, v ) neg y\n\n\t\t\t} else if ( face == 5.0 ) {\n\n\t\t\t\tdirection.z *= -1.0; // ( u, v, -1 ) neg z\n\n\t\t\t}\n\n\t\t\treturn direction;\n\n\t\t}\n\n\t\tvoid main() {\n\n\t\t\tvOutputDirection = getDirection( uv, faceIndex );\n\t\t\tgl_Position = vec4( position, 1.0 );\n\n\t\t}\n\t"}function O(){return"\n\n\t\tuniform int inputEncoding;\n\t\tuniform int outputEncoding;\n\n\t\t#include <encodings_pars_fragment>\n\n\t\tvec4 inputTexelToLinear( vec4 value ) {\n\n\t\t\tif ( inputEncoding == 0 ) {\n\n\t\t\t\treturn value;\n\n\t\t\t} else if ( inputEncoding == 1 ) {\n\n\t\t\t\treturn sRGBToLinear( value );\n\n\t\t\t} else if ( inputEncoding == 2 ) {\n\n\t\t\t\treturn RGBEToLinear( value );\n\n\t\t\t} else if ( inputEncoding == 3 ) {\n\n\t\t\t\treturn RGBMToLinear( value, 7.0 );\n\n\t\t\t} else if ( inputEncoding == 4 ) {\n\n\t\t\t\treturn RGBMToLinear( value, 16.0 );\n\n\t\t\t} else if ( inputEncoding == 5 ) {\n\n\t\t\t\treturn RGBDToLinear( value, 256.0 );\n\n\t\t\t} else {\n\n\t\t\t\treturn GammaToLinear( value, 2.2 );\n\n\t\t\t}\n\n\t\t}\n\n\t\tvec4 linearToOutputTexel( vec4 value ) {\n\n\t\t\tif ( outputEncoding == 0 ) {\n\n\t\t\t\treturn value;\n\n\t\t\t} else if ( outputEncoding == 1 ) {\n\n\t\t\t\treturn LinearTosRGB( value );\n\n\t\t\t} else if ( outputEncoding == 2 ) {\n\n\t\t\t\treturn LinearToRGBE( value );\n\n\t\t\t} else if ( outputEncoding == 3 ) {\n\n\t\t\t\treturn LinearToRGBM( value, 7.0 );\n\n\t\t\t} else if ( outputEncoding == 4 ) {\n\n\t\t\t\treturn LinearToRGBM( value, 16.0 );\n\n\t\t\t} else if ( outputEncoding == 5 ) {\n\n\t\t\t\treturn LinearToRGBD( value, 256.0 );\n\n\t\t\t} else {\n\n\t\t\t\treturn LinearToGamma( value, 2.2 );\n\n\t\t\t}\n\n\t\t}\n\n\t\tvec4 envMapTexelToLinear( vec4 color ) {\n\n\t\t\treturn inputTexelToLinear( color );\n\n\t\t}\n\t"}function F(e){var n=new WeakMap,o=null;function t(t){if(t&&t.isTexture&&!1===t.isRenderTargetTexture){var i=t.mapping,s=i===fi||i===hi,l=i===mi||i===gi;if(s||l){if(n.has(t)){return n.get(t).texture}else{var d=t.image;if(s&&d&&0<d.height||l&&d&&a(d)){var c=e.getRenderTarget();if(null===o)o=new gd(e);var u=s?o.fromEquirectangular(t):o.fromCubemap(t);n.set(t,u);e.setRenderTarget(c);t.addEventListener("dispose",r);return u.texture}else{return null}}}}return t}function a(e){for(var t=0,a=6,r=0;r<a;r++){if(e[r]!==void 0)t++}return t===a}function r(e){var t=e.target;t.removeEventListener("dispose",r);var a=n.get(t);if(a!==void 0){n.delete(t);a.dispose()}}function i(){n=new WeakMap;if(null!==o){o.dispose();o=null}}return{get:t,dispose:i}}function U(e){var a={};function t(t){if(a[t]!==void 0){return a[t]}var r;switch(t){case"WEBGL_depth_texture":r=e.getExtension("WEBGL_depth_texture")||e.getExtension("MOZ_WEBGL_depth_texture")||e.getExtension("WEBKIT_WEBGL_depth_texture");break;case"EXT_texture_filter_anisotropic":r=e.getExtension("EXT_texture_filter_anisotropic")||e.getExtension("MOZ_EXT_texture_filter_anisotropic")||e.getExtension("WEBKIT_EXT_texture_filter_anisotropic");break;case"WEBGL_compressed_texture_s3tc":r=e.getExtension("WEBGL_compressed_texture_s3tc")||e.getExtension("MOZ_WEBGL_compressed_texture_s3tc")||e.getExtension("WEBKIT_WEBGL_compressed_texture_s3tc");break;case"WEBGL_compressed_texture_pvrtc":r=e.getExtension("WEBGL_compressed_texture_pvrtc")||e.getExtension("WEBKIT_WEBGL_compressed_texture_pvrtc");break;default:r=e.getExtension(t);}a[t]=r;return r}return{has:function has(e){return null!==t(e)},init:function init(e){if(e.isWebGL2){t("EXT_color_buffer_float")}else{t("WEBGL_depth_texture");t("OES_texture_float");t("OES_texture_half_float");t("OES_texture_half_float_linear");t("OES_standard_derivatives");t("OES_element_index_uint");t("OES_vertex_array_object");t("ANGLE_instanced_arrays")}t("OES_texture_float_linear");t("EXT_color_buffer_half_float");t("WEBGL_multisampled_render_to_texture")},get:function get(e){var a=t(e);if(null===a){console.warn("THREE.WebGLRenderer: "+e+" extension not supported.")}return a}}}function B(e,t,a,r){var o={},s=new WeakMap;function i(e){var n=e.target;if(null!==n.index){t.remove(n.index)}for(var d in n.attributes){t.remove(n.attributes[d])}n.removeEventListener("dispose",i);delete o[n.id];var l=s.get(n);if(l){t.remove(l);s.delete(n)}r.releaseStatesOfGeometry(n);if(!0===n.isInstancedBufferGeometry){delete n._maxInstanceCount}a.memory.geometries--}function n(e){var r=[],i=e.index,n=e.attributes.position,o=0;if(null!==i){var v=i.array;o=i.version;for(var y=0,_=v.length;y<_;y+=3){var u=v[y+0],a=v[y+1],p=v[y+2];r.push(u,a,a,p,p,u)}}else{var l=n.array;o=n.version;for(var x=0,b=l.length/3-1;x<b;x+=3){var c=x+0,m=x+1,g=x+2;r.push(c,m,m,g,g,c)}}var f=new(65535<d(r)?al:tl)(r,1);f.version=o;var h=s.get(e);if(h)t.remove(h);s.set(e,f)}return{get:function(e,t){if(!0===o[t.id])return t;t.addEventListener("dispose",i);o[t.id]=!0;a.memory.geometries++;return t},update:function(e){var a=e.attributes;for(var s in a){t.update(a[s],34962)}var r=e.morphAttributes;for(var l in r){for(var i=r[l],n=0,o=i.length;n<o;n++){t.update(i[n],34962)}}},getWireframeAttribute:function(e){var t=s.get(e);if(t){var a=e.index;if(null!==a){if(t.version<a.version){n(e)}}}else{n(e)}return s.get(e)}}}function H(e,t,a,r){var o=r.isWebGL2,s;var l,d;function i(t,r){e.drawElements(s,r,l,t*d);a.update(r,s,1)}function n(r,i,n){if(0===n)return;var c,u;if(o){c=e;u="drawElementsInstanced"}else{c=t.get("ANGLE_instanced_arrays");u="drawElementsInstancedANGLE";if(null===c){console.error("THREE.WebGLIndexedBufferRenderer: using THREE.InstancedBufferGeometry but hardware does not support extension ANGLE_instanced_arrays.");return}}c[u](s,i,l,r*d,n);a.update(i,s,n)}this.setMode=function(e){s=e};this.setIndex=function(e){l=e.type;d=e.bytesPerElement};this.render=i;this.renderInstances=n}function G(){var e={frame:0,calls:0,triangles:0,points:0,lines:0};return{memory:{geometries:0,textures:0},render:e,programs:null,autoReset:!0,reset:function(){e.frame++;e.calls=0;e.triangles=0;e.points=0;e.lines=0},update:function(t,a,r){e.calls++;switch(a){case 4:e.triangles+=r*(t/3);break;case 1:e.lines+=r*(t/2);break;case 3:e.lines+=r*(t-1);break;case 2:e.lines+=r*t;break;case 0:e.points+=r*t;break;default:console.error("THREE.WebGLInfo: Unknown draw mode:",a);break;}}}}var fd=function(e){_inherits(t,e);var a=_createSuper(t);function t(){var e,r=0<arguments.length&&arguments[0]!==void 0?arguments[0]:null,i=1<arguments.length&&arguments[1]!==void 0?arguments[1]:1,n=2<arguments.length&&arguments[2]!==void 0?arguments[2]:1,o=3<arguments.length&&arguments[3]!==void 0?arguments[3]:1;_classCallCheck2(this,t);e=a.call(this,null);e.image={data:r,width:i,height:n,depth:o};e.magFilter=Si;e.minFilter=Si;e.wrapR=xi;e.generateMipmaps=!1;e.flipY=!1;e.unpackAlignment=1;e.needsUpdate=!0;return e}return t}(wo);fd.prototype.isDataTexture2DArray=!0;function V(e,t){return e[0]-t[0]}function W(e,t){return Math.abs(t[1])-Math.abs(e[1])}function q(e,t){var a=1,r=t.isInterleavedBufferAttribute?t.data.array:t.array;if(r instanceof Int8Array)a=127;else if(r instanceof Int16Array)a=32767;else if(r instanceof Int32Array)a=2147483647;else console.error("THREE.WebGLMorphtargets: Unsupported morph attribute data type: ",r);e.divideScalar(a)}function X(e,t,a){for(var r={},i=new Float32Array(8),n=new WeakMap,o=new Po,s=[],l=0;8>l;l++){s[l]=[l,0]}return{update:function(l,d,c,u){var p=l.morphTargetInfluences;if(!0===t.isWebGL2){var m=d.morphAttributes.position.length,g=n.get(d);if(g===void 0||g.count!==m){if(g!==void 0)g.texture.dispose();var f=d.morphAttributes.normal!==void 0,h=d.morphAttributes.position,v=d.morphAttributes.normal||[],y=d.attributes.position.count,_=!0===f?2:1,x=y*_,b=1;if(x>t.maxTextureSize){b=Math.ceil(x/t.maxTextureSize);x=t.maxTextureSize}var S=new Float32Array(4*(x*b)*m),M=new fd(S,x,b,m);M.format=Gi;M.type=Ii;for(var T=0;T<m;T++){for(var E=h[T],w=v[T],A=4*(x*b)*T,k=0;k<E.count;k++){o.fromBufferAttribute(E,k);if(!0===E.normalized)q(o,E);var B=k*(4*_);S[A+B+0]=o.x;S[A+B+1]=o.y;S[A+B+2]=o.z;S[A+B+3]=0;if(!0===f){o.fromBufferAttribute(w,k);if(!0===w.normalized)q(o,w);S[A+B+4]=o.x;S[A+B+5]=o.y;S[A+B+6]=o.z;S[A+B+7]=0}}}g={count:m,texture:M,size:new bo(x,b)};n.set(d,g)}for(var C=0,L=0;L<p.length;L++){C+=p[L]}var H=d.morphTargetsRelative?1:1-C;u.getUniforms().setValue(e,"morphTargetBaseInfluence",H);u.getUniforms().setValue(e,"morphTargetInfluences",p);u.getUniforms().setValue(e,"morphTargetsTexture",g.texture,a);u.getUniforms().setValue(e,"morphTargetsTextureSize",g.size)}else{var R=p===void 0?0:p.length,P=r[d.id];if(P===void 0||P.length!==R){P=[];for(var G=0;G<R;G++){P[G]=[G,0]}r[d.id]=P}for(var X=0,Y;X<R;X++){Y=P[X];Y[0]=X;Y[1]=p[X]}P.sort(W);for(var Z=0;8>Z;Z++){if(Z<R&&P[Z][1]){s[Z][0]=P[Z][0];s[Z][1]=P[Z][1]}else{s[Z][0]=Number.MAX_SAFE_INTEGER;s[Z][1]=0}}s.sort(V);for(var D=d.morphAttributes.position,I=d.morphAttributes.normal,z=0,N=0;8>N;N++){var O=s[N],F=O[0],U=O[1];if(F!==Number.MAX_SAFE_INTEGER&&U){if(D&&d.getAttribute("morphTarget"+N)!==D[F]){d.setAttribute("morphTarget"+N,D[F])}if(I&&d.getAttribute("morphNormal"+N)!==I[F]){d.setAttribute("morphNormal"+N,I[F])}i[N]=U;z+=U}else{if(D&&!0===d.hasAttribute("morphTarget"+N)){d.deleteAttribute("morphTarget"+N)}if(I&&!0===d.hasAttribute("morphNormal"+N)){d.deleteAttribute("morphNormal"+N)}i[N]=0}}var J=d.morphTargetsRelative?1:1-z;u.getUniforms().setValue(e,"morphTargetBaseInfluence",J);u.getUniforms().setValue(e,"morphTargetInfluences",i)}}}}function Y(e,t,a,r){var o=new WeakMap;function i(e){var i=r.render.frame,s=e.geometry,l=t.get(e,s);if(o.get(l)!==i){t.update(l);o.set(l,i)}if(e.isInstancedMesh){if(!1===e.hasEventListener("dispose",n)){e.addEventListener("dispose",n)}a.update(e.instanceMatrix,34962);if(null!==e.instanceColor){a.update(e.instanceColor,34962)}}return l}function n(e){var t=e.target;t.removeEventListener("dispose",n);a.remove(t.instanceMatrix);if(null!==t.instanceColor)a.remove(t.instanceColor)}return{update:i,dispose:function(){o=new WeakMap}}}var hd=function(e){_inherits(t,e);var a=_createSuper(t);function t(){var e,r=0<arguments.length&&arguments[0]!==void 0?arguments[0]:null,i=1<arguments.length&&arguments[1]!==void 0?arguments[1]:1,n=2<arguments.length&&arguments[2]!==void 0?arguments[2]:1,o=3<arguments.length&&arguments[3]!==void 0?arguments[3]:1;_classCallCheck2(this,t);e=a.call(this,null);e.image={data:r,width:i,height:n,depth:o};e.magFilter=Si;e.minFilter=Si;e.wrapR=xi;e.generateMipmaps=!1;e.flipY=!1;e.unpackAlignment=1;e.needsUpdate=!0;return e}return t}(wo);hd.prototype.isDataTexture3D=!0;var vd=new wo,yd=new fd,_d=new hd,xd=new Ol,bd=[],Sd=[],Md=new Float32Array(16),Td=new Float32Array(9),Ed=new Float32Array(4);function Z(e,t,a){var i=e[0];if(0>=i||0<i)return e;var o=t*a,n=bd[o];if(n===void 0){n=new Float32Array(o);bd[o]=n}if(0!==t){i.toArray(n,0);for(var s=1,l=0;s!==t;++s){l+=a;e[s].toArray(n,l)}}return n}function J(e,t){if(e.length!==t.length)return!1;for(var a=0,r=e.length;a<r;a++){if(e[a]!==t[a])return!1}return!0}function Q(e,t){for(var a=0,r=t.length;a<r;a++){e[a]=t[a]}}function K(e,t){var a=Sd[t];if(a===void 0){a=new Int32Array(t);Sd[t]=a}for(var i=0;i!==t;++i){a[i]=e.allocateTextureUnit()}return a}function $(e,t){var a=this.cache;if(a[0]===t)return;e.uniform1f(this.addr,t);a[0]=t}function ee(e,t){var a=this.cache;if(t.x!==void 0){if(a[0]!==t.x||a[1]!==t.y){e.uniform2f(this.addr,t.x,t.y);a[0]=t.x;a[1]=t.y}}else{if(J(a,t))return;e.uniform2fv(this.addr,t);Q(a,t)}}function te(e,t){var a=this.cache;if(t.x!==void 0){if(a[0]!==t.x||a[1]!==t.y||a[2]!==t.z){e.uniform3f(this.addr,t.x,t.y,t.z);a[0]=t.x;a[1]=t.y;a[2]=t.z}}else if(t.r!==void 0){if(a[0]!==t.r||a[1]!==t.g||a[2]!==t.b){e.uniform3f(this.addr,t.r,t.g,t.b);a[0]=t.r;a[1]=t.g;a[2]=t.b}}else{if(J(a,t))return;e.uniform3fv(this.addr,t);Q(a,t)}}function ae(e,t){var a=this.cache;if(t.x!==void 0){if(a[0]!==t.x||a[1]!==t.y||a[2]!==t.z||a[3]!==t.w){e.uniform4f(this.addr,t.x,t.y,t.z,t.w);a[0]=t.x;a[1]=t.y;a[2]=t.z;a[3]=t.w}}else{if(J(a,t))return;e.uniform4fv(this.addr,t);Q(a,t)}}function re(e,t){var a=this.cache,r=t.elements;if(r===void 0){if(J(a,t))return;e.uniformMatrix2fv(this.addr,!1,t);Q(a,t)}else{if(J(a,r))return;Ed.set(r);e.uniformMatrix2fv(this.addr,!1,Ed);Q(a,r)}}function ie(e,t){var a=this.cache,r=t.elements;if(r===void 0){if(J(a,t))return;e.uniformMatrix3fv(this.addr,!1,t);Q(a,t)}else{if(J(a,r))return;Td.set(r);e.uniformMatrix3fv(this.addr,!1,Td);Q(a,r)}}function ne(e,t){var a=this.cache,r=t.elements;if(r===void 0){if(J(a,t))return;e.uniformMatrix4fv(this.addr,!1,t);Q(a,t)}else{if(J(a,r))return;Md.set(r);e.uniformMatrix4fv(this.addr,!1,Md);Q(a,r)}}function oe(e,t){var a=this.cache;if(a[0]===t)return;e.uniform1i(this.addr,t);a[0]=t}function se(e,t){var a=this.cache;if(J(a,t))return;e.uniform2iv(this.addr,t);Q(a,t)}function le(e,t){var a=this.cache;if(J(a,t))return;e.uniform3iv(this.addr,t);Q(a,t)}function de(e,t){var a=this.cache;if(J(a,t))return;e.uniform4iv(this.addr,t);Q(a,t)}function ce(e,t){var a=this.cache;if(a[0]===t)return;e.uniform1ui(this.addr,t);a[0]=t}function ue(e,t){var a=this.cache;if(J(a,t))return;e.uniform2uiv(this.addr,t);Q(a,t)}function pe(e,t){var a=this.cache;if(J(a,t))return;e.uniform3uiv(this.addr,t);Q(a,t)}function me(e,t){var a=this.cache;if(J(a,t))return;e.uniform4uiv(this.addr,t);Q(a,t)}function ge(e,t,a){var r=this.cache,i=a.allocateTextureUnit();if(r[0]!==i){e.uniform1i(this.addr,i);r[0]=i}a.safeSetTexture2D(t||vd,i)}function fe(e,t,a){var r=this.cache,i=a.allocateTextureUnit();if(r[0]!==i){e.uniform1i(this.addr,i);r[0]=i}a.setTexture3D(t||_d,i)}function he(e,t,a){var r=this.cache,i=a.allocateTextureUnit();if(r[0]!==i){e.uniform1i(this.addr,i);r[0]=i}a.safeSetTextureCube(t||xd,i)}function ve(e,t,a){var r=this.cache,i=a.allocateTextureUnit();if(r[0]!==i){e.uniform1i(this.addr,i);r[0]=i}a.setTexture2DArray(t||yd,i)}function ye(e){switch(e){case 5126:return $;case 35664:return ee;case 35665:return te;case 35666:return ae;case 35674:return re;case 35675:return ie;case 35676:return ne;case 5124:case 35670:return oe;case 35667:case 35671:return se;case 35668:case 35672:return le;case 35669:case 35673:return de;case 5125:return ce;case 36294:return ue;case 36295:return pe;case 36296:return me;case 35678:case 36198:case 36298:case 36306:case 35682:return ge;case 35679:case 36299:case 36307:return fe;case 35680:case 36300:case 36308:case 36293:return he;case 36289:case 36303:case 36311:case 36292:return ve;}}function _e(e,t){e.uniform1fv(this.addr,t)}function xe(e,t){var a=Z(t,this.size,2);e.uniform2fv(this.addr,a)}function be(e,t){var a=Z(t,this.size,3);e.uniform3fv(this.addr,a)}function Se(e,t){var a=Z(t,this.size,4);e.uniform4fv(this.addr,a)}function Me(e,t){var a=Z(t,this.size,4);e.uniformMatrix2fv(this.addr,!1,a)}function Te(e,t){var a=Z(t,this.size,9);e.uniformMatrix3fv(this.addr,!1,a)}function Ee(e,t){var a=Z(t,this.size,16);e.uniformMatrix4fv(this.addr,!1,a)}function we(e,t){e.uniform1iv(this.addr,t)}function Ae(e,t){e.uniform2iv(this.addr,t)}function ke(e,t){e.uniform3iv(this.addr,t)}function Ce(e,t){e.uniform4iv(this.addr,t)}function Le(e,t){e.uniform1uiv(this.addr,t)}function Re(e,t){e.uniform2uiv(this.addr,t)}function Pe(e,t){e.uniform3uiv(this.addr,t)}function De(e,t){e.uniform4uiv(this.addr,t)}function Ie(e,t,a){var r=t.length,i=K(a,r);e.uniform1iv(this.addr,i);for(var n=0;n!==r;++n){a.safeSetTexture2D(t[n]||vd,i[n])}}function ze(e,t,a){var r=t.length,i=K(a,r);e.uniform1iv(this.addr,i);for(var n=0;n!==r;++n){a.setTexture3D(t[n]||_d,i[n])}}function Ne(e,t,a){var r=t.length,i=K(a,r);e.uniform1iv(this.addr,i);for(var n=0;n!==r;++n){a.safeSetTextureCube(t[n]||xd,i[n])}}function Oe(e,t,a){var r=t.length,i=K(a,r);e.uniform1iv(this.addr,i);for(var n=0;n!==r;++n){a.setTexture2DArray(t[n]||yd,i[n])}}function Fe(e){switch(e){case 5126:return _e;case 35664:return xe;case 35665:return be;case 35666:return Se;case 35674:return Me;case 35675:return Te;case 35676:return Ee;case 5124:case 35670:return we;case 35667:case 35671:return Ae;case 35668:case 35672:return ke;case 35669:case 35673:return Ce;case 5125:return Le;case 36294:return Re;case 36295:return Pe;case 36296:return De;case 35678:case 36198:case 36298:case 36306:case 35682:return Ie;case 35679:case 36299:case 36307:return ze;case 35680:case 36300:case 36308:case 36293:return Ne;case 36289:case 36303:case 36311:case 36292:return Oe;}}function Ue(e,t,a){this.id=e;this.addr=a;this.cache=[];this.setValue=ye(t.type)}function Be(e,t,a){this.id=e;this.addr=a;this.cache=[];this.size=t.size;this.setValue=Fe(t.type)}Be.prototype.updateCache=function(e){var t=this.cache;if(e instanceof Float32Array&&t.length!==e.length){this.cache=new Float32Array(e.length)}Q(t,e)};function He(e){this.id=e;this.seq=[];this.map={}}He.prototype.setValue=function(e,t,a){for(var r=this.seq,i=0,o=r.length,n;i!==o;++i){n=r[i];n.setValue(e,t[n.id],a)}};var wd=/(\w+)(\])?(\[|\.)?/g;function Ge(e,t){e.seq.push(t);e.map[t.id]=t}function Ve(e,t,a){var r=e.name,i=r.length;wd.lastIndex=0;while(!0){var n=wd.exec(r),o=wd.lastIndex,s=n[1],l="]"===n[2],d=n[3];if(l)s=0|s;if(d===void 0||"["===d&&o+2===i){Ge(a,d===void 0?new Ue(s,e,t):new Be(s,e,t));break}else{var c=a.map,u=c[s];if(u===void 0){u=new He(s);Ge(a,u)}a=u}}}function We(e,t){this.seq=[];this.map={};for(var a=e.getProgramParameter(t,35718),r=0;r<a;++r){var i=e.getActiveUniform(t,r),n=e.getUniformLocation(t,i.name);Ve(i,n,this)}}We.prototype.setValue=function(e,t,a,r){var i=this.map[t];if(i!==void 0)i.setValue(e,a,r)};We.prototype.setOptional=function(e,t,a){var r=t[a];if(r!==void 0)this.setValue(e,a,r)};We.upload=function(e,t,a,r){for(var i=0,o=t.length;i!==o;++i){var n=t[i],s=a[n.id];if(!1!==s.needsUpdate){n.setValue(e,s.value,r)}}};We.seqWithValue=function(e,t){for(var a=[],r=0,i=e.length,n;r!==i;++r){n=e[r];if(n.id in t)a.push(n)}return a};function je(e,t,a){var r=e.createShader(t);e.shaderSource(r,a);e.compileShader(r);return r}var Ad=0;function qe(e){for(var t=e.split("\n"),a=0;a<t.length;a++){t[a]=a+1+": "+t[a]}return t.join("\n")}function Xe(e){switch(e){case $n:return["Linear","( value )"];case eo:return["sRGB","( value )"];case ao:return["RGBE","( value )"];case ro:return["RGBM","( value, 7.0 )"];case io:return["RGBM","( value, 16.0 )"];case no:return["RGBD","( value, 256.0 )"];case to:return["Gamma","( value, float( GAMMA_FACTOR ) )"];default:console.warn("THREE.WebGLProgram: Unsupported encoding:",e);return["Linear","( value )"];}}function Ye(e,t,a){var r=e.getShaderParameter(t,35713),i=e.getShaderInfoLog(t).trim();if(r&&""===i)return"";return a.toUpperCase()+"\n\n"+i+"\n\n"+qe(e.getShaderSource(t))}function Ze(e,t){var a=Xe(t);return"vec4 "+e+"( vec4 value ) { return "+a[0]+"ToLinear"+a[1]+"; }"}function Je(e,t){var a=Xe(t);return"vec4 "+e+"( vec4 value ) { return LinearTo"+a[0]+a[1]+"; }"}function Qe(e,t){var a;switch(t){case si:a="Linear";break;case li:a="Reinhard";break;case di:a="OptimizedCineon";break;case ci:a="ACESFilmic";break;case ui:a="Custom";break;default:console.warn("THREE.WebGLProgram: Unsupported toneMapping:",t);a="Linear";}return"vec3 "+e+"( vec3 color ) { return "+a+"ToneMapping( color ); }"}function Ke(e){var t=[e.extensionDerivatives||e.envMapCubeUV||e.bumpMap||e.tangentSpaceNormalMap||e.clearcoatNormalMap||e.flatShading||"physical"===e.shaderID?"#extension GL_OES_standard_derivatives : enable":"",(e.extensionFragDepth||e.logarithmicDepthBuffer)&&e.rendererExtensionFragDepth?"#extension GL_EXT_frag_depth : enable":"",e.extensionDrawBuffers&&e.rendererExtensionDrawBuffers?"#extension GL_EXT_draw_buffers : require":"",(e.extensionShaderTextureLOD||e.envMap||e.transmission)&&e.rendererExtensionShaderTextureLod?"#extension GL_EXT_shader_texture_lod : enable":""];return t.filter(tt).join("\n")}function $e(e){var t=[];for(var a in e){var r=e[a];if(!1===r)continue;t.push("#define "+a+" "+r)}return t.join("\n")}function et(e,t){for(var a={},r=e.getProgramParameter(t,35721),i=0;i<r;i++){var n=e.getActiveAttrib(t,i),o=n.name,s=1;if(35674===n.type)s=2;if(35675===n.type)s=3;if(35676===n.type)s=4;a[o]={type:n.type,location:e.getAttribLocation(t,o),locationSize:s}}return a}function tt(e){return""!==e}function at(e,t){return e.replace(/NUM_DIR_LIGHTS/g,t.numDirLights).replace(/NUM_SPOT_LIGHTS/g,t.numSpotLights).replace(/NUM_RECT_AREA_LIGHTS/g,t.numRectAreaLights).replace(/NUM_POINT_LIGHTS/g,t.numPointLights).replace(/NUM_HEMI_LIGHTS/g,t.numHemiLights).replace(/NUM_DIR_LIGHT_SHADOWS/g,t.numDirLightShadows).replace(/NUM_SPOT_LIGHT_SHADOWS/g,t.numSpotLightShadows).replace(/NUM_POINT_LIGHT_SHADOWS/g,t.numPointLightShadows)}function rt(e,t){return e.replace(/NUM_CLIPPING_PLANES/g,t.numClippingPlanes).replace(/UNION_CLIPPING_PLANES/g,t.numClippingPlanes-t.numClipIntersection)}function it(e){return e.replace(/^[ \t]*#include +<([\w\d./]+)>/gm,nt)}function nt(e,t){var a=Xl[t];if(a===void 0){throw new Error("Can not resolve #include <"+t+">")}return it(a)}function ot(e){return e.replace(/#pragma unroll_loop_start\s+for\s*\(\s*int\s+i\s*=\s*(\d+)\s*;\s*i\s*<\s*(\d+)\s*;\s*i\s*\+\+\s*\)\s*{([\s\S]+?)}\s+#pragma unroll_loop_end/g,lt).replace(/#pragma unroll_loop[\s]+?for \( int i \= (\d+)\; i < (\d+)\; i \+\+ \) \{([\s\S]+?)(?=\})\}/g,st)}function st(e,t,a,r){console.warn("WebGLProgram: #pragma unroll_loop shader syntax is deprecated. Please use #pragma unroll_loop_start syntax instead.");return lt(e,t,a,r)}function lt(e,t,a,r){for(var i="",n=parseInt(t);n<parseInt(a);n++){i+=r.replace(/\[\s*i\s*\]/g,"[ "+n+" ]").replace(/UNROLLED_LOOP_INDEX/g,n)}return i}function dt(e){var t="precision "+e.precision+" float;\nprecision "+e.precision+" int;";if("highp"===e.precision){t+="\n#define HIGH_PRECISION"}else if("mediump"===e.precision){t+="\n#define MEDIUM_PRECISION"}else if("lowp"===e.precision){t+="\n#define LOW_PRECISION"}return t}function ct(e){var t="SHADOWMAP_TYPE_BASIC";if(e.shadowMapType===xr){t="SHADOWMAP_TYPE_PCF"}else if(e.shadowMapType===br){t="SHADOWMAP_TYPE_PCF_SOFT"}else if(e.shadowMapType===Sr){t="SHADOWMAP_TYPE_VSM"}return t}function ut(e){var t="ENVMAP_TYPE_CUBE";if(e.envMap){switch(e.envMapMode){case mi:case gi:t="ENVMAP_TYPE_CUBE";break;case vi:case yi:t="ENVMAP_TYPE_CUBE_UV";break;}}return t}function pt(e){var t="ENVMAP_MODE_REFLECTION";if(e.envMap){switch(e.envMapMode){case gi:case yi:t="ENVMAP_MODE_REFRACTION";break;}}return t}function mt(e){var t="ENVMAP_BLENDING_NONE";if(e.envMap){switch(e.combine){case ri:t="ENVMAP_BLENDING_MULTIPLY";break;case ii:t="ENVMAP_BLENDING_MIX";break;case ni:t="ENVMAP_BLENDING_ADD";break;}}return t}function gt(e,t,a,r){var i=e.getContext(),n=a.defines,o=a.vertexShader,s=a.fragmentShader,l=ct(a),d=ut(a),c=pt(a),u=mt(a),p=0<e.gammaFactor?e.gammaFactor:1,m=a.isWebGL2?"":Ke(a),g=$e(n),f=i.createProgram(),h,v,y=a.glslVersion?"#version "+a.glslVersion+"\n":"";if(a.isRawShaderMaterial){h=[g].filter(tt).join("\n");if(0<h.length){h+="\n"}v=[m,g].filter(tt).join("\n");if(0<v.length){v+="\n"}}else{h=[dt(a),"#define SHADER_NAME "+a.shaderName,g,a.instancing?"#define USE_INSTANCING":"",a.instancingColor?"#define USE_INSTANCING_COLOR":"",a.supportsVertexTextures?"#define VERTEX_TEXTURES":"","#define GAMMA_FACTOR "+p,"#define MAX_BONES "+a.maxBones,a.useFog&&a.fog?"#define USE_FOG":"",a.useFog&&a.fogExp2?"#define FOG_EXP2":"",a.map?"#define USE_MAP":"",a.envMap?"#define USE_ENVMAP":"",a.envMap?"#define "+c:"",a.lightMap?"#define USE_LIGHTMAP":"",a.aoMap?"#define USE_AOMAP":"",a.emissiveMap?"#define USE_EMISSIVEMAP":"",a.bumpMap?"#define USE_BUMPMAP":"",a.normalMap?"#define USE_NORMALMAP":"",a.normalMap&&a.objectSpaceNormalMap?"#define OBJECTSPACE_NORMALMAP":"",a.normalMap&&a.tangentSpaceNormalMap?"#define TANGENTSPACE_NORMALMAP":"",a.clearcoatMap?"#define USE_CLEARCOATMAP":"",a.clearcoatRoughnessMap?"#define USE_CLEARCOAT_ROUGHNESSMAP":"",a.clearcoatNormalMap?"#define USE_CLEARCOAT_NORMALMAP":"",a.displacementMap&&a.supportsVertexTextures?"#define USE_DISPLACEMENTMAP":"",a.specularMap?"#define USE_SPECULARMAP":"",a.specularIntensityMap?"#define USE_SPECULARINTENSITYMAP":"",a.specularColorMap?"#define USE_SPECULARCOLORMAP":"",a.roughnessMap?"#define USE_ROUGHNESSMAP":"",a.metalnessMap?"#define USE_METALNESSMAP":"",a.alphaMap?"#define USE_ALPHAMAP":"",a.transmission?"#define USE_TRANSMISSION":"",a.transmissionMap?"#define USE_TRANSMISSIONMAP":"",a.thicknessMap?"#define USE_THICKNESSMAP":"",a.sheenColorMap?"#define USE_SHEENCOLORMAP":"",a.sheenRoughnessMap?"#define USE_SHEENROUGHNESSMAP":"",a.vertexTangents?"#define USE_TANGENT":"",a.vertexColors?"#define USE_COLOR":"",a.vertexAlphas?"#define USE_COLOR_ALPHA":"",a.vertexUvs?"#define USE_UV":"",a.uvsVertexOnly?"#define UVS_VERTEX_ONLY":"",a.flatShading?"#define FLAT_SHADED":"",a.skinning?"#define USE_SKINNING":"",a.useVertexTexture?"#define BONE_TEXTURE":"",a.morphTargets?"#define USE_MORPHTARGETS":"",a.morphNormals&&!1===a.flatShading?"#define USE_MORPHNORMALS":"",a.morphTargets&&a.isWebGL2?"#define MORPHTARGETS_TEXTURE":"",a.morphTargets&&a.isWebGL2?"#define MORPHTARGETS_COUNT "+a.morphTargetsCount:"",a.doubleSided?"#define DOUBLE_SIDED":"",a.flipSided?"#define FLIP_SIDED":"",a.shadowMapEnabled?"#define USE_SHADOWMAP":"",a.shadowMapEnabled?"#define "+l:"",a.sizeAttenuation?"#define USE_SIZEATTENUATION":"",a.logarithmicDepthBuffer?"#define USE_LOGDEPTHBUF":"",a.logarithmicDepthBuffer&&a.rendererExtensionFragDepth?"#define USE_LOGDEPTHBUF_EXT":"","uniform mat4 modelMatrix;","uniform mat4 modelViewMatrix;","uniform mat4 projectionMatrix;","uniform mat4 viewMatrix;","uniform mat3 normalMatrix;","uniform vec3 cameraPosition;","uniform bool isOrthographic;","#ifdef USE_INSTANCING","\tattribute mat4 instanceMatrix;","#endif","#ifdef USE_INSTANCING_COLOR","\tattribute vec3 instanceColor;","#endif","attribute vec3 position;","attribute vec3 normal;","attribute vec2 uv;","#ifdef USE_TANGENT","\tattribute vec4 tangent;","#endif","#if defined( USE_COLOR_ALPHA )","\tattribute vec4 color;","#elif defined( USE_COLOR )","\tattribute vec3 color;","#endif","#if ( defined( USE_MORPHTARGETS ) && ! defined( MORPHTARGETS_TEXTURE ) )","\tattribute vec3 morphTarget0;","\tattribute vec3 morphTarget1;","\tattribute vec3 morphTarget2;","\tattribute vec3 morphTarget3;","\t#ifdef USE_MORPHNORMALS","\t\tattribute vec3 morphNormal0;","\t\tattribute vec3 morphNormal1;","\t\tattribute vec3 morphNormal2;","\t\tattribute vec3 morphNormal3;","\t#else","\t\tattribute vec3 morphTarget4;","\t\tattribute vec3 morphTarget5;","\t\tattribute vec3 morphTarget6;","\t\tattribute vec3 morphTarget7;","\t#endif","#endif","#ifdef USE_SKINNING","\tattribute vec4 skinIndex;","\tattribute vec4 skinWeight;","#endif","\n"].filter(tt).join("\n");v=[m,dt(a),"#define SHADER_NAME "+a.shaderName,g,"#define GAMMA_FACTOR "+p,a.useFog&&a.fog?"#define USE_FOG":"",a.useFog&&a.fogExp2?"#define FOG_EXP2":"",a.map?"#define USE_MAP":"",a.matcap?"#define USE_MATCAP":"",a.envMap?"#define USE_ENVMAP":"",a.envMap?"#define "+d:"",a.envMap?"#define "+c:"",a.envMap?"#define "+u:"",a.lightMap?"#define USE_LIGHTMAP":"",a.aoMap?"#define USE_AOMAP":"",a.emissiveMap?"#define USE_EMISSIVEMAP":"",a.bumpMap?"#define USE_BUMPMAP":"",a.normalMap?"#define USE_NORMALMAP":"",a.normalMap&&a.objectSpaceNormalMap?"#define OBJECTSPACE_NORMALMAP":"",a.normalMap&&a.tangentSpaceNormalMap?"#define TANGENTSPACE_NORMALMAP":"",a.clearcoat?"#define USE_CLEARCOAT":"",a.clearcoatMap?"#define USE_CLEARCOATMAP":"",a.clearcoatRoughnessMap?"#define USE_CLEARCOAT_ROUGHNESSMAP":"",a.clearcoatNormalMap?"#define USE_CLEARCOAT_NORMALMAP":"",a.specularMap?"#define USE_SPECULARMAP":"",a.specularIntensityMap?"#define USE_SPECULARINTENSITYMAP":"",a.specularColorMap?"#define USE_SPECULARCOLORMAP":"",a.roughnessMap?"#define USE_ROUGHNESSMAP":"",a.metalnessMap?"#define USE_METALNESSMAP":"",a.alphaMap?"#define USE_ALPHAMAP":"",a.alphaTest?"#define USE_ALPHATEST":"",a.sheen?"#define USE_SHEEN":"",a.sheenColorMap?"#define USE_SHEENCOLORMAP":"",a.sheenRoughnessMap?"#define USE_SHEENROUGHNESSMAP":"",a.transmission?"#define USE_TRANSMISSION":"",a.transmissionMap?"#define USE_TRANSMISSIONMAP":"",a.thicknessMap?"#define USE_THICKNESSMAP":"",a.vertexTangents?"#define USE_TANGENT":"",a.vertexColors||a.instancingColor?"#define USE_COLOR":"",a.vertexAlphas?"#define USE_COLOR_ALPHA":"",a.vertexUvs?"#define USE_UV":"",a.uvsVertexOnly?"#define UVS_VERTEX_ONLY":"",a.gradientMap?"#define USE_GRADIENTMAP":"",a.flatShading?"#define FLAT_SHADED":"",a.doubleSided?"#define DOUBLE_SIDED":"",a.flipSided?"#define FLIP_SIDED":"",a.shadowMapEnabled?"#define USE_SHADOWMAP":"",a.shadowMapEnabled?"#define "+l:"",a.premultipliedAlpha?"#define PREMULTIPLIED_ALPHA":"",a.physicallyCorrectLights?"#define PHYSICALLY_CORRECT_LIGHTS":"",a.logarithmicDepthBuffer?"#define USE_LOGDEPTHBUF":"",a.logarithmicDepthBuffer&&a.rendererExtensionFragDepth?"#define USE_LOGDEPTHBUF_EXT":"",(a.extensionShaderTextureLOD||a.envMap)&&a.rendererExtensionShaderTextureLod?"#define TEXTURE_LOD_EXT":"","uniform mat4 viewMatrix;","uniform vec3 cameraPosition;","uniform bool isOrthographic;",a.toneMapping!==oi?"#define TONE_MAPPING":"",a.toneMapping!==oi?Xl.tonemapping_pars_fragment:"",a.toneMapping!==oi?Qe("toneMapping",a.toneMapping):"",a.dithering?"#define DITHERING":"",a.format===Hi?"#define OPAQUE":"",Xl.encodings_pars_fragment,a.map?Ze("mapTexelToLinear",a.mapEncoding):"",a.matcap?Ze("matcapTexelToLinear",a.matcapEncoding):"",a.envMap?Ze("envMapTexelToLinear",a.envMapEncoding):"",a.emissiveMap?Ze("emissiveMapTexelToLinear",a.emissiveMapEncoding):"",a.specularColorMap?Ze("specularColorMapTexelToLinear",a.specularColorMapEncoding):"",a.sheenColorMap?Ze("sheenColorMapTexelToLinear",a.sheenColorMapEncoding):"",a.lightMap?Ze("lightMapTexelToLinear",a.lightMapEncoding):"",Je("linearToOutputTexel",a.outputEncoding),a.depthPacking?"#define DEPTH_PACKING "+a.depthPacking:"","\n"].filter(tt).join("\n")}o=it(o);o=at(o,a);o=rt(o,a);s=it(s);s=at(s,a);s=rt(s,a);o=ot(o);s=ot(s);if(a.isWebGL2&&!0!==a.isRawShaderMaterial){y="#version 300 es\n";h="precision mediump sampler2DArray;\n#define attribute in\n#define varying out\n#define texture2D texture"+"\n"+h;v=["#define varying in",a.glslVersion===fo?"":"out highp vec4 pc_fragColor;",a.glslVersion===fo?"":"#define gl_FragColor pc_fragColor","#define gl_FragDepthEXT gl_FragDepth","#define texture2D texture","#define textureCube texture","#define texture2DProj textureProj","#define texture2DLodEXT textureLod","#define texture2DProjLodEXT textureProjLod","#define textureCubeLodEXT textureLod","#define texture2DGradEXT textureGrad","#define texture2DProjGradEXT textureProjGrad","#define textureCubeGradEXT textureGrad"].join("\n")+"\n"+v}var _=y+h+o,x=y+v+s,b=je(i,35633,_),S=je(i,35632,x);i.attachShader(f,b);i.attachShader(f,S);if(a.index0AttributeName!==void 0){i.bindAttribLocation(f,0,a.index0AttributeName)}else if(!0===a.morphTargets){i.bindAttribLocation(f,0,"position")}i.linkProgram(f);if(e.debug.checkShaderErrors){var M=i.getProgramInfoLog(f).trim(),T=i.getShaderInfoLog(b).trim(),E=i.getShaderInfoLog(S).trim(),w=!0,A=!0;if(!1===i.getProgramParameter(f,35714)){w=!1;var k=Ye(i,b,"vertex"),C=Ye(i,S,"fragment");console.error("THREE.WebGLProgram: Shader Error "+i.getError()+" - VALIDATE_STATUS "+i.getProgramParameter(f,35715)+"\n\nProgram Info Log: "+M+"\n"+k+"\n"+C)}else if(""!==M){console.warn("THREE.WebGLProgram: Program Info Log:",M)}else if(""===T||""===E){A=!1}if(A){this.diagnostics={runnable:w,programLog:M,vertexShader:{log:T,prefix:h},fragmentShader:{log:E,prefix:v}}}}i.deleteShader(b);i.deleteShader(S);var L;this.getUniforms=function(){if(L===void 0){L=new We(i,f)}return L};var R;this.getAttributes=function(){if(R===void 0){R=et(i,f)}return R};this.destroy=function(){r.releaseStatesOfProgram(this);i.deleteProgram(f);this.program=void 0};this.name=a.shaderName;this.id=Ad++;this.cacheKey=t;this.usedTimes=1;this.program=f;this.vertexShader=b;this.fragmentShader=S;return this}function ft(e,t,a,r,i,n,o){var c=[],p=i.isWebGL2,m=i.logarithmicDepthBuffer,g=i.floatVertexTextures,f=i.maxVertexUniforms,h=i.vertexTextures,v=i.precision,y={MeshDepthMaterial:"depth",MeshDistanceMaterial:"distanceRGBA",MeshNormalMaterial:"normal",MeshBasicMaterial:"basic",MeshLambertMaterial:"lambert",MeshPhongMaterial:"phong",MeshToonMaterial:"toon",MeshStandardMaterial:"physical",MeshPhysicalMaterial:"physical",MeshMatcapMaterial:"matcap",LineBasicMaterial:"basic",LineDashedMaterial:"dashed",PointsMaterial:"points",ShadowMaterial:"shadow",SpriteMaterial:"sprite"},_=["precision","isWebGL2","supportsVertexTextures","outputEncoding","instancing","instancingColor","map","mapEncoding","matcap","matcapEncoding","envMap","envMapMode","envMapEncoding","envMapCubeUV","lightMap","lightMapEncoding","aoMap","emissiveMap","emissiveMapEncoding","bumpMap","normalMap","objectSpaceNormalMap","tangentSpaceNormalMap","clearcoat","clearcoatMap","clearcoatRoughnessMap","clearcoatNormalMap","displacementMap","specularMap",,"roughnessMap","metalnessMap","gradientMap","alphaMap","alphaTest","combine","vertexColors","vertexAlphas","vertexTangents","vertexUvs","uvsVertexOnly","fog","useFog","fogExp2","flatShading","sizeAttenuation","logarithmicDepthBuffer","skinning","maxBones","useVertexTexture","morphTargets","morphNormals","morphTargetsCount","premultipliedAlpha","numDirLights","numPointLights","numSpotLights","numHemiLights","numRectAreaLights","numDirLightShadows","numPointLightShadows","numSpotLightShadows","shadowMapEnabled","shadowMapType","toneMapping","physicallyCorrectLights","doubleSided","flipSided","numClippingPlanes","numClipIntersection","depthPacking","dithering","format","specularIntensityMap","specularColorMap","specularColorMapEncoding","transmission","transmissionMap","thicknessMap","sheen","sheenColorMap","sheenColorMapEncoding","sheenRoughnessMap"];function s(e){var t=e.skeleton,a=t.bones;if(g){return 1024}else{var r=Math.floor((f-20)/4),i=Math.min(r,a.length);if(i<a.length){console.warn("THREE.WebGLRenderer: Skeleton has "+a.length+" bones. This GPU supports "+i+".");return 0}return i}}function l(e){var t;if(e&&e.isTexture){t=e.encoding}else if(e&&e.isWebGLRenderTarget){console.warn("THREE.WebGLPrograms.getTextureEncodingFromMap: don't use render targets as textures. Use their .texture property instead.");t=e.texture.encoding}else{t=$n}return t}function d(n,d,c,u,f){var _=u.fog,x=n.isMeshStandardMaterial?u.environment:null,b=(n.isMeshStandardMaterial?a:t).get(n.envMap||x),S=y[n.type],M=f.isSkinnedMesh?s(f):0;if(null!==n.precision){v=i.getMaxPrecision(n.precision);if(v!==n.precision){console.warn("THREE.WebGLProgram.getParameters:",n.precision,"not supported, using",v,"instead.")}}var T,E;if(S){var L=Zl[S];T=L.vertexShader;E=L.fragmentShader}else{T=n.vertexShader;E=n.fragmentShader}var w=e.getRenderTarget(),A=0<n.alphaTest,k=0<n.clearcoat,C={isWebGL2:p,shaderID:S,shaderName:n.type,vertexShader:T,fragmentShader:E,defines:n.defines,isRawShaderMaterial:!0===n.isRawShaderMaterial,glslVersion:n.glslVersion,precision:v,instancing:!0===f.isInstancedMesh,instancingColor:!0===f.isInstancedMesh&&null!==f.instanceColor,supportsVertexTextures:h,outputEncoding:null!==w?l(w.texture):e.outputEncoding,map:!!n.map,mapEncoding:l(n.map),matcap:!!n.matcap,matcapEncoding:l(n.matcap),envMap:!!b,envMapMode:b&&b.mapping,envMapEncoding:l(b),envMapCubeUV:!!b&&(b.mapping===vi||b.mapping===yi),lightMap:!!n.lightMap,lightMapEncoding:l(n.lightMap),aoMap:!!n.aoMap,emissiveMap:!!n.emissiveMap,emissiveMapEncoding:l(n.emissiveMap),bumpMap:!!n.bumpMap,normalMap:!!n.normalMap,objectSpaceNormalMap:n.normalMapType===co,tangentSpaceNormalMap:n.normalMapType===lo,clearcoat:k,clearcoatMap:k&&!!n.clearcoatMap,clearcoatRoughnessMap:k&&!!n.clearcoatRoughnessMap,clearcoatNormalMap:k&&!!n.clearcoatNormalMap,displacementMap:!!n.displacementMap,roughnessMap:!!n.roughnessMap,metalnessMap:!!n.metalnessMap,specularMap:!!n.specularMap,specularIntensityMap:!!n.specularIntensityMap,specularColorMap:!!n.specularColorMap,specularColorMapEncoding:l(n.specularColorMap),alphaMap:!!n.alphaMap,alphaTest:A,gradientMap:!!n.gradientMap,sheen:0<n.sheen,sheenColorMap:!!n.sheenColorMap,sheenColorMapEncoding:l(n.sheenColorMap),sheenRoughnessMap:!!n.sheenRoughnessMap,transmission:0<n.transmission,transmissionMap:!!n.transmissionMap,thicknessMap:!!n.thicknessMap,combine:n.combine,vertexTangents:!!n.normalMap&&!!f.geometry&&!!f.geometry.attributes.tangent,vertexColors:n.vertexColors,vertexAlphas:!0===n.vertexColors&&!!f.geometry&&!!f.geometry.attributes.color&&4===f.geometry.attributes.color.itemSize,vertexUvs:!!n.map||!!n.bumpMap||!!n.normalMap||!!n.specularMap||!!n.alphaMap||!!n.emissiveMap||!!n.roughnessMap||!!n.metalnessMap||!!n.clearcoatMap||!!n.clearcoatRoughnessMap||!!n.clearcoatNormalMap||!!n.displacementMap||!!n.transmissionMap||!!n.thicknessMap||!!n.specularIntensityMap||!!n.specularColorMap||!!n.sheenColorMap||n.sheenRoughnessMap,uvsVertexOnly:!(!!n.map||!!n.bumpMap||!!n.normalMap||!!n.specularMap||!!n.alphaMap||!!n.emissiveMap||!!n.roughnessMap||!!n.metalnessMap||!!n.clearcoatNormalMap||0<n.transmission||!!n.transmissionMap||!!n.thicknessMap||!!n.specularIntensityMap||!!n.specularColorMap||0<n.sheen||!!n.sheenColorMap||!!n.sheenRoughnessMap)&&!!n.displacementMap,fog:!!_,useFog:n.fog,fogExp2:_&&_.isFogExp2,flatShading:!!n.flatShading,sizeAttenuation:n.sizeAttenuation,logarithmicDepthBuffer:m,skinning:!0===f.isSkinnedMesh&&0<M,maxBones:M,useVertexTexture:g,morphTargets:!!f.geometry&&!!f.geometry.morphAttributes.position,morphNormals:!!f.geometry&&!!f.geometry.morphAttributes.normal,morphTargetsCount:!!f.geometry&&!!f.geometry.morphAttributes.position?f.geometry.morphAttributes.position.length:0,numDirLights:d.directional.length,numPointLights:d.point.length,numSpotLights:d.spot.length,numRectAreaLights:d.rectArea.length,numHemiLights:d.hemi.length,numDirLightShadows:d.directionalShadowMap.length,numPointLightShadows:d.pointShadowMap.length,numSpotLightShadows:d.spotShadowMap.length,numClippingPlanes:o.numPlanes,numClipIntersection:o.numIntersection,format:n.format,dithering:n.dithering,shadowMapEnabled:e.shadowMap.enabled&&0<c.length,shadowMapType:e.shadowMap.type,toneMapping:n.toneMapped?e.toneMapping:oi,physicallyCorrectLights:e.physicallyCorrectLights,premultipliedAlpha:n.premultipliedAlpha,doubleSided:n.side===Er,flipSided:n.side===Tr,depthPacking:n.depthPacking!==void 0?n.depthPacking:!1,index0AttributeName:n.index0AttributeName,extensionDerivatives:n.extensions&&n.extensions.derivatives,extensionFragDepth:n.extensions&&n.extensions.fragDepth,extensionDrawBuffers:n.extensions&&n.extensions.drawBuffers,extensionShaderTextureLOD:n.extensions&&n.extensions.shaderTextureLOD,rendererExtensionFragDepth:p||r.has("EXT_frag_depth"),rendererExtensionDrawBuffers:p||r.has("WEBGL_draw_buffers"),rendererExtensionShaderTextureLod:p||r.has("EXT_shader_texture_lod"),customProgramCacheKey:n.customProgramCacheKey()};return C}return{getParameters:d,getProgramCacheKey:function(t){var a=[];if(t.shaderID){a.push(t.shaderID)}else{a.push(u(t.fragmentShader));a.push(u(t.vertexShader))}if(t.defines!==void 0){for(var r in t.defines){a.push(r);a.push(t.defines[r])}}if(!1===t.isRawShaderMaterial){for(var i=0;i<_.length;i++){a.push(t[_[i]])}a.push(e.outputEncoding);a.push(e.gammaFactor)}a.push(t.customProgramCacheKey);return a.join()},getUniforms:function(e){var t=y[e.type],a;if(t){var r=Zl[t];a=Pl.clone(r.uniforms)}else{a=e.uniforms}return a},acquireProgram:function(t,a){for(var r,i=0,o=c.length,s;i<o;i++){s=c[i];if(s.cacheKey===a){r=s;++r.usedTimes;break}}if(r===void 0){r=new gt(e,a,t,n);c.push(r)}return r},releaseProgram:function(e){if(0==--e.usedTimes){var t=c.indexOf(e);c[t]=c[c.length-1];c.pop();e.destroy()}},programs:c}}function ht(){var r=new WeakMap;function e(e){var t=r.get(e);if(t===void 0){t={};r.set(e,t)}return t}function t(e){r.delete(e)}function a(e,t,a){r.get(e)[t]=a}return{get:e,remove:t,update:a,dispose:function(){r=new WeakMap}}}function vt(e,t){if(e.groupOrder!==t.groupOrder){return e.groupOrder-t.groupOrder}else if(e.renderOrder!==t.renderOrder){return e.renderOrder-t.renderOrder}else if(e.program!==t.program){return e.program.id-t.program.id}else if(e.material.id!==t.material.id){return e.material.id-t.material.id}else if(e.z!==t.z){return e.z-t.z}else{return e.id-t.id}}function yt(e,t){if(e.groupOrder!==t.groupOrder){return e.groupOrder-t.groupOrder}else if(e.renderOrder!==t.renderOrder){return e.renderOrder-t.renderOrder}else if(e.z!==t.z){return t.z-e.z}else{return e.id-t.id}}function _t(e){var r=[],i=0,n=[],o=[],s=[],l={id:-1};function t(t,a,n,o,s,d){var c=r[i],u=e.get(n);if(c===void 0){c={id:t.id,object:t,geometry:a,material:n,program:u.program||l,groupOrder:o,renderOrder:t.renderOrder,z:s,group:d};r[i]=c}else{c.id=t.id;c.object=t;c.geometry=a;c.material=n;c.program=u.program||l;c.groupOrder=o;c.renderOrder=t.renderOrder;c.z=s;c.group=d}i++;return c}function a(){for(var e=i,t=r.length,a;e<t;e++){a=r[e];if(null===a.id)break;a.id=null;a.object=null;a.geometry=null;a.material=null;a.program=null;a.group=null}}return{opaque:n,transmissive:o,transparent:s,init:function(){i=0;n.length=0;o.length=0;s.length=0},push:function(e,a,r,i,l,d){var c=t(e,a,r,i,l,d);if(0<r.transmission){o.push(c)}else if(!0===r.transparent){s.push(c)}else{n.push(c)}},unshift:function(e,a,r,i,l,d){var c=t(e,a,r,i,l,d);if(0<r.transmission){o.unshift(c)}else if(!0===r.transparent){s.unshift(c)}else{n.unshift(c)}},finish:a,sort:function(e,t){if(1<n.length)n.sort(e||vt);if(1<o.length)o.sort(t||yt);if(1<s.length)s.sort(t||yt)}}}function xt(e){var a=new WeakMap;function t(t,r){var i;if(!1===a.has(t)){i=new _t(e);a.set(t,[i])}else{if(r>=a.get(t).length){i=new _t(e);a.get(t).push(i)}else{i=a.get(t)[r]}}return i}return{get:t,dispose:function(){a=new WeakMap}}}function bt(){var e={};return{get:function get(t){if(e[t.id]!==void 0){return e[t.id]}var a;switch(t.type){case"DirectionalLight":a={direction:new Po,color:new Js};break;case"SpotLight":a={position:new Po,direction:new Po,color:new Js,distance:0,coneCos:0,penumbraCos:0,decay:0};break;case"PointLight":a={position:new Po,color:new Js,distance:0,decay:0};break;case"HemisphereLight":a={direction:new Po,skyColor:new Js,groundColor:new Js};break;case"RectAreaLight":a={color:new Js,position:new Po,halfWidth:new Po,halfHeight:new Po};break;}e[t.id]=a;return a}}}function St(){var e={};return{get:function get(t){if(e[t.id]!==void 0){return e[t.id]}var a;switch(t.type){case"DirectionalLight":a={shadowBias:0,shadowNormalBias:0,shadowRadius:1,shadowMapSize:new bo};break;case"SpotLight":a={shadowBias:0,shadowNormalBias:0,shadowRadius:1,shadowMapSize:new bo};break;case"PointLight":a={shadowBias:0,shadowNormalBias:0,shadowRadius:1,shadowMapSize:new bo,shadowCameraNear:1,shadowCameraFar:1e3};break;}e[t.id]=a;return a}}}var kd=0;function Mt(e,t){return(t.castShadow?1:0)-(e.castShadow?1:0)}function Tt(e,t){for(var r=new bt,i=St(),n={version:0,hash:{directionalLength:-1,pointLength:-1,spotLength:-1,rectAreaLength:-1,hemiLength:-1,numDirectionalShadows:-1,numPointShadows:-1,numSpotShadows:-1},ambient:[0,0,0],probe:[],directional:[],directionalShadow:[],directionalShadowMap:[],directionalShadowMatrix:[],spot:[],spotShadow:[],spotShadowMap:[],spotShadowMatrix:[],rectArea:[],rectAreaLTC1:null,rectAreaLTC2:null,point:[],pointShadow:[],pointShadowMap:[],pointShadowMatrix:[],hemi:[]},o=0;9>o;o++){n.probe.push(new Po)}var s=new Po,l=new ls,d=new ls;function a(a,o){for(var s=0,d=0,c=0,u=0;9>u;u++){n.probe[u].set(0,0,0)}var p=0,m=0,f=0,h=0,v=0,y=0,_=0,x=0;a.sort(Mt);for(var S=!0!==o?Math.PI:1,M=0,T=a.length;M<T;M++){var l=a[M],E=l.color,w=l.intensity,A=l.distance,k=l.shadow&&l.shadow.map?l.shadow.map.texture:null;if(l.isAmbientLight){s+=E.r*w*S;d+=E.g*w*S;c+=E.b*w*S}else if(l.isLightProbe){for(var N=0;9>N;N++){n.probe[N].addScaledVector(l.sh.coefficients[N],w)}}else if(l.isDirectionalLight){var O=r.get(l);O.color.copy(l.color).multiplyScalar(l.intensity*S);if(l.castShadow){var C=l.shadow,L=i.get(l);L.shadowBias=C.bias;L.shadowNormalBias=C.normalBias;L.shadowRadius=C.radius;L.shadowMapSize=C.mapSize;n.directionalShadow[p]=L;n.directionalShadowMap[p]=k;n.directionalShadowMatrix[p]=l.shadow.matrix;y++}n.directional[p]=O;p++}else if(l.isSpotLight){var F=r.get(l);F.position.setFromMatrixPosition(l.matrixWorld);F.color.copy(E).multiplyScalar(w*S);F.distance=A;F.coneCos=Math.cos(l.angle);F.penumbraCos=Math.cos(l.angle*(1-l.penumbra));F.decay=l.decay;if(l.castShadow){var R=l.shadow,P=i.get(l);P.shadowBias=R.bias;P.shadowNormalBias=R.normalBias;P.shadowRadius=R.radius;P.shadowMapSize=R.mapSize;n.spotShadow[f]=P;n.spotShadowMap[f]=k;n.spotShadowMatrix[f]=l.shadow.matrix;x++}n.spot[f]=F;f++}else if(l.isRectAreaLight){var U=r.get(l);U.color.copy(E).multiplyScalar(w);U.halfWidth.set(.5*l.width,0,0);U.halfHeight.set(0,.5*l.height,0);n.rectArea[h]=U;h++}else if(l.isPointLight){var B=r.get(l);B.color.copy(l.color).multiplyScalar(l.intensity*S);B.distance=l.distance;B.decay=l.decay;if(l.castShadow){var D=l.shadow,I=i.get(l);I.shadowBias=D.bias;I.shadowNormalBias=D.normalBias;I.shadowRadius=D.radius;I.shadowMapSize=D.mapSize;I.shadowCameraNear=D.camera.near;I.shadowCameraFar=D.camera.far;n.pointShadow[m]=I;n.pointShadowMap[m]=k;n.pointShadowMatrix[m]=l.shadow.matrix;_++}n.point[m]=B;m++}else if(l.isHemisphereLight){var H=r.get(l);H.skyColor.copy(l.color).multiplyScalar(w*S);H.groundColor.copy(l.groundColor).multiplyScalar(w*S);n.hemi[v]=H;v++}}if(0<h){if(t.isWebGL2){n.rectAreaLTC1=Yl.LTC_FLOAT_1;n.rectAreaLTC2=Yl.LTC_FLOAT_2}else{if(!0===e.has("OES_texture_float_linear")){n.rectAreaLTC1=Yl.LTC_FLOAT_1;n.rectAreaLTC2=Yl.LTC_FLOAT_2}else if(!0===e.has("OES_texture_half_float_linear")){n.rectAreaLTC1=Yl.LTC_HALF_1;n.rectAreaLTC2=Yl.LTC_HALF_2}else{console.error("THREE.WebGLRenderer: Unable to use RectAreaLight. Missing WebGL extensions.")}}}n.ambient[0]=s;n.ambient[1]=d;n.ambient[2]=c;var z=n.hash;if(z.directionalLength!==p||z.pointLength!==m||z.spotLength!==f||z.rectAreaLength!==h||z.hemiLength!==v||z.numDirectionalShadows!==y||z.numPointShadows!==_||z.numSpotShadows!==x){n.directional.length=p;n.spot.length=f;n.rectArea.length=h;n.point.length=m;n.hemi.length=v;n.directionalShadow.length=y;n.directionalShadowMap.length=y;n.pointShadow.length=_;n.pointShadowMap.length=_;n.spotShadow.length=x;n.spotShadowMap.length=x;n.directionalShadowMatrix.length=y;n.pointShadowMatrix.length=_;n.spotShadowMatrix.length=x;z.directionalLength=p;z.pointLength=m;z.spotLength=f;z.rectAreaLength=h;z.hemiLength=v;z.numDirectionalShadows=y;z.numPointShadows=_;z.numSpotShadows=x;n.version=kd++}}return{setup:a,setupView:function(e,t){for(var a=0,r=0,i=0,o=0,c=0,u=t.matrixWorldInverse,p=0,m=e.length,g;p<m;p++){g=e[p];if(g.isDirectionalLight){var f=n.directional[a];f.direction.setFromMatrixPosition(g.matrixWorld);s.setFromMatrixPosition(g.target.matrixWorld);f.direction.sub(s);f.direction.transformDirection(u);a++}else if(g.isSpotLight){var h=n.spot[i];h.position.setFromMatrixPosition(g.matrixWorld);h.position.applyMatrix4(u);h.direction.setFromMatrixPosition(g.matrixWorld);s.setFromMatrixPosition(g.target.matrixWorld);h.direction.sub(s);h.direction.transformDirection(u);i++}else if(g.isRectAreaLight){var v=n.rectArea[o];v.position.setFromMatrixPosition(g.matrixWorld);v.position.applyMatrix4(u);d.identity();l.copy(g.matrixWorld);l.premultiply(u);d.extractRotation(l);v.halfWidth.set(.5*g.width,0,0);v.halfHeight.set(0,.5*g.height,0);v.halfWidth.applyMatrix4(d);v.halfHeight.applyMatrix4(d);o++}else if(g.isPointLight){var y=n.point[r];y.position.setFromMatrixPosition(g.matrixWorld);y.position.applyMatrix4(u);r++}else if(g.isHemisphereLight){var _=n.hemi[c];_.direction.setFromMatrixPosition(g.matrixWorld);_.direction.transformDirection(u);_.direction.normalize();c++}}},state:n}}function Et(e,t){var a=new Tt(e,t),r=[],i=[];return{init:function(){r.length=0;i.length=0},state:{lightsArray:r,shadowsArray:i,lights:a},setupLights:function(e){a.setup(r,e)},setupLightsView:function(e){a.setupView(r,e)},pushLight:function(e){r.push(e)},pushShadow:function(e){i.push(e)}}}function wt(e,t){var r=new WeakMap;function a(a){var i=1<arguments.length&&arguments[1]!==void 0?arguments[1]:0,n;if(!1===r.has(a)){n=new Et(e,t);r.set(a,[n])}else{if(i>=r.get(a).length){n=new Et(e,t);r.get(a).push(n)}else{n=r.get(a)[i]}}return n}return{get:a,dispose:function(){r=new WeakMap}}}var Cd=function(e){_inherits(t,e);var a=_createSuper(t);function t(e){var r;_classCallCheck2(this,t);r=a.call(this);r.type="MeshDepthMaterial";r.depthPacking=oo;r.map=null;r.alphaMap=null;r.displacementMap=null;r.displacementScale=1;r.displacementBias=0;r.wireframe=!1;r.wireframeLinewidth=1;r.fog=!1;r.setValues(e);return r}_createClass2(t,[{key:"copy",value:function copy(e){_get(_getPrototypeOf(t.prototype),"copy",this).call(this,e);this.depthPacking=e.depthPacking;this.map=e.map;this.alphaMap=e.alphaMap;this.displacementMap=e.displacementMap;this.displacementScale=e.displacementScale;this.displacementBias=e.displacementBias;this.wireframe=e.wireframe;this.wireframeLinewidth=e.wireframeLinewidth;return this}}]);return t}(qs);Cd.prototype.isMeshDepthMaterial=!0;var Ld=function(e){_inherits(t,e);var a=_createSuper(t);function t(e){var r;_classCallCheck2(this,t);r=a.call(this);r.type="MeshDistanceMaterial";r.referencePosition=new Po;r.nearDistance=1;r.farDistance=1e3;r.map=null;r.alphaMap=null;r.displacementMap=null;r.displacementScale=1;r.displacementBias=0;r.fog=!1;r.setValues(e);return r}_createClass2(t,[{key:"copy",value:function copy(e){_get(_getPrototypeOf(t.prototype),"copy",this).call(this,e);this.referencePosition.copy(e.referencePosition);this.nearDistance=e.nearDistance;this.farDistance=e.farDistance;this.map=e.map;this.alphaMap=e.alphaMap;this.displacementMap=e.displacementMap;this.displacementScale=e.displacementScale;this.displacementBias=e.displacementBias;return this}}]);return t}(qs);Ld.prototype.isMeshDistanceMaterial=!0;function At(e,t,a){var o=new jl,s=new bo,l=new bo,d=new Ao,c=new Cd({depthPacking:so}),u=new Ld,p={},m=a.maxTextureSize,g={0:Tr,1:Mr,2:Er},f=new Dl({defines:{VSM_SAMPLES:8},uniforms:{shadow_pass:{value:null},resolution:{value:new bo},radius:{value:4}},vertexShader:"void main() {\n\tgl_Position = vec4( position, 1.0 );\n}",fragmentShader:"uniform sampler2D shadow_pass;\nuniform vec2 resolution;\nuniform float radius;\n#include <packing>\nvoid main() {\n\tconst float samples = float( VSM_SAMPLES );\n\tfloat mean = 0.0;\n\tfloat squared_mean = 0.0;\n\tfloat uvStride = samples <= 1.0 ? 0.0 : 2.0 / ( samples - 1.0 );\n\tfloat uvStart = samples <= 1.0 ? 0.0 : - 1.0;\n\tfor ( float i = 0.0; i < samples; i ++ ) {\n\t\tfloat uvOffset = uvStart + i * uvStride;\n\t\t#ifdef HORIZONTAL_PASS\n\t\t\tvec2 distribution = unpackRGBATo2Half( texture2D( shadow_pass, ( gl_FragCoord.xy + vec2( uvOffset, 0.0 ) * radius ) / resolution ) );\n\t\t\tmean += distribution.x;\n\t\t\tsquared_mean += distribution.y * distribution.y + distribution.x * distribution.x;\n\t\t#else\n\t\t\tfloat depth = unpackRGBAToDepth( texture2D( shadow_pass, ( gl_FragCoord.xy + vec2( 0.0, uvOffset ) * radius ) / resolution ) );\n\t\t\tmean += depth;\n\t\t\tsquared_mean += depth * depth;\n\t\t#endif\n\t}\n\tmean = mean / samples;\n\tsquared_mean = squared_mean / samples;\n\tfloat std_dev = sqrt( squared_mean - mean * mean );\n\tgl_FragColor = pack2HalfToRGBA( vec2( mean, std_dev ) );\n}"}),h=f.clone();h.defines.HORIZONTAL_PASS=1;var v=new pl;v.setAttribute("position",new el(new Float32Array([-1,-1,.5,3,-1,.5,-1,3,.5]),3));var y=new Ll(v,f),_=this;this.enabled=!1;this.autoUpdate=!0;this.needsUpdate=!1;this.type=xr;this.render=function(t,a,i){if(!1===_.enabled)return;if(!1===_.autoUpdate&&!1===_.needsUpdate)return;if(0===t.length)return;var c=e.getRenderTarget(),u=e.getActiveCubeFace(),p=e.getActiveMipmapLevel(),g=e.state;g.setBlending(Ar);g.buffers.color.setClear(1,1,1,1);g.buffers.depth.setTest(!0);g.setScissorTest(!1);for(var b=0,S=t.length;b<S;b++){var f=t[b],h=f.shadow;if(h===void 0){console.warn("THREE.WebGLShadowMap:",f,"has no shadow.");continue}if(!1===h.autoUpdate&&!1===h.needsUpdate)continue;s.copy(h.mapSize);var M=h.getFrameExtents();s.multiply(M);l.copy(h.mapSize);if(s.x>m||s.y>m){if(s.x>m){l.x=Math.floor(m/M.x);s.x=l.x*M.x;h.mapSize.x=l.x}if(s.y>m){l.y=Math.floor(m/M.y);s.y=l.y*M.y;h.mapSize.y=l.y}}if(null===h.map&&!h.isPointLightShadow&&this.type===Sr){var T={minFilter:Ei,magFilter:Ei,format:Gi};h.map=new ko(s.x,s.y,T);h.map.texture.name=f.name+".shadowMap";h.mapPass=new ko(s.x,s.y,T);h.camera.updateProjectionMatrix()}if(null===h.map){h.map=new ko(s.x,s.y,{minFilter:Si,magFilter:Si,format:Gi});h.map.texture.name=f.name+".shadowMap";h.camera.updateProjectionMatrix()}e.setRenderTarget(h.map);e.clear();for(var v=h.getViewportCount(),y=0,x;y<v;y++){x=h.getViewport(y);d.set(l.x*x.x,l.y*x.y,l.x*x.z,l.y*x.w);g.viewport(d);h.updateMatrices(f,y);o=h.getFrustum();n(a,i,h.camera,f,this.type)}if(!h.isPointLightShadow&&this.type===Sr){r(h,i)}h.needsUpdate=!1}_.needsUpdate=!1;e.setRenderTarget(c,u,p)};function r(a,r){var i=t.update(y);if(f.defines.VSM_SAMPLES!==a.blurSamples){f.defines.VSM_SAMPLES=a.blurSamples;h.defines.VSM_SAMPLES=a.blurSamples;f.needsUpdate=!0;h.needsUpdate=!0}f.uniforms.shadow_pass.value=a.map.texture;f.uniforms.resolution.value=a.mapSize;f.uniforms.radius.value=a.radius;e.setRenderTarget(a.mapPass);e.clear();e.renderBufferDirect(r,null,i,f,y,null);h.uniforms.shadow_pass.value=a.mapPass.texture;h.uniforms.resolution.value=a.mapSize;h.uniforms.radius.value=a.radius;e.setRenderTarget(a.map);e.clear();e.renderBufferDirect(r,null,i,h,y,null)}function i(t,a,r,i,n,o,s){var l=null,d=!0===i.isPointLight?t.customDistanceMaterial:t.customDepthMaterial;if(d!==void 0){l=d}else{l=!0===i.isPointLight?u:c}if(e.localClippingEnabled&&!0===r.clipShadows&&0!==r.clippingPlanes.length||r.displacementMap&&0!==r.displacementScale||r.alphaMap&&0<r.alphaTest){var m=l.uuid,f=r.uuid,h=p[m];if(h===void 0){h={};p[m]=h}var v=h[f];if(v===void 0){v=l.clone();h[f]=v}l=v}l.visible=r.visible;l.wireframe=r.wireframe;if(s===Sr){l.side=null!==r.shadowSide?r.shadowSide:r.side}else{l.side=null!==r.shadowSide?r.shadowSide:g[r.side]}l.alphaMap=r.alphaMap;l.alphaTest=r.alphaTest;l.clipShadows=r.clipShadows;l.clippingPlanes=r.clippingPlanes;l.clipIntersection=r.clipIntersection;l.displacementMap=r.displacementMap;l.displacementScale=r.displacementScale;l.displacementBias=r.displacementBias;l.wireframeLinewidth=r.wireframeLinewidth;l.linewidth=r.linewidth;if(!0===i.isPointLight&&!0===l.isMeshDistanceMaterial){l.referencePosition.setFromMatrixPosition(i.matrixWorld);l.nearDistance=n;l.farDistance=o}return l}function n(a,r,s,d,c){if(!1===a.visible)return;var u=a.layers.test(r.layers);if(u&&(a.isMesh||a.isLine||a.isPoints)){if((a.castShadow||a.receiveShadow&&c===Sr)&&(!a.frustumCulled||o.intersectsObject(a))){a.modelViewMatrix.multiplyMatrices(s.matrixWorldInverse,a.matrixWorld);var p=t.update(a),m=a.material;if(Array.isArray(m)){for(var g=p.groups,f=0,h=g.length;f<h;f++){var v=g[f],y=m[v.materialIndex];if(y&&y.visible){var l=i(a,p,y,d,s.near,s.far,c);e.renderBufferDirect(s,null,p,l,a,v)}}}else if(m.visible){var S=i(a,p,m,d,s.near,s.far,c);e.renderBufferDirect(s,null,p,S,a,null)}}}for(var _=a.children,x=0,b=_.length;x<b;x++){n(_[x],r,s,d,c)}}}function kt(e,t,a){var y,_,x=a.isWebGL2;var b=new function(){var t=!1,i=new Ao,n=null,o=new Ao(0,0,0,0);return{setMask:function setMask(a){if(n!==a&&!t){e.colorMask(a,a,a,a);n=a}},setLocked:function setLocked(e){t=e},setClear:function setClear(t,n,s,l,a){if(!0===a){t*=l;n*=l;s*=l}i.set(t,n,s,l);if(!1===o.equals(i)){e.clearColor(t,n,s,l);o.copy(i)}},reset:function reset(){t=!1;n=null;o.set(-1,0,0,0)}}},S=new function(){var t=!1,a=null,r=null,o=null;return{setTest:function setTest(e){if(e){i(2929)}else{n(2929)}},setMask:function setMask(r){if(a!==r&&!t){e.depthMask(r);a=r}},setFunc:function setFunc(t){if(r!==t){if(t){switch(t){case Zr:e.depthFunc(512);break;case Jr:e.depthFunc(519);break;case Qr:e.depthFunc(513);break;case Kr:e.depthFunc(515);break;case $r:e.depthFunc(514);break;case ei:e.depthFunc(518);break;case ti:e.depthFunc(516);break;case ai:e.depthFunc(517);break;default:e.depthFunc(515);}}else{e.depthFunc(515)}r=t}},setLocked:function setLocked(e){t=e},setClear:function setClear(t){if(o!==t){e.clearDepth(t);o=t}},reset:function reset(){t=!1;a=null;r=null;o=null}}},M=new function(){var t=!1,a=null,r=null,o=null,s=null,l=null,d=null,c=null,u=null;return{setTest:function setTest(e){if(!t){if(e){i(2960)}else{n(2960)}}},setMask:function setMask(r){if(a!==r&&!t){e.stencilMask(r);a=r}},setFunc:function setFunc(t,a,i){if(r!==t||o!==a||s!==i){e.stencilFunc(t,a,i);r=t;o=a;s=i}},setOp:function setOp(t,a,r){if(l!==t||d!==a||c!==r){e.stencilOp(t,a,r);l=t;d=a;c=r}},setLocked:function setLocked(e){t=e},setClear:function setClear(t){if(u!==t){e.clearStencil(t);u=t}},reset:function reset(){t=!1;a=null;r=null;o=null;s=null;l=null;d=null;c=null;u=null}}},T={},E={},w=null,A=!1,k=null,C=null,L=null,R=null,P=null,D=null,I=null,z=!1,N=null,O=null,F=null,U=null,B=null,H=e.getParameter(35661),G=!1,V=0,W=e.getParameter(7938);if(-1!==W.indexOf("WebGL")){V=parseFloat(/^WebGL (\d)/.exec(W)[1]);G=1<=V}else if(-1!==W.indexOf("OpenGL ES")){V=parseFloat(/^OpenGL ES (\d)/.exec(W)[1]);G=2<=V}var j=null,q={},X=e.getParameter(3088),Y=e.getParameter(2978),Z=new Ao().fromArray(X),J=new Ao().fromArray(Y);function r(t,a,r){var i=new Uint8Array(4),n=e.createTexture();e.bindTexture(t,n);e.texParameteri(t,10241,9728);e.texParameteri(t,10240,9728);for(var o=0;o<r;o++){e.texImage2D(a+o,0,6408,1,1,0,6408,5121,i)}return n}var Q={3553:r(3553,3553,1),34067:r(34067,34069,6)};b.setClear(0,0,0,1);S.setClear(1);M.setClear(0);i(2929);S.setFunc(Kr);d(!1);c(yr);i(2884);l(Ar);function i(t){if(!0!==T[t]){e.enable(t);T[t]=!0}}function n(t){if(!1!==T[t]){e.disable(t);T[t]=!1}}function o(t,a){if(E[t]!==a){e.bindFramebuffer(t,a);E[t]=a;if(x){if(36009===t){E[36160]=a}if(36160===t){E[36009]=a}}return!0}return!1}function s(t){if(w!==t){e.useProgram(t);w=t;return!0}return!1}var K=(y={},_defineProperty2(y,Dr,32774),_defineProperty2(y,Ir,32778),_defineProperty2(y,zr,32779),y);if(x){K[Nr]=32775;K[Or]=32776}else{var ee=t.get("EXT_blend_minmax");if(null!==ee){K[Nr]=ee.MIN_EXT;K[Or]=ee.MAX_EXT}}var $=(_={},_defineProperty2(_,Fr,0),_defineProperty2(_,Ur,1),_defineProperty2(_,Br,768),_defineProperty2(_,Gr,770),_defineProperty2(_,Yr,776),_defineProperty2(_,qr,774),_defineProperty2(_,Wr,772),_defineProperty2(_,Hr,769),_defineProperty2(_,Vr,771),_defineProperty2(_,Xr,775),_defineProperty2(_,jr,773),_);function l(t,a,r,o,s,l,d,c){if(t===Ar){if(!0===A){n(3042);A=!1}return}if(!1===A){i(3042);A=!0}if(t!==Pr){if(t!==k||c!==z){if(C!==Dr||P!==Dr){e.blendEquation(32774);C=Dr;P=Dr}if(c){switch(t){case kr:e.blendFuncSeparate(1,771,1,771);break;case Cr:e.blendFunc(1,1);break;case Lr:e.blendFuncSeparate(0,0,769,771);break;case Rr:e.blendFuncSeparate(0,768,0,770);break;default:console.error("THREE.WebGLState: Invalid blending: ",t);break;}}else{switch(t){case kr:e.blendFuncSeparate(770,771,1,771);break;case Cr:e.blendFunc(770,1);break;case Lr:e.blendFunc(0,769);break;case Rr:e.blendFunc(0,768);break;default:console.error("THREE.WebGLState: Invalid blending: ",t);break;}}L=null;R=null;D=null;I=null;k=t;z=c}return}s=s||a;l=l||r;d=d||o;if(a!==C||s!==P){e.blendEquationSeparate(K[a],K[s]);C=a;P=s}if(r!==L||o!==R||l!==D||d!==I){e.blendFuncSeparate($[r],$[o],$[l],$[d]);L=r;R=o;D=l;I=d}k=t;z=null}function d(t){if(N!==t){if(t){e.frontFace(2304)}else{e.frontFace(2305)}N=t}}function c(t){if(t!==vr){i(2884);if(t!==O){if(t===yr){e.cullFace(1029)}else if(t===_r){e.cullFace(1028)}else{e.cullFace(1032)}}}else{n(2884)}O=t}function u(t){if(t!==F){if(G)e.lineWidth(t);F=t}}function p(t,a,r){if(t){i(32823);if(U!==a||B!==r){e.polygonOffset(a,r);U=a;B=r}}else{n(32823)}}function m(t){if(t===void 0)t=33984+H-1;if(j!==t){e.activeTexture(t);j=t}}function g(t,a){if(null===j){m()}var r=q[j];if(r===void 0){r={type:void 0,texture:void 0};q[j]=r}if(r.type!==t||r.texture!==a){e.bindTexture(t,a||Q[t]);r.type=t;r.texture=a}}function f(){var t=q[j];if(t!==void 0&&t.type!==void 0){e.bindTexture(t.type,null);t.type=void 0;t.texture=void 0}}function h(t){if(!1===Z.equals(t)){e.scissor(t.x,t.y,t.z,t.w);Z.copy(t)}}function v(t){if(!1===J.equals(t)){e.viewport(t.x,t.y,t.z,t.w);J.copy(t)}}return{buffers:{color:b,depth:S,stencil:M},enable:i,disable:n,bindFramebuffer:o,useProgram:s,setBlending:l,setMaterial:function(e,t){e.side===Er?n(2884):i(2884);var a=e.side===Tr;if(t)a=!a;d(a);e.blending===kr&&!1===e.transparent?l(Ar):l(e.blending,e.blendEquation,e.blendSrc,e.blendDst,e.blendEquationAlpha,e.blendSrcAlpha,e.blendDstAlpha,e.premultipliedAlpha);S.setFunc(e.depthFunc);S.setTest(e.depthTest);S.setMask(e.depthWrite);b.setMask(e.colorWrite);var r=e.stencilWrite;M.setTest(r);if(r){M.setMask(e.stencilWriteMask);M.setFunc(e.stencilFunc,e.stencilRef,e.stencilFuncMask);M.setOp(e.stencilFail,e.stencilZFail,e.stencilZPass)}p(e.polygonOffset,e.polygonOffsetFactor,e.polygonOffsetUnits);!0===e.alphaToCoverage?i(32926):n(32926)},setFlipSided:d,setCullFace:c,setLineWidth:u,setPolygonOffset:p,setScissorTest:function(e){if(e){i(3089)}else{n(3089)}},activeTexture:m,bindTexture:g,unbindTexture:f,compressedTexImage2D:function(){try{e.compressedTexImage2D.apply(e,arguments)}catch(e){console.error("THREE.WebGLState:",e)}},texImage2D:function(){try{e.texImage2D.apply(e,arguments)}catch(e){console.error("THREE.WebGLState:",e)}},texImage3D:function(){try{e.texImage3D.apply(e,arguments)}catch(e){console.error("THREE.WebGLState:",e)}},texStorage2D:function(){try{e.texStorage2D.apply(e,arguments)}catch(e){console.error("THREE.WebGLState:",e)}},texSubImage2D:function(){try{e.texSubImage2D.apply(e,arguments)}catch(e){console.error("THREE.WebGLState:",e)}},scissor:h,viewport:v,reset:function(){e.disable(3042);e.disable(2884);e.disable(2929);e.disable(32823);e.disable(3089);e.disable(2960);e.disable(32926);e.blendEquation(32774);e.blendFunc(1,0);e.blendFuncSeparate(1,0,1,0);e.colorMask(!0,!0,!0,!0);e.clearColor(0,0,0,0);e.depthMask(!0);e.depthFunc(513);e.clearDepth(1);e.stencilMask(4294967295);e.stencilFunc(519,0,4294967295);e.stencilOp(7680,7680,7680);e.clearStencil(0);e.cullFace(1029);e.frontFace(2305);e.polygonOffset(0,0);e.activeTexture(33984);e.bindFramebuffer(36160,null);if(!0===x){e.bindFramebuffer(36009,null);e.bindFramebuffer(36008,null)}e.useProgram(null);e.lineWidth(1);e.scissor(0,0,e.canvas.width,e.canvas.height);e.viewport(0,0,e.canvas.width,e.canvas.height);T={};j=null;q={};E={};w=null;A=!1;k=null;C=null;L=null;R=null;P=null;D=null;I=null;z=!1;N=null;O=null;F=null;U=null;B=null;Z.set(0,0,e.canvas.width,e.canvas.height);J.set(0,0,e.canvas.width,e.canvas.height);b.reset();S.reset();M.reset()}}}function Ct(e,t,a,r,i,n,l){var F,U,B=i.isWebGL2,H=i.maxTextures,G=i.maxCubemapSize,V=i.maxTextureSize,W=i.maxSamples,j=t.has("WEBGL_multisampled_render_to_texture"),q=j?t.get("WEBGL_multisampled_render_to_texture"):void 0,X=new WeakMap,Y,Z=!1;try{Z="undefined"!=typeof OffscreenCanvas&&null!==new OffscreenCanvas(1,1).getContext("2d")}catch(e){}function d(e,t){return Z?new OffscreenCanvas(e,t):c("canvas")}function u(e,t,a,r){var i=1;if(e.width>r||e.height>r){i=r/Math.max(e.width,e.height)}if(1>i||!0===t){if("undefined"!=typeof HTMLImageElement&&e instanceof HTMLImageElement||"undefined"!=typeof HTMLCanvasElement&&e instanceof HTMLCanvasElement||"undefined"!=typeof ImageBitmap&&e instanceof ImageBitmap){var n=t?s:Math.floor,o=n(i*e.width),l=n(i*e.height);if(Y===void 0)Y=d(o,l);var c=a?d(o,l):Y;c.width=o;c.height=l;var u=c.getContext("2d");u.drawImage(e,0,0,o,l);console.warn("THREE.WebGLRenderer: Texture has been resized from ("+e.width+"x"+e.height+") to ("+o+"x"+l+").");return c}else{if("data"in e){console.warn("THREE.WebGLRenderer: Image in DataTexture is too big ("+e.width+"x"+e.height+").")}return e}}return e}function p(e){return o(e.width)&&o(e.height)}function m(e){if(B)return!1;return e.wrapS!==xi||e.wrapT!==xi||e.minFilter!==Si&&e.minFilter!==Ei}function g(e,t){return e.generateMipmaps&&t&&e.minFilter!==Si&&e.minFilter!==Ei}function f(t){e.generateMipmap(t)}function h(a,r,i){if(!1===B)return r;if(null!==a){if(e[a]!==void 0)return e[a];console.warn("THREE.WebGLRenderer: Attempt to use non-existing WebGL internal format '"+a+"'")}var n=r;if(6403===r){if(5126===i)n=33326;if(5131===i)n=33325;if(5121===i)n=33321}if(6407===r){if(5126===i)n=34837;if(5131===i)n=34843;if(5121===i)n=32849}if(6408===r){if(5126===i)n=34836;if(5131===i)n=34842;if(5121===i)n=32856}if(33325===n||33326===n||34842===n||34836===n){t.get("EXT_color_buffer_float")}return n}function v(e,t,a){if(!0===g(e,a)){return Math.log2(Math.max(t.width,t.height))+1}else if(0<e.mipmaps.length){return e.mipmaps.length}else{return 1}}function y(e){if(e===Si||e===Mi||e===Ti){return 9728}return 9729}function _(e){var t=e.target;t.removeEventListener("dispose",_);b(t);if(t.isVideoTexture){X.delete(t)}l.memory.textures--}function x(e){var t=e.target;t.removeEventListener("dispose",x);S(t)}function b(t){var a=r.get(t);if(a.__webglInit===void 0)return;e.deleteTexture(a.__webglTexture);r.remove(t)}function S(t){var a=t.texture,i=r.get(t),n=r.get(a);if(!t)return;if(n.__webglTexture!==void 0){e.deleteTexture(n.__webglTexture);l.memory.textures--}if(t.depthTexture){t.depthTexture.dispose()}if(t.isWebGLCubeRenderTarget){for(var o=0;6>o;o++){e.deleteFramebuffer(i.__webglFramebuffer[o]);if(i.__webglDepthbuffer)e.deleteRenderbuffer(i.__webglDepthbuffer[o])}}else{e.deleteFramebuffer(i.__webglFramebuffer);if(i.__webglDepthbuffer)e.deleteRenderbuffer(i.__webglDepthbuffer);if(i.__webglMultisampledFramebuffer)e.deleteFramebuffer(i.__webglMultisampledFramebuffer);if(i.__webglColorRenderbuffer)e.deleteRenderbuffer(i.__webglColorRenderbuffer);if(i.__webglDepthRenderbuffer)e.deleteRenderbuffer(i.__webglDepthRenderbuffer)}if(t.isWebGLMultipleRenderTargets){for(var s=0,d=a.length,c;s<d;s++){c=r.get(a[s]);if(c.__webglTexture){e.deleteTexture(c.__webglTexture);l.memory.textures--}r.remove(a[s])}}r.remove(a);r.remove(t)}var J=0;function M(){var e=J;if(e>=H){console.warn("THREE.WebGLTextures: Trying to use "+e+" texture units while this GPU supports only "+H)}J+=1;return e}function T(e,t){var i=r.get(e);if(e.isVideoTexture)z(e);if(0<e.version&&i.__version!==e.version){var n=e.image;if(n===void 0){console.warn("THREE.WebGLRenderer: Texture marked for update but image is undefined")}else if(!1===n.complete){console.warn("THREE.WebGLRenderer: Texture marked for update but image is incomplete")}else{k(i,e,t);return}}a.activeTexture(33984+t);a.bindTexture(3553,i.__webglTexture)}function E(e,t){var i=r.get(e);if(0<e.version&&i.__version!==e.version){C(i,e,t);return}a.activeTexture(33984+t);a.bindTexture(34067,i.__webglTexture)}var Q=(F={},_defineProperty2(F,_i,10497),_defineProperty2(F,xi,33071),_defineProperty2(F,bi,33648),F),K=(U={},_defineProperty2(U,Si,9728),_defineProperty2(U,Mi,9984),_defineProperty2(U,Ti,9986),_defineProperty2(U,Ei,9729),_defineProperty2(U,wi,9985),_defineProperty2(U,Ai,9987),U);function w(a,n,o){if(o){e.texParameteri(a,10242,Q[n.wrapS]);e.texParameteri(a,10243,Q[n.wrapT]);if(32879===a||35866===a){e.texParameteri(a,32882,Q[n.wrapR])}e.texParameteri(a,10240,K[n.magFilter]);e.texParameteri(a,10241,K[n.minFilter])}else{e.texParameteri(a,10242,33071);e.texParameteri(a,10243,33071);if(32879===a||35866===a){e.texParameteri(a,32882,33071)}if(n.wrapS!==xi||n.wrapT!==xi){console.warn("THREE.WebGLRenderer: Texture is not power of two. Texture.wrapS and Texture.wrapT should be set to THREE.ClampToEdgeWrapping.")}e.texParameteri(a,10240,y(n.magFilter));e.texParameteri(a,10241,y(n.minFilter));if(n.minFilter!==Si&&n.minFilter!==Ei){console.warn("THREE.WebGLRenderer: Texture is not power of two. Texture.minFilter should be set to THREE.NearestFilter or THREE.LinearFilter.")}}if(!0===t.has("EXT_texture_filter_anisotropic")){var s=t.get("EXT_texture_filter_anisotropic");if(n.type===Ii&&!1===t.has("OES_texture_float_linear"))return;if(!1===B&&n.type===zi&&!1===t.has("OES_texture_half_float_linear"))return;if(1<n.anisotropy||r.get(n).__currentAnisotropy){e.texParameterf(a,s.TEXTURE_MAX_ANISOTROPY_EXT,Math.min(n.anisotropy,i.getMaxAnisotropy()));r.get(n).__currentAnisotropy=n.anisotropy}}}function A(t,a){if(t.__webglInit===void 0){t.__webglInit=!0;a.addEventListener("dispose",_);t.__webglTexture=e.createTexture();l.memory.textures++}}function k(t,r,i){var o=3553;if(r.isDataTexture2DArray)o=35866;if(r.isDataTexture3D)o=32879;A(t,r);a.activeTexture(33984+i);a.bindTexture(o,t.__webglTexture);e.pixelStorei(37440,r.flipY);e.pixelStorei(37441,r.premultiplyAlpha);e.pixelStorei(3317,r.unpackAlignment);e.pixelStorei(37443,0);var s=m(r)&&!1===p(r.image),l=u(r.image,s,!1,V),d=p(l)||B,c=n.convert(r.format),y=n.convert(r.type),_=h(r.internalFormat,c,y,r.encoding);w(o,r,d);var x,b=r.mipmaps;if(r.isDepthTexture){_=6402;if(B){if(r.type===Ii){_=36012}else if(r.type===Di){_=33190}else if(r.type===Ui){_=35056}else{_=33189}}else{if(r.type===Ii){console.error("WebGLRenderer: Floating point depth texture requires WebGL2.")}}if(r.format===qi&&6402===_){if(r.type!==Ri&&r.type!==Di){console.warn("THREE.WebGLRenderer: Use UnsignedShortType or UnsignedIntType for DepthFormat DepthTexture.");r.type=Ri;y=n.convert(r.type)}}if(r.format===Xi&&6402===_){_=34041;if(r.type!==Ui){console.warn("THREE.WebGLRenderer: Use UnsignedInt248Type for DepthStencilFormat DepthTexture.");r.type=Ui;y=n.convert(r.type)}}a.texImage2D(3553,0,_,l.width,l.height,0,c,y,null)}else if(r.isDataTexture){if(0<b.length&&d){for(var E=0,k=b.length;E<k;E++){x=b[E];a.texImage2D(3553,E,_,x.width,x.height,0,c,y,x.data)}r.generateMipmaps=!1}else{a.texImage2D(3553,0,_,l.width,l.height,0,c,y,l.data)}}else if(r.isCompressedTexture){for(var C=0,L=b.length;C<L;C++){x=b[C];if(r.format!==Gi&&r.format!==Hi){if(null!==c){a.compressedTexImage2D(3553,C,_,x.width,x.height,0,x.data)}else{console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .uploadTexture()")}}else{a.texImage2D(3553,C,_,x.width,x.height,0,c,y,x.data)}}}else if(r.isDataTexture2DArray){a.texImage3D(35866,0,_,l.width,l.height,l.depth,0,c,y,l.data)}else if(r.isDataTexture3D){a.texImage3D(32879,0,_,l.width,l.height,l.depth,0,c,y,l.data)}else{var S=v(r,l,d),M=B&&!0!==r.isVideoTexture,T=t.__version===void 0;if(0<b.length&&d){if(M&&T){a.texStorage2D(3553,S,_,b[0].width,b[0].height)}for(var R=0,P=b.length;R<P;R++){x=b[R];if(M){a.texSubImage2D(3553,R,0,0,c,y,x)}else{a.texImage2D(3553,R,_,c,y,x)}}r.generateMipmaps=!1}else{if(M){if(T){a.texStorage2D(3553,S,_,l.width,l.height)}a.texSubImage2D(3553,0,0,0,c,y,l)}else{a.texImage2D(3553,0,_,c,y,l)}}}if(g(r,d)){f(o)}t.__version=r.version;if(r.onUpdate)r.onUpdate(r)}function C(t,r,i){if(6!==r.image.length)return;A(t,r);a.activeTexture(33984+i);a.bindTexture(34067,t.__webglTexture);e.pixelStorei(37440,r.flipY);e.pixelStorei(37441,r.premultiplyAlpha);e.pixelStorei(3317,r.unpackAlignment);e.pixelStorei(37443,0);for(var o=r&&(r.isCompressedTexture||r.image[0].isCompressedTexture),s=r.image[0]&&r.image[0].isDataTexture,l=[],d=0;6>d;d++){if(!o&&!s){l[d]=u(r.image[d],!1,!0,G)}else{l[d]=s?r.image[d].image:r.image[d]}}var c=l[0],m=p(c)||B,v=n.convert(r.format),y=n.convert(r.type),_=h(r.internalFormat,v,y,r.encoding);w(34067,r,m);var x;if(o){for(var M=0;6>M;M++){x=l[M].mipmaps;for(var T=0,E;T<x.length;T++){E=x[T];if(r.format!==Gi&&r.format!==Hi){if(null!==v){a.compressedTexImage2D(34069+M,T,_,E.width,E.height,0,E.data)}else{console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .setTextureCube()")}}else{a.texImage2D(34069+M,T,_,E.width,E.height,0,v,y,E.data)}}}}else{x=r.mipmaps;for(var k=0;6>k;k++){if(s){a.texImage2D(34069+k,0,_,l[k].width,l[k].height,0,v,y,l[k].data);for(var C=0;C<x.length;C++){var b=x[C],S=b.image[k].image;a.texImage2D(34069+k,C+1,_,S.width,S.height,0,v,y,S.data)}}else{a.texImage2D(34069+k,0,_,v,y,l[k]);for(var L=0,R;L<x.length;L++){R=x[L];a.texImage2D(34069+k,L+1,_,v,y,R.image[k])}}}}if(g(r,m)){f(34067)}t.__version=r.version;if(r.onUpdate)r.onUpdate(r)}function L(t,i,o,s,l){var d=n.convert(o.format),c=n.convert(o.type),u=h(o.internalFormat,d,c,o.encoding),p=r.get(i);if(!p.__hasExternalTextures){if(32879===l||35866===l){a.texImage3D(l,0,u,i.width,i.height,i.depth,0,d,c,null)}else{a.texImage2D(l,0,u,i.width,i.height,0,d,c,null)}}a.bindFramebuffer(36160,t);if(i.useRenderToTexture){q.framebufferTexture2DMultisampleEXT(36160,s,l,r.get(o).__webglTexture,0,I(i))}else{e.framebufferTexture2D(36160,s,l,r.get(o).__webglTexture,0)}a.bindFramebuffer(36160,null)}function R(t,a,r){e.bindRenderbuffer(36161,t);if(a.depthBuffer&&!a.stencilBuffer){var c=33189;if(r||a.useRenderToTexture){var u=a.depthTexture;if(u&&u.isDepthTexture){if(u.type===Ii){c=36012}else if(u.type===Di){c=33190}}var p=I(a);if(a.useRenderToTexture){q.renderbufferStorageMultisampleEXT(36161,p,c,a.width,a.height)}else{e.renderbufferStorageMultisample(36161,p,c,a.width,a.height)}}else{e.renderbufferStorage(36161,c,a.width,a.height)}e.framebufferRenderbuffer(36160,36096,36161,t)}else if(a.depthBuffer&&a.stencilBuffer){var m=I(a);if(r&&a.useRenderbuffer){e.renderbufferStorageMultisample(36161,m,35056,a.width,a.height)}else if(a.useRenderToTexture){q.renderbufferStorageMultisampleEXT(36161,m,35056,a.width,a.height)}else{e.renderbufferStorage(36161,34041,a.width,a.height)}e.framebufferRenderbuffer(36160,33306,36161,t)}else{var i=!0===a.isWebGLMultipleRenderTargets?a.texture[0]:a.texture,o=n.convert(i.format),s=n.convert(i.type),l=h(i.internalFormat,o,s,i.encoding),d=I(a);if(r&&a.useRenderbuffer){e.renderbufferStorageMultisample(36161,d,l,a.width,a.height)}else if(a.useRenderToTexture){q.renderbufferStorageMultisampleEXT(36161,d,l,a.width,a.height)}else{e.renderbufferStorage(36161,l,a.width,a.height)}}e.bindRenderbuffer(36161,null)}function P(t,i){var n=i&&i.isWebGLCubeRenderTarget;if(n)throw new Error("Depth Texture with cube render targets is not supported");a.bindFramebuffer(36160,t);if(!(i.depthTexture&&i.depthTexture.isDepthTexture)){throw new Error("renderTarget.depthTexture must be an instance of THREE.DepthTexture")}if(!r.get(i.depthTexture).__webglTexture||i.depthTexture.image.width!==i.width||i.depthTexture.image.height!==i.height){i.depthTexture.image.width=i.width;i.depthTexture.image.height=i.height;i.depthTexture.needsUpdate=!0}T(i.depthTexture,0);var o=r.get(i.depthTexture).__webglTexture,s=I(i);if(i.depthTexture.format===qi){if(i.useRenderToTexture){q.framebufferTexture2DMultisampleEXT(36160,36096,3553,o,0,s)}else{e.framebufferTexture2D(36160,36096,3553,o,0)}}else if(i.depthTexture.format===Xi){if(i.useRenderToTexture){q.framebufferTexture2DMultisampleEXT(36160,33306,3553,o,0,s)}else{e.framebufferTexture2D(36160,33306,3553,o,0)}}else{throw new Error("Unknown depthTexture format")}}function D(t){var i=r.get(t),n=!0===t.isWebGLCubeRenderTarget;if(t.depthTexture&&!i.__autoAllocateDepthBuffer){if(n)throw new Error("target.depthTexture not supported in Cube render targets");P(i.__webglFramebuffer,t)}else{if(n){i.__webglDepthbuffer=[];for(var o=0;6>o;o++){a.bindFramebuffer(36160,i.__webglFramebuffer[o]);i.__webglDepthbuffer[o]=e.createRenderbuffer();R(i.__webglDepthbuffer[o],t,!1)}}else{a.bindFramebuffer(36160,i.__webglFramebuffer);i.__webglDepthbuffer=e.createRenderbuffer();R(i.__webglDepthbuffer,t,!1)}}a.bindFramebuffer(36160,null)}function I(e){return B&&(e.useRenderbuffer||e.useRenderToTexture)?Math.min(W,e.samples):0}function z(e){var t=l.render.frame;if(X.get(e)!==t){X.set(e,t);e.update()}}var $=!1,ee=!1;function N(e,t){if(e&&e.isWebGLRenderTarget){if(!1===$){console.warn("THREE.WebGLTextures.safeSetTexture2D: don't use render targets as textures. Use their .texture property instead.");$=!0}e=e.texture}T(e,t)}function O(e,t){if(e&&e.isWebGLCubeRenderTarget){if(!1===ee){console.warn("THREE.WebGLTextures.safeSetTextureCube: don't use cube render targets as textures. Use their .texture property instead.");ee=!0}e=e.texture}E(e,t)}this.allocateTextureUnit=M;this.resetTextureUnits=function(){J=0};this.setTexture2D=T;this.setTexture2DArray=function(e,t){var i=r.get(e);if(0<e.version&&i.__version!==e.version){k(i,e,t);return}a.activeTexture(33984+t);a.bindTexture(35866,i.__webglTexture)};this.setTexture3D=function(e,t){var i=r.get(e);if(0<e.version&&i.__version!==e.version){k(i,e,t);return}a.activeTexture(33984+t);a.bindTexture(32879,i.__webglTexture)};this.setTextureCube=E;this.rebindTextures=function(e,t,a){var i=r.get(e);if(t!==void 0){L(i.__webglFramebuffer,e,e.texture,36064,3553)}if(a!==void 0){D(e)}};this.setupRenderTarget=function(t){var o=t.texture,s=r.get(t),d=r.get(o);t.addEventListener("dispose",x);if(!0!==t.isWebGLMultipleRenderTargets){if(d.__webglTexture===void 0){d.__webglTexture=e.createTexture()}d.__version=o.version;l.memory.textures++}var c=!0===t.isWebGLCubeRenderTarget,u=!0===t.isWebGLMultipleRenderTargets,m=o.isDataTexture3D||o.isDataTexture2DArray,v=p(t)||B;if(B&&o.format===Hi&&(o.type===Ii||o.type===zi)){o.format=Gi;console.warn("THREE.WebGLRenderer: Rendering to textures with RGB format is not supported. Using RGBA format instead.")}if(c){s.__webglFramebuffer=[];for(var O=0;6>O;O++){s.__webglFramebuffer[O]=e.createFramebuffer()}}else{s.__webglFramebuffer=e.createFramebuffer();if(u){if(i.drawBuffers){for(var y=t.texture,_=0,b=y.length,S;_<b;_++){S=r.get(y[_]);if(S.__webglTexture===void 0){S.__webglTexture=e.createTexture();l.memory.textures++}}}else{console.warn("THREE.WebGLRenderer: WebGLMultipleRenderTargets can only be used with WebGL2 or WEBGL_draw_buffers extension.")}}else if(t.useRenderbuffer){if(B){s.__webglMultisampledFramebuffer=e.createFramebuffer();s.__webglColorRenderbuffer=e.createRenderbuffer();e.bindRenderbuffer(36161,s.__webglColorRenderbuffer);var M=n.convert(o.format),T=n.convert(o.type),E=h(o.internalFormat,M,T,o.encoding),A=I(t);e.renderbufferStorageMultisample(36161,A,E,t.width,t.height);a.bindFramebuffer(36160,s.__webglMultisampledFramebuffer);e.framebufferRenderbuffer(36160,36064,36161,s.__webglColorRenderbuffer);e.bindRenderbuffer(36161,null);if(t.depthBuffer){s.__webglDepthRenderbuffer=e.createRenderbuffer();R(s.__webglDepthRenderbuffer,t,!0)}a.bindFramebuffer(36160,null)}else{console.warn("THREE.WebGLRenderer: WebGLMultisampleRenderTarget can only be used with WebGL2.")}}}if(c){a.bindTexture(34067,d.__webglTexture);w(34067,o,v);for(var F=0;6>F;F++){L(s.__webglFramebuffer[F],t,o,36064,34069+F)}if(g(o,v)){f(34067)}a.unbindTexture()}else if(u){for(var k=t.texture,C=0,P=k.length;C<P;C++){var z=k[C],N=r.get(z);a.bindTexture(3553,N.__webglTexture);w(3553,z,v);L(s.__webglFramebuffer,t,z,36064+C,3553);if(g(z,v)){f(3553)}}a.unbindTexture()}else{var U=3553;if(m){if(B){var H=o.isDataTexture3D;U=H?32879:35866}else{console.warn("THREE.DataTexture3D and THREE.DataTexture2DArray only supported with WebGL2.")}}a.bindTexture(U,d.__webglTexture);w(U,o,v);L(s.__webglFramebuffer,t,o,36064,U);if(g(o,v)){f(U)}a.unbindTexture()}if(t.depthBuffer){D(t)}};this.updateRenderTargetMipmap=function(e){for(var t=p(e)||B,i=!0===e.isWebGLMultipleRenderTargets?e.texture:[e.texture],n=0,o=i.length,s;n<o;n++){s=i[n];if(g(s,t)){var l=e.isWebGLCubeRenderTarget?34067:3553,d=r.get(s).__webglTexture;a.bindTexture(l,d);f(l);a.unbindTexture()}}};this.updateMultisampleRenderTarget=function(t){if(t.useRenderbuffer){if(B){var i=t.width,n=t.height,o=16384,s=[36064],l=t.stencilBuffer?33306:36096;if(t.depthBuffer){s.push(l)}if(!t.ignoreDepthForMultisampleCopy){if(t.depthBuffer)o|=256;if(t.stencilBuffer)o|=1024}var d=r.get(t);a.bindFramebuffer(36008,d.__webglMultisampledFramebuffer);a.bindFramebuffer(36009,d.__webglFramebuffer);if(t.ignoreDepthForMultisampleCopy){e.invalidateFramebuffer(36008,[l]);e.invalidateFramebuffer(36009,[l])}e.blitFramebuffer(0,0,i,n,0,0,i,n,o,9728);e.invalidateFramebuffer(36008,s);a.bindFramebuffer(36008,null);a.bindFramebuffer(36009,d.__webglMultisampledFramebuffer)}else{console.warn("THREE.WebGLRenderer: WebGLMultisampleRenderTarget can only be used with WebGL2.")}}};this.setupDepthRenderbuffer=D;this.setupFrameBufferTexture=L;this.safeSetTexture2D=N;this.safeSetTextureCube=O}function Lt(e,t,a){var r=a.isWebGL2;return{convert:function(e){var a;if(e===ki)return 5121;if(e===Ni)return 32819;if(e===Oi)return 32820;if(e===Fi)return 33635;if(e===Ci)return 5120;if(e===Li)return 5122;if(e===Ri)return 5123;if(e===Pi)return 5124;if(e===Di)return 5125;if(e===Ii)return 5126;if(e===zi){if(r)return 5131;a=t.get("OES_texture_half_float");if(null!==a){return a.HALF_FLOAT_OES}else{return null}}if(e===Bi)return 6406;if(e===Hi)return 6407;if(e===Gi)return 6408;if(e===Vi)return 6409;if(e===Wi)return 6410;if(e===qi)return 6402;if(e===Xi)return 34041;if(e===Yi)return 6403;if(e===Zi)return 36244;if(e===Ji)return 33319;if(e===Qi)return 33320;if(e===Ki)return 36248;if(e===$i)return 36249;if(e===en||e===tn||e===an||e===rn){a=t.get("WEBGL_compressed_texture_s3tc");if(null!==a){if(e===en)return a.COMPRESSED_RGB_S3TC_DXT1_EXT;if(e===tn)return a.COMPRESSED_RGBA_S3TC_DXT1_EXT;if(e===an)return a.COMPRESSED_RGBA_S3TC_DXT3_EXT;if(e===rn)return a.COMPRESSED_RGBA_S3TC_DXT5_EXT}else{return null}}if(e===nn||e===on||e===sn||e===ln){a=t.get("WEBGL_compressed_texture_pvrtc");if(null!==a){if(e===nn)return a.COMPRESSED_RGB_PVRTC_4BPPV1_IMG;if(e===on)return a.COMPRESSED_RGB_PVRTC_2BPPV1_IMG;if(e===sn)return a.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG;if(e===ln)return a.COMPRESSED_RGBA_PVRTC_2BPPV1_IMG}else{return null}}if(e===dn){a=t.get("WEBGL_compressed_texture_etc1");if(null!==a){return a.COMPRESSED_RGB_ETC1_WEBGL}else{return null}}if(e===cn||e===un){a=t.get("WEBGL_compressed_texture_etc");if(null!==a){if(e===cn)return a.COMPRESSED_RGB8_ETC2;if(e===un)return a.COMPRESSED_RGBA8_ETC2_EAC}}if(e===pn||e===mn||e===gn||e===fn||e===hn||e===vn||e===yn||e===_n||e===xn||e===bn||e===Sn||e===Mn||e===Tn||e===En||e===An||e===kn||e===Cn||e===Ln||e===Rn||e===Pn||e===Dn||e===In||e===zn||e===Nn||e===On||e===Fn||e===Un||e===Bn){a=t.get("WEBGL_compressed_texture_astc");if(null!==a){return e}else{return null}}if(e===wn){a=t.get("EXT_texture_compression_bptc");if(null!==a){return e}else{return null}}if(e===Ui){if(r)return 34042;a=t.get("WEBGL_depth_texture");if(null!==a){return a.UNSIGNED_INT_24_8_WEBGL}else{return null}}}}}var Rd=function(e){_inherits(t,e);var a=_createSuper(t);function t(){var e,r=0<arguments.length&&arguments[0]!==void 0?arguments[0]:[];_classCallCheck2(this,t);e=a.call(this);e.cameras=r;return e}return t}(zl);Rd.prototype.isArrayCamera=!0;var Pd=function(e){_inherits(t,e);var a=_createSuper(t);function t(){var e;_classCallCheck2(this,t);e=a.call(this);e.type="Group";return e}return t}(Ds);Pd.prototype.isGroup=!0;var Dd={type:"move"},Id=function(){function e(){_classCallCheck2(this,e);this._targetRay=null;this._grip=null;this._hand=null}_createClass2(e,[{key:"getHandSpace",value:function getHandSpace(){if(null===this._hand){this._hand=new Pd;this._hand.matrixAutoUpdate=!1;this._hand.visible=!1;this._hand.joints={};this._hand.inputState={pinching:!1}}return this._hand}},{key:"getTargetRaySpace",value:function getTargetRaySpace(){if(null===this._targetRay){this._targetRay=new Pd;this._targetRay.matrixAutoUpdate=!1;this._targetRay.visible=!1;this._targetRay.hasLinearVelocity=!1;this._targetRay.linearVelocity=new Po;this._targetRay.hasAngularVelocity=!1;this._targetRay.angularVelocity=new Po}return this._targetRay}},{key:"getGripSpace",value:function getGripSpace(){if(null===this._grip){this._grip=new Pd;this._grip.matrixAutoUpdate=!1;this._grip.visible=!1;this._grip.hasLinearVelocity=!1;this._grip.linearVelocity=new Po;this._grip.hasAngularVelocity=!1;this._grip.angularVelocity=new Po}return this._grip}},{key:"dispatchEvent",value:function dispatchEvent(e){if(null!==this._targetRay){this._targetRay.dispatchEvent(e)}if(null!==this._grip){this._grip.dispatchEvent(e)}if(null!==this._hand){this._hand.dispatchEvent(e)}return this}},{key:"disconnect",value:function disconnect(e){this.dispatchEvent({type:"disconnected",data:e});if(null!==this._targetRay){this._targetRay.visible=!1}if(null!==this._grip){this._grip.visible=!1}if(null!==this._hand){this._hand.visible=!1}return this}},{key:"update",value:function update(e,t,a){var r=null,i=null,n=null,o=this._targetRay,s=this._grip,l=this._hand;if(e&&"visible-blurred"!==t.session.visibilityState){if(null!==o){r=t.getPose(e.targetRaySpace,a);if(null!==r){o.matrix.fromArray(r.transform.matrix);o.matrix.decompose(o.position,o.rotation,o.scale);if(r.linearVelocity){o.hasLinearVelocity=!0;o.linearVelocity.copy(r.linearVelocity)}else{o.hasLinearVelocity=!1}if(r.angularVelocity){o.hasAngularVelocity=!0;o.angularVelocity.copy(r.angularVelocity)}else{o.hasAngularVelocity=!1}this.dispatchEvent(Dd)}}if(l&&e.hand){n=!0;var d=_createForOfIteratorHelper(e.hand.values()),c;try{for(d.s();!(c=d.n()).done;){var u=c.value,p=t.getJointPose(u,a);if(l.joints[u.jointName]===void 0){var y=new Pd;y.matrixAutoUpdate=!1;y.visible=!1;l.joints[u.jointName]=y;l.add(y)}var _=l.joints[u.jointName];if(null!==p){_.matrix.fromArray(p.transform.matrix);_.matrix.decompose(_.position,_.rotation,_.scale);_.jointRadius=p.radius}_.visible=null!==p}}catch(e){d.e(e)}finally{d.f()}var m=l.joints["index-finger-tip"],g=l.joints["thumb-tip"],f=m.position.distanceTo(g.position),h=.02,v=.005;if(l.inputState.pinching&&f>h+v){l.inputState.pinching=!1;this.dispatchEvent({type:"pinchend",handedness:e.handedness,target:this})}else if(!l.inputState.pinching&&f<=h-v){l.inputState.pinching=!0;this.dispatchEvent({type:"pinchstart",handedness:e.handedness,target:this})}}else{if(null!==s&&e.gripSpace){i=t.getPose(e.gripSpace,a);if(null!==i){s.matrix.fromArray(i.transform.matrix);s.matrix.decompose(s.position,s.rotation,s.scale);if(i.linearVelocity){s.hasLinearVelocity=!0;s.linearVelocity.copy(i.linearVelocity)}else{s.hasLinearVelocity=!1}if(i.angularVelocity){s.hasAngularVelocity=!0;s.angularVelocity.copy(i.angularVelocity)}else{s.hasAngularVelocity=!1}}}}}if(null!==o){o.visible=null!==r}if(null!==s){s.visible=null!==i}if(null!==l){l.visible=null!==n}return this}}]);return e}(),zd=function(e){_inherits(t,e);var a=_createSuper(t);function t(e,r,i,n,o,s,l,d,c,u){var p;_classCallCheck2(this,t);u=u!==void 0?u:qi;if(u!==qi&&u!==Xi){throw new Error("DepthTexture format must be either THREE.DepthFormat or THREE.DepthStencilFormat")}if(i===void 0&&u===qi)i=Ri;if(i===void 0&&u===Xi)i=Ui;p=a.call(this,null,n,o,s,l,d,u,i,c);p.image={width:e,height:r};p.magFilter=l!==void 0?l:Si;p.minFilter=d!==void 0?d:Si;p.flipY=!1;p.generateMipmaps=!1;return p}return t}(wo);zd.prototype.isDepthTexture=!0;var Nd=function(e){_inherits(t,e);var a=_createSuper(t);function t(e,r){var u;_classCallCheck2(this,t);u=a.call(this);var p=_assertThisInitialized(u),m=null,g=1,f=null,h="local-floor",v=e.extensions.has("WEBGL_multisampled_render_to_texture"),y=null,_=null,x=null,S=null,M=!1,T=null,E=r.getContextAttributes(),w=null,A=null,k=[],C=new Map,L=new zl;L.layers.enable(1);L.viewport=new Ao;var R=new zl;R.layers.enable(2);R.viewport=new Ao;var P=[L,R],D=new Rd;D.layers.enable(1);D.layers.enable(2);var I=null,z=null;u.cameraAutoUpdate=!0;u.enabled=!1;u.isPresenting=!1;u.getController=function(e){var t=k[e];if(t===void 0){t=new Id;k[e]=t}return t.getTargetRaySpace()};u.getControllerGrip=function(e){var t=k[e];if(t===void 0){t=new Id;k[e]=t}return t.getGripSpace()};u.getHand=function(e){var t=k[e];if(t===void 0){t=new Id;k[e]=t}return t.getHandSpace()};function i(e){var t=C.get(e.inputSource);if(t){t.dispatchEvent({type:e.type,data:e.inputSource})}}function n(){C.forEach(function(e,t){e.disconnect(t)});C.clear();I=null;z=null;e.setRenderTarget(w);S=null;x=null;_=null;m=null;A=null;U.stop();p.isPresenting=!1;p.dispatchEvent({type:"sessionend"})}u.setFramebufferScaleFactor=function(e){g=e;if(!0===p.isPresenting){console.warn("THREE.WebXRManager: Cannot change framebuffer scale while presenting.")}};u.setReferenceSpaceType=function(e){h=e;if(!0===p.isPresenting){console.warn("THREE.WebXRManager: Cannot change reference space type while presenting.")}};u.getReferenceSpace=function(){return f};u.getBaseLayer=function(){return null!==x?x:S};u.getBinding=function(){return _};u.getFrame=function(){return T};u.getSession=function(){return m};u.setSession=function(){var t=_asyncToGenerator(regeneratorRuntime.mark(function t(a){var s,l,d,c,u;return regeneratorRuntime.wrap(function(t){while(1){switch(t.prev=t.next){case 0:m=a;if(!(null!==m)){t.next=23;break}w=e.getRenderTarget();m.addEventListener("select",i);m.addEventListener("selectstart",i);m.addEventListener("selectend",i);m.addEventListener("squeeze",i);m.addEventListener("squeezestart",i);m.addEventListener("squeezeend",i);m.addEventListener("end",n);m.addEventListener("inputsourceschange",o);if(!(!0!==E.xrCompatible)){t.next=14;break}t.next=14;return r.makeXRCompatible();case 14:if(m.renderState.layers===void 0||!1===e.capabilities.isWebGL2){s={antialias:m.renderState.layers===void 0?E.antialias:!0,alpha:E.alpha,depth:E.depth,stencil:E.stencil,framebufferScaleFactor:g};S=new XRWebGLLayer(m,r,s);m.updateRenderState({baseLayer:S});A=new ko(S.framebufferWidth,S.framebufferHeight)}else{M=E.antialias;l=null;d=null;c=null;if(E.depth){c=E.stencil?35056:33189;l=E.stencil?Xi:qi;d=E.stencil?Ui:Ri}u={colorFormat:E.alpha||M?32856:32849,depthFormat:c,scaleFactor:g};_=new XRWebGLBinding(m,r);x=_.createProjectionLayer(u);m.updateRenderState({layers:[x]});if(M){A=new Lo(x.textureWidth,x.textureHeight,{format:Gi,type:ki,depthTexture:new zd(x.textureWidth,x.textureHeight,d,void 0,void 0,void 0,void 0,void 0,void 0,l),stencilBuffer:E.stencil,ignoreDepth:x.ignoreDepthValues,useRenderToTexture:v})}else{A=new ko(x.textureWidth,x.textureHeight,{format:E.alpha?Gi:Hi,type:ki,depthTexture:new zd(x.textureWidth,x.textureHeight,d,void 0,void 0,void 0,void 0,void 0,void 0,l),stencilBuffer:E.stencil,ignoreDepth:x.ignoreDepthValues})}}this.setFoveation(0);t.next=18;return m.requestReferenceSpace(h);case 18:f=t.sent;U.setContext(m);U.start();p.isPresenting=!0;p.dispatchEvent({type:"sessionstart"});case 23:case"end":return t.stop();}}},t,this)}));return function(){return t.apply(this,arguments)}}();function o(e){for(var t=m.inputSources,a=0;a<k.length;a++){C.set(t[a],k[a])}for(var s=0;s<e.removed.length;s++){var r=e.removed[s],i=C.get(r);if(i){i.dispatchEvent({type:"disconnected",data:r});C.delete(r)}}for(var l=0;l<e.added.length;l++){var n=e.added[l],o=C.get(n);if(o){o.dispatchEvent({type:"connected",data:n})}}}var N=new Po,O=new Po;function s(e,t,a){N.setFromMatrixPosition(t.matrixWorld);O.setFromMatrixPosition(a.matrixWorld);var r=N.distanceTo(O),i=t.projectionMatrix.elements,n=a.projectionMatrix.elements,o=i[14]/(i[10]-1),s=i[14]/(i[10]+1),l=(i[9]+1)/i[5],d=(i[9]-1)/i[5],c=(i[8]-1)/i[0],u=(n[8]+1)/n[0],p=r/(-c+u),m=p*-c;t.matrixWorld.decompose(e.position,e.quaternion,e.scale);e.translateX(m);e.translateZ(p);e.matrixWorld.compose(e.position,e.quaternion,e.scale);e.matrixWorldInverse.copy(e.matrixWorld).invert();var g=o+p,f=s+p;e.projectionMatrix.makePerspective(o*c-m,o*u+(r-m),l*s/f*g,d*s/f*g,g,f)}function d(e,t){if(null===t){e.matrixWorld.copy(e.matrix)}else{e.matrixWorld.multiplyMatrices(t.matrixWorld,e.matrix)}e.matrixWorldInverse.copy(e.matrixWorld).invert()}u.updateCamera=function(e){if(null===m)return;D.near=R.near=L.near=e.near;D.far=R.far=L.far=e.far;if(I!==D.near||z!==D.far){m.updateRenderState({depthNear:D.near,depthFar:D.far});I=D.near;z=D.far}var t=e.parent,a=D.cameras;d(D,t);for(var o=0;o<a.length;o++){d(a[o],t)}D.matrixWorld.decompose(D.position,D.quaternion,D.scale);e.position.copy(D.position);e.quaternion.copy(D.quaternion);e.scale.copy(D.scale);e.matrix.copy(D.matrix);e.matrixWorld.copy(D.matrixWorld);for(var r=e.children,i=0,n=r.length;i<n;i++){r[i].updateMatrixWorld(!0)}if(2===a.length){s(D,L,R)}else{D.projectionMatrix.copy(L.projectionMatrix)}};u.getCamera=function(){return D};u.getFoveation=function(){if(null!==x){return x.fixedFoveation}if(null!==S){return S.fixedFoveation}};u.setFoveation=function(e){if(null!==x){x.fixedFoveation=e}if(null!==S&&S.fixedFoveation!==void 0){S.fixedFoveation=e}};var F=null;function c(t,a){y=a.getViewerPose(f);T=a;if(null!==y){var d=y.views;if(null!==S){e.setRenderTargetFramebuffer(A,S.framebuffer);e.setRenderTarget(A)}var c=!1;if(d.length!==D.cameras.length){D.cameras.length=0;c=!0}for(var u=0;u<d.length;u++){var r=d[u],i=null;if(null!==S){i=S.getViewport(r)}else{var p=_.getViewSubImage(x,r);i=p.viewport;if(0===u){e.setRenderTargetTextures(A,p.colorTexture,x.ignoreDepthValues?void 0:p.depthStencilTexture);e.setRenderTarget(A)}}var g=P[u];g.matrix.fromArray(r.transform.matrix);g.projectionMatrix.fromArray(r.projectionMatrix);g.viewport.set(i.x,i.y,i.width,i.height);if(0==u){D.matrix.copy(g.matrix)}if(!0===c){D.cameras.push(g)}}}for(var n=m.inputSources,o=0;o<k.length;o++){var s=k[o],l=n[o];s.update(l,a,f)}if(F)F(t,a);T=null}var U=new b;U.setAnimationLoop(c);u.setAnimationLoop=function(e){F=e};u.dispose=function(){};return u}return t}(ho);function Rt(e){function t(t,a){t.opacity.value=a.opacity;if(a.color){t.diffuse.value.copy(a.color)}if(a.emissive){t.emissive.value.copy(a.emissive).multiplyScalar(a.emissiveIntensity)}if(a.map){t.map.value=a.map}if(a.alphaMap){t.alphaMap.value=a.alphaMap}if(a.specularMap){t.specularMap.value=a.specularMap}if(0<a.alphaTest){t.alphaTest.value=a.alphaTest}var r=e.get(a).envMap;if(r){t.envMap.value=r;t.flipEnvMap.value=r.isCubeTexture&&!1===r.isRenderTargetTexture?-1:1;t.reflectivity.value=a.reflectivity;t.ior.value=a.ior;t.refractionRatio.value=a.refractionRatio}if(a.lightMap){t.lightMap.value=a.lightMap;t.lightMapIntensity.value=a.lightMapIntensity}if(a.aoMap){t.aoMap.value=a.aoMap;t.aoMapIntensity.value=a.aoMapIntensity}var i;if(a.map){i=a.map}else if(a.specularMap){i=a.specularMap}else if(a.displacementMap){i=a.displacementMap}else if(a.normalMap){i=a.normalMap}else if(a.bumpMap){i=a.bumpMap}else if(a.roughnessMap){i=a.roughnessMap}else if(a.metalnessMap){i=a.metalnessMap}else if(a.alphaMap){i=a.alphaMap}else if(a.emissiveMap){i=a.emissiveMap}else if(a.clearcoatMap){i=a.clearcoatMap}else if(a.clearcoatNormalMap){i=a.clearcoatNormalMap}else if(a.clearcoatRoughnessMap){i=a.clearcoatRoughnessMap}else if(a.specularIntensityMap){i=a.specularIntensityMap}else if(a.specularColorMap){i=a.specularColorMap}else if(a.transmissionMap){i=a.transmissionMap}else if(a.thicknessMap){i=a.thicknessMap}else if(a.sheenColorMap){i=a.sheenColorMap}else if(a.sheenRoughnessMap){i=a.sheenRoughnessMap}if(i!==void 0){if(i.isWebGLRenderTarget){i=i.texture}if(!0===i.matrixAutoUpdate){i.updateMatrix()}t.uvTransform.value.copy(i.matrix)}var n;if(a.aoMap){n=a.aoMap}else if(a.lightMap){n=a.lightMap}if(n!==void 0){if(n.isWebGLRenderTarget){n=n.texture}if(!0===n.matrixAutoUpdate){n.updateMatrix()}t.uv2Transform.value.copy(n.matrix)}}function a(e,t){e.diffuse.value.copy(t.color);e.opacity.value=t.opacity}function r(e,t){e.dashSize.value=t.dashSize;e.totalSize.value=t.dashSize+t.gapSize;e.scale.value=t.scale}function i(e,t,a,r){e.diffuse.value.copy(t.color);e.opacity.value=t.opacity;e.size.value=t.size*a;e.scale.value=.5*r;if(t.map){e.map.value=t.map}if(t.alphaMap){e.alphaMap.value=t.alphaMap}if(0<t.alphaTest){e.alphaTest.value=t.alphaTest}var i;if(t.map){i=t.map}else if(t.alphaMap){i=t.alphaMap}if(i!==void 0){if(!0===i.matrixAutoUpdate){i.updateMatrix()}e.uvTransform.value.copy(i.matrix)}}function n(e,t){e.diffuse.value.copy(t.color);e.opacity.value=t.opacity;e.rotation.value=t.rotation;if(t.map){e.map.value=t.map}if(t.alphaMap){e.alphaMap.value=t.alphaMap}if(0<t.alphaTest){e.alphaTest.value=t.alphaTest}var a;if(t.map){a=t.map}else if(t.alphaMap){a=t.alphaMap}if(a!==void 0){if(!0===a.matrixAutoUpdate){a.updateMatrix()}e.uvTransform.value.copy(a.matrix)}}function o(e,t){if(t.emissiveMap){e.emissiveMap.value=t.emissiveMap}}function s(e,t){e.specular.value.copy(t.specular);e.shininess.value=Math.max(t.shininess,1e-4);if(t.emissiveMap){e.emissiveMap.value=t.emissiveMap}if(t.bumpMap){e.bumpMap.value=t.bumpMap;e.bumpScale.value=t.bumpScale;if(t.side===Tr)e.bumpScale.value*=-1}if(t.normalMap){e.normalMap.value=t.normalMap;e.normalScale.value.copy(t.normalScale);if(t.side===Tr)e.normalScale.value.negate()}if(t.displacementMap){e.displacementMap.value=t.displacementMap;e.displacementScale.value=t.displacementScale;e.displacementBias.value=t.displacementBias}}function l(e,t){if(t.gradientMap){e.gradientMap.value=t.gradientMap}if(t.emissiveMap){e.emissiveMap.value=t.emissiveMap}if(t.bumpMap){e.bumpMap.value=t.bumpMap;e.bumpScale.value=t.bumpScale;if(t.side===Tr)e.bumpScale.value*=-1}if(t.normalMap){e.normalMap.value=t.normalMap;e.normalScale.value.copy(t.normalScale);if(t.side===Tr)e.normalScale.value.negate()}if(t.displacementMap){e.displacementMap.value=t.displacementMap;e.displacementScale.value=t.displacementScale;e.displacementBias.value=t.displacementBias}}function d(t,a){t.roughness.value=a.roughness;t.metalness.value=a.metalness;if(a.roughnessMap){t.roughnessMap.value=a.roughnessMap}if(a.metalnessMap){t.metalnessMap.value=a.metalnessMap}if(a.emissiveMap){t.emissiveMap.value=a.emissiveMap}if(a.bumpMap){t.bumpMap.value=a.bumpMap;t.bumpScale.value=a.bumpScale;if(a.side===Tr)t.bumpScale.value*=-1}if(a.normalMap){t.normalMap.value=a.normalMap;t.normalScale.value.copy(a.normalScale);if(a.side===Tr)t.normalScale.value.negate()}if(a.displacementMap){t.displacementMap.value=a.displacementMap;t.displacementScale.value=a.displacementScale;t.displacementBias.value=a.displacementBias}var r=e.get(a).envMap;if(r){t.envMapIntensity.value=a.envMapIntensity}}function c(e,t,a){d(e,t);e.ior.value=t.ior;if(0<t.sheen){e.sheenColor.value.copy(t.sheenColor).multiplyScalar(t.sheen);e.sheenRoughness.value=t.sheenRoughness;if(t.sheenColorMap){e.sheenColorMap.value=t.sheenColorMap}if(t.sheenRoughnessMap){e.sheenRoughnessMap.value=t.sheenRoughnessMap}}if(0<t.clearcoat){e.clearcoat.value=t.clearcoat;e.clearcoatRoughness.value=t.clearcoatRoughness;if(t.clearcoatMap){e.clearcoatMap.value=t.clearcoatMap}if(t.clearcoatRoughnessMap){e.clearcoatRoughnessMap.value=t.clearcoatRoughnessMap}if(t.clearcoatNormalMap){e.clearcoatNormalScale.value.copy(t.clearcoatNormalScale);e.clearcoatNormalMap.value=t.clearcoatNormalMap;if(t.side===Tr){e.clearcoatNormalScale.value.negate()}}}if(0<t.transmission){e.transmission.value=t.transmission;e.transmissionSamplerMap.value=a.texture;e.transmissionSamplerSize.value.set(a.width,a.height);if(t.transmissionMap){e.transmissionMap.value=t.transmissionMap}e.thickness.value=t.thickness;if(t.thicknessMap){e.thicknessMap.value=t.thicknessMap}e.attenuationDistance.value=t.attenuationDistance;e.attenuationColor.value.copy(t.attenuationColor)}e.specularIntensity.value=t.specularIntensity;e.specularColor.value.copy(t.specularColor);if(t.specularIntensityMap){e.specularIntensityMap.value=t.specularIntensityMap}if(t.specularColorMap){e.specularColorMap.value=t.specularColorMap}}function u(e,t){if(t.matcap){e.matcap.value=t.matcap}if(t.bumpMap){e.bumpMap.value=t.bumpMap;e.bumpScale.value=t.bumpScale;if(t.side===Tr)e.bumpScale.value*=-1}if(t.normalMap){e.normalMap.value=t.normalMap;e.normalScale.value.copy(t.normalScale);if(t.side===Tr)e.normalScale.value.negate()}if(t.displacementMap){e.displacementMap.value=t.displacementMap;e.displacementScale.value=t.displacementScale;e.displacementBias.value=t.displacementBias}}function p(e,t){if(t.displacementMap){e.displacementMap.value=t.displacementMap;e.displacementScale.value=t.displacementScale;e.displacementBias.value=t.displacementBias}}function m(e,t){if(t.displacementMap){e.displacementMap.value=t.displacementMap;e.displacementScale.value=t.displacementScale;e.displacementBias.value=t.displacementBias}e.referencePosition.value.copy(t.referencePosition);e.nearDistance.value=t.nearDistance;e.farDistance.value=t.farDistance}function g(e,t){if(t.bumpMap){e.bumpMap.value=t.bumpMap;e.bumpScale.value=t.bumpScale;if(t.side===Tr)e.bumpScale.value*=-1}if(t.normalMap){e.normalMap.value=t.normalMap;e.normalScale.value.copy(t.normalScale);if(t.side===Tr)e.normalScale.value.negate()}if(t.displacementMap){e.displacementMap.value=t.displacementMap;e.displacementScale.value=t.displacementScale;e.displacementBias.value=t.displacementBias}}return{refreshFogUniforms:function(e,t){e.fogColor.value.copy(t.color);if(t.isFog){e.fogNear.value=t.near;e.fogFar.value=t.far}else if(t.isFogExp2){e.fogDensity.value=t.density}},refreshMaterialUniforms:function(e,f,h,v,y){if(f.isMeshBasicMaterial){t(e,f)}else if(f.isMeshLambertMaterial){t(e,f);o(e,f)}else if(f.isMeshToonMaterial){t(e,f);l(e,f)}else if(f.isMeshPhongMaterial){t(e,f);s(e,f)}else if(f.isMeshStandardMaterial){t(e,f);if(f.isMeshPhysicalMaterial){c(e,f,y)}else{d(e,f)}}else if(f.isMeshMatcapMaterial){t(e,f);u(e,f)}else if(f.isMeshDepthMaterial){t(e,f);p(e,f)}else if(f.isMeshDistanceMaterial){t(e,f);m(e,f)}else if(f.isMeshNormalMaterial){t(e,f);g(e,f)}else if(f.isLineBasicMaterial){a(e,f);if(f.isLineDashedMaterial){r(e,f)}}else if(f.isPointsMaterial){i(e,f,h,v)}else if(f.isSpriteMaterial){n(e,f)}else if(f.isShadowMaterial){e.color.value.copy(f.color);e.opacity.value=f.opacity}else if(f.isShaderMaterial){f.uniformsNeedUpdate=!1}}}}function Pt(){var e=c("canvas");e.style.display="block";return e}function Dt(){var w=0<arguments.length&&arguments[0]!==void 0?arguments[0]:{},L=w.canvas!==void 0?w.canvas:Pt(),R=w.context!==void 0?w.context:null,P=w.alpha!==void 0?w.alpha:!1,D=w.depth!==void 0?w.depth:!0,I=w.stencil!==void 0?w.stencil:!0,z=w.antialias!==void 0?w.antialias:!1,N=w.premultipliedAlpha!==void 0?w.premultipliedAlpha:!0,O=w.preserveDrawingBuffer!==void 0?w.preserveDrawingBuffer:!1,V=w.powerPreference!==void 0?w.powerPreference:"default",W=w.failIfMajorPerformanceCaveat!==void 0?w.failIfMajorPerformanceCaveat:!1,j=null,q=null,Z=[],J=[];this.domElement=L;this.debug={checkShaderErrors:!0};this.autoClear=!0;this.autoClearColor=!0;this.autoClearDepth=!0;this.autoClearStencil=!0;this.sortObjects=!0;this.clippingPlanes=[];this.localClippingEnabled=!1;this.gammaFactor=2;this.outputEncoding=$n;this.physicallyCorrectLights=!1;this.toneMapping=oi;this.toneMappingExposure=1;var Q=this,K=!1,$=0,ee=0,te=null,ae=-1,re=null,ie=new Ao,ne=new Ao,oe=null,se=L.width,le=L.height,de=1,ce=null,ue=null,pe=new Ao(0,0,se,le),me=new Ao(0,0,se,le),ge=!1,fe=[],he=new jl,ve=!1,ye=!1,_e=null,xe=new ls,be=new Po,Se={background:null,fog:null,environment:null,overrideMaterial:null,isScene:!0};function e(){return null===te?de:1}var Me=R;function t(e,t){for(var i=0;i<e.length;i++){var a=e[i],r=L.getContext(a,t);if(null!==r)return r}return null}try{if("setAttribute"in L)L.setAttribute("data-engine","three.js r".concat(hr));L.addEventListener("webglcontextlost",r,!1);L.addEventListener("webglcontextrestored",i,!1);if(null===Me){var Qe=["webgl2","webgl","experimental-webgl"];if(!0===Q.isWebGL1Renderer){Qe.shift()}Me=t(Qe,{alpha:P,depth:D,stencil:I,antialias:z,premultipliedAlpha:N,preserveDrawingBuffer:O,powerPreference:V,failIfMajorPerformanceCaveat:W});if(null===Me){if(t(Qe)){throw new Error("Error creating WebGL context with your selected attributes.")}else{throw new Error("Error creating WebGL context.")}}}if(Me.getShaderPrecisionFormat===void 0){Me.getShaderPrecisionFormat=function(){return{rangeMin:1,rangeMax:1,precision:1}}}}catch(e){console.error("THREE.WebGLRenderer: "+e.message);throw e}var Te,Ee,we,Ae,ke,Ce,Le,Re,Pe,De,Ie,ze,Ne,Oe,Fe,Ue,Be,He,Ge,Ve,je,qe,Xe;function a(){Te=new U(Me);Ee=new A(Me,Te,w);Te.init(Ee);qe=new Lt(Me,Te,Ee);we=new kt(Me,Te,Ee);fe[0]=1029;Ae=new G(Me);ke=new ht;Ce=new Ct(Me,Te,we,ke,Ee,qe,Ae);Le=new C(Q);Re=new F(Q);Pe=new S(Me,Ee);Xe=new T(Me,Te,Pe,Ee);De=new B(Me,Pe,Ae,Xe);Ie=new Y(Me,De,Pe,Ae);Ge=new X(Me,Ee,Ce);Ue=new k(ke);ze=new ft(Q,Le,Re,Te,Ee,Xe,Ue);Ne=new Rt(ke);Oe=new xt(ke);Fe=new wt(Te,Ee);He=new M(Q,Le,we,Ie,N);Be=new At(Q,Ie,Ee);Ve=new E(Me,Te,Ae,Ee);je=new H(Me,Te,Ae,Ee);Ae.programs=ze.programs;Q.capabilities=Ee;Q.extensions=Te;Q.properties=ke;Q.renderLists=Oe;Q.shadowMap=Be;Q.state=we;Q.info=Ae}a();var Ye=new Nd(Q,Me);this.xr=Ye;this.getContext=function(){return Me};this.getContextAttributes=function(){return Me.getContextAttributes()};this.forceContextLoss=function(){var e=Te.get("WEBGL_lose_context");if(e)e.loseContext()};this.forceContextRestore=function(){var e=Te.get("WEBGL_lose_context");if(e)e.restoreContext()};this.getPixelRatio=function(){return de};this.setPixelRatio=function(e){if(e===void 0)return;de=e;this.setSize(se,le,!1)};this.getSize=function(e){return e.set(se,le)};this.setSize=function(e,t,a){if(Ye.isPresenting){console.warn("THREE.WebGLRenderer: Can't change size while VR device is presenting.");return}se=e;le=t;L.width=Math.floor(e*de);L.height=Math.floor(t*de);if(!1!==a){L.style.width=e+"px";L.style.height=t+"px"}this.setViewport(0,0,e,t)};this.getDrawingBufferSize=function(e){return e.set(se*de,le*de).floor()};this.setDrawingBufferSize=function(e,t,a){se=e;le=t;de=a;L.width=Math.floor(e*a);L.height=Math.floor(t*a);this.setViewport(0,0,e,t)};this.getCurrentViewport=function(e){return e.copy(ie)};this.getViewport=function(e){return e.copy(pe)};this.setViewport=function(e,t,a,r){if(e.isVector4){pe.set(e.x,e.y,e.z,e.w)}else{pe.set(e,t,a,r)}we.viewport(ie.copy(pe).multiplyScalar(de).floor())};this.getScissor=function(e){return e.copy(me)};this.setScissor=function(e,t,a,r){if(e.isVector4){me.set(e.x,e.y,e.z,e.w)}else{me.set(e,t,a,r)}we.scissor(ne.copy(me).multiplyScalar(de).floor())};this.getScissorTest=function(){return ge};this.setScissorTest=function(e){we.setScissorTest(ge=e)};this.setOpaqueSort=function(e){ce=e};this.setTransparentSort=function(e){ue=e};this.getClearColor=function(e){return e.copy(He.getClearColor())};this.setClearColor=function(){He.setClearColor.apply(He,arguments)};this.getClearAlpha=function(){return He.getClearAlpha()};this.setClearAlpha=function(){He.setClearAlpha.apply(He,arguments)};this.clear=function(e,t,a){var r=0;if(e===void 0||e)r|=16384;if(t===void 0||t)r|=256;if(a===void 0||a)r|=1024;Me.clear(r)};this.clearColor=function(){this.clear(!0,!1,!1)};this.clearDepth=function(){this.clear(!1,!0,!1)};this.clearStencil=function(){this.clear(!1,!1,!0)};this.dispose=function(){L.removeEventListener("webglcontextlost",r,!1);L.removeEventListener("webglcontextrestored",i,!1);Oe.dispose();Fe.dispose();ke.dispose();Le.dispose();Re.dispose();Ie.dispose();Xe.dispose();Ye.dispose();Ye.removeEventListener("sessionstart",d);Ye.removeEventListener("sessionend",c);if(_e){_e.dispose();_e=null}Je.stop()};function r(e){e.preventDefault();console.log("THREE.WebGLRenderer: Context Lost.");K=!0}function i(){console.log("THREE.WebGLRenderer: Context Restored.");K=!1;var e=Ae.autoReset,t=Be.enabled,r=Be.autoUpdate,i=Be.needsUpdate,n=Be.type;a();Ae.autoReset=e;Be.enabled=t;Be.autoUpdate=r;Be.needsUpdate=i;Be.type=n}function n(e){var t=e.target;t.removeEventListener("dispose",n);o(t)}function o(e){s(e);ke.remove(e)}function s(e){var t=ke.get(e).programs;if(t!==void 0){t.forEach(function(e){ze.releaseProgram(e)})}}this.renderBufferDirect=function(t,a,r,i,n,o){if(null===a)a=Se;var s=n.isMesh&&0>n.matrixWorld.determinant(),l=y(t,a,r,i,n);we.setMaterial(i,s);var d=r.index,c=r.attributes.position;if(null===d){if(c===void 0||0===c.count)return}else if(0===d.count){return}var u=1;if(!0===i.wireframe){d=De.getWireframeAttribute(r);u=2}Xe.setup(n,i,l,r,d);var p,m=Ve;if(null!==d){p=Pe.get(d);m=je;m.setIndex(p)}var g=null!==d?d.count:c.count,f=r.drawRange.start*u,h=r.drawRange.count*u,v=null!==o?o.start*u:0,_=null!==o?o.count*u:1/0,x=Math.max(f,v),b=Math.min(g,f+h,v+_)-1,S=Math.max(0,b-x+1);if(0===S)return;if(n.isMesh){if(!0===i.wireframe){we.setLineWidth(i.wireframeLinewidth*e());m.setMode(1)}else{m.setMode(4)}}else if(n.isLine){var M=i.linewidth;if(M===void 0)M=1;we.setLineWidth(M*e());if(n.isLineSegments){m.setMode(1)}else if(n.isLineLoop){m.setMode(2)}else{m.setMode(3)}}else if(n.isPoints){m.setMode(0)}else if(n.isSprite){m.setMode(4)}if(n.isInstancedMesh){m.renderInstances(x,S,n.count)}else if(r.isInstancedBufferGeometry){var T=Math.min(r.instanceCount,r._maxInstanceCount);m.renderInstances(x,S,T)}else{m.render(x,S)}};this.compile=function(e,t){q=Fe.get(e);q.init();J.push(q);e.traverseVisible(function(e){if(e.isLight&&e.layers.test(t.layers)){q.pushLight(e);if(e.castShadow){q.pushShadow(e)}}});q.setupLights(Q.physicallyCorrectLights);e.traverse(function(t){var a=t.material;if(a){if(Array.isArray(a)){for(var r=0,i;r<a.length;r++){i=a[r];h(i,e,t)}}else{h(a,e,t)}}});J.pop();q=null};var Ze=null;function l(e){if(Ze)Ze(e)}function d(){Je.stop()}function c(){Je.start()}var Je=new b;Je.setAnimationLoop(l);if("undefined"!=typeof window)Je.setContext(window);this.setAnimationLoop=function(e){Ze=e;Ye.setAnimationLoop(e);null===e?Je.stop():Je.start()};Ye.addEventListener("sessionstart",d);Ye.addEventListener("sessionend",c);this.render=function(e,t){if(t!==void 0&&!0!==t.isCamera){console.error("THREE.WebGLRenderer.render: camera is not an instance of THREE.Camera.");return}if(!0===K)return;if(!0===e.autoUpdate)e.updateMatrixWorld();if(null===t.parent)t.updateMatrixWorld();if(!0===Ye.enabled&&!0===Ye.isPresenting){if(!0===Ye.cameraAutoUpdate)Ye.updateCamera(t);t=Ye.getCamera()}if(!0===e.isScene)e.onBeforeRender(Q,e,t,te);q=Fe.get(e,J.length);q.init();J.push(q);xe.multiplyMatrices(t.projectionMatrix,t.matrixWorldInverse);he.setFromProjectionMatrix(xe);ye=this.localClippingEnabled;ve=Ue.init(this.clippingPlanes,ye,t);j=Oe.get(e,Z.length);j.init();Z.push(j);u(e,t,0,Q.sortObjects);j.finish();if(!0===Q.sortObjects){j.sort(ce,ue)}if(!0===ve)Ue.beginShadows();var a=q.state.shadowsArray;Be.render(a,e,t);if(!0===ve)Ue.endShadows();if(!0===this.info.autoReset)this.info.reset();He.render(j,e);q.setupLights(Q.physicallyCorrectLights);if(t.isArrayCamera){for(var r=t.cameras,i=0,n=r.length,o;i<n;i++){o=r[i];p(j,e,o,o.viewport)}}else{p(j,e,t)}if(null!==te){Ce.updateMultisampleRenderTarget(te);Ce.updateRenderTargetMipmap(te)}if(!0===e.isScene)e.onAfterRender(Q,e,t);we.buffers.depth.setTest(!0);we.buffers.depth.setMask(!0);we.buffers.color.setMask(!0);we.setPolygonOffset(!1);Xe.resetDefaultState();ae=-1;re=null;J.pop();if(0<J.length){q=J[J.length-1]}else{q=null}Z.pop();if(0<Z.length){j=Z[Z.length-1]}else{j=null}};function u(e,t,a,r){if(!1===e.visible)return;var i=e.layers.test(t.layers);if(i){if(e.isGroup){a=e.renderOrder}else if(e.isLOD){if(!0===e.autoUpdate)e.update(t)}else if(e.isLight){q.pushLight(e);if(e.castShadow){q.pushShadow(e)}}else if(e.isSprite){if(!e.frustumCulled||he.intersectsSprite(e)){if(r){be.setFromMatrixPosition(e.matrixWorld).applyMatrix4(xe)}var n=Ie.update(e),o=e.material;if(o.visible){j.push(e,n,o,a,be.z,null)}}}else if(e.isMesh||e.isLine||e.isPoints){if(e.isSkinnedMesh){if(e.skeleton.frame!==Ae.render.frame){e.skeleton.update();e.skeleton.frame=Ae.render.frame}}if(!e.frustumCulled||he.intersectsObject(e)){if(r){be.setFromMatrixPosition(e.matrixWorld).applyMatrix4(xe)}var s=Ie.update(e),d=e.material;if(Array.isArray(d)){for(var c=s.groups,p=0,m=c.length;p<m;p++){var l=c[p],g=d[l.materialIndex];if(g&&g.visible){j.push(e,s,g,a,be.z,l)}}}else if(d.visible){j.push(e,s,d,a,be.z,null)}}}}for(var f=e.children,h=0,v=f.length;h<v;h++){u(f[h],t,a,r)}}function p(e,t,a,r){var i=e.opaque,n=e.transmissive,o=e.transparent;q.setupLightsView(a);if(0<n.length)m(i,t,a);if(r)we.viewport(ie.copy(r));if(0<i.length)g(i,t,a);if(0<n.length)g(n,t,a);if(0<o.length)g(o,t,a)}function m(e,t,a){if(null===_e){var r=!0===z&&!0===Ee.isWebGL2,i=r?Lo:ko;_e=new i(1024,1024,{generateMipmaps:!0,type:null!==qe.convert(zi)?zi:ki,minFilter:Ai,magFilter:Si,wrapS:xi,wrapT:xi,useRenderToTexture:Te.has("WEBGL_multisampled_render_to_texture")})}var n=Q.getRenderTarget();Q.setRenderTarget(_e);Q.clear();var o=Q.toneMapping;Q.toneMapping=oi;g(e,t,a);Q.toneMapping=o;Ce.updateMultisampleRenderTarget(_e);Ce.updateRenderTargetMipmap(_e);Q.setRenderTarget(n)}function g(e,t,a){for(var r=!0===t.isScene?t.overrideMaterial:null,i=0,n=e.length;i<n;i++){var o=e[i],s=o.object,l=o.geometry,d=null===r?o.material:r,c=o.group;if(s.layers.test(a.layers)){f(s,t,a,l,d,c)}}}function f(e,t,a,r,i,n){e.onBeforeRender(Q,t,a,r,i,n);e.modelViewMatrix.multiplyMatrices(a.matrixWorldInverse,e.matrixWorld);e.normalMatrix.getNormalMatrix(e.modelViewMatrix);i.onBeforeRender(Q,t,a,r,e,n);if(!0===i.transparent&&i.side===Er){i.side=Tr;i.needsUpdate=!0;Q.renderBufferDirect(a,t,r,i,e,n);i.side=Mr;i.needsUpdate=!0;Q.renderBufferDirect(a,t,r,i,e,n);i.side=Er}else{Q.renderBufferDirect(a,t,r,i,e,n)}e.onAfterRender(Q,t,a,r,i,n)}function h(e,t,a){if(!0!==t.isScene)t=Se;var r=ke.get(e),i=q.state.lights,o=q.state.shadowsArray,s=i.state.version,l=ze.getParameters(e,i.state,o,t,a),d=ze.getProgramCacheKey(l),c=r.programs;r.environment=e.isMeshStandardMaterial?t.environment:null;r.fog=t.fog;r.envMap=(e.isMeshStandardMaterial?Re:Le).get(e.envMap||r.environment);if(c===void 0){e.addEventListener("dispose",n);c=new Map;r.programs=c}var u=c.get(d);if(u!==void 0){if(r.currentProgram===u&&r.lightsStateVersion===s){v(e,l);return u}}else{l.uniforms=ze.getUniforms(e);e.onBuild(a,l,Q);e.onBeforeCompile(l,Q);u=ze.acquireProgram(l,d);c.set(d,u);r.uniforms=l.uniforms}var p=r.uniforms;if(!e.isShaderMaterial&&!e.isRawShaderMaterial||!0===e.clipping){p.clippingPlanes=Ue.uniform}v(e,l);r.needsLights=x(e);r.lightsStateVersion=s;if(r.needsLights){p.ambientLightColor.value=i.state.ambient;p.lightProbe.value=i.state.probe;p.directionalLights.value=i.state.directional;p.directionalLightShadows.value=i.state.directionalShadow;p.spotLights.value=i.state.spot;p.spotLightShadows.value=i.state.spotShadow;p.rectAreaLights.value=i.state.rectArea;p.ltc_1.value=i.state.rectAreaLTC1;p.ltc_2.value=i.state.rectAreaLTC2;p.pointLights.value=i.state.point;p.pointLightShadows.value=i.state.pointShadow;p.hemisphereLights.value=i.state.hemi;p.directionalShadowMap.value=i.state.directionalShadowMap;p.directionalShadowMatrix.value=i.state.directionalShadowMatrix;p.spotShadowMap.value=i.state.spotShadowMap;p.spotShadowMatrix.value=i.state.spotShadowMatrix;p.pointShadowMap.value=i.state.pointShadowMap;p.pointShadowMatrix.value=i.state.pointShadowMatrix}var m=u.getUniforms(),g=We.seqWithValue(m.seq,p);r.currentProgram=u;r.uniformsList=g;return u}function v(e,t){var a=ke.get(e);a.outputEncoding=t.outputEncoding;a.instancing=t.instancing;a.skinning=t.skinning;a.morphTargets=t.morphTargets;a.morphNormals=t.morphNormals;a.morphTargetsCount=t.morphTargetsCount;a.numClippingPlanes=t.numClippingPlanes;a.numIntersection=t.numClipIntersection;a.vertexAlphas=t.vertexAlphas;a.vertexTangents=t.vertexTangents}function y(e,t,a,r,i){if(!0!==t.isScene)t=Se;Ce.resetTextureUnits();var n=t.fog,o=r.isMeshStandardMaterial?t.environment:null,s=null===te?Q.outputEncoding:te.texture.encoding,l=(r.isMeshStandardMaterial?Re:Le).get(r.envMap||o),d=!0===r.vertexColors&&!!a.attributes.color&&4===a.attributes.color.itemSize,c=!!r.normalMap&&!!a.attributes.tangent,u=!!a.morphAttributes.position,p=!!a.morphAttributes.normal,m=!!a.morphAttributes.position?a.morphAttributes.position.length:0,g=ke.get(r),f=q.state.lights;if(!0===ve){if(!0===ye||e!==re){var E=e===re&&r.id===ae;Ue.setState(r,e,E)}}var v=!1;if(r.version===g.__version){if(g.needsLights&&g.lightsStateVersion!==f.state.version){v=!0}else if(g.outputEncoding!==s){v=!0}else if(i.isInstancedMesh&&!1===g.instancing){v=!0}else if(!i.isInstancedMesh&&!0===g.instancing){v=!0}else if(i.isSkinnedMesh&&!1===g.skinning){v=!0}else if(!i.isSkinnedMesh&&!0===g.skinning){v=!0}else if(g.envMap!==l){v=!0}else if(r.fog&&g.fog!==n){v=!0}else if(g.numClippingPlanes!==void 0&&(g.numClippingPlanes!==Ue.numPlanes||g.numIntersection!==Ue.numIntersection)){v=!0}else if(g.vertexAlphas!==d){v=!0}else if(g.vertexTangents!==c){v=!0}else if(g.morphTargets!==u){v=!0}else if(g.morphNormals!==p){v=!0}else if(!0===Ee.isWebGL2&&g.morphTargetsCount!==m){v=!0}}else{v=!0;g.__version=r.version}var y=g.currentProgram;if(!0==v){y=h(r,t,i)}var x=!1,b=!1,S=!1,M=y.getUniforms(),T=g.uniforms;if(we.useProgram(y.program)){x=!0;b=!0;S=!0}if(r.id!==ae){ae=r.id;b=!0}if(x||re!==e){M.setValue(Me,"projectionMatrix",e.projectionMatrix);if(Ee.logarithmicDepthBuffer){M.setValue(Me,"logDepthBufFC",2/(Math.log(e.far+1)/Math.LN2))}if(re!==e){re=e;b=!0;S=!0}if(r.isShaderMaterial||r.isMeshPhongMaterial||r.isMeshToonMaterial||r.isMeshStandardMaterial||r.envMap){var w=M.map.cameraPosition;if(w!==void 0){w.setValue(Me,be.setFromMatrixPosition(e.matrixWorld))}}if(r.isMeshPhongMaterial||r.isMeshToonMaterial||r.isMeshLambertMaterial||r.isMeshBasicMaterial||r.isMeshStandardMaterial||r.isShaderMaterial){M.setValue(Me,"isOrthographic",!0===e.isOrthographicCamera)}if(r.isMeshPhongMaterial||r.isMeshToonMaterial||r.isMeshLambertMaterial||r.isMeshBasicMaterial||r.isMeshStandardMaterial||r.isShaderMaterial||r.isShadowMaterial||i.isSkinnedMesh){M.setValue(Me,"viewMatrix",e.matrixWorldInverse)}}if(i.isSkinnedMesh){M.setOptional(Me,i,"bindMatrix");M.setOptional(Me,i,"bindMatrixInverse");var A=i.skeleton;if(A){if(Ee.floatVertexTextures){if(null===A.boneTexture)A.computeBoneTexture();M.setValue(Me,"boneTexture",A.boneTexture,Ce);M.setValue(Me,"boneTextureSize",A.boneTextureSize)}else{M.setOptional(Me,A,"boneMatrices")}}}if(!!a&&(a.morphAttributes.position!==void 0||a.morphAttributes.normal!==void 0)){Ge.update(i,a,r,y)}if(b||g.receiveShadow!==i.receiveShadow){g.receiveShadow=i.receiveShadow;M.setValue(Me,"receiveShadow",i.receiveShadow)}if(b){M.setValue(Me,"toneMappingExposure",Q.toneMappingExposure);if(g.needsLights){_(T,S)}if(n&&r.fog){Ne.refreshFogUniforms(T,n)}Ne.refreshMaterialUniforms(T,r,de,le,_e);We.upload(Me,g.uniformsList,T,Ce)}if(r.isShaderMaterial&&!0===r.uniformsNeedUpdate){We.upload(Me,g.uniformsList,T,Ce);r.uniformsNeedUpdate=!1}if(r.isSpriteMaterial){M.setValue(Me,"center",i.center)}M.setValue(Me,"modelViewMatrix",i.modelViewMatrix);M.setValue(Me,"normalMatrix",i.normalMatrix);M.setValue(Me,"modelMatrix",i.matrixWorld);return y}function _(e,t){e.ambientLightColor.needsUpdate=t;e.lightProbe.needsUpdate=t;e.directionalLights.needsUpdate=t;e.directionalLightShadows.needsUpdate=t;e.pointLights.needsUpdate=t;e.pointLightShadows.needsUpdate=t;e.spotLights.needsUpdate=t;e.spotLightShadows.needsUpdate=t;e.rectAreaLights.needsUpdate=t;e.hemisphereLights.needsUpdate=t}function x(e){return e.isMeshLambertMaterial||e.isMeshToonMaterial||e.isMeshPhongMaterial||e.isMeshStandardMaterial||e.isShadowMaterial||e.isShaderMaterial&&!0===e.lights}this.getActiveCubeFace=function(){return $};this.getActiveMipmapLevel=function(){return ee};this.getRenderTarget=function(){return te};this.setRenderTargetTextures=function(e,t,a){ke.get(e.texture).__webglTexture=t;ke.get(e.depthTexture).__webglTexture=a;var r=ke.get(e);r.__hasExternalTextures=!0;if(r.__hasExternalTextures){r.__autoAllocateDepthBuffer=a===void 0;if(!r.__autoAllocateDepthBuffer){if(e.useRenderToTexture){console.warn("render-to-texture extension was disabled because an external texture was provided");e.useRenderToTexture=!1;e.useRenderbuffer=!0}}}};this.setRenderTargetFramebuffer=function(e,t){var a=ke.get(e);a.__webglFramebuffer=t;a.__useDefaultFramebuffer=t===void 0};this.setRenderTarget=function(e){var t=1<arguments.length&&arguments[1]!==void 0?arguments[1]:0,a=2<arguments.length&&arguments[2]!==void 0?arguments[2]:0;te=e;$=t;ee=a;var r=!0;if(e){var d=ke.get(e);if(d.__useDefaultFramebuffer!==void 0){we.bindFramebuffer(36160,null);r=!1}else if(d.__webglFramebuffer===void 0){Ce.setupRenderTarget(e)}else if(d.__hasExternalTextures){Ce.rebindTextures(e,ke.get(e.texture).__webglTexture,ke.get(e.depthTexture).__webglTexture)}}var i=null,n=!1,o=!1;if(e){var c=e.texture;if(c.isDataTexture3D||c.isDataTexture2DArray){o=!0}var u=ke.get(e).__webglFramebuffer;if(e.isWebGLCubeRenderTarget){i=u[t];n=!0}else if(e.useRenderbuffer){i=ke.get(e).__webglMultisampledFramebuffer}else{i=u}ie.copy(e.viewport);ne.copy(e.scissor);oe=e.scissorTest}else{ie.copy(pe).multiplyScalar(de).floor();ne.copy(me).multiplyScalar(de).floor();oe=ge}var s=we.bindFramebuffer(36160,i);if(s&&Ee.drawBuffers&&r){var p=!1;if(e){if(e.isWebGLMultipleRenderTargets){var m=e.texture;if(fe.length!==m.length||36064!==fe[0]){for(var g=0,f=m.length;g<f;g++){fe[g]=36064+g}fe.length=m.length;p=!0}}else{if(1!==fe.length||36064!==fe[0]){fe[0]=36064;fe.length=1;p=!0}}}else{if(1!==fe.length||1029!==fe[0]){fe[0]=1029;fe.length=1;p=!0}}if(p){if(Ee.isWebGL2){Me.drawBuffers(fe)}else{Te.get("WEBGL_draw_buffers").drawBuffersWEBGL(fe)}}}we.viewport(ie);we.scissor(ne);we.setScissorTest(oe);if(n){var h=ke.get(e.texture);Me.framebufferTexture2D(36160,36064,34069+t,h.__webglTexture,a)}else if(o){var l=ke.get(e.texture);Me.framebufferTextureLayer(36160,36064,l.__webglTexture,a||0,t||0)}ae=-1};this.readRenderTargetPixels=function(e,t,a,r,i,n,o){if(!(e&&e.isWebGLRenderTarget)){console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not THREE.WebGLRenderTarget.");return}var s=ke.get(e).__webglFramebuffer;if(e.isWebGLCubeRenderTarget&&o!==void 0){s=s[o]}if(s){we.bindFramebuffer(36160,s);try{var l=e.texture,d=l.format,c=l.type;if(d!==Gi&&qe.convert(d)!==Me.getParameter(35739)){console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not in RGBA or implementation defined format.");return}var u=c===zi&&(Te.has("EXT_color_buffer_half_float")||Ee.isWebGL2&&Te.has("EXT_color_buffer_float"));if(c!==ki&&qe.convert(c)!==Me.getParameter(35738)&&!(c===Ii&&(Ee.isWebGL2||Te.has("OES_texture_float")||Te.has("WEBGL_color_buffer_float")))&&!u){console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not in UnsignedByteType or implementation defined type.");return}if(36053===Me.checkFramebufferStatus(36160)){if(0<=t&&t<=e.width-r&&0<=a&&a<=e.height-i){Me.readPixels(t,a,r,i,qe.convert(d),qe.convert(c),n)}}else{console.error("THREE.WebGLRenderer.readRenderTargetPixels: readPixels from renderTarget failed. Framebuffer not complete.")}}finally{var p=null!==te?ke.get(te).__webglFramebuffer:null;we.bindFramebuffer(36160,p)}}};this.copyFramebufferToTexture=function(e,t){var a=2<arguments.length&&arguments[2]!==void 0?arguments[2]:0,r=Math.pow(2,-a),i=Math.floor(t.image.width*r),n=Math.floor(t.image.height*r),o=qe.convert(t.format);if(Ee.isWebGL2){if(6407===o)o=32849;if(6408===o)o=32856}Ce.setTexture2D(t,0);Me.copyTexImage2D(3553,a,o,e.x,e.y,i,n,0);we.unbindTexture()};this.copyTextureToTexture=function(e,t,a){var r=3<arguments.length&&arguments[3]!==void 0?arguments[3]:0,i=t.image.width,n=t.image.height,o=qe.convert(a.format),s=qe.convert(a.type);Ce.setTexture2D(a,0);Me.pixelStorei(37440,a.flipY);Me.pixelStorei(37441,a.premultiplyAlpha);Me.pixelStorei(3317,a.unpackAlignment);if(t.isDataTexture){Me.texSubImage2D(3553,r,e.x,e.y,i,n,o,s,t.image.data)}else{if(t.isCompressedTexture){Me.compressedTexSubImage2D(3553,r,e.x,e.y,t.mipmaps[0].width,t.mipmaps[0].height,o,t.mipmaps[0].data)}else{Me.texSubImage2D(3553,r,e.x,e.y,o,s,t.image)}}if(0===r&&a.generateMipmaps)Me.generateMipmap(3553);we.unbindTexture()};this.copyTextureToTexture3D=function(e,t,a,r){var i=4<arguments.length&&arguments[4]!==void 0?arguments[4]:0;if(Q.isWebGL1Renderer){console.warn("THREE.WebGLRenderer.copyTextureToTexture3D: can only be used with WebGL2.");return}var n=e.max.x-e.min.x+1,o=e.max.y-e.min.y+1,s=e.max.z-e.min.z+1,l=qe.convert(r.format),d=qe.convert(r.type),c;if(r.isDataTexture3D){Ce.setTexture3D(r,0);c=32879}else if(r.isDataTexture2DArray){Ce.setTexture2DArray(r,0);c=35866}else{console.warn("THREE.WebGLRenderer.copyTextureToTexture3D: only supports THREE.DataTexture3D and THREE.DataTexture2DArray.");return}Me.pixelStorei(37440,r.flipY);Me.pixelStorei(37441,r.premultiplyAlpha);Me.pixelStorei(3317,r.unpackAlignment);var u=Me.getParameter(3314),p=Me.getParameter(32878),m=Me.getParameter(3316),g=Me.getParameter(3315),f=Me.getParameter(32877),h=a.isCompressedTexture?a.mipmaps[0]:a.image;Me.pixelStorei(3314,h.width);Me.pixelStorei(32878,h.height);Me.pixelStorei(3316,e.min.x);Me.pixelStorei(3315,e.min.y);Me.pixelStorei(32877,e.min.z);if(a.isDataTexture||a.isDataTexture3D){Me.texSubImage3D(c,i,t.x,t.y,t.z,n,o,s,l,d,h.data)}else{if(a.isCompressedTexture){console.warn("THREE.WebGLRenderer.copyTextureToTexture3D: untested support for compressed srcTexture.");Me.compressedTexSubImage3D(c,i,t.x,t.y,t.z,n,o,s,l,h.data)}else{Me.texSubImage3D(c,i,t.x,t.y,t.z,n,o,s,l,d,h)}}Me.pixelStorei(3314,u);Me.pixelStorei(32878,p);Me.pixelStorei(3316,m);Me.pixelStorei(3315,g);Me.pixelStorei(32877,f);if(0===i&&r.generateMipmaps)Me.generateMipmap(c);we.unbindTexture()};this.initTexture=function(e){Ce.setTexture2D(e,0);we.unbindTexture()};this.resetState=function(){$=0;ee=0;te=null;we.reset();Xe.reset()};if("undefined"!=typeof __THREE_DEVTOOLS__){__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("observe",{detail:this}))}}Dt.prototype.isWebGLRenderer=!0;var Od=function(e){_inherits(t,e);var a=_createSuper(t);function t(){_classCallCheck2(this,t);return a.apply(this,arguments)}return t}(Dt);Od.prototype.isWebGL1Renderer=!0;var Fd=function(e){_inherits(t,e);var a=_createSuper(t);function t(){var e;_classCallCheck2(this,t);e=a.call(this);e.type="Scene";e.background=null;e.environment=null;e.fog=null;e.overrideMaterial=null;e.autoUpdate=!0;if("undefined"!=typeof __THREE_DEVTOOLS__){__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("observe",{detail:_assertThisInitialized(e)}))}return e}_createClass2(t,[{key:"copy",value:function copy(e,a){_get(_getPrototypeOf(t.prototype),"copy",this).call(this,e,a);if(null!==e.background)this.background=e.background.clone();if(null!==e.environment)this.environment=e.environment.clone();if(null!==e.fog)this.fog=e.fog.clone();if(null!==e.overrideMaterial)this.overrideMaterial=e.overrideMaterial.clone();this.autoUpdate=e.autoUpdate;this.matrixAutoUpdate=e.matrixAutoUpdate;return this}},{key:"toJSON",value:function toJSON(e){var a=_get(_getPrototypeOf(t.prototype),"toJSON",this).call(this,e);if(null!==this.fog)a.object.fog=this.fog.toJSON();return a}}]);return t}(Ds);Fd.prototype.isScene=!0;var Ud=function(){function t(a,r){_classCallCheck2(this,t);this.array=a;this.stride=r;this.count=a!==void 0?a.length/r:0;this.usage=mo;this.updateRange={offset:0,count:-1};this.version=0;this.uuid=e()}_createClass2(t,[{key:"onUploadCallback",value:function onUploadCallback(){}},{key:"setUsage",value:function setUsage(e){this.usage=e;return this}},{key:"copy",value:function copy(e){this.array=new e.array.constructor(e.array);this.count=e.count;this.stride=e.stride;this.usage=e.usage;return this}},{key:"copyAt",value:function copyAt(e,t,a){e*=this.stride;a*=t.stride;for(var r=0,i=this.stride;r<i;r++){this.array[e+r]=t.array[a+r]}return this}},{key:"set",value:function set(e){var t=1<arguments.length&&arguments[1]!==void 0?arguments[1]:0;this.array.set(e,t);return this}},{key:"clone",value:function clone(t){if(t.arrayBuffers===void 0){t.arrayBuffers={}}if(this.array.buffer._uuid===void 0){this.array.buffer._uuid=e()}if(t.arrayBuffers[this.array.buffer._uuid]===void 0){t.arrayBuffers[this.array.buffer._uuid]=this.array.slice(0).buffer}var a=new this.array.constructor(t.arrayBuffers[this.array.buffer._uuid]),r=new this.constructor(a,this.stride);r.setUsage(this.usage);return r}},{key:"onUpload",value:function onUpload(e){this.onUploadCallback=e;return this}},{key:"toJSON",value:function toJSON(t){if(t.arrayBuffers===void 0){t.arrayBuffers={}}if(this.array.buffer._uuid===void 0){this.array.buffer._uuid=e()}if(t.arrayBuffers[this.array.buffer._uuid]===void 0){t.arrayBuffers[this.array.buffer._uuid]=Array.prototype.slice.call(new Uint32Array(this.array.buffer))}return{uuid:this.uuid,buffer:this.array.buffer._uuid,type:this.array.constructor.name,stride:this.stride}}},{key:"needsUpdate",set:function set(e){if(!0===e)this.version++}}]);return t}();Ud.prototype.isInterleavedBuffer=!0;var Bd=new Po,Hd=function(){function e(t,a,r){var i=3<arguments.length&&arguments[3]!==void 0?arguments[3]:!1;_classCallCheck2(this,e);this.name="";this.data=t;this.itemSize=a;this.offset=r;this.normalized=!0===i}_createClass2(e,[{key:"applyMatrix4",value:function applyMatrix4(e){for(var t=0,a=this.data.count;t<a;t++){Bd.x=this.getX(t);Bd.y=this.getY(t);Bd.z=this.getZ(t);Bd.applyMatrix4(e);this.setXYZ(t,Bd.x,Bd.y,Bd.z)}return this}},{key:"applyNormalMatrix",value:function applyNormalMatrix(e){for(var t=0,a=this.count;t<a;t++){Bd.x=this.getX(t);Bd.y=this.getY(t);Bd.z=this.getZ(t);Bd.applyNormalMatrix(e);this.setXYZ(t,Bd.x,Bd.y,Bd.z)}return this}},{key:"transformDirection",value:function transformDirection(e){for(var t=0,a=this.count;t<a;t++){Bd.x=this.getX(t);Bd.y=this.getY(t);Bd.z=this.getZ(t);Bd.transformDirection(e);this.setXYZ(t,Bd.x,Bd.y,Bd.z)}return this}},{key:"setX",value:function setX(e,t){this.data.array[e*this.data.stride+this.offset]=t;return this}},{key:"setY",value:function setY(e,t){this.data.array[e*this.data.stride+this.offset+1]=t;return this}},{key:"setZ",value:function setZ(e,t){this.data.array[e*this.data.stride+this.offset+2]=t;return this}},{key:"setW",value:function setW(e,t){this.data.array[e*this.data.stride+this.offset+3]=t;return this}},{key:"getX",value:function getX(e){return this.data.array[e*this.data.stride+this.offset]}},{key:"getY",value:function getY(e){return this.data.array[e*this.data.stride+this.offset+1]}},{key:"getZ",value:function getZ(e){return this.data.array[e*this.data.stride+this.offset+2]}},{key:"getW",value:function getW(e){return this.data.array[e*this.data.stride+this.offset+3]}},{key:"setXY",value:function setXY(e,t,a){e=e*this.data.stride+this.offset;this.data.array[e+0]=t;this.data.array[e+1]=a;return this}},{key:"setXYZ",value:function setXYZ(e,t,a,r){e=e*this.data.stride+this.offset;this.data.array[e+0]=t;this.data.array[e+1]=a;this.data.array[e+2]=r;return this}},{key:"setXYZW",value:function setXYZW(e,t,a,r,i){e=e*this.data.stride+this.offset;this.data.array[e+0]=t;this.data.array[e+1]=a;this.data.array[e+2]=r;this.data.array[e+3]=i;return this}},{key:"clone",value:function clone(t){if(t===void 0){console.log("THREE.InterleavedBufferAttribute.clone(): Cloning an interlaved buffer attribute will deinterleave buffer data.");for(var a=[],r=0,i;r<this.count;r++){i=r*this.data.stride+this.offset;for(var n=0;n<this.itemSize;n++){a.push(this.data.array[i+n])}}return new el(new this.array.constructor(a),this.itemSize,this.normalized)}else{if(t.interleavedBuffers===void 0){t.interleavedBuffers={}}if(t.interleavedBuffers[this.data.uuid]===void 0){t.interleavedBuffers[this.data.uuid]=this.data.clone(t)}return new e(t.interleavedBuffers[this.data.uuid],this.itemSize,this.offset,this.normalized)}}},{key:"toJSON",value:function toJSON(e){if(e===void 0){console.log("THREE.InterleavedBufferAttribute.toJSON(): Serializing an interlaved buffer attribute will deinterleave buffer data.");for(var t=[],a=0,r;a<this.count;a++){r=a*this.data.stride+this.offset;for(var i=0;i<this.itemSize;i++){t.push(this.data.array[r+i])}}return{itemSize:this.itemSize,type:this.array.constructor.name,array:t,normalized:this.normalized}}else{if(e.interleavedBuffers===void 0){e.interleavedBuffers={}}if(e.interleavedBuffers[this.data.uuid]===void 0){e.interleavedBuffers[this.data.uuid]=this.data.toJSON(e)}return{isInterleavedBufferAttribute:!0,itemSize:this.itemSize,data:this.data.uuid,offset:this.offset,normalized:this.normalized}}}},{key:"count",get:function get(){return this.data.count}},{key:"array",get:function get(){return this.data.array}},{key:"needsUpdate",set:function set(e){this.data.needsUpdate=e}}]);return e}();Hd.prototype.isInterleavedBufferAttribute=!0;var Gd=function(e){_inherits(t,e);var a=_createSuper(t);function t(e){var r;_classCallCheck2(this,t);r=a.call(this);r.type="SpriteMaterial";r.color=new Js(16777215);r.map=null;r.alphaMap=null;r.rotation=0;r.sizeAttenuation=!0;r.transparent=!0;r.setValues(e);return r}_createClass2(t,[{key:"copy",value:function copy(e){_get(_getPrototypeOf(t.prototype),"copy",this).call(this,e);this.color.copy(e.color);this.map=e.map;this.alphaMap=e.alphaMap;this.rotation=e.rotation;this.sizeAttenuation=e.sizeAttenuation;return this}}]);return t}(qs);Gd.prototype.isSpriteMaterial=!0;var Vd,Wd=new Po,jd=new Po,qd=new Po,Xd=new bo,Yd=new bo,Zd=new ls,Jd=new Po,Qd=new Po,Kd=new Po,$d=new bo,ec=new bo,tc=new bo,ac=function(e){_inherits(t,e);var a=_createSuper(t);function t(e){var r;_classCallCheck2(this,t);r=a.call(this);r.type="Sprite";if(Vd===void 0){Vd=new pl;var i=new Float32Array([-.5,-.5,0,0,0,.5,-.5,0,1,0,.5,.5,0,1,1,-.5,.5,0,0,1]),n=new Ud(i,5);Vd.setIndex([0,1,2,0,2,3]);Vd.setAttribute("position",new Hd(n,3,0,!1));Vd.setAttribute("uv",new Hd(n,2,3,!1))}r.geometry=Vd;r.material=e!==void 0?e:new Gd;r.center=new bo(.5,.5);return r}_createClass2(t,[{key:"raycast",value:function raycast(e,t){if(null===e.camera){console.error("THREE.Sprite: \"Raycaster.camera\" needs to be set in order to raycast against sprites.")}jd.setFromMatrixScale(this.matrixWorld);Zd.copy(e.camera.matrixWorld);this.modelViewMatrix.multiplyMatrices(e.camera.matrixWorldInverse,this.matrixWorld);qd.setFromMatrixPosition(this.modelViewMatrix);if(e.camera.isPerspectiveCamera&&!1===this.material.sizeAttenuation){jd.multiplyScalar(-qd.z)}var a=this.material.rotation,r,i;if(0!==a){i=Math.cos(a);r=Math.sin(a)}var n=this.center;It(Jd.set(-.5,-.5,0),qd,n,jd,r,i);It(Qd.set(.5,-.5,0),qd,n,jd,r,i);It(Kd.set(.5,.5,0),qd,n,jd,r,i);$d.set(0,0);ec.set(1,0);tc.set(1,1);var o=e.ray.intersectTriangle(Jd,Qd,Kd,!1,Wd);if(null===o){It(Qd.set(-.5,.5,0),qd,n,jd,r,i);ec.set(0,1);o=e.ray.intersectTriangle(Jd,Kd,Qd,!1,Wd);if(null===o){return}}var s=e.ray.origin.distanceTo(Wd);if(s<e.near||s>e.far)return;t.push({distance:s,point:Wd.clone(),uv:Ws.getUV(Wd,Jd,Qd,Kd,$d,ec,tc,new bo),face:null,object:this})}},{key:"copy",value:function copy(e){_get(_getPrototypeOf(t.prototype),"copy",this).call(this,e);if(e.center!==void 0)this.center.copy(e.center);this.material=e.material;return this}}]);return t}(Ds);ac.prototype.isSprite=!0;function It(e,t,a,r,i,n){Xd.subVectors(e,a).addScalar(.5).multiply(r);if(i!==void 0){Yd.x=n*Xd.x-i*Xd.y;Yd.y=i*Xd.x+n*Xd.y}else{Yd.copy(Xd)}e.copy(t);e.x+=Yd.x;e.y+=Yd.y;e.applyMatrix4(Zd)}var rc=new Po,ic=new Ao,nc=new Ao,oc=new Po,sc=new ls,lc=function(e){_inherits(t,e);var a=_createSuper(t);function t(e,r){var i;_classCallCheck2(this,t);i=a.call(this,e,r);i.type="SkinnedMesh";i.bindMode="attached";i.bindMatrix=new ls;i.bindMatrixInverse=new ls;return i}_createClass2(t,[{key:"copy",value:function copy(e){_get(_getPrototypeOf(t.prototype),"copy",this).call(this,e);this.bindMode=e.bindMode;this.bindMatrix.copy(e.bindMatrix);this.bindMatrixInverse.copy(e.bindMatrixInverse);this.skeleton=e.skeleton;return this}},{key:"bind",value:function bind(e,t){this.skeleton=e;if(t===void 0){this.updateMatrixWorld(!0);this.skeleton.calculateInverses();t=this.matrixWorld}this.bindMatrix.copy(t);this.bindMatrixInverse.copy(t).invert()}},{key:"pose",value:function pose(){this.skeleton.pose()}},{key:"normalizeSkinWeights",value:function normalizeSkinWeights(){for(var e=new Ao,t=this.geometry.attributes.skinWeight,a=0,r=t.count;a<r;a++){e.x=t.getX(a);e.y=t.getY(a);e.z=t.getZ(a);e.w=t.getW(a);var i=1/e.manhattanLength();if(i!=1/0){e.multiplyScalar(i)}else{e.set(1,0,0,0)}t.setXYZW(a,e.x,e.y,e.z,e.w)}}},{key:"updateMatrixWorld",value:function updateMatrixWorld(e){_get(_getPrototypeOf(t.prototype),"updateMatrixWorld",this).call(this,e);if("attached"===this.bindMode){this.bindMatrixInverse.copy(this.matrixWorld).invert()}else if("detached"===this.bindMode){this.bindMatrixInverse.copy(this.bindMatrix).invert()}else{console.warn("THREE.SkinnedMesh: Unrecognized bindMode: "+this.bindMode)}}},{key:"boneTransform",value:function boneTransform(e,t){var a=this.skeleton,r=this.geometry;ic.fromBufferAttribute(r.attributes.skinIndex,e);nc.fromBufferAttribute(r.attributes.skinWeight,e);rc.copy(t).applyMatrix4(this.bindMatrix);t.set(0,0,0);for(var i=0,n;4>i;i++){n=nc.getComponent(i);if(0!==n){var o=ic.getComponent(i);sc.multiplyMatrices(a.bones[o].matrixWorld,a.boneInverses[o]);t.addScaledVector(oc.copy(rc).applyMatrix4(sc),n)}}return t.applyMatrix4(this.bindMatrixInverse)}}]);return t}(Ll);lc.prototype.isSkinnedMesh=!0;var dc=function(e){_inherits(t,e);var a=_createSuper(t);function t(){var e;_classCallCheck2(this,t);e=a.call(this);e.type="Bone";return e}return t}(Ds);dc.prototype.isBone=!0;var cc=function(e){_inherits(t,e);var a=_createSuper(t);function t(){var e,r=0<arguments.length&&arguments[0]!==void 0?arguments[0]:null,i=1<arguments.length&&arguments[1]!==void 0?arguments[1]:1,n=2<arguments.length&&arguments[2]!==void 0?arguments[2]:1,o=3<arguments.length?arguments[3]:void 0,s=4<arguments.length?arguments[4]:void 0,l=5<arguments.length?arguments[5]:void 0,d=6<arguments.length?arguments[6]:void 0,c=7<arguments.length?arguments[7]:void 0,u=8<arguments.length&&arguments[8]!==void 0?arguments[8]:Si,p=9<arguments.length&&arguments[9]!==void 0?arguments[9]:Si,m=10<arguments.length?arguments[10]:void 0,g=11<arguments.length?arguments[11]:void 0;_classCallCheck2(this,t);e=a.call(this,null,l,d,c,u,p,o,s,m,g);e.image={data:r,width:i,height:n};e.magFilter=u;e.minFilter=p;e.generateMipmaps=!1;e.flipY=!1;e.unpackAlignment=1;e.needsUpdate=!0;return e}return t}(wo);cc.prototype.isDataTexture=!0;var uc=function(e){_inherits(t,e);var a=_createSuper(t);function t(e,r,i){var n,o=3<arguments.length&&arguments[3]!==void 0?arguments[3]:1;_classCallCheck2(this,t);if("number"==typeof i){o=i;i=!1;console.error("THREE.InstancedBufferAttribute: The constructor now expects normalized as the third argument.")}n=a.call(this,e,r,i);n.meshPerAttribute=o;return n}_createClass2(t,[{key:"copy",value:function copy(e){_get(_getPrototypeOf(t.prototype),"copy",this).call(this,e);this.meshPerAttribute=e.meshPerAttribute;return this}},{key:"toJSON",value:function toJSON(){var e=_get(_getPrototypeOf(t.prototype),"toJSON",this).call(this);e.meshPerAttribute=this.meshPerAttribute;e.isInstancedBufferAttribute=!0;return e}}]);return t}(el);uc.prototype.isInstancedBufferAttribute=!0;var pc=new ls,mc=new ls,gc=[],fc=new Ll,hc=function(e){_inherits(t,e);var a=_createSuper(t);function t(e,r,i){var n;_classCallCheck2(this,t);n=a.call(this,e,r);n.instanceMatrix=new uc(new Float32Array(16*i),16);n.instanceColor=null;n.count=i;n.frustumCulled=!1;return n}_createClass2(t,[{key:"copy",value:function copy(e){_get(_getPrototypeOf(t.prototype),"copy",this).call(this,e);this.instanceMatrix.copy(e.instanceMatrix);if(null!==e.instanceColor)this.instanceColor=e.instanceColor.clone();this.count=e.count;return this}},{key:"getColorAt",value:function getColorAt(e,t){t.fromArray(this.instanceColor.array,3*e)}},{key:"getMatrixAt",value:function getMatrixAt(e,t){t.fromArray(this.instanceMatrix.array,16*e)}},{key:"raycast",value:function raycast(e,t){var a=this.matrixWorld,r=this.count;fc.geometry=this.geometry;fc.material=this.material;if(fc.material===void 0)return;for(var i=0;i<r;i++){this.getMatrixAt(i,pc);mc.multiplyMatrices(a,pc);fc.matrixWorld=mc;fc.raycast(e,gc);for(var n=0,o=gc.length,s;n<o;n++){s=gc[n];s.instanceId=i;s.object=this;t.push(s)}gc.length=0}}},{key:"setColorAt",value:function setColorAt(e,t){if(null===this.instanceColor){this.instanceColor=new uc(new Float32Array(3*this.instanceMatrix.count),3)}t.toArray(this.instanceColor.array,3*e)}},{key:"setMatrixAt",value:function setMatrixAt(e,t){t.toArray(this.instanceMatrix.array,16*e)}},{key:"updateMorphTargets",value:function updateMorphTargets(){}},{key:"dispose",value:function dispose(){this.dispatchEvent({type:"dispose"})}}]);return t}(Ll);hc.prototype.isInstancedMesh=!0;var vc=function(e){_inherits(t,e);var a=_createSuper(t);function t(e){var r;_classCallCheck2(this,t);r=a.call(this);r.type="LineBasicMaterial";r.color=new Js(16777215);r.linewidth=1;r.linecap="round";r.linejoin="round";r.setValues(e);return r}_createClass2(t,[{key:"copy",value:function copy(e){_get(_getPrototypeOf(t.prototype),"copy",this).call(this,e);this.color.copy(e.color);this.linewidth=e.linewidth;this.linecap=e.linecap;this.linejoin=e.linejoin;return this}}]);return t}(qs);vc.prototype.isLineBasicMaterial=!0;var yc=new Po,_c=new Po,xc=new ls,bc=new ss,Sc=new $o,Mc=function(e){_inherits(t,e);var a=_createSuper(t);function t(){var e,r=0<arguments.length&&arguments[0]!==void 0?arguments[0]:new pl,i=1<arguments.length&&arguments[1]!==void 0?arguments[1]:new vc;_classCallCheck2(this,t);e=a.call(this);e.type="Line";e.geometry=r;e.material=i;e.updateMorphTargets();return e}_createClass2(t,[{key:"copy",value:function copy(e){_get(_getPrototypeOf(t.prototype),"copy",this).call(this,e);this.material=e.material;this.geometry=e.geometry;return this}},{key:"computeLineDistances",value:function computeLineDistances(){var e=this.geometry;if(e.isBufferGeometry){if(null===e.index){for(var t=e.attributes.position,a=[0],r=1,i=t.count;r<i;r++){yc.fromBufferAttribute(t,r-1);_c.fromBufferAttribute(t,r);a[r]=a[r-1];a[r]+=yc.distanceTo(_c)}e.setAttribute("lineDistance",new il(a,1))}else{console.warn("THREE.Line.computeLineDistances(): Computation only possible with non-indexed BufferGeometry.")}}else if(e.isGeometry){console.error("THREE.Line.computeLineDistances() no longer supports THREE.Geometry. Use THREE.BufferGeometry instead.")}return this}},{key:"raycast",value:function raycast(e,t){var r=this.geometry,i=this.matrixWorld,n=e.params.Line.threshold,o=r.drawRange;if(null===r.boundingSphere)r.computeBoundingSphere();Sc.copy(r.boundingSphere);Sc.applyMatrix4(i);Sc.radius+=n;if(!1===e.ray.intersectsSphere(Sc))return;xc.copy(i).invert();bc.copy(e.ray).applyMatrix4(xc);var s=n/((this.scale.x+this.scale.y+this.scale.z)/3),l=s*s,d=new Po,c=new Po,u=new Po,p=new Po,m=this.isLineSegments?2:1;if(r.isBufferGeometry){var g=r.index,f=r.attributes,h=f.position;if(null!==g){for(var v=Math.max(0,o.start),y=Math.min(g.count,o.start+o.count),_=v;_<y-1;_+=m){var x=g.getX(_),a=g.getX(_+1);d.fromBufferAttribute(h,x);c.fromBufferAttribute(h,a);var T=bc.distanceSqToSegment(d,c,p,u);if(T>l)continue;p.applyMatrix4(this.matrixWorld);var E=e.ray.origin.distanceTo(p);if(E<e.near||E>e.far)continue;t.push({distance:E,point:u.clone().applyMatrix4(this.matrixWorld),index:_,face:null,faceIndex:null,object:this})}}else{for(var b=Math.max(0,o.start),S=Math.min(h.count,o.start+o.count),M=b;M<S-1;M+=m){d.fromBufferAttribute(h,M);c.fromBufferAttribute(h,M+1);var w=bc.distanceSqToSegment(d,c,p,u);if(w>l)continue;p.applyMatrix4(this.matrixWorld);var A=e.ray.origin.distanceTo(p);if(A<e.near||A>e.far)continue;t.push({distance:A,point:u.clone().applyMatrix4(this.matrixWorld),index:M,face:null,faceIndex:null,object:this})}}}else if(r.isGeometry){console.error("THREE.Line.raycast() no longer supports THREE.Geometry. Use THREE.BufferGeometry instead.")}}},{key:"updateMorphTargets",value:function updateMorphTargets(){var e=this.geometry;if(e.isBufferGeometry){var t=e.morphAttributes,a=Object.keys(t);if(0<a.length){var r=t[a[0]];if(r!==void 0){this.morphTargetInfluences=[];this.morphTargetDictionary={};for(var i=0,n=r.length,o;i<n;i++){o=r[i].name||i+"";this.morphTargetInfluences.push(0);this.morphTargetDictionary[o]=i}}}}else{var s=e.morphTargets;if(s!==void 0&&0<s.length){console.error("THREE.Line.updateMorphTargets() does not support THREE.Geometry. Use THREE.BufferGeometry instead.")}}}}]);return t}(Ds);Mc.prototype.isLine=!0;var Tc=new Po,Ec=new Po,wc=function(e){_inherits(t,e);var a=_createSuper(t);function t(e,r){var i;_classCallCheck2(this,t);i=a.call(this,e,r);i.type="LineSegments";return i}_createClass2(t,[{key:"computeLineDistances",value:function computeLineDistances(){var e=this.geometry;if(e.isBufferGeometry){if(null===e.index){for(var t=e.attributes.position,a=[],r=0,i=t.count;r<i;r+=2){Tc.fromBufferAttribute(t,r);Ec.fromBufferAttribute(t,r+1);a[r]=0==r?0:a[r-1];a[r+1]=a[r]+Tc.distanceTo(Ec)}e.setAttribute("lineDistance",new il(a,1))}else{console.warn("THREE.LineSegments.computeLineDistances(): Computation only possible with non-indexed BufferGeometry.")}}else if(e.isGeometry){console.error("THREE.LineSegments.computeLineDistances() no longer supports THREE.Geometry. Use THREE.BufferGeometry instead.")}return this}}]);return t}(Mc);wc.prototype.isLineSegments=!0;var Ac=function(e){_inherits(t,e);var a=_createSuper(t);function t(e,r){var i;_classCallCheck2(this,t);i=a.call(this,e,r);i.type="LineLoop";return i}return t}(Mc);Ac.prototype.isLineLoop=!0;var kc=function(e){_inherits(t,e);var a=_createSuper(t);function t(e){var r;_classCallCheck2(this,t);r=a.call(this);r.type="PointsMaterial";r.color=new Js(16777215);r.map=null;r.alphaMap=null;r.size=1;r.sizeAttenuation=!0;r.setValues(e);return r}_createClass2(t,[{key:"copy",value:function copy(e){_get(_getPrototypeOf(t.prototype),"copy",this).call(this,e);this.color.copy(e.color);this.map=e.map;this.alphaMap=e.alphaMap;this.size=e.size;this.sizeAttenuation=e.sizeAttenuation;return this}}]);return t}(qs);kc.prototype.isPointsMaterial=!0;var Cc=new ls,Lc=new ss,Rc=new $o,Pc=new Po,Dc=function(e){_inherits(t,e);var a=_createSuper(t);function t(){var e,r=0<arguments.length&&arguments[0]!==void 0?arguments[0]:new pl,i=1<arguments.length&&arguments[1]!==void 0?arguments[1]:new kc;_classCallCheck2(this,t);e=a.call(this);e.type="Points";e.geometry=r;e.material=i;e.updateMorphTargets();return e}_createClass2(t,[{key:"copy",value:function copy(e){_get(_getPrototypeOf(t.prototype),"copy",this).call(this,e);this.material=e.material;this.geometry=e.geometry;return this}},{key:"raycast",value:function raycast(e,t){var r=this.geometry,i=this.matrixWorld,n=e.params.Points.threshold,o=r.drawRange;if(null===r.boundingSphere)r.computeBoundingSphere();Rc.copy(r.boundingSphere);Rc.applyMatrix4(i);Rc.radius+=n;if(!1===e.ray.intersectsSphere(Rc))return;Cc.copy(i).invert();Lc.copy(e.ray).applyMatrix4(Cc);var s=n/((this.scale.x+this.scale.y+this.scale.z)/3),l=s*s;if(r.isBufferGeometry){var d=r.index,c=r.attributes,u=c.position;if(null!==d){for(var p=Math.max(0,o.start),m=Math.min(d.count,o.start+o.count),g=p,f;g<m;g++){f=d.getX(g);Pc.fromBufferAttribute(u,f);zt(Pc,f,l,i,e,t,this)}}else{for(var h=Math.max(0,o.start),v=Math.min(u.count,o.start+o.count),y=h;y<v;y++){Pc.fromBufferAttribute(u,y);zt(Pc,y,l,i,e,t,this)}}}else{console.error("THREE.Points.raycast() no longer supports THREE.Geometry. Use THREE.BufferGeometry instead.")}}},{key:"updateMorphTargets",value:function updateMorphTargets(){var e=this.geometry;if(e.isBufferGeometry){var t=e.morphAttributes,a=Object.keys(t);if(0<a.length){var r=t[a[0]];if(r!==void 0){this.morphTargetInfluences=[];this.morphTargetDictionary={};for(var i=0,n=r.length,o;i<n;i++){o=r[i].name||i+"";this.morphTargetInfluences.push(0);this.morphTargetDictionary[o]=i}}}}else{var s=e.morphTargets;if(s!==void 0&&0<s.length){console.error("THREE.Points.updateMorphTargets() does not support THREE.Geometry. Use THREE.BufferGeometry instead.")}}}}]);return t}(Ds);Dc.prototype.isPoints=!0;function zt(e,t,a,r,i,n,o){var s=Lc.distanceSqToPoint(e);if(s<a){var l=new Po;Lc.closestPointToPoint(e,l);l.applyMatrix4(r);var d=i.ray.origin.distanceTo(l);if(d<i.near||d>i.far)return;n.push({distance:d,distanceToRay:Math.sqrt(s),point:l,index:t,face:null,object:o})}}var Ic=function(e){_inherits(t,e);var a=_createSuper(t);function t(e,r,i,n,o,s,l,d,c){var p;_classCallCheck2(this,t);p=a.call(this,e,r,i,n,o,s,l,d,c);p.format=l!==void 0?l:Hi;p.minFilter=s!==void 0?s:Ei;p.magFilter=o!==void 0?o:Ei;p.generateMipmaps=!1;var m=_assertThisInitialized(p);function u(){m.needsUpdate=!0;e.requestVideoFrameCallback(u)}if("requestVideoFrameCallback"in e){e.requestVideoFrameCallback(u)}return p}_createClass2(t,[{key:"clone",value:function clone(){return new this.constructor(this.image).copy(this)}},{key:"update",value:function update(){var e=this.image,t=("requestVideoFrameCallback"in e);if(!1===t&&e.readyState>=e.HAVE_CURRENT_DATA){this.needsUpdate=!0}}}]);return t}(wo);Ic.prototype.isVideoTexture=!0;var zc=function(e){_inherits(t,e);var a=_createSuper(t);function t(e,r,i,n,o,s,l,d,c,u,p,m){var g;_classCallCheck2(this,t);g=a.call(this,null,s,l,d,c,u,n,o,p,m);g.image={width:r,height:i};g.mipmaps=e;g.flipY=!1;g.generateMipmaps=!1;return g}return t}(wo);zc.prototype.isCompressedTexture=!0;var Nc=function(e){_inherits(t,e);var a=_createSuper(t);function t(e,r,i,n,o,s,l,d,c){var u;_classCallCheck2(this,t);u=a.call(this,e,r,i,n,o,s,l,d,c);u.needsUpdate=!0;return u}return t}(wo);Nc.prototype.isCanvasTexture=!0;var Oc=function(e){_inherits(t,e);var a=_createSuper(t);function t(){var i,n=0<arguments.length&&arguments[0]!==void 0?arguments[0]:1,o=1<arguments.length&&arguments[1]!==void 0?arguments[1]:1,s=2<arguments.length&&arguments[2]!==void 0?arguments[2]:1,l=3<arguments.length&&arguments[3]!==void 0?arguments[3]:8,p=4<arguments.length&&arguments[4]!==void 0?arguments[4]:1,m=5<arguments.length&&arguments[5]!==void 0?arguments[5]:!1,g=6<arguments.length&&arguments[6]!==void 0?arguments[6]:0,f=7<arguments.length&&arguments[7]!==void 0?arguments[7]:2*Math.PI;_classCallCheck2(this,t);i=a.call(this);i.type="CylinderGeometry";i.parameters={radiusTop:n,radiusBottom:o,height:s,radialSegments:l,heightSegments:p,openEnded:m,thetaStart:g,thetaLength:f};var h=_assertThisInitialized(i);l=Math.floor(l);p=Math.floor(p);var v=[],y=[],_=[],b=[],S=0,M=[],T=s/2,E=0;e();if(!1===m){if(0<n)r(!0);if(0<o)r(!1)}i.setIndex(v);i.setAttribute("position",new il(y,3));i.setAttribute("normal",new il(_,3));i.setAttribute("uv",new il(b,2));function e(){for(var e=new Po,t=new Po,r=0,i=0;i<=p;i++){for(var m=[],w=i/p,A=w*(o-n)+n,k=0;k<=l;k++){var C=k/l,u=C*f+g,L=Math.sin(u),R=Math.cos(u);t.x=A*L;t.y=-w*s+T;t.z=A*R;y.push(t.x,t.y,t.z);e.set(L,(o-n)/s,R).normalize();_.push(e.x,e.y,e.z);b.push(C,1-w);m.push(S++)}M.push(m)}for(var d=0;d<l;d++){for(var I=0;I<p;I++){var P=M[I][d],a=M[I+1][d],D=M[I+1][d+1],c=M[I][d+1];v.push(P,a,c);v.push(a,D,c);r+=6}}h.addGroup(E,r,0);E+=r}function r(e){for(var t=S,a=new bo,r=new Po,i=0,s=!0===e?n:o,d=!0===e?1:-1,p=1;p<=l;p++){y.push(0,T*d,0);_.push(0,d,0);b.push(.5,.5);S++}for(var m=S,M=0;M<=l;M++){var w=M/l,u=w*f+g,A=Math.cos(u),k=Math.sin(u);r.x=s*k;r.y=T*d;r.z=s*A;y.push(r.x,r.y,r.z);_.push(0,d,0);a.x=.5*A+.5;a.y=.5*k*d+.5;b.push(a.x,a.y);S++}for(var L=0;L<l;L++){var C=t+L,c=m+L;if(!0===e){v.push(c,c+1,C)}else{v.push(c+1,c,C)}i+=3}h.addGroup(E,i,!0===e?1:2);E+=i}return i}_createClass2(t,null,[{key:"fromJSON",value:function fromJSON(e){return new t(e.radiusTop,e.radiusBottom,e.height,e.radialSegments,e.heightSegments,e.openEnded,e.thetaStart,e.thetaLength)}}]);return t}(pl),Fc=new Po,Uc=new Po,Bc=new Po,Hc=new Ws,Gc=function(e){_inherits(t,e);var r=_createSuper(t);function t(){var e,i=0<arguments.length&&arguments[0]!==void 0?arguments[0]:null,n=1<arguments.length&&arguments[1]!==void 0?arguments[1]:1;_classCallCheck2(this,t);e=r.call(this);e.type="EdgesGeometry";e.parameters={geometry:i,thresholdAngle:n};if(null!==i){for(var o=Math.pow(10,4),s=Math.cos(j*n),l=i.getIndex(),d=i.getAttribute("position"),u=l?l.count:d.count,p=[0,0,0],m=["a","b","c"],g=[,,,],f={},h=[],v=0;v<u;v+=3){if(l){p[0]=l.getX(v);p[1]=l.getX(v+1);p[2]=l.getX(v+2)}else{p[0]=v;p[1]=v+1;p[2]=v+2}var y=Hc.a,a=Hc.b,_=Hc.c;y.fromBufferAttribute(d,p[0]);a.fromBufferAttribute(d,p[1]);_.fromBufferAttribute(d,p[2]);Hc.getNormal(Bc);g[0]="".concat(Math.round(y.x*o),",").concat(Math.round(y.y*o),",").concat(Math.round(y.z*o));g[1]="".concat(Math.round(a.x*o),",").concat(Math.round(a.y*o),",").concat(Math.round(a.z*o));g[2]="".concat(Math.round(_.x*o),",").concat(Math.round(_.y*o),",").concat(Math.round(_.z*o));if(g[0]===g[1]||g[1]===g[2]||g[2]===g[0]){continue}for(var C=0;3>C;C++){var c=(C+1)%3,x=g[C],b=g[c],S=Hc[m[C]],M=Hc[m[c]],T="".concat(x,"_").concat(b),E="".concat(b,"_").concat(x);if(E in f&&f[E]){if(Bc.dot(f[E].normal)<=s){h.push(S.x,S.y,S.z);h.push(M.x,M.y,M.z)}f[E]=null}else if(!(T in f)){f[T]={index0:p[C],index1:p[c],normal:Bc.clone()}}}}for(var L in f){if(f[L]){var w=f[L],A=w.index0,k=w.index1;Fc.fromBufferAttribute(d,A);Uc.fromBufferAttribute(d,k);h.push(Fc.x,Fc.y,Fc.z);h.push(Uc.x,Uc.y,Uc.z)}}e.setAttribute("position",new il(h,3))}return e}return t}(pl),Vc=function(){function e(){_classCallCheck2(this,e);this.type="Curve";this.arcLengthDivisions=200}_createClass2(e,[{key:"getPoint",value:function getPoint(){console.warn("THREE.Curve: .getPoint() not implemented.");return null}},{key:"getPointAt",value:function getPointAt(e,a){var r=this.getUtoTmapping(e);return this.getPoint(r,a)}},{key:"getPoints",value:function getPoints(){for(var e=0<arguments.length&&arguments[0]!==void 0?arguments[0]:5,t=[],a=0;a<=e;a++){t.push(this.getPoint(a/e))}return t}},{key:"getSpacedPoints",value:function getSpacedPoints(){for(var e=0<arguments.length&&arguments[0]!==void 0?arguments[0]:5,t=[],a=0;a<=e;a++){t.push(this.getPointAt(a/e))}return t}},{key:"getLength",value:function getLength(){var e=this.getLengths();return e[e.length-1]}},{key:"getLengths",value:function getLengths(){var e=0<arguments.length&&arguments[0]!==void 0?arguments[0]:this.arcLengthDivisions;if(this.cacheArcLengths&&this.cacheArcLengths.length===e+1&&!this.needsUpdate){return this.cacheArcLengths}this.needsUpdate=!1;var t=[],a,r=this.getPoint(0),i=0;t.push(0);for(var n=1;n<=e;n++){a=this.getPoint(n/e);i+=a.distanceTo(r);t.push(i);r=a}this.cacheArcLengths=t;return t}},{key:"updateArcLengths",value:function updateArcLengths(){this.needsUpdate=!0;this.getLengths()}},{key:"getUtoTmapping",value:function getUtoTmapping(e,a){var r=this.getLengths(),n=0,o=r.length,s;if(a){s=a}else{s=e*r[o-1]}var l=0,d=o-1,c;while(l<=d){n=Math.floor(l+(d-l)/2);c=r[n]-s;if(0>c){l=n+1}else if(0<c){d=n-1}else{d=n;break}}n=d;if(r[n]===s){return n/(o-1)}var u=r[n],p=r[n+1],m=(s-u)/(p-u),g=(n+m)/(o-1);return g}},{key:"getTangent",value:function getTangent(e,t){var a=1e-4,r=e-a,i=e+a;if(0>r)r=0;if(1<i)i=1;var n=this.getPoint(r),o=this.getPoint(i),s=t||(n.isVector2?new bo:new Po);s.copy(o).sub(n).normalize();return s}},{key:"getTangentAt",value:function getTangentAt(e,a){var r=this.getUtoTmapping(e);return this.getTangent(r,a)}},{key:"computeFrenetFrames",value:function computeFrenetFrames(e,a){for(var r=new Po,i=[],n=[],o=[],s=new Po,l=new ls,d=0,c;d<=e;d++){c=d/e;i[d]=this.getTangentAt(c,new Po)}n[0]=new Po;o[0]=new Po;var p=Number.MAX_VALUE,m=Math.abs(i[0].x),g=Math.abs(i[0].y),f=Math.abs(i[0].z);if(m<=p){p=m;r.set(1,0,0)}if(g<=p){p=g;r.set(0,1,0)}if(f<=p){r.set(0,0,1)}s.crossVectors(i[0],r).normalize();n[0].crossVectors(i[0],s);o[0].crossVectors(i[0],n[0]);for(var h=1;h<=e;h++){n[h]=n[h-1].clone();o[h]=o[h-1].clone();s.crossVectors(i[h-1],i[h]);if(s.length()>Number.EPSILON){s.normalize();var v=Math.acos(t(i[h-1].dot(i[h]),-1,1));n[h].applyMatrix4(l.makeRotationAxis(s,v))}o[h].crossVectors(i[h],n[h])}if(!0===a){var y=Math.acos(t(n[0].dot(n[e]),-1,1));y/=e;if(0<i[0].dot(s.crossVectors(n[0],n[e]))){y=-y}for(var _=1;_<=e;_++){n[_].applyMatrix4(l.makeRotationAxis(i[_],y*_));o[_].crossVectors(i[_],n[_])}}return{tangents:i,normals:n,binormals:o}}},{key:"clone",value:function clone(){return new this.constructor().copy(this)}},{key:"copy",value:function copy(e){this.arcLengthDivisions=e.arcLengthDivisions;return this}},{key:"toJSON",value:function toJSON(){var e={metadata:{version:4.5,type:"Curve",generator:"Curve.toJSON"},arcLengthDivisions:this.arcLengthDivisions,type:this.type};return e}},{key:"fromJSON",value:function fromJSON(e){this.arcLengthDivisions=e.arcLengthDivisions;return this}}]);return e}(),Wc=function(e){_inherits(t,e);var a=_createSuper(t);function t(){var e,r=0<arguments.length&&arguments[0]!==void 0?arguments[0]:0,i=1<arguments.length&&arguments[1]!==void 0?arguments[1]:0,n=2<arguments.length&&arguments[2]!==void 0?arguments[2]:1,o=3<arguments.length&&arguments[3]!==void 0?arguments[3]:1,s=4<arguments.length&&arguments[4]!==void 0?arguments[4]:0,l=5<arguments.length&&arguments[5]!==void 0?arguments[5]:2*Math.PI,d=6<arguments.length&&arguments[6]!==void 0?arguments[6]:!1,c=7<arguments.length&&arguments[7]!==void 0?arguments[7]:0;_classCallCheck2(this,t);e=a.call(this);e.type="EllipseCurve";e.aX=r;e.aY=i;e.xRadius=n;e.yRadius=o;e.aStartAngle=s;e.aEndAngle=l;e.aClockwise=d;e.aRotation=c;return e}_createClass2(t,[{key:"getPoint",value:function getPoint(e,t){var a=t||new bo,r=2*Math.PI,i=this.aEndAngle-this.aStartAngle,n=Math.abs(i)<Number.EPSILON;while(0>i){i+=r}while(i>r){i-=r}if(i<Number.EPSILON){if(n){i=0}else{i=r}}if(!0===this.aClockwise&&!n){if(i===r){i=-r}else{i=i-r}}var o=this.aStartAngle+e*i,s=this.aX+this.xRadius*Math.cos(o),l=this.aY+this.yRadius*Math.sin(o);if(0!==this.aRotation){var d=Math.cos(this.aRotation),c=Math.sin(this.aRotation),u=s-this.aX,p=l-this.aY;s=u*d-p*c+this.aX;l=u*c+p*d+this.aY}return a.set(s,l)}},{key:"copy",value:function copy(e){_get(_getPrototypeOf(t.prototype),"copy",this).call(this,e);this.aX=e.aX;this.aY=e.aY;this.xRadius=e.xRadius;this.yRadius=e.yRadius;this.aStartAngle=e.aStartAngle;this.aEndAngle=e.aEndAngle;this.aClockwise=e.aClockwise;this.aRotation=e.aRotation;return this}},{key:"toJSON",value:function toJSON(){var e=_get(_getPrototypeOf(t.prototype),"toJSON",this).call(this);e.aX=this.aX;e.aY=this.aY;e.xRadius=this.xRadius;e.yRadius=this.yRadius;e.aStartAngle=this.aStartAngle;e.aEndAngle=this.aEndAngle;e.aClockwise=this.aClockwise;e.aRotation=this.aRotation;return e}},{key:"fromJSON",value:function fromJSON(e){_get(_getPrototypeOf(t.prototype),"fromJSON",this).call(this,e);this.aX=e.aX;this.aY=e.aY;this.xRadius=e.xRadius;this.yRadius=e.yRadius;this.aStartAngle=e.aStartAngle;this.aEndAngle=e.aEndAngle;this.aClockwise=e.aClockwise;this.aRotation=e.aRotation;return this}}]);return t}(Vc);Wc.prototype.isEllipseCurve=!0;var jc=function(e){_inherits(t,e);var a=_createSuper(t);function t(e,r,i,n,o,s){var l;_classCallCheck2(this,t);l=a.call(this,e,r,i,i,n,o,s);l.type="ArcCurve";return l}return t}(Wc);jc.prototype.isArcCurve=!0;function Nt(){var a=0,r=0,i=0,n=0;function e(e,t,o,s){a=e;r=o;i=-3*e+3*t-2*o-s;n=2*e-2*t+o+s}return{initCatmullRom:function initCatmullRom(t,a,r,i,n){e(a,r,n*(r-t),n*(i-a))},initNonuniformCatmullRom:function initNonuniformCatmullRom(t,a,r,i,n,o,s){var l=(a-t)/n-(r-t)/(n+o)+(r-a)/o,d=(r-a)/o-(i-a)/(o+s)+(i-r)/s;l*=o;d*=o;e(a,r,l,d)},calc:function calc(e){var t=e*e;return a+r*e+i*t+n*(t*e)}}}var qc=new Po,Xc=new Nt,Yc=new Nt,Zc=new Nt,Jc=function(e){_inherits(t,e);var a=_createSuper(t);function t(){var e,r=0<arguments.length&&arguments[0]!==void 0?arguments[0]:[],i=1<arguments.length&&arguments[1]!==void 0?arguments[1]:!1,n=2<arguments.length&&arguments[2]!==void 0?arguments[2]:"centripetal",o=3<arguments.length&&arguments[3]!==void 0?arguments[3]:.5;_classCallCheck2(this,t);e=a.call(this);e.type="CatmullRomCurve3";e.points=r;e.closed=i;e.curveType=n;e.tension=o;return e}_createClass2(t,[{key:"getPoint",value:function getPoint(e){var t=1<arguments.length&&arguments[1]!==void 0?arguments[1]:new Po,a=t,r=this.points,i=r.length,n=(i-(this.closed?0:1))*e,o=Math.floor(n),s=n-o;if(this.closed){o+=0<o?0:(Math.floor(Math.abs(o)/i)+1)*i}else if(0===s&&o===i-1){o=i-2;s=1}var l,d;if(this.closed||0<o){l=r[(o-1)%i]}else{qc.subVectors(r[0],r[1]).add(r[0]);l=qc}var c=r[o%i],u=r[(o+1)%i];if(this.closed||o+2<i){d=r[(o+2)%i]}else{qc.subVectors(r[i-1],r[i-2]).add(r[i-1]);d=qc}if("centripetal"===this.curveType||"chordal"===this.curveType){var p="chordal"===this.curveType?.5:.25,m=Math.pow(l.distanceToSquared(c),p),g=Math.pow(c.distanceToSquared(u),p),f=Math.pow(u.distanceToSquared(d),p);if(1e-4>g)g=1;if(1e-4>m)m=g;if(1e-4>f)f=g;Xc.initNonuniformCatmullRom(l.x,c.x,u.x,d.x,m,g,f);Yc.initNonuniformCatmullRom(l.y,c.y,u.y,d.y,m,g,f);Zc.initNonuniformCatmullRom(l.z,c.z,u.z,d.z,m,g,f)}else if("catmullrom"===this.curveType){Xc.initCatmullRom(l.x,c.x,u.x,d.x,this.tension);Yc.initCatmullRom(l.y,c.y,u.y,d.y,this.tension);Zc.initCatmullRom(l.z,c.z,u.z,d.z,this.tension)}a.set(Xc.calc(s),Yc.calc(s),Zc.calc(s));return a}},{key:"copy",value:function copy(e){_get(_getPrototypeOf(t.prototype),"copy",this).call(this,e);this.points=[];for(var a=0,r=e.points.length,i;a<r;a++){i=e.points[a];this.points.push(i.clone())}this.closed=e.closed;this.curveType=e.curveType;this.tension=e.tension;return this}},{key:"toJSON",value:function toJSON(){var e=_get(_getPrototypeOf(t.prototype),"toJSON",this).call(this);e.points=[];for(var a=0,r=this.points.length,i;a<r;a++){i=this.points[a];e.points.push(i.toArray())}e.closed=this.closed;e.curveType=this.curveType;e.tension=this.tension;return e}},{key:"fromJSON",value:function fromJSON(e){_get(_getPrototypeOf(t.prototype),"fromJSON",this).call(this,e);this.points=[];for(var a=0,r=e.points.length,i;a<r;a++){i=e.points[a];this.points.push(new Po().fromArray(i))}this.closed=e.closed;this.curveType=e.curveType;this.tension=e.tension;return this}}]);return t}(Vc);Jc.prototype.isCatmullRomCurve3=!0;function Ot(e,t,a,r,i){var n=.5*(r-t),o=.5*(i-a),s=e*e;return(2*a-2*r+n+o)*(e*s)+(-3*a+3*r-2*n-o)*s+n*e+a}function Ft(e,t){var a=1-e;return a*a*t}function Ut(e,t){return 2*(1-e)*e*t}function Bt(e,t){return e*e*t}function Ht(e,t,a,r){return Ft(e,t)+Ut(e,a)+Bt(e,r)}function Gt(e,t){var a=1-e;return a*a*a*t}function Vt(e,t){var a=1-e;return 3*a*a*e*t}function Wt(e,t){return 3*(1-e)*e*e*t}function jt(e,t){return e*e*e*t}function qt(e,t,a,r,i){return Gt(e,t)+Vt(e,a)+Wt(e,r)+jt(e,i)}var Qc=function(e){_inherits(t,e);var a=_createSuper(t);function t(){var e,r=0<arguments.length&&arguments[0]!==void 0?arguments[0]:new bo,i=1<arguments.length&&arguments[1]!==void 0?arguments[1]:new bo,n=2<arguments.length&&arguments[2]!==void 0?arguments[2]:new bo,o=3<arguments.length&&arguments[3]!==void 0?arguments[3]:new bo;_classCallCheck2(this,t);e=a.call(this);e.type="CubicBezierCurve";e.v0=r;e.v1=i;e.v2=n;e.v3=o;return e}_createClass2(t,[{key:"getPoint",value:function getPoint(e){var t=1<arguments.length&&arguments[1]!==void 0?arguments[1]:new bo,a=t,r=this.v0,i=this.v1,n=this.v2,o=this.v3;a.set(qt(e,r.x,i.x,n.x,o.x),qt(e,r.y,i.y,n.y,o.y));return a}},{key:"copy",value:function copy(e){_get(_getPrototypeOf(t.prototype),"copy",this).call(this,e);this.v0.copy(e.v0);this.v1.copy(e.v1);this.v2.copy(e.v2);this.v3.copy(e.v3);return this}},{key:"toJSON",value:function toJSON(){var e=_get(_getPrototypeOf(t.prototype),"toJSON",this).call(this);e.v0=this.v0.toArray();e.v1=this.v1.toArray();e.v2=this.v2.toArray();e.v3=this.v3.toArray();return e}},{key:"fromJSON",value:function fromJSON(e){_get(_getPrototypeOf(t.prototype),"fromJSON",this).call(this,e);this.v0.fromArray(e.v0);this.v1.fromArray(e.v1);this.v2.fromArray(e.v2);this.v3.fromArray(e.v3);return this}}]);return t}(Vc);Qc.prototype.isCubicBezierCurve=!0;var Kc=function(e){_inherits(t,e);var a=_createSuper(t);function t(){var e,r=0<arguments.length&&arguments[0]!==void 0?arguments[0]:new Po,i=1<arguments.length&&arguments[1]!==void 0?arguments[1]:new Po,n=2<arguments.length&&arguments[2]!==void 0?arguments[2]:new Po,o=3<arguments.length&&arguments[3]!==void 0?arguments[3]:new Po;_classCallCheck2(this,t);e=a.call(this);e.type="CubicBezierCurve3";e.v0=r;e.v1=i;e.v2=n;e.v3=o;return e}_createClass2(t,[{key:"getPoint",value:function getPoint(e){var t=1<arguments.length&&arguments[1]!==void 0?arguments[1]:new Po,a=t,r=this.v0,i=this.v1,n=this.v2,o=this.v3;a.set(qt(e,r.x,i.x,n.x,o.x),qt(e,r.y,i.y,n.y,o.y),qt(e,r.z,i.z,n.z,o.z));return a}},{key:"copy",value:function copy(e){_get(_getPrototypeOf(t.prototype),"copy",this).call(this,e);this.v0.copy(e.v0);this.v1.copy(e.v1);this.v2.copy(e.v2);this.v3.copy(e.v3);return this}},{key:"toJSON",value:function toJSON(){var e=_get(_getPrototypeOf(t.prototype),"toJSON",this).call(this);e.v0=this.v0.toArray();e.v1=this.v1.toArray();e.v2=this.v2.toArray();e.v3=this.v3.toArray();return e}},{key:"fromJSON",value:function fromJSON(e){_get(_getPrototypeOf(t.prototype),"fromJSON",this).call(this,e);this.v0.fromArray(e.v0);this.v1.fromArray(e.v1);this.v2.fromArray(e.v2);this.v3.fromArray(e.v3);return this}}]);return t}(Vc);Kc.prototype.isCubicBezierCurve3=!0;var $c=function(e){_inherits(t,e);var a=_createSuper(t);function t(){var e,r=0<arguments.length&&arguments[0]!==void 0?arguments[0]:new bo,i=1<arguments.length&&arguments[1]!==void 0?arguments[1]:new bo;_classCallCheck2(this,t);e=a.call(this);e.type="LineCurve";e.v1=r;e.v2=i;return e}_createClass2(t,[{key:"getPoint",value:function getPoint(e){var t=1<arguments.length&&arguments[1]!==void 0?arguments[1]:new bo,a=t;if(1===e){a.copy(this.v2)}else{a.copy(this.v2).sub(this.v1);a.multiplyScalar(e).add(this.v1)}return a}},{key:"getPointAt",value:function getPointAt(e,t){return this.getPoint(e,t)}},{key:"getTangent",value:function getTangent(e,t){var a=t||new bo;a.copy(this.v2).sub(this.v1).normalize();return a}},{key:"copy",value:function copy(e){_get(_getPrototypeOf(t.prototype),"copy",this).call(this,e);this.v1.copy(e.v1);this.v2.copy(e.v2);return this}},{key:"toJSON",value:function toJSON(){var e=_get(_getPrototypeOf(t.prototype),"toJSON",this).call(this);e.v1=this.v1.toArray();e.v2=this.v2.toArray();return e}},{key:"fromJSON",value:function fromJSON(e){_get(_getPrototypeOf(t.prototype),"fromJSON",this).call(this,e);this.v1.fromArray(e.v1);this.v2.fromArray(e.v2);return this}}]);return t}(Vc);$c.prototype.isLineCurve=!0;var eu=function(e){_inherits(t,e);var a=_createSuper(t);function t(){var e,r=0<arguments.length&&arguments[0]!==void 0?arguments[0]:new Po,i=1<arguments.length&&arguments[1]!==void 0?arguments[1]:new Po;_classCallCheck2(this,t);e=a.call(this);e.type="LineCurve3";e.isLineCurve3=!0;e.v1=r;e.v2=i;return e}_createClass2(t,[{key:"getPoint",value:function getPoint(e){var t=1<arguments.length&&arguments[1]!==void 0?arguments[1]:new Po,a=t;if(1===e){a.copy(this.v2)}else{a.copy(this.v2).sub(this.v1);a.multiplyScalar(e).add(this.v1)}return a}},{key:"getPointAt",value:function getPointAt(e,t){return this.getPoint(e,t)}},{key:"copy",value:function copy(e){_get(_getPrototypeOf(t.prototype),"copy",this).call(this,e);this.v1.copy(e.v1);this.v2.copy(e.v2);return this}},{key:"toJSON",value:function toJSON(){var e=_get(_getPrototypeOf(t.prototype),"toJSON",this).call(this);e.v1=this.v1.toArray();e.v2=this.v2.toArray();return e}},{key:"fromJSON",value:function fromJSON(e){_get(_getPrototypeOf(t.prototype),"fromJSON",this).call(this,e);this.v1.fromArray(e.v1);this.v2.fromArray(e.v2);return this}}]);return t}(Vc),tu=function(e){_inherits(t,e);var a=_createSuper(t);function t(){var e,r=0<arguments.length&&arguments[0]!==void 0?arguments[0]:new bo,i=1<arguments.length&&arguments[1]!==void 0?arguments[1]:new bo,n=2<arguments.length&&arguments[2]!==void 0?arguments[2]:new bo;_classCallCheck2(this,t);e=a.call(this);e.type="QuadraticBezierCurve";e.v0=r;e.v1=i;e.v2=n;return e}_createClass2(t,[{key:"getPoint",value:function getPoint(e){var t=1<arguments.length&&arguments[1]!==void 0?arguments[1]:new bo,a=t,r=this.v0,i=this.v1,n=this.v2;a.set(Ht(e,r.x,i.x,n.x),Ht(e,r.y,i.y,n.y));return a}},{key:"copy",value:function copy(e){_get(_getPrototypeOf(t.prototype),"copy",this).call(this,e);this.v0.copy(e.v0);this.v1.copy(e.v1);this.v2.copy(e.v2);return this}},{key:"toJSON",value:function toJSON(){var e=_get(_getPrototypeOf(t.prototype),"toJSON",this).call(this);e.v0=this.v0.toArray();e.v1=this.v1.toArray();e.v2=this.v2.toArray();return e}},{key:"fromJSON",value:function fromJSON(e){_get(_getPrototypeOf(t.prototype),"fromJSON",this).call(this,e);this.v0.fromArray(e.v0);this.v1.fromArray(e.v1);this.v2.fromArray(e.v2);return this}}]);return t}(Vc);tu.prototype.isQuadraticBezierCurve=!0;var au=function(e){_inherits(t,e);var a=_createSuper(t);function t(){var e,r=0<arguments.length&&arguments[0]!==void 0?arguments[0]:new Po,i=1<arguments.length&&arguments[1]!==void 0?arguments[1]:new Po,n=2<arguments.length&&arguments[2]!==void 0?arguments[2]:new Po;_classCallCheck2(this,t);e=a.call(this);e.type="QuadraticBezierCurve3";e.v0=r;e.v1=i;e.v2=n;return e}_createClass2(t,[{key:"getPoint",value:function getPoint(e){var t=1<arguments.length&&arguments[1]!==void 0?arguments[1]:new Po,a=t,r=this.v0,i=this.v1,n=this.v2;a.set(Ht(e,r.x,i.x,n.x),Ht(e,r.y,i.y,n.y),Ht(e,r.z,i.z,n.z));return a}},{key:"copy",value:function copy(e){_get(_getPrototypeOf(t.prototype),"copy",this).call(this,e);this.v0.copy(e.v0);this.v1.copy(e.v1);this.v2.copy(e.v2);return this}},{key:"toJSON",value:function toJSON(){var e=_get(_getPrototypeOf(t.prototype),"toJSON",this).call(this);e.v0=this.v0.toArray();e.v1=this.v1.toArray();e.v2=this.v2.toArray();return e}},{key:"fromJSON",value:function fromJSON(e){_get(_getPrototypeOf(t.prototype),"fromJSON",this).call(this,e);this.v0.fromArray(e.v0);this.v1.fromArray(e.v1);this.v2.fromArray(e.v2);return this}}]);return t}(Vc);au.prototype.isQuadraticBezierCurve3=!0;var ru=function(e){_inherits(t,e);var a=_createSuper(t);function t(){var e,r=0<arguments.length&&arguments[0]!==void 0?arguments[0]:[];_classCallCheck2(this,t);e=a.call(this);e.type="SplineCurve";e.points=r;return e}_createClass2(t,[{key:"getPoint",value:function getPoint(e){var t=1<arguments.length&&arguments[1]!==void 0?arguments[1]:new bo,a=t,r=this.points,i=(r.length-1)*e,n=Math.floor(i),o=i-n,s=r[0===n?n:n-1],l=r[n],d=r[n>r.length-2?r.length-1:n+1],c=r[n>r.length-3?r.length-1:n+2];a.set(Ot(o,s.x,l.x,d.x,c.x),Ot(o,s.y,l.y,d.y,c.y));return a}},{key:"copy",value:function copy(e){_get(_getPrototypeOf(t.prototype),"copy",this).call(this,e);this.points=[];for(var a=0,r=e.points.length,i;a<r;a++){i=e.points[a];this.points.push(i.clone())}return this}},{key:"toJSON",value:function toJSON(){var e=_get(_getPrototypeOf(t.prototype),"toJSON",this).call(this);e.points=[];for(var a=0,r=this.points.length,i;a<r;a++){i=this.points[a];e.points.push(i.toArray())}return e}},{key:"fromJSON",value:function fromJSON(e){_get(_getPrototypeOf(t.prototype),"fromJSON",this).call(this,e);this.points=[];for(var a=0,r=e.points.length,i;a<r;a++){i=e.points[a];this.points.push(new bo().fromArray(i))}return this}}]);return t}(Vc);ru.prototype.isSplineCurve=!0;var iu=Object.freeze({__proto__:null,ArcCurve:jc,CatmullRomCurve3:Jc,CubicBezierCurve:Qc,CubicBezierCurve3:Kc,EllipseCurve:Wc,LineCurve:$c,LineCurve3:eu,QuadraticBezierCurve:tu,QuadraticBezierCurve3:au,SplineCurve:ru}),nu=function(e){_inherits(t,e);var a=_createSuper(t);function t(){var e;_classCallCheck2(this,t);e=a.call(this);e.type="CurvePath";e.curves=[];e.autoClose=!1;return e}_createClass2(t,[{key:"add",value:function add(e){this.curves.push(e)}},{key:"closePath",value:function closePath(){var e=this.curves[0].getPoint(0),t=this.curves[this.curves.length-1].getPoint(1);if(!e.equals(t)){this.curves.push(new $c(t,e))}}},{key:"getPoint",value:function getPoint(e,t){var a=e*this.getLength(),r=this.getCurveLengths(),n=0;while(n<r.length){if(r[n]>=a){var o=r[n]-a,s=this.curves[n],l=s.getLength(),d=0===l?0:1-o/l;return s.getPointAt(d,t)}n++}return null}},{key:"getLength",value:function getLength(){var e=this.getCurveLengths();return e[e.length-1]}},{key:"updateArcLengths",value:function updateArcLengths(){this.needsUpdate=!0;this.cacheLengths=null;this.getCurveLengths()}},{key:"getCurveLengths",value:function getCurveLengths(){if(this.cacheLengths&&this.cacheLengths.length===this.curves.length){return this.cacheLengths}for(var e=[],t=0,a=0,r=this.curves.length;a<r;a++){t+=this.curves[a].getLength();e.push(t)}this.cacheLengths=e;return e}},{key:"getSpacedPoints",value:function getSpacedPoints(){for(var e=0<arguments.length&&arguments[0]!==void 0?arguments[0]:40,t=[],a=0;a<=e;a++){t.push(this.getPoint(a/e))}if(this.autoClose){t.push(t[0])}return t}},{key:"getPoints",value:function getPoints(){for(var e=0<arguments.length&&arguments[0]!==void 0?arguments[0]:12,t=[],a,r=0,i=this.curves;r<i.length;r++){for(var n=i[r],o=n&&n.isEllipseCurve?2*e:n&&(n.isLineCurve||n.isLineCurve3)?1:n&&n.isSplineCurve?e*n.points.length:e,s=n.getPoints(o),l=0,d;l<s.length;l++){d=s[l];if(a&&a.equals(d))continue;t.push(d);a=d}}if(this.autoClose&&1<t.length&&!t[t.length-1].equals(t[0])){t.push(t[0])}return t}},{key:"copy",value:function copy(e){_get(_getPrototypeOf(t.prototype),"copy",this).call(this,e);this.curves=[];for(var a=0,r=e.curves.length,i;a<r;a++){i=e.curves[a];this.curves.push(i.clone())}this.autoClose=e.autoClose;return this}},{key:"toJSON",value:function toJSON(){var e=_get(_getPrototypeOf(t.prototype),"toJSON",this).call(this);e.autoClose=this.autoClose;e.curves=[];for(var a=0,r=this.curves.length,i;a<r;a++){i=this.curves[a];e.curves.push(i.toJSON())}return e}},{key:"fromJSON",value:function fromJSON(e){_get(_getPrototypeOf(t.prototype),"fromJSON",this).call(this,e);this.autoClose=e.autoClose;this.curves=[];for(var a=0,r=e.curves.length,i;a<r;a++){i=e.curves[a];this.curves.push(new iu[i.type]().fromJSON(i))}return this}}]);return t}(Vc),ou=function(e){_inherits(t,e);var a=_createSuper(t);function t(e){var r;_classCallCheck2(this,t);r=a.call(this);r.type="Path";r.currentPoint=new bo;if(e){r.setFromPoints(e)}return r}_createClass2(t,[{key:"setFromPoints",value:function setFromPoints(e){this.moveTo(e[0].x,e[0].y);for(var t=1,a=e.length;t<a;t++){this.lineTo(e[t].x,e[t].y)}return this}},{key:"moveTo",value:function moveTo(e,t){this.currentPoint.set(e,t);return this}},{key:"lineTo",value:function lineTo(e,t){var a=new $c(this.currentPoint.clone(),new bo(e,t));this.curves.push(a);this.currentPoint.set(e,t);return this}},{key:"quadraticCurveTo",value:function quadraticCurveTo(e,t,a,r){var i=new tu(this.currentPoint.clone(),new bo(e,t),new bo(a,r));this.curves.push(i);this.currentPoint.set(a,r);return this}},{key:"bezierCurveTo",value:function bezierCurveTo(e,t,a,r,i,n){var o=new Qc(this.currentPoint.clone(),new bo(e,t),new bo(a,r),new bo(i,n));this.curves.push(o);this.currentPoint.set(i,n);return this}},{key:"splineThru",value:function splineThru(e){var t=[this.currentPoint.clone()].concat(e),a=new ru(t);this.curves.push(a);this.currentPoint.copy(e[e.length-1]);return this}},{key:"arc",value:function arc(e,t,a,r,i,n){var o=this.currentPoint.x,s=this.currentPoint.y;this.absarc(e+o,t+s,a,r,i,n);return this}},{key:"absarc",value:function absarc(e,t,a,r,i,n){this.absellipse(e,t,a,a,r,i,n);return this}},{key:"ellipse",value:function ellipse(e,t,a,r,i,n,o,s){var l=this.currentPoint.x,d=this.currentPoint.y;this.absellipse(e+l,t+d,a,r,i,n,o,s);return this}},{key:"absellipse",value:function absellipse(e,t,a,r,i,n,o,s){var l=new Wc(e,t,a,r,i,n,o,s);if(0<this.curves.length){var c=l.getPoint(0);if(!c.equals(this.currentPoint)){this.lineTo(c.x,c.y)}}this.curves.push(l);var d=l.getPoint(1);this.currentPoint.copy(d);return this}},{key:"copy",value:function copy(e){_get(_getPrototypeOf(t.prototype),"copy",this).call(this,e);this.currentPoint.copy(e.currentPoint);return this}},{key:"toJSON",value:function toJSON(){var e=_get(_getPrototypeOf(t.prototype),"toJSON",this).call(this);e.currentPoint=this.currentPoint.toArray();return e}},{key:"fromJSON",value:function fromJSON(e){_get(_getPrototypeOf(t.prototype),"fromJSON",this).call(this,e);this.currentPoint.fromArray(e.currentPoint);return this}}]);return t}(nu),su=function(t){_inherits(a,t);var r=_createSuper(a);function a(t){var i;_classCallCheck2(this,a);i=r.call(this,t);i.uuid=e();i.type="Shape";i.holes=[];return i}_createClass2(a,[{key:"getPointsHoles",value:function getPointsHoles(e){for(var t=[],a=0,r=this.holes.length;a<r;a++){t[a]=this.holes[a].getPoints(e)}return t}},{key:"extractPoints",value:function extractPoints(e){return{shape:this.getPoints(e),holes:this.getPointsHoles(e)}}},{key:"copy",value:function copy(e){_get(_getPrototypeOf(a.prototype),"copy",this).call(this,e);this.holes=[];for(var t=0,r=e.holes.length,i;t<r;t++){i=e.holes[t];this.holes.push(i.clone())}return this}},{key:"toJSON",value:function toJSON(){var e=_get(_getPrototypeOf(a.prototype),"toJSON",this).call(this);e.uuid=this.uuid;e.holes=[];for(var t=0,r=this.holes.length,i;t<r;t++){i=this.holes[t];e.holes.push(i.toJSON())}return e}},{key:"fromJSON",value:function fromJSON(e){_get(_getPrototypeOf(a.prototype),"fromJSON",this).call(this,e);this.uuid=e.uuid;this.holes=[];for(var t=0,r=e.holes.length,i;t<r;t++){i=e.holes[t];this.holes.push(new ou().fromJSON(i))}return this}}]);return a}(ou),lu={triangulate:function triangulate(e,t){var a=2<arguments.length&&arguments[2]!==void 0?arguments[2]:2,r=t&&t.length,i=r?t[0]*a:e.length,n=Xt(e,0,i,a,!0),o=[];if(!n||n.next===n.prev)return o;var s,l,d,c,u,p,m;if(r)n=ea(e,t,n,a);if(e.length>80*a){s=d=e[0];l=c=e[1];for(var g=a;g<i;g+=a){u=e[g];p=e[g+1];if(u<s)s=u;if(p<l)l=p;if(u>d)d=u;if(p>c)c=p}m=Math.max(d-s,c-l);m=0!==m?1/m:0}Zt(n,o,a,s,l,m);return o}};function Xt(e,t,a,r,n){var o,s;if(n===0<Ta(e,t,a,r)){for(o=t;o<a;o+=r){s=ba(o,e[o],e[o+1],s)}}else{for(o=a-r;o>=t;o-=r){s=ba(o,e[o],e[o+1],s)}}if(s&&pa(s,s.next)){Sa(s);s=s.next}return s}function Yt(e,t){if(!e)return e;if(!t)t=e;var a=e,r;do{r=!1;if(!a.steiner&&(pa(a,a.next)||0===ua(a.prev,a,a.next))){Sa(a);a=t=a.prev;if(a===a.next)break;r=!0}else{a=a.next}}while(r||a!==t);return t}function Zt(e,t,a,r,i,n,o){if(!e)return;if(!o&&n)na(e,r,i,n);var s=e,l,d;while(e.prev!==e.next){l=e.prev;d=e.next;if(n?Qt(e,r,i,n):Jt(e)){t.push(l.i/a);t.push(e.i/a);t.push(d.i/a);Sa(e);e=d.next;s=d.next;continue}e=d;if(e===s){if(!o){Zt(Yt(e),t,a,r,i,n,1)}else if(1===o){e=Kt(Yt(e),t,a);Zt(e,t,a,r,i,n,2)}else if(2===o){$t(e,t,a,r,i,n)}break}}}function Jt(e){var t=e.prev,a=e,r=e.next;if(0<=ua(t,a,r))return!1;var i=e.next.next;while(i!==e.prev){if(da(t.x,t.y,a.x,a.y,r.x,r.y,i.x,i.y)&&0<=ua(i.prev,i,i.next))return!1;i=i.next}return!0}function Qt(e,t,r,i){var o=e.prev,a=e,s=e.next;if(0<=ua(o,a,s))return!1;var l=o.x<a.x?o.x<s.x?o.x:s.x:a.x<s.x?a.x:s.x,d=o.y<a.y?o.y<s.y?o.y:s.y:a.y<s.y?a.y:s.y,c=o.x>a.x?o.x>s.x?o.x:s.x:a.x>s.x?a.x:s.x,u=o.y>a.y?o.y>s.y?o.y:s.y:a.y>s.y?a.y:s.y,m=sa(l,d,t,r,i),g=sa(c,u,t,r,i),f=e.prevZ,h=e.nextZ;while(f&&f.z>=m&&h&&h.z<=g){if(f!==e.prev&&f!==e.next&&da(o.x,o.y,a.x,a.y,s.x,s.y,f.x,f.y)&&0<=ua(f.prev,f,f.next))return!1;f=f.prevZ;if(h!==e.prev&&h!==e.next&&da(o.x,o.y,a.x,a.y,s.x,s.y,h.x,h.y)&&0<=ua(h.prev,h,h.next))return!1;h=h.nextZ}while(f&&f.z>=m){if(f!==e.prev&&f!==e.next&&da(o.x,o.y,a.x,a.y,s.x,s.y,f.x,f.y)&&0<=ua(f.prev,f,f.next))return!1;f=f.prevZ}while(h&&h.z<=g){if(h!==e.prev&&h!==e.next&&da(o.x,o.y,a.x,a.y,s.x,s.y,h.x,h.y)&&0<=ua(h.prev,h,h.next))return!1;h=h.nextZ}return!0}function Kt(e,t,r){var i=e;do{var n=i.prev,a=i.next.next;if(!pa(n,a)&&ma(n,i,i.next,a)&&va(n,a)&&va(a,n)){t.push(n.i/r);t.push(i.i/r);t.push(a.i/r);Sa(i);Sa(i.next);i=e=a}i=i.next}while(i!==e);return Yt(i)}function $t(e,t,r,i,n,o){var s=e;do{var l=s.next.next;while(l!==s.prev){if(s.i!==l.i&&ca(s,l)){var d=xa(s,l);s=Yt(s,s.next);d=Yt(d,d.next);Zt(s,t,r,i,n,o);Zt(d,t,r,i,n,o);return}l=l.next}s=s.next}while(s!==e)}function ea(e,t,a,r){var n=[],o,s,l,d,c;for(o=0,s=t.length;o<s;o++){l=t[o]*r;d=o<s-1?t[o+1]*r:e.length;c=Xt(e,l,d,r,!1);if(c===c.next)c.steiner=!0;n.push(la(c))}n.sort(ta);for(o=0;o<n.length;o++){aa(n[o],a);a=Yt(a,a.next)}return a}function ta(e,t){return e.x-t.x}function aa(e,t){t=ra(e,t);if(t){var a=xa(t,e);Yt(t,t.next);Yt(a,a.next)}}function ra(e,t){var a=t,r=e.x,i=e.y,n=-Infinity,o;do{if(i<=a.y&&i>=a.next.y&&a.next.y!==a.y){var g=a.x+(i-a.y)*(a.next.x-a.x)/(a.next.y-a.y);if(g<=r&&g>n){n=g;if(g===r){if(i===a.y)return a;if(i===a.next.y)return a.next}o=a.x<a.next.x?a:a.next}}a=a.next}while(a!==t);if(!o)return null;if(r===n)return o;var s=o,l=o.x,d=o.y,c=1/0,u;a=o;do{if(r>=a.x&&a.x>=l&&r!==a.x&&da(i<d?r:n,i,l,d,i<d?n:r,i,a.x,a.y)){u=Math.abs(i-a.y)/(r-a.x);if(va(a,e)&&(u<c||u===c&&(a.x>o.x||a.x===o.x&&ia(o,a)))){o=a;c=u}}a=a.next}while(a!==s);return o}function ia(e,t){return 0>ua(e.prev,e,t.prev)&&0>ua(t.next,e,e.next)}function na(e,t,a,r){var i=e;do{if(null===i.z)i.z=sa(i.x,i.y,t,a,r);i.prevZ=i.prev;i.nextZ=i.next;i=i.next}while(i!==e);i.prevZ.nextZ=null;i.prevZ=null;oa(i)}function oa(t){var a,r,n,o,s,l,d,c,u=1;do{r=t;t=null;s=null;l=0;while(r){l++;n=r;d=0;for(a=0;a<u;a++){d++;n=n.nextZ;if(!n)break}c=u;while(0<d||0<c&&n){if(0!==d&&(0===c||!n||r.z<=n.z)){o=r;r=r.nextZ;d--}else{o=n;n=n.nextZ;c--}if(s)s.nextZ=o;else t=o;o.prevZ=s;s=o}r=n}s.nextZ=null;u*=2}while(1<l);return t}function sa(e,t,a,r,i){e=32767*(e-a)*i;t=32767*(t-r)*i;e=16711935&(e|e<<8);e=252645135&(e|e<<4);e=858993459&(e|e<<2);e=1431655765&(e|e<<1);t=16711935&(t|t<<8);t=252645135&(t|t<<4);t=858993459&(t|t<<2);t=1431655765&(t|t<<1);return e|t<<1}function la(e){var t=e,a=e;do{if(t.x<a.x||t.x===a.x&&t.y<a.y)a=t;t=t.next}while(t!==e);return a}function da(e,t,a,r,i,n,o,s){return 0<=(i-o)*(t-s)-(e-o)*(n-s)&&0<=(e-o)*(r-s)-(a-o)*(t-s)&&0<=(a-o)*(n-s)-(i-o)*(r-s)}function ca(e,t){return e.next.i!==t.i&&e.prev.i!==t.i&&!ha(e,t)&&(va(e,t)&&va(t,e)&&ya(e,t)&&(ua(e.prev,e,t.prev)||ua(e,t.prev,t))||pa(e,t)&&0<ua(e.prev,e,e.next)&&0<ua(t.prev,t,t.next))}function ua(e,t,a){return(t.y-e.y)*(a.x-t.x)-(t.x-e.x)*(a.y-t.y)}function pa(e,t){return e.x===t.x&&e.y===t.y}function ma(e,t,a,r){var i=fa(ua(e,t,a)),n=fa(ua(e,t,r)),o=fa(ua(a,r,e)),s=fa(ua(a,r,t));if(i!==n&&o!==s)return!0;if(0===i&&ga(e,a,t))return!0;if(0===n&&ga(e,r,t))return!0;if(0===o&&ga(a,e,r))return!0;if(0===s&&ga(a,t,r))return!0;return!1}function ga(e,t,a){return t.x<=Math.max(e.x,a.x)&&t.x>=Math.min(e.x,a.x)&&t.y<=Math.max(e.y,a.y)&&t.y>=Math.min(e.y,a.y)}function fa(e){return 0<e?1:0>e?-1:0}function ha(e,t){var a=e;do{if(a.i!==e.i&&a.next.i!==e.i&&a.i!==t.i&&a.next.i!==t.i&&ma(a,a.next,e,t))return!0;a=a.next}while(a!==e);return!1}function va(e,t){return 0>ua(e.prev,e,e.next)?0<=ua(e,t,e.next)&&0<=ua(e,e.prev,t):0>ua(e,t,e.prev)||0>ua(e,e.next,t)}function ya(e,t){var a=e,r=!1,i=(e.x+t.x)/2,n=(e.y+t.y)/2;do{if(a.y>n!=a.next.y>n&&a.next.y!==a.y&&i<(a.next.x-a.x)*(n-a.y)/(a.next.y-a.y)+a.x)r=!r;a=a.next}while(a!==e);return r}function xa(e,t){var a=new Ma(e.i,e.x,e.y),r=new Ma(t.i,t.x,t.y),i=e.next,n=t.prev;e.next=t;t.prev=e;a.next=i;i.prev=a;r.next=a;a.prev=r;n.next=r;r.prev=n;return r}function ba(e,t,a,r){var i=new Ma(e,t,a);if(!r){i.prev=i;i.next=i}else{i.next=r.next;i.prev=r;r.next.prev=i;r.next=i}return i}function Sa(e){e.next.prev=e.prev;e.prev.next=e.next;if(e.prevZ)e.prevZ.nextZ=e.nextZ;if(e.nextZ)e.nextZ.prevZ=e.prevZ}function Ma(e,t,a){this.i=e;this.x=t;this.y=a;this.prev=null;this.next=null;this.z=null;this.prevZ=null;this.nextZ=null;this.steiner=!1}function Ta(e,t,a,r){for(var i=0,n=t,o=a-r;n<a;n+=r){i+=(e[o]-e[n])*(e[n+1]+e[o+1]);o=n}return i}var du=function(){function e(){_classCallCheck2(this,e)}_createClass2(e,null,[{key:"area",value:function(e){for(var t=e.length,r=0,i=t-1,n=0;n<t;i=n++){r+=e[i].x*e[n].y-e[n].x*e[i].y}return .5*r}},{key:"isClockWise",value:function isClockWise(t){return 0>e.area(t)}},{key:"triangulateShape",value:function triangulateShape(e,t){var a=[],r=[],i=[];Ea(e);wa(a,e);var n=e.length;t.forEach(Ea);for(var l=0;l<t.length;l++){r.push(n);n+=t[l].length;wa(a,t[l])}for(var o=lu.triangulate(a,r),s=0;s<o.length;s+=3){i.push(o.slice(s,s+3))}return i}}]);return e}();function Ea(e){var t=e.length;if(2<t&&e[t-1].equals(e[0])){e.pop()}}function wa(e,t){for(var a=0;a<t.length;a++){e.push(t[a].x);e.push(t[a].y)}}var cu=function(e){_inherits(t,e);var a=_createSuper(t);function t(){var r,i=0<arguments.length&&arguments[0]!==void 0?arguments[0]:new su([new bo(.5,.5),new bo(-.5,.5),new bo(-.5,-.5),new bo(.5,-.5)]),n=1<arguments.length&&arguments[1]!==void 0?arguments[1]:{};_classCallCheck2(this,t);r=a.call(this);r.type="ExtrudeGeometry";r.parameters={shapes:i,options:n};i=Array.isArray(i)?i:[i];for(var o=_assertThisInitialized(r),s=[],d=[],c=0,u=i.length,l;c<u;c++){l=i[c];e(l)}r.setAttribute("position",new il(s,3));r.setAttribute("uv",new il(d,2));r.computeVertexNormals();function e(e){var f=[],v=n.curveSegments!==void 0?n.curveSegments:12,y=n.steps!==void 0?n.steps:1,_=n.depth!==void 0?n.depth:1,x=n.bevelEnabled!==void 0?n.bevelEnabled:!0,S=n.bevelThickness!==void 0?n.bevelThickness:.2,M=n.bevelSize!==void 0?n.bevelSize:S-.1,T=n.bevelOffset!==void 0?n.bevelOffset:0,E=n.bevelSegments!==void 0?n.bevelSegments:3,w=n.extrudePath,A=n.UVGenerator!==void 0?n.UVGenerator:uu;if(n.amount!==void 0){console.warn("THREE.ExtrudeBufferGeometry: amount has been renamed to depth.");_=n.amount}var C,L=!1,R,P,D,I;if(w){C=w.getSpacedPoints(y);L=!0;x=!1;R=w.computeFrenetFrames(y,!1);P=new Po;D=new Po;I=new Po}if(!x){E=0;S=0;M=0;T=0}var N=e.extractPoints(v),O=N.shape,F=N.holes,U=!du.isClockWise(O);if(U){O=O.reverse();for(var ye=0,h=F.length,_e;ye<h;ye++){_e=F[ye];if(du.isClockWise(_e)){F[ye]=_e.reverse()}}}for(var B=du.triangulateShape(O,F),H=O,G=0,V=F.length,W;G<V;G++){W=F[G];O=O.concat(W)}function a(e,t,a){if(!t)console.error("THREE.ExtrudeGeometry: vec does not exist");return t.clone().multiplyScalar(a).add(e)}var q=O.length,X=B.length;function r(e,t,a){var r,i,n,o=e.x-t.x,s=e.y-t.y,l=a.x-e.x,d=a.y-e.y,c=o*o+s*s;if(Math.abs(o*d-s*l)>Number.EPSILON){var u=Math.sqrt(c),p=Math.sqrt(l*l+d*d),m=t.x-s/u,g=t.y+o/u,f=a.x-d/p,h=a.y+l/p,v=((f-m)*d-(h-g)*l)/(o*d-s*l);r=m+o*v-e.x;i=g+s*v-e.y;var y=r*r+i*i;if(2>=y){return new bo(r,i)}else{n=Math.sqrt(y/2)}}else{var _=!1;if(o>Number.EPSILON){if(l>Number.EPSILON){_=!0}}else{if(o<-Number.EPSILON){if(l<-Number.EPSILON){_=!0}}else{if(Math.sign(s)===Math.sign(d)){_=!0}}}if(_){r=-s;i=o;n=Math.sqrt(c)}else{r=o;i=s;n=Math.sqrt(c/2)}}return new bo(r/n,i/n)}for(var Y=[],Z=0,J=H.length,Q=J-1,K=Z+1;Z<J;Z++,Q++,K++){if(Q===J)Q=0;if(K===J)K=0;Y[Z]=r(H[Z],H[Q],H[K])}for(var $=[],ee,te=Y.concat(),ae=0,re=F.length,ie;ae<re;ae++){ie=F[ae];ee=[];for(var xe=0,be=ie.length,Se=be-1,Me=xe+1;xe<be;xe++,Se++,Me++){if(Se===be)Se=0;if(Me===be)Me=0;ee[xe]=r(ie[xe],ie[Se],ie[Me])}$.push(ee);te=te.concat(ee)}for(var Te=0;Te<E;Te++){for(var ne=Te/E,t=S*Math.cos(ne*Math.PI/2),z=M*Math.sin(ne*Math.PI/2)+T,oe=0,se=H.length,le;oe<se;oe++){le=a(H[oe],Y[oe],z);c(le.x,le.y,-t)}for(var b=0,Ee=F.length,we;b<Ee;b++){we=F[b];ee=$[b];for(var Ae=0,ke=we.length,Ce;Ae<ke;Ae++){Ce=a(we[Ae],ee[Ae],z);c(Ce.x,Ce.y,-t)}}}for(var de=M+T,ce=0,ue;ce<q;ce++){ue=x?a(O[ce],te[ce],de):O[ce];if(!L){c(ue.x,ue.y,0)}else{D.copy(R.normals[0]).multiplyScalar(ue.x);P.copy(R.binormals[0]).multiplyScalar(ue.y);I.copy(C[0]).add(D).add(P);c(I.x,I.y,I.z)}}for(var Le=1;Le<=y;Le++){for(var Re=0,Pe;Re<q;Re++){Pe=x?a(O[Re],te[Re],de):O[Re];if(!L){c(Pe.x,Pe.y,_/y*Le)}else{D.copy(R.normals[Le]).multiplyScalar(Pe.x);P.copy(R.binormals[Le]).multiplyScalar(Pe.y);I.copy(C[Le]).add(D).add(P);c(I.x,I.y,I.z)}}}for(var De=E-1;0<=De;De--){for(var pe=De/E,me=S*Math.cos(pe*Math.PI/2),ge=M*Math.sin(pe*Math.PI/2)+T,fe=0,he=H.length,ve;fe<he;fe++){ve=a(H[fe],Y[fe],ge);c(ve.x,ve.y,_+me)}for(var Ie=0,ze=F.length,Ne;Ie<ze;Ie++){Ne=F[Ie];ee=$[Ie];for(var Oe=0,Fe=Ne.length,Ue;Oe<Fe;Oe++){Ue=a(Ne[Oe],ee[Oe],ge);if(!L){c(Ue.x,Ue.y,_+me)}else{c(Ue.x,Ue.y+C[y-1].y,C[y-1].x+me)}}}}i();(function(){var e=s.length/3,t=0;l(H,t);t+=H.length;for(var a=0,r=F.length,i;a<r;a++){i=F[a];l(i,t);t+=i.length}o.addGroup(e,s.length/3-e,1)})();function i(){var e=s.length/3;if(x){for(var t=0,a=q*t,r=0,i;r<X;r++){i=B[r];u(i[2]+a,i[1]+a,i[0]+a)}t=y+2*E;a=q*t;for(var n=0,l;n<X;n++){l=B[n];u(l[0]+a,l[1]+a,l[2]+a)}}else{for(var d=0,c;d<X;d++){c=B[d];u(c[2],c[1],c[0])}for(var p=0,m;p<X;p++){m=B[p];u(m[0]+q*y,m[1]+q*y,m[2]+q*y)}}o.addGroup(e,s.length/3-e,0)}function l(e,t){var a=e.length;while(0<=--a){var r=a,n=a-1;if(0>n)n=e.length-1;for(var c=0,u=y+2*E;c<u;c++){var o=q*c,s=q*(c+1),l=t+n+o,d=t+n+s;p(t+r+o,l,d,t+r+s)}}}function c(e,t,a){f.push(e);f.push(t);f.push(a)}function u(e,t,a){m(e);m(t);m(a);var r=s.length/3,i=A.generateTopUV(o,s,r-3,r-2,r-1);g(i[0]);g(i[1]);g(i[2])}function p(e,t,a,r){m(e);m(t);m(r);m(t);m(a);m(r);var i=s.length/3,n=A.generateSideWallUV(o,s,i-6,i-3,i-2,i-1);g(n[0]);g(n[1]);g(n[3]);g(n[1]);g(n[2]);g(n[3])}function m(e){s.push(f[3*e+0]);s.push(f[3*e+1]);s.push(f[3*e+2])}function g(e){d.push(e.x);d.push(e.y)}}return r}_createClass2(t,[{key:"toJSON",value:function toJSON(){var e=_get(_getPrototypeOf(t.prototype),"toJSON",this).call(this),a=this.parameters.shapes,r=this.parameters.options;return Aa(a,r,e)}}],[{key:"fromJSON",value:function fromJSON(e,a){for(var r=[],i=0,n=e.shapes.length,o;i<n;i++){o=a[e.shapes[i]];r.push(o)}var s=e.options.extrudePath;if(s!==void 0){e.options.extrudePath=new iu[s.type]().fromJSON(s)}return new t(r,e.options)}}]);return t}(pl),uu={generateTopUV:function generateTopUV(e,t,a,r,i){var n=t[3*a],o=t[3*a+1],s=t[3*r],l=t[3*r+1],d=t[3*i],c=t[3*i+1];return[new bo(n,o),new bo(s,l),new bo(d,c)]},generateSideWallUV:function generateSideWallUV(e,t,a,r,i,n){var o=t[3*a],s=t[3*a+1],l=t[3*a+2],d=t[3*r],c=t[3*r+1],u=t[3*r+2],p=t[3*i],m=t[3*i+1],g=t[3*i+2],f=t[3*n],h=t[3*n+1],v=t[3*n+2];if(Math.abs(s-c)<Math.abs(o-d)){return[new bo(o,1-l),new bo(d,1-u),new bo(p,1-g),new bo(f,1-v)]}else{return[new bo(s,1-l),new bo(c,1-u),new bo(m,1-g),new bo(h,1-v)]}}};function Aa(e,t,a){a.shapes=[];if(Array.isArray(e)){for(var r=0,i=e.length,n;r<i;r++){n=e[r];a.shapes.push(n.uuid)}}else{a.shapes.push(e.uuid)}if(t.extrudePath!==void 0)a.options.extrudePath=t.extrudePath.toJSON();return a}var pu=function(e){_inherits(t,e);var a=_createSuper(t);function t(){var r,i=0<arguments.length&&arguments[0]!==void 0?arguments[0]:new su([new bo(0,.5),new bo(-.5,-.5),new bo(.5,-.5)]),n=1<arguments.length&&arguments[1]!==void 0?arguments[1]:12;_classCallCheck2(this,t);r=a.call(this);r.type="ShapeGeometry";r.parameters={shapes:i,curveSegments:n};var o=[],s=[],l=[],d=[],c=0,u=0;if(!1===Array.isArray(i)){e(i)}else{for(var p=0;p<i.length;p++){e(i[p]);r.addGroup(c,u,p);c+=u;u=0}}r.setIndex(o);r.setAttribute("position",new il(s,3));r.setAttribute("normal",new il(l,3));r.setAttribute("uv",new il(d,2));function e(e){var t=s.length/3,r=e.extractPoints(n),i=r.shape,p=r.holes;if(!1===du.isClockWise(i)){i=i.reverse()}for(var c=0,x=p.length,l;c<x;c++){l=p[c];if(!0===du.isClockWise(l)){p[c]=l.reverse()}}for(var m=du.triangulateShape(i,p),g=0,f=p.length,h;g<f;g++){h=p[g];i=i.concat(h)}for(var b=0,S=i.length,M;b<S;b++){M=i[b];s.push(M.x,M.y,0);l.push(0,0,1);d.push(M.x,M.y)}for(var T=0,E=m.length;T<E;T++){var v=m[T],y=v[0]+t,a=v[1]+t,_=v[2]+t;o.push(y,a,_);u+=3}}return r}_createClass2(t,[{key:"toJSON",value:function toJSON(){var e=_get(_getPrototypeOf(t.prototype),"toJSON",this).call(this),a=this.parameters.shapes;return ka(a,e)}}],[{key:"fromJSON",value:function fromJSON(e,a){for(var r=[],i=0,n=e.shapes.length,o;i<n;i++){o=a[e.shapes[i]];r.push(o)}return new t(r,e.curveSegments)}}]);return t}(pl);function ka(e,t){t.shapes=[];if(Array.isArray(e)){for(var a=0,r=e.length,i;a<r;a++){i=e[a];t.shapes.push(i.uuid)}}else{t.shapes.push(e.uuid)}return t}var mu=function(e){_inherits(t,e);var r=_createSuper(t);function t(){var e,i=0<arguments.length&&arguments[0]!==void 0?arguments[0]:1,n=1<arguments.length&&arguments[1]!==void 0?arguments[1]:32,o=2<arguments.length&&arguments[2]!==void 0?arguments[2]:16,s=3<arguments.length&&arguments[3]!==void 0?arguments[3]:0,l=4<arguments.length&&arguments[4]!==void 0?arguments[4]:2*Math.PI,p=5<arguments.length&&arguments[5]!==void 0?arguments[5]:0,m=6<arguments.length&&arguments[6]!==void 0?arguments[6]:Math.PI;_classCallCheck2(this,t);e=r.call(this);e.type="SphereGeometry";e.parameters={radius:i,widthSegments:n,heightSegments:o,phiStart:s,phiLength:l,thetaStart:p,thetaLength:m};n=Math.max(3,Math.floor(n));o=Math.max(2,Math.floor(o));for(var g=Math.min(p+m,Math.PI),f=0,h=[],y=new Po,_=new Po,x=[],S=[],M=[],T=[],E=0;E<=o;E++){var w=[],A=E/o,v=0;if(0==E&&0==p){v=.5/n}else if(E==o&&g==Math.PI){v=-.5/n}for(var d=0,C;d<=n;d++){C=d/n;y.x=-i*Math.cos(s+C*l)*Math.sin(p+A*m);y.y=i*Math.cos(p+A*m);y.z=i*Math.sin(s+C*l)*Math.sin(p+A*m);S.push(y.x,y.y,y.z);_.copy(y).normalize();M.push(_.x,_.y,_.z);T.push(C+v,1-A);w.push(f++)}h.push(w)}for(var u=0;u<o;u++){for(var L=0;L<n;L++){var k=h[u][L+1],a=h[u][L],b=h[u+1][L],c=h[u+1][L+1];if(0!==u||0<p)x.push(k,a,c);if(u!==o-1||g<Math.PI)x.push(a,b,c)}}e.setIndex(x);e.setAttribute("position",new il(S,3));e.setAttribute("normal",new il(M,3));e.setAttribute("uv",new il(T,2));return e}_createClass2(t,null,[{key:"fromJSON",value:function fromJSON(e){return new t(e.radius,e.widthSegments,e.heightSegments,e.phiStart,e.phiLength,e.thetaStart,e.thetaLength)}}]);return t}(pl),gu=function(e){_inherits(t,e);var a=_createSuper(t);function t(e){var r;_classCallCheck2(this,t);r=a.call(this);r.type="ShadowMaterial";r.color=new Js(0);r.transparent=!0;r.setValues(e);return r}_createClass2(t,[{key:"copy",value:function copy(e){_get(_getPrototypeOf(t.prototype),"copy",this).call(this,e);this.color.copy(e.color);return this}}]);return t}(qs);gu.prototype.isShadowMaterial=!0;var fu=function(e){_inherits(t,e);var a=_createSuper(t);function t(e){var r;_classCallCheck2(this,t);r=a.call(this);r.defines={STANDARD:""};r.type="MeshStandardMaterial";r.color=new Js(16777215);r.roughness=1;r.metalness=0;r.map=null;r.lightMap=null;r.lightMapIntensity=1;r.aoMap=null;r.aoMapIntensity=1;r.emissive=new Js(0);r.emissiveIntensity=1;r.emissiveMap=null;r.bumpMap=null;r.bumpScale=1;r.normalMap=null;r.normalMapType=lo;r.normalScale=new bo(1,1);r.displacementMap=null;r.displacementScale=1;r.displacementBias=0;r.roughnessMap=null;r.metalnessMap=null;r.alphaMap=null;r.envMap=null;r.envMapIntensity=1;r.refractionRatio=.98;r.wireframe=!1;r.wireframeLinewidth=1;r.wireframeLinecap="round";r.wireframeLinejoin="round";r.flatShading=!1;r.setValues(e);return r}_createClass2(t,[{key:"copy",value:function copy(e){_get(_getPrototypeOf(t.prototype),"copy",this).call(this,e);this.defines={STANDARD:""};this.color.copy(e.color);this.roughness=e.roughness;this.metalness=e.metalness;this.map=e.map;this.lightMap=e.lightMap;this.lightMapIntensity=e.lightMapIntensity;this.aoMap=e.aoMap;this.aoMapIntensity=e.aoMapIntensity;this.emissive.copy(e.emissive);this.emissiveMap=e.emissiveMap;this.emissiveIntensity=e.emissiveIntensity;this.bumpMap=e.bumpMap;this.bumpScale=e.bumpScale;this.normalMap=e.normalMap;this.normalMapType=e.normalMapType;this.normalScale.copy(e.normalScale);this.displacementMap=e.displacementMap;this.displacementScale=e.displacementScale;this.displacementBias=e.displacementBias;this.roughnessMap=e.roughnessMap;this.metalnessMap=e.metalnessMap;this.alphaMap=e.alphaMap;this.envMap=e.envMap;this.envMapIntensity=e.envMapIntensity;this.refractionRatio=e.refractionRatio;this.wireframe=e.wireframe;this.wireframeLinewidth=e.wireframeLinewidth;this.wireframeLinecap=e.wireframeLinecap;this.wireframeLinejoin=e.wireframeLinejoin;this.flatShading=e.flatShading;return this}}]);return t}(qs);fu.prototype.isMeshStandardMaterial=!0;var hu=function(e){_inherits(a,e);var r=_createSuper(a);function a(e){var i;_classCallCheck2(this,a);i=r.call(this);i.defines={STANDARD:"",PHYSICAL:""};i.type="MeshPhysicalMaterial";i.clearcoatMap=null;i.clearcoatRoughness=0;i.clearcoatRoughnessMap=null;i.clearcoatNormalScale=new bo(1,1);i.clearcoatNormalMap=null;i.ior=1.5;Object.defineProperty(_assertThisInitialized(i),"reflectivity",{get:function get(){return t(2.5*(this.ior-1)/(this.ior+1),0,1)},set:function set(e){this.ior=(1+.4*e)/(1-.4*e)}});i.sheenColor=new Js(0);i.sheenColorMap=null;i.sheenRoughness=1;i.sheenRoughnessMap=null;i.transmissionMap=null;i.thickness=0;i.thicknessMap=null;i.attenuationDistance=0;i.attenuationColor=new Js(1,1,1);i.specularIntensity=1;i.specularIntensityMap=null;i.specularColor=new Js(1,1,1);i.specularColorMap=null;i._sheen=0;i._clearcoat=0;i._transmission=0;i.setValues(e);return i}_createClass2(a,[{key:"copy",value:function copy(e){_get(_getPrototypeOf(a.prototype),"copy",this).call(this,e);this.defines={STANDARD:"",PHYSICAL:""};this.clearcoat=e.clearcoat;this.clearcoatMap=e.clearcoatMap;this.clearcoatRoughness=e.clearcoatRoughness;this.clearcoatRoughnessMap=e.clearcoatRoughnessMap;this.clearcoatNormalMap=e.clearcoatNormalMap;this.clearcoatNormalScale.copy(e.clearcoatNormalScale);this.ior=e.ior;this.sheen=e.sheen;this.sheenColor.copy(e.sheenColor);this.sheenColorMap=e.sheenColorMap;this.sheenRoughness=e.sheenRoughness;this.sheenRoughnessMap=e.sheenRoughnessMap;this.transmission=e.transmission;this.transmissionMap=e.transmissionMap;this.thickness=e.thickness;this.thicknessMap=e.thicknessMap;this.attenuationDistance=e.attenuationDistance;this.attenuationColor.copy(e.attenuationColor);this.specularIntensity=e.specularIntensity;this.specularIntensityMap=e.specularIntensityMap;this.specularColor.copy(e.specularColor);this.specularColorMap=e.specularColorMap;return this}},{key:"sheen",get:function get(){return this._sheen},set:function set(e){if(0<this._sheen!=0<e){this.version++}this._sheen=e}},{key:"clearcoat",get:function get(){return this._clearcoat},set:function set(e){if(0<this._clearcoat!=0<e){this.version++}this._clearcoat=e}},{key:"transmission",get:function get(){return this._transmission},set:function set(e){if(0<this._transmission!=0<e){this.version++}this._transmission=e}}]);return a}(fu);hu.prototype.isMeshPhysicalMaterial=!0;var vu=function(e){_inherits(t,e);var a=_createSuper(t);function t(e){var r;_classCallCheck2(this,t);r=a.call(this);r.type="MeshPhongMaterial";r.color=new Js(16777215);r.specular=new Js(1118481);r.shininess=30;r.map=null;r.lightMap=null;r.lightMapIntensity=1;r.aoMap=null;r.aoMapIntensity=1;r.emissive=new Js(0);r.emissiveIntensity=1;r.emissiveMap=null;r.bumpMap=null;r.bumpScale=1;r.normalMap=null;r.normalMapType=lo;r.normalScale=new bo(1,1);r.displacementMap=null;r.displacementScale=1;r.displacementBias=0;r.specularMap=null;r.alphaMap=null;r.envMap=null;r.combine=ri;r.reflectivity=1;r.refractionRatio=.98;r.wireframe=!1;r.wireframeLinewidth=1;r.wireframeLinecap="round";r.wireframeLinejoin="round";r.flatShading=!1;r.setValues(e);return r}_createClass2(t,[{key:"copy",value:function copy(e){_get(_getPrototypeOf(t.prototype),"copy",this).call(this,e);this.color.copy(e.color);this.specular.copy(e.specular);this.shininess=e.shininess;this.map=e.map;this.lightMap=e.lightMap;this.lightMapIntensity=e.lightMapIntensity;this.aoMap=e.aoMap;this.aoMapIntensity=e.aoMapIntensity;this.emissive.copy(e.emissive);this.emissiveMap=e.emissiveMap;this.emissiveIntensity=e.emissiveIntensity;this.bumpMap=e.bumpMap;this.bumpScale=e.bumpScale;this.normalMap=e.normalMap;this.normalMapType=e.normalMapType;this.normalScale.copy(e.normalScale);this.displacementMap=e.displacementMap;this.displacementScale=e.displacementScale;this.displacementBias=e.displacementBias;this.specularMap=e.specularMap;this.alphaMap=e.alphaMap;this.envMap=e.envMap;this.combine=e.combine;this.reflectivity=e.reflectivity;this.refractionRatio=e.refractionRatio;this.wireframe=e.wireframe;this.wireframeLinewidth=e.wireframeLinewidth;this.wireframeLinecap=e.wireframeLinecap;this.wireframeLinejoin=e.wireframeLinejoin;this.flatShading=e.flatShading;return this}}]);return t}(qs);vu.prototype.isMeshPhongMaterial=!0;var yu=function(e){_inherits(t,e);var a=_createSuper(t);function t(e){var r;_classCallCheck2(this,t);r=a.call(this);r.defines={TOON:""};r.type="MeshToonMaterial";r.color=new Js(16777215);r.map=null;r.gradientMap=null;r.lightMap=null;r.lightMapIntensity=1;r.aoMap=null;r.aoMapIntensity=1;r.emissive=new Js(0);r.emissiveIntensity=1;r.emissiveMap=null;r.bumpMap=null;r.bumpScale=1;r.normalMap=null;r.normalMapType=lo;r.normalScale=new bo(1,1);r.displacementMap=null;r.displacementScale=1;r.displacementBias=0;r.alphaMap=null;r.wireframe=!1;r.wireframeLinewidth=1;r.wireframeLinecap="round";r.wireframeLinejoin="round";r.setValues(e);return r}_createClass2(t,[{key:"copy",value:function copy(e){_get(_getPrototypeOf(t.prototype),"copy",this).call(this,e);this.color.copy(e.color);this.map=e.map;this.gradientMap=e.gradientMap;this.lightMap=e.lightMap;this.lightMapIntensity=e.lightMapIntensity;this.aoMap=e.aoMap;this.aoMapIntensity=e.aoMapIntensity;this.emissive.copy(e.emissive);this.emissiveMap=e.emissiveMap;this.emissiveIntensity=e.emissiveIntensity;this.bumpMap=e.bumpMap;this.bumpScale=e.bumpScale;this.normalMap=e.normalMap;this.normalMapType=e.normalMapType;this.normalScale.copy(e.normalScale);this.displacementMap=e.displacementMap;this.displacementScale=e.displacementScale;this.displacementBias=e.displacementBias;this.alphaMap=e.alphaMap;this.wireframe=e.wireframe;this.wireframeLinewidth=e.wireframeLinewidth;this.wireframeLinecap=e.wireframeLinecap;this.wireframeLinejoin=e.wireframeLinejoin;return this}}]);return t}(qs);yu.prototype.isMeshToonMaterial=!0;var _u=function(e){_inherits(t,e);var a=_createSuper(t);function t(e){var r;_classCallCheck2(this,t);r=a.call(this);r.type="MeshNormalMaterial";r.bumpMap=null;r.bumpScale=1;r.normalMap=null;r.normalMapType=lo;r.normalScale=new bo(1,1);r.displacementMap=null;r.displacementScale=1;r.displacementBias=0;r.wireframe=!1;r.wireframeLinewidth=1;r.fog=!1;r.flatShading=!1;r.setValues(e);return r}_createClass2(t,[{key:"copy",value:function copy(e){_get(_getPrototypeOf(t.prototype),"copy",this).call(this,e);this.bumpMap=e.bumpMap;this.bumpScale=e.bumpScale;this.normalMap=e.normalMap;this.normalMapType=e.normalMapType;this.normalScale.copy(e.normalScale);this.displacementMap=e.displacementMap;this.displacementScale=e.displacementScale;this.displacementBias=e.displacementBias;this.wireframe=e.wireframe;this.wireframeLinewidth=e.wireframeLinewidth;this.flatShading=e.flatShading;return this}}]);return t}(qs);_u.prototype.isMeshNormalMaterial=!0;var xu=function(e){_inherits(t,e);var a=_createSuper(t);function t(e){var r;_classCallCheck2(this,t);r=a.call(this);r.type="MeshLambertMaterial";r.color=new Js(16777215);r.map=null;r.lightMap=null;r.lightMapIntensity=1;r.aoMap=null;r.aoMapIntensity=1;r.emissive=new Js(0);r.emissiveIntensity=1;r.emissiveMap=null;r.specularMap=null;r.alphaMap=null;r.envMap=null;r.combine=ri;r.reflectivity=1;r.refractionRatio=.98;r.wireframe=!1;r.wireframeLinewidth=1;r.wireframeLinecap="round";r.wireframeLinejoin="round";r.setValues(e);return r}_createClass2(t,[{key:"copy",value:function copy(e){_get(_getPrototypeOf(t.prototype),"copy",this).call(this,e);this.color.copy(e.color);this.map=e.map;this.lightMap=e.lightMap;this.lightMapIntensity=e.lightMapIntensity;this.aoMap=e.aoMap;this.aoMapIntensity=e.aoMapIntensity;this.emissive.copy(e.emissive);this.emissiveMap=e.emissiveMap;this.emissiveIntensity=e.emissiveIntensity;this.specularMap=e.specularMap;this.alphaMap=e.alphaMap;this.envMap=e.envMap;this.combine=e.combine;this.reflectivity=e.reflectivity;this.refractionRatio=e.refractionRatio;this.wireframe=e.wireframe;this.wireframeLinewidth=e.wireframeLinewidth;this.wireframeLinecap=e.wireframeLinecap;this.wireframeLinejoin=e.wireframeLinejoin;return this}}]);return t}(qs);xu.prototype.isMeshLambertMaterial=!0;var bu=function(e){_inherits(t,e);var a=_createSuper(t);function t(e){var r;_classCallCheck2(this,t);r=a.call(this);r.defines={MATCAP:""};r.type="MeshMatcapMaterial";r.color=new Js(16777215);r.matcap=null;r.map=null;r.bumpMap=null;r.bumpScale=1;r.normalMap=null;r.normalMapType=lo;r.normalScale=new bo(1,1);r.displacementMap=null;r.displacementScale=1;r.displacementBias=0;r.alphaMap=null;r.flatShading=!1;r.setValues(e);return r}_createClass2(t,[{key:"copy",value:function copy(e){_get(_getPrototypeOf(t.prototype),"copy",this).call(this,e);this.defines={MATCAP:""};this.color.copy(e.color);this.matcap=e.matcap;this.map=e.map;this.bumpMap=e.bumpMap;this.bumpScale=e.bumpScale;this.normalMap=e.normalMap;this.normalMapType=e.normalMapType;this.normalScale.copy(e.normalScale);this.displacementMap=e.displacementMap;this.displacementScale=e.displacementScale;this.displacementBias=e.displacementBias;this.alphaMap=e.alphaMap;this.flatShading=e.flatShading;return this}}]);return t}(qs);bu.prototype.isMeshMatcapMaterial=!0;var Su=function(e){_inherits(t,e);var a=_createSuper(t);function t(e){var r;_classCallCheck2(this,t);r=a.call(this);r.type="LineDashedMaterial";r.scale=1;r.dashSize=3;r.gapSize=1;r.setValues(e);return r}_createClass2(t,[{key:"copy",value:function copy(e){_get(_getPrototypeOf(t.prototype),"copy",this).call(this,e);this.scale=e.scale;this.dashSize=e.dashSize;this.gapSize=e.gapSize;return this}}]);return t}(vc);Su.prototype.isLineDashedMaterial=!0;var Mu={arraySlice:function arraySlice(e,t,a){if(Mu.isTypedArray(e)){return new e.constructor(e.subarray(t,a!==void 0?a:e.length))}return e.slice(t,a)},convertArray:function convertArray(e,t,a){if(!e||!a&&e.constructor===t)return e;if("number"==typeof t.BYTES_PER_ELEMENT){return new t(e)}return Array.prototype.slice.call(e)},isTypedArray:function isTypedArray(e){return ArrayBuffer.isView(e)&&!(e instanceof DataView)},getKeyframeOrder:function getKeyframeOrder(e){function t(t,a){return e[t]-e[a]}for(var a=e.length,r=Array(a),i=0;i!==a;++i){r[i]=i}r.sort(t);return r},sortedArray:function sortedArray(e,t,a){for(var r=e.length,i=new e.constructor(r),n=0,o=0,s;o!==r;++n){s=a[n]*t;for(var l=0;l!==t;++l){i[o++]=e[s+l]}}return i},flattenJSON:function flattenJSON(e,t,a,r){var n=1,o=e[0];while(o!==void 0&&o[r]===void 0){o=e[n++]}if(o===void 0)return;var s=o[r];if(s===void 0)return;if(Array.isArray(s)){do{s=o[r];if(s!==void 0){t.push(o.time);a.push.apply(a,s)}o=e[n++]}while(o!==void 0)}else if(s.toArray!==void 0){do{s=o[r];if(s!==void 0){t.push(o.time);s.toArray(a,a.length)}o=e[n++]}while(o!==void 0)}else{do{s=o[r];if(s!==void 0){t.push(o.time);a.push(s)}o=e[n++]}while(o!==void 0)}},subclip:function subclip(e,t,a,r){var i=4<arguments.length&&arguments[4]!==void 0?arguments[4]:30,n=e.clone();n.name=t;for(var o=[],s=0;s<n.tracks.length;++s){for(var l=n.tracks[s],d=l.getValueSize(),c=[],u=[],p=0,m;p<l.times.length;++p){m=l.times[p]*i;if(m<a||m>=r)continue;c.push(l.times[p]);for(var h=0;h<d;++h){u.push(l.values[p*d+h])}}if(0===c.length)continue;l.times=Mu.convertArray(c,l.times.constructor);l.values=Mu.convertArray(u,l.values.constructor);o.push(l)}n.tracks=o;for(var g=1/0,f=0;f<n.tracks.length;++f){if(g>n.tracks[f].times[0]){g=n.tracks[f].times[0]}}for(var v=0;v<n.tracks.length;++v){n.tracks[v].shift(-1*g)}n.resetDuration();return n},makeClipAdditive:function makeClipAdditive(e){var t=1<arguments.length&&arguments[1]!==void 0?arguments[1]:0,a=2<arguments.length&&arguments[2]!==void 0?arguments[2]:e,r=3<arguments.length&&arguments[3]!==void 0?arguments[3]:30;if(0>=r)r=30;for(var i=a.tracks.length,n=t/r,o=function(t){var r=a.tracks[t],i=r.ValueTypeName;if("bool"===i||"string"===i)return"continue";var o=e.tracks.find(function(e){return e.name===r.name&&e.ValueTypeName===i});if(o===void 0)return"continue";var s=0,l=r.getValueSize();if(r.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline){s=l/3}var d=0,c=o.getValueSize();if(o.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline){d=c/3}var u=r.times.length-1,p=void 0;if(n<=r.times[0]){var m=s,g=l-s;p=Mu.arraySlice(r.values,m,g)}else if(n>=r.times[u]){var f=u*l+s,h=f+l-s;p=Mu.arraySlice(r.values,f,h)}else{var v=r.createInterpolant(),y=s,_=l-s;v.evaluate(n);p=Mu.arraySlice(v.resultBuffer,y,_)}if("quaternion"===i){var E=new Ro().fromArray(p).normalize().conjugate();E.toArray(p)}for(var x=o.times.length,b=0,S;b<x;++b){S=b*c+d;if("quaternion"===i){Ro.multiplyQuaternionsFlat(o.values,S,p,0,o.values,S)}else{for(var M=c-2*d,T=0;T<M;++T){o.values[S+T]-=p[T]}}}},s=0,l;s<i;++s){l=o(s);if("continue"===l)continue}e.blendMode=Qn;return e}},Tu=function(){function e(t,a,r,i){_classCallCheck2(this,e);this.parameterPositions=t;this._cachedIndex=0;this.resultBuffer=i!==void 0?i:new a.constructor(r);this.sampleValues=a;this.valueSize=r;this.settings=null;this.DefaultSettings_={}}_createClass2(e,[{key:"evaluate",value:function evaluate(e){var t=this.parameterPositions,a=this._cachedIndex,r=t[a],i=t[a-1];validate_interval:{seek:{var n;linear_scan:{forward_scan:if(!(e<r)){for(var o=a+2;;){if(r===void 0){if(e<i)break forward_scan;a=t.length;this._cachedIndex=a;return this.afterEnd_(a-1,e,i)}if(a===o)break;i=r;r=t[++a];if(e<r){break seek}}n=t.length;break linear_scan}if(!(e>=i)){var s=t[1];if(e<s){a=2;i=s}for(var l=a-2;;){if(i===void 0){this._cachedIndex=0;return this.beforeStart_(0,e,r)}if(a===l)break;r=i;i=t[--a-1];if(e>=i){break seek}}n=a;a=0;break linear_scan}break validate_interval}while(a<n){var d=a+n>>>1;if(e<t[d]){n=d}else{a=d+1}}r=t[a];i=t[a-1];if(i===void 0){this._cachedIndex=0;return this.beforeStart_(0,e,r)}if(r===void 0){a=t.length;this._cachedIndex=a;return this.afterEnd_(a-1,i,e)}}this._cachedIndex=a;this.intervalChanged_(a,i,r)}return this.interpolate_(a,i,e,r)}},{key:"getSettings_",value:function getSettings_(){return this.settings||this.DefaultSettings_}},{key:"copySampleValue_",value:function copySampleValue_(e){for(var t=this.resultBuffer,a=this.sampleValues,r=this.valueSize,i=0;i!==r;++i){t[i]=a[e*r+i]}return t}},{key:"interpolate_",value:function interpolate_(){throw new Error("call to abstract method")}},{key:"intervalChanged_",value:function intervalChanged_(){}}]);return e}();Tu.prototype.beforeStart_=Tu.prototype.copySampleValue_;Tu.prototype.afterEnd_=Tu.prototype.copySampleValue_;var Eu=function(e){_inherits(t,e);var a=_createSuper(t);function t(e,r,i,n){var o;_classCallCheck2(this,t);o=a.call(this,e,r,i,n);o._weightPrev=-0;o._offsetPrev=-0;o._weightNext=-0;o._offsetNext=-0;o.DefaultSettings_={endingStart:Xn,endingEnd:Xn};return o}_createClass2(t,[{key:"intervalChanged_",value:function intervalChanged_(e,t,a){var r=this.parameterPositions,i=e-2,n=e+1,o=r[i],s=r[n];if(o===void 0){switch(this.getSettings_().endingStart){case Yn:i=e;o=2*t-a;break;case Zn:i=r.length-2;o=t+r[i]-r[i+1];break;default:i=e;o=a;}}if(s===void 0){switch(this.getSettings_().endingEnd){case Yn:n=e;s=2*a-t;break;case Zn:n=1;s=a+r[1]-r[0];break;default:n=e-1;s=t;}}var l=.5*(a-t),d=this.valueSize;this._weightPrev=l/(t-o);this._weightNext=l/(s-a);this._offsetPrev=i*d;this._offsetNext=n*d}},{key:"interpolate_",value:function interpolate_(e,a,r,t){for(var i=this.resultBuffer,n=this.sampleValues,o=this.valueSize,s=e*o,l=this._offsetPrev,d=this._offsetNext,c=this._weightPrev,u=this._weightNext,m=(r-a)/(t-a),p=m*m,g=p*m,f=0;f!==o;++f){i[f]=(-c*g+2*c*p-c*m)*n[l+f]+((1+c)*g+(-1.5-2*c)*p+(-.5+c)*m+1)*n[s-o+f]+((-1-u)*g+(1.5+u)*p+.5*m)*n[s+f]+(u*g-u*p)*n[d+f]}return i}}]);return t}(Tu),wu=function(e){_inherits(t,e);var a=_createSuper(t);function t(e,r,i,n){_classCallCheck2(this,t);return a.call(this,e,r,i,n)}_createClass2(t,[{key:"interpolate_",value:function interpolate_(e,a,r,t){for(var i=this.resultBuffer,n=this.sampleValues,o=this.valueSize,s=e*o,l=(r-a)/(t-a),d=0;d!==o;++d){i[d]=n[s-o+d]*(1-l)+n[s+d]*l}return i}}]);return t}(Tu),Au=function(e){_inherits(t,e);var a=_createSuper(t);function t(e,r,i,n){_classCallCheck2(this,t);return a.call(this,e,r,i,n)}_createClass2(t,[{key:"interpolate_",value:function interpolate_(e){return this.copySampleValue_(e-1)}}]);return t}(Tu),ku=function(){function e(t,a,r,i){_classCallCheck2(this,e);if(t===void 0)throw new Error("THREE.KeyframeTrack: track name is undefined");if(a===void 0||0===a.length)throw new Error("THREE.KeyframeTrack: no keyframes in track named "+t);this.name=t;this.times=Mu.convertArray(a,this.TimeBufferType);this.values=Mu.convertArray(r,this.ValueBufferType);this.setInterpolation(i||this.DefaultInterpolation)}_createClass2(e,[{key:"InterpolantFactoryMethodDiscrete",value:function InterpolantFactoryMethodDiscrete(e){return new Au(this.times,this.values,this.getValueSize(),e)}},{key:"InterpolantFactoryMethodLinear",value:function InterpolantFactoryMethodLinear(e){return new wu(this.times,this.values,this.getValueSize(),e)}},{key:"InterpolantFactoryMethodSmooth",value:function InterpolantFactoryMethodSmooth(e){return new Eu(this.times,this.values,this.getValueSize(),e)}},{key:"setInterpolation",value:function setInterpolation(e){var t;switch(e){case Wn:t=this.InterpolantFactoryMethodDiscrete;break;case jn:t=this.InterpolantFactoryMethodLinear;break;case qn:t=this.InterpolantFactoryMethodSmooth;break;}if(t===void 0){var a="unsupported interpolation for "+this.ValueTypeName+" keyframe track named "+this.name;if(this.createInterpolant===void 0){if(e!==this.DefaultInterpolation){this.setInterpolation(this.DefaultInterpolation)}else{throw new Error(a)}}console.warn("THREE.KeyframeTrack:",a);return this}this.createInterpolant=t;return this}},{key:"getInterpolation",value:function getInterpolation(){switch(this.createInterpolant){case this.InterpolantFactoryMethodDiscrete:return Wn;case this.InterpolantFactoryMethodLinear:return jn;case this.InterpolantFactoryMethodSmooth:return qn;}}},{key:"getValueSize",value:function getValueSize(){return this.values.length/this.times.length}},{key:"shift",value:function shift(e){if(0!==e){for(var t=this.times,a=0,r=t.length;a!==r;++a){t[a]+=e}}return this}},{key:"scale",value:function scale(e){if(1!==e){for(var t=this.times,a=0,r=t.length;a!==r;++a){t[a]*=e}}return this}},{key:"trim",value:function trim(e,t){var a=this.times,r=a.length,i=0,n=r-1;while(i!==r&&a[i]<e){++i}while(-1!==n&&a[n]>t){--n}++n;if(0!==i||n!==r){if(i>=n){n=Math.max(n,1);i=n-1}var o=this.getValueSize();this.times=Mu.arraySlice(a,i,n);this.values=Mu.arraySlice(this.values,i*o,n*o)}return this}},{key:"validate",value:function validate(){var e=!0,t=this.getValueSize();if(0!=t-Math.floor(t)){console.error("THREE.KeyframeTrack: Invalid value size in track.",this);e=!1}var a=this.times,r=this.values,i=a.length;if(0===i){console.error("THREE.KeyframeTrack: Track is empty.",this);e=!1}for(var o=null,s=0,l;s!==i;s++){l=a[s];if("number"==typeof l&&isNaN(l)){console.error("THREE.KeyframeTrack: Time is not a valid number.",this,s,l);e=!1;break}if(null!==o&&o>l){console.error("THREE.KeyframeTrack: Out of order keys.",this,s,l,o);e=!1;break}o=l}if(r!==void 0){if(Mu.isTypedArray(r)){for(var d=0,c=r.length,n;d!==c;++d){n=r[d];if(isNaN(n)){console.error("THREE.KeyframeTrack: Value is not a valid number.",this,d,n);e=!1;break}}}}return e}},{key:"optimize",value:function optimize(){for(var e=Mu.arraySlice(this.times),t=Mu.arraySlice(this.values),a=this.getValueSize(),r=this.getInterpolation()===qn,i=e.length-1,n=1,o=1;o<i;++o){var s=!1,l=e[o],d=e[o+1];if(l!==d&&(1!==o||l!==e[0])){if(!r){for(var c=o*a,u=0,p;u!==a;++u){p=t[c+u];if(p!==t[c-a+u]||p!==t[c+a+u]){s=!0;break}}}else{s=!0}}if(s){if(o!==n){e[n]=e[o];for(var m=o*a,g=n*a,f=0;f!==a;++f){t[g+f]=t[m+f]}}++n}}if(0<i){e[n]=e[i];for(var h=n*a,v=0;v!==a;++v){t[h+v]=t[i*a+v]}++n}if(n!==e.length){this.times=Mu.arraySlice(e,0,n);this.values=Mu.arraySlice(t,0,n*a)}else{this.times=e;this.values=t}return this}},{key:"clone",value:function clone(){var e=Mu.arraySlice(this.times,0),t=Mu.arraySlice(this.values,0),a=this.constructor,r=new a(this.name,e,t);r.createInterpolant=this.createInterpolant;return r}}],[{key:"toJSON",value:function toJSON(e){var t=e.constructor,a;if(t.toJSON!==this.toJSON){a=t.toJSON(e)}else{a={name:e.name,times:Mu.convertArray(e.times,Array),values:Mu.convertArray(e.values,Array)};var r=e.getInterpolation();if(r!==e.DefaultInterpolation){a.interpolation=r}}a.type=e.ValueTypeName;return a}}]);return e}();ku.prototype.TimeBufferType=Float32Array;ku.prototype.ValueBufferType=Float32Array;ku.prototype.DefaultInterpolation=jn;var Cu=function(e){_inherits(t,e);var a=_createSuper(t);function t(){_classCallCheck2(this,t);return a.apply(this,arguments)}return t}(ku);Cu.prototype.ValueTypeName="bool";Cu.prototype.ValueBufferType=Array;Cu.prototype.DefaultInterpolation=Wn;Cu.prototype.InterpolantFactoryMethodLinear=void 0;Cu.prototype.InterpolantFactoryMethodSmooth=void 0;var Lu=function(e){_inherits(t,e);var a=_createSuper(t);function t(){_classCallCheck2(this,t);return a.apply(this,arguments)}return t}(ku);Lu.prototype.ValueTypeName="color";var Ru=function(e){_inherits(t,e);var a=_createSuper(t);function t(){_classCallCheck2(this,t);return a.apply(this,arguments)}return t}(ku);Ru.prototype.ValueTypeName="number";var Pu=function(e){_inherits(t,e);var a=_createSuper(t);function t(e,r,i,n){_classCallCheck2(this,t);return a.call(this,e,r,i,n)}_createClass2(t,[{key:"interpolate_",value:function interpolate_(e,a,r,t){for(var i=this.resultBuffer,n=this.sampleValues,o=this.valueSize,s=e*o,l=s+o;s!==l;s+=4){Ro.slerpFlat(i,0,n,s-o,n,s,(r-a)/(t-a))}return i}}]);return t}(Tu),Du=function(e){_inherits(t,e);var a=_createSuper(t);function t(){_classCallCheck2(this,t);return a.apply(this,arguments)}_createClass2(t,[{key:"InterpolantFactoryMethodLinear",value:function InterpolantFactoryMethodLinear(e){return new Pu(this.times,this.values,this.getValueSize(),e)}}]);return t}(ku);Du.prototype.ValueTypeName="quaternion";Du.prototype.DefaultInterpolation=jn;Du.prototype.InterpolantFactoryMethodSmooth=void 0;var Iu=function(e){_inherits(t,e);var a=_createSuper(t);function t(){_classCallCheck2(this,t);return a.apply(this,arguments)}return t}(ku);Iu.prototype.ValueTypeName="string";Iu.prototype.ValueBufferType=Array;Iu.prototype.DefaultInterpolation=Wn;Iu.prototype.InterpolantFactoryMethodLinear=void 0;Iu.prototype.InterpolantFactoryMethodSmooth=void 0;var zu=function(e){_inherits(t,e);var a=_createSuper(t);function t(){_classCallCheck2(this,t);return a.apply(this,arguments)}return t}(ku);zu.prototype.ValueTypeName="vector";var Nu=function(){function t(a){var r=1<arguments.length&&arguments[1]!==void 0?arguments[1]:-1,i=2<arguments.length?arguments[2]:void 0,n=3<arguments.length&&arguments[3]!==void 0?arguments[3]:Jn;_classCallCheck2(this,t);this.name=a;this.tracks=i;this.duration=r;this.blendMode=n;this.uuid=e();if(0>this.duration){this.resetDuration()}}_createClass2(t,[{key:"resetDuration",value:function resetDuration(){for(var e=this.tracks,t=0,a=0,r=e.length,i;a!==r;++a){i=this.tracks[a];t=Math.max(t,i.times[i.times.length-1])}this.duration=t;return this}},{key:"trim",value:function trim(){for(var e=0;e<this.tracks.length;e++){this.tracks[e].trim(0,this.duration)}return this}},{key:"validate",value:function validate(){for(var e=!0,t=0;t<this.tracks.length;t++){e=e&&this.tracks[t].validate()}return e}},{key:"optimize",value:function optimize(){for(var e=0;e<this.tracks.length;e++){this.tracks[e].optimize()}return this}},{key:"clone",value:function clone(){for(var e=[],t=0;t<this.tracks.length;t++){e.push(this.tracks[t].clone())}return new this.constructor(this.name,this.duration,e,this.blendMode)}},{key:"toJSON",value:function toJSON(){return this.constructor.toJSON(this)}}],[{key:"parse",value:function parse(e){for(var t=[],a=e.tracks,r=1/(e.fps||1),i=0,o=a.length;i!==o;++i){t.push(La(a[i]).scale(r))}var n=new this(e.name,e.duration,t,e.blendMode);n.uuid=e.uuid;return n}},{key:"toJSON",value:function toJSON(e){for(var t=[],a=e.tracks,r={name:e.name,duration:e.duration,tracks:t,uuid:e.uuid,blendMode:e.blendMode},i=0,o=a.length;i!==o;++i){t.push(ku.toJSON(a[i]))}return r}},{key:"CreateFromMorphTargetSequence",value:function CreateFromMorphTargetSequence(e,t,a,r){for(var i=t.length,n=[],o=0;o<i;o++){var s=[],l=[];s.push((o+i-1)%i,o,(o+1)%i);l.push(0,1,0);var d=Mu.getKeyframeOrder(s);s=Mu.sortedArray(s,1,d);l=Mu.sortedArray(l,1,d);if(!r&&0===s[0]){s.push(i);l.push(l[0])}n.push(new Ru(".morphTargetInfluences["+t[o].name+"]",s,l).scale(1/a))}return new this(e,-1,n)}},{key:"findByName",value:function findByName(e,t){var a=e;if(!Array.isArray(e)){var r=e;a=r.geometry&&r.geometry.animations||r.animations}for(var i=0;i<a.length;i++){if(a[i].name===t){return a[i]}}return null}},{key:"CreateClipsFromMorphTargetSequences",value:function CreateClipsFromMorphTargetSequences(e,t,a){for(var r={},i=0,n=e.length;i<n;i++){var o=e[i],s=o.name.match(/^([\w-]*?)([\d]+)$/);if(s&&1<s.length){var l=s[1],d=r[l];if(!d){r[l]=d=[]}d.push(o)}}var c=[];for(var u in r){c.push(this.CreateFromMorphTargetSequence(u,r[u],t,a))}return c}},{key:"parseAnimation",value:function parseAnimation(e,t){if(!e){console.error("THREE.AnimationClip: No animation in JSONLoader data.");return null}for(var a=function(e,t,a,r,i){if(0!==a.length){var n=[],o=[];Mu.flattenJSON(a,n,o,r);if(0!==n.length){i.push(new e(t,n,o))}}},r=[],i=e.name||"default",n=e.fps||30,o=e.blendMode,s=e.length||-1,l=e.hierarchy||[],d=0,c;d<l.length;d++){c=l[d].keys;if(!c||0===c.length)continue;if(c[0].morphTargets){var u={},p=void 0;for(p=0;p<c.length;p++){if(c[p].morphTargets){for(var x=0;x<c[p].morphTargets.length;x++){u[c[p].morphTargets[x]]=-1}}}for(var m in u){for(var g=[],f=[],v=0,y;v!==c[p].morphTargets.length;++v){y=c[p];g.push(y.time);f.push(y.morphTarget===m?1:0)}r.push(new Ru(".morphTargetInfluence["+m+"]",g,f))}s=u.length*(n||1)}else{var b=".bones["+t[d].name+"]";a(zu,b+".position",c,"pos",r);a(Du,b+".quaternion",c,"rot",r);a(zu,b+".scale",c,"scl",r)}}if(0===r.length){return null}var _=new this(i,s,r,o);return _}}]);return t}();function Ca(e){switch(e.toLowerCase()){case"scalar":case"double":case"float":case"number":case"integer":return Ru;case"vector":case"vector2":case"vector3":case"vector4":return zu;case"color":return Lu;case"quaternion":return Du;case"bool":case"boolean":return Cu;case"string":return Iu;}throw new Error("THREE.KeyframeTrack: Unsupported typeName: "+e)}function La(e){if(e.type===void 0){throw new Error("THREE.KeyframeTrack: track type undefined, can not parse")}var t=Ca(e.type);if(e.times===void 0){var a=[],r=[];Mu.flattenJSON(e.keys,a,r,"value");e.times=a;e.values=r}if(t.parse!==void 0){return t.parse(e)}else{return new t(e.name,e.times,e.values,e.interpolation)}}var Ou={enabled:!1,files:{},add:function add(e,t){if(!1===this.enabled)return;this.files[e]=t},get:function get(e){if(!1===this.enabled)return;return this.files[e]},remove:function remove(e){delete this.files[e]},clear:function clear(){this.files={}}},Fu=new function e(t,a,r){_classCallCheck2(this,e);var i=this,n=!1,o=0,s=0,l=void 0,d=[];this.onStart=void 0;this.onLoad=t;this.onProgress=a;this.onError=r;this.itemStart=function(e){s++;if(!1===n){if(i.onStart!==void 0){i.onStart(e,o,s)}}n=!0};this.itemEnd=function(e){o++;if(i.onProgress!==void 0){i.onProgress(e,o,s)}if(o===s){n=!1;if(i.onLoad!==void 0){i.onLoad()}}};this.itemError=function(e){if(i.onError!==void 0){i.onError(e)}};this.resolveURL=function(e){if(l){return l(e)}return e};this.setURLModifier=function(e){l=e;return this};this.addHandler=function(e,t){d.push(e,t);return this};this.removeHandler=function(e){var t=d.indexOf(e);if(-1!==t){d.splice(t,2)}return this};this.getHandler=function(e){for(var r=0,i=d.length;r<i;r+=2){var t=d[r],a=d[r+1];if(t.global)t.lastIndex=0;if(t.test(e)){return a}}return null}},Uu=function(){function e(t){_classCallCheck2(this,e);this.manager=t!==void 0?t:Fu;this.crossOrigin="anonymous";this.withCredentials=!1;this.path="";this.resourcePath="";this.requestHeader={}}_createClass2(e,[{key:"load",value:function load(){}},{key:"loadAsync",value:function loadAsync(e,t){var a=this;return new Promise(function(r,i){a.load(e,r,t,i)})}},{key:"parse",value:function parse(){}},{key:"setCrossOrigin",value:function setCrossOrigin(e){this.crossOrigin=e;return this}},{key:"setWithCredentials",value:function setWithCredentials(e){this.withCredentials=e;return this}},{key:"setPath",value:function setPath(e){this.path=e;return this}},{key:"setResourcePath",value:function setResourcePath(e){this.resourcePath=e;return this}},{key:"setRequestHeader",value:function setRequestHeader(e){this.requestHeader=e;return this}}]);return e}(),Bu={},Hu=function(e){_inherits(t,e);var a=_createSuper(t);function t(e){_classCallCheck2(this,t);return a.call(this,e)}_createClass2(t,[{key:"load",value:function load(e,t,a,r){var i=this;if(e===void 0)e="";if(this.path!==void 0)e=this.path+e;e=this.manager.resolveURL(e);var n=Ou.get(e);if(n!==void 0){this.manager.itemStart(e);setTimeout(function(){if(t)t(n);i.manager.itemEnd(e)},0);return n}if(Bu[e]!==void 0){Bu[e].push({onLoad:t,onProgress:a,onError:r});return}Bu[e]=[];Bu[e].push({onLoad:t,onProgress:a,onError:r});var o=new Request(e,{headers:new Headers(this.requestHeader),credentials:this.withCredentials?"include":"same-origin"});fetch(o).then(function(t){if(200===t.status||0===t.status){if(0===t.status){console.warn("THREE.FileLoader: HTTP Status 0 received.")}var a=Bu[e],r=t.body.getReader(),i=t.headers.get("Content-Length"),n=i?parseInt(i):0,o=0;return new ReadableStream({start:function start(e){t();function t(){r.read().then(function(r){var i=r.done,s=r.value;if(i){e.close()}else{o+=s.byteLength;for(var l=new ProgressEvent("progress",{lengthComputable:0!==n,loaded:o,total:n}),d=0,c=a.length,u;d<c;d++){u=a[d];if(u.onProgress)u.onProgress(l)}e.enqueue(s);t()}})}}})}else{throw Error("fetch for \"".concat(t.url,"\" responded with ").concat(t.status,": ").concat(t.statusText))}}).then(function(e){var t=new Response(e);switch(i.responseType){case"arraybuffer":return t.arrayBuffer();case"blob":return t.blob();case"document":return t.text().then(function(e){var t=new DOMParser;return t.parseFromString(e,i.mimeType)});case"json":return t.json();default:return t.text();}}).then(function(t){Ou.add(e,t);var a=Bu[e];delete Bu[e];for(var r=0,n=a.length,o;r<n;r++){o=a[r];if(o.onLoad)o.onLoad(t)}i.manager.itemEnd(e)}).catch(function(t){var a=Bu[e];delete Bu[e];for(var r=0,n=a.length,o;r<n;r++){o=a[r];if(o.onError)o.onError(t)}i.manager.itemError(e);i.manager.itemEnd(e)});this.manager.itemStart(e)}},{key:"setResponseType",value:function setResponseType(e){this.responseType=e;return this}},{key:"setMimeType",value:function setMimeType(e){this.mimeType=e;return this}}]);return t}(Uu),Gu=function(e){_inherits(t,e);var a=_createSuper(t);function t(e){_classCallCheck2(this,t);return a.call(this,e)}_createClass2(t,[{key:"load",value:function load(e,t,a,r){if(this.path!==void 0)e=this.path+e;e=this.manager.resolveURL(e);var s=this,l=Ou.get(e);if(l!==void 0){s.manager.itemStart(e);setTimeout(function(){if(t)t(l);s.manager.itemEnd(e)},0);return l}var d=c("img");function i(){o();Ou.add(e,this);if(t)t(this);s.manager.itemEnd(e)}function n(t){o();if(r)r(t);s.manager.itemError(e);s.manager.itemEnd(e)}function o(){d.removeEventListener("load",i,!1);d.removeEventListener("error",n,!1)}d.addEventListener("load",i,!1);d.addEventListener("error",n,!1);if("data:"!==e.substr(0,5)){if(this.crossOrigin!==void 0)d.crossOrigin=this.crossOrigin}s.manager.itemStart(e);d.src=e;return d}}]);return t}(Uu),Vu=function(e){_inherits(t,e);var a=_createSuper(t);function t(e){_classCallCheck2(this,t);return a.call(this,e)}_createClass2(t,[{key:"load",value:function load(e,t,a,r){var n=new Ol,o=new Gu(this.manager);o.setCrossOrigin(this.crossOrigin);o.setPath(this.path);var s=0;function i(a){o.load(e[a],function(e){n.images[a]=e;s++;if(6==s){n.needsUpdate=!0;if(t)t(n)}},void 0,r)}for(var l=0;l<e.length;++l){i(l)}return n}}]);return t}(Uu),Wu=function(e){_inherits(t,e);var a=_createSuper(t);function t(e){_classCallCheck2(this,t);return a.call(this,e)}_createClass2(t,[{key:"load",value:function load(e,t,a,r){var i=new wo,n=new Gu(this.manager);n.setCrossOrigin(this.crossOrigin);n.setPath(this.path);n.load(e,function(e){i.image=e;i.needsUpdate=!0;if(t!==void 0){t(i)}},a,r);return i}}]);return t}(Uu),ju=function(e){_inherits(t,e);var a=_createSuper(t);function t(e){var r,i=1<arguments.length&&arguments[1]!==void 0?arguments[1]:1;_classCallCheck2(this,t);r=a.call(this);r.type="Light";r.color=new Js(e);r.intensity=i;return r}_createClass2(t,[{key:"dispose",value:function dispose(){}},{key:"copy",value:function copy(e){_get(_getPrototypeOf(t.prototype),"copy",this).call(this,e);this.color.copy(e.color);this.intensity=e.intensity;return this}},{key:"toJSON",value:function toJSON(e){var a=_get(_getPrototypeOf(t.prototype),"toJSON",this).call(this,e);a.object.color=this.color.getHex();a.object.intensity=this.intensity;if(this.groundColor!==void 0)a.object.groundColor=this.groundColor.getHex();if(this.distance!==void 0)a.object.distance=this.distance;if(this.angle!==void 0)a.object.angle=this.angle;if(this.decay!==void 0)a.object.decay=this.decay;if(this.penumbra!==void 0)a.object.penumbra=this.penumbra;if(this.shadow!==void 0)a.object.shadow=this.shadow.toJSON();return a}}]);return t}(Ds);ju.prototype.isLight=!0;var qu=function(e){_inherits(t,e);var a=_createSuper(t);function t(e,r,i){var n;_classCallCheck2(this,t);n=a.call(this,e,i);n.type="HemisphereLight";n.position.copy(Ds.DefaultUp);n.updateMatrix();n.groundColor=new Js(r);return n}_createClass2(t,[{key:"copy",value:function copy(e){ju.prototype.copy.call(this,e);this.groundColor.copy(e.groundColor);return this}}]);return t}(ju);qu.prototype.isHemisphereLight=!0;var Xu=new ls,Yu=new Po,Zu=new Po,Ju=function(){function e(t){_classCallCheck2(this,e);this.camera=t;this.bias=0;this.normalBias=0;this.radius=1;this.blurSamples=8;this.mapSize=new bo(512,512);this.map=null;this.mapPass=null;this.matrix=new ls;this.autoUpdate=!0;this.needsUpdate=!1;this._frustum=new jl;this._frameExtents=new bo(1,1);this._viewportCount=1;this._viewports=[new Ao(0,0,1,1)]}_createClass2(e,[{key:"getViewportCount",value:function getViewportCount(){return this._viewportCount}},{key:"getFrustum",value:function getFrustum(){return this._frustum}},{key:"updateMatrices",value:function updateMatrices(e){var t=this.camera,a=this.matrix;Yu.setFromMatrixPosition(e.matrixWorld);t.position.copy(Yu);Zu.setFromMatrixPosition(e.target.matrixWorld);t.lookAt(Zu);t.updateMatrixWorld();Xu.multiplyMatrices(t.projectionMatrix,t.matrixWorldInverse);this._frustum.setFromProjectionMatrix(Xu);a.set(.5,0,0,.5,0,.5,0,.5,0,0,.5,.5,0,0,0,1);a.multiply(t.projectionMatrix);a.multiply(t.matrixWorldInverse)}},{key:"getViewport",value:function getViewport(e){return this._viewports[e]}},{key:"getFrameExtents",value:function getFrameExtents(){return this._frameExtents}},{key:"dispose",value:function dispose(){if(this.map){this.map.dispose()}if(this.mapPass){this.mapPass.dispose()}}},{key:"copy",value:function copy(e){this.camera=e.camera.clone();this.bias=e.bias;this.radius=e.radius;this.mapSize.copy(e.mapSize);return this}},{key:"clone",value:function clone(){return new this.constructor().copy(this)}},{key:"toJSON",value:function toJSON(){var e={};if(0!==this.bias)e.bias=this.bias;if(0!==this.normalBias)e.normalBias=this.normalBias;if(1!==this.radius)e.radius=this.radius;if(512!==this.mapSize.x||512!==this.mapSize.y)e.mapSize=this.mapSize.toArray();e.camera=this.camera.toJSON(!1).object;delete e.camera.matrix;return e}}]);return e}(),Qu=function(e){_inherits(t,e);var a=_createSuper(t);function t(){var e;_classCallCheck2(this,t);e=a.call(this,new zl(50,1,.5,500));e.focus=1;return e}_createClass2(t,[{key:"updateMatrices",value:function updateMatrices(e){var a=this.camera,r=2*_o*e.angle*this.focus,i=this.mapSize.width/this.mapSize.height,n=e.distance||a.far;if(90!==a.fov||1!==a.aspect||n!==a.far){a.fov=90;a.aspect=1;a.far=n;a.updateProjectionMatrix()}_get(_getPrototypeOf(t.prototype),"updateMatrices",this).call(this,e)}},{key:"copy",value:function copy(e){_get(_getPrototypeOf(t.prototype),"copy",this).call(this,e);this.focus=e.focus;return this}}]);return t}(Ju);Qu.prototype.isSpotLightShadow=!0;var Ku=function(e){_inherits(t,e);var a=_createSuper(t);function t(e,r){var i,n=2<arguments.length&&arguments[2]!==void 0?arguments[2]:0,o=3<arguments.length&&arguments[3]!==void 0?arguments[3]:Math.PI/3,s=4<arguments.length&&arguments[4]!==void 0?arguments[4]:0,l=5<arguments.length&&arguments[5]!==void 0?arguments[5]:1;_classCallCheck2(this,t);i=a.call(this,e,r);i.type="SpotLight";i.position.copy(Ds.DefaultUp);i.updateMatrix();i.target=new Ds;i.distance=n;i.angle=o;i.penumbra=s;i.decay=l;i.shadow=new Qu;return i}_createClass2(t,[{key:"dispose",value:function dispose(){this.shadow.dispose()}},{key:"copy",value:function copy(e){_get(_getPrototypeOf(t.prototype),"copy",this).call(this,e);this.distance=e.distance;this.angle=e.angle;this.penumbra=e.penumbra;this.decay=e.decay;this.target=e.target.clone();this.shadow=e.shadow.clone();return this}},{key:"power",get:function get(){return this.intensity*Math.PI},set:function set(e){this.intensity=e/Math.PI}}]);return t}(ju);Ku.prototype.isSpotLight=!0;var $u=new ls,ep=new Po,tp=new Po,ap=function(e){_inherits(t,e);var a=_createSuper(t);function t(){var e;_classCallCheck2(this,t);e=a.call(this,new zl(90,1,.5,500));e._frameExtents=new bo(4,2);e._viewportCount=6;e._viewports=[new Ao(2,1,1,1),new Ao(0,1,1,1),new Ao(3,1,1,1),new Ao(1,1,1,1),new Ao(3,0,1,1),new Ao(1,0,1,1)];e._cubeDirections=[new Po(1,0,0),new Po(-1,0,0),new Po(0,0,1),new Po(0,0,-1),new Po(0,1,0),new Po(0,-1,0)];e._cubeUps=[new Po(0,1,0),new Po(0,1,0),new Po(0,1,0),new Po(0,1,0),new Po(0,0,1),new Po(0,0,-1)];return e}_createClass2(t,[{key:"updateMatrices",value:function updateMatrices(e){var t=1<arguments.length&&arguments[1]!==void 0?arguments[1]:0,a=this.camera,r=this.matrix,i=e.distance||a.far;if(i!==a.far){a.far=i;a.updateProjectionMatrix()}ep.setFromMatrixPosition(e.matrixWorld);a.position.copy(ep);tp.copy(a.position);tp.add(this._cubeDirections[t]);a.up.copy(this._cubeUps[t]);a.lookAt(tp);a.updateMatrixWorld();r.makeTranslation(-ep.x,-ep.y,-ep.z);$u.multiplyMatrices(a.projectionMatrix,a.matrixWorldInverse);this._frustum.setFromProjectionMatrix($u)}}]);return t}(Ju);ap.prototype.isPointLightShadow=!0;var rp=function(e){_inherits(t,e);var a=_createSuper(t);function t(e,r){var i,n=2<arguments.length&&arguments[2]!==void 0?arguments[2]:0,o=3<arguments.length&&arguments[3]!==void 0?arguments[3]:1;_classCallCheck2(this,t);i=a.call(this,e,r);i.type="PointLight";i.distance=n;i.decay=o;i.shadow=new ap;return i}_createClass2(t,[{key:"dispose",value:function dispose(){this.shadow.dispose()}},{key:"copy",value:function copy(e){_get(_getPrototypeOf(t.prototype),"copy",this).call(this,e);this.distance=e.distance;this.decay=e.decay;this.shadow=e.shadow.clone();return this}},{key:"power",get:function get(){return 4*this.intensity*Math.PI},set:function set(e){this.intensity=e/(4*Math.PI)}}]);return t}(ju);rp.prototype.isPointLight=!0;var ip=function(e){_inherits(t,e);var a=_createSuper(t);function t(){_classCallCheck2(this,t);return a.call(this,new Jl(-5,5,5,-5,.5,500))}return t}(Ju);ip.prototype.isDirectionalLightShadow=!0;var np=function(e){_inherits(t,e);var a=_createSuper(t);function t(e,r){var i;_classCallCheck2(this,t);i=a.call(this,e,r);i.type="DirectionalLight";i.position.copy(Ds.DefaultUp);i.updateMatrix();i.target=new Ds;i.shadow=new ip;return i}_createClass2(t,[{key:"dispose",value:function dispose(){this.shadow.dispose()}},{key:"copy",value:function copy(e){_get(_getPrototypeOf(t.prototype),"copy",this).call(this,e);this.target=e.target.clone();this.shadow=e.shadow.clone();return this}}]);return t}(ju);np.prototype.isDirectionalLight=!0;var op=function(e){_inherits(t,e);var a=_createSuper(t);function t(e,r){var i;_classCallCheck2(this,t);i=a.call(this,e,r);i.type="AmbientLight";return i}return t}(ju);op.prototype.isAmbientLight=!0;var sp=function(e){_inherits(t,e);var a=_createSuper(t);function t(e,r){var i,n=2<arguments.length&&arguments[2]!==void 0?arguments[2]:10,o=3<arguments.length&&arguments[3]!==void 0?arguments[3]:10;_classCallCheck2(this,t);i=a.call(this,e,r);i.type="RectAreaLight";i.width=n;i.height=o;return i}_createClass2(t,[{key:"copy",value:function copy(e){_get(_getPrototypeOf(t.prototype),"copy",this).call(this,e);this.width=e.width;this.height=e.height;return this}},{key:"toJSON",value:function toJSON(e){var a=_get(_getPrototypeOf(t.prototype),"toJSON",this).call(this,e);a.object.width=this.width;a.object.height=this.height;return a}},{key:"power",get:function get(){return this.intensity*this.width*this.height*Math.PI},set:function set(e){this.intensity=e/(this.width*this.height*Math.PI)}}]);return t}(ju);sp.prototype.isRectAreaLight=!0;var lp=function(){function e(){_classCallCheck2(this,e);this.coefficients=[];for(var t=0;9>t;t++){this.coefficients.push(new Po)}}_createClass2(e,[{key:"set",value:function set(e){for(var t=0;9>t;t++){this.coefficients[t].copy(e[t])}return this}},{key:"zero",value:function zero(){for(var e=0;9>e;e++){this.coefficients[e].set(0,0,0)}return this}},{key:"getAt",value:function getAt(e,t){var a=e.x,r=e.y,i=e.z,n=this.coefficients;t.copy(n[0]).multiplyScalar(.282095);t.addScaledVector(n[1],.488603*r);t.addScaledVector(n[2],.488603*i);t.addScaledVector(n[3],.488603*a);t.addScaledVector(n[4],1.092548*(a*r));t.addScaledVector(n[5],1.092548*(r*i));t.addScaledVector(n[6],.315392*(3*i*i-1));t.addScaledVector(n[7],1.092548*(a*i));t.addScaledVector(n[8],.546274*(a*a-r*r));return t}},{key:"getIrradianceAt",value:function getIrradianceAt(e,t){var a=e.x,r=e.y,i=e.z,n=this.coefficients;t.copy(n[0]).multiplyScalar(.886227);t.addScaledVector(n[1],.511664*2*r);t.addScaledVector(n[2],.511664*2*i);t.addScaledVector(n[3],.511664*2*a);t.addScaledVector(n[4],.429043*2*a*r);t.addScaledVector(n[5],.429043*2*r*i);t.addScaledVector(n[6],.743125*i*i-.247708);t.addScaledVector(n[7],.429043*2*a*i);t.addScaledVector(n[8],.429043*(a*a-r*r));return t}},{key:"add",value:function add(e){for(var t=0;9>t;t++){this.coefficients[t].add(e.coefficients[t])}return this}},{key:"addScaledSH",value:function addScaledSH(e,t){for(var a=0;9>a;a++){this.coefficients[a].addScaledVector(e.coefficients[a],t)}return this}},{key:"scale",value:function scale(e){for(var t=0;9>t;t++){this.coefficients[t].multiplyScalar(e)}return this}},{key:"lerp",value:function(e,t){for(var a=0;9>a;a++){this.coefficients[a].lerp(e.coefficients[a],t)}return this}},{key:"equals",value:function(e){for(var t=0;9>t;t++){if(!this.coefficients[t].equals(e.coefficients[t])){return!1}}return!0}},{key:"copy",value:function copy(e){return this.set(e.coefficients)}},{key:"clone",value:function clone(){return new this.constructor().copy(this)}},{key:"fromArray",value:function fromArray(e){for(var t=1<arguments.length&&arguments[1]!==void 0?arguments[1]:0,a=this.coefficients,r=0;9>r;r++){a[r].fromArray(e,t+3*r)}return this}},{key:"toArray",value:function toArray(){for(var e=0<arguments.length&&arguments[0]!==void 0?arguments[0]:[],t=1<arguments.length&&arguments[1]!==void 0?arguments[1]:0,a=this.coefficients,r=0;9>r;r++){a[r].toArray(e,t+3*r)}return e}}],[{key:"getBasisAt",value:function getBasisAt(e,t){var a=e.x,r=e.y,i=e.z;t[0]=.282095;t[1]=.488603*r;t[2]=.488603*i;t[3]=.488603*a;t[4]=1.092548*a*r;t[5]=1.092548*r*i;t[6]=.315392*(3*i*i-1);t[7]=1.092548*a*i;t[8]=.546274*(a*a-r*r)}}]);return e}();lp.prototype.isSphericalHarmonics3=!0;var dp=function(e){_inherits(t,e);var a=_createSuper(t);function t(){var e,r=0<arguments.length&&arguments[0]!==void 0?arguments[0]:new lp,i=1<arguments.length&&arguments[1]!==void 0?arguments[1]:1;_classCallCheck2(this,t);e=a.call(this,void 0,i);e.sh=r;return e}_createClass2(t,[{key:"copy",value:function copy(e){_get(_getPrototypeOf(t.prototype),"copy",this).call(this,e);this.sh.copy(e.sh);return this}},{key:"fromJSON",value:function fromJSON(e){this.intensity=e.intensity;this.sh.fromArray(e.sh);return this}},{key:"toJSON",value:function toJSON(e){var a=_get(_getPrototypeOf(t.prototype),"toJSON",this).call(this,e);a.object.sh=this.sh.toArray();return a}}]);return t}(ju);dp.prototype.isLightProbe=!0;var cp=function(){function e(){_classCallCheck2(this,e)}_createClass2(e,null,[{key:"decodeText",value:function decodeText(e){if("undefined"!=typeof TextDecoder){return new TextDecoder().decode(e)}for(var t="",a=0,r=e.length;a<r;a++){t+=String.fromCharCode(e[a])}try{return decodeURIComponent(escape(t))}catch(a){return t}}},{key:"extractUrlBase",value:function extractUrlBase(e){var t=e.lastIndexOf("/");if(-1===t)return"./";return e.substr(0,t+1)}},{key:"resolveURL",value:function resolveURL(e,t){if("string"!=typeof e||""===e)return"";if(/^https?:\/\//i.test(t)&&/^\//.test(e)){t=t.replace(/(^https?:\/\/[^\/]+).*/i,"$1")}if(/^(https?:)?\/\//i.test(e))return e;if(/^data:.*,.*$/i.test(e))return e;if(/^blob:.*$/i.test(e))return e;return t+e}}]);return e}(),up=function(e){_inherits(t,e);var a=_createSuper(t);function t(){var e;_classCallCheck2(this,t);e=a.call(this);e.type="InstancedBufferGeometry";e.instanceCount=1/0;return e}_createClass2(t,[{key:"copy",value:function copy(e){_get(_getPrototypeOf(t.prototype),"copy",this).call(this,e);this.instanceCount=e.instanceCount;return this}},{key:"clone",value:function clone(){return new this.constructor().copy(this)}},{key:"toJSON",value:function toJSON(){var e=_get(_getPrototypeOf(t.prototype),"toJSON",this).call(this,this);e.instanceCount=this.instanceCount;e.isInstancedBufferGeometry=!0;return e}}]);return t}(pl);up.prototype.isInstancedBufferGeometry=!0;var pp=function(e){_inherits(t,e);var a=_createSuper(t);function t(e){var r;_classCallCheck2(this,t);r=a.call(this,e);if("undefined"==typeof createImageBitmap){console.warn("THREE.ImageBitmapLoader: createImageBitmap() not supported.")}if("undefined"==typeof fetch){console.warn("THREE.ImageBitmapLoader: fetch() not supported.")}r.options={premultiplyAlpha:"none"};return r}_createClass2(t,[{key:"setOptions",value:function setOptions(e){this.options=e;return this}},{key:"load",value:function load(t,a,r,i){if(t===void 0)t="";if(this.path!==void 0)t=this.path+t;t=this.manager.resolveURL(t);var n=this,o=Ou.get(t);if(o!==void 0){n.manager.itemStart(t);setTimeout(function(){if(a)a(o);n.manager.itemEnd(t)},0);return o}var s={credentials:"anonymous"===this.crossOrigin?"same-origin":"include",headers:this.requestHeader};fetch(t,s).then(function(e){return e.blob()}).then(function(e){return createImageBitmap(e,Object.assign(n.options,{colorSpaceConversion:"none"}))}).then(function(e){Ou.add(t,e);if(a)a(e);n.manager.itemEnd(t)}).catch(function(a){if(i)i(a);n.manager.itemError(t);n.manager.itemEnd(t)});n.manager.itemStart(t)}}]);return t}(Uu);pp.prototype.isImageBitmapLoader=!0;var mp,gp={getContext:function getContext(){if(mp===void 0){mp=new(window.AudioContext||window.webkitAudioContext)}return mp},setContext:function setContext(e){mp=e}},fp=function(e){_inherits(t,e);var a=_createSuper(t);function t(e){_classCallCheck2(this,t);return a.call(this,e)}_createClass2(t,[{key:"load",value:function load(t,a,r,i){var n=this,o=new Hu(this.manager);o.setResponseType("arraybuffer");o.setPath(this.path);o.setRequestHeader(this.requestHeader);o.setWithCredentials(this.withCredentials);o.load(t,function(e){try{var r=e.slice(0),o=gp.getContext();o.decodeAudioData(r,function(e){a(e)})}catch(a){if(i){i(a)}else{console.error(a)}n.manager.itemError(t)}},r,i)}}]);return t}(Uu),hp=function(e){_inherits(t,e);var a=_createSuper(t);function t(e,r){var i,n=2<arguments.length&&arguments[2]!==void 0?arguments[2]:1;_classCallCheck2(this,t);i=a.call(this,void 0,n);var o=new Js().set(e),s=new Js().set(r),l=new Po(o.r,o.g,o.b),d=new Po(s.r,s.g,s.b),c=Math.sqrt(Math.PI),u=c*Math.sqrt(.75);i.sh.coefficients[0].copy(l).add(d).multiplyScalar(c);i.sh.coefficients[1].copy(l).sub(d).multiplyScalar(u);return i}return t}(dp);hp.prototype.isHemisphereLightProbe=!0;var vp=function(e){_inherits(t,e);var a=_createSuper(t);function t(e){var r,i=1<arguments.length&&arguments[1]!==void 0?arguments[1]:1;_classCallCheck2(this,t);r=a.call(this,void 0,i);var n=new Js().set(e);r.sh.coefficients[0].set(n.r,n.g,n.b).multiplyScalar(2*Math.sqrt(Math.PI));return r}return t}(dp);vp.prototype.isAmbientLightProbe=!0;var yp=function(){function e(){var t=0<arguments.length&&arguments[0]!==void 0?arguments[0]:!0;_classCallCheck2(this,e);this.autoStart=t;this.startTime=0;this.oldTime=0;this.elapsedTime=0;this.running=!1}_createClass2(e,[{key:"start",value:function start(){this.startTime=Ra();this.oldTime=this.startTime;this.elapsedTime=0;this.running=!0}},{key:"stop",value:function stop(){this.getElapsedTime();this.running=!1;this.autoStart=!1}},{key:"getElapsedTime",value:function getElapsedTime(){this.getDelta();return this.elapsedTime}},{key:"getDelta",value:function getDelta(){var e=0;if(this.autoStart&&!this.running){this.start();return 0}if(this.running){var t=Ra();e=(t-this.oldTime)/1e3;this.oldTime=t;this.elapsedTime+=e}return e}}]);return e}();function Ra(){return("undefined"==typeof performance?Date:performance).now()}var _p=function(e){_inherits(t,e);var a=_createSuper(t);function t(e){var r;_classCallCheck2(this,t);r=a.call(this);r.type="Audio";r.listener=e;r.context=e.context;r.gain=r.context.createGain();r.gain.connect(e.getInput());r.autoplay=!1;r.buffer=null;r.detune=0;r.loop=!1;r.loopStart=0;r.loopEnd=0;r.offset=0;r.duration=void 0;r.playbackRate=1;r.isPlaying=!1;r.hasPlaybackControl=!0;r.source=null;r.sourceType="empty";r._startedAt=0;r._progress=0;r._connected=!1;r.filters=[];return r}_createClass2(t,[{key:"getOutput",value:function getOutput(){return this.gain}},{key:"setNodeSource",value:function setNodeSource(e){this.hasPlaybackControl=!1;this.sourceType="audioNode";this.source=e;this.connect();return this}},{key:"setMediaElementSource",value:function setMediaElementSource(e){this.hasPlaybackControl=!1;this.sourceType="mediaNode";this.source=this.context.createMediaElementSource(e);this.connect();return this}},{key:"setMediaStreamSource",value:function setMediaStreamSource(e){this.hasPlaybackControl=!1;this.sourceType="mediaStreamNode";this.source=this.context.createMediaStreamSource(e);this.connect();return this}},{key:"setBuffer",value:function setBuffer(e){this.buffer=e;this.sourceType="buffer";if(this.autoplay)this.play();return this}},{key:"play",value:function play(){var e=0<arguments.length&&arguments[0]!==void 0?arguments[0]:0;if(!0===this.isPlaying){console.warn("THREE.Audio: Audio is already playing.");return}if(!1===this.hasPlaybackControl){console.warn("THREE.Audio: this Audio has no playback control.");return}this._startedAt=this.context.currentTime+e;var t=this.context.createBufferSource();t.buffer=this.buffer;t.loop=this.loop;t.loopStart=this.loopStart;t.loopEnd=this.loopEnd;t.onended=this.onEnded.bind(this);t.start(this._startedAt,this._progress+this.offset,this.duration);this.isPlaying=!0;this.source=t;this.setDetune(this.detune);this.setPlaybackRate(this.playbackRate);return this.connect()}},{key:"pause",value:function pause(){if(!1===this.hasPlaybackControl){console.warn("THREE.Audio: this Audio has no playback control.");return}if(!0===this.isPlaying){this._progress+=Math.max(this.context.currentTime-this._startedAt,0)*this.playbackRate;if(!0===this.loop){this._progress=this._progress%(this.duration||this.buffer.duration)}this.source.stop();this.source.onended=null;this.isPlaying=!1}return this}},{key:"stop",value:function stop(){if(!1===this.hasPlaybackControl){console.warn("THREE.Audio: this Audio has no playback control.");return}this._progress=0;this.source.stop();this.source.onended=null;this.isPlaying=!1;return this}},{key:"connect",value:function connect(){if(0<this.filters.length){this.source.connect(this.filters[0]);for(var e=1,t=this.filters.length;e<t;e++){this.filters[e-1].connect(this.filters[e])}this.filters[this.filters.length-1].connect(this.getOutput())}else{this.source.connect(this.getOutput())}this._connected=!0;return this}},{key:"disconnect",value:function disconnect(){if(0<this.filters.length){this.source.disconnect(this.filters[0]);for(var e=1,t=this.filters.length;e<t;e++){this.filters[e-1].disconnect(this.filters[e])}this.filters[this.filters.length-1].disconnect(this.getOutput())}else{this.source.disconnect(this.getOutput())}this._connected=!1;return this}},{key:"getFilters",value:function getFilters(){return this.filters}},{key:"setFilters",value:function setFilters(e){if(!e)e=[];if(!0===this._connected){this.disconnect();this.filters=e.slice();this.connect()}else{this.filters=e.slice()}return this}},{key:"setDetune",value:function setDetune(e){this.detune=e;if(this.source.detune===void 0)return;if(!0===this.isPlaying){this.source.detune.setTargetAtTime(this.detune,this.context.currentTime,.01)}return this}},{key:"getDetune",value:function getDetune(){return this.detune}},{key:"getFilter",value:function getFilter(){return this.getFilters()[0]}},{key:"setFilter",value:function setFilter(e){return this.setFilters(e?[e]:[])}},{key:"setPlaybackRate",value:function setPlaybackRate(e){if(!1===this.hasPlaybackControl){console.warn("THREE.Audio: this Audio has no playback control.");return}this.playbackRate=e;if(!0===this.isPlaying){this.source.playbackRate.setTargetAtTime(this.playbackRate,this.context.currentTime,.01)}return this}},{key:"getPlaybackRate",value:function getPlaybackRate(){return this.playbackRate}},{key:"onEnded",value:function onEnded(){this.isPlaying=!1}},{key:"getLoop",value:function getLoop(){if(!1===this.hasPlaybackControl){console.warn("THREE.Audio: this Audio has no playback control.");return!1}return this.loop}},{key:"setLoop",value:function setLoop(e){if(!1===this.hasPlaybackControl){console.warn("THREE.Audio: this Audio has no playback control.");return}this.loop=e;if(!0===this.isPlaying){this.source.loop=this.loop}return this}},{key:"setLoopStart",value:function setLoopStart(e){this.loopStart=e;return this}},{key:"setLoopEnd",value:function setLoopEnd(e){this.loopEnd=e;return this}},{key:"getVolume",value:function getVolume(){return this.gain.gain.value}},{key:"setVolume",value:function setVolume(e){this.gain.gain.setTargetAtTime(e,this.context.currentTime,.01);return this}}]);return t}(Ds),xp=function(){function e(t,a,r){_classCallCheck2(this,e);this.binding=t;this.valueSize=r;var i,n,o;switch(a){case"quaternion":i=this._slerp;n=this._slerpAdditive;o=this._setAdditiveIdentityQuaternion;this.buffer=new Float64Array(6*r);this._workIndex=5;break;case"string":case"bool":i=this._select;n=this._select;o=this._setAdditiveIdentityOther;this.buffer=Array(5*r);break;default:i=this._lerp;n=this._lerpAdditive;o=this._setAdditiveIdentityNumeric;this.buffer=new Float64Array(5*r);}this._mixBufferRegion=i;this._mixBufferRegionAdditive=n;this._setIdentity=o;this._origIndex=3;this._addIndex=4;this.cumulativeWeight=0;this.cumulativeWeightAdditive=0;this.useCount=0;this.referenceCount=0}_createClass2(e,[{key:"accumulate",value:function accumulate(e,t){var a=this.buffer,r=this.valueSize,i=e*r+r,n=this.cumulativeWeight;if(0===n){for(var o=0;o!==r;++o){a[i+o]=a[o]}n=t}else{n+=t;var s=t/n;this._mixBufferRegion(a,i,0,s,r)}this.cumulativeWeight=n}},{key:"accumulateAdditive",value:function accumulateAdditive(e){var t=this.buffer,a=this.valueSize,r=a*this._addIndex;if(0===this.cumulativeWeightAdditive){this._setIdentity()}this._mixBufferRegionAdditive(t,r,0,e,a);this.cumulativeWeightAdditive+=e}},{key:"apply",value:function apply(e){var t=this.valueSize,a=this.buffer,r=e*t+t,i=this.cumulativeWeight,n=this.cumulativeWeightAdditive,o=this.binding;this.cumulativeWeight=0;this.cumulativeWeightAdditive=0;if(1>i){var s=t*this._origIndex;this._mixBufferRegion(a,r,s,1-i,t)}if(0<n){this._mixBufferRegionAdditive(a,r,this._addIndex*t,1,t)}for(var l=t;l!==t+t;++l){if(a[l]!==a[l+t]){o.setValue(a,r);break}}}},{key:"saveOriginalState",value:function saveOriginalState(){var e=this.binding,t=this.buffer,a=this.valueSize,r=a*this._origIndex;e.getValue(t,r);for(var i=a;i!==r;++i){t[i]=t[r+i%a]}this._setIdentity();this.cumulativeWeight=0;this.cumulativeWeightAdditive=0}},{key:"restoreOriginalState",value:function restoreOriginalState(){var e=3*this.valueSize;this.binding.setValue(this.buffer,e)}},{key:"_setAdditiveIdentityNumeric",value:function _setAdditiveIdentityNumeric(){for(var e=this._addIndex*this.valueSize,t=e+this.valueSize,a=e;a<t;a++){this.buffer[a]=0}}},{key:"_setAdditiveIdentityQuaternion",value:function _setAdditiveIdentityQuaternion(){this._setAdditiveIdentityNumeric();this.buffer[this._addIndex*this.valueSize+3]=1}},{key:"_setAdditiveIdentityOther",value:function _setAdditiveIdentityOther(){for(var e=this._origIndex*this.valueSize,t=this._addIndex*this.valueSize,a=0;a<this.valueSize;a++){this.buffer[t+a]=this.buffer[e+a]}}},{key:"_select",value:function _select(e,a,r,i,t){if(.5<=i){for(var n=0;n!==t;++n){e[a+n]=e[r+n]}}}},{key:"_slerp",value:function _slerp(e,a,r,i){Ro.slerpFlat(e,a,e,a,e,r,i)}},{key:"_slerpAdditive",value:function _slerpAdditive(e,a,r,i,t){var n=this._workIndex*t;Ro.multiplyQuaternionsFlat(e,n,e,a,e,r);Ro.slerpFlat(e,a,e,a,e,n,i)}},{key:"_lerp",value:function _lerp(e,a,r,i,t){for(var n=0,o;n!==t;++n){o=a+n;e[o]=e[o]*(1-i)+e[r+n]*i}}},{key:"_lerpAdditive",value:function _lerpAdditive(e,a,r,i,t){for(var n=0,o;n!==t;++n){o=a+n;e[o]=e[o]+e[r+n]*i}}}]);return e}(),bp="\\[\\]\\.:\\/",Sp=new RegExp("["+bp+"]","g"),Mp="[^"+bp+"]",Tp="[^"+bp.replace("\\.","")+"]",Ep=/((?:WC+[\/:])*)/.source.replace("WC",Mp),wp=/(WCOD+)?/.source.replace("WCOD",Tp),Ap=/(?:\.(WC+)(?:\[(.+)\])?)?/.source.replace("WC",Mp),kp=/\.(WC+)(?:\[(.+)\])?/.source.replace("WC",Mp),Cp=new RegExp("^"+Ep+wp+Ap+kp+"$"),Lp=["material","materials","bones"],Rp=function(){function e(t,a,r){_classCallCheck2(this,e);var i=r||Pp.parseTrackName(a);this._targetGroup=t;this._bindings=t.subscribe_(a,i)}_createClass2(e,[{key:"getValue",value:function getValue(e,t){this.bind();var a=this._targetGroup.nCachedObjects_,r=this._bindings[a];if(r!==void 0)r.getValue(e,t)}},{key:"setValue",value:function setValue(e,t){for(var a=this._bindings,r=this._targetGroup.nCachedObjects_,i=a.length;r!==i;++r){a[r].setValue(e,t)}}},{key:"bind",value:function bind(){for(var e=this._bindings,t=this._targetGroup.nCachedObjects_,a=e.length;t!==a;++t){e[t].bind()}}},{key:"unbind",value:function unbind(){for(var e=this._bindings,t=this._targetGroup.nCachedObjects_,a=e.length;t!==a;++t){e[t].unbind()}}}]);return e}(),Pp=function(){function e(t,a,r){_classCallCheck2(this,e);this.path=a;this.parsedPath=r||e.parseTrackName(a);this.node=e.findNode(t,this.parsedPath.nodeName)||t;this.rootNode=t;this.getValue=this._getValue_unbound;this.setValue=this._setValue_unbound}_createClass2(e,[{key:"_getValue_unavailable",value:function _getValue_unavailable(){}},{key:"_setValue_unavailable",value:function _setValue_unavailable(){}},{key:"_getValue_direct",value:function _getValue_direct(e,t){e[t]=this.targetObject[this.propertyName]}},{key:"_getValue_array",value:function _getValue_array(e,t){for(var a=this.resolvedProperty,r=0,i=a.length;r!==i;++r){e[t++]=a[r]}}},{key:"_getValue_arrayElement",value:function _getValue_arrayElement(e,t){e[t]=this.resolvedProperty[this.propertyIndex]}},{key:"_getValue_toArray",value:function _getValue_toArray(e,t){this.resolvedProperty.toArray(e,t)}},{key:"_setValue_direct",value:function _setValue_direct(e,t){this.targetObject[this.propertyName]=e[t]}},{key:"_setValue_direct_setNeedsUpdate",value:function _setValue_direct_setNeedsUpdate(e,t){this.targetObject[this.propertyName]=e[t];this.targetObject.needsUpdate=!0}},{key:"_setValue_direct_setMatrixWorldNeedsUpdate",value:function _setValue_direct_setMatrixWorldNeedsUpdate(e,t){this.targetObject[this.propertyName]=e[t];this.targetObject.matrixWorldNeedsUpdate=!0}},{key:"_setValue_array",value:function _setValue_array(e,t){for(var a=this.resolvedProperty,r=0,i=a.length;r!==i;++r){a[r]=e[t++]}}},{key:"_setValue_array_setNeedsUpdate",value:function _setValue_array_setNeedsUpdate(e,t){for(var a=this.resolvedProperty,r=0,i=a.length;r!==i;++r){a[r]=e[t++]}this.targetObject.needsUpdate=!0}},{key:"_setValue_array_setMatrixWorldNeedsUpdate",value:function _setValue_array_setMatrixWorldNeedsUpdate(e,t){for(var a=this.resolvedProperty,r=0,i=a.length;r!==i;++r){a[r]=e[t++]}this.targetObject.matrixWorldNeedsUpdate=!0}},{key:"_setValue_arrayElement",value:function _setValue_arrayElement(e,t){this.resolvedProperty[this.propertyIndex]=e[t]}},{key:"_setValue_arrayElement_setNeedsUpdate",value:function _setValue_arrayElement_setNeedsUpdate(e,t){this.resolvedProperty[this.propertyIndex]=e[t];this.targetObject.needsUpdate=!0}},{key:"_setValue_arrayElement_setMatrixWorldNeedsUpdate",value:function _setValue_arrayElement_setMatrixWorldNeedsUpdate(e,t){this.resolvedProperty[this.propertyIndex]=e[t];this.targetObject.matrixWorldNeedsUpdate=!0}},{key:"_setValue_fromArray",value:function _setValue_fromArray(e,t){this.resolvedProperty.fromArray(e,t)}},{key:"_setValue_fromArray_setNeedsUpdate",value:function _setValue_fromArray_setNeedsUpdate(e,t){this.resolvedProperty.fromArray(e,t);this.targetObject.needsUpdate=!0}},{key:"_setValue_fromArray_setMatrixWorldNeedsUpdate",value:function _setValue_fromArray_setMatrixWorldNeedsUpdate(e,t){this.resolvedProperty.fromArray(e,t);this.targetObject.matrixWorldNeedsUpdate=!0}},{key:"_getValue_unbound",value:function _getValue_unbound(e,t){this.bind();this.getValue(e,t)}},{key:"_setValue_unbound",value:function _setValue_unbound(e,t){this.bind();this.setValue(e,t)}},{key:"bind",value:function bind(){var t=this.node,a=this.parsedPath,r=a.objectName,i=a.propertyName,n=a.propertyIndex;if(!t){t=e.findNode(this.rootNode,a.nodeName)||this.rootNode;this.node=t}this.getValue=this._getValue_unavailable;this.setValue=this._setValue_unavailable;if(!t){console.error("THREE.PropertyBinding: Trying to update node for track: "+this.path+" but it wasn't found.");return}if(r){var d=a.objectIndex;switch(r){case"materials":if(!t.material){console.error("THREE.PropertyBinding: Can not bind to material as node does not have a material.",this);return}if(!t.material.materials){console.error("THREE.PropertyBinding: Can not bind to material.materials as node.material does not have a materials array.",this);return}t=t.material.materials;break;case"bones":if(!t.skeleton){console.error("THREE.PropertyBinding: Can not bind to bones as node does not have a skeleton.",this);return}t=t.skeleton.bones;for(var c=0;c<t.length;c++){if(t[c].name===d){d=c;break}}break;default:if(t[r]===void 0){console.error("THREE.PropertyBinding: Can not bind to objectName of node undefined.",this);return}t=t[r];}if(d!==void 0){if(t[d]===void 0){console.error("THREE.PropertyBinding: Trying to bind to objectIndex of objectName, but is undefined.",this,t);return}t=t[d]}}var o=t[i];if(o===void 0){var u=a.nodeName;console.error("THREE.PropertyBinding: Trying to update property for track: "+u+"."+i+" but it wasn't found.",t);return}var s=this.Versioning.None;this.targetObject=t;if(t.needsUpdate!==void 0){s=this.Versioning.NeedsUpdate}else if(t.matrixWorldNeedsUpdate!==void 0){s=this.Versioning.MatrixWorldNeedsUpdate}var l=this.BindingType.Direct;if(n!==void 0){if("morphTargetInfluences"===i){if(!t.geometry){console.error("THREE.PropertyBinding: Can not bind to morphTargetInfluences because node does not have a geometry.",this);return}if(t.geometry.isBufferGeometry){if(!t.geometry.morphAttributes){console.error("THREE.PropertyBinding: Can not bind to morphTargetInfluences because node does not have a geometry.morphAttributes.",this);return}if(t.morphTargetDictionary[n]!==void 0){n=t.morphTargetDictionary[n]}}else{console.error("THREE.PropertyBinding: Can not bind to morphTargetInfluences on THREE.Geometry. Use THREE.BufferGeometry instead.",this);return}}l=this.BindingType.ArrayElement;this.resolvedProperty=o;this.propertyIndex=n}else if(o.fromArray!==void 0&&o.toArray!==void 0){l=this.BindingType.HasFromToArray;this.resolvedProperty=o}else if(Array.isArray(o)){l=this.BindingType.EntireArray;this.resolvedProperty=o}else{this.propertyName=i}this.getValue=this.GetterByBindingType[l];this.setValue=this.SetterByBindingTypeAndVersioning[l][s]}},{key:"unbind",value:function unbind(){this.node=null;this.getValue=this._getValue_unbound;this.setValue=this._setValue_unbound}}],[{key:"create",value:function create(t,a,r){if(!(t&&t.isAnimationObjectGroup)){return new e(t,a,r)}else{return new e.Composite(t,a,r)}}},{key:"sanitizeNodeName",value:function sanitizeNodeName(e){return e.replace(/\s/g,"_").replace(Sp,"")}},{key:"parseTrackName",value:function parseTrackName(e){var t=Cp.exec(e);if(!t){throw new Error("PropertyBinding: Cannot parse trackName: "+e)}var a={nodeName:t[2],objectName:t[3],objectIndex:t[4],propertyName:t[5],propertyIndex:t[6]},r=a.nodeName&&a.nodeName.lastIndexOf(".");if(r!==void 0&&-1!==r){var i=a.nodeName.substring(r+1);if(-1!==Lp.indexOf(i)){a.nodeName=a.nodeName.substring(0,r);a.objectName=i}}if(null===a.propertyName||0===a.propertyName.length){throw new Error("PropertyBinding: can not parse propertyName from trackName: "+e)}return a}},{key:"findNode",value:function findNode(e,t){if(!t||""===t||"."===t||-1===t||t===e.name||t===e.uuid){return e}if(e.skeleton){var i=e.skeleton.getBoneByName(t);if(i!==void 0){return i}}if(e.children){var a=function(e){for(var r=0,i;r<e.length;r++){i=e[r];if(i.name===t||i.uuid===t){return i}var n=a(i.children);if(n)return n}return null},r=a(e.children);if(r){return r}}return null}}]);return e}();Pp.Composite=Rp;Pp.prototype.BindingType={Direct:0,EntireArray:1,ArrayElement:2,HasFromToArray:3};Pp.prototype.Versioning={None:0,NeedsUpdate:1,MatrixWorldNeedsUpdate:2};Pp.prototype.GetterByBindingType=[Pp.prototype._getValue_direct,Pp.prototype._getValue_array,Pp.prototype._getValue_arrayElement,Pp.prototype._getValue_toArray];Pp.prototype.SetterByBindingTypeAndVersioning=[[Pp.prototype._setValue_direct,Pp.prototype._setValue_direct_setNeedsUpdate,Pp.prototype._setValue_direct_setMatrixWorldNeedsUpdate],[Pp.prototype._setValue_array,Pp.prototype._setValue_array_setNeedsUpdate,Pp.prototype._setValue_array_setMatrixWorldNeedsUpdate],[Pp.prototype._setValue_arrayElement,Pp.prototype._setValue_arrayElement_setNeedsUpdate,Pp.prototype._setValue_arrayElement_setMatrixWorldNeedsUpdate],[Pp.prototype._setValue_fromArray,Pp.prototype._setValue_fromArray_setNeedsUpdate,Pp.prototype._setValue_fromArray_setMatrixWorldNeedsUpdate]];var Dp=function(){function e(t,a){var r=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null,i=3<arguments.length&&arguments[3]!==void 0?arguments[3]:a.blendMode;_classCallCheck2(this,e);this._mixer=t;this._clip=a;this._localRoot=r;this.blendMode=i;for(var n=a.tracks,o=n.length,s=Array(o),l={endingStart:Xn,endingEnd:Xn},d=0,c;d!==o;++d){c=n[d].createInterpolant(null);s[d]=c;c.settings=l}this._interpolantSettings=l;this._interpolants=s;this._propertyBindings=Array(o);this._cacheIndex=null;this._byClipCacheIndex=null;this._timeScaleInterpolant=null;this._weightInterpolant=null;this.loop=Gn;this._loopCount=-1;this._startTime=null;this.time=0;this.timeScale=1;this._effectiveTimeScale=1;this.weight=1;this._effectiveWeight=1;this.repetitions=1/0;this.paused=!1;this.enabled=!0;this.clampWhenFinished=!1;this.zeroSlopeAtStart=!0;this.zeroSlopeAtEnd=!0}_createClass2(e,[{key:"play",value:function play(){this._mixer._activateAction(this);return this}},{key:"stop",value:function stop(){this._mixer._deactivateAction(this);return this.reset()}},{key:"reset",value:function reset(){this.paused=!1;this.enabled=!0;this.time=0;this._loopCount=-1;this._startTime=null;return this.stopFading().stopWarping()}},{key:"isRunning",value:function isRunning(){return this.enabled&&!this.paused&&0!==this.timeScale&&null===this._startTime&&this._mixer._isActiveAction(this)}},{key:"isScheduled",value:function isScheduled(){return this._mixer._isActiveAction(this)}},{key:"startAt",value:function startAt(e){this._startTime=e;return this}},{key:"setLoop",value:function setLoop(e,t){this.loop=e;this.repetitions=t;return this}},{key:"setEffectiveWeight",value:function setEffectiveWeight(e){this.weight=e;this._effectiveWeight=this.enabled?e:0;return this.stopFading()}},{key:"getEffectiveWeight",value:function getEffectiveWeight(){return this._effectiveWeight}},{key:"fadeIn",value:function fadeIn(e){return this._scheduleFading(e,0,1)}},{key:"fadeOut",value:function fadeOut(e){return this._scheduleFading(e,1,0)}},{key:"crossFadeFrom",value:function crossFadeFrom(e,t,a){e.fadeOut(t);this.fadeIn(t);if(a){var r=this._clip.duration,i=e._clip.duration;e.warp(1,i/r,t);this.warp(r/i,1,t)}return this}},{key:"crossFadeTo",value:function crossFadeTo(e,t,a){return e.crossFadeFrom(this,t,a)}},{key:"stopFading",value:function stopFading(){var e=this._weightInterpolant;if(null!==e){this._weightInterpolant=null;this._mixer._takeBackControlInterpolant(e)}return this}},{key:"setEffectiveTimeScale",value:function setEffectiveTimeScale(e){this.timeScale=e;this._effectiveTimeScale=this.paused?0:e;return this.stopWarping()}},{key:"getEffectiveTimeScale",value:function getEffectiveTimeScale(){return this._effectiveTimeScale}},{key:"setDuration",value:function setDuration(e){this.timeScale=this._clip.duration/e;return this.stopWarping()}},{key:"syncWith",value:function syncWith(e){this.time=e.time;this.timeScale=e.timeScale;return this.stopWarping()}},{key:"halt",value:function halt(e){return this.warp(this._effectiveTimeScale,0,e)}},{key:"warp",value:function warp(e,t,a){var r=this._mixer,i=r.time,n=this.timeScale,o=this._timeScaleInterpolant;if(null===o){o=r._lendControlInterpolant();this._timeScaleInterpolant=o}var s=o.parameterPositions,l=o.sampleValues;s[0]=i;s[1]=i+a;l[0]=e/n;l[1]=t/n;return this}},{key:"stopWarping",value:function stopWarping(){var e=this._timeScaleInterpolant;if(null!==e){this._timeScaleInterpolant=null;this._mixer._takeBackControlInterpolant(e)}return this}},{key:"getMixer",value:function getMixer(){return this._mixer}},{key:"getClip",value:function getClip(){return this._clip}},{key:"getRoot",value:function getRoot(){return this._localRoot||this._mixer._root}},{key:"_update",value:function _update(e,t,a,r){if(!this.enabled){this._updateWeight(e);return}var i=this._startTime;if(null!==i){var d=(e-i)*a;if(0>d||0===a){return}this._startTime=null;t=a*d}t*=this._updateTimeScale(e);var n=this._updateTime(t),o=this._updateWeight(e);if(0<o){var s=this._interpolants,l=this._propertyBindings;switch(this.blendMode){case Qn:for(var c=0,u=s.length;c!==u;++c){s[c].evaluate(n);l[c].accumulateAdditive(o)}break;case Jn:default:for(var p=0,m=s.length;p!==m;++p){s[p].evaluate(n);l[p].accumulate(r,o)}}}}},{key:"_updateWeight",value:function _updateWeight(e){var t=0;if(this.enabled){t=this.weight;var a=this._weightInterpolant;if(null!==a){var r=a.evaluate(e)[0];t*=r;if(e>a.parameterPositions[1]){this.stopFading();if(0===r){this.enabled=!1}}}}this._effectiveWeight=t;return t}},{key:"_updateTimeScale",value:function _updateTimeScale(e){var t=0;if(!this.paused){t=this.timeScale;var a=this._timeScaleInterpolant;if(null!==a){var r=a.evaluate(e)[0];t*=r;if(e>a.parameterPositions[1]){this.stopWarping();if(0===t){this.paused=!0}else{this.timeScale=t}}}}this._effectiveTimeScale=t;return t}},{key:"_updateTime",value:function _updateTime(e){var t=this._clip.duration,a=this.loop,r=this.time+e,i=this._loopCount,n=a===Vn;if(0===e){if(-1===i)return r;return n&&1==(1&i)?t-r:r}if(a===Hn){if(-1===i){this._loopCount=0;this._setEndings(!0,!0,!1)}handle_stop:{if(r>=t){r=t}else if(0>r){r=0}else{this.time=r;break handle_stop}if(this.clampWhenFinished)this.paused=!0;else this.enabled=!1;this.time=r;this._mixer.dispatchEvent({type:"finished",action:this,direction:0>e?-1:1})}}else{if(-1===i){if(0<=e){i=0;this._setEndings(!0,0===this.repetitions,n)}else{this._setEndings(0===this.repetitions,!0,n)}}if(r>=t||0>r){var o=Math.floor(r/t);r-=t*o;i+=Math.abs(o);var s=this.repetitions-i;if(0>=s){if(this.clampWhenFinished)this.paused=!0;else this.enabled=!1;r=0<e?t:0;this.time=r;this._mixer.dispatchEvent({type:"finished",action:this,direction:0<e?1:-1})}else{if(1===s){var l=0>e;this._setEndings(l,!l,n)}else{this._setEndings(!1,!1,n)}this._loopCount=i;this.time=r;this._mixer.dispatchEvent({type:"loop",action:this,loopDelta:o})}}else{this.time=r}if(n&&1==(1&i)){return t-r}}return r}},{key:"_setEndings",value:function _setEndings(e,t,a){var r=this._interpolantSettings;if(a){r.endingStart=Yn;r.endingEnd=Yn}else{if(e){r.endingStart=this.zeroSlopeAtStart?Yn:Xn}else{r.endingStart=Zn}if(t){r.endingEnd=this.zeroSlopeAtEnd?Yn:Xn}else{r.endingEnd=Zn}}}},{key:"_scheduleFading",value:function _scheduleFading(e,t,a){var r=this._mixer,i=r.time,n=this._weightInterpolant;if(null===n){n=r._lendControlInterpolant();this._weightInterpolant=n}var o=n.parameterPositions,s=n.sampleValues;o[0]=i;s[0]=t;o[1]=i+e;s[1]=a;return this}}]);return e}(),Ip=function(e){_inherits(t,e);var a=_createSuper(t);function t(e){var r;_classCallCheck2(this,t);r=a.call(this);r._root=e;r._initMemoryManager();r._accuIndex=0;r.time=0;r.timeScale=1;return r}_createClass2(t,[{key:"_bindAction",value:function _bindAction(e,t){var a=e._localRoot||this._root,r=e._clip.tracks,i=r.length,n=e._propertyBindings,o=e._interpolants,s=a.uuid,l=this._bindingsByRootAndName,d=l[s];if(d===void 0){d={};l[s]=d}for(var m=0;m!==i;++m){var c=r[m],u=c.name,p=d[u];if(p!==void 0){n[m]=p}else{p=n[m];if(p!==void 0){if(null===p._cacheIndex){++p.referenceCount;this._addInactiveBinding(p,s,u)}continue}var g=t&&t._propertyBindings[m].binding.parsedPath;p=new xp(Pp.create(a,u,g),c.ValueTypeName,c.getValueSize());++p.referenceCount;this._addInactiveBinding(p,s,u);n[m]=p}o[m].resultBuffer=p.buffer}}},{key:"_activateAction",value:function _activateAction(e){if(!this._isActiveAction(e)){if(null===e._cacheIndex){var n=(e._localRoot||this._root).uuid,o=e._clip.uuid,s=this._actionsByClip[o];this._bindAction(e,s&&s.knownActions[0]);this._addInactiveAction(e,o,n)}for(var t=e._propertyBindings,a=0,r=t.length,i;a!==r;++a){i=t[a];if(0==i.useCount++){this._lendBinding(i);i.saveOriginalState()}}this._lendAction(e)}}},{key:"_deactivateAction",value:function _deactivateAction(e){if(this._isActiveAction(e)){for(var t=e._propertyBindings,a=0,r=t.length,i;a!==r;++a){i=t[a];if(0==--i.useCount){i.restoreOriginalState();this._takeBackBinding(i)}}this._takeBackAction(e)}}},{key:"_initMemoryManager",value:function _initMemoryManager(){this._actions=[];this._nActiveActions=0;this._actionsByClip={};this._bindings=[];this._nActiveBindings=0;this._bindingsByRootAndName={};this._controlInterpolants=[];this._nActiveControlInterpolants=0;var e=this;this.stats={actions:{get total(){return e._actions.length},get inUse(){return e._nActiveActions}},bindings:{get total(){return e._bindings.length},get inUse(){return e._nActiveBindings}},controlInterpolants:{get total(){return e._controlInterpolants.length},get inUse(){return e._nActiveControlInterpolants}}}}},{key:"_isActiveAction",value:function _isActiveAction(e){var t=e._cacheIndex;return null!==t&&t<this._nActiveActions}},{key:"_addInactiveAction",value:function _addInactiveAction(e,t,a){var r=this._actions,i=this._actionsByClip,n=i[t];if(n===void 0){n={knownActions:[e],actionByRoot:{}};e._byClipCacheIndex=0;i[t]=n}else{var o=n.knownActions;e._byClipCacheIndex=o.length;o.push(e)}e._cacheIndex=r.length;r.push(e);n.actionByRoot[a]=e}},{key:"_removeInactiveAction",value:function _removeInactiveAction(e){var t=this._actions,a=t[t.length-1],r=e._cacheIndex;a._cacheIndex=r;t[r]=a;t.pop();e._cacheIndex=null;var i=e._clip.uuid,n=this._actionsByClip,o=n[i],s=o.knownActions,l=s[s.length-1],d=e._byClipCacheIndex;l._byClipCacheIndex=d;s[d]=l;s.pop();e._byClipCacheIndex=null;var c=o.actionByRoot,u=(e._localRoot||this._root).uuid;delete c[u];if(0===s.length){delete n[i]}this._removeInactiveBindingsForAction(e)}},{key:"_removeInactiveBindingsForAction",value:function _removeInactiveBindingsForAction(e){for(var t=e._propertyBindings,a=0,r=t.length,i;a!==r;++a){i=t[a];if(0==--i.referenceCount){this._removeInactiveBinding(i)}}}},{key:"_lendAction",value:function _lendAction(e){var t=this._actions,a=e._cacheIndex,r=this._nActiveActions++,i=t[r];e._cacheIndex=r;t[r]=e;i._cacheIndex=a;t[a]=i}},{key:"_takeBackAction",value:function _takeBackAction(e){var t=this._actions,a=e._cacheIndex,r=--this._nActiveActions,i=t[r];e._cacheIndex=r;t[r]=e;i._cacheIndex=a;t[a]=i}},{key:"_addInactiveBinding",value:function _addInactiveBinding(e,t,a){var r=this._bindingsByRootAndName,i=this._bindings,n=r[t];if(n===void 0){n={};r[t]=n}n[a]=e;e._cacheIndex=i.length;i.push(e)}},{key:"_removeInactiveBinding",value:function _removeInactiveBinding(e){var t=this._bindings,a=e.binding,r=a.rootNode.uuid,i=a.path,n=this._bindingsByRootAndName,o=n[r],s=t[t.length-1],l=e._cacheIndex;s._cacheIndex=l;t[l]=s;t.pop();delete o[i];if(0===Object.keys(o).length){delete n[r]}}},{key:"_lendBinding",value:function _lendBinding(e){var t=this._bindings,a=e._cacheIndex,r=this._nActiveBindings++,i=t[r];e._cacheIndex=r;t[r]=e;i._cacheIndex=a;t[a]=i}},{key:"_takeBackBinding",value:function _takeBackBinding(e){var t=this._bindings,a=e._cacheIndex,r=--this._nActiveBindings,i=t[r];e._cacheIndex=r;t[r]=e;i._cacheIndex=a;t[a]=i}},{key:"_lendControlInterpolant",value:function _lendControlInterpolant(){var e=this._controlInterpolants,t=this._nActiveControlInterpolants++,a=e[t];if(a===void 0){a=new wu(new Float32Array(2),new Float32Array(2),1,this._controlInterpolantsResultBuffer);a.__cacheIndex=t;e[t]=a}return a}},{key:"_takeBackControlInterpolant",value:function _takeBackControlInterpolant(e){var t=this._controlInterpolants,a=e.__cacheIndex,r=--this._nActiveControlInterpolants,i=t[r];e.__cacheIndex=r;t[r]=e;i.__cacheIndex=a;t[a]=i}},{key:"clipAction",value:function clipAction(e,t,a){var r=t||this._root,i=r.uuid,n="string"==typeof e?Nu.findByName(r,e):e,o=null!==n?n.uuid:e,s=this._actionsByClip[o],l=null;if(a===void 0){if(null!==n){a=n.blendMode}else{a=Jn}}if(s!==void 0){var c=s.actionByRoot[i];if(c!==void 0&&c.blendMode===a){return c}l=s.knownActions[0];if(null===n)n=l._clip}if(null===n)return null;var d=new Dp(this,n,t,a);this._bindAction(d,l);this._addInactiveAction(d,o,i);return d}},{key:"existingAction",value:function existingAction(e,t){var a=t||this._root,r=a.uuid,i="string"==typeof e?Nu.findByName(a,e):e,n=i?i.uuid:e,o=this._actionsByClip[n];if(o!==void 0){return o.actionByRoot[r]||null}return null}},{key:"stopAllAction",value:function stopAllAction(){for(var e=this._actions,t=this._nActiveActions,a=t-1;0<=a;--a){e[a].stop()}return this}},{key:"update",value:function update(e){e*=this.timeScale;for(var t=this._actions,a=this._nActiveActions,r=this.time+=e,i=Math.sign(e),n=this._accuIndex^=1,o=0,s;o!==a;++o){s=t[o];s._update(r,e,i,n)}for(var l=this._bindings,d=this._nActiveBindings,c=0;c!==d;++c){l[c].apply(n)}return this}},{key:"setTime",value:function setTime(e){this.time=0;for(var t=0;t<this._actions.length;t++){this._actions[t].time=0}return this.update(e)}},{key:"getRoot",value:function getRoot(){return this._root}},{key:"uncacheClip",value:function uncacheClip(e){var t=this._actions,a=e.uuid,r=this._actionsByClip,i=r[a];if(i!==void 0){for(var o=i.knownActions,s=0,l=o.length,n;s!==l;++s){n=o[s];this._deactivateAction(n);var d=n._cacheIndex,c=t[t.length-1];n._cacheIndex=null;n._byClipCacheIndex=null;c._cacheIndex=d;t[d]=c;t.pop();this._removeInactiveBindingsForAction(n)}delete r[a]}}},{key:"uncacheRoot",value:function uncacheRoot(e){var t=e.uuid,a=this._actionsByClip;for(var n in a){var o=a[n].actionByRoot,s=o[t];if(s!==void 0){this._deactivateAction(s);this._removeInactiveAction(s)}}var r=this._bindingsByRootAndName,i=r[t];if(i!==void 0){for(var l in i){var d=i[l];d.restoreOriginalState();this._removeInactiveBinding(d)}}}},{key:"uncacheAction",value:function uncacheAction(e,t){var a=this.existingAction(e,t);if(null!==a){this._deactivateAction(a);this._removeInactiveAction(a)}}}]);return t}(ho);Ip.prototype._controlInterpolantsResultBuffer=new Float32Array(1);var zp=function(e){_inherits(t,e);var a=_createSuper(t);function t(e,r){var i,n=2<arguments.length&&arguments[2]!==void 0?arguments[2]:1;_classCallCheck2(this,t);i=a.call(this,e,r);i.meshPerAttribute=n;return i}_createClass2(t,[{key:"copy",value:function copy(e){_get(_getPrototypeOf(t.prototype),"copy",this).call(this,e);this.meshPerAttribute=e.meshPerAttribute;return this}},{key:"clone",value:function clone(e){var a=_get(_getPrototypeOf(t.prototype),"clone",this).call(this,e);a.meshPerAttribute=this.meshPerAttribute;return a}},{key:"toJSON",value:function toJSON(e){var a=_get(_getPrototypeOf(t.prototype),"toJSON",this).call(this,e);a.isInstancedInterleavedBuffer=!0;a.meshPerAttribute=this.meshPerAttribute;return a}}]);return t}(Ud);zp.prototype.isInstancedInterleavedBuffer=!0;var Np=function(){function e(t,a){var r=2<arguments.length&&arguments[2]!==void 0?arguments[2]:0,i=3<arguments.length&&arguments[3]!==void 0?arguments[3]:1/0;_classCallCheck2(this,e);this.ray=new ss(t,a);this.near=r;this.far=i;this.camera=null;this.layers=new _s;this.params={Mesh:{},Line:{threshold:1},LOD:{},Points:{threshold:1},Sprite:{}}}_createClass2(e,[{key:"set",value:function set(e,t){this.ray.set(e,t)}},{key:"setFromCamera",value:function setFromCamera(e,t){if(t&&t.isPerspectiveCamera){this.ray.origin.setFromMatrixPosition(t.matrixWorld);this.ray.direction.set(e.x,e.y,.5).unproject(t).sub(this.ray.origin).normalize();this.camera=t}else if(t&&t.isOrthographicCamera){this.ray.origin.set(e.x,e.y,(t.near+t.far)/(t.near-t.far)).unproject(t);this.ray.direction.set(0,0,-1).transformDirection(t.matrixWorld);this.camera=t}else{console.error("THREE.Raycaster: Unsupported camera type: "+t.type)}}},{key:"intersectObject",value:function intersectObject(e){var t=1<arguments.length&&arguments[1]!==void 0?arguments[1]:!0,a=2<arguments.length&&arguments[2]!==void 0?arguments[2]:[];Da(e,this,a,t);a.sort(Pa);return a}},{key:"intersectObjects",value:function intersectObjects(e){for(var t=1<arguments.length&&arguments[1]!==void 0?arguments[1]:!0,a=2<arguments.length&&arguments[2]!==void 0?arguments[2]:[],r=0,i=e.length;r<i;r++){Da(e[r],this,a,t)}a.sort(Pa);return a}}]);return e}();function Pa(e,t){return e.distance-t.distance}function Da(e,t,a,r){if(e.layers.test(t.layers)){e.raycast(t,a)}if(!0===r){for(var i=e.children,n=0,o=i.length;n<o;n++){Da(i[n],t,a,!0)}}}var Op=new Po,Fp=new ls,Up=new ls,Bp=function(e){_inherits(t,e);var a=_createSuper(t);function t(e){var r;_classCallCheck2(this,t);for(var i=Ia(e),n=new pl,o=[],s=[],l=new Js(0,0,1),d=new Js(0,1,0),c=0,u;c<i.length;c++){u=i[c];if(u.parent&&u.parent.isBone){o.push(0,0,0);o.push(0,0,0);s.push(l.r,l.g,l.b);s.push(d.r,d.g,d.b)}}n.setAttribute("position",new il(o,3));n.setAttribute("color",new il(s,3));var p=new vc({vertexColors:!0,depthTest:!1,depthWrite:!1,toneMapped:!1,transparent:!0});r=a.call(this,n,p);r.type="SkeletonHelper";r.isSkeletonHelper=!0;r.root=e;r.bones=i;r.matrix=e.matrixWorld;r.matrixAutoUpdate=!1;return r}_createClass2(t,[{key:"updateMatrixWorld",value:function updateMatrixWorld(e){var a=this.bones,r=this.geometry,i=r.getAttribute("position");Up.copy(this.root.matrixWorld).invert();for(var n=0,o=0,s;n<a.length;n++){s=a[n];if(s.parent&&s.parent.isBone){Fp.multiplyMatrices(Up,s.matrixWorld);Op.setFromMatrixPosition(Fp);i.setXYZ(o,Op.x,Op.y,Op.z);Fp.multiplyMatrices(Up,s.parent.matrixWorld);Op.setFromMatrixPosition(Fp);i.setXYZ(o+1,Op.x,Op.y,Op.z);o+=2}}r.getAttribute("position").needsUpdate=!0;_get(_getPrototypeOf(t.prototype),"updateMatrixWorld",this).call(this,e)}}]);return t}(wc);function Ia(e){var t=[];if(e&&e.isBone){t.push(e)}for(var a=0;a<e.children.length;a++){t.push.apply(t,Ia(e.children[a]))}return t}var Hp=function(e){_inherits(t,e);var a=_createSuper(t);function t(){var e,r=0<arguments.length&&arguments[0]!==void 0?arguments[0]:10,i=1<arguments.length&&arguments[1]!==void 0?arguments[1]:10,n=2<arguments.length&&arguments[2]!==void 0?arguments[2]:4473924,o=3<arguments.length&&arguments[3]!==void 0?arguments[3]:8947848;_classCallCheck2(this,t);n=new Js(n);o=new Js(o);for(var s=r/2,l=[],d=[],c=0,u=0,p=-s;c<=i;c++,p+=r/i){l.push(-s,0,p,s,0,p);l.push(p,0,-s,p,0,s);var f=c===i/2?n:o;f.toArray(d,u);u+=3;f.toArray(d,u);u+=3;f.toArray(d,u);u+=3;f.toArray(d,u);u+=3}var m=new pl;m.setAttribute("position",new il(l,3));m.setAttribute("color",new il(d,3));var g=new vc({vertexColors:!0,toneMapped:!1});e=a.call(this,m,g);e.type="GridHelper";return e}return t}(wc),Gp=new Float32Array(1);new Int32Array(Gp.buffer);Vc.create=function(e,t){console.log("THREE.Curve.create() has been deprecated");e.prototype=Object.create(Vc.prototype);e.prototype.constructor=e;e.prototype.getPoint=t;return e};ou.prototype.fromPoints=function(e){console.warn("THREE.Path: .fromPoints() has been renamed to .setFromPoints().");return this.setFromPoints(e)};Hp.prototype.setColors=function(){console.error("THREE.GridHelper: setColors() has been deprecated, pass them in the constructor instead.")};Bp.prototype.update=function(){console.error("THREE.SkeletonHelper: update() no longer needs to be called.")};Uu.prototype.extractUrlBase=function(e){console.warn("THREE.Loader: .extractUrlBase() has been deprecated. Use THREE.LoaderUtils.extractUrlBase() instead.");return cp.extractUrlBase(e)};Uu.Handlers={add:function add(){console.error("THREE.Loader: Handlers.add() has been removed. Use LoadingManager.addHandler() instead.")},get:function get(){console.error("THREE.Loader: Handlers.get() has been removed. Use LoadingManager.getHandler() instead.")}};zo.prototype.center=function(e){console.warn("THREE.Box3: .center() has been renamed to .getCenter().");return this.getCenter(e)};zo.prototype.empty=function(){console.warn("THREE.Box3: .empty() has been renamed to .isEmpty().");return this.isEmpty()};zo.prototype.isIntersectionBox=function(e){console.warn("THREE.Box3: .isIntersectionBox() has been renamed to .intersectsBox().");return this.intersectsBox(e)};zo.prototype.isIntersectionSphere=function(e){console.warn("THREE.Box3: .isIntersectionSphere() has been renamed to .intersectsSphere().");return this.intersectsSphere(e)};zo.prototype.size=function(e){console.warn("THREE.Box3: .size() has been renamed to .getSize().");return this.getSize(e)};$o.prototype.empty=function(){console.warn("THREE.Sphere: .empty() has been renamed to .isEmpty().");return this.isEmpty()};jl.prototype.setFromMatrix=function(e){console.warn("THREE.Frustum: .setFromMatrix() has been renamed to .setFromProjectionMatrix().");return this.setFromProjectionMatrix(e)};So.prototype.flattenToArrayOffset=function(e,t){console.warn("THREE.Matrix3: .flattenToArrayOffset() has been deprecated. Use .toArray() instead.");return this.toArray(e,t)};So.prototype.multiplyVector3=function(e){console.warn("THREE.Matrix3: .multiplyVector3() has been removed. Use vector.applyMatrix3( matrix ) instead.");return e.applyMatrix3(this)};So.prototype.multiplyVector3Array=function(){console.error("THREE.Matrix3: .multiplyVector3Array() has been removed.")};So.prototype.applyToBufferAttribute=function(e){console.warn("THREE.Matrix3: .applyToBufferAttribute() has been removed. Use attribute.applyMatrix3( matrix ) instead.");return e.applyMatrix3(this)};So.prototype.applyToVector3Array=function(){console.error("THREE.Matrix3: .applyToVector3Array() has been removed.")};So.prototype.getInverse=function(e){console.warn("THREE.Matrix3: .getInverse() has been removed. Use matrixInv.copy( matrix ).invert(); instead.");return this.copy(e).invert()};ls.prototype.extractPosition=function(e){console.warn("THREE.Matrix4: .extractPosition() has been renamed to .copyPosition().");return this.copyPosition(e)};ls.prototype.flattenToArrayOffset=function(e,t){console.warn("THREE.Matrix4: .flattenToArrayOffset() has been deprecated. Use .toArray() instead.");return this.toArray(e,t)};ls.prototype.getPosition=function(){console.warn("THREE.Matrix4: .getPosition() has been removed. Use Vector3.setFromMatrixPosition( matrix ) instead.");return new Po().setFromMatrixColumn(this,3)};ls.prototype.setRotationFromQuaternion=function(e){console.warn("THREE.Matrix4: .setRotationFromQuaternion() has been renamed to .makeRotationFromQuaternion().");return this.makeRotationFromQuaternion(e)};ls.prototype.multiplyToArray=function(){console.warn("THREE.Matrix4: .multiplyToArray() has been removed.")};ls.prototype.multiplyVector3=function(e){console.warn("THREE.Matrix4: .multiplyVector3() has been removed. Use vector.applyMatrix4( matrix ) instead.");return e.applyMatrix4(this)};ls.prototype.multiplyVector4=function(e){console.warn("THREE.Matrix4: .multiplyVector4() has been removed. Use vector.applyMatrix4( matrix ) instead.");return e.applyMatrix4(this)};ls.prototype.multiplyVector3Array=function(){console.error("THREE.Matrix4: .multiplyVector3Array() has been removed.")};ls.prototype.rotateAxis=function(e){console.warn("THREE.Matrix4: .rotateAxis() has been removed. Use Vector3.transformDirection( matrix ) instead.");e.transformDirection(this)};ls.prototype.crossVector=function(e){console.warn("THREE.Matrix4: .crossVector() has been removed. Use vector.applyMatrix4( matrix ) instead.");return e.applyMatrix4(this)};ls.prototype.translate=function(){console.error("THREE.Matrix4: .translate() has been removed.")};ls.prototype.rotateX=function(){console.error("THREE.Matrix4: .rotateX() has been removed.")};ls.prototype.rotateY=function(){console.error("THREE.Matrix4: .rotateY() has been removed.")};ls.prototype.rotateZ=function(){console.error("THREE.Matrix4: .rotateZ() has been removed.")};ls.prototype.rotateByAxis=function(){console.error("THREE.Matrix4: .rotateByAxis() has been removed.")};ls.prototype.applyToBufferAttribute=function(e){console.warn("THREE.Matrix4: .applyToBufferAttribute() has been removed. Use attribute.applyMatrix4( matrix ) instead.");return e.applyMatrix4(this)};ls.prototype.applyToVector3Array=function(){console.error("THREE.Matrix4: .applyToVector3Array() has been removed.")};ls.prototype.makeFrustum=function(e,t,a,r,i,n){console.warn("THREE.Matrix4: .makeFrustum() has been removed. Use .makePerspective( left, right, top, bottom, near, far ) instead.");return this.makePerspective(e,t,r,a,i,n)};ls.prototype.getInverse=function(e){console.warn("THREE.Matrix4: .getInverse() has been removed. Use matrixInv.copy( matrix ).invert(); instead.");return this.copy(e).invert()};Gl.prototype.isIntersectionLine=function(e){console.warn("THREE.Plane: .isIntersectionLine() has been renamed to .intersectsLine().");return this.intersectsLine(e)};Ro.prototype.multiplyVector3=function(e){console.warn("THREE.Quaternion: .multiplyVector3() has been removed. Use is now vector.applyQuaternion( quaternion ) instead.");return e.applyQuaternion(this)};Ro.prototype.inverse=function(){console.warn("THREE.Quaternion: .inverse() has been renamed to invert().");return this.invert()};ss.prototype.isIntersectionBox=function(e){console.warn("THREE.Ray: .isIntersectionBox() has been renamed to .intersectsBox().");return this.intersectsBox(e)};ss.prototype.isIntersectionPlane=function(e){console.warn("THREE.Ray: .isIntersectionPlane() has been renamed to .intersectsPlane().");return this.intersectsPlane(e)};ss.prototype.isIntersectionSphere=function(e){console.warn("THREE.Ray: .isIntersectionSphere() has been renamed to .intersectsSphere().");return this.intersectsSphere(e)};Ws.prototype.area=function(){console.warn("THREE.Triangle: .area() has been renamed to .getArea().");return this.getArea()};Ws.prototype.barycoordFromPoint=function(e,t){console.warn("THREE.Triangle: .barycoordFromPoint() has been renamed to .getBarycoord().");return this.getBarycoord(e,t)};Ws.prototype.midpoint=function(e){console.warn("THREE.Triangle: .midpoint() has been renamed to .getMidpoint().");return this.getMidpoint(e)};Ws.prototypenormal=function(e){console.warn("THREE.Triangle: .normal() has been renamed to .getNormal().");return this.getNormal(e)};Ws.prototype.plane=function(e){console.warn("THREE.Triangle: .plane() has been renamed to .getPlane().");return this.getPlane(e)};Ws.barycoordFromPoint=function(e,t,a,r,i){console.warn("THREE.Triangle: .barycoordFromPoint() has been renamed to .getBarycoord().");return Ws.getBarycoord(e,t,a,r,i)};Ws.normal=function(e,t,a,r){console.warn("THREE.Triangle: .normal() has been renamed to .getNormal().");return Ws.getNormal(e,t,a,r)};su.prototype.extractAllPoints=function(e){console.warn("THREE.Shape: .extractAllPoints() has been removed. Use .extractPoints() instead.");return this.extractPoints(e)};su.prototype.extrude=function(e){console.warn("THREE.Shape: .extrude() has been removed. Use ExtrudeGeometry() instead.");return new cu(this,e)};su.prototype.makeGeometry=function(e){console.warn("THREE.Shape: .makeGeometry() has been removed. Use ShapeGeometry() instead.");return new pu(this,e)};bo.prototype.fromAttribute=function(e,t,a){console.warn("THREE.Vector2: .fromAttribute() has been renamed to .fromBufferAttribute().");return this.fromBufferAttribute(e,t,a)};bo.prototype.distanceToManhattan=function(e){console.warn("THREE.Vector2: .distanceToManhattan() has been renamed to .manhattanDistanceTo().");return this.manhattanDistanceTo(e)};bo.prototype.lengthManhattan=function(){console.warn("THREE.Vector2: .lengthManhattan() has been renamed to .manhattanLength().");return this.manhattanLength()};Po.prototype.setEulerFromRotationMatrix=function(){console.error("THREE.Vector3: .setEulerFromRotationMatrix() has been removed. Use Euler.setFromRotationMatrix() instead.")};Po.prototype.setEulerFromQuaternion=function(){console.error("THREE.Vector3: .setEulerFromQuaternion() has been removed. Use Euler.setFromQuaternion() instead.")};Po.prototype.getPositionFromMatrix=function(e){console.warn("THREE.Vector3: .getPositionFromMatrix() has been renamed to .setFromMatrixPosition().");return this.setFromMatrixPosition(e)};Po.prototype.getScaleFromMatrix=function(e){console.warn("THREE.Vector3: .getScaleFromMatrix() has been renamed to .setFromMatrixScale().");return this.setFromMatrixScale(e)};Po.prototype.getColumnFromMatrix=function(e,t){console.warn("THREE.Vector3: .getColumnFromMatrix() has been renamed to .setFromMatrixColumn().");return this.setFromMatrixColumn(t,e)};Po.prototype.applyProjection=function(e){console.warn("THREE.Vector3: .applyProjection() has been removed. Use .applyMatrix4( m ) instead.");return this.applyMatrix4(e)};Po.prototype.fromAttribute=function(e,t,a){console.warn("THREE.Vector3: .fromAttribute() has been renamed to .fromBufferAttribute().");return this.fromBufferAttribute(e,t,a)};Po.prototype.distanceToManhattan=function(e){console.warn("THREE.Vector3: .distanceToManhattan() has been renamed to .manhattanDistanceTo().");return this.manhattanDistanceTo(e)};Po.prototype.lengthManhattan=function(){console.warn("THREE.Vector3: .lengthManhattan() has been renamed to .manhattanLength().");return this.manhattanLength()};Ao.prototype.fromAttribute=function(e,t,a){console.warn("THREE.Vector4: .fromAttribute() has been renamed to .fromBufferAttribute().");return this.fromBufferAttribute(e,t,a)};Ao.prototype.lengthManhattan=function(){console.warn("THREE.Vector4: .lengthManhattan() has been renamed to .manhattanLength().");return this.manhattanLength()};Ds.prototype.getChildByName=function(e){console.warn("THREE.Object3D: .getChildByName() has been renamed to .getObjectByName().");return this.getObjectByName(e)};Ds.prototype.renderDepth=function(){console.warn("THREE.Object3D: .renderDepth has been removed. Use .renderOrder, instead.")};Ds.prototype.translate=function(e,t){console.warn("THREE.Object3D: .translate() has been removed. Use .translateOnAxis( axis, distance ) instead.");return this.translateOnAxis(t,e)};Ds.prototype.getWorldRotation=function(){console.error("THREE.Object3D: .getWorldRotation() has been removed. Use THREE.Object3D.getWorldQuaternion( target ) instead.")};Ds.prototype.applyMatrix=function(e){console.warn("THREE.Object3D: .applyMatrix() has been renamed to .applyMatrix4().");return this.applyMatrix4(e)};Object.defineProperties(Ds.prototype,{eulerOrder:{get:function get(){console.warn("THREE.Object3D: .eulerOrder is now .rotation.order.");return this.rotation.order},set:function set(e){console.warn("THREE.Object3D: .eulerOrder is now .rotation.order.");this.rotation.order=e}},useQuaternion:{get:function get(){console.warn("THREE.Object3D: .useQuaternion has been removed. The library now uses quaternions by default.")},set:function set(){console.warn("THREE.Object3D: .useQuaternion has been removed. The library now uses quaternions by default.")}}});Ll.prototype.setDrawMode=function(){console.error("THREE.Mesh: .setDrawMode() has been removed. The renderer now always assumes THREE.TrianglesDrawMode. Transform your geometry via BufferGeometryUtils.toTrianglesDrawMode() if necessary.")};Object.defineProperties(Ll.prototype,{drawMode:{get:function get(){console.error("THREE.Mesh: .drawMode has been removed. The renderer now always assumes THREE.TrianglesDrawMode.");return Kn},set:function set(){console.error("THREE.Mesh: .drawMode has been removed. The renderer now always assumes THREE.TrianglesDrawMode. Transform your geometry via BufferGeometryUtils.toTrianglesDrawMode() if necessary.")}}});lc.prototype.initBones=function(){console.error("THREE.SkinnedMesh: initBones() has been removed.")};zl.prototype.setLens=function(e,t){console.warn("THREE.PerspectiveCamera.setLens is deprecated. Use .setFocalLength and .filmGauge for a photographic setup.");if(t!==void 0)this.filmGauge=t;this.setFocalLength(e)};Object.defineProperties(ju.prototype,{onlyShadow:{set:function set(){console.warn("THREE.Light: .onlyShadow has been removed.")}},shadowCameraFov:{set:function set(e){console.warn("THREE.Light: .shadowCameraFov is now .shadow.camera.fov.");this.shadow.camera.fov=e}},shadowCameraLeft:{set:function set(e){console.warn("THREE.Light: .shadowCameraLeft is now .shadow.camera.left.");this.shadow.camera.left=e}},shadowCameraRight:{set:function set(e){console.warn("THREE.Light: .shadowCameraRight is now .shadow.camera.right.");this.shadow.camera.right=e}},shadowCameraTop:{set:function set(e){console.warn("THREE.Light: .shadowCameraTop is now .shadow.camera.top.");this.shadow.camera.top=e}},shadowCameraBottom:{set:function set(e){console.warn("THREE.Light: .shadowCameraBottom is now .shadow.camera.bottom.");this.shadow.camera.bottom=e}},shadowCameraNear:{set:function set(e){console.warn("THREE.Light: .shadowCameraNear is now .shadow.camera.near.");this.shadow.camera.near=e}},shadowCameraFar:{set:function set(e){console.warn("THREE.Light: .shadowCameraFar is now .shadow.camera.far.");this.shadow.camera.far=e}},shadowCameraVisible:{set:function set(){console.warn("THREE.Light: .shadowCameraVisible has been removed. Use new THREE.CameraHelper( light.shadow.camera ) instead.")}},shadowBias:{set:function set(e){console.warn("THREE.Light: .shadowBias is now .shadow.bias.");this.shadow.bias=e}},shadowDarkness:{set:function set(){console.warn("THREE.Light: .shadowDarkness has been removed.")}},shadowMapWidth:{set:function set(e){console.warn("THREE.Light: .shadowMapWidth is now .shadow.mapSize.width.");this.shadow.mapSize.width=e}},shadowMapHeight:{set:function set(e){console.warn("THREE.Light: .shadowMapHeight is now .shadow.mapSize.height.");this.shadow.mapSize.height=e}}});Object.defineProperties(el.prototype,{length:{get:function get(){console.warn("THREE.BufferAttribute: .length has been deprecated. Use .count instead.");return this.array.length}},dynamic:{get:function get(){console.warn("THREE.BufferAttribute: .dynamic has been deprecated. Use .usage instead.");return this.usage===go},set:function set(){console.warn("THREE.BufferAttribute: .dynamic has been deprecated. Use .usage instead.");this.setUsage(go)}}});el.prototype.setDynamic=function(e){console.warn("THREE.BufferAttribute: .setDynamic() has been deprecated. Use .setUsage() instead.");this.setUsage(!0===e?go:mo);return this};el.prototype.copyIndicesArray=function(){console.error("THREE.BufferAttribute: .copyIndicesArray() has been removed.")},el.prototype.setArray=function(){console.error("THREE.BufferAttribute: .setArray has been removed. Use BufferGeometry .setAttribute to replace/resize attribute buffers")};pl.prototype.addIndex=function(e){console.warn("THREE.BufferGeometry: .addIndex() has been renamed to .setIndex().");this.setIndex(e)};pl.prototype.addAttribute=function(e,t){console.warn("THREE.BufferGeometry: .addAttribute() has been renamed to .setAttribute().");if(!(t&&t.isBufferAttribute)&&!(t&&t.isInterleavedBufferAttribute)){console.warn("THREE.BufferGeometry: .addAttribute() now expects ( name, attribute ).");return this.setAttribute(e,new el(arguments[1],arguments[2]))}if("index"===e){console.warn("THREE.BufferGeometry.addAttribute: Use .setIndex() for index attribute.");this.setIndex(t);return this}return this.setAttribute(e,t)};pl.prototype.addDrawCall=function(e,t,a){if(a!==void 0){console.warn("THREE.BufferGeometry: .addDrawCall() no longer supports indexOffset.")}console.warn("THREE.BufferGeometry: .addDrawCall() is now .addGroup().");this.addGroup(e,t)};pl.prototype.clearDrawCalls=function(){console.warn("THREE.BufferGeometry: .clearDrawCalls() is now .clearGroups().");this.clearGroups()};pl.prototype.computeOffsets=function(){console.warn("THREE.BufferGeometry: .computeOffsets() has been removed.")};pl.prototype.removeAttribute=function(e){console.warn("THREE.BufferGeometry: .removeAttribute() has been renamed to .deleteAttribute().");return this.deleteAttribute(e)};pl.prototype.applyMatrix=function(e){console.warn("THREE.BufferGeometry: .applyMatrix() has been renamed to .applyMatrix4().");return this.applyMatrix4(e)};Object.defineProperties(pl.prototype,{drawcalls:{get:function get(){console.error("THREE.BufferGeometry: .drawcalls has been renamed to .groups.");return this.groups}},offsets:{get:function get(){console.warn("THREE.BufferGeometry: .offsets has been renamed to .groups.");return this.groups}}});Ud.prototype.setDynamic=function(e){console.warn("THREE.InterleavedBuffer: .setDynamic() has been deprecated. Use .setUsage() instead.");this.setUsage(!0===e?go:mo);return this};Ud.prototype.setArray=function(){console.error("THREE.InterleavedBuffer: .setArray has been removed. Use BufferGeometry .setAttribute to replace/resize attribute buffers")};cu.prototype.getArrays=function(){console.error("THREE.ExtrudeGeometry: .getArrays() has been removed.")};cu.prototype.addShapeList=function(){console.error("THREE.ExtrudeGeometry: .addShapeList() has been removed.")};cu.prototype.addShape=function(){console.error("THREE.ExtrudeGeometry: .addShape() has been removed.")};Fd.prototype.dispose=function(){console.error("THREE.Scene: .dispose() has been removed.")};Object.defineProperties(qs.prototype,{wrapAround:{get:function get(){console.warn("THREE.Material: .wrapAround has been removed.")},set:function set(){console.warn("THREE.Material: .wrapAround has been removed.")}},overdraw:{get:function get(){console.warn("THREE.Material: .overdraw has been removed.")},set:function set(){console.warn("THREE.Material: .overdraw has been removed.")}},wrapRGB:{get:function get(){console.warn("THREE.Material: .wrapRGB has been removed.");return new Js}},shading:{get:function get(){console.error("THREE."+this.type+": .shading has been removed. Use the boolean .flatShading instead.")},set:function set(e){console.warn("THREE."+this.type+": .shading has been removed. Use the boolean .flatShading instead.");this.flatShading=e===wr}},stencilMask:{get:function get(){console.warn("THREE."+this.type+": .stencilMask has been removed. Use .stencilFuncMask instead.");return this.stencilFuncMask},set:function set(e){console.warn("THREE."+this.type+": .stencilMask has been removed. Use .stencilFuncMask instead.");this.stencilFuncMask=e}},vertexTangents:{get:function get(){console.warn("THREE."+this.type+": .vertexTangents has been removed.")},set:function set(){console.warn("THREE."+this.type+": .vertexTangents has been removed.")}}});Object.defineProperties(Dl.prototype,{derivatives:{get:function get(){console.warn("THREE.ShaderMaterial: .derivatives has been moved to .extensions.derivatives.");return this.extensions.derivatives},set:function set(e){console.warn("THREE. ShaderMaterial: .derivatives has been moved to .extensions.derivatives.");this.extensions.derivatives=e}}});Dt.prototype.clearTarget=function(e,t,a,r){console.warn("THREE.WebGLRenderer: .clearTarget() has been deprecated. Use .setRenderTarget() and .clear() instead.");this.setRenderTarget(e);this.clear(t,a,r)};Dt.prototype.animate=function(e){console.warn("THREE.WebGLRenderer: .animate() is now .setAnimationLoop().");this.setAnimationLoop(e)};Dt.prototype.getCurrentRenderTarget=function(){console.warn("THREE.WebGLRenderer: .getCurrentRenderTarget() is now .getRenderTarget().");return this.getRenderTarget()};Dt.prototype.getMaxAnisotropy=function(){console.warn("THREE.WebGLRenderer: .getMaxAnisotropy() is now .capabilities.getMaxAnisotropy().");return this.capabilities.getMaxAnisotropy()};Dt.prototype.getPrecision=function(){console.warn("THREE.WebGLRenderer: .getPrecision() is now .capabilities.precision.");return this.capabilities.precision};Dt.prototype.resetGLState=function(){console.warn("THREE.WebGLRenderer: .resetGLState() is now .state.reset().");return this.state.reset()};Dt.prototype.supportsFloatTextures=function(){console.warn("THREE.WebGLRenderer: .supportsFloatTextures() is now .extensions.get( 'OES_texture_float' ).");return this.extensions.get("OES_texture_float")};Dt.prototype.supportsHalfFloatTextures=function(){console.warn("THREE.WebGLRenderer: .supportsHalfFloatTextures() is now .extensions.get( 'OES_texture_half_float' ).");return this.extensions.get("OES_texture_half_float")};Dt.prototype.supportsStandardDerivatives=function(){console.warn("THREE.WebGLRenderer: .supportsStandardDerivatives() is now .extensions.get( 'OES_standard_derivatives' ).");return this.extensions.get("OES_standard_derivatives")};Dt.prototype.supportsCompressedTextureS3TC=function(){console.warn("THREE.WebGLRenderer: .supportsCompressedTextureS3TC() is now .extensions.get( 'WEBGL_compressed_texture_s3tc' ).");return this.extensions.get("WEBGL_compressed_texture_s3tc")};Dt.prototype.supportsCompressedTexturePVRTC=function(){console.warn("THREE.WebGLRenderer: .supportsCompressedTexturePVRTC() is now .extensions.get( 'WEBGL_compressed_texture_pvrtc' ).");return this.extensions.get("WEBGL_compressed_texture_pvrtc")};Dt.prototype.supportsBlendMinMax=function(){console.warn("THREE.WebGLRenderer: .supportsBlendMinMax() is now .extensions.get( 'EXT_blend_minmax' ).");return this.extensions.get("EXT_blend_minmax")};Dt.prototype.supportsVertexTextures=function(){console.warn("THREE.WebGLRenderer: .supportsVertexTextures() is now .capabilities.vertexTextures.");return this.capabilities.vertexTextures};Dt.prototype.supportsInstancedArrays=function(){console.warn("THREE.WebGLRenderer: .supportsInstancedArrays() is now .extensions.get( 'ANGLE_instanced_arrays' ).");return this.extensions.get("ANGLE_instanced_arrays")};Dt.prototype.enableScissorTest=function(e){console.warn("THREE.WebGLRenderer: .enableScissorTest() is now .setScissorTest().");this.setScissorTest(e)};Dt.prototype.initMaterial=function(){console.warn("THREE.WebGLRenderer: .initMaterial() has been removed.")};Dt.prototype.addPrePlugin=function(){console.warn("THREE.WebGLRenderer: .addPrePlugin() has been removed.")};Dt.prototype.addPostPlugin=function(){console.warn("THREE.WebGLRenderer: .addPostPlugin() has been removed.")};Dt.prototype.updateShadowMap=function(){console.warn("THREE.WebGLRenderer: .updateShadowMap() has been removed.")};Dt.prototype.setFaceCulling=function(){console.warn("THREE.WebGLRenderer: .setFaceCulling() has been removed.")};Dt.prototype.allocTextureUnit=function(){console.warn("THREE.WebGLRenderer: .allocTextureUnit() has been removed.")};Dt.prototype.setTexture=function(){console.warn("THREE.WebGLRenderer: .setTexture() has been removed.")};Dt.prototype.setTexture2D=function(){console.warn("THREE.WebGLRenderer: .setTexture2D() has been removed.")};Dt.prototype.setTextureCube=function(){console.warn("THREE.WebGLRenderer: .setTextureCube() has been removed.")};Dt.prototype.getActiveMipMapLevel=function(){console.warn("THREE.WebGLRenderer: .getActiveMipMapLevel() is now .getActiveMipmapLevel().");return this.getActiveMipmapLevel()};Object.defineProperties(Dt.prototype,{shadowMapEnabled:{get:function get(){return this.shadowMap.enabled},set:function set(e){console.warn("THREE.WebGLRenderer: .shadowMapEnabled is now .shadowMap.enabled.");this.shadowMap.enabled=e}},shadowMapType:{get:function get(){return this.shadowMap.type},set:function set(e){console.warn("THREE.WebGLRenderer: .shadowMapType is now .shadowMap.type.");this.shadowMap.type=e}},shadowMapCullFace:{get:function get(){console.warn("THREE.WebGLRenderer: .shadowMapCullFace has been removed. Set Material.shadowSide instead.")},set:function set(){console.warn("THREE.WebGLRenderer: .shadowMapCullFace has been removed. Set Material.shadowSide instead.")}},context:{get:function get(){console.warn("THREE.WebGLRenderer: .context has been removed. Use .getContext() instead.");return this.getContext()}},vr:{get:function get(){console.warn("THREE.WebGLRenderer: .vr has been renamed to .xr");return this.xr}},gammaInput:{get:function get(){console.warn("THREE.WebGLRenderer: .gammaInput has been removed. Set the encoding for textures via Texture.encoding instead.");return!1},set:function set(){console.warn("THREE.WebGLRenderer: .gammaInput has been removed. Set the encoding for textures via Texture.encoding instead.")}},gammaOutput:{get:function get(){console.warn("THREE.WebGLRenderer: .gammaOutput has been removed. Set WebGLRenderer.outputEncoding instead.");return!1},set:function set(e){console.warn("THREE.WebGLRenderer: .gammaOutput has been removed. Set WebGLRenderer.outputEncoding instead.");this.outputEncoding=!0===e?eo:$n}},toneMappingWhitePoint:{get:function get(){console.warn("THREE.WebGLRenderer: .toneMappingWhitePoint has been removed.");return 1},set:function set(){console.warn("THREE.WebGLRenderer: .toneMappingWhitePoint has been removed.")}}});Object.defineProperties(At.prototype,{cullFace:{get:function get(){console.warn("THREE.WebGLRenderer: .shadowMap.cullFace has been removed. Set Material.shadowSide instead.")},set:function set(){console.warn("THREE.WebGLRenderer: .shadowMap.cullFace has been removed. Set Material.shadowSide instead.")}},renderReverseSided:{get:function get(){console.warn("THREE.WebGLRenderer: .shadowMap.renderReverseSided has been removed. Set Material.shadowSide instead.")},set:function set(){console.warn("THREE.WebGLRenderer: .shadowMap.renderReverseSided has been removed. Set Material.shadowSide instead.")}},renderSingleSided:{get:function get(){console.warn("THREE.WebGLRenderer: .shadowMap.renderSingleSided has been removed. Set Material.shadowSide instead.")},set:function set(){console.warn("THREE.WebGLRenderer: .shadowMap.renderSingleSided has been removed. Set Material.shadowSide instead.")}}});Object.defineProperties(ko.prototype,{wrapS:{get:function get(){console.warn("THREE.WebGLRenderTarget: .wrapS is now .texture.wrapS.");return this.texture.wrapS},set:function set(e){console.warn("THREE.WebGLRenderTarget: .wrapS is now .texture.wrapS.");this.texture.wrapS=e}},wrapT:{get:function get(){console.warn("THREE.WebGLRenderTarget: .wrapT is now .texture.wrapT.");return this.texture.wrapT},set:function set(e){console.warn("THREE.WebGLRenderTarget: .wrapT is now .texture.wrapT.");this.texture.wrapT=e}},magFilter:{get:function get(){console.warn("THREE.WebGLRenderTarget: .magFilter is now .texture.magFilter.");return this.texture.magFilter},set:function set(e){console.warn("THREE.WebGLRenderTarget: .magFilter is now .texture.magFilter.");this.texture.magFilter=e}},minFilter:{get:function get(){console.warn("THREE.WebGLRenderTarget: .minFilter is now .texture.minFilter.");return this.texture.minFilter},set:function set(e){console.warn("THREE.WebGLRenderTarget: .minFilter is now .texture.minFilter.");this.texture.minFilter=e}},anisotropy:{get:function get(){console.warn("THREE.WebGLRenderTarget: .anisotropy is now .texture.anisotropy.");return this.texture.anisotropy},set:function set(e){console.warn("THREE.WebGLRenderTarget: .anisotropy is now .texture.anisotropy.");this.texture.anisotropy=e}},offset:{get:function get(){console.warn("THREE.WebGLRenderTarget: .offset is now .texture.offset.");return this.texture.offset},set:function set(e){console.warn("THREE.WebGLRenderTarget: .offset is now .texture.offset.");this.texture.offset=e}},repeat:{get:function get(){console.warn("THREE.WebGLRenderTarget: .repeat is now .texture.repeat.");return this.texture.repeat},set:function set(e){console.warn("THREE.WebGLRenderTarget: .repeat is now .texture.repeat.");this.texture.repeat=e}},format:{get:function get(){console.warn("THREE.WebGLRenderTarget: .format is now .texture.format.");return this.texture.format},set:function set(e){console.warn("THREE.WebGLRenderTarget: .format is now .texture.format.");this.texture.format=e}},type:{get:function get(){console.warn("THREE.WebGLRenderTarget: .type is now .texture.type.");return this.texture.type},set:function set(e){console.warn("THREE.WebGLRenderTarget: .type is now .texture.type.");this.texture.type=e}},generateMipmaps:{get:function get(){console.warn("THREE.WebGLRenderTarget: .generateMipmaps is now .texture.generateMipmaps.");return this.texture.generateMipmaps},set:function set(e){console.warn("THREE.WebGLRenderTarget: .generateMipmaps is now .texture.generateMipmaps.");this.texture.generateMipmaps=e}}});_p.prototype.load=function(e){console.warn("THREE.Audio: .load has been deprecated. Use THREE.AudioLoader instead.");var t=this,a=new fp;a.load(e,function(e){t.setBuffer(e)});return this};Nl.prototype.updateCubeMap=function(e,t){console.warn("THREE.CubeCamera: .updateCubeMap() is now .update().");return this.update(e,t)};Nl.prototype.clear=function(e,t,a,r){console.warn("THREE.CubeCamera: .clear() is now .renderTarget.clear().");return this.renderTarget.clear(e,t,a,r)};To.crossOrigin=void 0;To.loadTexture=function(e,t,a,r){console.warn("THREE.ImageUtils.loadTexture has been deprecated. Use THREE.TextureLoader() instead.");var i=new Wu;i.setCrossOrigin(this.crossOrigin);var n=i.load(e,a,void 0,r);if(t)n.mapping=t;return n};To.loadTextureCube=function(e,t,a,r){console.warn("THREE.ImageUtils.loadTextureCube has been deprecated. Use THREE.CubeTextureLoader() instead.");var i=new Vu;i.setCrossOrigin(this.crossOrigin);var n=i.load(e,a,void 0,r);if(t)n.mapping=t;return n};To.loadCompressedTexture=function(){console.error("THREE.ImageUtils.loadCompressedTexture has been removed. Use THREE.DDSLoader instead.")};To.loadCompressedTextureCube=function(){console.error("THREE.ImageUtils.loadCompressedTextureCube has been removed. Use THREE.DDSLoader instead.")};if("undefined"!=typeof __THREE_DEVTOOLS__){__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("register",{detail:{revision:hr}}))}if("undefined"!=typeof window){if(window.__THREE__){console.warn("WARNING: Multiple instances of Three.js being imported.")}else{window.__THREE__=hr}}var Vp=function(e){_inherits(t,e);var a=_createSuper(t);function t(){var e,r=0<arguments.length&&arguments[0]!==void 0?arguments[0]:document.createElement("div");_classCallCheck2(this,t);e=a.call(this);e.element=r;e.element.style.position="absolute";e.element.style.userSelect="none";e.element.setAttribute("draggable",!1);e.addEventListener("removed",function(){this.traverse(function(e){if(e.element instanceof Element&&null!==e.element.parentNode){e.element.parentNode.removeChild(e.element)}})});return e}_createClass2(t,[{key:"copy",value:function copy(e,a){_get(_getPrototypeOf(t.prototype),"copy",this).call(this,e,a);this.element=e.element.cloneNode(!0);return this}}]);return t}(Ds);Vp.prototype.isCSS2DObject=!0;var Wp=new Po,jp=new ls,qp=new ls,Xp=new Po,_a=new Po,Yp=function e(){var n=0<arguments.length&&arguments[0]!==void 0?arguments[0]:{};_classCallCheck2(this,e);var o=this,s,l,d,c,u={objects:new WeakMap},p=n.element!==void 0?n.element:document.createElement("div");p.style.overflow="hidden";this.domElement=p;this.getSize=function(){return{width:s,height:l}};this.render=function(e,a){if(!0===e.autoUpdate)e.updateMatrixWorld();if(null===a.parent)a.updateMatrixWorld();jp.copy(a.matrixWorldInverse);qp.multiplyMatrices(a.projectionMatrix,jp);t(e,e,a);i(e)};this.setSize=function(e,t){s=e;l=t;d=s/2;c=l/2;p.style.width=e+"px";p.style.height=t+"px"};function t(e,r,i){if(e.isCSS2DObject){e.onBeforeRender(o,r,i);Wp.setFromMatrixPosition(e.matrixWorld);Wp.applyMatrix4(qp);var n=e.element;if(/apple/i.test(navigator.vendor)){n.style.transform="translate(-50%,-50%) translate("+Math.round(Wp.x*d+d)+"px,"+Math.round(-Wp.y*c+c)+"px)"}else{n.style.transform="translate(-50%,-50%) translate("+(Wp.x*d+d)+"px,"+(-Wp.y*c+c)+"px)"}n.style.display=e.visible&&-1<=Wp.z&&1>=Wp.z?"":"none";var s={distanceToCameraSquared:a(i,e)};u.objects.set(e,s);if(n.parentNode!==p){p.appendChild(n)}e.onAfterRender(o,r,i)}for(var m=0,g=e.children.length;m<g;m++){t(e.children[m],r,i)}}function a(e,t){Xp.setFromMatrixPosition(e.matrixWorld);_a.setFromMatrixPosition(t.matrixWorld);return Xp.distanceToSquared(_a)}function r(e){var t=[];e.traverse(function(e){if(e.isCSS2DObject)t.push(e)});return t}function i(e){for(var t=r(e).sort(function(e,t){var a=u.objects.get(e).distanceToCameraSquared,r=u.objects.get(t).distanceToCameraSquared;return a-r}),a=t.length,i=0,n=t.length;i<n;i++){t[i].element.style.zIndex=a-i}}},Zp=function(e){_inherits(t,e);var a=_createSuper(t);function t(e){_classCallCheck2(this,t);return a.call(this,e)}_createClass2(t,[{key:"load",value:function load(t,a,r,i){var n=this,o=new Hu(this.manager);o.setPath(this.path);o.setResponseType("arraybuffer");o.setRequestHeader(this.requestHeader);o.setWithCredentials(this.withCredentials);o.load(t,function(e){try{a(n.parse(e))}catch(a){if(i){i(a)}else{console.error(a)}n.manager.itemError(t)}},r,i)}},{key:"parse",value:function parse(e){function t(e,t,a){for(var r=0,i=e.length;r<i;r++){if(e[r]!==t.getUint8(a+r,!1))return!1}return!0}var a=function(e){if("string"==typeof e){for(var t=new Uint8Array(e.length),a=0;a<e.length;a++){t[a]=255&e.charCodeAt(a)}return t.buffer||t}else{return e}}(e);return function(e){var a=new DataView(e),r=a.getUint32(80,!0);if(84+r*50===a.byteLength){return!0}for(var i=[115,111,108,105,100],n=0;5>n;n++){if(t(i,a,n))return!1}return!0}(a)?function(e){for(var t=new DataView(e),a=t.getUint32(80,!0),i,n,o,s=!1,l,d,c,u,p,m=0;m<70;m++){if(1129270351==t.getUint32(m,!1)&&82==t.getUint8(m+4)&&61==t.getUint8(m+5)){s=!0;l=new Float32Array(3*(3*a));d=t.getUint8(m+6)/255;c=t.getUint8(m+7)/255;u=t.getUint8(m+8)/255;p=t.getUint8(m+9)/255}}for(var f=new pl,h=new Float32Array(3*(3*a)),v=new Float32Array(3*(3*a)),y=0;y<a;y++){var _=84+y*50,x=t.getFloat32(_,!0),S=t.getFloat32(_+4,!0),M=t.getFloat32(_+8,!0);if(s){var w=t.getUint16(_+48,!0);if(0==(32768&w)){i=(31&w)/31;n=(31&w>>5)/31;o=(31&w>>10)/31}else{i=d;n=c;o=u}}for(var A=1;3>=A;A++){var T=_+12*A,E=3*(3*y)+3*(A-1);h[E]=t.getFloat32(T,!0);h[E+1]=t.getFloat32(T+4,!0);h[E+2]=t.getFloat32(T+8,!0);v[E]=x;v[E+1]=S;v[E+2]=M;if(s){l[E]=i;l[E+1]=n;l[E+2]=o}}}f.setAttribute("position",new el(h,3));f.setAttribute("normal",new el(v,3));if(s){f.setAttribute("color",new el(l,3));f.hasColors=!0;f.alpha=p}return f}(a):function(e){var t=new pl,a=0,r=/[\s]+([+-]?(?:\d*)(?:\.\d*)?(?:[eE][+-]?\d+)?)/.source,i=new RegExp("vertex"+r+r+r,"g"),n=new RegExp("normal"+r+r+r,"g"),o=[],s=[],l=new Po,d,c=0,u=0,p=0;while(null!==(d=/solid([\s\S]*?)endsolid/g.exec(e))){u=p;var y=d[0];while(null!==(d=/facet([\s\S]*?)endfacet/g.exec(y))){var m=0,g=0,f=d[0];while(null!==(d=n.exec(f))){l.x=parseFloat(d[1]);l.y=parseFloat(d[2]);l.z=parseFloat(d[3]);g++}while(null!==(d=i.exec(f))){o.push(parseFloat(d[1]),parseFloat(d[2]),parseFloat(d[3]));s.push(l.x,l.y,l.z);m++;p++}if(1!==g){console.error("THREE.STLLoader: Something isn't right with the normal of face number "+a)}if(3!=m){console.error("THREE.STLLoader: Something isn't right with the vertices of face number "+a)}a++}var h=u,v=p-u;t.addGroup(h,v,c);c++}t.setAttribute("position",new il(o,3));t.setAttribute("normal",new il(s,3));return t}(function(e){if("string"!=typeof e){return cp.decodeText(new Uint8Array(e))}return e}(e))}}]);return t}(Uu),Jp=function e(t,a){_classCallCheck2(this,e);var r=new vc({color:16711680,linewidth:1}),i=new fu({color:10339023}),n=new Zp;n.load(t.src,function(e){var n=new Pd;if(e.hasColor)console.log("hasColor");var o=new Po;if(t.center){e.center()}if(!0===t.scale){e.boundingBox.getSize(o);var s=Math.max(o.x,o.y,o.z);e.scale(10/s,10/s,10/s)}else if(!1!==t.scale){e.scale(t.scale,t.scale,t.scale)}n.add(new Ll(e,i));n.add(new wc(new Gc(e),r));a(e,n)})};function za(e,t){if(!(e instanceof t)){throw new TypeError("Cannot call a class as a function")}}function Na(e,t){for(var a=0,r;a<t.length;a++){r=t[a];r.enumerable=r.enumerable||!1;r.configurable=!0;if("value"in r)r.writable=!0;Object.defineProperty(e,r.key,r)}}function Oa(e,t,a){if(t)Na(e.prototype,t);if(a)Na(e,a);return e}function Fa(e,t,a){if(t in e){Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0})}else{e[t]=a}return e}function Ua(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{},r=Object.keys(a);if("function"==typeof Object.getOwnPropertySymbols){r=r.concat(Object.getOwnPropertySymbols(a).filter(function(e){return Object.getOwnPropertyDescriptor(a,e).enumerable}))}r.forEach(function(t){Fa(e,t,a[t])})}return e}function Ba(e,t){return Ha(e)||Ga(e,t)||Va()}function Ha(e){if(Array.isArray(e))return e}function Ga(e,t){var a=[],r=!0,i=!1,n=void 0;try{for(var o=e[Symbol.iterator](),s;!(r=(s=o.next()).done);r=!0){a.push(s.value);if(t&&a.length===t)break}}catch(e){i=!0;n=e}finally{try{if(!r&&null!=o["return"])o["return"]()}finally{if(i)throw n}}return a}function Va(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}var Qp=function(){},Kp={},$p={},em={mark:Qp,measure:Qp};try{if("undefined"!=typeof window)Kp=window;if("undefined"!=typeof document)$p=document;if("undefined"!=typeof MutationObserver)MutationObserver;if("undefined"!=typeof performance)em=performance}catch(t){}var tm=Kp.navigator||{},am=tm.userAgent,rm=void 0===am?"":am,im=Kp,nm=$p,om=em;!!im.document;var sm=!!nm.documentElement&&!!nm.head&&"function"==typeof nm.addEventListener&&"function"==typeof nm.createElement;~rm.indexOf("MSIE")||~rm.indexOf("Trident/");var lm="fa",dm="svg-inline--fa";(function(){try{return"production"===process.env.NODE_ENV}catch(t){return!1}})();var cm={GROUP:"group",SWAP_OPACITY:"swap-opacity",PRIMARY:"primary",SECONDARY:"secondary"},um=im.FontAwesomeConfig||{};function Wa(e){var t=nm.querySelector("script["+e+"]");if(t){return t.getAttribute(e)}}function ja(e){if(""===e)return!0;if("false"===e)return!1;if("true"===e)return!0;return e}if(nm&&"function"==typeof nm.querySelector){[["data-family-prefix","familyPrefix"],["data-replacement-class","replacementClass"],["data-auto-replace-svg","autoReplaceSvg"],["data-auto-add-css","autoAddCss"],["data-auto-a11y","autoA11y"],["data-search-pseudo-elements","searchPseudoElements"],["data-observe-mutations","observeMutations"],["data-mutate-approach","mutateApproach"],["data-keep-original-source","keepOriginalSource"],["data-measure-performance","measurePerformance"],["data-show-missing-icons","showMissingIcons"]].forEach(function(e){var t=Ba(e,2),a=t[0],r=t[1],i=ja(Wa(a));if(i!==void 0&&null!==i){um[r]=i}})}var pm=Ua({},{familyPrefix:lm,replacementClass:dm,autoReplaceSvg:!0,autoAddCss:!0,autoA11y:!0,searchPseudoElements:!1,observeMutations:!0,mutateApproach:"async",keepOriginalSource:!0,measurePerformance:!1,showMissingIcons:!0},um);if(!pm.autoReplaceSvg)pm.observeMutations=!1;var mm=Ua({},pm);im.FontAwesomeConfig=mm;var gm=im||{};if(!gm.___FONT_AWESOME___)gm.___FONT_AWESOME___={};if(!gm.___FONT_AWESOME___.styles)gm.___FONT_AWESOME___.styles={};if(!gm.___FONT_AWESOME___.hooks)gm.___FONT_AWESOME___.hooks={};if(!gm.___FONT_AWESOME___.shims)gm.___FONT_AWESOME___.shims=[];var w=gm.___FONT_AWESOME___,fm=[],hm=function e(){nm.removeEventListener("DOMContentLoaded",e);vm=1;fm.map(function(e){return e()})},vm=!1;if(sm){vm=(nm.documentElement.doScroll?/^loaded|^c/:/^loaded|^i|^c/).test(nm.readyState);if(!vm)nm.addEventListener("DOMContentLoaded",hm)}"undefined"==typeof global||"undefined"==typeof global.process||"function"!=typeof global.process.emit;"undefined"==typeof setImmediate?setTimeout:setImmediate;var ym={size:16,x:0,y:0,rotate:0,flipX:!1,flipY:!1};function qa(e){if(!e||!sm){return}var t=nm.createElement("style");t.setAttribute("type","text/css");t.innerHTML=e;for(var a=nm.head.childNodes,r=null,n=a.length-1;-1<n;n--){var o=a[n],s=(o.tagName||"").toUpperCase();if(-1<["STYLE","LINK"].indexOf(s)){r=o}}nm.head.insertBefore(t,r);return e}function Xa(){var e=12,t="";while(0<e--){t+="0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ"[0|62*Math.random()]}return t}function Ya(e){return"".concat(e).replace(/&/g,"&amp;").replace(/"/g,"&quot;").replace(/'/g,"&#39;").replace(/</g,"&lt;").replace(/>/g,"&gt;")}function Za(e){return Object.keys(e||{}).reduce(function(t,a){return t+"".concat(a,"=\"").concat(Ya(e[a]),"\" ")},"").trim()}function Ja(e){return Object.keys(e||{}).reduce(function(t,a){return t+"".concat(a,": ").concat(e[a],";")},"")}function Qa(e){return e.size!==ym.size||e.x!==ym.x||e.y!==ym.y||e.rotate!==ym.rotate||e.flipX||e.flipY}function Ka(e){var t=e.transform,a=e.containerWidth,r=e.iconWidth,i={transform:"translate(".concat(a/2," 256)")},n="translate(".concat(32*t.x,", ").concat(32*t.y,") "),o="scale(".concat(t.size/16*(t.flipX?-1:1),", ").concat(t.size/16*(t.flipY?-1:1),") "),s="rotate(".concat(t.rotate," 0 0)"),l={transform:"".concat(n," ").concat(o," ").concat(s)},d={transform:"translate(".concat(-1*(r/2)," -256)")};return{outer:i,inner:l,path:d}}var _m={x:0,y:0,width:"100%",height:"100%"};function $a(e){var t=1<arguments.length&&arguments[1]!==void 0?arguments[1]:!0;if(e.attributes&&(e.attributes.fill||t)){e.attributes.fill="black"}return e}function er(e){if("g"===e.tag){return e.children}else{return[e]}}function tr(e){var t=e.children,a=e.attributes,r=e.main,i=e.mask,n=e.maskId,o=e.transform,s=r.width,l=r.icon,d=i.width,c=i.icon,u=Ka({transform:o,containerWidth:d,iconWidth:s}),p={tag:"rect",attributes:Ua({},_m,{fill:"white"})},m=l.children?{children:l.children.map($a)}:{},g={tag:"g",attributes:Ua({},u.inner),children:[$a(Ua({tag:l.tag,attributes:Ua({},l.attributes,u.path)},m))]},f={tag:"g",attributes:Ua({},u.outer),children:[g]},h="mask-".concat(n||Xa()),v="clip-".concat(n||Xa()),y={tag:"mask",attributes:Ua({},_m,{id:h,maskUnits:"userSpaceOnUse",maskContentUnits:"userSpaceOnUse"}),children:[p,f]},_={tag:"defs",children:[{tag:"clipPath",attributes:{id:v},children:er(c)},y]};t.push(_,{tag:"rect",attributes:Ua({fill:"currentColor","clip-path":"url(#".concat(v,")"),mask:"url(#".concat(h,")")},_m)});return{children:t,attributes:a}}function ar(e){var t=e.children,a=e.attributes,r=e.main,i=e.transform,n=e.styles,o=Ja(n);if(0<o.length){a.style=o}if(Qa(i)){var s=Ka({transform:i,containerWidth:r.width,iconWidth:r.width});t.push({tag:"g",attributes:Ua({},s.outer),children:[{tag:"g",attributes:Ua({},s.inner),children:[{tag:r.icon.tag,children:r.icon.children,attributes:Ua({},r.icon.attributes,s.path)}]}]})}else{t.push(r.icon)}return{children:t,attributes:a}}function rr(e){var t=e.children,a=e.main,r=e.mask,i=e.attributes,n=e.styles,o=e.transform;if(Qa(o)&&a.found&&!r.found){var s=a.width,l=a.height,d={x:s/l/2,y:.5};i.style=Ja(Ua({},n,{"transform-origin":"".concat(d.x+o.x/16,"em ").concat(d.y+o.y/16,"em")}))}return[{tag:"svg",attributes:i,children:t}]}function ir(e){var t=e.prefix,a=e.iconName,r=e.children,i=e.attributes,n=e.symbol,o=!0===n?"".concat(t,"-").concat(mm.familyPrefix,"-").concat(a):n;return[{tag:"svg",attributes:{style:"display: none;"},children:[{tag:"symbol",attributes:Ua({},i,{id:o}),children:r}]}]}function nr(e){var t=e.icons,a=t.main,r=t.mask,i=e.prefix,n=e.iconName,o=e.transform,s=e.symbol,l=e.title,d=e.maskId,c=e.titleId,u=e.extra,p=e.watchable,m=void 0===p?!1:p,g=r.found?r:a,f=g.width,h=g.height,v="fak"===i,y=v?"":"fa-w-".concat(Math.ceil(16*(f/h))),_=[mm.replacementClass,n?"".concat(mm.familyPrefix,"-").concat(n):"",y].filter(function(e){return-1===u.classes.indexOf(e)}).filter(function(e){return""!==e||!!e}).concat(u.classes).join(" "),x={children:[],attributes:Ua({},u.attributes,{"data-prefix":i,"data-icon":n,class:_,role:u.attributes.role||"img",xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 ".concat(f," ").concat(h)})},b=v&&!~u.classes.indexOf("fa-fw")?{width:"".concat(.0625*(16*(f/h)),"em")}:{};if(m){x.attributes["data-fa-i2svg"]=""}if(l)x.children.push({tag:"title",attributes:{id:x.attributes["aria-labelledby"]||"title-".concat(c||Xa())},children:[l]});var S=Ua({},x,{prefix:i,iconName:n,main:a,mask:r,maskId:d,transform:o,symbol:s,styles:Ua({},b,u.styles)}),M=r.found&&a.found?tr(S):ar(S),T=M.children,E=M.attributes;S.children=T;S.attributes=E;if(s){return ir(S)}else{return rr(S)}}var xm=function(){};mm.measurePerformance&&om&&om.mark&&om.measure?om:{mark:xm,measure:xm};var bm=function(e,t){return function(r,a,i,n){return e.call(t,r,a,i,n)}},Sm=function(e,t,a,r){var n=Object.keys(e),o=n.length,s=r!==void 0?bm(t,r):t,l,d,c;if(a===void 0){l=1;c=e[n[0]]}else{l=0;c=a}for(;l<o;l++){d=n[l];c=s(c,e[d],d,e)}return c};function or(e,t){var a=2<arguments.length&&arguments[2]!==void 0?arguments[2]:{},r=a.skipHooks,i=void 0===r?!1:r,n=Object.keys(t).reduce(function(e,a){var r=t[a],i=!!r.icon;if(i){e[r.iconName]=r.icon}else{e[a]=r}return e},{});if("function"==typeof w.hooks.addPack&&!i){w.hooks.addPack(e,n)}else{w.styles[e]=Ua({},w.styles[e]||{},n)}if("fas"===e){or("fa",t)}}var Mm=w.styles,Tm=w.shims,Em=function(){var e=function(e){return Sm(Mm,function(t,a,r){t[r]=Sm(a,e,{});return t},{})};e(function(e,t,a){if(t[3]){e[t[3]]=a}return e});e(function(e,t,a){var r=t[2];e[a]=a;r.forEach(function(t){e[t]=a});return e});var t=("far"in Mm);Sm(Tm,function(e,a){var r=a[0],i=a[1],n=a[2];if("far"===i&&!t){i="fas"}e[r]={prefix:i,iconName:n};return e},{})};Em();w.styles;function sr(e,t,a){if(e&&e[t]&&e[t][a]){return{prefix:t,iconName:a,icon:e[t][a]}}}function lr(e){var t=e.tag,a=e.attributes,r=void 0===a?{}:a,i=e.children,n=void 0===i?[]:i;if("string"==typeof e){return Ya(e)}else{return"<".concat(t," ").concat(Za(r),">").concat(n.map(lr).join(""),"</").concat(t,">")}}function dr(e){this.name="MissingIcon";this.message=e||"Icon unavailable";this.stack=new Error().stack}dr.prototype=Object.create(Error.prototype);dr.prototype.constructor=dr;var wm={fill:"currentColor"},Am={attributeType:"XML",repeatCount:"indefinite",dur:"2s"};({tag:"path",attributes:Ua({},wm,{d:"M156.5,447.7l-12.6,29.5c-18.7-9.5-35.9-21.2-51.5-34.9l22.7-22.7C127.6,430.5,141.5,440,156.5,447.7z M40.6,272H8.5 c1.4,21.2,5.4,41.7,11.7,61.1L50,321.2C45.1,305.5,41.8,289,40.6,272z M40.6,240c1.4-18.8,5.2-37,11.1-54.1l-29.5-12.6 C14.7,194.3,10,216.7,8.5,240H40.6z M64.3,156.5c7.8-14.9,17.2-28.8,28.1-41.5L69.7,92.3c-13.7,15.6-25.5,32.8-34.9,51.5 L64.3,156.5z M397,419.6c-13.9,12-29.4,22.3-46.1,30.4l11.9,29.8c20.7-9.9,39.8-22.6,56.9-37.6L397,419.6z M115,92.4 c13.9-12,29.4-22.3,46.1-30.4l-11.9-29.8c-20.7,9.9-39.8,22.6-56.8,37.6L115,92.4z M447.7,355.5c-7.8,14.9-17.2,28.8-28.1,41.5 l22.7,22.7c13.7-15.6,25.5-32.9,34.9-51.5L447.7,355.5z M471.4,272c-1.4,18.8-5.2,37-11.1,54.1l29.5,12.6 c7.5-21.1,12.2-43.5,13.6-66.8H471.4z M321.2,462c-15.7,5-32.2,8.2-49.2,9.4v32.1c21.2-1.4,41.7-5.4,61.1-11.7L321.2,462z M240,471.4c-18.8-1.4-37-5.2-54.1-11.1l-12.6,29.5c21.1,7.5,43.5,12.2,66.8,13.6V471.4z M462,190.8c5,15.7,8.2,32.2,9.4,49.2h32.1 c-1.4-21.2-5.4-41.7-11.7-61.1L462,190.8z M92.4,397c-12-13.9-22.3-29.4-30.4-46.1l-29.8,11.9c9.9,20.7,22.6,39.8,37.6,56.9 L92.4,397z M272,40.6c18.8,1.4,36.9,5.2,54.1,11.1l12.6-29.5C317.7,14.7,295.3,10,272,8.5V40.6z M190.8,50 c15.7-5,32.2-8.2,49.2-9.4V8.5c-21.2,1.4-41.7,5.4-61.1,11.7L190.8,50z M442.3,92.3L419.6,115c12,13.9,22.3,29.4,30.5,46.1 l29.8-11.9C470,128.5,457.3,109.4,442.3,92.3z M397,92.4l22.7-22.7c-15.6-13.7-32.8-25.5-51.5-34.9l-12.6,29.5 C370.4,72.1,384.4,81.5,397,92.4z"})});var km=Ua({},Am,{attributeName:"opacity"});({tag:"circle",attributes:Ua({},wm,{cx:"256",cy:"364",r:"28"}),children:[{tag:"animate",attributes:Ua({},Am,{attributeName:"r",values:"28;14;28;28;14;28;"})},{tag:"animate",attributes:Ua({},km,{values:"1;0;1;1;0;1;"})}]});({tag:"path",attributes:Ua({},wm,{opacity:"1",d:"M263.7,312h-16c-6.6,0-12-5.4-12-12c0-71,77.4-63.9,77.4-107.8c0-20-17.8-40.2-57.4-40.2c-29.1,0-44.3,9.6-59.2,28.7 c-3.9,5-11.1,6-16.2,2.4l-13.1-9.2c-5.6-3.9-6.9-11.8-2.6-17.2c21.2-27.2,46.4-44.7,91.2-44.7c52.3,0,97.4,29.8,97.4,80.2 c0,67.6-77.4,63.5-77.4,107.8C275.7,306.6,270.3,312,263.7,312z"}),children:[{tag:"animate",attributes:Ua({},km,{values:"1;0;0;0;0;1;"})}]});({tag:"path",attributes:Ua({},wm,{opacity:"0",d:"M232.5,134.5l7,168c0.3,6.4,5.6,11.5,12,11.5h9c6.4,0,11.7-5.1,12-11.5l7-168c0.3-6.8-5.2-12.5-12-12.5h-23 C237.7,122,232.2,127.7,232.5,134.5z"}),children:[{tag:"animate",attributes:Ua({},km,{values:"0;0;1;1;0;0;"})}]});w.styles;function cr(e){var t=e[0],a=e[1],r=e.slice(4),i=Ba(r,1),n=i[0],o=null;if(Array.isArray(n)){o={tag:"g",attributes:{class:"".concat(mm.familyPrefix,"-").concat(cm.GROUP)},children:[{tag:"path",attributes:{class:"".concat(mm.familyPrefix,"-").concat(cm.SECONDARY),fill:"currentColor",d:n[0]}},{tag:"path",attributes:{class:"".concat(mm.familyPrefix,"-").concat(cm.PRIMARY),fill:"currentColor",d:n[1]}}]}}else{o={tag:"path",attributes:{fill:"currentColor",d:n}}}return{found:!0,width:t,height:a,icon:o}}w.styles;function ur(){var e=lm,t=dm,a=mm.familyPrefix,r=mm.replacementClass,i="svg:not(:root).svg-inline--fa {\n  overflow: visible;\n}\n\n.svg-inline--fa {\n  display: inline-block;\n  font-size: inherit;\n  height: 1em;\n  overflow: visible;\n  vertical-align: -0.125em;\n}\n.svg-inline--fa.fa-lg {\n  vertical-align: -0.225em;\n}\n.svg-inline--fa.fa-w-1 {\n  width: 0.0625em;\n}\n.svg-inline--fa.fa-w-2 {\n  width: 0.125em;\n}\n.svg-inline--fa.fa-w-3 {\n  width: 0.1875em;\n}\n.svg-inline--fa.fa-w-4 {\n  width: 0.25em;\n}\n.svg-inline--fa.fa-w-5 {\n  width: 0.3125em;\n}\n.svg-inline--fa.fa-w-6 {\n  width: 0.375em;\n}\n.svg-inline--fa.fa-w-7 {\n  width: 0.4375em;\n}\n.svg-inline--fa.fa-w-8 {\n  width: 0.5em;\n}\n.svg-inline--fa.fa-w-9 {\n  width: 0.5625em;\n}\n.svg-inline--fa.fa-w-10 {\n  width: 0.625em;\n}\n.svg-inline--fa.fa-w-11 {\n  width: 0.6875em;\n}\n.svg-inline--fa.fa-w-12 {\n  width: 0.75em;\n}\n.svg-inline--fa.fa-w-13 {\n  width: 0.8125em;\n}\n.svg-inline--fa.fa-w-14 {\n  width: 0.875em;\n}\n.svg-inline--fa.fa-w-15 {\n  width: 0.9375em;\n}\n.svg-inline--fa.fa-w-16 {\n  width: 1em;\n}\n.svg-inline--fa.fa-w-17 {\n  width: 1.0625em;\n}\n.svg-inline--fa.fa-w-18 {\n  width: 1.125em;\n}\n.svg-inline--fa.fa-w-19 {\n  width: 1.1875em;\n}\n.svg-inline--fa.fa-w-20 {\n  width: 1.25em;\n}\n.svg-inline--fa.fa-pull-left {\n  margin-right: 0.3em;\n  width: auto;\n}\n.svg-inline--fa.fa-pull-right {\n  margin-left: 0.3em;\n  width: auto;\n}\n.svg-inline--fa.fa-border {\n  height: 1.5em;\n}\n.svg-inline--fa.fa-li {\n  width: 2em;\n}\n.svg-inline--fa.fa-fw {\n  width: 1.25em;\n}\n\n.fa-layers svg.svg-inline--fa {\n  bottom: 0;\n  left: 0;\n  margin: auto;\n  position: absolute;\n  right: 0;\n  top: 0;\n}\n\n.fa-layers {\n  display: inline-block;\n  height: 1em;\n  position: relative;\n  text-align: center;\n  vertical-align: -0.125em;\n  width: 1em;\n}\n.fa-layers svg.svg-inline--fa {\n  -webkit-transform-origin: center center;\n          transform-origin: center center;\n}\n\n.fa-layers-counter, .fa-layers-text {\n  display: inline-block;\n  position: absolute;\n  text-align: center;\n}\n\n.fa-layers-text {\n  left: 50%;\n  top: 50%;\n  -webkit-transform: translate(-50%, -50%);\n          transform: translate(-50%, -50%);\n  -webkit-transform-origin: center center;\n          transform-origin: center center;\n}\n\n.fa-layers-counter {\n  background-color: #ff253a;\n  border-radius: 1em;\n  -webkit-box-sizing: border-box;\n          box-sizing: border-box;\n  color: #fff;\n  height: 1.5em;\n  line-height: 1;\n  max-width: 5em;\n  min-width: 1.5em;\n  overflow: hidden;\n  padding: 0.25em;\n  right: 0;\n  text-overflow: ellipsis;\n  top: 0;\n  -webkit-transform: scale(0.25);\n          transform: scale(0.25);\n  -webkit-transform-origin: top right;\n          transform-origin: top right;\n}\n\n.fa-layers-bottom-right {\n  bottom: 0;\n  right: 0;\n  top: auto;\n  -webkit-transform: scale(0.25);\n          transform: scale(0.25);\n  -webkit-transform-origin: bottom right;\n          transform-origin: bottom right;\n}\n\n.fa-layers-bottom-left {\n  bottom: 0;\n  left: 0;\n  right: auto;\n  top: auto;\n  -webkit-transform: scale(0.25);\n          transform: scale(0.25);\n  -webkit-transform-origin: bottom left;\n          transform-origin: bottom left;\n}\n\n.fa-layers-top-right {\n  right: 0;\n  top: 0;\n  -webkit-transform: scale(0.25);\n          transform: scale(0.25);\n  -webkit-transform-origin: top right;\n          transform-origin: top right;\n}\n\n.fa-layers-top-left {\n  left: 0;\n  right: auto;\n  top: 0;\n  -webkit-transform: scale(0.25);\n          transform: scale(0.25);\n  -webkit-transform-origin: top left;\n          transform-origin: top left;\n}\n\n.fa-lg {\n  font-size: 1.3333333333em;\n  line-height: 0.75em;\n  vertical-align: -0.0667em;\n}\n\n.fa-xs {\n  font-size: 0.75em;\n}\n\n.fa-sm {\n  font-size: 0.875em;\n}\n\n.fa-1x {\n  font-size: 1em;\n}\n\n.fa-2x {\n  font-size: 2em;\n}\n\n.fa-3x {\n  font-size: 3em;\n}\n\n.fa-4x {\n  font-size: 4em;\n}\n\n.fa-5x {\n  font-size: 5em;\n}\n\n.fa-6x {\n  font-size: 6em;\n}\n\n.fa-7x {\n  font-size: 7em;\n}\n\n.fa-8x {\n  font-size: 8em;\n}\n\n.fa-9x {\n  font-size: 9em;\n}\n\n.fa-10x {\n  font-size: 10em;\n}\n\n.fa-fw {\n  text-align: center;\n  width: 1.25em;\n}\n\n.fa-ul {\n  list-style-type: none;\n  margin-left: 2.5em;\n  padding-left: 0;\n}\n.fa-ul > li {\n  position: relative;\n}\n\n.fa-li {\n  left: -2em;\n  position: absolute;\n  text-align: center;\n  width: 2em;\n  line-height: inherit;\n}\n\n.fa-border {\n  border: solid 0.08em #eee;\n  border-radius: 0.1em;\n  padding: 0.2em 0.25em 0.15em;\n}\n\n.fa-pull-left {\n  float: left;\n}\n\n.fa-pull-right {\n  float: right;\n}\n\n.fa.fa-pull-left,\n.fas.fa-pull-left,\n.far.fa-pull-left,\n.fal.fa-pull-left,\n.fab.fa-pull-left {\n  margin-right: 0.3em;\n}\n.fa.fa-pull-right,\n.fas.fa-pull-right,\n.far.fa-pull-right,\n.fal.fa-pull-right,\n.fab.fa-pull-right {\n  margin-left: 0.3em;\n}\n\n.fa-spin {\n  -webkit-animation: fa-spin 2s infinite linear;\n          animation: fa-spin 2s infinite linear;\n}\n\n.fa-pulse {\n  -webkit-animation: fa-spin 1s infinite steps(8);\n          animation: fa-spin 1s infinite steps(8);\n}\n\n@-webkit-keyframes fa-spin {\n  0% {\n    -webkit-transform: rotate(0deg);\n            transform: rotate(0deg);\n  }\n  100% {\n    -webkit-transform: rotate(360deg);\n            transform: rotate(360deg);\n  }\n}\n\n@keyframes fa-spin {\n  0% {\n    -webkit-transform: rotate(0deg);\n            transform: rotate(0deg);\n  }\n  100% {\n    -webkit-transform: rotate(360deg);\n            transform: rotate(360deg);\n  }\n}\n.fa-rotate-90 {\n  -ms-filter: \"progid:DXImageTransform.Microsoft.BasicImage(rotation=1)\";\n  -webkit-transform: rotate(90deg);\n          transform: rotate(90deg);\n}\n\n.fa-rotate-180 {\n  -ms-filter: \"progid:DXImageTransform.Microsoft.BasicImage(rotation=2)\";\n  -webkit-transform: rotate(180deg);\n          transform: rotate(180deg);\n}\n\n.fa-rotate-270 {\n  -ms-filter: \"progid:DXImageTransform.Microsoft.BasicImage(rotation=3)\";\n  -webkit-transform: rotate(270deg);\n          transform: rotate(270deg);\n}\n\n.fa-flip-horizontal {\n  -ms-filter: \"progid:DXImageTransform.Microsoft.BasicImage(rotation=0, mirror=1)\";\n  -webkit-transform: scale(-1, 1);\n          transform: scale(-1, 1);\n}\n\n.fa-flip-vertical {\n  -ms-filter: \"progid:DXImageTransform.Microsoft.BasicImage(rotation=2, mirror=1)\";\n  -webkit-transform: scale(1, -1);\n          transform: scale(1, -1);\n}\n\n.fa-flip-both, .fa-flip-horizontal.fa-flip-vertical {\n  -ms-filter: \"progid:DXImageTransform.Microsoft.BasicImage(rotation=2, mirror=1)\";\n  -webkit-transform: scale(-1, -1);\n          transform: scale(-1, -1);\n}\n\n:root .fa-rotate-90,\n:root .fa-rotate-180,\n:root .fa-rotate-270,\n:root .fa-flip-horizontal,\n:root .fa-flip-vertical,\n:root .fa-flip-both {\n  -webkit-filter: none;\n          filter: none;\n}\n\n.fa-stack {\n  display: inline-block;\n  height: 2em;\n  position: relative;\n  width: 2.5em;\n}\n\n.fa-stack-1x,\n.fa-stack-2x {\n  bottom: 0;\n  left: 0;\n  margin: auto;\n  position: absolute;\n  right: 0;\n  top: 0;\n}\n\n.svg-inline--fa.fa-stack-1x {\n  height: 1em;\n  width: 1.25em;\n}\n.svg-inline--fa.fa-stack-2x {\n  height: 2em;\n  width: 2.5em;\n}\n\n.fa-inverse {\n  color: #fff;\n}\n\n.sr-only {\n  border: 0;\n  clip: rect(0, 0, 0, 0);\n  height: 1px;\n  margin: -1px;\n  overflow: hidden;\n  padding: 0;\n  position: absolute;\n  width: 1px;\n}\n\n.sr-only-focusable:active, .sr-only-focusable:focus {\n  clip: auto;\n  height: auto;\n  margin: 0;\n  overflow: visible;\n  position: static;\n  width: auto;\n}\n\n.svg-inline--fa .fa-primary {\n  fill: var(--fa-primary-color, currentColor);\n  opacity: 1;\n  opacity: var(--fa-primary-opacity, 1);\n}\n\n.svg-inline--fa .fa-secondary {\n  fill: var(--fa-secondary-color, currentColor);\n  opacity: 0.4;\n  opacity: var(--fa-secondary-opacity, 0.4);\n}\n\n.svg-inline--fa.fa-swap-opacity .fa-primary {\n  opacity: 0.4;\n  opacity: var(--fa-secondary-opacity, 0.4);\n}\n\n.svg-inline--fa.fa-swap-opacity .fa-secondary {\n  opacity: 1;\n  opacity: var(--fa-primary-opacity, 1);\n}\n\n.svg-inline--fa mask .fa-primary,\n.svg-inline--fa mask .fa-secondary {\n  fill: black;\n}\n\n.fad.fa-inverse {\n  color: #fff;\n}";if(a!==e||r!==t){var n=new RegExp("\\.".concat(e,"\\-"),"g"),o=new RegExp("\\--".concat(e,"\\-"),"g"),l=new RegExp("\\.".concat(t),"g");i=i.replace(n,".".concat(a,"-")).replace(o,"--".concat(a,"-")).replace(l,".".concat(r))}return i}var Cm=function(){function e(){za(this,e);this.definitions={}}Oa(e,[{key:"add",value:function(){for(var e=this,t=arguments.length,a=Array(t),r=0;r<t;r++){a[r]=arguments[r]}var i=a.reduce(this._pullDefinitions,{});Object.keys(i).forEach(function(t){e.definitions[t]=Ua({},e.definitions[t]||{},i[t]);or(t,i[t]);Em()})}},{key:"reset",value:function(){this.definitions={}}},{key:"_pullDefinitions",value:function(e,t){var a=t.prefix&&t.iconName&&t.icon?{0:t}:t;Object.keys(a).map(function(t){var r=a[t],i=r.prefix,n=r.iconName,o=r.icon;if(!e[i])e[i]={};e[i][n]=o});return e}}]);return e}();function pr(){if(mm.autoAddCss&&!Rm){qa(ur());Rm=!0}}function mr(e,t){Object.defineProperty(e,"abstract",{get:t});Object.defineProperty(e,"html",{get:function(){return e.abstract.map(function(e){return lr(e)})}});Object.defineProperty(e,"node",{get:function(){if(!sm)return;var t=nm.createElement("div");t.innerHTML=e.html;return t.children}});return e}function gr(e){var t=e.prefix,a=void 0===t?"fa":t,r=e.iconName;if(!r)return;return sr(Lm.definitions,a,r)||sr(w.styles,a,r)}var Lm=new Cm,Rm=!1,Pm=function(e){return function(t){var a=1<arguments.length&&arguments[1]!==void 0?arguments[1]:{},r=(t||{}).icon?t:gr(t||{}),i=a.mask;if(i){i=(i||{}).icon?i:gr(i||{})}return e(r,Ua({},a,{mask:i}))}}(function(e){var t=1<arguments.length&&arguments[1]!==void 0?arguments[1]:{},a=t.transform,r=void 0===a?ym:a,i=t.symbol,n=void 0===i?!1:i,o=t.mask,s=void 0===o?null:o,l=t.maskId,d=void 0===l?null:l,c=t.title,u=void 0===c?null:c,p=t.titleId,m=void 0===p?null:p,g=t.classes,f=void 0===g?[]:g,h=t.attributes,v=void 0===h?{}:h,y=t.styles,_=void 0===y?{}:y;if(!e)return;var x=e.prefix,b=e.iconName,S=e.icon;return mr(Ua({type:"icon"},e),function(){pr();if(mm.autoA11y){if(u){v["aria-labelledby"]="".concat(mm.replacementClass,"-title-").concat(m||Xa())}else{v["aria-hidden"]="true";v.focusable="false"}}return nr({icons:{main:cr(S),mask:s?cr(s.icon):{found:!1,width:null,height:null,icon:{}}},prefix:x,iconName:b,transform:Ua({},ym,r),symbol:n,title:u,maskId:d,titleId:m,extra:{attributes:v,styles:_,classes:f}})})}),Dm={prefix:"fas",iconName:"undo",icon:[512,512,[],"f0e2","M212.333 224.333H12c-6.627 0-12-5.373-12-12V12C0 5.373 5.373 0 12 0h48c6.627 0 12 5.373 12 12v78.112C117.773 39.279 184.26 7.47 258.175 8.007c136.906.994 246.448 111.623 246.157 248.532C504.041 393.258 393.12 504 256.333 504c-64.089 0-122.496-24.313-166.51-64.215-5.099-4.622-5.334-12.554-.467-17.42l33.967-33.967c4.474-4.474 11.662-4.717 16.401-.525C170.76 415.336 211.58 432 256.333 432c97.268 0 176-78.716 176-176 0-97.267-78.716-176-176-176-58.496 0-110.28 28.476-142.274 72.333h98.274c6.627 0 12 5.373 12 12v48c0 6.627-5.373 12-12 12z"]},Im={IDLE:Symbol(),ROTATE:Symbol(),PAN:Symbol(),SCALE:Symbol(),FOV:Symbol(),FOCUS:Symbol(),ZROTATE:Symbol(),TOUCH_MULTI:Symbol(),ANIMATION_FOCUS:Symbol(),ANIMATION_ROTATE:Symbol()},zm={NONE:Symbol(),ONE_FINGER:Symbol(),ONE_FINGER_SWITCHED:Symbol(),TWO_FINGER:Symbol(),MULT_FINGER:Symbol(),CURSOR:Symbol()},Nm={x:0,y:0},Om={camera:new ls,gizmos:new ls},Fm={type:"change"},Um={type:"start"},Bm={type:"end"},Hm=new Np,Gm=new Po,Vm=function(e){_inherits(t,e);var a=_createSuper(t);function t(e,r){var i,n=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;_classCallCheck2(this,t);i=a.call(this);_defineProperty2(_assertThisInitialized(i),"onWindowResize",function(){var e=(i._gizmos.scale.x+i._gizmos.scale.y+i._gizmos.scale.z)/3;i._tbRadius=i.calculateTbRadius(i.camera);var t=i._tbRadius/e,a=new Wc(0,0,t,t),r=a.getPoints(i._curvePts),n=new pl().setFromPoints(r);for(var o in i._gizmos.children){i._gizmos.children[o].geometry=n}i.dispatchEvent(Fm)});_defineProperty2(_assertThisInitialized(i),"onContextMenu",function(e){if(!i.enabled){return}for(var t=0;t<i.mouseActions.length;t++){if(2==i.mouseActions[t].mouse){e.preventDefault();break}}});_defineProperty2(_assertThisInitialized(i),"onPointerCancel",function(){i._touchStart.splice(0,i._touchStart.length);i._touchCurrent.splice(0,i._touchCurrent.length);i._input=zm.NONE});_defineProperty2(_assertThisInitialized(i),"onPointerDown",function(e){if(0==e.button&&e.isPrimary){i._downValid=!0;i._downEvents.push(e);i._downStart=performance.now()}else{i._downValid=!1}if("touch"==e.pointerType&&i._input!=zm.CURSOR){i._touchStart.push(e);i._touchCurrent.push(e);switch(i._input){case zm.NONE:i._input=zm.ONE_FINGER;i.onSinglePanStart(e,"ROTATE");window.addEventListener("pointermove",i.onPointerMove);window.addEventListener("pointerup",i.onPointerUp);break;case zm.ONE_FINGER:case zm.ONE_FINGER_SWITCHED:i._input=zm.TWO_FINGER;i.onRotateStart();i.onPinchStart();i.onDoublePanStart();break;case zm.TWO_FINGER:i._input=zm.MULT_FINGER;i.onTriplePanStart(e);break;}}else if("touch"!=e.pointerType&&i._input==zm.NONE){var t=null;if(e.ctrlKey||e.metaKey){t="CTRL"}else if(e.shiftKey){t="SHIFT"}i._mouseOp=i.getOpFromAction(e.button,t);if(null!=i._mouseOp){window.addEventListener("pointermove",i.onPointerMove);window.addEventListener("pointerup",i.onPointerUp);i._input=zm.CURSOR;i._button=e.button;i.onSinglePanStart(e,i._mouseOp)}}});_defineProperty2(_assertThisInitialized(i),"onPointerMove",function(e){if("touch"==e.pointerType&&i._input!=zm.CURSOR){switch(i._input){case zm.ONE_FINGER:i.updateTouchEvent(e);i.onSinglePanMove(e,Im.ROTATE);break;case zm.ONE_FINGER_SWITCHED:var t=i.calculatePointersDistance(i._touchCurrent[0],e)*i._devPxRatio;if(t>=i._switchSensibility){i._input=zm.ONE_FINGER;i.updateTouchEvent(e);i.onSinglePanStart(e,"ROTATE");break}break;case zm.TWO_FINGER:i.updateTouchEvent(e);i.onRotateMove();i.onPinchMove();i.onDoublePanMove();break;case zm.MULT_FINGER:i.updateTouchEvent(e);i.onTriplePanMove(e);break;}}else if("touch"!=e.pointerType&&i._input==zm.CURSOR){var a=null;if(e.ctrlKey||e.metaKey){a="CTRL"}else if(e.shiftKey){a="SHIFT"}var r=i.getOpStateFromAction(i._button,a);if(null!=r){i.onSinglePanMove(e,r)}}if(i._downValid){var n=i.calculatePointersDistance(i._downEvents[i._downEvents.length-1],e)*i._devPxRatio;if(n>i._movementThreshold){i._downValid=!1}}});_defineProperty2(_assertThisInitialized(i),"onPointerUp",function(e){if("touch"==e.pointerType&&i._input!=zm.CURSOR){for(var t=i._touchCurrent.length,a=0;a<t;a++){if(i._touchCurrent[a].pointerId==e.pointerId){i._touchCurrent.splice(a,1);i._touchStart.splice(a,1);break}}switch(i._input){case zm.ONE_FINGER:case zm.ONE_FINGER_SWITCHED:window.removeEventListener("pointermove",i.onPointerMove);window.removeEventListener("pointerup",i.onPointerUp);i._input=zm.NONE;i.onSinglePanEnd();break;case zm.TWO_FINGER:i.onDoublePanEnd(e);i.onPinchEnd(e);i.onRotateEnd(e);i._input=zm.ONE_FINGER_SWITCHED;break;case zm.MULT_FINGER:if(0==i._touchCurrent.length){window.removeEventListener("pointermove",i.onPointerMove);window.removeEventListener("pointerup",i.onPointerUp);i._input=zm.NONE;i.onTriplePanEnd()}break;}}else if("touch"!=e.pointerType&&i._input==zm.CURSOR){window.removeEventListener("pointermove",i.onPointerMove);window.removeEventListener("pointerup",i.onPointerUp);i._input=zm.NONE;i.onSinglePanEnd();i._button=-1}if(e.isPrimary){if(i._downValid){var o=e.timeStamp-i._downEvents[i._downEvents.length-1].timeStamp;if(o<=i._maxDownTime){if(0==i._nclicks){i._nclicks=1;i._clickStart=performance.now()}else{var r=e.timeStamp-i._clickStart,n=i.calculatePointersDistance(i._downEvents[1],i._downEvents[0])*i._devPxRatio;if(r<=i._maxInterval&&n<=i._posThreshold){i._nclicks=0;i._downEvents.splice(0,i._downEvents.length);i.onDoubleTap(e)}else{i._nclicks=1;i._downEvents.shift();i._clickStart=performance.now()}}}else{i._downValid=!1;i._nclicks=0;i._downEvents.splice(0,i._downEvents.length)}}else{i._nclicks=0;i._downEvents.splice(0,i._downEvents.length)}}});_defineProperty2(_assertThisInitialized(i),"onWheel",function(e){if(i.enabled&&i.enableZoom){var l=null;if(e.ctrlKey||e.metaKey){l="CTRL"}else if(e.shiftKey){l="SHIFT"}var d=i.getOpFromAction("WHEEL",l);if(null!=d){e.preventDefault();i.dispatchEvent(Um);var t=e.deltaY/125,a=1;if(0<t){a=1/i.scaleFactor}else if(0>t){a=i.scaleFactor}switch(d){case"ZOOM":i.updateTbState(Im.SCALE,!0);if(0<t){a=1/Math.pow(i.scaleFactor,t)}else if(0>t){a=Math.pow(i.scaleFactor,-t)}if(i.cursorZoom&&i.enablePan){var c;if(i.camera.isOrthographicCamera){c=i.unprojectOnTbPlane(i.camera,e.clientX,e.clientY,i.domElement).applyQuaternion(i.camera.quaternion).multiplyScalar(1/i.camera.zoom).add(i._gizmos.position)}else if(i.camera.isPerspectiveCamera){c=i.unprojectOnTbPlane(i.camera,e.clientX,e.clientY,i.domElement).applyQuaternion(i.camera.quaternion).add(i._gizmos.position)}i.applyTransformMatrix(i.scale(a,c))}else{i.applyTransformMatrix(i.scale(a,i._gizmos.position))}if(null!=i._grid){i.disposeGrid();i.drawGrid()}i.updateTbState(Im.IDLE,!1);i.dispatchEvent(Fm);i.dispatchEvent(Bm);break;case"FOV":if(i.camera.isPerspectiveCamera){i.updateTbState(Im.FOV,!0);if(0!=e.deltaX){t=e.deltaX/125;a=1;if(0<t){a=1/Math.pow(i.scaleFactor,t)}else if(0>t){a=Math.pow(i.scaleFactor,-t)}}i._v3_1.setFromMatrixPosition(i._cameraMatrixState);var r=i._v3_1.distanceTo(i._gizmos.position),n=r/a;n=xo.clamp(n,i.minDistance,i.maxDistance);var o=r*Math.tan(.5*(xo.DEG2RAD*i.camera.fov)),s=xo.RAD2DEG*(2*Math.atan(o/n));if(s>i.maxFov){s=i.maxFov}else if(s<i.minFov){s=i.minFov}var u=o/Math.tan(xo.DEG2RAD*(s/2));a=r/u;i.setFov(s);i.applyTransformMatrix(i.scale(a,i._gizmos.position,!1))}if(null!=i._grid){i.disposeGrid();i.drawGrid()}i.updateTbState(Im.IDLE,!1);i.dispatchEvent(Fm);i.dispatchEvent(Bm);break;}}}});_defineProperty2(_assertThisInitialized(i),"onKeyDown",function(e){if("c"==e.key){if(e.ctrlKey||e.metaKey){i.copyState()}}else if("v"==e.key){if(e.ctrlKey||e.metaKey){i.pasteState()}}});_defineProperty2(_assertThisInitialized(i),"onSinglePanStart",function(e,t){if(i.enabled){i.dispatchEvent(Um);i.setCenter(e.clientX,e.clientY);switch(t){case"PAN":if(!i.enablePan){return}if(-1!=i._animationId){cancelAnimationFrame(i._animationId);i._animationId=-1;i._timeStart=-1;i.activateGizmos(!1);i.dispatchEvent(Fm)}i.updateTbState(Im.PAN,!0);i._startCursorPosition.copy(i.unprojectOnTbPlane(i.camera,Nm.x,Nm.y,i.domElement));if(i.enableGrid){i.drawGrid();i.dispatchEvent(Fm)}break;case"ROTATE":if(!i.enableRotate){return}if(-1!=i._animationId){cancelAnimationFrame(i._animationId);i._animationId=-1;i._timeStart=-1}i.updateTbState(Im.ROTATE,!0);i._startCursorPosition.copy(i.unprojectOnTbSurface(i.camera,Nm.x,Nm.y,i.domElement,i._tbRadius));i.activateGizmos(!0);if(i.enableAnimations){i._timePrev=i._timeCurrent=performance.now();i._angleCurrent=i._anglePrev=0;i._cursorPosPrev.copy(i._startCursorPosition);i._cursorPosCurr.copy(i._cursorPosPrev);i._wCurr=0;i._wPrev=i._wCurr}i.dispatchEvent(Fm);break;case"FOV":if(!i.camera.isPerspectiveCamera||!i.enableZoom){return}if(-1!=i._animationId){cancelAnimationFrame(i._animationId);i._animationId=-1;i._timeStart=-1;i.activateGizmos(!1);i.dispatchEvent(Fm)}i.updateTbState(Im.FOV,!0);i._startCursorPosition.setY(.5*i.getCursorNDC(Nm.x,Nm.y,i.domElement).y);i._currentCursorPosition.copy(i._startCursorPosition);break;case"ZOOM":if(!i.enableZoom){return}if(-1!=i._animationId){cancelAnimationFrame(i._animationId);i._animationId=-1;i._timeStart=-1;i.activateGizmos(!1);i.dispatchEvent(Fm)}i.updateTbState(Im.SCALE,!0);i._startCursorPosition.setY(.5*i.getCursorNDC(Nm.x,Nm.y,i.domElement).y);i._currentCursorPosition.copy(i._startCursorPosition);break;}}});_defineProperty2(_assertThisInitialized(i),"onSinglePanMove",function(e,t){if(i.enabled){var g=t!=i._state;i.setCenter(e.clientX,e.clientY);switch(t){case Im.PAN:if(i.enablePan){if(g){i.dispatchEvent(Bm);i.dispatchEvent(Um);i.updateTbState(t,!0);i._startCursorPosition.copy(i.unprojectOnTbPlane(i.camera,Nm.x,Nm.y,i.domElement));if(i.enableGrid){i.drawGrid()}i.activateGizmos(!1)}else{i._currentCursorPosition.copy(i.unprojectOnTbPlane(i.camera,Nm.x,Nm.y,i.domElement));i.applyTransformMatrix(i.pan(i._startCursorPosition,i._currentCursorPosition))}}break;case Im.ROTATE:if(i.enableRotate){if(g){i.dispatchEvent(Bm);i.dispatchEvent(Um);i.updateTbState(t,!0);i._startCursorPosition.copy(i.unprojectOnTbSurface(i.camera,Nm.x,Nm.y,i.domElement,i._tbRadius));if(i.enableGrid){i.disposeGrid()}i.activateGizmos(!0)}else{i._currentCursorPosition.copy(i.unprojectOnTbSurface(i.camera,Nm.x,Nm.y,i.domElement,i._tbRadius));var a=i._startCursorPosition.distanceTo(i._currentCursorPosition),r=i._startCursorPosition.angleTo(i._currentCursorPosition),n=Math.max(a/i._tbRadius,r);i.applyTransformMatrix(i.rotate(i.calculateRotationAxis(i._startCursorPosition,i._currentCursorPosition),n));if(i.enableAnimations){i._timePrev=i._timeCurrent;i._timeCurrent=performance.now();i._anglePrev=i._angleCurrent;i._angleCurrent=n;i._cursorPosPrev.copy(i._cursorPosCurr);i._cursorPosCurr.copy(i._currentCursorPosition);i._wPrev=i._wCurr;i._wCurr=i.calculateAngularSpeed(i._anglePrev,i._angleCurrent,i._timePrev,i._timeCurrent)}}}break;case Im.SCALE:if(i.enableZoom){if(g){i.dispatchEvent(Bm);i.dispatchEvent(Um);i.updateTbState(t,!0);i._startCursorPosition.setY(.5*i.getCursorNDC(Nm.x,Nm.y,i.domElement).y);i._currentCursorPosition.copy(i._startCursorPosition);if(i.enableGrid){i.disposeGrid()}i.activateGizmos(!1)}else{i._currentCursorPosition.setY(.5*i.getCursorNDC(Nm.x,Nm.y,i.domElement).y);var o=i._currentCursorPosition.y-i._startCursorPosition.y,s=1;if(0>o){s=1/Math.pow(i.scaleFactor,-o*8)}else if(0<o){s=Math.pow(i.scaleFactor,o*8)}i.applyTransformMatrix(i.scale(s,i._gizmos.position))}}break;case Im.FOV:if(i.enableZoom&&i.camera.isPerspectiveCamera){if(g){i.dispatchEvent(Bm);i.dispatchEvent(Um);i.updateTbState(t,!0);i._startCursorPosition.setY(.5*i.getCursorNDC(Nm.x,Nm.y,i.domElement).y);i._currentCursorPosition.copy(i._startCursorPosition);if(i.enableGrid){i.disposeGrid()}i.activateGizmos(!1)}else{i._currentCursorPosition.setY(.5*i.getCursorNDC(Nm.x,Nm.y,i.domElement).y);var l=i._currentCursorPosition.y-i._startCursorPosition.y,d=1;if(0>l){d=1/Math.pow(i.scaleFactor,-l*8)}else if(0<l){d=Math.pow(i.scaleFactor,l*8)}i._v3_1.setFromMatrixPosition(i._cameraMatrixState);var c=i._v3_1.distanceTo(i._gizmos.position),u=c/d;u=xo.clamp(u,i.minDistance,i.maxDistance);var p=c*Math.tan(.5*(xo.DEG2RAD*i._fovState)),m=xo.RAD2DEG*(2*Math.atan(p/u));m=xo.clamp(m,i.minFov,i.maxFov);var f=p/Math.tan(xo.DEG2RAD*(m/2));d=c/f;i._v3_2.setFromMatrixPosition(i._gizmoMatrixState);i.setFov(m);i.applyTransformMatrix(i.scale(d,i._v3_2,!1));Gm.copy(i._gizmos.position).sub(i.camera.position).normalize().multiplyScalar(f/c);i._m4_1.makeTranslation(Gm.x,Gm.y,Gm.z)}}break;}i.dispatchEvent(Fm)}});_defineProperty2(_assertThisInitialized(i),"onSinglePanEnd",function(){if(i._state==Im.ROTATE){if(!i.enableRotate){return}if(i.enableAnimations){var r=performance.now()-i._timeCurrent;if(120>r){var e=Math.abs((i._wPrev+i._wCurr)/2),a=_assertThisInitialized(i);i._animationId=window.requestAnimationFrame(function(r){a.updateTbState(Im.ANIMATION_ROTATE,!0);var t=a.calculateRotationAxis(a._cursorPosPrev,a._cursorPosCurr);a.onRotationAnim(r,t,Math.min(e,a.wMax))})}else{i.updateTbState(Im.IDLE,!1);i.activateGizmos(!1);i.dispatchEvent(Fm)}}else{i.updateTbState(Im.IDLE,!1);i.activateGizmos(!1);i.dispatchEvent(Fm)}}else if(i._state==Im.PAN||i._state==Im.IDLE){i.updateTbState(Im.IDLE,!1);if(i.enableGrid){i.disposeGrid()}i.activateGizmos(!1);i.dispatchEvent(Fm)}i.dispatchEvent(Bm)});_defineProperty2(_assertThisInitialized(i),"onDoubleTap",function(e){if(i.enabled&&i.enablePan&&null!=i.scene){i.dispatchEvent(Um);i.setCenter(e.clientX,e.clientY);var a=i.unprojectOnObj(i.getCursorNDC(Nm.x,Nm.y,i.domElement),i.camera);if(null!=a&&i.enableAnimations){var r=_assertThisInitialized(i);if(-1!=i._animationId){window.cancelAnimationFrame(i._animationId)}i._timeStart=-1;i._animationId=window.requestAnimationFrame(function(e){r.updateTbState(Im.ANIMATION_FOCUS,!0);r.onFocusAnim(e,a,r._cameraMatrixState,r._gizmoMatrixState)})}else if(null!=a&&!i.enableAnimations){i.updateTbState(Im.FOCUS,!0);i.focus(a,i.scaleFactor);i.updateTbState(Im.IDLE,!1);i.dispatchEvent(Fm)}}i.dispatchEvent(Bm)});_defineProperty2(_assertThisInitialized(i),"onDoublePanStart",function(){if(i.enabled&&i.enablePan){i.dispatchEvent(Um);i.updateTbState(Im.PAN,!0);i.setCenter((i._touchCurrent[0].clientX+i._touchCurrent[1].clientX)/2,(i._touchCurrent[0].clientY+i._touchCurrent[1].clientY)/2);i._startCursorPosition.copy(i.unprojectOnTbPlane(i.camera,Nm.x,Nm.y,i.domElement,!0));i._currentCursorPosition.copy(i._startCursorPosition);i.activateGizmos(!1)}});_defineProperty2(_assertThisInitialized(i),"onDoublePanMove",function(){if(i.enabled&&i.enablePan){i.setCenter((i._touchCurrent[0].clientX+i._touchCurrent[1].clientX)/2,(i._touchCurrent[0].clientY+i._touchCurrent[1].clientY)/2);if(i._state!=Im.PAN){i.updateTbState(Im.PAN,!0);i._startCursorPosition.copy(i._currentCursorPosition)}i._currentCursorPosition.copy(i.unprojectOnTbPlane(i.camera,Nm.x,Nm.y,i.domElement,!0));i.applyTransformMatrix(i.pan(i._startCursorPosition,i._currentCursorPosition,!0));i.dispatchEvent(Fm)}});_defineProperty2(_assertThisInitialized(i),"onDoublePanEnd",function(){i.updateTbState(Im.IDLE,!1);i.dispatchEvent(Bm)});_defineProperty2(_assertThisInitialized(i),"onRotateStart",function(){if(i.enabled&&i.enableRotate){i.dispatchEvent(Um);i.updateTbState(Im.ZROTATE,!0);i._startFingerRotation=i.getAngle(i._touchCurrent[1],i._touchCurrent[0])+i.getAngle(i._touchStart[1],i._touchStart[0]);i._currentFingerRotation=i._startFingerRotation;i.camera.getWorldDirection(i._rotationAxis);if(!i.enablePan&&!i.enableZoom){i.activateGizmos(!0)}}});_defineProperty2(_assertThisInitialized(i),"onRotateMove",function(){if(i.enabled&&i.enableRotate){i.setCenter((i._touchCurrent[0].clientX+i._touchCurrent[1].clientX)/2,(i._touchCurrent[0].clientY+i._touchCurrent[1].clientY)/2);var e;if(i._state!=Im.ZROTATE){i.updateTbState(Im.ZROTATE,!0);i._startFingerRotation=i._currentFingerRotation}i._currentFingerRotation=i.getAngle(i._touchCurrent[1],i._touchCurrent[0])+i.getAngle(i._touchStart[1],i._touchStart[0]);if(!i.enablePan){e=new Po().setFromMatrixPosition(i._gizmoMatrixState)}else{i._v3_2.setFromMatrixPosition(i._gizmoMatrixState);e=i.unprojectOnTbPlane(i.camera,Nm.x,Nm.y,i.domElement).applyQuaternion(i.camera.quaternion).multiplyScalar(1/i.camera.zoom).add(i._v3_2)}var t=xo.DEG2RAD*(i._startFingerRotation-i._currentFingerRotation);i.applyTransformMatrix(i.zRotate(e,t));i.dispatchEvent(Fm)}});_defineProperty2(_assertThisInitialized(i),"onRotateEnd",function(){i.updateTbState(Im.IDLE,!1);i.activateGizmos(!1);i.dispatchEvent(Bm)});_defineProperty2(_assertThisInitialized(i),"onPinchStart",function(){if(i.enabled&&i.enableZoom){i.dispatchEvent(Um);i.updateTbState(Im.SCALE,!0);i._startFingerDistance=i.calculatePointersDistance(i._touchCurrent[0],i._touchCurrent[1]);i._currentFingerDistance=i._startFingerDistance;i.activateGizmos(!1)}});_defineProperty2(_assertThisInitialized(i),"onPinchMove",function(){if(i.enabled&&i.enableZoom){i.setCenter((i._touchCurrent[0].clientX+i._touchCurrent[1].clientX)/2,(i._touchCurrent[0].clientY+i._touchCurrent[1].clientY)/2);if(i._state!=Im.SCALE){i._startFingerDistance=i._currentFingerDistance;i.updateTbState(Im.SCALE,!0)}i._currentFingerDistance=Math.max(i.calculatePointersDistance(i._touchCurrent[0],i._touchCurrent[1]),12*i._devPxRatio);var e=i._currentFingerDistance/i._startFingerDistance,t;if(!i.enablePan){t=i._gizmos.position}else{if(i.camera.isOrthographicCamera){t=i.unprojectOnTbPlane(i.camera,Nm.x,Nm.y,i.domElement).applyQuaternion(i.camera.quaternion).multiplyScalar(1/i.camera.zoom).add(i._gizmos.position)}else if(i.camera.isPerspectiveCamera){t=i.unprojectOnTbPlane(i.camera,Nm.x,Nm.y,i.domElement).applyQuaternion(i.camera.quaternion).add(i._gizmos.position)}}i.applyTransformMatrix(i.scale(e,t));i.dispatchEvent(Fm)}});_defineProperty2(_assertThisInitialized(i),"onPinchEnd",function(){i.updateTbState(Im.IDLE,!1);i.dispatchEvent(Bm)});_defineProperty2(_assertThisInitialized(i),"onTriplePanStart",function(){if(i.enabled&&i.enableZoom){i.dispatchEvent(Um);i.updateTbState(Im.SCALE,!0);for(var e=0,t=0,a=i._touchCurrent.length,r=0;r<a;r++){e+=i._touchCurrent[r].clientX;t+=i._touchCurrent[r].clientY}i.setCenter(e/a,t/a);i._startCursorPosition.setY(.5*i.getCursorNDC(Nm.x,Nm.y,i.domElement).y);i._currentCursorPosition.copy(i._startCursorPosition)}});_defineProperty2(_assertThisInitialized(i),"onTriplePanMove",function(){if(i.enabled&&i.enableZoom){for(var e=0,t=0,a=i._touchCurrent.length,r=0;r<a;r++){e+=i._touchCurrent[r].clientX;t+=i._touchCurrent[r].clientY}i.setCenter(e/a,t/a);i._currentCursorPosition.setY(.5*i.getCursorNDC(Nm.x,Nm.y,i.domElement).y);var n=i._currentCursorPosition.y-i._startCursorPosition.y,o=1;if(0>n){o=1/Math.pow(i.scaleFactor,-n*8)}else if(0<n){o=Math.pow(i.scaleFactor,n*8)}i._v3_1.setFromMatrixPosition(i._cameraMatrixState);var s=i._v3_1.distanceTo(i._gizmos.position),l=s/o;l=xo.clamp(l,i.minDistance,i.maxDistance);var d=s*Math.tan(.5*(xo.DEG2RAD*i._fovState)),c=xo.RAD2DEG*(2*Math.atan(d/l));c=xo.clamp(c,i.minFov,i.maxFov);var u=d/Math.tan(xo.DEG2RAD*(c/2));o=s/u;i._v3_2.setFromMatrixPosition(i._gizmoMatrixState);i.setFov(c);i.applyTransformMatrix(i.scale(o,i._v3_2,!1));Gm.copy(i._gizmos.position).sub(i.camera.position).normalize().multiplyScalar(u/s);i._m4_1.makeTranslation(Gm.x,Gm.y,Gm.z);i.dispatchEvent(Fm)}});_defineProperty2(_assertThisInitialized(i),"onTriplePanEnd",function(){i.updateTbState(Im.IDLE,!1);i.dispatchEvent(Bm)});_defineProperty2(_assertThisInitialized(i),"setCenter",function(e,t){Nm.x=e;Nm.y=t});_defineProperty2(_assertThisInitialized(i),"initializeMouseActions",function(){i.setMouseAction("PAN",0,"CTRL");i.setMouseAction("PAN",2);i.setMouseAction("ROTATE",0);i.setMouseAction("ZOOM","WHEEL");i.setMouseAction("ZOOM",1);i.setMouseAction("FOV","WHEEL","SHIFT");i.setMouseAction("FOV",1,"SHIFT")});_defineProperty2(_assertThisInitialized(i),"compareMouseAction",function(e,t){if(e.operation==t.operation){if(e.mouse==t.mouse&&e.key==t.key){return!0}else{return!1}}else{return!1}});_defineProperty2(_assertThisInitialized(i),"setMouseAction",function(e,t){var a=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null,r;if(!["PAN","ROTATE","ZOOM","FOV"].includes(e)||![0,1,2,"WHEEL"].includes(t)||!["CTRL","SHIFT",null].includes(a)){return!1}if("WHEEL"==t){if("ZOOM"!=e&&"FOV"!=e){return!1}}switch(e){case"PAN":r=Im.PAN;break;case"ROTATE":r=Im.ROTATE;break;case"ZOOM":r=Im.SCALE;break;case"FOV":r=Im.FOV;break;}for(var n={operation:e,mouse:t,key:a,state:r},o=0;o<i.mouseActions.length;o++){if(i.mouseActions[o].mouse==n.mouse&&i.mouseActions[o].key==n.key){i.mouseActions.splice(o,1,n);return!0}}i.mouseActions.push(n);return!0});_defineProperty2(_assertThisInitialized(i),"unsetMouseAction",function(e){for(var t=1<arguments.length&&arguments[1]!==void 0?arguments[1]:null,a=0;a<i.mouseActions.length;a++){if(i.mouseActions[a].mouse==e&&i.mouseActions[a].key==t){i.mouseActions.splice(a,1);return!0}}return!1});_defineProperty2(_assertThisInitialized(i),"getOpFromAction",function(e,t){for(var a,r=0;r<i.mouseActions.length;r++){a=i.mouseActions[r];if(a.mouse==e&&a.key==t){return a.operation}}if(null!=t){for(var n=0;n<i.mouseActions.length;n++){a=i.mouseActions[n];if(a.mouse==e&&null==a.key){return a.operation}}}return null});_defineProperty2(_assertThisInitialized(i),"getOpStateFromAction",function(e,t){for(var a,r=0;r<i.mouseActions.length;r++){a=i.mouseActions[r];if(a.mouse==e&&a.key==t){return a.state}}if(null!=t){for(var n=0;n<i.mouseActions.length;n++){a=i.mouseActions[n];if(a.mouse==e&&null==a.key){return a.state}}}return null});_defineProperty2(_assertThisInitialized(i),"getAngle",function(e,t){return 180*Math.atan2(t.clientY-e.clientY,t.clientX-e.clientX)/Math.PI});_defineProperty2(_assertThisInitialized(i),"updateTouchEvent",function(e){for(var t=0;t<i._touchCurrent.length;t++){if(i._touchCurrent[t].pointerId==e.pointerId){i._touchCurrent.splice(t,1,e);break}}});_defineProperty2(_assertThisInitialized(i),"calculateAngularSpeed",function(e,a,r,i){var n=(i-r)/1e3;if(0==n){return 0}return(a-e)/n});_defineProperty2(_assertThisInitialized(i),"calculatePointersDistance",function(e,t){return Math.sqrt(Math.pow(t.clientX-e.clientX,2)+Math.pow(t.clientY-e.clientY,2))});_defineProperty2(_assertThisInitialized(i),"calculateRotationAxis",function(e,t){i._rotationMatrix.extractRotation(i._cameraMatrixState);i._quat.setFromRotationMatrix(i._rotationMatrix);i._rotationAxis.crossVectors(e,t).applyQuaternion(i._quat);return i._rotationAxis.normalize().clone()});_defineProperty2(_assertThisInitialized(i),"calculateTbRadius",function(e){var t=e.position.distanceTo(i._gizmos.position);if("PerspectiveCamera"==e.type){var a=.5*(xo.DEG2RAD*e.fov),r=Math.atan(e.aspect*Math.tan(a));return Math.tan(Math.min(a,r))*t*i.radiusFactor}else if("OrthographicCamera"==e.type){return Math.min(e.top,e.right)*i.radiusFactor}});_defineProperty2(_assertThisInitialized(i),"focus",function(e,t){var a=2<arguments.length&&arguments[2]!==void 0?arguments[2]:1;Gm.copy(e).sub(i._gizmos.position).multiplyScalar(a);i._translationMatrix.makeTranslation(Gm.x,Gm.y,Gm.z);var r=i._gizmoMatrixState.clone();i._gizmoMatrixState.premultiply(i._translationMatrix);i._gizmoMatrixState.decompose(i._gizmos.position,i._gizmos.quaternion,i._gizmos.scale);var n=i._cameraMatrixState.clone();i._cameraMatrixState.premultiply(i._translationMatrix);i._cameraMatrixState.decompose(i.camera.position,i.camera.quaternion,i.camera.scale);if(i.enableZoom){i.applyTransformMatrix(i.scale(t,i._gizmos.position))}i._gizmoMatrixState.copy(r);i._cameraMatrixState.copy(n)});_defineProperty2(_assertThisInitialized(i),"drawGrid",function(){if(null!=i.scene){var e=3,t,a,r,n;if(i.camera.isOrthographicCamera){var o=i.camera.right-i.camera.left,s=i.camera.bottom-i.camera.top;r=Math.max(o,s);n=r/20;t=r/i.camera.zoom*e;a=t/n*i.camera.zoom}else if(i.camera.isPerspectiveCamera){var l=i.camera.position.distanceTo(i._gizmos.position),d=.5*(xo.DEG2RAD*i.camera.fov),c=Math.atan(i.camera.aspect*Math.tan(d));r=2*(Math.tan(Math.max(d,c))*l);n=r/20;t=r*e;a=t/n}if(null==i._grid){i._grid=new Hp(t,a,8947848,8947848);i._grid.position.copy(i._gizmos.position);i._gridPosition.copy(i._grid.position);i._grid.quaternion.copy(i.camera.quaternion);i._grid.rotateX(.5*Math.PI);i.scene.add(i._grid)}}});_defineProperty2(_assertThisInitialized(i),"dispose",function(){if(-1!=i._animationId){window.cancelAnimationFrame(i._animationId)}i.domElement.removeEventListener("pointerdown",i.onPointerDown);i.domElement.removeEventListener("pointercancel",i.onPointerCancel);i.domElement.removeEventListener("wheel",i.onWheel);i.domElement.removeEventListener("contextmenu",i.onContextMenu);window.removeEventListener("pointermove",i.onPointerMove);window.removeEventListener("pointerup",i.onPointerUp);window.removeEventListener("resize",i.onWindowResize);window.removeEventListener("keydown",i.onKeyDown);if(null!==i.scene)i.scene.remove(i._gizmos);i.disposeGrid()});_defineProperty2(_assertThisInitialized(i),"disposeGrid",function(){if(null!=i._grid&&null!=i.scene){i.scene.remove(i._grid);i._grid=null}});_defineProperty2(_assertThisInitialized(i),"easeOutCubic",function(e){return 1-Math.pow(1-e,3)});_defineProperty2(_assertThisInitialized(i),"activateGizmos",function(e){var t=i._gizmos.children[0],a=i._gizmos.children[1],r=i._gizmos.children[2];if(e){t.material.setValues({opacity:1});a.material.setValues({opacity:1});r.material.setValues({opacity:1})}else{t.material.setValues({opacity:.6});a.material.setValues({opacity:.6});r.material.setValues({opacity:.6})}});_defineProperty2(_assertThisInitialized(i),"getCursorNDC",function(e,t,a){var r=a.getBoundingClientRect();i._v2_1.setX(2*((e-r.left)/r.width)-1);i._v2_1.setY(2*((r.bottom-t)/r.height)-1);return i._v2_1.clone()});_defineProperty2(_assertThisInitialized(i),"getCursorPosition",function(e,t,a){i._v2_1.copy(i.getCursorNDC(e,t,a));i._v2_1.x*=.5*(i.camera.right-i.camera.left);i._v2_1.y*=.5*(i.camera.top-i.camera.bottom);return i._v2_1.clone()});_defineProperty2(_assertThisInitialized(i),"setCamera",function(e){e.lookAt(i.target);e.updateMatrix();if("PerspectiveCamera"==e.type){i._fov0=e.fov;i._fovState=e.fov}i._cameraMatrixState0.copy(e.matrix);i._cameraMatrixState.copy(i._cameraMatrixState0);i._cameraProjectionState.copy(e.projectionMatrix);i._zoom0=e.zoom;i._zoomState=i._zoom0;i._initialNear=e.near;i._nearPos0=e.position.distanceTo(i.target)-e.near;i._nearPos=i._initialNear;i._initialFar=e.far;i._farPos0=e.position.distanceTo(i.target)-e.far;i._farPos=i._initialFar;i._up0.copy(e.up);i._upState.copy(e.up);i.camera=e;i.camera.updateProjectionMatrix();i._tbRadius=i.calculateTbRadius(e);i.makeGizmos(i.target,i._tbRadius)});_defineProperty2(_assertThisInitialized(i),"makeGizmos",function(e,t){var a=new Wc(0,0,t,t),r=a.getPoints(i._curvePts),n=new pl().setFromPoints(r),o=new vc({color:16744576,fog:!1,transparent:!0,opacity:.6}),s=new vc({color:8454016,fog:!1,transparent:!0,opacity:.6}),l=new vc({color:8421631,fog:!1,transparent:!0,opacity:.6}),d=new Mc(n,o),c=new Mc(n,s),u=new Mc(n,l),p=.5*Math.PI;d.rotation.x=p;c.rotation.y=p;i._gizmoMatrixState0.identity().setPosition(e);i._gizmoMatrixState.copy(i._gizmoMatrixState0);if(1!=i.camera.zoom){var m=1/i.camera.zoom;i._scaleMatrix.makeScale(m,m,m);i._translationMatrix.makeTranslation(-e.x,-e.y,-e.z);i._gizmoMatrixState.premultiply(i._translationMatrix).premultiply(i._scaleMatrix);i._translationMatrix.makeTranslation(e.x,e.y,e.z);i._gizmoMatrixState.premultiply(i._translationMatrix)}i._gizmoMatrixState.decompose(i._gizmos.position,i._gizmos.quaternion,i._gizmos.scale);i._gizmos.clear();i._gizmos.add(d);i._gizmos.add(c);i._gizmos.add(u)});_defineProperty2(_assertThisInitialized(i),"onFocusAnim",function(e,a,r,n){if(-1==i._timeStart){i._timeStart=e}if(i._state==Im.ANIMATION_FOCUS){var o=e-i._timeStart,s=o/i.focusAnimationTime;i._gizmoMatrixState.copy(n);if(1<=s){i._gizmoMatrixState.decompose(i._gizmos.position,i._gizmos.quaternion,i._gizmos.scale);i.focus(a,i.scaleFactor);i._timeStart=-1;i.updateTbState(Im.IDLE,!1);i.activateGizmos(!1);i.dispatchEvent(Fm)}else{var l=i.easeOutCubic(s),d=1-l+i.scaleFactor*l;i._gizmoMatrixState.decompose(i._gizmos.position,i._gizmos.quaternion,i._gizmos.scale);i.focus(a,d,l);i.dispatchEvent(Fm);var c=_assertThisInitialized(i);i._animationId=window.requestAnimationFrame(function(e){c.onFocusAnim(e,a,r,n.clone())})}}else{i._animationId=-1;i._timeStart=-1}});_defineProperty2(_assertThisInitialized(i),"onRotationAnim",function(e,a,r){if(-1==i._timeStart){i._anglePrev=0;i._angleCurrent=0;i._timeStart=e}if(i._state==Im.ANIMATION_ROTATE){var t=(e-i._timeStart)/1e3,n=r+-i.dampingFactor*t;if(0<n){i._angleCurrent=.5*-i.dampingFactor*Math.pow(t,2)+r*t+0;i.applyTransformMatrix(i.rotate(a,i._angleCurrent));i.dispatchEvent(Fm);var o=_assertThisInitialized(i);i._animationId=window.requestAnimationFrame(function(e){o.onRotationAnim(e,a,r)})}else{i._animationId=-1;i._timeStart=-1;i.updateTbState(Im.IDLE,!1);i.activateGizmos(!1);i.dispatchEvent(Fm)}}else{i._animationId=-1;i._timeStart=-1;if(i._state!=Im.ROTATE){i.activateGizmos(!1);i.dispatchEvent(Fm)}}});_defineProperty2(_assertThisInitialized(i),"pan",function(e,t){var a=2<arguments.length&&arguments[2]!==void 0?arguments[2]:!1,r=e.clone().sub(t);if(i.camera.isOrthographicCamera){r.multiplyScalar(1/i.camera.zoom)}else if(i.camera.isPerspectiveCamera&&a){i._v3_1.setFromMatrixPosition(i._cameraMatrixState0);i._v3_2.setFromMatrixPosition(i._gizmoMatrixState0);var n=i._v3_1.distanceTo(i._v3_2)/i.camera.position.distanceTo(i._gizmos.position);r.multiplyScalar(1/n)}i._v3_1.set(r.x,r.y,0).applyQuaternion(i.camera.quaternion);i._m4_1.makeTranslation(i._v3_1.x,i._v3_1.y,i._v3_1.z);i.setTransformationMatrices(i._m4_1,i._m4_1);return Om});_defineProperty2(_assertThisInitialized(i),"reset",function(){i.camera.zoom=i._zoom0;if(i.camera.isPerspectiveCamera){i.camera.fov=i._fov0}i.camera.near=i._nearPos;i.camera.far=i._farPos;i._cameraMatrixState.copy(i._cameraMatrixState0);i._cameraMatrixState.decompose(i.camera.position,i.camera.quaternion,i.camera.scale);i.camera.up.copy(i._up0);i.camera.updateMatrix();i.camera.updateProjectionMatrix();i._gizmoMatrixState.copy(i._gizmoMatrixState0);i._gizmoMatrixState0.decompose(i._gizmos.position,i._gizmos.quaternion,i._gizmos.scale);i._gizmos.updateMatrix();i._tbRadius=i.calculateTbRadius(i.camera);i.makeGizmos(i._gizmos.position,i._tbRadius);i.camera.lookAt(i._gizmos.position);i.updateTbState(Im.IDLE,!1);i.dispatchEvent(Fm)});_defineProperty2(_assertThisInitialized(i),"rotate",function(e,t){var a=i._gizmos.position;i._translationMatrix.makeTranslation(-a.x,-a.y,-a.z);i._rotationMatrix.makeRotationAxis(e,-t);i._m4_1.makeTranslation(a.x,a.y,a.z);i._m4_1.multiply(i._rotationMatrix);i._m4_1.multiply(i._translationMatrix);i.setTransformationMatrices(i._m4_1);return Om});_defineProperty2(_assertThisInitialized(i),"copyState",function(){var e;if(i.camera.isOrthographicCamera){e=JSON.stringify({arcballState:{cameraFar:i.camera.far,cameraMatrix:i.camera.matrix,cameraNear:i.camera.near,cameraUp:i.camera.up,cameraZoom:i.camera.zoom,gizmoMatrix:i._gizmos.matrix}})}else if(i.camera.isPerspectiveCamera){e=JSON.stringify({arcballState:{cameraFar:i.camera.far,cameraFov:i.camera.fov,cameraMatrix:i.camera.matrix,cameraNear:i.camera.near,cameraUp:i.camera.up,cameraZoom:i.camera.zoom,gizmoMatrix:i._gizmos.matrix}})}navigator.clipboard.writeText(e)});_defineProperty2(_assertThisInitialized(i),"pasteState",function(){var e=_assertThisInitialized(i);navigator.clipboard.readText().then(function(t){e.setStateFromJSON(t)})});_defineProperty2(_assertThisInitialized(i),"saveState",function(){i._cameraMatrixState0.copy(i.camera.matrix);i._gizmoMatrixState0.copy(i._gizmos.matrix);i._nearPos=i.camera.near;i._farPos=i.camera.far;i._zoom0=i.camera.zoom;i._up0.copy(i.camera.up);if(i.camera.isPerspectiveCamera){i._fov0=i.camera.fov}});_defineProperty2(_assertThisInitialized(i),"scale",function(e,t){var a=2<arguments.length&&arguments[2]!==void 0?arguments[2]:!0,r=t.clone(),n=1/e;if(i.camera.isOrthographicCamera){i.camera.zoom=i._zoomState;i.camera.zoom*=e;if(i.camera.zoom>i.maxZoom){i.camera.zoom=i.maxZoom;n=i._zoomState/i.maxZoom}else if(i.camera.zoom<i.minZoom){i.camera.zoom=i.minZoom;n=i._zoomState/i.minZoom}i.camera.updateProjectionMatrix();i._v3_1.setFromMatrixPosition(i._gizmoMatrixState);i._scaleMatrix.makeScale(n,n,n);i._translationMatrix.makeTranslation(-i._v3_1.x,-i._v3_1.y,-i._v3_1.z);i._m4_2.makeTranslation(i._v3_1.x,i._v3_1.y,i._v3_1.z).multiply(i._scaleMatrix);i._m4_2.multiply(i._translationMatrix);r.sub(i._v3_1);var d=r.clone().multiplyScalar(n);r.sub(d);i._m4_1.makeTranslation(r.x,r.y,r.z);i._m4_2.premultiply(i._m4_1);i.setTransformationMatrices(i._m4_1,i._m4_2);return Om}else if(i.camera.isPerspectiveCamera){i._v3_1.setFromMatrixPosition(i._cameraMatrixState);i._v3_2.setFromMatrixPosition(i._gizmoMatrixState);var o=i._v3_1.distanceTo(r),s=o-o*n,l=o-s;if(l<i.minDistance){n=i.minDistance/o;s=o-o*n}else if(l>i.maxDistance){n=i.maxDistance/o;s=o-o*n}Gm.copy(r).sub(i._v3_1).normalize().multiplyScalar(s);i._m4_1.makeTranslation(Gm.x,Gm.y,Gm.z);if(a){var c=i._v3_2;o=c.distanceTo(r);s=o-o*n;Gm.copy(r).sub(i._v3_2).normalize().multiplyScalar(s);i._translationMatrix.makeTranslation(c.x,c.y,c.z);i._scaleMatrix.makeScale(n,n,n);i._m4_2.makeTranslation(Gm.x,Gm.y,Gm.z).multiply(i._translationMatrix);i._m4_2.multiply(i._scaleMatrix);i._translationMatrix.makeTranslation(-c.x,-c.y,-c.z);i._m4_2.multiply(i._translationMatrix);i.setTransformationMatrices(i._m4_1,i._m4_2)}else{i.setTransformationMatrices(i._m4_1)}return Om}});_defineProperty2(_assertThisInitialized(i),"setFov",function(e){if(i.camera.isPerspectiveCamera){i.camera.fov=xo.clamp(e,i.minFov,i.maxFov);i.camera.updateProjectionMatrix()}});_defineProperty2(_assertThisInitialized(i),"setTarget",function(e,t,a){i.target.set(e,t,a);i._gizmos.position.set(e,t,a);i._tbRadius=i.calculateTbRadius(i.camera);i.makeGizmos(i.target,i._tbRadius);i.camera.lookAt(i.target)});_defineProperty2(_assertThisInitialized(i),"zRotate",function(e,t){i._rotationMatrix.makeRotationAxis(i._rotationAxis,t);i._translationMatrix.makeTranslation(-e.x,-e.y,-e.z);i._m4_1.makeTranslation(e.x,e.y,e.z);i._m4_1.multiply(i._rotationMatrix);i._m4_1.multiply(i._translationMatrix);i._v3_1.setFromMatrixPosition(i._gizmoMatrixState).sub(e);i._v3_2.copy(i._v3_1).applyAxisAngle(i._rotationAxis,t);i._v3_2.sub(i._v3_1);i._m4_2.makeTranslation(i._v3_2.x,i._v3_2.y,i._v3_2.z);i.setTransformationMatrices(i._m4_1,i._m4_2);return Om});_defineProperty2(_assertThisInitialized(i),"unprojectOnObj",function(e,t){var a=i.getRaycaster();a.near=t.near;a.far=t.far;a.setFromCamera(e,t);for(var r=a.intersectObjects(i.scene.children,!0),n=0;n<r.length;n++){if(r[n].object.uuid!=i._gizmos.uuid&&null!=r[n].face){return r[n].point.clone()}}return null});_defineProperty2(_assertThisInitialized(i),"unprojectOnTbSurface",function(e,t,r,n,o){if("OrthographicCamera"==e.type){i._v2_1.copy(i.getCursorPosition(t,r,n));i._v3_1.set(i._v2_1.x,i._v2_1.y,0);var s=Math.pow(i._v2_1.x,2),d=Math.pow(i._v2_1.y,2),u=Math.pow(i._tbRadius,2);if(s+d<=.5*u){i._v3_1.setZ(Math.sqrt(u-(s+d)))}else{i._v3_1.setZ(.5*u/Math.sqrt(s+d))}return i._v3_1}else if("PerspectiveCamera"==e.type){i._v2_1.copy(i.getCursorNDC(t,r,n));i._v3_1.set(i._v2_1.x,i._v2_1.y,-1);i._v3_1.applyMatrix4(e.projectionMatrixInverse);var p=i._v3_1.clone().normalize(),g=e.position.distanceTo(i._gizmos.position),f=Math.pow(o,2),v=i._v3_1.z,h=Math.sqrt(Math.pow(i._v3_1.x,2)+Math.pow(i._v3_1.y,2));if(0==h){p.set(i._v3_1.x,i._v3_1.y,o);return p}var l=v/h,m=g,y=Math.pow(l,2)+1,_=2*l*m,x=Math.pow(m,2)-f,S=Math.pow(_,2)-4*y*x;if(0<=S){i._v2_1.setX((-_-Math.sqrt(S))/(2*y));i._v2_1.setY(l*i._v2_1.x+m);var M=xo.RAD2DEG*i._v2_1.angle();if(45<=M){var T=Math.sqrt(Math.pow(i._v2_1.x,2)+Math.pow(g-i._v2_1.y,2));p.multiplyScalar(T);p.z+=g;return p}}y=l;_=m;x=.5*-f;S=Math.pow(_,2)-4*y*x;i._v2_1.setX((-_-Math.sqrt(S))/(2*y));i._v2_1.setY(l*i._v2_1.x+m);var E=Math.sqrt(Math.pow(i._v2_1.x,2)+Math.pow(g-i._v2_1.y,2));p.multiplyScalar(E);p.z+=g;return p}});_defineProperty2(_assertThisInitialized(i),"unprojectOnTbPlane",function(e,t,a,r){var n=4<arguments.length&&arguments[4]!==void 0?arguments[4]:!1;if("OrthographicCamera"==e.type){i._v2_1.copy(i.getCursorPosition(t,a,r));i._v3_1.set(i._v2_1.x,i._v2_1.y,0);return i._v3_1.clone()}else if("PerspectiveCamera"==e.type){i._v2_1.copy(i.getCursorNDC(t,a,r));i._v3_1.set(i._v2_1.x,i._v2_1.y,-1);i._v3_1.applyMatrix4(e.projectionMatrixInverse);var o=i._v3_1.clone().normalize(),s=i._v3_1.z,d=Math.sqrt(Math.pow(i._v3_1.x,2)+Math.pow(i._v3_1.y,2)),l;if(n){l=i._v3_1.setFromMatrixPosition(i._cameraMatrixState0).distanceTo(i._v3_2.setFromMatrixPosition(i._gizmoMatrixState0))}else{l=e.position.distanceTo(i._gizmos.position)}if(0==d){o.set(0,0,0);return o}var c=l,u=Math.sqrt(Math.pow(c,2)+Math.pow(-c/(s/d),2));o.multiplyScalar(u);o.z=0;return o}});_defineProperty2(_assertThisInitialized(i),"updateMatrixState",function(){i._cameraMatrixState.copy(i.camera.matrix);i._gizmoMatrixState.copy(i._gizmos.matrix);if(i.camera.isOrthographicCamera){i._cameraProjectionState.copy(i.camera.projectionMatrix);i.camera.updateProjectionMatrix();i._zoomState=i.camera.zoom}else if(i.camera.isPerspectiveCamera){i._fovState=i.camera.fov}});_defineProperty2(_assertThisInitialized(i),"updateTbState",function(e,t){i._state=e;if(t){i.updateMatrixState()}});_defineProperty2(_assertThisInitialized(i),"update",function(){var e=1e-6;if(i.camera.isOrthographicCamera){if(i.camera.zoom>i.maxZoom||i.camera.zoom<i.minZoom){var s=xo.clamp(i.camera.zoom,i.minZoom,i.maxZoom);i.applyTransformMatrix(i.scale(s/i.camera.zoom,i._gizmos.position,!0))}}else if(i.camera.isPerspectiveCamera){var l=i.camera.position.distanceTo(i._gizmos.position);if(l>i.maxDistance+e||l<i.minDistance-e){var d=xo.clamp(l,i.minDistance,i.maxDistance);i.applyTransformMatrix(i.scale(d/l,i._gizmos.position));i.updateMatrixState()}if(i.camera.fov<i.minFov||i.camera.fov>i.maxFov){i.camera.fov=xo.clamp(i.camera.fov,i.minFov,i.maxFov);i.camera.updateProjectionMatrix()}var c=i._tbRadius;i._tbRadius=i.calculateTbRadius(i.camera);if(c<i._tbRadius-e||c>i._tbRadius+e){var t=(i._gizmos.scale.x+i._gizmos.scale.y+i._gizmos.scale.z)/3,a=i._tbRadius/t,r=new Wc(0,0,a,a),n=r.getPoints(i._curvePts),o=new pl().setFromPoints(n);for(var u in i._gizmos.children){i._gizmos.children[u].geometry=o}}}i.camera.lookAt(i._gizmos.position)});_defineProperty2(_assertThisInitialized(i),"setStateFromJSON",function(e){var t=JSON.parse(e);if(t.arcballState!=void 0){i._cameraMatrixState.fromArray(t.arcballState.cameraMatrix.elements);i._cameraMatrixState.decompose(i.camera.position,i.camera.quaternion,i.camera.scale);i.camera.up.copy(t.arcballState.cameraUp);i.camera.near=t.arcballState.cameraNear;i.camera.far=t.arcballState.cameraFar;i.camera.zoom=t.arcballState.cameraZoom;if(i.camera.isPerspectiveCamera){i.camera.fov=t.arcballState.cameraFov}i._gizmoMatrixState.fromArray(t.arcballState.gizmoMatrix.elements);i._gizmoMatrixState.decompose(i._gizmos.position,i._gizmos.quaternion,i._gizmos.scale);i.camera.updateMatrix();i.camera.updateProjectionMatrix();i._gizmos.updateMatrix();i._tbRadius=i.calculateTbRadius(i.camera);var a=new ls().copy(i._gizmoMatrixState0);i.makeGizmos(i._gizmos.position,i._tbRadius);i._gizmoMatrixState0.copy(a);i.camera.lookAt(i._gizmos.position);i.updateTbState(Im.IDLE,!1);i.dispatchEvent(Fm)}});i.camera=null;i.domElement=r;i.scene=n;i.target=new Po(0,0,0);i.radiusFactor=.67;i.mouseActions=[];i._mouseOp=null;i._v2_1=new bo;i._v3_1=new Po;i._v3_2=new Po;i._m4_1=new ls;i._m4_2=new ls;i._quat=new Ro;i._translationMatrix=new ls;i._rotationMatrix=new ls;i._scaleMatrix=new ls;i._rotationAxis=new Po;i._cameraMatrixState=new ls;i._cameraProjectionState=new ls;i._fovState=1;i._upState=new Po;i._zoomState=1;i._nearPos=0;i._farPos=0;i._gizmoMatrixState=new ls;i._up0=new Po;i._zoom0=1;i._fov0=0;i._initialNear=0;i._nearPos0=0;i._initialFar=0;i._farPos0=0;i._cameraMatrixState0=new ls;i._gizmoMatrixState0=new ls;i._button=-1;i._touchStart=[];i._touchCurrent=[];i._input=zm.NONE;i._switchSensibility=32;i._startFingerDistance=0;i._currentFingerDistance=0;i._startFingerRotation=0;i._currentFingerRotation=0;i._devPxRatio=0;i._downValid=!0;i._nclicks=0;i._downEvents=[];i._downStart=0;i._clickStart=0;i._maxDownTime=250;i._maxInterval=300;i._posThreshold=24;i._movementThreshold=24;i._currentCursorPosition=new Po;i._startCursorPosition=new Po;i._grid=null;i._gridPosition=new Po;i._gizmos=new Pd;i._curvePts=128;i._timeStart=-1;i._animationId=-1;i.focusAnimationTime=500;i._timePrev=0;i._timeCurrent=0;i._anglePrev=0;i._angleCurrent=0;i._cursorPosPrev=new Po;i._cursorPosCurr=new Po;i._wPrev=0;i._wCurr=0;i.adjustNearFar=!1;i.scaleFactor=1.1;i.dampingFactor=25;i.wMax=20;i.enableAnimations=!0;i.enableGrid=!1;i.cursorZoom=!1;i.minFov=5;i.maxFov=90;i.enabled=!0;i.enablePan=!0;i.enableRotate=!0;i.enableZoom=!0;i.enableGizmos=!0;i.minDistance=0;i.maxDistance=1/0;i.minZoom=0;i.maxZoom=1/0;i._tbRadius=1;i._state=Im.IDLE;i.setCamera(e);if(null!=i.scene){i.scene.add(i._gizmos)}i.domElement.style.touchAction="none";i._devPxRatio=window.devicePixelRatio;i.initializeMouseActions();i.domElement.addEventListener("contextmenu",i.onContextMenu);i.domElement.addEventListener("wheel",i.onWheel);i.domElement.addEventListener("pointerdown",i.onPointerDown);i.domElement.addEventListener("pointercancel",i.onPointerCancel);window.addEventListener("keydown",i.onKeyDown);window.addEventListener("resize",i.onWindowResize);return i}_createClass2(t,[{key:"applyTransformMatrix",value:function applyTransformMatrix(e){if(null!=e.camera){this._m4_1.copy(this._cameraMatrixState).premultiply(e.camera);this._m4_1.decompose(this.camera.position,this.camera.quaternion,this.camera.scale);this.camera.updateMatrix();if(this._state==Im.ROTATE||this._state==Im.ZROTATE||this._state==Im.ANIMATION_ROTATE){this.camera.up.copy(this._upState).applyQuaternion(this.camera.quaternion)}}if(null!=e.gizmos){this._m4_1.copy(this._gizmoMatrixState).premultiply(e.gizmos);this._m4_1.decompose(this._gizmos.position,this._gizmos.quaternion,this._gizmos.scale);this._gizmos.updateMatrix()}if(this._state==Im.SCALE||this._state==Im.FOCUS||this._state==Im.ANIMATION_FOCUS){this._tbRadius=this.calculateTbRadius(this.camera);if(this.adjustNearFar){var t=this.camera.position.distanceTo(this._gizmos.position),a=new zo;a.setFromObject(this._gizmos);var d=new $o;a.getBoundingSphere(d);var r=Math.max(this._nearPos0,d.radius+d.center.length()),i=t-this._initialNear,n=Math.min(r,i);this.camera.near=t-n;var o=Math.min(this._farPos0,-d.radius+d.center.length()),s=t-this._initialFar,l=Math.min(o,s);this.camera.far=t-l;this.camera.updateProjectionMatrix()}else{var c=!1;if(this.camera.near!=this._initialNear){this.camera.near=this._initialNear;c=!0}if(this.camera.far!=this._initialFar){this.camera.far=this._initialFar;c=!0}if(c){this.camera.updateProjectionMatrix()}}}}},{key:"setGizmosVisible",value:function setGizmosVisible(e){this._gizmos.visible=e;this.dispatchEvent(Fm)}},{key:"setTbRadius",value:function setTbRadius(e){this.radiusFactor=e;this._tbRadius=this.calculateTbRadius(this.camera);var t=new Wc(0,0,this._tbRadius,this._tbRadius),a=t.getPoints(this._curvePts),r=new pl().setFromPoints(a);for(var i in this._gizmos.children){this._gizmos.children[i].geometry=r}this.dispatchEvent(Fm)}},{key:"setTransformationMatrices",value:function setTransformationMatrices(){var e=0<arguments.length&&arguments[0]!==void 0?arguments[0]:null,t=1<arguments.length&&arguments[1]!==void 0?arguments[1]:null;if(null!=e){if(null!=Om.camera){Om.camera.copy(e)}else{Om.camera=e.clone()}}else{Om.camera=null}if(null!=t){if(null!=Om.gizmos){Om.gizmos.copy(t)}else{Om.gizmos=t.clone()}}else{Om.gizmos=null}}},{key:"getRaycaster",value:function getRaycaster(){return Hm}}]);return t}(ho),Wm=function(e){_inherits(t,e);var a=_createSuper(t);function t(e,r){var i;_classCallCheck2(this,t);i=a.call(this);i.animating=!1;i.controls=null;var n=document.createElement("div");n.setAttribute("id","axisHelper");n.setAttribute("style","position: absolute; right: 0px; bottom: 0px; height: 128px; width: 128px");var o=_assertThisInitialized(i);n.addEventListener("pointerup",function(e){e.stopPropagation();o.handleClick(e)});n.addEventListener("pointerdown",function(e){e.stopPropagation()});n.addEventListener("pointermove",function(e){o.handleMove(e)});r.appendChild(n);var s=new Js("#ff3653"),l=new Js("#8adb00"),d=new Js("#2c8fff"),c=[],u=new Np,p=new bo,m=new Ds,g=new Jl(-2,2,2,-2,0,4);g.position.set(0,0,2);var f=new Rl(.8,.05,.05).translate(.4,0,0),h=function(e){return new Qs({color:e,toneMapped:!1})},v=new Ll(f,h(s)),y=new Ll(f,h(l)),_=new Ll(f,h(d));y.rotation.z=Math.PI/2;_.rotation.y=-Math.PI/2;i.add(v);i.add(_);i.add(y);var x=function(e){var t=1<arguments.length&&arguments[1]!==void 0?arguments[1]:null,a=document.createElement("canvas");a.width=64;a.height=64;var r=a.getContext("2d");r.beginPath();r.arc(32,32,16,0,2*Math.PI);r.closePath();r.fillStyle=e.getStyle();r.fill();if(null!==t){r.font="24px Arial";r.textAlign="center";r.fillStyle="#000000";r.fillText(t,32,41)}var i=new Nc(a);return new Gd({map:i,toneMapped:!1})},b=new ac(x(s,"X"));b.userData.type="posX";var S=new ac(x(l,"Y"));S.userData.type="posY";var M=new ac(x(d,"Z"));M.userData.type="posZ";var T=new ac(x(s));T.userData.type="negX";var E=new ac(x(l));E.userData.type="negY";var w=new ac(x(d));w.userData.type="negZ";b.position.x=1;S.position.y=1;M.position.z=1;T.position.x=-1;T.scale.setScalar(.8);E.position.y=-1;E.scale.setScalar(.8);w.position.z=-1;w.scale.setScalar(.8);i.add(b);i.add(S);i.add(M);i.add(T);i.add(E);i.add(w);c.push(b);c.push(S);c.push(M);c.push(T);c.push(E);c.push(w);var A=new Po,k=128,C=2*Math.PI;i.render=function(t){i.quaternion.copy(e.quaternion).invert();i.updateMatrixWorld();A.set(0,0,1);A.applyQuaternion(e.quaternion);if(0<=A.x){b.material.opacity=1;T.material.opacity=.5}else{b.material.opacity=.5;T.material.opacity=1}if(0<=A.y){S.material.opacity=1;E.material.opacity=.5}else{S.material.opacity=.5;E.material.opacity=1}if(0<=A.z){M.material.opacity=1;w.material.opacity=.5}else{M.material.opacity=.5;w.material.opacity=1}var a=r.offsetWidth-k;t.clearDepth();t.setViewport(a,0,k,k);t.render(_assertThisInitialized(i),g)};var L=new Po,R=new Ro,P=new Po(0,1,0),D=new Ro,I=new Ro,z=0,N=new Po,O=function(t,a){switch(t.userData.type){case"posX":L.set(1,0,0);R.setFromEuler(new ys(0,.5*Math.PI,0));break;case"posY":L.set(0,1,0);R.setFromEuler(new ys(.5*-Math.PI,0,0));break;case"posZ":L.set(0,0,1);R.setFromEuler(new ys);break;case"negX":L.set(-1,0,0);R.setFromEuler(new ys(0,.5*-Math.PI,0));break;case"negY":L.set(0,-1,0);R.setFromEuler(new ys(.5*Math.PI,0,0));break;case"negZ":L.set(0,0,-1);R.setFromEuler(new ys(0,Math.PI,0));break;default:console.error("ViewHelper: Invalid axis.");}z=e.position.distanceTo(a);L.multiplyScalar(z).add(a);m.position.copy(a);m.lookAt(e.position);D.copy(m.quaternion);m.lookAt(L);I.copy(m.quaternion);N.copy(P);N.sub(e.up)};i.handleClick=function(e){if(!0===i.animating){return!1}var t=r.getBoundingClientRect(),a=t.left+(r.offsetWidth-k),n=t.top+(r.offsetHeight-k);p.x=2*((e.clientX-a)/k)-1;p.y=2*-((e.clientY-n)/k)+1;u.setFromCamera(p,g);var o=u.intersectObjects(c);if(0<o.length){var s=o[0],l=s.object;O(l,i.controls.target);i.animating=!0;return!0}return!1};i.handleMove=function(e){var t=r.getBoundingClientRect(),a=t.left+(r.offsetWidth-k),i=t.top+(r.offsetHeight-k);p.x=2*((e.clientX-a)/k)-1;p.y=2*-((e.clientY-i)/k)+1;u.setFromCamera(p,g);var n=u.intersectObjects(c);if(0<n.length){r.style.cursor="pointer"}else{r.style.cursor=null}};i.update=function(t){var a=t*C,r=i.controls.target;D.rotateTowards(I,a);e.position.set(0,0,1).applyQuaternion(D).multiplyScalar(z).add(r);e.quaternion.rotateTowards(R,a);var n=e.up.distanceTo(P),o=Math.min(1,a/n);e.up.addScaledVector(N,o);N.multiplyScalar(1-o);if(0===D.angleTo(I)){i.animating=!1}};return i}return t}(Ds);Wm.prototype.isViewHelper=!0;var jm=function e(t,a,r,i){var n=this;_classCallCheck2(this,e);this.name=t;this.action=a;this.icon=r;this.iconSelected=i;this.dom=document.createElement("a");this.dom.setAttribute("data-action",this.name);this.dom.setAttribute("href","#");this.dom.innerHTML=this.icon;this.dom.setAttribute("title",this.name);this.state=!1;var o=this;this.dom.addEventListener("click",function(t){if(o.iconSelected!==void 0){if(!1===o.state){o.dom.innerHTML=o.iconSelected;o.state=!0}else{o.dom.innerHTML=o.icon;o.state=!1}}o.action(n.name,t);t.stopPropagation();t.preventDefault()},!1)},qm=25,Xm=function(){function e(t,a){_classCallCheck2(this,e);var r=this;this.container=t;var i={grid:!0,axis_helper:!0,controls:!0,camera_position:new Po(1,1,1),camera_zoom:1,camera_up:new Po(0,1,0),toolbar:!0,help:!0};if(null!==a){Object.assign(i,a)}this.scene=new Fd;var n=this.getOthographicPosition();this.camera=new Jl(n[0],n[1],n[2],n[3],-2e3,2e3);this.camera.position.copy(i.camera_position);this.camera.position.multiplyScalar(qm);this.camera.zoom=i.camera_zoom;this.camera.up.copy(i.camera_up);this.camera.updateProjectionMatrix();this.scene.add(this.camera);this.a_light=new op(4210752,.3);this.scene.add(this.a_light);this.d_light=new np(16777215,.6,{castShadow:!0});this.camera.add(this.d_light);this.renderer=new Dt({antialias:!0});this.renderer.setPixelRatio(window.devicePixelRatio);this.renderer.outputEncoding=eo;this.renderer.setSize(t.clientWidth,t.clientHeight);this.renderer.setClearColor(13421772);t.appendChild(this.renderer.domElement);this.labelRenderer=new Yp;this.labelRenderer.setSize(t.clientWidth,t.clientHeight);this.labelRenderer.domElement.style.position="absolute";this.labelRenderer.domElement.style.top="0px";t.appendChild(this.labelRenderer.domElement);window.addEventListener("resize",function(){r.resize()});this.controls=new Vm(this.camera,this.labelRenderer.domElement,this.scene);this.controls.enabled=i.controls;this.controls.setGizmosVisible(!1);this.grid=new Pd;var o=new Hp(30,30,8947848);o.material.color.setHex(8947848);o.material.vertexColors=!1;this.grid.add(o);var s=new Hp(30,6,2236962);s.material.color.setHex(2236962);s.material.depthFunc=Jr;s.material.vertexColors=!1;this.grid.add(s);this.grid.visible=i.grid;this.view_axes=new Wm(this.camera,t);this.view_axes.controls=this.controls;this.view_axes.visible=i.axis_helper;this.clock=new yp;this.animating=!1;if(!1!==i.toolbar&&null!==i.toolbar){this.buildToolbar(i)}this.message_dom=document.createElement("div");this.message_dom.setAttribute("id","message_wrapper");this.message_dom.className="invisible opacity-0";this.message_inner=document.createElement("div");this.message_dom.appendChild(this.message_inner);this.message_timeout=null;this.container.appendChild(this.message_dom);if(!1!==i.help&&null!==i.help){this.helpDom=document.createElement("div");this.helpDom.setAttribute("id","help");this.helpDom.innerText="Scroll to zoom / Drag to rotate / Drag & left-click to pan";this.container.appendChild(this.helpDom)}this.animating=!0;this.renderer.setAnimationLoop(function animate(){var e=r.animating,t=r.clock.getDelta();if(!0===r.view_axes.animating){r.view_axes.update(t);e=!0}if(e){r.controls.update();r.render();r.animating=!1}});this.controls.addEventListener("change",function(){r.render()})}_createClass2(e,[{key:"getOthographicPosition",value:function getOthographicPosition(){var e=this.container.clientWidth/this.container.clientHeight,t=.5*(45*xo.DEG2RAD),a=Math.atan(e*Math.tan(t)),r=qm*Math.tan(a),i=qm*Math.tan(t);return[-r,r,i,-i]}},{key:"resize",value:function resize(){var e=this.getOthographicPosition();this.camera.left=e[0];this.camera.right=e[1];this.camera.top=e[2];this.camera.bottom=e[3];this.camera.updateProjectionMatrix();this.renderer.setSize(this.container.clientWidth,this.container.clientHeight);this.labelRenderer.setSize(this.container.clientWidth,this.container.clientHeight);this.animating=!0}},{key:"buildToolbar",value:function buildToolbar(){this.toolbar=document.createElement("nav");this.toolbar.setAttribute("id","toolbar");this.container.appendChild(this.toolbar);this.buttons={};var e=this;this.handleEvents=function(t){switch(t){case"reset-view":e.controls.reset();e.showMessage("Reset view");break;}};var t=new jm("reset-view",this.handleEvents,Pm(Dm).html);this.toolbar.appendChild(t.dom);this.buttons.reset_btn=t}},{key:"showMessage",value:function showMessage(e){this.message_inner.innerText=e;this.message_dom.classList.remove("invisible");this.message_dom.classList.remove("opacity-0");var t=this.message_dom;clearTimeout(this.message_timeout);this.message_timeout=setTimeout(function(){t.classList.add("invisible");t.classList.add("opacity-0")},2e3)}},{key:"addContent",value:function addContent(e){this.scene.add(e);this.animating=!0}},{key:"render",value:function render(){this.scene.add(this.grid);this.renderer.setViewport(0,0,this.container.offsetWidth,this.container.offsetHeight);this.renderer.render(this.scene,this.camera);this.scene.remove(this.grid);this.labelRenderer.render(this.scene,this.camera);this.renderer.autoClear=!1;this.view_axes.render(this.renderer);this.renderer.autoClear=!0}}]);return e}(),Ym=document.createElement("template");Ym.innerHTML="\n  <style>\n    :host { \n        display: block;\n    }\n    #viewer { width: 100%; height: 100%; position: relative; }\n    #toolbar { \n        top: 10px;\n        left: 10px;\n        position: absolute;\n        text-align: center;\n        background-color: white;\n        opacity: 0.75;\n    }\n    #toolbar a {\n        display: block;\n        padding: 6px 8px 0px;\n        color: #495057;\n    }\n    #toolbar svg {\n        width: 1.1em;\n        height: 1.1em;\n    }\n    #message_wrapper {\n        position: absolute;\n        top: 0;\n        left: 50%;\n        padding: 1em;\n        transform: translateX(-50%);\n        transition: visibility 0.5s, opacity 0.5s;\n    }\n    #message_wrapper > div {\n        background-color: white;\n        opacity: 0.75;\n        padding: 0.25rem;\n    }\n    .invisible {\n        visibility: hidden;\n    }\n    .opacity-0 {\n        opacity: 0;\n    }\n    .label {\n        color: #FFF;\n        padding: 2px;\n        background: rgba( 0, 0, 0, .6 );\n    }\n    #help {\n        position: absolute;\n        bottom: 0;\n        left: 5px;\n        color: #495057;\n        font-size:0.8rem;\n    }\n  </style>\n  <div id=\"viewer\"></div>\n";var Zm=function(e){_inherits(t,e);var a=_createSuper(t);function t(){_classCallCheck2(this,t);return a.call(this,"updated",{bubbles:!0})}return t}(_wrapNativeSuper(Event)),Jm=function(e){_inherits(t,e);var a=_createSuper(t);function t(){var e;_classCallCheck2(this,t);e=a.call(this);e.geometry=null;e.model=null;e._viewerDOM=null;return e}_createClass2(t,[{key:"connectedCallback",value:function connectedCallback(){var e=this;this._viewerDOM=this.parentElement;if(this.model){this.parentElement.viewer.addContent(this.model)}else{new Jp(this,function(t,a){e.geometry=t;e.model=a;var r=new CustomEvent("loaded",{geometry:e.geometry});e.dispatchEvent(r);e._viewerDOM.viewer.addContent(a)})}}},{key:"disconnectedCallback",value:function disconnectedCallback(){if(this.model){this.model.removeFromParent();if(this._viewerDOM){this._viewerDOM.dispatchEvent(new Zm);this._viewerDOM=null}}}},{key:"loaded",get:function get(){return this.model instanceof Ds}},{key:"src",get:function get(){if(!this.hasAttribute("src")||!!!this.getAttribute("src")){var e=this.querySelector("a");if(e){this.setAttribute("src",e.getAttribute("href"))}}return this.getAttribute("src")}},{key:"scale",get:function get(){if(this.hasAttribute("scale")){var e=this.getAttribute("scale");if(""===e||"true"===e){return!0}else{return e}}else{return!1}}},{key:"center",get:function get(){return this.hasAttribute("center")}}]);return t}(_wrapNativeSuper(HTMLElement)),Qm=function(e){_inherits(t,e);var a=_createSuper(t);function t(){var e;_classCallCheck2(this,t);e=a.call(this);e._annotation=void 0;e._modelDOM=void 0;return e}_createClass2(t,[{key:"connectedCallback",value:function connectedCallback(){var e=this;this._modelDOM=this.parentElement;var t=this,a=function(){t._modelDOM.model.add(t.annotation);t.dispatchEvent(new Zm)};this._modelDOM.addEventListener("loaded",function(){e._annotation=void 0;a()});if(this._modelDOM.loaded){a()}}},{key:"disconnectedCallback",value:function disconnectedCallback(){if(this._annotation){this._annotation.removeFromParent();if(this._annotation instanceof Ds){this._annotation.geometry.dispose();this._annotation.material.dispose()}this._annotation=void 0;if(this._modelDOM){this._modelDOM.dispatchEvent(new Zm)}}}},{key:"positionInGeometry",value:function positionInGeometry(){var e=this._modelDOM.geometry,t=this.position.split(";"),a=[],r=_createForOfIteratorHelper(t),i;try{for(r.s();!(i=r.n()).done;){var n=i.value,o=n.split("="),s=_slicedToArray2(o,2),l=s[0],d=s[1];if("absolute"==l){var c=d.split(","),u=_slicedToArray2(c,3),p=u[0],m=u[1],g=u[2];a.push(new Po(p,m,g))}else if("vertex"==l){var f=parseInt(d),h=e.getAttribute("position").getX(f),v=e.getAttribute("position").getY(f),y=e.getAttribute("position").getZ(f);a.push(new Po(h,v,y))}}}catch(e){r.e(e)}finally{r.f()}if(1===a.length){return a[0]}return a}},{key:"attributeChangedCallback",value:function attributeChangedCallback(e){if(this._annotation===void 0){return}switch(e){case"color":if(this._annotation instanceof Vp){this._annotation.element.style.color=this.color}else{this._annotation.material.color.setStyle(this.color)}break;case"text":if(this._annotation instanceof Vp){this._annotation.element.textContent=this.text}break;}this.dispatchEvent(new Zm)}},{key:"annotation",get:function get(){if(this._annotation){return this._annotation}var e=new fu({color:this.color});if("sphere"===this.kind){var t=new mu(.5),a=new Ll(t,e),r=this.positionInGeometry();a.position.set(r.x,r.y,r.z);this._annotation=a}else if("label"===this.kind){var d=document.createElement("div");d.className="label";d.textContent=this.text;d.style.marginTop="-1em";d.style.color=this.color;var i=new Vp(d),n=this.positionInGeometry();i.position.set(n.x,n.y,n.z);this._annotation=i}else if("cylinder"===this.kind){var c=this.positionInGeometry();if(2!=c.length){console.error("Invalid length")}var o=new Oc(.2,.2,c[0].distanceTo(c[1]),20),s=new Ll(o,e),l=new Po;l.addVectors(c[0],c[1]);l.divideScalar(2);s.position.set(l.x,l.y,l.z);var u=new Po;u.subVectors(c[1],c[0]);u.normalize();var p=new Ro;p.setFromUnitVectors(new Po(0,1,0),u);s.applyQuaternion(p);this._annotation=s}return this._annotation}},{key:"kind",get:function get(){return this.getAttribute("kind")}},{key:"position",get:function get(){return this.getAttribute("position")}},{key:"color",get:function get(){return this.getAttribute("color")},set:function set(e){if(e){this.setAttribute("color",e)}else{this.removeAttribute("color")}}},{key:"text",get:function get(){return this.getAttribute("text")},set:function set(e){if(e){this.setAttribute("text",e)}else{this.removeAttribute("text")}}}],[{key:"observedAttributes",get:function get(){return["color","text"]}}]);return t}(_wrapNativeSuper(HTMLElement)),Km=function(e){_inherits(t,e);var a=_createSuper(t);function t(){var e;_classCallCheck2(this,t);e=a.call(this);var r=e.attachShadow({mode:"open"});r.appendChild(Ym.content.cloneNode(!0));e.viewer=null;var i=_assertThisInitialized(e);e.addEventListener("updated",function(){if(i.viewer)i.viewer.animating=!0});return e}_createClass2(t,[{key:"connectedCallback",value:function connectedCallback(){this.updateSize();var e={grid:this.grid,axis_helper:this.axis_helper,controls:this.controls,camera_position:new Po(1,1,1),camera_zoom:this.camera_zoom,camera_up:new Po(0,1,0),toolbar:this.toolbar,help:this.help};this.viewer=new Xm(this.shadowRoot.getElementById("viewer"),e)}},{key:"updateSize",value:function updateSize(){if(0<this.shadowRoot.styleSheets.length){var e=this.shadowRoot.styleSheets[0].cssRules[0];e.style.height=this.getAttribute("height");e.style.width=this.getAttribute("width");if(this.viewer)this.viewer.resize()}}},{key:"attributeChangedCallback",value:function attributeChangedCallback(e){switch(e){case"width":case"height":this.updateSize();break;}}},{key:"src",get:function get(){return this.getAttribute("src")}},{key:"camera_zoom",get:function get(){if(this.hasAttribute("camera-zoom")){return parseFloat(this.getAttribute("camera-zoom"))}else{return 1}}},{key:"grid",get:function get(){return this.hasAttribute("grid")}},{key:"axis_helper",get:function get(){return this.hasAttribute("axis-helper")}},{key:"controls",get:function get(){return this.hasAttribute("controls")}},{key:"toolbar",get:function get(){return this.hasAttribute("toolbar")}},{key:"help",get:function get(){return this.hasAttribute("help")}}],[{key:"observedAttributes",get:function get(){return["width","height"]}}]);return t}(_wrapNativeSuper(HTMLElement));customElements.define("threed-viewer",Km);customElements.define("threed-annotation",Qm);customElements.define("threed-model",Jm)});
//# sourceMappingURL=threed-viewer.min.js.map

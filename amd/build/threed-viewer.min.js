function _wrapNativeSuper(e){var t="function"==typeof Map?new Map:void 0;_wrapNativeSuper=function(e){if(null===e||!_isNativeFunction(e))return e;if("function"!=typeof e){throw new TypeError("Super expression must either be null or a function")}if("undefined"!=typeof t){if(t.has(e))return t.get(e);t.set(e,a)}function a(){return _construct(e,arguments,_getPrototypeOf(this).constructor)}a.prototype=Object.create(e.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}});return _setPrototypeOf(a,e)};return _wrapNativeSuper(e)}function _construct(){if(_isNativeReflectConstruct()){_construct=Reflect.construct}else{_construct=function(e,t,r){var i=[null];i.push.apply(i,t);var a=Function.bind.apply(e,i),n=new a;if(r)_setPrototypeOf(n,r.prototype);return n}}return _construct.apply(null,arguments)}function _isNativeFunction(e){return-1!==Function.toString.call(e).indexOf("[native code]")}function asyncGeneratorStep(e,t,a,r,i,n,o){try{var s=e[n](o),l=s.value}catch(e){a(e);return}if(s.done){t(l)}else{Promise.resolve(l).then(r,i)}}function _asyncToGenerator(e){return function(){var t=this,a=arguments;return new Promise(function(r,i){var s=e.apply(t,a);function n(e){asyncGeneratorStep(s,r,i,n,o,"next",e)}function o(e){asyncGeneratorStep(s,r,i,n,o,"throw",e)}n(void 0)})}}function _createForOfIteratorHelper(e){if("undefined"==typeof Symbol||null==e[Symbol.iterator]){if(Array.isArray(e)||(e=_unsupportedIterableToArray(e))){var t=0,a=function(){};return{s:a,n:function n(){if(t>=e.length)return{done:!0};return{done:!1,value:e[t++]}},e:function e(e){throw e},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var r,n=!0,s=!1,l;return{s:function s(){r=e[Symbol.iterator]()},n:function n(){var e=r.next();n=e.done;return e},e:function e(e){s=!0;l=e},f:function f(){try{if(!n&&null!=r.return)r.return()}finally{if(s)throw l}}}}function _slicedToArray2(e,t){return _arrayWithHoles2(e)||_iterableToArrayLimit2(e,t)||_unsupportedIterableToArray(e,t)||_nonIterableRest2()}function _nonIterableRest2(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function _unsupportedIterableToArray(e,t){if(!e)return;if("string"==typeof e)return _arrayLikeToArray(e,t);var a=Object.prototype.toString.call(e).slice(8,-1);if("Object"===a&&e.constructor)a=e.constructor.name;if("Map"===a||"Set"===a)return Array.from(a);if("Arguments"===a||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a))return _arrayLikeToArray(e,t)}function _arrayLikeToArray(e,t){if(null==t||t>e.length)t=e.length;for(var a=0,r=Array(t);a<t;a++){r[a]=e[a]}return r}function _iterableToArrayLimit2(e,t){if("undefined"==typeof Symbol||!(Symbol.iterator in Object(e)))return;var a=[],r=!0,i=!1,n=void 0;try{for(var o=e[Symbol.iterator](),s;!(r=(s=o.next()).done);r=!0){a.push(s.value);if(t&&a.length===t)break}}catch(e){i=!0;n=e}finally{try{if(!r&&null!=o["return"])o["return"]()}finally{if(i)throw n}}return a}function _arrayWithHoles2(e){if(Array.isArray(e))return e}function _get(e,t,a){if("undefined"!=typeof Reflect&&Reflect.get){_get=Reflect.get}else{_get=function(e,t,a){var r=_superPropBase(e,t);if(!r)return;var i=Object.getOwnPropertyDescriptor(r,t);if(i.get){return i.get.call(a)}return i.value}}return _get(e,t,a||e)}function _superPropBase(e,t){while(!Object.prototype.hasOwnProperty.call(e,t)){e=_getPrototypeOf(e);if(null===e)break}return e}function ownKeys(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);if(t)r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable});a.push.apply(a,r)}return a}function _objectSpread2(e){for(var t=1,a;t<arguments.length;t++){a=null!=arguments[t]?arguments[t]:{};if(t%2){ownKeys(Object(a),!0).forEach(function(t){_defineProperty2(e,t,a[t])})}else if(Object.getOwnPropertyDescriptors){Object.defineProperties(e,Object.getOwnPropertyDescriptors(a))}else{ownKeys(Object(a)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))})}}return e}function _defineProperty2(e,t,a){if(t in e){Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0})}else{e[t]=a}return e}function _inherits(e,t){if("function"!=typeof t&&null!==t){throw new TypeError("Super expression must either be null or a function")}e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}});if(t)_setPrototypeOf(e,t)}function _setPrototypeOf(e,t){_setPrototypeOf=Object.setPrototypeOf||function(e,t){e.__proto__=t;return e};return _setPrototypeOf(e,t)}function _createSuper(e){return function(){var t=_getPrototypeOf(e),a;if(_isNativeReflectConstruct()){var r=_getPrototypeOf(this).constructor;a=Reflect.construct(t,arguments,r)}else{a=t.apply(this,arguments)}return _possibleConstructorReturn(this,a)}}function _possibleConstructorReturn(e,t){if(t&&("object"===_typeof(t)||"function"==typeof t)){return t}return _assertThisInitialized(e)}function _assertThisInitialized(e){if(void 0===e){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return e}function _isNativeReflectConstruct(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{Date.prototype.toString.call(Reflect.construct(Date,[],function(){}));return!0}catch(t){return!1}}function _getPrototypeOf(e){_getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)};return _getPrototypeOf(e)}function _classCallCheck2(e,t){if(!(e instanceof t)){throw new TypeError("Cannot call a class as a function")}}function _defineProperties(e,t){for(var a=0,r;a<t.length;a++){r=t[a];r.enumerable=r.enumerable||!1;r.configurable=!0;if("value"in r)r.writable=!0;Object.defineProperty(e,r.key,r)}}function _createClass2(e,t,a){if(t)_defineProperties(e.prototype,t);if(a)_defineProperties(e,a);return e}function _typeof(e){"@babel/helpers - typeof";if("function"==typeof Symbol&&"symbol"==typeof Symbol.iterator){_typeof=function(e){return typeof e}}else{_typeof=function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e}}return _typeof(e)}(function(e,t){"object"===("undefined"==typeof exports?"undefined":_typeof(exports))&&"undefined"!=typeof module?t(exports):"function"==typeof define&&define.amd?define ("filter_threedviewer/threed-viewer",["exports"],t):(e="undefined"!=typeof globalThis?globalThis:e||self,t(e.threedViewer={}))})(this,function(e){'use strict';for(var xr,br="135",Sr={LEFT:0,MIDDLE:1,RIGHT:2,ROTATE:0,DOLLY:1,PAN:2},Mr={ROTATE:0,PAN:1,DOLLY_PAN:2,DOLLY_ROTATE:3},Tr=0,Er=1,wr=2,Ar=3,kr=0,Cr=1,Rr=2,Lr=3,Pr=0,Ir=1,Dr=2,zr=1,Nr=2,Fr=0,Or=1,Br=2,Ur=3,Gr=4,Hr=5,Vr=100,Wr=101,jr=102,qr=103,Xr=104,Yr=200,Zr=201,Jr=202,Qr=203,Kr=204,$r=205,ei=206,ti=207,ai=208,ri=209,ii=210,ni=0,oi=1,si=2,li=3,di=4,ci=5,ui=6,pi=7,mi=0,gi=1,fi=2,hi=0,yi=1,vi=2,_i=3,xi=4,bi=5,Si=300,Mi=301,Ti=302,Ei=303,wi=304,Ai=306,ki=307,Ci=1e3,Ri=1001,Li=1002,Pi=1003,Ii=1004,Di=1004,zi=1005,Ni=1005,Fi=1006,Oi=1007,Bi=1007,Ui=1008,Gi=1008,Hi=1009,Vi=1010,Wi=1011,ji=1012,qi=1013,Xi=1014,Yi=1015,Zi=1016,Ji=1017,Qi=1018,Ki=1019,$i=1020,en=1021,tn=1022,an=1023,rn=1024,nn=1025,on=an,sn=1026,ln=1027,dn=1028,cn=1029,un=1030,pn=1031,mn=1032,gn=1033,fn=33776,hn=33777,yn=33778,vn=33779,_n=35840,xn=35841,bn=35842,Sn=35843,Mn=36196,Tn=37492,En=37496,wn=37808,An=37809,kn=37810,Cn=37811,Rn=37812,Ln=37813,Pn=37814,In=37815,Dn=37816,zn=37817,Nn=37818,Fn=37819,On=37820,Bn=37821,Un=36492,Gn=37840,Hn=37841,Vn=37842,Wn=37843,jn=37844,qn=37845,Xn=37846,Yn=37847,Zn=37848,Jn=37849,Qn=37850,Kn=37851,$n=37852,eo=37853,to=2200,ao=2201,ro=2202,io=2300,no=2301,oo=2302,so=2400,lo=2401,co=2402,uo=2500,po=2501,mo=0,go=1,fo=2,ho=3e3,yo=3001,vo=3007,_o=3002,xo=3004,bo=3005,So=3006,Mo=3200,To=3201,Eo=0,wo=1,Ao=0,ko=7680,Co=7681,Ro=7682,Lo=7683,Po=34055,Io=34056,Do=5386,zo=512,No=513,Fo=514,Oo=515,Bo=516,Uo=517,Go=518,Ho=519,Vo=35044,Wo=35048,jo=35040,qo=35045,Xo=35049,Yo=35041,Zo=35046,Jo=35050,Qo=35042,Ko="100",$o="300 es",es=function(){function e(){_classCallCheck2(this,e)}_createClass2(e,[{key:"addEventListener",value:function addEventListener(e,t){if(this._listeners===void 0)this._listeners={};var a=this._listeners;if(a[e]===void 0){a[e]=[]}if(-1===a[e].indexOf(t)){a[e].push(t)}}},{key:"hasEventListener",value:function hasEventListener(e,t){if(this._listeners===void 0)return!1;var a=this._listeners;return a[e]!==void 0&&-1!==a[e].indexOf(t)}},{key:"removeEventListener",value:function removeEventListener(e,t){if(this._listeners===void 0)return;var a=this._listeners,r=a[e];if(r!==void 0){var i=r.indexOf(t);if(-1!==i){r.splice(i,1)}}}},{key:"dispatchEvent",value:function dispatchEvent(e){if(this._listeners===void 0)return;var t=this._listeners,a=t[e.type];if(a!==void 0){e.target=this;for(var r=a.slice(0),n=0,o=r.length;n<o;n++){r[n].call(this,e)}e.target=null}}}]);return e}(),ts=[],as=0;256>as;as++){ts[as]=(16>as?"0":"")+as.toString(16)}var c=1234567,rs=Math.PI/180,is=180/Math.PI;function t(){var e=0|4294967295*Math.random(),t=0|4294967295*Math.random(),a=0|4294967295*Math.random(),r=0|4294967295*Math.random(),i=ts[255&e]+ts[255&e>>8]+ts[255&e>>16]+ts[255&e>>24]+"-"+ts[255&t]+ts[255&t>>8]+"-"+ts[64|15&t>>16]+ts[255&t>>24]+"-"+ts[128|63&a]+ts[255&a>>8]+"-"+ts[255&a>>16]+ts[255&a>>24]+ts[255&r]+ts[255&r>>8]+ts[255&r>>16]+ts[255&r>>24];return i.toUpperCase()}function a(e,t,a){return Math.max(t,Math.min(a,e))}function r(e,t){return(e%t+t)%t}function n(e,a,r){return(1-r)*e+r*a}function o(e){if(e!==void 0)c=e%2147483647;c=16807*c%2147483647;return(c-1)/2147483646}function s(e){return 0==(e&e-1)&&0!==e}function l(e){return Math.pow(2,Math.ceil(Math.log(e)/Math.LN2))}function d(e){return Math.pow(2,Math.floor(Math.log(e)/Math.LN2))}var ns=Object.freeze({__proto__:null,DEG2RAD:rs,RAD2DEG:is,generateUUID:t,clamp:a,euclideanModulo:r,mapLinear:function(e,t,a,r,i){return r+(e-t)*(i-r)/(a-t)},inverseLerp:function(e,t,a){if(e!==t){return(a-e)/(t-e)}else{return 0}},lerp:n,damp:function(e,t,a,r){return n(e,t,1-Math.exp(-a*r))},pingpong:function(e){var t=1<arguments.length&&arguments[1]!==void 0?arguments[1]:1;return t-Math.abs(r(e,2*t)-t)},smoothstep:function(e,t,a){if(e<=t)return 0;if(e>=a)return 1;e=(e-t)/(a-t);return e*e*(3-2*e)},smootherstep:function(e,t,a){if(e<=t)return 0;if(e>=a)return 1;e=(e-t)/(a-t);return e*e*e*(e*(6*e-15)+10)},randInt:function(e,t){return e+Math.floor(Math.random()*(t-e+1))},randFloat:function(e,t){return e+Math.random()*(t-e)},randFloatSpread:function(e){return e*(.5-Math.random())},seededRandom:o,degToRad:function(e){return e*rs},radToDeg:function(e){return e*is},isPowerOfTwo:s,ceilPowerOfTwo:l,floorPowerOfTwo:d,setQuaternionFromProperEuler:function(e,t,a,r,i){var n=Math.cos,o=Math.sin,s=n(a/2),l=o(a/2),d=n((t+r)/2),c=o((t+r)/2),u=n((t-r)/2),p=o((t-r)/2),m=n((r-t)/2),g=o((r-t)/2);switch(i){case"XYX":e.set(s*c,l*u,l*p,s*d);break;case"YZY":e.set(l*p,s*c,l*u,s*d);break;case"ZXZ":e.set(l*u,l*p,s*c,s*d);break;case"XZX":e.set(s*c,l*g,l*m,s*d);break;case"YXY":e.set(l*m,s*c,l*g,s*d);break;case"ZYZ":e.set(l*g,l*m,s*c,s*d);break;default:console.warn("THREE.MathUtils: .setQuaternionFromProperEuler() encountered an unknown order: "+i);}}}),os=function(){function e(){var t=0<arguments.length&&arguments[0]!==void 0?arguments[0]:0,a=1<arguments.length&&arguments[1]!==void 0?arguments[1]:0;_classCallCheck2(this,e);this.x=t;this.y=a}_createClass2(e,[{key:"set",value:function set(e,t){this.x=e;this.y=t;return this}},{key:"setScalar",value:function setScalar(e){this.x=e;this.y=e;return this}},{key:"setX",value:function setX(e){this.x=e;return this}},{key:"setY",value:function setY(e){this.y=e;return this}},{key:"setComponent",value:function setComponent(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;default:throw new Error("index is out of range: "+e);}return this}},{key:"getComponent",value:function getComponent(e){switch(e){case 0:return this.x;case 1:return this.y;default:throw new Error("index is out of range: "+e);}}},{key:"clone",value:function clone(){return new this.constructor(this.x,this.y)}},{key:"copy",value:function copy(e){this.x=e.x;this.y=e.y;return this}},{key:"add",value:function add(e,t){if(t!==void 0){console.warn("THREE.Vector2: .add() now only accepts one argument. Use .addVectors( a, b ) instead.");return this.addVectors(e,t)}this.x+=e.x;this.y+=e.y;return this}},{key:"addScalar",value:function addScalar(e){this.x+=e;this.y+=e;return this}},{key:"addVectors",value:function addVectors(e,t){this.x=e.x+t.x;this.y=e.y+t.y;return this}},{key:"addScaledVector",value:function addScaledVector(e,t){this.x+=e.x*t;this.y+=e.y*t;return this}},{key:"sub",value:function sub(e,t){if(t!==void 0){console.warn("THREE.Vector2: .sub() now only accepts one argument. Use .subVectors( a, b ) instead.");return this.subVectors(e,t)}this.x-=e.x;this.y-=e.y;return this}},{key:"subScalar",value:function subScalar(e){this.x-=e;this.y-=e;return this}},{key:"subVectors",value:function subVectors(e,t){this.x=e.x-t.x;this.y=e.y-t.y;return this}},{key:"multiply",value:function multiply(e){this.x*=e.x;this.y*=e.y;return this}},{key:"multiplyScalar",value:function multiplyScalar(e){this.x*=e;this.y*=e;return this}},{key:"divide",value:function divide(e){this.x/=e.x;this.y/=e.y;return this}},{key:"divideScalar",value:function divideScalar(e){return this.multiplyScalar(1/e)}},{key:"applyMatrix3",value:function applyMatrix3(t){var a=this.x,r=this.y,i=t.elements;this.x=i[0]*a+i[3]*r+i[6];this.y=i[1]*a+i[4]*r+i[7];return this}},{key:"min",value:function min(e){this.x=Math.min(this.x,e.x);this.y=Math.min(this.y,e.y);return this}},{key:"max",value:function max(e){this.x=Math.max(this.x,e.x);this.y=Math.max(this.y,e.y);return this}},{key:"clamp",value:function(e,t){this.x=Math.max(e.x,Math.min(t.x,this.x));this.y=Math.max(e.y,Math.min(t.y,this.y));return this}},{key:"clampScalar",value:function clampScalar(e,t){this.x=Math.max(e,Math.min(t,this.x));this.y=Math.max(e,Math.min(t,this.y));return this}},{key:"clampLength",value:function clampLength(e,t){var a=this.length();return this.divideScalar(a||1).multiplyScalar(Math.max(e,Math.min(t,a)))}},{key:"floor",value:function floor(){this.x=Math.floor(this.x);this.y=Math.floor(this.y);return this}},{key:"ceil",value:function ceil(){this.x=Math.ceil(this.x);this.y=Math.ceil(this.y);return this}},{key:"round",value:function round(){this.x=Math.round(this.x);this.y=Math.round(this.y);return this}},{key:"roundToZero",value:function roundToZero(){this.x=0>this.x?Math.ceil(this.x):Math.floor(this.x);this.y=0>this.y?Math.ceil(this.y):Math.floor(this.y);return this}},{key:"negate",value:function negate(){this.x=-this.x;this.y=-this.y;return this}},{key:"dot",value:function dot(e){return this.x*e.x+this.y*e.y}},{key:"cross",value:function cross(e){return this.x*e.y-this.y*e.x}},{key:"lengthSq",value:function lengthSq(){return this.x*this.x+this.y*this.y}},{key:"length",value:function length(){return Math.sqrt(this.x*this.x+this.y*this.y)}},{key:"manhattanLength",value:function manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)}},{key:"normalize",value:function normalize(){return this.divideScalar(this.length()||1)}},{key:"angle",value:function(){var e=Math.atan2(-this.y,-this.x)+Math.PI;return e}},{key:"distanceTo",value:function distanceTo(e){return Math.sqrt(this.distanceToSquared(e))}},{key:"distanceToSquared",value:function distanceToSquared(e){var t=this.x-e.x,a=this.y-e.y;return t*t+a*a}},{key:"manhattanDistanceTo",value:function manhattanDistanceTo(e){return Math.abs(this.x-e.x)+Math.abs(this.y-e.y)}},{key:"setLength",value:function setLength(e){return this.normalize().multiplyScalar(e)}},{key:"lerp",value:function(e,t){this.x+=(e.x-this.x)*t;this.y+=(e.y-this.y)*t;return this}},{key:"lerpVectors",value:function lerpVectors(e,t,a){this.x=e.x+(t.x-e.x)*a;this.y=e.y+(t.y-e.y)*a;return this}},{key:"equals",value:function(e){return e.x===this.x&&e.y===this.y}},{key:"fromArray",value:function fromArray(e){var t=1<arguments.length&&arguments[1]!==void 0?arguments[1]:0;this.x=e[t];this.y=e[t+1];return this}},{key:"toArray",value:function toArray(){var e=0<arguments.length&&arguments[0]!==void 0?arguments[0]:[],t=1<arguments.length&&arguments[1]!==void 0?arguments[1]:0;e[t]=this.x;e[t+1]=this.y;return e}},{key:"fromBufferAttribute",value:function fromBufferAttribute(e,t,a){if(a!==void 0){console.warn("THREE.Vector2: offset has been removed from .fromBufferAttribute().")}this.x=e.getX(t);this.y=e.getY(t);return this}},{key:"rotateAround",value:function rotateAround(e,t){var a=Math.cos(t),r=Math.sin(t),i=this.x-e.x,n=this.y-e.y;this.x=i*a-n*r+e.x;this.y=i*r+n*a+e.y;return this}},{key:"random",value:function random(){this.x=Math.random();this.y=Math.random();return this}},{key:Symbol.iterator,value:regeneratorRuntime.mark(function value(){return regeneratorRuntime.wrap(function(e){while(1){switch(e.prev=e.next){case 0:e.next=2;return this.x;case 2:e.next=4;return this.y;case 4:case"end":return e.stop();}}},value,this)})},{key:"width",get:function get(){return this.x},set:function set(e){this.x=e}},{key:"height",get:function get(){return this.y},set:function set(e){this.y=e}}]);return e}();os.prototype.isVector2=!0;var ss=function(){function e(){_classCallCheck2(this,e);this.elements=[1,0,0,0,1,0,0,0,1];if(0<arguments.length){console.error("THREE.Matrix3: the constructor no longer reads arguments. use .set() instead.")}}_createClass2(e,[{key:"set",value:function set(e,t,a,r,i,n,o,s,l){var d=this.elements;d[0]=e;d[1]=r;d[2]=o;d[3]=t;d[4]=i;d[5]=s;d[6]=a;d[7]=n;d[8]=l;return this}},{key:"identity",value:function identity(){this.set(1,0,0,0,1,0,0,0,1);return this}},{key:"copy",value:function copy(e){var t=this.elements,a=e.elements;t[0]=a[0];t[1]=a[1];t[2]=a[2];t[3]=a[3];t[4]=a[4];t[5]=a[5];t[6]=a[6];t[7]=a[7];t[8]=a[8];return this}},{key:"extractBasis",value:function extractBasis(e,t,a){e.setFromMatrix3Column(this,0);t.setFromMatrix3Column(this,1);a.setFromMatrix3Column(this,2);return this}},{key:"setFromMatrix4",value:function setFromMatrix4(e){var t=e.elements;this.set(t[0],t[4],t[8],t[1],t[5],t[9],t[2],t[6],t[10]);return this}},{key:"multiply",value:function multiply(e){return this.multiplyMatrices(this,e)}},{key:"premultiply",value:function premultiply(e){return this.multiplyMatrices(e,this)}},{key:"multiplyMatrices",value:function multiplyMatrices(e,t){var a=e.elements,r=t.elements,i=this.elements,n=a[0],o=a[3],s=a[6],l=a[1],d=a[4],c=a[7],u=a[2],p=a[5],m=a[8],g=r[0],f=r[3],h=r[6],y=r[1],v=r[4],_=r[7],x=r[2],b=r[5],S=r[8];i[0]=n*g+o*y+s*x;i[3]=n*f+o*v+s*b;i[6]=n*h+o*_+s*S;i[1]=l*g+d*y+c*x;i[4]=l*f+d*v+c*b;i[7]=l*h+d*_+c*S;i[2]=u*g+p*y+m*x;i[5]=u*f+p*v+m*b;i[8]=u*h+p*_+m*S;return this}},{key:"multiplyScalar",value:function multiplyScalar(e){var t=this.elements;t[0]*=e;t[3]*=e;t[6]*=e;t[1]*=e;t[4]*=e;t[7]*=e;t[2]*=e;t[5]*=e;t[8]*=e;return this}},{key:"determinant",value:function determinant(){var t=this.elements,r=t[0],a=t[1],n=t[2],o=t[3],s=t[4],e=t[5],l=t[6],d=t[7],c=t[8];return r*s*c-r*e*d-a*o*c+a*e*l+n*o*d-n*s*l}},{key:"invert",value:function invert(){var e=this.elements,t=e[0],a=e[1],r=e[2],i=e[3],n=e[4],o=e[5],s=e[6],l=e[7],d=e[8],c=d*n-o*l,u=o*s-d*i,p=l*i-n*s,m=t*c+a*u+r*p;if(0==m)return this.set(0,0,0,0,0,0,0,0,0);var g=1/m;e[0]=c*g;e[1]=(r*l-d*a)*g;e[2]=(o*a-r*n)*g;e[3]=u*g;e[4]=(d*t-r*s)*g;e[5]=(r*i-o*t)*g;e[6]=p*g;e[7]=(a*s-l*t)*g;e[8]=(n*t-a*i)*g;return this}},{key:"transpose",value:function transpose(){var e,t=this.elements;e=t[1];t[1]=t[3];t[3]=e;e=t[2];t[2]=t[6];t[6]=e;e=t[5];t[5]=t[7];t[7]=e;return this}},{key:"getNormalMatrix",value:function getNormalMatrix(e){return this.setFromMatrix4(e).invert().transpose()}},{key:"transposeIntoArray",value:function transposeIntoArray(e){var t=this.elements;e[0]=t[0];e[1]=t[3];e[2]=t[6];e[3]=t[1];e[4]=t[4];e[5]=t[7];e[6]=t[2];e[7]=t[5];e[8]=t[8];return this}},{key:"setUvTransform",value:function setUvTransform(e,t,a,r,i,n,o){var l=Math.cos(i),d=Math.sin(i);this.set(a*l,a*d,-a*(l*n+d*o)+n+e,-r*d,r*l,-r*(-d*n+l*o)+o+t,0,0,1);return this}},{key:"scale",value:function scale(e,t){var a=this.elements;a[0]*=e;a[3]*=e;a[6]*=e;a[1]*=t;a[4]*=t;a[7]*=t;return this}},{key:"rotate",value:function rotate(e){var t=Math.cos(e),a=Math.sin(e),r=this.elements,i=r[0],n=r[3],o=r[6],s=r[1],l=r[4],d=r[7];r[0]=t*i+a*s;r[3]=t*n+a*l;r[6]=t*o+a*d;r[1]=-a*i+t*s;r[4]=-a*n+t*l;r[7]=-a*o+t*d;return this}},{key:"translate",value:function translate(e,t){var a=this.elements;a[0]+=e*a[2];a[3]+=e*a[5];a[6]+=e*a[8];a[1]+=t*a[2];a[4]+=t*a[5];a[7]+=t*a[8];return this}},{key:"equals",value:function(e){for(var t=this.elements,a=e.elements,r=0;9>r;r++){if(t[r]!==a[r])return!1}return!0}},{key:"fromArray",value:function fromArray(e){for(var t=1<arguments.length&&arguments[1]!==void 0?arguments[1]:0,a=0;9>a;a++){this.elements[a]=e[a+t]}return this}},{key:"toArray",value:function toArray(){var e=0<arguments.length&&arguments[0]!==void 0?arguments[0]:[],t=1<arguments.length&&arguments[1]!==void 0?arguments[1]:0,a=this.elements;e[t]=a[0];e[t+1]=a[1];e[t+2]=a[2];e[t+3]=a[3];e[t+4]=a[4];e[t+5]=a[5];e[t+6]=a[6];e[t+7]=a[7];e[t+8]=a[8];return e}},{key:"clone",value:function clone(){return new this.constructor().fromArray(this.elements)}}]);return e}();ss.prototype.isMatrix3=!0;function u(e){if(0===e.length)return-Infinity;for(var t=e[0],a=1,r=e.length;a<r;++a){if(e[a]>t)t=e[a]}return t}var ls={Int8Array:Int8Array,Uint8Array:Uint8Array,Uint8ClampedArray:Uint8ClampedArray,Int16Array:Int16Array,Uint16Array:Uint16Array,Int32Array:Int32Array,Uint32Array:Uint32Array,Float32Array:Float32Array,Float64Array:Float64Array};function p(e,t){return new ls[e](t)}function m(e){return document.createElementNS("http://www.w3.org/1999/xhtml",e)}function g(e){for(var t=1<arguments.length&&arguments[1]!==void 0?arguments[1]:0,a=3735928559^t,r=1103547991^t,i=0,n;i<e.length;i++){n=e.charCodeAt(i);a=Math.imul(a^n,2654435761);r=Math.imul(r^n,1597334677)}a=Math.imul(a^a>>>16,2246822507)^Math.imul(r^r>>>13,3266489909);r=Math.imul(r^r>>>16,2246822507)^Math.imul(a^a>>>13,3266489909);return 4294967296*(2097151&r)+(a>>>0)}var ds,cs=function(){function e(){_classCallCheck2(this,e)}_createClass2(e,null,[{key:"getDataURL",value:function getDataURL(e){if(/^data:/i.test(e.src)){return e.src}if("undefined"==typeof HTMLCanvasElement){return e.src}var t;if(e instanceof HTMLCanvasElement){t=e}else{if(ds===void 0)ds=m("canvas");ds.width=e.width;ds.height=e.height;var a=ds.getContext("2d");if(e instanceof ImageData){a.putImageData(e,0,0)}else{a.drawImage(e,0,0,e.width,e.height)}t=ds}if(2048<t.width||2048<t.height){console.warn("THREE.ImageUtils.getDataURL: Image converted to jpg for performance reasons",e);return t.toDataURL("image/jpeg",.6)}else{return t.toDataURL("image/png")}}}]);return e}(),us=0,ps=function(e){_inherits(a,e);var r=_createSuper(a);function a(){var e,i=0<arguments.length&&arguments[0]!==void 0?arguments[0]:a.DEFAULT_IMAGE,n=1<arguments.length&&arguments[1]!==void 0?arguments[1]:a.DEFAULT_MAPPING,o=2<arguments.length&&arguments[2]!==void 0?arguments[2]:Ri,s=3<arguments.length&&arguments[3]!==void 0?arguments[3]:Ri,l=4<arguments.length&&arguments[4]!==void 0?arguments[4]:Fi,d=5<arguments.length&&arguments[5]!==void 0?arguments[5]:Ui,c=6<arguments.length&&arguments[6]!==void 0?arguments[6]:an,u=7<arguments.length&&arguments[7]!==void 0?arguments[7]:Hi,p=8<arguments.length&&arguments[8]!==void 0?arguments[8]:1,m=9<arguments.length&&arguments[9]!==void 0?arguments[9]:ho;_classCallCheck2(this,a);e=r.call(this);Object.defineProperty(_assertThisInitialized(e),"id",{value:us++});e.uuid=t();e.name="";e.image=i;e.mipmaps=[];e.mapping=n;e.wrapS=o;e.wrapT=s;e.magFilter=l;e.minFilter=d;e.anisotropy=p;e.format=c;e.internalFormat=null;e.type=u;e.offset=new os(0,0);e.repeat=new os(1,1);e.center=new os(0,0);e.rotation=0;e.matrixAutoUpdate=!0;e.matrix=new ss;e.generateMipmaps=!0;e.premultiplyAlpha=!1;e.flipY=!0;e.unpackAlignment=4;e.encoding=m;e.userData={};e.version=0;e.onUpdate=null;e.isRenderTargetTexture=!1;return e}_createClass2(a,[{key:"updateMatrix",value:function updateMatrix(){this.matrix.setUvTransform(this.offset.x,this.offset.y,this.repeat.x,this.repeat.y,this.rotation,this.center.x,this.center.y)}},{key:"clone",value:function clone(){return new this.constructor().copy(this)}},{key:"copy",value:function copy(e){this.name=e.name;this.image=e.image;this.mipmaps=e.mipmaps.slice(0);this.mapping=e.mapping;this.wrapS=e.wrapS;this.wrapT=e.wrapT;this.magFilter=e.magFilter;this.minFilter=e.minFilter;this.anisotropy=e.anisotropy;this.format=e.format;this.internalFormat=e.internalFormat;this.type=e.type;this.offset.copy(e.offset);this.repeat.copy(e.repeat);this.center.copy(e.center);this.rotation=e.rotation;this.matrixAutoUpdate=e.matrixAutoUpdate;this.matrix.copy(e.matrix);this.generateMipmaps=e.generateMipmaps;this.premultiplyAlpha=e.premultiplyAlpha;this.flipY=e.flipY;this.unpackAlignment=e.unpackAlignment;this.encoding=e.encoding;this.userData=JSON.parse(JSON.stringify(e.userData));return this}},{key:"toJSON",value:function toJSON(e){var a=e===void 0||"string"==typeof e;if(!a&&e.textures[this.uuid]!==void 0){return e.textures[this.uuid]}var r={metadata:{version:4.5,type:"Texture",generator:"Texture.toJSON"},uuid:this.uuid,name:this.name,mapping:this.mapping,repeat:[this.repeat.x,this.repeat.y],offset:[this.offset.x,this.offset.y],center:[this.center.x,this.center.y],rotation:this.rotation,wrap:[this.wrapS,this.wrapT],format:this.format,type:this.type,encoding:this.encoding,minFilter:this.minFilter,magFilter:this.magFilter,anisotropy:this.anisotropy,flipY:this.flipY,premultiplyAlpha:this.premultiplyAlpha,unpackAlignment:this.unpackAlignment};if(this.image!==void 0){var i=this.image;if(i.uuid===void 0){i.uuid=t()}if(!a&&e.images[i.uuid]===void 0){var n;if(Array.isArray(i)){n=[];for(var o=0,s=i.length;o<s;o++){if(i[o].isDataTexture){n.push(f(i[o].image))}else{n.push(f(i[o]))}}}else{n=f(i)}e.images[i.uuid]={uuid:i.uuid,url:n}}r.image=i.uuid}if("{}"!==JSON.stringify(this.userData))r.userData=this.userData;if(!a){e.textures[this.uuid]=r}return r}},{key:"dispose",value:function dispose(){this.dispatchEvent({type:"dispose"})}},{key:"transformUv",value:function transformUv(e){if(this.mapping!==Si)return e;e.applyMatrix3(this.matrix);if(0>e.x||1<e.x){switch(this.wrapS){case Ci:e.x=e.x-Math.floor(e.x);break;case Ri:e.x=0>e.x?0:1;break;case Li:if(1===Math.abs(Math.floor(e.x)%2)){e.x=Math.ceil(e.x)-e.x}else{e.x=e.x-Math.floor(e.x)}break;}}if(0>e.y||1<e.y){switch(this.wrapT){case Ci:e.y=e.y-Math.floor(e.y);break;case Ri:e.y=0>e.y?0:1;break;case Li:if(1===Math.abs(Math.floor(e.y)%2)){e.y=Math.ceil(e.y)-e.y}else{e.y=e.y-Math.floor(e.y)}break;}}if(this.flipY){e.y=1-e.y}return e}},{key:"needsUpdate",set:function set(e){if(!0===e)this.version++}}]);return a}(es);ps.DEFAULT_IMAGE=void 0;ps.DEFAULT_MAPPING=Si;ps.prototype.isTexture=!0;function f(e){if("undefined"!=typeof HTMLImageElement&&e instanceof HTMLImageElement||"undefined"!=typeof HTMLCanvasElement&&e instanceof HTMLCanvasElement||"undefined"!=typeof ImageBitmap&&e instanceof ImageBitmap){return cs.getDataURL(e)}else{if(e.data){return{data:Array.prototype.slice.call(e.data),width:e.width,height:e.height,type:e.data.constructor.name}}else{console.warn("THREE.Texture: Unable to serialize Texture.");return{}}}}var ms=function(){function e(){var t=0<arguments.length&&arguments[0]!==void 0?arguments[0]:0,a=1<arguments.length&&arguments[1]!==void 0?arguments[1]:0,r=2<arguments.length&&arguments[2]!==void 0?arguments[2]:0,i=3<arguments.length&&arguments[3]!==void 0?arguments[3]:1;_classCallCheck2(this,e);this.x=t;this.y=a;this.z=r;this.w=i}_createClass2(e,[{key:"set",value:function set(e,t,a,r){this.x=e;this.y=t;this.z=a;this.w=r;return this}},{key:"setScalar",value:function setScalar(e){this.x=e;this.y=e;this.z=e;this.w=e;return this}},{key:"setX",value:function setX(e){this.x=e;return this}},{key:"setY",value:function setY(e){this.y=e;return this}},{key:"setZ",value:function setZ(e){this.z=e;return this}},{key:"setW",value:function setW(e){this.w=e;return this}},{key:"setComponent",value:function setComponent(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;case 2:this.z=t;break;case 3:this.w=t;break;default:throw new Error("index is out of range: "+e);}return this}},{key:"getComponent",value:function getComponent(e){switch(e){case 0:return this.x;case 1:return this.y;case 2:return this.z;case 3:return this.w;default:throw new Error("index is out of range: "+e);}}},{key:"clone",value:function clone(){return new this.constructor(this.x,this.y,this.z,this.w)}},{key:"copy",value:function copy(e){this.x=e.x;this.y=e.y;this.z=e.z;this.w=e.w!==void 0?e.w:1;return this}},{key:"add",value:function add(e,t){if(t!==void 0){console.warn("THREE.Vector4: .add() now only accepts one argument. Use .addVectors( a, b ) instead.");return this.addVectors(e,t)}this.x+=e.x;this.y+=e.y;this.z+=e.z;this.w+=e.w;return this}},{key:"addScalar",value:function addScalar(e){this.x+=e;this.y+=e;this.z+=e;this.w+=e;return this}},{key:"addVectors",value:function addVectors(e,t){this.x=e.x+t.x;this.y=e.y+t.y;this.z=e.z+t.z;this.w=e.w+t.w;return this}},{key:"addScaledVector",value:function addScaledVector(e,t){this.x+=e.x*t;this.y+=e.y*t;this.z+=e.z*t;this.w+=e.w*t;return this}},{key:"sub",value:function sub(e,t){if(t!==void 0){console.warn("THREE.Vector4: .sub() now only accepts one argument. Use .subVectors( a, b ) instead.");return this.subVectors(e,t)}this.x-=e.x;this.y-=e.y;this.z-=e.z;this.w-=e.w;return this}},{key:"subScalar",value:function subScalar(e){this.x-=e;this.y-=e;this.z-=e;this.w-=e;return this}},{key:"subVectors",value:function subVectors(e,t){this.x=e.x-t.x;this.y=e.y-t.y;this.z=e.z-t.z;this.w=e.w-t.w;return this}},{key:"multiply",value:function multiply(e){this.x*=e.x;this.y*=e.y;this.z*=e.z;this.w*=e.w;return this}},{key:"multiplyScalar",value:function multiplyScalar(e){this.x*=e;this.y*=e;this.z*=e;this.w*=e;return this}},{key:"applyMatrix4",value:function applyMatrix4(t){var a=this.x,r=this.y,i=this.z,n=this.w,o=t.elements;this.x=o[0]*a+o[4]*r+o[8]*i+o[12]*n;this.y=o[1]*a+o[5]*r+o[9]*i+o[13]*n;this.z=o[2]*a+o[6]*r+o[10]*i+o[14]*n;this.w=o[3]*a+o[7]*r+o[11]*i+o[15]*n;return this}},{key:"divideScalar",value:function divideScalar(e){return this.multiplyScalar(1/e)}},{key:"setAxisAngleFromQuaternion",value:function setAxisAngleFromQuaternion(e){this.w=2*Math.acos(e.w);var t=Math.sqrt(1-e.w*e.w);if(1e-4>t){this.x=1;this.y=0;this.z=0}else{this.x=e.x/t;this.y=e.y/t;this.z=e.z/t}return this}},{key:"setAxisAngleFromRotationMatrix",value:function setAxisAngleFromRotationMatrix(e){var t,a,r,i,n=.01,o=.1,l=e.elements,d=l[0],c=l[4],u=l[8],p=l[1],m=l[5],g=l[9],f=l[2],h=l[6],v=l[10];if(Math.abs(c-p)<n&&Math.abs(u-f)<n&&Math.abs(g-h)<n){if(Math.abs(c+p)<o&&Math.abs(u+f)<o&&Math.abs(g+h)<o&&Math.abs(d+m+v-3)<o){this.set(1,0,0,0);return this}t=Math.PI;var _=(d+1)/2,b=(m+1)/2,S=(v+1)/2,M=(c+p)/4,T=(u+f)/4,E=(g+h)/4;if(_>b&&_>S){if(_<n){a=0;r=.707106781;i=.707106781}else{a=Math.sqrt(_);r=M/a;i=T/a}}else if(b>S){if(b<n){a=.707106781;r=0;i=.707106781}else{r=Math.sqrt(b);a=M/r;i=E/r}}else{if(S<n){a=.707106781;r=.707106781;i=0}else{i=Math.sqrt(S);a=T/i;r=E/i}}this.set(a,r,i,t);return this}var w=Math.sqrt((h-g)*(h-g)+(u-f)*(u-f)+(p-c)*(p-c));if(.001>Math.abs(w))w=1;this.x=(h-g)/w;this.y=(u-f)/w;this.z=(p-c)/w;this.w=Math.acos((d+m+v-1)/2);return this}},{key:"min",value:function min(e){this.x=Math.min(this.x,e.x);this.y=Math.min(this.y,e.y);this.z=Math.min(this.z,e.z);this.w=Math.min(this.w,e.w);return this}},{key:"max",value:function max(e){this.x=Math.max(this.x,e.x);this.y=Math.max(this.y,e.y);this.z=Math.max(this.z,e.z);this.w=Math.max(this.w,e.w);return this}},{key:"clamp",value:function(e,t){this.x=Math.max(e.x,Math.min(t.x,this.x));this.y=Math.max(e.y,Math.min(t.y,this.y));this.z=Math.max(e.z,Math.min(t.z,this.z));this.w=Math.max(e.w,Math.min(t.w,this.w));return this}},{key:"clampScalar",value:function clampScalar(e,t){this.x=Math.max(e,Math.min(t,this.x));this.y=Math.max(e,Math.min(t,this.y));this.z=Math.max(e,Math.min(t,this.z));this.w=Math.max(e,Math.min(t,this.w));return this}},{key:"clampLength",value:function clampLength(e,t){var a=this.length();return this.divideScalar(a||1).multiplyScalar(Math.max(e,Math.min(t,a)))}},{key:"floor",value:function floor(){this.x=Math.floor(this.x);this.y=Math.floor(this.y);this.z=Math.floor(this.z);this.w=Math.floor(this.w);return this}},{key:"ceil",value:function ceil(){this.x=Math.ceil(this.x);this.y=Math.ceil(this.y);this.z=Math.ceil(this.z);this.w=Math.ceil(this.w);return this}},{key:"round",value:function round(){this.x=Math.round(this.x);this.y=Math.round(this.y);this.z=Math.round(this.z);this.w=Math.round(this.w);return this}},{key:"roundToZero",value:function roundToZero(){this.x=0>this.x?Math.ceil(this.x):Math.floor(this.x);this.y=0>this.y?Math.ceil(this.y):Math.floor(this.y);this.z=0>this.z?Math.ceil(this.z):Math.floor(this.z);this.w=0>this.w?Math.ceil(this.w):Math.floor(this.w);return this}},{key:"negate",value:function negate(){this.x=-this.x;this.y=-this.y;this.z=-this.z;this.w=-this.w;return this}},{key:"dot",value:function dot(e){return this.x*e.x+this.y*e.y+this.z*e.z+this.w*e.w}},{key:"lengthSq",value:function lengthSq(){return this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w}},{key:"length",value:function length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w)}},{key:"manhattanLength",value:function manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)+Math.abs(this.w)}},{key:"normalize",value:function normalize(){return this.divideScalar(this.length()||1)}},{key:"setLength",value:function setLength(e){return this.normalize().multiplyScalar(e)}},{key:"lerp",value:function(e,t){this.x+=(e.x-this.x)*t;this.y+=(e.y-this.y)*t;this.z+=(e.z-this.z)*t;this.w+=(e.w-this.w)*t;return this}},{key:"lerpVectors",value:function lerpVectors(e,t,a){this.x=e.x+(t.x-e.x)*a;this.y=e.y+(t.y-e.y)*a;this.z=e.z+(t.z-e.z)*a;this.w=e.w+(t.w-e.w)*a;return this}},{key:"equals",value:function(e){return e.x===this.x&&e.y===this.y&&e.z===this.z&&e.w===this.w}},{key:"fromArray",value:function fromArray(e){var t=1<arguments.length&&arguments[1]!==void 0?arguments[1]:0;this.x=e[t];this.y=e[t+1];this.z=e[t+2];this.w=e[t+3];return this}},{key:"toArray",value:function toArray(){var e=0<arguments.length&&arguments[0]!==void 0?arguments[0]:[],t=1<arguments.length&&arguments[1]!==void 0?arguments[1]:0;e[t]=this.x;e[t+1]=this.y;e[t+2]=this.z;e[t+3]=this.w;return e}},{key:"fromBufferAttribute",value:function fromBufferAttribute(e,t,a){if(a!==void 0){console.warn("THREE.Vector4: offset has been removed from .fromBufferAttribute().")}this.x=e.getX(t);this.y=e.getY(t);this.z=e.getZ(t);this.w=e.getW(t);return this}},{key:"random",value:function random(){this.x=Math.random();this.y=Math.random();this.z=Math.random();this.w=Math.random();return this}},{key:Symbol.iterator,value:regeneratorRuntime.mark(function value(){return regeneratorRuntime.wrap(function(e){while(1){switch(e.prev=e.next){case 0:e.next=2;return this.x;case 2:e.next=4;return this.y;case 4:e.next=6;return this.z;case 6:e.next=8;return this.w;case 8:case"end":return e.stop();}}},value,this)})},{key:"width",get:function get(){return this.z},set:function set(e){this.z=e}},{key:"height",get:function get(){return this.w},set:function set(e){this.w=e}}]);return e}();ms.prototype.isVector4=!0;var gs=function(e){_inherits(t,e);var a=_createSuper(t);function t(e,r){var i,n=2<arguments.length&&arguments[2]!==void 0?arguments[2]:{};_classCallCheck2(this,t);i=a.call(this);i.width=e;i.height=r;i.depth=1;i.scissor=new ms(0,0,e,r);i.scissorTest=!1;i.viewport=new ms(0,0,e,r);i.texture=new ps(void 0,n.mapping,n.wrapS,n.wrapT,n.magFilter,n.minFilter,n.format,n.type,n.anisotropy,n.encoding);i.texture.isRenderTargetTexture=!0;i.texture.image={width:e,height:r,depth:1};i.texture.generateMipmaps=n.generateMipmaps!==void 0?n.generateMipmaps:!1;i.texture.internalFormat=n.internalFormat!==void 0?n.internalFormat:null;i.texture.minFilter=n.minFilter!==void 0?n.minFilter:Fi;i.depthBuffer=n.depthBuffer!==void 0?n.depthBuffer:!0;i.stencilBuffer=n.stencilBuffer!==void 0?n.stencilBuffer:!1;i.depthTexture=n.depthTexture!==void 0?n.depthTexture:null;return i}_createClass2(t,[{key:"setTexture",value:function setTexture(e){e.image={width:this.width,height:this.height,depth:this.depth};this.texture=e}},{key:"setSize",value:function setSize(e,t){var a=2<arguments.length&&arguments[2]!==void 0?arguments[2]:1;if(this.width!==e||this.height!==t||this.depth!==a){this.width=e;this.height=t;this.depth=a;this.texture.image.width=e;this.texture.image.height=t;this.texture.image.depth=a;this.dispose()}this.viewport.set(0,0,e,t);this.scissor.set(0,0,e,t)}},{key:"clone",value:function clone(){return new this.constructor().copy(this)}},{key:"copy",value:function copy(e){this.width=e.width;this.height=e.height;this.depth=e.depth;this.viewport.copy(e.viewport);this.texture=e.texture.clone();this.texture.image=_objectSpread2({},this.texture.image);this.depthBuffer=e.depthBuffer;this.stencilBuffer=e.stencilBuffer;this.depthTexture=e.depthTexture;return this}},{key:"dispose",value:function dispose(){this.dispatchEvent({type:"dispose"})}}]);return t}(es);gs.prototype.isWebGLRenderTarget=!0;var fs=function(e){_inherits(t,e);var a=_createSuper(t);function t(e,r,i){var n;_classCallCheck2(this,t);n=a.call(this,e,r);var o=n.texture;n.texture=[];for(var s=0;s<i;s++){n.texture[s]=o.clone()}return n}_createClass2(t,[{key:"setSize",value:function setSize(e,t){var a=2<arguments.length&&arguments[2]!==void 0?arguments[2]:1;if(this.width!==e||this.height!==t||this.depth!==a){this.width=e;this.height=t;this.depth=a;for(var r=0,i=this.texture.length;r<i;r++){this.texture[r].image.width=e;this.texture[r].image.height=t;this.texture[r].image.depth=a}this.dispose()}this.viewport.set(0,0,e,t);this.scissor.set(0,0,e,t);return this}},{key:"copy",value:function copy(e){this.dispose();this.width=e.width;this.height=e.height;this.depth=e.depth;this.viewport.set(0,0,this.width,this.height);this.scissor.set(0,0,this.width,this.height);this.depthBuffer=e.depthBuffer;this.stencilBuffer=e.stencilBuffer;this.depthTexture=e.depthTexture;this.texture.length=0;for(var t=0,a=e.texture.length;t<a;t++){this.texture[t]=e.texture[t].clone()}return this}}]);return t}(gs);fs.prototype.isWebGLMultipleRenderTargets=!0;var hs=function(e){_inherits(t,e);var a=_createSuper(t);function t(e,r){var i,n=2<arguments.length&&arguments[2]!==void 0?arguments[2]:{};_classCallCheck2(this,t);i=a.call(this,e,r,n);i.samples=4;i.ignoreDepthForMultisampleCopy=n.ignoreDepth!==void 0?n.ignoreDepth:!0;i.useRenderToTexture=n.useRenderToTexture!==void 0?n.useRenderToTexture:!1;i.useRenderbuffer=!1===i.useRenderToTexture;return i}_createClass2(t,[{key:"copy",value:function copy(e){_get(_getPrototypeOf(t.prototype),"copy",this).call(this,e);this.samples=e.samples;this.useRenderToTexture=e.useRenderToTexture;this.useRenderbuffer=e.useRenderbuffer;return this}}]);return t}(gs);hs.prototype.isWebGLMultisampleRenderTarget=!0;var ys=function(){function e(){var t=0<arguments.length&&arguments[0]!==void 0?arguments[0]:0,a=1<arguments.length&&arguments[1]!==void 0?arguments[1]:0,r=2<arguments.length&&arguments[2]!==void 0?arguments[2]:0,i=3<arguments.length&&arguments[3]!==void 0?arguments[3]:1;_classCallCheck2(this,e);this._x=t;this._y=a;this._z=r;this._w=i}_createClass2(e,[{key:"set",value:function set(e,t,a,r){this._x=e;this._y=t;this._z=a;this._w=r;this._onChangeCallback();return this}},{key:"clone",value:function clone(){return new this.constructor(this._x,this._y,this._z,this._w)}},{key:"copy",value:function copy(e){this._x=e.x;this._y=e.y;this._z=e.z;this._w=e.w;this._onChangeCallback();return this}},{key:"setFromEuler",value:function setFromEuler(e,t){if(!(e&&e.isEuler)){throw new Error("THREE.Quaternion: .setFromEuler() now expects an Euler rotation rather than a Vector3 and order.")}var a=e._x,r=e._y,i=e._z,n=e._order,o=Math.cos,s=Math.sin,l=o(a/2),d=o(r/2),c=o(i/2),u=s(a/2),p=s(r/2),m=s(i/2);switch(n){case"XYZ":this._x=u*d*c+l*p*m;this._y=l*p*c-u*d*m;this._z=l*d*m+u*p*c;this._w=l*d*c-u*p*m;break;case"YXZ":this._x=u*d*c+l*p*m;this._y=l*p*c-u*d*m;this._z=l*d*m-u*p*c;this._w=l*d*c+u*p*m;break;case"ZXY":this._x=u*d*c-l*p*m;this._y=l*p*c+u*d*m;this._z=l*d*m+u*p*c;this._w=l*d*c-u*p*m;break;case"ZYX":this._x=u*d*c-l*p*m;this._y=l*p*c+u*d*m;this._z=l*d*m-u*p*c;this._w=l*d*c+u*p*m;break;case"YZX":this._x=u*d*c+l*p*m;this._y=l*p*c+u*d*m;this._z=l*d*m-u*p*c;this._w=l*d*c-u*p*m;break;case"XZY":this._x=u*d*c-l*p*m;this._y=l*p*c-u*d*m;this._z=l*d*m+u*p*c;this._w=l*d*c+u*p*m;break;default:console.warn("THREE.Quaternion: .setFromEuler() encountered an unknown order: "+n);}if(!1!==t)this._onChangeCallback();return this}},{key:"setFromAxisAngle",value:function setFromAxisAngle(e,t){var a=t/2,r=Math.sin(a);this._x=e.x*r;this._y=e.y*r;this._z=e.z*r;this._w=Math.cos(a);this._onChangeCallback();return this}},{key:"setFromRotationMatrix",value:function setFromRotationMatrix(e){var t=e.elements,a=t[0],r=t[4],i=t[8],n=t[1],o=t[5],l=t[9],d=t[2],c=t[6],u=t[10],p=a+o+u;if(0<p){var m=.5/Math.sqrt(p+1);this._w=.25/m;this._x=(c-l)*m;this._y=(i-d)*m;this._z=(n-r)*m}else if(a>o&&a>u){var s=2*Math.sqrt(1+a-o-u);this._w=(c-l)/s;this._x=.25*s;this._y=(r+n)/s;this._z=(i+d)/s}else if(o>u){var g=2*Math.sqrt(1+o-a-u);this._w=(i-d)/g;this._x=(r+n)/g;this._y=.25*g;this._z=(l+c)/g}else{var f=2*Math.sqrt(1+u-a-o);this._w=(n-r)/f;this._x=(i+d)/f;this._y=(l+c)/f;this._z=.25*f}this._onChangeCallback();return this}},{key:"setFromUnitVectors",value:function setFromUnitVectors(e,t){var a=e.dot(t)+1;if(a<Number.EPSILON){a=0;if(Math.abs(e.x)>Math.abs(e.z)){this._x=-e.y;this._y=e.x;this._z=0;this._w=a}else{this._x=0;this._y=-e.z;this._z=e.y;this._w=a}}else{this._x=e.y*t.z-e.z*t.y;this._y=e.z*t.x-e.x*t.z;this._z=e.x*t.y-e.y*t.x;this._w=a}return this.normalize()}},{key:"angleTo",value:function angleTo(e){return 2*Math.acos(Math.abs(a(this.dot(e),-1,1)))}},{key:"rotateTowards",value:function rotateTowards(e,a){var r=this.angleTo(e);if(0===r)return this;var i=Math.min(1,a/r);this.slerp(e,i);return this}},{key:"identity",value:function identity(){return this.set(0,0,0,1)}},{key:"invert",value:function invert(){return this.conjugate()}},{key:"conjugate",value:function conjugate(){this._x*=-1;this._y*=-1;this._z*=-1;this._onChangeCallback();return this}},{key:"dot",value:function dot(e){return this._x*e._x+this._y*e._y+this._z*e._z+this._w*e._w}},{key:"lengthSq",value:function lengthSq(){return this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w}},{key:"length",value:function length(){return Math.sqrt(this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w)}},{key:"normalize",value:function normalize(){var e=this.length();if(0===e){this._x=0;this._y=0;this._z=0;this._w=1}else{e=1/e;this._x=this._x*e;this._y=this._y*e;this._z=this._z*e;this._w=this._w*e}this._onChangeCallback();return this}},{key:"multiply",value:function multiply(e,t){if(t!==void 0){console.warn("THREE.Quaternion: .multiply() now only accepts one argument. Use .multiplyQuaternions( a, b ) instead.");return this.multiplyQuaternions(e,t)}return this.multiplyQuaternions(this,e)}},{key:"premultiply",value:function premultiply(e){return this.multiplyQuaternions(e,this)}},{key:"multiplyQuaternions",value:function multiplyQuaternions(e,t){var a=e._x,r=e._y,i=e._z,n=e._w,o=t._x,s=t._y,l=t._z,d=t._w;this._x=a*d+n*o+r*l-i*s;this._y=r*d+n*s+i*o-a*l;this._z=i*d+n*l+a*s-r*o;this._w=n*d-a*o-r*s-i*l;this._onChangeCallback();return this}},{key:"slerp",value:function slerp(e,a){if(0===a)return this;if(1===a)return this.copy(e);var t=this._x,r=this._y,i=this._z,n=this._w,o=n*e._w+t*e._x+r*e._y+i*e._z;if(0>o){this._w=-e._w;this._x=-e._x;this._y=-e._y;this._z=-e._z;o=-o}else{this.copy(e)}if(1<=o){this._w=n;this._x=t;this._y=r;this._z=i;return this}var l=1-o*o;if(l<=Number.EPSILON){var m=1-a;this._w=m*n+a*this._w;this._x=m*t+a*this._x;this._y=m*r+a*this._y;this._z=m*i+a*this._z;this.normalize();this._onChangeCallback();return this}var d=Math.sqrt(l),c=Math.atan2(d,o),u=Math.sin((1-a)*c)/d,p=Math.sin(a*c)/d;this._w=n*u+this._w*p;this._x=t*u+this._x*p;this._y=r*u+this._y*p;this._z=i*u+this._z*p;this._onChangeCallback();return this}},{key:"slerpQuaternions",value:function slerpQuaternions(e,a,r){this.copy(e).slerp(a,r)}},{key:"random",value:function random(){var e=Math.random(),t=Math.sqrt(1-e),a=Math.sqrt(e),r=2*Math.PI*Math.random(),i=2*Math.PI*Math.random();return this.set(t*Math.cos(r),a*Math.sin(i),a*Math.cos(i),t*Math.sin(r))}},{key:"equals",value:function(e){return e._x===this._x&&e._y===this._y&&e._z===this._z&&e._w===this._w}},{key:"fromArray",value:function fromArray(e){var t=1<arguments.length&&arguments[1]!==void 0?arguments[1]:0;this._x=e[t];this._y=e[t+1];this._z=e[t+2];this._w=e[t+3];this._onChangeCallback();return this}},{key:"toArray",value:function toArray(){var e=0<arguments.length&&arguments[0]!==void 0?arguments[0]:[],t=1<arguments.length&&arguments[1]!==void 0?arguments[1]:0;e[t]=this._x;e[t+1]=this._y;e[t+2]=this._z;e[t+3]=this._w;return e}},{key:"fromBufferAttribute",value:function fromBufferAttribute(e,t){this._x=e.getX(t);this._y=e.getY(t);this._z=e.getZ(t);this._w=e.getW(t);return this}},{key:"_onChange",value:function _onChange(e){this._onChangeCallback=e;return this}},{key:"_onChangeCallback",value:function _onChangeCallback(){}},{key:"x",get:function get(){return this._x},set:function set(e){this._x=e;this._onChangeCallback()}},{key:"y",get:function get(){return this._y},set:function set(e){this._y=e;this._onChangeCallback()}},{key:"z",get:function get(){return this._z},set:function set(e){this._z=e;this._onChangeCallback()}},{key:"w",get:function get(){return this._w},set:function set(e){this._w=e;this._onChangeCallback()}}],[{key:"slerp",value:function slerp(e,a,r,i){console.warn("THREE.Quaternion: Static .slerp() has been deprecated. Use qm.slerpQuaternions( qa, qb, t ) instead.");return r.slerpQuaternions(e,a,i)}},{key:"slerpFlat",value:function slerpFlat(e,a,r,i,n,o,l){var d=r[i+0],c=r[i+1],u=r[i+2],p=r[i+3],m=n[o+0],g=n[o+1],h=n[o+2],y=n[o+3];if(0===l){e[a+0]=d;e[a+1]=c;e[a+2]=u;e[a+3]=p;return}if(1===l){e[a+0]=m;e[a+1]=g;e[a+2]=h;e[a+3]=y;return}if(p!==y||d!==m||c!==g||u!==h){var v=1-l,_=d*m+c*g+u*h+p*y,x=0<=_?1:-1,b=1-_*_;if(b>Number.EPSILON){var S=Math.sqrt(b),M=Math.atan2(S,_*x);v=Math.sin(v*M)/S;l=Math.sin(l*M)/S}var T=l*x;d=d*v+m*T;c=c*v+g*T;u=u*v+h*T;p=p*v+y*T;if(v==1-l){var E=1/Math.sqrt(d*d+c*c+u*u+p*p);d*=E;c*=E;u*=E;p*=E}}e[a]=d;e[a+1]=c;e[a+2]=u;e[a+3]=p}},{key:"multiplyQuaternionsFlat",value:function multiplyQuaternionsFlat(e,t,a,r,i,n){var o=a[r],s=a[r+1],l=a[r+2],d=a[r+3],c=i[n],u=i[n+1],p=i[n+2],m=i[n+3];e[t]=o*m+d*c+s*p-l*u;e[t+1]=s*m+d*u+l*c-o*p;e[t+2]=l*m+d*p+o*u-s*c;e[t+3]=d*m-o*c-s*u-l*p;return e}}]);return e}();ys.prototype.isQuaternion=!0;var vs=function(){function e(){var t=0<arguments.length&&arguments[0]!==void 0?arguments[0]:0,a=1<arguments.length&&arguments[1]!==void 0?arguments[1]:0,r=2<arguments.length&&arguments[2]!==void 0?arguments[2]:0;_classCallCheck2(this,e);this.x=t;this.y=a;this.z=r}_createClass2(e,[{key:"set",value:function set(e,t,a){if(a===void 0)a=this.z;this.x=e;this.y=t;this.z=a;return this}},{key:"setScalar",value:function setScalar(e){this.x=e;this.y=e;this.z=e;return this}},{key:"setX",value:function setX(e){this.x=e;return this}},{key:"setY",value:function setY(e){this.y=e;return this}},{key:"setZ",value:function setZ(e){this.z=e;return this}},{key:"setComponent",value:function setComponent(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;case 2:this.z=t;break;default:throw new Error("index is out of range: "+e);}return this}},{key:"getComponent",value:function getComponent(e){switch(e){case 0:return this.x;case 1:return this.y;case 2:return this.z;default:throw new Error("index is out of range: "+e);}}},{key:"clone",value:function clone(){return new this.constructor(this.x,this.y,this.z)}},{key:"copy",value:function copy(e){this.x=e.x;this.y=e.y;this.z=e.z;return this}},{key:"add",value:function add(e,t){if(t!==void 0){console.warn("THREE.Vector3: .add() now only accepts one argument. Use .addVectors( a, b ) instead.");return this.addVectors(e,t)}this.x+=e.x;this.y+=e.y;this.z+=e.z;return this}},{key:"addScalar",value:function addScalar(e){this.x+=e;this.y+=e;this.z+=e;return this}},{key:"addVectors",value:function addVectors(e,t){this.x=e.x+t.x;this.y=e.y+t.y;this.z=e.z+t.z;return this}},{key:"addScaledVector",value:function addScaledVector(e,t){this.x+=e.x*t;this.y+=e.y*t;this.z+=e.z*t;return this}},{key:"sub",value:function sub(e,t){if(t!==void 0){console.warn("THREE.Vector3: .sub() now only accepts one argument. Use .subVectors( a, b ) instead.");return this.subVectors(e,t)}this.x-=e.x;this.y-=e.y;this.z-=e.z;return this}},{key:"subScalar",value:function subScalar(e){this.x-=e;this.y-=e;this.z-=e;return this}},{key:"subVectors",value:function subVectors(e,t){this.x=e.x-t.x;this.y=e.y-t.y;this.z=e.z-t.z;return this}},{key:"multiply",value:function multiply(e,t){if(t!==void 0){console.warn("THREE.Vector3: .multiply() now only accepts one argument. Use .multiplyVectors( a, b ) instead.");return this.multiplyVectors(e,t)}this.x*=e.x;this.y*=e.y;this.z*=e.z;return this}},{key:"multiplyScalar",value:function multiplyScalar(e){this.x*=e;this.y*=e;this.z*=e;return this}},{key:"multiplyVectors",value:function multiplyVectors(e,t){this.x=e.x*t.x;this.y=e.y*t.y;this.z=e.z*t.z;return this}},{key:"applyEuler",value:function applyEuler(e){if(!(e&&e.isEuler)){console.error("THREE.Vector3: .applyEuler() now expects an Euler rotation rather than a Vector3 and order.")}return this.applyQuaternion(xs.setFromEuler(e))}},{key:"applyAxisAngle",value:function applyAxisAngle(e,t){return this.applyQuaternion(xs.setFromAxisAngle(e,t))}},{key:"applyMatrix3",value:function applyMatrix3(t){var a=this.x,r=this.y,i=this.z,n=t.elements;this.x=n[0]*a+n[3]*r+n[6]*i;this.y=n[1]*a+n[4]*r+n[7]*i;this.z=n[2]*a+n[5]*r+n[8]*i;return this}},{key:"applyNormalMatrix",value:function applyNormalMatrix(e){return this.applyMatrix3(e).normalize()}},{key:"applyMatrix4",value:function applyMatrix4(t){var a=this.x,r=this.y,i=this.z,n=t.elements,e=1/(n[3]*a+n[7]*r+n[11]*i+n[15]);this.x=(n[0]*a+n[4]*r+n[8]*i+n[12])*e;this.y=(n[1]*a+n[5]*r+n[9]*i+n[13])*e;this.z=(n[2]*a+n[6]*r+n[10]*i+n[14])*e;return this}},{key:"applyQuaternion",value:function applyQuaternion(e){var t=this.x,a=this.y,r=this.z,i=e.x,n=e.y,o=e.z,s=e.w,l=s*t+n*r-o*a,d=s*a+o*t-i*r,c=s*r+i*a-n*t,u=-i*t-n*a-o*r;this.x=l*s+u*-i+d*-o-c*-n;this.y=d*s+u*-n+c*-i-l*-o;this.z=c*s+u*-o+l*-n-d*-i;return this}},{key:"project",value:function project(e){return this.applyMatrix4(e.matrixWorldInverse).applyMatrix4(e.projectionMatrix)}},{key:"unproject",value:function unproject(e){return this.applyMatrix4(e.projectionMatrixInverse).applyMatrix4(e.matrixWorld)}},{key:"transformDirection",value:function transformDirection(t){var a=this.x,r=this.y,i=this.z,n=t.elements;this.x=n[0]*a+n[4]*r+n[8]*i;this.y=n[1]*a+n[5]*r+n[9]*i;this.z=n[2]*a+n[6]*r+n[10]*i;return this.normalize()}},{key:"divide",value:function divide(e){this.x/=e.x;this.y/=e.y;this.z/=e.z;return this}},{key:"divideScalar",value:function divideScalar(e){return this.multiplyScalar(1/e)}},{key:"min",value:function min(e){this.x=Math.min(this.x,e.x);this.y=Math.min(this.y,e.y);this.z=Math.min(this.z,e.z);return this}},{key:"max",value:function max(e){this.x=Math.max(this.x,e.x);this.y=Math.max(this.y,e.y);this.z=Math.max(this.z,e.z);return this}},{key:"clamp",value:function(e,t){this.x=Math.max(e.x,Math.min(t.x,this.x));this.y=Math.max(e.y,Math.min(t.y,this.y));this.z=Math.max(e.z,Math.min(t.z,this.z));return this}},{key:"clampScalar",value:function clampScalar(e,t){this.x=Math.max(e,Math.min(t,this.x));this.y=Math.max(e,Math.min(t,this.y));this.z=Math.max(e,Math.min(t,this.z));return this}},{key:"clampLength",value:function clampLength(e,t){var a=this.length();return this.divideScalar(a||1).multiplyScalar(Math.max(e,Math.min(t,a)))}},{key:"floor",value:function floor(){this.x=Math.floor(this.x);this.y=Math.floor(this.y);this.z=Math.floor(this.z);return this}},{key:"ceil",value:function ceil(){this.x=Math.ceil(this.x);this.y=Math.ceil(this.y);this.z=Math.ceil(this.z);return this}},{key:"round",value:function round(){this.x=Math.round(this.x);this.y=Math.round(this.y);this.z=Math.round(this.z);return this}},{key:"roundToZero",value:function roundToZero(){this.x=0>this.x?Math.ceil(this.x):Math.floor(this.x);this.y=0>this.y?Math.ceil(this.y):Math.floor(this.y);this.z=0>this.z?Math.ceil(this.z):Math.floor(this.z);return this}},{key:"negate",value:function negate(){this.x=-this.x;this.y=-this.y;this.z=-this.z;return this}},{key:"dot",value:function dot(e){return this.x*e.x+this.y*e.y+this.z*e.z}},{key:"lengthSq",value:function lengthSq(){return this.x*this.x+this.y*this.y+this.z*this.z}},{key:"length",value:function length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)}},{key:"manhattanLength",value:function manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)}},{key:"normalize",value:function normalize(){return this.divideScalar(this.length()||1)}},{key:"setLength",value:function setLength(e){return this.normalize().multiplyScalar(e)}},{key:"lerp",value:function(e,t){this.x+=(e.x-this.x)*t;this.y+=(e.y-this.y)*t;this.z+=(e.z-this.z)*t;return this}},{key:"lerpVectors",value:function lerpVectors(e,t,a){this.x=e.x+(t.x-e.x)*a;this.y=e.y+(t.y-e.y)*a;this.z=e.z+(t.z-e.z)*a;return this}},{key:"cross",value:function cross(e,t){if(t!==void 0){console.warn("THREE.Vector3: .cross() now only accepts one argument. Use .crossVectors( a, b ) instead.");return this.crossVectors(e,t)}return this.crossVectors(this,e)}},{key:"crossVectors",value:function crossVectors(e,t){var a=e.x,r=e.y,i=e.z,n=t.x,o=t.y,s=t.z;this.x=r*s-i*o;this.y=i*n-a*s;this.z=a*o-r*n;return this}},{key:"projectOnVector",value:function projectOnVector(e){var t=e.lengthSq();if(0===t)return this.set(0,0,0);var a=e.dot(this)/t;return this.copy(e).multiplyScalar(a)}},{key:"projectOnPlane",value:function projectOnPlane(e){_s.copy(this).projectOnVector(e);return this.sub(_s)}},{key:"reflect",value:function reflect(e){return this.sub(_s.copy(e).multiplyScalar(2*this.dot(e)))}},{key:"angleTo",value:function angleTo(e){var t=Math.sqrt(this.lengthSq()*e.lengthSq());if(0===t)return Math.PI/2;var r=this.dot(e)/t;return Math.acos(a(r,-1,1))}},{key:"distanceTo",value:function distanceTo(e){return Math.sqrt(this.distanceToSquared(e))}},{key:"distanceToSquared",value:function distanceToSquared(e){var t=this.x-e.x,a=this.y-e.y,r=this.z-e.z;return t*t+a*a+r*r}},{key:"manhattanDistanceTo",value:function manhattanDistanceTo(e){return Math.abs(this.x-e.x)+Math.abs(this.y-e.y)+Math.abs(this.z-e.z)}},{key:"setFromSpherical",value:function setFromSpherical(e){return this.setFromSphericalCoords(e.radius,e.phi,e.theta)}},{key:"setFromSphericalCoords",value:function setFromSphericalCoords(e,t,a){var r=Math.sin(t)*e;this.x=r*Math.sin(a);this.y=Math.cos(t)*e;this.z=r*Math.cos(a);return this}},{key:"setFromCylindrical",value:function setFromCylindrical(e){return this.setFromCylindricalCoords(e.radius,e.theta,e.y)}},{key:"setFromCylindricalCoords",value:function setFromCylindricalCoords(e,t,a){this.x=e*Math.sin(t);this.y=a;this.z=e*Math.cos(t);return this}},{key:"setFromMatrixPosition",value:function setFromMatrixPosition(t){var a=t.elements;this.x=a[12];this.y=a[13];this.z=a[14];return this}},{key:"setFromMatrixScale",value:function setFromMatrixScale(e){var t=this.setFromMatrixColumn(e,0).length(),a=this.setFromMatrixColumn(e,1).length(),r=this.setFromMatrixColumn(e,2).length();this.x=t;this.y=a;this.z=r;return this}},{key:"setFromMatrixColumn",value:function setFromMatrixColumn(e,t){return this.fromArray(e.elements,4*t)}},{key:"setFromMatrix3Column",value:function setFromMatrix3Column(e,t){return this.fromArray(e.elements,3*t)}},{key:"equals",value:function(e){return e.x===this.x&&e.y===this.y&&e.z===this.z}},{key:"fromArray",value:function fromArray(e){var t=1<arguments.length&&arguments[1]!==void 0?arguments[1]:0;this.x=e[t];this.y=e[t+1];this.z=e[t+2];return this}},{key:"toArray",value:function toArray(){var e=0<arguments.length&&arguments[0]!==void 0?arguments[0]:[],t=1<arguments.length&&arguments[1]!==void 0?arguments[1]:0;e[t]=this.x;e[t+1]=this.y;e[t+2]=this.z;return e}},{key:"fromBufferAttribute",value:function fromBufferAttribute(e,t,a){if(a!==void 0){console.warn("THREE.Vector3: offset has been removed from .fromBufferAttribute().")}this.x=e.getX(t);this.y=e.getY(t);this.z=e.getZ(t);return this}},{key:"random",value:function random(){this.x=Math.random();this.y=Math.random();this.z=Math.random();return this}},{key:"randomDirection",value:function randomDirection(){var e=2*(Math.random()-.5),a=2*(Math.random()*Math.PI),t=Math.sqrt(1-Math.pow(e,2));this.x=t*Math.cos(a);this.y=t*Math.sin(a);this.z=e;return this}},{key:Symbol.iterator,value:regeneratorRuntime.mark(function value(){return regeneratorRuntime.wrap(function(e){while(1){switch(e.prev=e.next){case 0:e.next=2;return this.x;case 2:e.next=4;return this.y;case 4:e.next=6;return this.z;case 6:case"end":return e.stop();}}},value,this)})}]);return e}();vs.prototype.isVector3=!0;var _s=new vs,xs=new ys,bs=function(){function e(){var t=0<arguments.length&&arguments[0]!==void 0?arguments[0]:new vs(+Infinity,+Infinity,+Infinity),a=1<arguments.length&&arguments[1]!==void 0?arguments[1]:new vs(-Infinity,-Infinity,-Infinity);_classCallCheck2(this,e);this.min=t;this.max=a}_createClass2(e,[{key:"set",value:function set(e,t){this.min.copy(e);this.max.copy(t);return this}},{key:"setFromArray",value:function setFromArray(e){for(var t=+Infinity,a=+Infinity,r=+Infinity,i=-Infinity,n=-Infinity,o=-Infinity,s=0,d=e.length;s<d;s+=3){var l=e[s],c=e[s+1],u=e[s+2];if(l<t)t=l;if(c<a)a=c;if(u<r)r=u;if(l>i)i=l;if(c>n)n=c;if(u>o)o=u}this.min.set(t,a,r);this.max.set(i,n,o);return this}},{key:"setFromBufferAttribute",value:function setFromBufferAttribute(e){for(var t=+Infinity,a=+Infinity,r=+Infinity,i=-Infinity,n=-Infinity,o=-Infinity,s=0,d=e.count;s<d;s++){var l=e.getX(s),c=e.getY(s),u=e.getZ(s);if(l<t)t=l;if(c<a)a=c;if(u<r)r=u;if(l>i)i=l;if(c>n)n=c;if(u>o)o=u}this.min.set(t,a,r);this.max.set(i,n,o);return this}},{key:"setFromPoints",value:function setFromPoints(e){this.makeEmpty();for(var t=0,a=e.length;t<a;t++){this.expandByPoint(e[t])}return this}},{key:"setFromCenterAndSize",value:function setFromCenterAndSize(e,t){var a=Ms.copy(t).multiplyScalar(.5);this.min.copy(e).sub(a);this.max.copy(e).add(a);return this}},{key:"setFromObject",value:function setFromObject(e){this.makeEmpty();return this.expandByObject(e)}},{key:"clone",value:function clone(){return new this.constructor().copy(this)}},{key:"copy",value:function copy(e){this.min.copy(e.min);this.max.copy(e.max);return this}},{key:"makeEmpty",value:function makeEmpty(){this.min.x=this.min.y=this.min.z=+Infinity;this.max.x=this.max.y=this.max.z=-Infinity;return this}},{key:"isEmpty",value:function isEmpty(){return this.max.x<this.min.x||this.max.y<this.min.y||this.max.z<this.min.z}},{key:"getCenter",value:function getCenter(e){return this.isEmpty()?e.set(0,0,0):e.addVectors(this.min,this.max).multiplyScalar(.5)}},{key:"getSize",value:function getSize(e){return this.isEmpty()?e.set(0,0,0):e.subVectors(this.max,this.min)}},{key:"expandByPoint",value:function expandByPoint(e){this.min.min(e);this.max.max(e);return this}},{key:"expandByVector",value:function expandByVector(e){this.min.sub(e);this.max.add(e);return this}},{key:"expandByScalar",value:function expandByScalar(e){this.min.addScalar(-e);this.max.addScalar(e);return this}},{key:"expandByObject",value:function expandByObject(e){e.updateWorldMatrix(!1,!1);var t=e.geometry;if(t!==void 0){if(null===t.boundingBox){t.computeBoundingBox()}Ts.copy(t.boundingBox);Ts.applyMatrix4(e.matrixWorld);this.union(Ts)}for(var a=e.children,r=0,i=a.length;r<i;r++){this.expandByObject(a[r])}return this}},{key:"containsPoint",value:function containsPoint(e){return e.x<this.min.x||e.x>this.max.x||e.y<this.min.y||e.y>this.max.y||e.z<this.min.z||e.z>this.max.z?!1:!0}},{key:"containsBox",value:function containsBox(e){return this.min.x<=e.min.x&&e.max.x<=this.max.x&&this.min.y<=e.min.y&&e.max.y<=this.max.y&&this.min.z<=e.min.z&&e.max.z<=this.max.z}},{key:"getParameter",value:function getParameter(e,t){return t.set((e.x-this.min.x)/(this.max.x-this.min.x),(e.y-this.min.y)/(this.max.y-this.min.y),(e.z-this.min.z)/(this.max.z-this.min.z))}},{key:"intersectsBox",value:function intersectsBox(e){return e.max.x<this.min.x||e.min.x>this.max.x||e.max.y<this.min.y||e.min.y>this.max.y||e.max.z<this.min.z||e.min.z>this.max.z?!1:!0}},{key:"intersectsSphere",value:function intersectsSphere(e){this.clampPoint(e.center,Ms);return Ms.distanceToSquared(e.center)<=e.radius*e.radius}},{key:"intersectsPlane",value:function intersectsPlane(e){var t,a;if(0<e.normal.x){t=e.normal.x*this.min.x;a=e.normal.x*this.max.x}else{t=e.normal.x*this.max.x;a=e.normal.x*this.min.x}if(0<e.normal.y){t+=e.normal.y*this.min.y;a+=e.normal.y*this.max.y}else{t+=e.normal.y*this.max.y;a+=e.normal.y*this.min.y}if(0<e.normal.z){t+=e.normal.z*this.min.z;a+=e.normal.z*this.max.z}else{t+=e.normal.z*this.max.z;a+=e.normal.z*this.min.z}return t<=-e.constant&&a>=-e.constant}},{key:"intersectsTriangle",value:function intersectsTriangle(e){if(this.isEmpty()){return!1}this.getCenter(Ls);Ps.subVectors(this.max,Ls);Es.subVectors(e.a,Ls);ws.subVectors(e.b,Ls);As.subVectors(e.c,Ls);ks.subVectors(ws,Es);Cs.subVectors(As,ws);Rs.subVectors(Es,As);var t=[0,-ks.z,ks.y,0,-Cs.z,Cs.y,0,-Rs.z,Rs.y,ks.z,0,-ks.x,Cs.z,0,-Cs.x,Rs.z,0,-Rs.x,-ks.y,ks.x,0,-Cs.y,Cs.x,0,-Rs.y,Rs.x,0];if(!h(t,Es,ws,As,Ps)){return!1}t=[1,0,0,0,1,0,0,0,1];if(!h(t,Es,ws,As,Ps)){return!1}Is.crossVectors(ks,Cs);t=[Is.x,Is.y,Is.z];return h(t,Es,ws,As,Ps)}},{key:"clampPoint",value:function clampPoint(e,t){return t.copy(e).clamp(this.min,this.max)}},{key:"distanceToPoint",value:function distanceToPoint(e){var t=Ms.copy(e).clamp(this.min,this.max);return t.sub(e).length()}},{key:"getBoundingSphere",value:function getBoundingSphere(e){this.getCenter(e.center);e.radius=.5*this.getSize(Ms).length();return e}},{key:"intersect",value:function intersect(e){this.min.max(e.min);this.max.min(e.max);if(this.isEmpty())this.makeEmpty();return this}},{key:"union",value:function union(e){this.min.min(e.min);this.max.max(e.max);return this}},{key:"applyMatrix4",value:function applyMatrix4(e){if(this.isEmpty())return this;Ss[0].set(this.min.x,this.min.y,this.min.z).applyMatrix4(e);Ss[1].set(this.min.x,this.min.y,this.max.z).applyMatrix4(e);Ss[2].set(this.min.x,this.max.y,this.min.z).applyMatrix4(e);Ss[3].set(this.min.x,this.max.y,this.max.z).applyMatrix4(e);Ss[4].set(this.max.x,this.min.y,this.min.z).applyMatrix4(e);Ss[5].set(this.max.x,this.min.y,this.max.z).applyMatrix4(e);Ss[6].set(this.max.x,this.max.y,this.min.z).applyMatrix4(e);Ss[7].set(this.max.x,this.max.y,this.max.z).applyMatrix4(e);this.setFromPoints(Ss);return this}},{key:"translate",value:function translate(e){this.min.add(e);this.max.add(e);return this}},{key:"equals",value:function(e){return e.min.equals(this.min)&&e.max.equals(this.max)}}]);return e}();bs.prototype.isBox3=!0;var Ss=[new vs,new vs,new vs,new vs,new vs,new vs,new vs,new vs],Ms=new vs,Ts=new bs,Es=new vs,ws=new vs,As=new vs,ks=new vs,Cs=new vs,Rs=new vs,Ls=new vs,Ps=new vs,Is=new vs,Ds=new vs;function h(e,t,a,i,n){for(var d=0,c=e.length-3;d<=c;d+=3){Ds.fromArray(e,d);var o=n.x*Math.abs(Ds.x)+n.y*Math.abs(Ds.y)+n.z*Math.abs(Ds.z),r=t.dot(Ds),s=a.dot(Ds),l=i.dot(Ds);if(Math.max(-Math.max(r,s,l),Math.min(r,s,l))>o){return!1}}return!0}var zs=new bs,Ns=new vs,Fs=new vs,Os=new vs,Bs=function(){function e(){var t=0<arguments.length&&arguments[0]!==void 0?arguments[0]:new vs,a=1<arguments.length&&arguments[1]!==void 0?arguments[1]:-1;_classCallCheck2(this,e);this.center=t;this.radius=a}_createClass2(e,[{key:"set",value:function set(e,t){this.center.copy(e);this.radius=t;return this}},{key:"setFromPoints",value:function setFromPoints(e,t){var a=this.center;if(t!==void 0){a.copy(t)}else{zs.setFromPoints(e).getCenter(a)}for(var r=0,i=0,n=e.length;i<n;i++){r=Math.max(r,a.distanceToSquared(e[i]))}this.radius=Math.sqrt(r);return this}},{key:"copy",value:function copy(e){this.center.copy(e.center);this.radius=e.radius;return this}},{key:"isEmpty",value:function isEmpty(){return 0>this.radius}},{key:"makeEmpty",value:function makeEmpty(){this.center.set(0,0,0);this.radius=-1;return this}},{key:"containsPoint",value:function containsPoint(e){return e.distanceToSquared(this.center)<=this.radius*this.radius}},{key:"distanceToPoint",value:function distanceToPoint(e){return e.distanceTo(this.center)-this.radius}},{key:"intersectsSphere",value:function intersectsSphere(e){var t=this.radius+e.radius;return e.center.distanceToSquared(this.center)<=t*t}},{key:"intersectsBox",value:function intersectsBox(e){return e.intersectsSphere(this)}},{key:"intersectsPlane",value:function intersectsPlane(e){return Math.abs(e.distanceToPoint(this.center))<=this.radius}},{key:"clampPoint",value:function clampPoint(e,t){var a=this.center.distanceToSquared(e);t.copy(e);if(a>this.radius*this.radius){t.sub(this.center).normalize();t.multiplyScalar(this.radius).add(this.center)}return t}},{key:"getBoundingBox",value:function getBoundingBox(e){if(this.isEmpty()){e.makeEmpty();return e}e.set(this.center,this.center);e.expandByScalar(this.radius);return e}},{key:"applyMatrix4",value:function applyMatrix4(e){this.center.applyMatrix4(e);this.radius=this.radius*e.getMaxScaleOnAxis();return this}},{key:"translate",value:function translate(e){this.center.add(e);return this}},{key:"expandByPoint",value:function expandByPoint(e){Os.subVectors(e,this.center);var t=Os.lengthSq();if(t>this.radius*this.radius){var a=Math.sqrt(t),r=.5*(a-this.radius);this.center.add(Os.multiplyScalar(r/a));this.radius+=r}return this}},{key:"union",value:function union(e){Fs.subVectors(e.center,this.center).normalize().multiplyScalar(e.radius);this.expandByPoint(Ns.copy(e.center).add(Fs));this.expandByPoint(Ns.copy(e.center).sub(Fs));return this}},{key:"equals",value:function(e){return e.center.equals(this.center)&&e.radius===this.radius}},{key:"clone",value:function clone(){return new this.constructor().copy(this)}}]);return e}(),Us=new vs,Gs=new vs,Hs=new vs,Vs=new vs,Ws=new vs,js=new vs,qs=new vs,Xs=function(){function e(){var t=0<arguments.length&&arguments[0]!==void 0?arguments[0]:new vs,a=1<arguments.length&&arguments[1]!==void 0?arguments[1]:new vs(0,0,-1);_classCallCheck2(this,e);this.origin=t;this.direction=a}_createClass2(e,[{key:"set",value:function set(e,t){this.origin.copy(e);this.direction.copy(t);return this}},{key:"copy",value:function copy(e){this.origin.copy(e.origin);this.direction.copy(e.direction);return this}},{key:"at",value:function at(e,t){return t.copy(this.direction).multiplyScalar(e).add(this.origin)}},{key:"lookAt",value:function lookAt(e){this.direction.copy(e).sub(this.origin).normalize();return this}},{key:"recast",value:function recast(e){this.origin.copy(this.at(e,Us));return this}},{key:"closestPointToPoint",value:function closestPointToPoint(e,t){t.subVectors(e,this.origin);var a=t.dot(this.direction);if(0>a){return t.copy(this.origin)}return t.copy(this.direction).multiplyScalar(a).add(this.origin)}},{key:"distanceToPoint",value:function distanceToPoint(e){return Math.sqrt(this.distanceSqToPoint(e))}},{key:"distanceSqToPoint",value:function distanceSqToPoint(e){var t=Us.subVectors(e,this.origin).dot(this.direction);if(0>t){return this.origin.distanceToSquared(e)}Us.copy(this.direction).multiplyScalar(t).add(this.origin);return Us.distanceToSquared(e)}},{key:"distanceSqToSegment",value:function distanceSqToSegment(e,t,a,r){Gs.copy(e).add(t).multiplyScalar(.5);Hs.copy(t).sub(e).normalize();Vs.copy(this.origin).sub(Gs);var i=.5*e.distanceTo(t),n=-this.direction.dot(Hs),o=Vs.dot(this.direction),s=-Vs.dot(Hs),l=Vs.lengthSq(),d=Math.abs(1-n*n),c,u,p,m;if(0<d){c=n*s-o;u=n*o-s;m=i*d;if(0<=c){if(u>=-m){if(u<=m){var g=1/d;c*=g;u*=g;p=c*(c+n*u+2*o)+u*(n*c+u+2*s)+l}else{u=i;c=Math.max(0,-(n*u+o));p=-c*c+u*(u+2*s)+l}}else{u=-i;c=Math.max(0,-(n*u+o));p=-c*c+u*(u+2*s)+l}}else{if(u<=-m){c=Math.max(0,-(-n*i+o));u=0<c?-i:Math.min(Math.max(-i,-s),i);p=-c*c+u*(u+2*s)+l}else if(u<=m){c=0;u=Math.min(Math.max(-i,-s),i);p=u*(u+2*s)+l}else{c=Math.max(0,-(n*i+o));u=0<c?i:Math.min(Math.max(-i,-s),i);p=-c*c+u*(u+2*s)+l}}}else{u=0<n?-i:i;c=Math.max(0,-(n*u+o));p=-c*c+u*(u+2*s)+l}if(a){a.copy(this.direction).multiplyScalar(c).add(this.origin)}if(r){r.copy(Hs).multiplyScalar(u).add(Gs)}return p}},{key:"intersectSphere",value:function intersectSphere(e,t){Us.subVectors(e.center,this.origin);var a=Us.dot(this.direction),r=Us.dot(Us)-a*a,i=e.radius*e.radius;if(r>i)return null;var n=Math.sqrt(i-r),o=a-n,s=a+n;if(0>o&&0>s)return null;if(0>o)return this.at(s,t);return this.at(o,t)}},{key:"intersectsSphere",value:function intersectsSphere(e){return this.distanceSqToPoint(e.center)<=e.radius*e.radius}},{key:"distanceToPlane",value:function distanceToPlane(e){var a=e.normal.dot(this.direction);if(0===a){if(0===e.distanceToPoint(this.origin)){return 0}return null}var r=-(this.origin.dot(e.normal)+e.constant)/a;return 0<=r?r:null}},{key:"intersectPlane",value:function intersectPlane(e,a){var r=this.distanceToPlane(e);if(null===r){return null}return this.at(r,a)}},{key:"intersectsPlane",value:function intersectsPlane(e){var t=e.distanceToPoint(this.origin);if(0===t){return!0}var a=e.normal.dot(this.direction);if(0>a*t){return!0}return!1}},{key:"intersectBox",value:function intersectBox(e,t){var a,r,i,n,o,s,l=1/this.direction.x,d=1/this.direction.y,c=1/this.direction.z,u=this.origin;if(0<=l){a=(e.min.x-u.x)*l;r=(e.max.x-u.x)*l}else{a=(e.max.x-u.x)*l;r=(e.min.x-u.x)*l}if(0<=d){i=(e.min.y-u.y)*d;n=(e.max.y-u.y)*d}else{i=(e.max.y-u.y)*d;n=(e.min.y-u.y)*d}if(a>n||i>r)return null;if(i>a||a!==a)a=i;if(n<r||r!==r)r=n;if(0<=c){o=(e.min.z-u.z)*c;s=(e.max.z-u.z)*c}else{o=(e.max.z-u.z)*c;s=(e.min.z-u.z)*c}if(a>s||o>r)return null;if(o>a||a!==a)a=o;if(s<r||r!==r)r=s;if(0>r)return null;return this.at(0<=a?a:r,t)}},{key:"intersectsBox",value:function intersectsBox(e){return null!==this.intersectBox(e,Us)}},{key:"intersectTriangle",value:function intersectTriangle(e,t,a,r,i){Ws.subVectors(t,e);js.subVectors(a,e);qs.crossVectors(Ws,js);var n=this.direction.dot(qs),o;if(0<n){if(r)return null;o=1}else if(0>n){o=-1;n=-n}else{return null}Vs.subVectors(this.origin,e);var s=o*this.direction.dot(js.crossVectors(Vs,js));if(0>s){return null}var l=o*this.direction.dot(Ws.cross(Vs));if(0>l){return null}if(s+l>n){return null}var d=-o*Vs.dot(qs);if(0>d){return null}return this.at(d/n,i)}},{key:"applyMatrix4",value:function applyMatrix4(e){this.origin.applyMatrix4(e);this.direction.transformDirection(e);return this}},{key:"equals",value:function(e){return e.origin.equals(this.origin)&&e.direction.equals(this.direction)}},{key:"clone",value:function clone(){return new this.constructor().copy(this)}}]);return e}(),Ys=function(){function e(){_classCallCheck2(this,e);this.elements=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1];if(0<arguments.length){console.error("THREE.Matrix4: the constructor no longer reads arguments. use .set() instead.")}}_createClass2(e,[{key:"set",value:function set(e,t,a,r,i,n,o,s,l,d,c,u,p,m,g,f){var h=this.elements;h[0]=e;h[4]=t;h[8]=a;h[12]=r;h[1]=i;h[5]=n;h[9]=o;h[13]=s;h[2]=l;h[6]=d;h[10]=c;h[14]=u;h[3]=p;h[7]=m;h[11]=g;h[15]=f;return this}},{key:"identity",value:function identity(){this.set(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1);return this}},{key:"clone",value:function clone(){return new e().fromArray(this.elements)}},{key:"copy",value:function copy(e){var t=this.elements,a=e.elements;t[0]=a[0];t[1]=a[1];t[2]=a[2];t[3]=a[3];t[4]=a[4];t[5]=a[5];t[6]=a[6];t[7]=a[7];t[8]=a[8];t[9]=a[9];t[10]=a[10];t[11]=a[11];t[12]=a[12];t[13]=a[13];t[14]=a[14];t[15]=a[15];return this}},{key:"copyPosition",value:function copyPosition(e){var t=this.elements,a=e.elements;t[12]=a[12];t[13]=a[13];t[14]=a[14];return this}},{key:"setFromMatrix3",value:function setFromMatrix3(e){var t=e.elements;this.set(t[0],t[3],t[6],0,t[1],t[4],t[7],0,t[2],t[5],t[8],0,0,0,0,1);return this}},{key:"extractBasis",value:function extractBasis(e,t,a){e.setFromMatrixColumn(this,0);t.setFromMatrixColumn(this,1);a.setFromMatrixColumn(this,2);return this}},{key:"makeBasis",value:function makeBasis(e,t,a){this.set(e.x,t.x,a.x,0,e.y,t.y,a.y,0,e.z,t.z,a.z,0,0,0,0,1);return this}},{key:"extractRotation",value:function extractRotation(e){var t=this.elements,a=e.elements,r=1/Zs.setFromMatrixColumn(e,0).length(),i=1/Zs.setFromMatrixColumn(e,1).length(),n=1/Zs.setFromMatrixColumn(e,2).length();t[0]=a[0]*r;t[1]=a[1]*r;t[2]=a[2]*r;t[3]=0;t[4]=a[4]*i;t[5]=a[5]*i;t[6]=a[6]*i;t[7]=0;t[8]=a[8]*n;t[9]=a[9]*n;t[10]=a[10]*n;t[11]=0;t[12]=0;t[13]=0;t[14]=0;t[15]=1;return this}},{key:"makeRotationFromEuler",value:function makeRotationFromEuler(t){if(!(t&&t.isEuler)){console.error("THREE.Matrix4: .makeRotationFromEuler() now expects a Euler rotation rather than a Vector3 and order.")}var r=this.elements,i=t.x,n=t.y,o=t.z,s=Math.cos(i),a=Math.sin(i),l=Math.cos(n),c=Math.sin(n),d=Math.cos(o),e=Math.sin(o);if("XYZ"===t.order){var u=s*d,p=s*e,m=a*d,g=a*e;r[0]=l*d;r[4]=-l*e;r[8]=c;r[1]=p+m*c;r[5]=u-g*c;r[9]=-a*l;r[2]=g-u*c;r[6]=m+p*c;r[10]=s*l}else if("YXZ"===t.order){var f=l*d,h=l*e,y=c*d,v=c*e;r[0]=f+v*a;r[4]=y*a-h;r[8]=s*c;r[1]=s*e;r[5]=s*d;r[9]=-a;r[2]=h*a-y;r[6]=v+f*a;r[10]=s*l}else if("ZXY"===t.order){var _=l*d,x=l*e,b=c*d,S=c*e;r[0]=_-S*a;r[4]=-s*e;r[8]=b+x*a;r[1]=x+b*a;r[5]=s*d;r[9]=S-_*a;r[2]=-s*c;r[6]=a;r[10]=s*l}else if("ZYX"===t.order){var M=s*d,T=s*e,E=a*d,w=a*e;r[0]=l*d;r[4]=E*c-T;r[8]=M*c+w;r[1]=l*e;r[5]=w*c+M;r[9]=T*c-E;r[2]=-c;r[6]=a*l;r[10]=s*l}else if("YZX"===t.order){var A=s*l,k=s*c,C=a*l,R=a*c;r[0]=l*d;r[4]=R-A*e;r[8]=C*e+k;r[1]=e;r[5]=s*d;r[9]=-a*d;r[2]=-c*d;r[6]=k*e+C;r[10]=A-R*e}else if("XZY"===t.order){var L=s*l,P=s*c,I=a*l,D=a*c;r[0]=l*d;r[4]=-e;r[8]=c*d;r[1]=L*e+D;r[5]=s*d;r[9]=P*e-I;r[2]=I*e-P;r[6]=a*d;r[10]=D*e+L}r[3]=0;r[7]=0;r[11]=0;r[12]=0;r[13]=0;r[14]=0;r[15]=1;return this}},{key:"makeRotationFromQuaternion",value:function makeRotationFromQuaternion(e){return this.compose(Qs,e,Ks)}},{key:"lookAt",value:function lookAt(e,t,a){var r=this.elements;el.subVectors(e,t);if(0===el.lengthSq()){el.z=1}el.normalize();$s.crossVectors(a,el);if(0===$s.lengthSq()){if(1===Math.abs(a.z)){el.x+=1e-4}else{el.z+=1e-4}el.normalize();$s.crossVectors(a,el)}$s.normalize();b.crossVectors(el,$s);r[0]=$s.x;r[4]=b.x;r[8]=el.x;r[1]=$s.y;r[5]=b.y;r[9]=el.y;r[2]=$s.z;r[6]=b.z;r[10]=el.z;return this}},{key:"multiply",value:function multiply(e,t){if(t!==void 0){console.warn("THREE.Matrix4: .multiply() now only accepts one argument. Use .multiplyMatrices( a, b ) instead.");return this.multiplyMatrices(e,t)}return this.multiplyMatrices(this,e)}},{key:"premultiply",value:function premultiply(e){return this.multiplyMatrices(e,this)}},{key:"multiplyMatrices",value:function multiplyMatrices(e,t){var a=e.elements,r=t.elements,i=this.elements,n=a[0],o=a[4],s=a[8],l=a[12],d=a[1],c=a[5],u=a[9],p=a[13],m=a[2],g=a[6],f=a[10],h=a[14],y=a[3],v=a[7],_=a[11],x=a[15],b=r[0],S=r[4],M=r[8],T=r[12],E=r[1],w=r[5],A=r[9],k=r[13],C=r[2],R=r[6],L=r[10],P=r[14],I=r[3],D=r[7],z=r[11],N=r[15];i[0]=n*b+o*E+s*C+l*I;i[4]=n*S+o*w+s*R+l*D;i[8]=n*M+o*A+s*L+l*z;i[12]=n*T+o*k+s*P+l*N;i[1]=d*b+c*E+u*C+p*I;i[5]=d*S+c*w+u*R+p*D;i[9]=d*M+c*A+u*L+p*z;i[13]=d*T+c*k+u*P+p*N;i[2]=m*b+g*E+f*C+h*I;i[6]=m*S+g*w+f*R+h*D;i[10]=m*M+g*A+f*L+h*z;i[14]=m*T+g*k+f*P+h*N;i[3]=y*b+v*E+_*C+x*I;i[7]=y*S+v*w+_*R+x*D;i[11]=y*M+v*A+_*L+x*z;i[15]=y*T+v*k+_*P+x*N;return this}},{key:"multiplyScalar",value:function multiplyScalar(e){var t=this.elements;t[0]*=e;t[4]*=e;t[8]*=e;t[12]*=e;t[1]*=e;t[5]*=e;t[9]*=e;t[13]*=e;t[2]*=e;t[6]*=e;t[10]*=e;t[14]*=e;t[3]*=e;t[7]*=e;t[11]*=e;t[15]*=e;return this}},{key:"determinant",value:function determinant(){var e=this.elements,t=e[0],a=e[4],r=e[8],i=e[12],n=e[1],o=e[5],s=e[9],l=e[13],d=e[2],c=e[6],u=e[10],p=e[14],m=e[3],g=e[7],f=e[11],h=e[15];return m*(+i*s*c-r*l*c-i*o*u+a*l*u+r*o*p-a*s*p)+g*(+t*s*p-t*l*u+i*n*u-r*n*p+r*l*d-i*s*d)+f*(+t*l*c-t*o*p-i*n*c+a*n*p+i*o*d-a*l*d)+h*(-r*o*d-t*s*c+t*o*u+r*n*c-a*n*u+a*s*d)}},{key:"transpose",value:function transpose(){var e=this.elements,t;t=e[1];e[1]=e[4];e[4]=t;t=e[2];e[2]=e[8];e[8]=t;t=e[6];e[6]=e[9];e[9]=t;t=e[3];e[3]=e[12];e[12]=t;t=e[7];e[7]=e[13];e[13]=t;t=e[11];e[11]=e[14];e[14]=t;return this}},{key:"setPosition",value:function setPosition(e,t,a){var r=this.elements;if(e.isVector3){r[12]=e.x;r[13]=e.y;r[14]=e.z}else{r[12]=e;r[13]=t;r[14]=a}return this}},{key:"invert",value:function invert(){var e=this.elements,t=e[0],a=e[1],r=e[2],i=e[3],n=e[4],o=e[5],s=e[6],l=e[7],d=e[8],c=e[9],u=e[10],p=e[11],m=e[12],g=e[13],f=e[14],h=e[15],y=c*f*l-g*u*l+g*s*p-o*f*p-c*s*h+o*u*h,v=m*u*l-d*f*l-m*s*p+n*f*p+d*s*h-n*u*h,_=d*g*l-m*c*l+m*o*p-n*g*p-d*o*h+n*c*h,x=m*c*s-d*g*s-m*o*u+n*g*u+d*o*f-n*c*f,b=t*y+a*v+r*_+i*x;if(0===b)return this.set(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0);var S=1/b;e[0]=y*S;e[1]=(g*u*i-c*f*i-g*r*p+a*f*p+c*r*h-a*u*h)*S;e[2]=(o*f*i-g*s*i+g*r*l-a*f*l-o*r*h+a*s*h)*S;e[3]=(c*s*i-o*u*i-c*r*l+a*u*l+o*r*p-a*s*p)*S;e[4]=v*S;e[5]=(d*f*i-m*u*i+m*r*p-t*f*p-d*r*h+t*u*h)*S;e[6]=(m*s*i-n*f*i-m*r*l+t*f*l+n*r*h-t*s*h)*S;e[7]=(n*u*i-d*s*i+d*r*l-t*u*l-n*r*p+t*s*p)*S;e[8]=_*S;e[9]=(m*c*i-d*g*i-m*a*p+t*g*p+d*a*h-t*c*h)*S;e[10]=(n*g*i-m*o*i+m*a*l-t*g*l-n*a*h+t*o*h)*S;e[11]=(d*o*i-n*c*i-d*a*l+t*c*l+n*a*p-t*o*p)*S;e[12]=x*S;e[13]=(d*g*r-m*c*r+m*a*u-t*g*u-d*a*f+t*c*f)*S;e[14]=(m*o*r-n*g*r-m*a*s+t*g*s+n*a*f-t*o*f)*S;e[15]=(n*c*r-d*o*r+d*a*s-t*c*s-n*a*u+t*o*u)*S;return this}},{key:"scale",value:function scale(e){var t=this.elements,a=e.x,r=e.y,i=e.z;t[0]*=a;t[4]*=r;t[8]*=i;t[1]*=a;t[5]*=r;t[9]*=i;t[2]*=a;t[6]*=r;t[10]*=i;t[3]*=a;t[7]*=r;t[11]*=i;return this}},{key:"getMaxScaleOnAxis",value:function getMaxScaleOnAxis(){var e=this.elements,t=e[0]*e[0]+e[1]*e[1]+e[2]*e[2],a=e[4]*e[4]+e[5]*e[5]+e[6]*e[6],r=e[8]*e[8]+e[9]*e[9]+e[10]*e[10];return Math.sqrt(Math.max(t,a,r))}},{key:"makeTranslation",value:function makeTranslation(e,t,a){this.set(1,0,0,e,0,1,0,t,0,0,1,a,0,0,0,1);return this}},{key:"makeRotationX",value:function makeRotationX(e){var t=Math.cos(e),a=Math.sin(e);this.set(1,0,0,0,0,t,-a,0,0,a,t,0,0,0,0,1);return this}},{key:"makeRotationY",value:function makeRotationY(e){var t=Math.cos(e),a=Math.sin(e);this.set(t,0,a,0,0,1,0,0,-a,0,t,0,0,0,0,1);return this}},{key:"makeRotationZ",value:function makeRotationZ(e){var t=Math.cos(e),a=Math.sin(e);this.set(t,-a,0,0,a,t,0,0,0,0,1,0,0,0,0,1);return this}},{key:"makeRotationAxis",value:function makeRotationAxis(e,a){var r=Math.cos(a),i=Math.sin(a),n=1-r,t=e.x,o=e.y,s=e.z,l=n*t,d=n*o;this.set(l*t+r,l*o-i*s,l*s+i*o,0,l*o+i*s,d*o+r,d*s-i*t,0,l*s-i*o,d*s+i*t,n*s*s+r,0,0,0,0,1);return this}},{key:"makeScale",value:function makeScale(e,t,a){this.set(e,0,0,0,0,t,0,0,0,0,a,0,0,0,0,1);return this}},{key:"makeShear",value:function makeShear(e,t,a,r,i,n){this.set(1,a,i,0,e,1,n,0,t,r,1,0,0,0,0,1);return this}},{key:"compose",value:function compose(e,t,a){var r=this.elements,i=t._x,n=t._y,o=t._z,s=t._w,l=i+i,d=n+n,c=o+o,u=i*l,p=i*d,m=i*c,g=n*d,f=n*c,h=o*c,y=s*l,v=s*d,_=s*c,x=a.x,b=a.y,S=a.z;r[0]=(1-(g+h))*x;r[1]=(p+_)*x;r[2]=(m-v)*x;r[3]=0;r[4]=(p-_)*b;r[5]=(1-(u+h))*b;r[6]=(f+y)*b;r[7]=0;r[8]=(m+v)*S;r[9]=(f-y)*S;r[10]=(1-(u+g))*S;r[11]=0;r[12]=e.x;r[13]=e.y;r[14]=e.z;r[15]=1;return this}},{key:"decompose",value:function decompose(e,t,a){var r=this.elements,i=Zs.set(r[0],r[1],r[2]).length(),n=Zs.set(r[4],r[5],r[6]).length(),o=Zs.set(r[8],r[9],r[10]).length(),s=this.determinant();if(0>s)i=-i;e.x=r[12];e.y=r[13];e.z=r[14];Js.copy(this);var l=1/i,d=1/n,c=1/o;Js.elements[0]*=l;Js.elements[1]*=l;Js.elements[2]*=l;Js.elements[4]*=d;Js.elements[5]*=d;Js.elements[6]*=d;Js.elements[8]*=c;Js.elements[9]*=c;Js.elements[10]*=c;t.setFromRotationMatrix(Js);a.x=i;a.y=n;a.z=o;return this}},{key:"makePerspective",value:function makePerspective(e,t,a,r,i,n){if(n===void 0){console.warn("THREE.Matrix4: .makePerspective() has been redefined and has a new signature. Please check the docs.")}var o=this.elements;o[0]=2*i/(t-e);o[4]=0;o[8]=(t+e)/(t-e);o[12]=0;o[1]=0;o[5]=2*i/(a-r);o[9]=(a+r)/(a-r);o[13]=0;o[2]=0;o[6]=0;o[10]=-(n+i)/(n-i);o[14]=-2*n*i/(n-i);o[3]=0;o[7]=0;o[11]=-1;o[15]=0;return this}},{key:"makeOrthographic",value:function makeOrthographic(e,t,a,r,i,n){var o=this.elements,s=1/(t-e),l=1/(a-r),d=1/(n-i);o[0]=2*s;o[4]=0;o[8]=0;o[12]=-((t+e)*s);o[1]=0;o[5]=2*l;o[9]=0;o[13]=-((a+r)*l);o[2]=0;o[6]=0;o[10]=-2*d;o[14]=-((n+i)*d);o[3]=0;o[7]=0;o[11]=0;o[15]=1;return this}},{key:"equals",value:function(e){for(var t=this.elements,a=e.elements,r=0;16>r;r++){if(t[r]!==a[r])return!1}return!0}},{key:"fromArray",value:function fromArray(e){for(var t=1<arguments.length&&arguments[1]!==void 0?arguments[1]:0,a=0;16>a;a++){this.elements[a]=e[a+t]}return this}},{key:"toArray",value:function toArray(){var e=0<arguments.length&&arguments[0]!==void 0?arguments[0]:[],t=1<arguments.length&&arguments[1]!==void 0?arguments[1]:0,a=this.elements;e[t]=a[0];e[t+1]=a[1];e[t+2]=a[2];e[t+3]=a[3];e[t+4]=a[4];e[t+5]=a[5];e[t+6]=a[6];e[t+7]=a[7];e[t+8]=a[8];e[t+9]=a[9];e[t+10]=a[10];e[t+11]=a[11];e[t+12]=a[12];e[t+13]=a[13];e[t+14]=a[14];e[t+15]=a[15];return e}}]);return e}();Ys.prototype.isMatrix4=!0;var Zs=new vs,Js=new Ys,Qs=new vs(0,0,0),Ks=new vs(1,1,1),$s=new vs,b=new vs,el=new vs,tl=new Ys,al=new ys,rl=function(){function e(){var t=0<arguments.length&&arguments[0]!==void 0?arguments[0]:0,a=1<arguments.length&&arguments[1]!==void 0?arguments[1]:0,r=2<arguments.length&&arguments[2]!==void 0?arguments[2]:0,i=3<arguments.length&&arguments[3]!==void 0?arguments[3]:e.DefaultOrder;_classCallCheck2(this,e);this._x=t;this._y=a;this._z=r;this._order=i}_createClass2(e,[{key:"set",value:function set(e,t,a){var r=3<arguments.length&&arguments[3]!==void 0?arguments[3]:this._order;this._x=e;this._y=t;this._z=a;this._order=r;this._onChangeCallback();return this}},{key:"clone",value:function clone(){return new this.constructor(this._x,this._y,this._z,this._order)}},{key:"copy",value:function copy(e){this._x=e._x;this._y=e._y;this._z=e._z;this._order=e._order;this._onChangeCallback();return this}},{key:"setFromRotationMatrix",value:function setFromRotationMatrix(e){var t=1<arguments.length&&arguments[1]!==void 0?arguments[1]:this._order,r=2<arguments.length&&arguments[2]!==void 0?arguments[2]:!0,i=e.elements,n=i[0],o=i[4],s=i[8],l=i[1],d=i[5],c=i[9],u=i[2],p=i[6],m=i[10];switch(t){case"XYZ":this._y=Math.asin(a(s,-1,1));if(.9999999>Math.abs(s)){this._x=Math.atan2(-c,m);this._z=Math.atan2(-o,n)}else{this._x=Math.atan2(p,d);this._z=0}break;case"YXZ":this._x=Math.asin(-a(c,-1,1));if(.9999999>Math.abs(c)){this._y=Math.atan2(s,m);this._z=Math.atan2(l,d)}else{this._y=Math.atan2(-u,n);this._z=0}break;case"ZXY":this._x=Math.asin(a(p,-1,1));if(.9999999>Math.abs(p)){this._y=Math.atan2(-u,m);this._z=Math.atan2(-o,d)}else{this._y=0;this._z=Math.atan2(l,n)}break;case"ZYX":this._y=Math.asin(-a(u,-1,1));if(.9999999>Math.abs(u)){this._x=Math.atan2(p,m);this._z=Math.atan2(l,n)}else{this._x=0;this._z=Math.atan2(-o,d)}break;case"YZX":this._z=Math.asin(a(l,-1,1));if(.9999999>Math.abs(l)){this._x=Math.atan2(-c,d);this._y=Math.atan2(-u,n)}else{this._x=0;this._y=Math.atan2(s,m)}break;case"XZY":this._z=Math.asin(-a(o,-1,1));if(.9999999>Math.abs(o)){this._x=Math.atan2(p,d);this._y=Math.atan2(s,n)}else{this._x=Math.atan2(-c,m);this._y=0}break;default:console.warn("THREE.Euler: .setFromRotationMatrix() encountered an unknown order: "+t);}this._order=t;if(!0===r)this._onChangeCallback();return this}},{key:"setFromQuaternion",value:function setFromQuaternion(e,t,a){tl.makeRotationFromQuaternion(e);return this.setFromRotationMatrix(tl,t,a)}},{key:"setFromVector3",value:function setFromVector3(e){var t=1<arguments.length&&arguments[1]!==void 0?arguments[1]:this._order;return this.set(e.x,e.y,e.z,t)}},{key:"reorder",value:function reorder(e){al.setFromEuler(this);return this.setFromQuaternion(al,e)}},{key:"equals",value:function(e){return e._x===this._x&&e._y===this._y&&e._z===this._z&&e._order===this._order}},{key:"fromArray",value:function fromArray(e){this._x=e[0];this._y=e[1];this._z=e[2];if(e[3]!==void 0)this._order=e[3];this._onChangeCallback();return this}},{key:"toArray",value:function toArray(){var e=0<arguments.length&&arguments[0]!==void 0?arguments[0]:[],t=1<arguments.length&&arguments[1]!==void 0?arguments[1]:0;e[t]=this._x;e[t+1]=this._y;e[t+2]=this._z;e[t+3]=this._order;return e}},{key:"toVector3",value:function toVector3(e){if(e){return e.set(this._x,this._y,this._z)}else{return new vs(this._x,this._y,this._z)}}},{key:"_onChange",value:function _onChange(e){this._onChangeCallback=e;return this}},{key:"_onChangeCallback",value:function _onChangeCallback(){}},{key:"x",get:function get(){return this._x},set:function set(e){this._x=e;this._onChangeCallback()}},{key:"y",get:function get(){return this._y},set:function set(e){this._y=e;this._onChangeCallback()}},{key:"z",get:function get(){return this._z},set:function set(e){this._z=e;this._onChangeCallback()}},{key:"order",get:function get(){return this._order},set:function set(e){this._order=e;this._onChangeCallback()}}]);return e}();rl.prototype.isEuler=!0;rl.DefaultOrder="XYZ";rl.RotationOrders=["XYZ","YZX","ZXY","XZY","YXZ","ZYX"];var il=function(){function e(){_classCallCheck2(this,e);this.mask=1}_createClass2(e,[{key:"set",value:function set(e){this.mask=(0|1<<e)>>>0}},{key:"enable",value:function enable(e){this.mask|=0|1<<e}},{key:"enableAll",value:function enableAll(){this.mask=-1}},{key:"toggle",value:function toggle(e){this.mask^=0|1<<e}},{key:"disable",value:function disable(e){this.mask&=~(0|1<<e)}},{key:"disableAll",value:function disableAll(){this.mask=0}},{key:"test",value:function test(e){return 0!=(this.mask&e.mask)}},{key:"isEnabled",value:function isEnabled(e){return 0!=(this.mask&(0|1<<e))}}]);return e}(),nl=0,ol=new vs,sl=new ys,ll=new Ys,dl=new vs,cl=new vs,ul=new vs,pl=new ys,ml=new vs(1,0,0),gl=new vs(0,1,0),fl=new vs(0,0,1),hl={type:"added"},yl={type:"removed"},vl=function(e){_inherits(a,e);var r=_createSuper(a);function a(){var e;_classCallCheck2(this,a);e=r.call(this);Object.defineProperty(_assertThisInitialized(e),"id",{value:nl++});e.uuid=t();e.name="";e.type="Object3D";e.parent=null;e.children=[];e.up=a.DefaultUp.clone();var i=new vs,n=new rl,o=new ys,s=new vs(1,1,1);n._onChange(function(){o.setFromEuler(n,!1)});o._onChange(function(){n.setFromQuaternion(o,void 0,!1)});Object.defineProperties(_assertThisInitialized(e),{position:{configurable:!0,enumerable:!0,value:i},rotation:{configurable:!0,enumerable:!0,value:n},quaternion:{configurable:!0,enumerable:!0,value:o},scale:{configurable:!0,enumerable:!0,value:s},modelViewMatrix:{value:new Ys},normalMatrix:{value:new ss}});e.matrix=new Ys;e.matrixWorld=new Ys;e.matrixAutoUpdate=a.DefaultMatrixAutoUpdate;e.matrixWorldNeedsUpdate=!1;e.layers=new il;e.visible=!0;e.castShadow=!1;e.receiveShadow=!1;e.frustumCulled=!0;e.renderOrder=0;e.animations=[];e.userData={};return e}_createClass2(a,[{key:"onBeforeRender",value:function onBeforeRender(){}},{key:"onAfterRender",value:function onAfterRender(){}},{key:"applyMatrix4",value:function applyMatrix4(e){if(this.matrixAutoUpdate)this.updateMatrix();this.matrix.premultiply(e);this.matrix.decompose(this.position,this.quaternion,this.scale)}},{key:"applyQuaternion",value:function applyQuaternion(e){this.quaternion.premultiply(e);return this}},{key:"setRotationFromAxisAngle",value:function setRotationFromAxisAngle(e,t){this.quaternion.setFromAxisAngle(e,t)}},{key:"setRotationFromEuler",value:function setRotationFromEuler(e){this.quaternion.setFromEuler(e,!0)}},{key:"setRotationFromMatrix",value:function setRotationFromMatrix(e){this.quaternion.setFromRotationMatrix(e)}},{key:"setRotationFromQuaternion",value:function setRotationFromQuaternion(e){this.quaternion.copy(e)}},{key:"rotateOnAxis",value:function rotateOnAxis(e,t){sl.setFromAxisAngle(e,t);this.quaternion.multiply(sl);return this}},{key:"rotateOnWorldAxis",value:function rotateOnWorldAxis(e,t){sl.setFromAxisAngle(e,t);this.quaternion.premultiply(sl);return this}},{key:"rotateX",value:function rotateX(e){return this.rotateOnAxis(ml,e)}},{key:"rotateY",value:function rotateY(e){return this.rotateOnAxis(gl,e)}},{key:"rotateZ",value:function rotateZ(e){return this.rotateOnAxis(fl,e)}},{key:"translateOnAxis",value:function translateOnAxis(e,t){ol.copy(e).applyQuaternion(this.quaternion);this.position.add(ol.multiplyScalar(t));return this}},{key:"translateX",value:function translateX(e){return this.translateOnAxis(ml,e)}},{key:"translateY",value:function translateY(e){return this.translateOnAxis(gl,e)}},{key:"translateZ",value:function translateZ(e){return this.translateOnAxis(fl,e)}},{key:"localToWorld",value:function localToWorld(e){return e.applyMatrix4(this.matrixWorld)}},{key:"worldToLocal",value:function worldToLocal(e){return e.applyMatrix4(ll.copy(this.matrixWorld).invert())}},{key:"lookAt",value:function lookAt(e,t,a){if(e.isVector3){dl.copy(e)}else{dl.set(e,t,a)}var r=this.parent;this.updateWorldMatrix(!0,!1);cl.setFromMatrixPosition(this.matrixWorld);if(this.isCamera||this.isLight){ll.lookAt(cl,dl,this.up)}else{ll.lookAt(dl,cl,this.up)}this.quaternion.setFromRotationMatrix(ll);if(r){ll.extractRotation(r.matrixWorld);sl.setFromRotationMatrix(ll);this.quaternion.premultiply(sl.invert())}}},{key:"add",value:function add(e){if(1<arguments.length){for(var t=0;t<arguments.length;t++){this.add(arguments[t])}return this}if(e===this){console.error("THREE.Object3D.add: object can't be added as a child of itself.",e);return this}if(e&&e.isObject3D){if(null!==e.parent){e.parent.remove(e)}e.parent=this;this.children.push(e);e.dispatchEvent(hl)}else{console.error("THREE.Object3D.add: object not an instance of THREE.Object3D.",e)}return this}},{key:"remove",value:function remove(e){if(1<arguments.length){for(var a=0;a<arguments.length;a++){this.remove(arguments[a])}return this}var t=this.children.indexOf(e);if(-1!==t){e.parent=null;this.children.splice(t,1);e.dispatchEvent(yl)}return this}},{key:"removeFromParent",value:function removeFromParent(){var e=this.parent;if(null!==e){e.remove(this)}return this}},{key:"clear",value:function clear(){for(var e=0,t;e<this.children.length;e++){t=this.children[e];t.parent=null;t.dispatchEvent(yl)}this.children.length=0;return this}},{key:"attach",value:function attach(e){this.updateWorldMatrix(!0,!1);ll.copy(this.matrixWorld).invert();if(null!==e.parent){e.parent.updateWorldMatrix(!0,!1);ll.multiply(e.parent.matrixWorld)}e.applyMatrix4(ll);this.add(e);e.updateWorldMatrix(!1,!0);return this}},{key:"getObjectById",value:function getObjectById(e){return this.getObjectByProperty("id",e)}},{key:"getObjectByName",value:function getObjectByName(e){return this.getObjectByProperty("name",e)}},{key:"getObjectByProperty",value:function getObjectByProperty(e,t){if(this[e]===t)return this;for(var i=0,n=this.children.length;i<n;i++){var a=this.children[i],r=a.getObjectByProperty(e,t);if(r!==void 0){return r}}}},{key:"getWorldPosition",value:function getWorldPosition(e){this.updateWorldMatrix(!0,!1);return e.setFromMatrixPosition(this.matrixWorld)}},{key:"getWorldQuaternion",value:function getWorldQuaternion(e){this.updateWorldMatrix(!0,!1);this.matrixWorld.decompose(cl,e,ul);return e}},{key:"getWorldScale",value:function getWorldScale(e){this.updateWorldMatrix(!0,!1);this.matrixWorld.decompose(cl,pl,e);return e}},{key:"getWorldDirection",value:function getWorldDirection(t){this.updateWorldMatrix(!0,!1);var a=this.matrixWorld.elements;return t.set(a[8],a[9],a[10]).normalize()}},{key:"raycast",value:function raycast(){}},{key:"traverse",value:function traverse(e){e(this);for(var t=this.children,a=0,r=t.length;a<r;a++){t[a].traverse(e)}}},{key:"traverseVisible",value:function traverseVisible(e){if(!1===this.visible)return;e(this);for(var t=this.children,a=0,r=t.length;a<r;a++){t[a].traverseVisible(e)}}},{key:"traverseAncestors",value:function traverseAncestors(e){var t=this.parent;if(null!==t){e(t);t.traverseAncestors(e)}}},{key:"updateMatrix",value:function updateMatrix(){this.matrix.compose(this.position,this.quaternion,this.scale);this.matrixWorldNeedsUpdate=!0}},{key:"updateMatrixWorld",value:function updateMatrixWorld(e){if(this.matrixAutoUpdate)this.updateMatrix();if(this.matrixWorldNeedsUpdate||e){if(null===this.parent){this.matrixWorld.copy(this.matrix)}else{this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix)}this.matrixWorldNeedsUpdate=!1;e=!0}for(var t=this.children,a=0,r=t.length;a<r;a++){t[a].updateMatrixWorld(e)}}},{key:"updateWorldMatrix",value:function updateWorldMatrix(e,t){var a=this.parent;if(!0===e&&null!==a){a.updateWorldMatrix(!0,!1)}if(this.matrixAutoUpdate)this.updateMatrix();if(null===this.parent){this.matrixWorld.copy(this.matrix)}else{this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix)}if(!0===t){for(var r=this.children,i=0,n=r.length;i<n;i++){r[i].updateWorldMatrix(!1,!0)}}}},{key:"toJSON",value:function toJSON(e){var r=e===void 0||"string"==typeof e,i={};if(r){e={geometries:{},materials:{},textures:{},images:{},shapes:{},skeletons:{},animations:{}};i.metadata={version:4.5,type:"Object",generator:"Object3D.toJSON"}}var n={uuid:this.uuid,type:this.type};if(""!==this.name)n.name=this.name;if(!0===this.castShadow)n.castShadow=!0;if(!0===this.receiveShadow)n.receiveShadow=!0;if(!1===this.visible)n.visible=!1;if(!1===this.frustumCulled)n.frustumCulled=!1;if(0!==this.renderOrder)n.renderOrder=this.renderOrder;if("{}"!==JSON.stringify(this.userData))n.userData=this.userData;n.layers=this.layers.mask;n.matrix=this.matrix.toArray();if(!1===this.matrixAutoUpdate)n.matrixAutoUpdate=!1;if(this.isInstancedMesh){n.type="InstancedMesh";n.count=this.count;n.instanceMatrix=this.instanceMatrix.toJSON();if(null!==this.instanceColor)n.instanceColor=this.instanceColor.toJSON()}function t(t,a){if(t[a.uuid]===void 0){t[a.uuid]=a.toJSON(e)}return a.uuid}if(this.isScene){if(this.background){if(this.background.isColor){n.background=this.background.toJSON()}else if(this.background.isTexture){n.background=this.background.toJSON(e).uuid}}if(this.environment&&this.environment.isTexture){n.environment=this.environment.toJSON(e).uuid}}else if(this.isMesh||this.isLine||this.isPoints){n.geometry=t(e.geometries,this.geometry);var y=this.geometry.parameters;if(y!==void 0&&y.shapes!==void 0){var v=y.shapes;if(Array.isArray(v)){for(var _=0,x=v.length,l;_<x;_++){l=v[_];t(e.shapes,l)}}else{t(e.shapes,v)}}}if(this.isSkinnedMesh){n.bindMode=this.bindMode;n.bindMatrix=this.bindMatrix.toArray();if(this.skeleton!==void 0){t(e.skeletons,this.skeleton);n.skeleton=this.skeleton.uuid}}if(this.material!==void 0){if(Array.isArray(this.material)){for(var o=[],s=0,d=this.material.length;s<d;s++){o.push(t(e.materials,this.material[s]))}n.material=o}else{n.material=t(e.materials,this.material)}}if(0<this.children.length){n.children=[];for(var b=0;b<this.children.length;b++){n.children.push(this.children[b].toJSON(e).object)}}if(0<this.animations.length){n.animations=[];for(var S=0,M;S<this.animations.length;S++){M=this.animations[S];n.animations.push(t(e.animations,M))}}if(r){var c=a(e.geometries),u=a(e.materials),p=a(e.textures),m=a(e.images),g=a(e.shapes),f=a(e.skeletons),h=a(e.animations);if(0<c.length)i.geometries=c;if(0<u.length)i.materials=u;if(0<p.length)i.textures=p;if(0<m.length)i.images=m;if(0<g.length)i.shapes=g;if(0<f.length)i.skeletons=f;if(0<h.length)i.animations=h}i.object=n;return i;function a(e){var t=[];for(var a in e){var r=e[a];delete r.metadata;t.push(r)}return t}}},{key:"clone",value:function clone(e){return new this.constructor().copy(this,e)}},{key:"copy",value:function copy(e){var t=1<arguments.length&&arguments[1]!==void 0?arguments[1]:!0;this.name=e.name;this.up.copy(e.up);this.position.copy(e.position);this.rotation.order=e.rotation.order;this.quaternion.copy(e.quaternion);this.scale.copy(e.scale);this.matrix.copy(e.matrix);this.matrixWorld.copy(e.matrixWorld);this.matrixAutoUpdate=e.matrixAutoUpdate;this.matrixWorldNeedsUpdate=e.matrixWorldNeedsUpdate;this.layers.mask=e.layers.mask;this.visible=e.visible;this.castShadow=e.castShadow;this.receiveShadow=e.receiveShadow;this.frustumCulled=e.frustumCulled;this.renderOrder=e.renderOrder;this.userData=JSON.parse(JSON.stringify(e.userData));if(!0===t){for(var a=0,r;a<e.children.length;a++){r=e.children[a];this.add(r.clone())}}return this}}]);return a}(es);vl.DefaultUp=new vs(0,1,0);vl.DefaultMatrixAutoUpdate=!0;vl.prototype.isObject3D=!0;var _l=new vs,xl=new vs,bl=new vs,Sl=new vs,Ml=new vs,Tl=new vs,El=new vs,wl=new vs,Al=new vs,kl=new vs,Cl=function(){function e(){var t=0<arguments.length&&arguments[0]!==void 0?arguments[0]:new vs,a=1<arguments.length&&arguments[1]!==void 0?arguments[1]:new vs,r=2<arguments.length&&arguments[2]!==void 0?arguments[2]:new vs;_classCallCheck2(this,e);this.a=t;this.b=a;this.c=r}_createClass2(e,[{key:"set",value:function set(e,t,a){this.a.copy(e);this.b.copy(t);this.c.copy(a);return this}},{key:"setFromPointsAndIndices",value:function setFromPointsAndIndices(e,t,a,r){this.a.copy(e[t]);this.b.copy(e[a]);this.c.copy(e[r]);return this}},{key:"setFromAttributeAndIndices",value:function setFromAttributeAndIndices(e,t,a,r){this.a.fromBufferAttribute(e,t);this.b.fromBufferAttribute(e,a);this.c.fromBufferAttribute(e,r);return this}},{key:"clone",value:function clone(){return new this.constructor().copy(this)}},{key:"copy",value:function copy(e){this.a.copy(e.a);this.b.copy(e.b);this.c.copy(e.c);return this}},{key:"getArea",value:function getArea(){_l.subVectors(this.c,this.b);xl.subVectors(this.a,this.b);return .5*_l.cross(xl).length()}},{key:"getMidpoint",value:function getMidpoint(e){return e.addVectors(this.a,this.b).add(this.c).multiplyScalar(1/3)}},{key:"getNormal",value:function getNormal(t){return e.getNormal(this.a,this.b,this.c,t)}},{key:"getPlane",value:function getPlane(e){return e.setFromCoplanarPoints(this.a,this.b,this.c)}},{key:"getBarycoord",value:function getBarycoord(t,a){return e.getBarycoord(t,this.a,this.b,this.c,a)}},{key:"getUV",value:function getUV(t,a,r,i,n){return e.getUV(t,this.a,this.b,this.c,a,r,i,n)}},{key:"containsPoint",value:function containsPoint(t){return e.containsPoint(t,this.a,this.b,this.c)}},{key:"isFrontFacing",value:function isFrontFacing(t){return e.isFrontFacing(this.a,this.b,this.c,t)}},{key:"intersectsBox",value:function intersectsBox(e){return e.intersectsTriangle(this)}},{key:"closestPointToPoint",value:function closestPointToPoint(e,t){var r=this.a,a=this.b,i=this.c,n,o;Ml.subVectors(a,r);Tl.subVectors(i,r);wl.subVectors(e,r);var s=Ml.dot(wl),l=Tl.dot(wl);if(0>=s&&0>=l){return t.copy(r)}Al.subVectors(e,a);var d=Ml.dot(Al),c=Tl.dot(Al);if(0<=d&&c<=d){return t.copy(a)}var u=s*c-d*l;if(0>=u&&0<=s&&0>=d){n=s/(s-d);return t.copy(r).addScaledVector(Ml,n)}kl.subVectors(e,i);var p=Ml.dot(kl),m=Tl.dot(kl);if(0<=m&&p<=m){return t.copy(i)}var g=p*l-s*m;if(0>=g&&0<=l&&0>=m){o=l/(l-m);return t.copy(r).addScaledVector(Tl,o)}var f=d*m-p*c;if(0>=f&&0<=c-d&&0<=p-m){El.subVectors(i,a);o=(c-d)/(c-d+(p-m));return t.copy(a).addScaledVector(El,o)}var h=1/(f+g+u);n=g*h;o=u*h;return t.copy(r).addScaledVector(Ml,n).addScaledVector(Tl,o)}},{key:"equals",value:function(e){return e.a.equals(this.a)&&e.b.equals(this.b)&&e.c.equals(this.c)}}],[{key:"getNormal",value:function getNormal(e,t,a,r){r.subVectors(a,t);_l.subVectors(e,t);r.cross(_l);var i=r.lengthSq();if(0<i){return r.multiplyScalar(1/Math.sqrt(i))}return r.set(0,0,0)}},{key:"getBarycoord",value:function getBarycoord(e,t,a,r,i){_l.subVectors(r,t);xl.subVectors(a,t);bl.subVectors(e,t);var n=_l.dot(_l),o=_l.dot(xl),s=_l.dot(bl),l=xl.dot(xl),d=xl.dot(bl),c=n*l-o*o;if(0===c){return i.set(-2,-1,-1)}var p=1/c,m=(l*s-o*d)*p,u=(n*d-o*s)*p;return i.set(1-m-u,u,m)}},{key:"containsPoint",value:function containsPoint(e,t,a,r){this.getBarycoord(e,t,a,r,Sl);return 0<=Sl.x&&0<=Sl.y&&1>=Sl.x+Sl.y}},{key:"getUV",value:function getUV(e,t,a,r,i,n,o,s){this.getBarycoord(e,t,a,r,Sl);s.set(0,0);s.addScaledVector(i,Sl.x);s.addScaledVector(n,Sl.y);s.addScaledVector(o,Sl.z);return s}},{key:"isFrontFacing",value:function isFrontFacing(e,t,a,r){_l.subVectors(a,t);xl.subVectors(e,t);return 0>_l.cross(xl).dot(r)?!0:!1}}]);return e}(),Rl=0,Ll=function(e){_inherits(a,e);var r=_createSuper(a);function a(){var e;_classCallCheck2(this,a);e=r.call(this);Object.defineProperty(_assertThisInitialized(e),"id",{value:Rl++});e.uuid=t();e.name="";e.type="Material";e.fog=!0;e.blending=Or;e.side=Pr;e.vertexColors=!1;e.opacity=1;e.format=an;e.transparent=!1;e.blendSrc=Kr;e.blendDst=$r;e.blendEquation=Vr;e.blendSrcAlpha=null;e.blendDstAlpha=null;e.blendEquationAlpha=null;e.depthFunc=li;e.depthTest=!0;e.depthWrite=!0;e.stencilWriteMask=255;e.stencilFunc=Ho;e.stencilRef=0;e.stencilFuncMask=255;e.stencilFail=ko;e.stencilZFail=ko;e.stencilZPass=ko;e.stencilWrite=!1;e.clippingPlanes=null;e.clipIntersection=!1;e.clipShadows=!1;e.shadowSide=null;e.colorWrite=!0;e.precision=null;e.polygonOffset=!1;e.polygonOffsetFactor=0;e.polygonOffsetUnits=0;e.dithering=!1;e.alphaToCoverage=!1;e.premultipliedAlpha=!1;e.visible=!0;e.toneMapped=!0;e.userData={};e.version=0;e._alphaTest=0;return e}_createClass2(a,[{key:"onBuild",value:function onBuild(){}},{key:"onBeforeRender",value:function onBeforeRender(){}},{key:"onBeforeCompile",value:function onBeforeCompile(){}},{key:"customProgramCacheKey",value:function customProgramCacheKey(){return this.onBeforeCompile.toString()}},{key:"setValues",value:function setValues(e){if(e===void 0)return;for(var t in e){var a=e[t];if(a===void 0){console.warn("THREE.Material: '"+t+"' parameter is undefined.");continue}if("shading"==t){console.warn("THREE."+this.type+": .shading has been removed. Use the boolean .flatShading instead.");this.flatShading=a===zr?!0:!1;continue}var r=this[t];if(r===void 0){console.warn("THREE."+this.type+": '"+t+"' is not a property of this material.");continue}if(r&&r.isColor){r.set(a)}else if(r&&r.isVector3&&a&&a.isVector3){r.copy(a)}else{this[t]=a}}}},{key:"toJSON",value:function toJSON(e){var a=e===void 0||"string"==typeof e;if(a){e={textures:{},images:{}}}var r={metadata:{version:4.5,type:"Material",generator:"Material.toJSON"},uuid:this.uuid,type:this.type};if(""!==this.name)r.name=this.name;if(this.color&&this.color.isColor)r.color=this.color.getHex();if(this.roughness!==void 0)r.roughness=this.roughness;if(this.metalness!==void 0)r.metalness=this.metalness;if(this.sheen!==void 0)r.sheen=this.sheen;if(this.sheenColor&&this.sheenColor.isColor)r.sheenColor=this.sheenColor.getHex();if(this.sheenRoughness!==void 0)r.sheenRoughness=this.sheenRoughness;if(this.emissive&&this.emissive.isColor)r.emissive=this.emissive.getHex();if(this.emissiveIntensity&&1!==this.emissiveIntensity)r.emissiveIntensity=this.emissiveIntensity;if(this.specular&&this.specular.isColor)r.specular=this.specular.getHex();if(this.specularIntensity!==void 0)r.specularIntensity=this.specularIntensity;if(this.specularColor&&this.specularColor.isColor)r.specularColor=this.specularColor.getHex();if(this.shininess!==void 0)r.shininess=this.shininess;if(this.clearcoat!==void 0)r.clearcoat=this.clearcoat;if(this.clearcoatRoughness!==void 0)r.clearcoatRoughness=this.clearcoatRoughness;if(this.clearcoatMap&&this.clearcoatMap.isTexture){r.clearcoatMap=this.clearcoatMap.toJSON(e).uuid}if(this.clearcoatRoughnessMap&&this.clearcoatRoughnessMap.isTexture){r.clearcoatRoughnessMap=this.clearcoatRoughnessMap.toJSON(e).uuid}if(this.clearcoatNormalMap&&this.clearcoatNormalMap.isTexture){r.clearcoatNormalMap=this.clearcoatNormalMap.toJSON(e).uuid;r.clearcoatNormalScale=this.clearcoatNormalScale.toArray()}if(this.map&&this.map.isTexture)r.map=this.map.toJSON(e).uuid;if(this.matcap&&this.matcap.isTexture)r.matcap=this.matcap.toJSON(e).uuid;if(this.alphaMap&&this.alphaMap.isTexture)r.alphaMap=this.alphaMap.toJSON(e).uuid;if(this.lightMap&&this.lightMap.isTexture){r.lightMap=this.lightMap.toJSON(e).uuid;r.lightMapIntensity=this.lightMapIntensity}if(this.aoMap&&this.aoMap.isTexture){r.aoMap=this.aoMap.toJSON(e).uuid;r.aoMapIntensity=this.aoMapIntensity}if(this.bumpMap&&this.bumpMap.isTexture){r.bumpMap=this.bumpMap.toJSON(e).uuid;r.bumpScale=this.bumpScale}if(this.normalMap&&this.normalMap.isTexture){r.normalMap=this.normalMap.toJSON(e).uuid;r.normalMapType=this.normalMapType;r.normalScale=this.normalScale.toArray()}if(this.displacementMap&&this.displacementMap.isTexture){r.displacementMap=this.displacementMap.toJSON(e).uuid;r.displacementScale=this.displacementScale;r.displacementBias=this.displacementBias}if(this.roughnessMap&&this.roughnessMap.isTexture)r.roughnessMap=this.roughnessMap.toJSON(e).uuid;if(this.metalnessMap&&this.metalnessMap.isTexture)r.metalnessMap=this.metalnessMap.toJSON(e).uuid;if(this.emissiveMap&&this.emissiveMap.isTexture)r.emissiveMap=this.emissiveMap.toJSON(e).uuid;if(this.specularMap&&this.specularMap.isTexture)r.specularMap=this.specularMap.toJSON(e).uuid;if(this.specularIntensityMap&&this.specularIntensityMap.isTexture)r.specularIntensityMap=this.specularIntensityMap.toJSON(e).uuid;if(this.specularColorMap&&this.specularColorMap.isTexture)r.specularColorMap=this.specularColorMap.toJSON(e).uuid;if(this.envMap&&this.envMap.isTexture){r.envMap=this.envMap.toJSON(e).uuid;if(this.combine!==void 0)r.combine=this.combine}if(this.envMapIntensity!==void 0)r.envMapIntensity=this.envMapIntensity;if(this.reflectivity!==void 0)r.reflectivity=this.reflectivity;if(this.refractionRatio!==void 0)r.refractionRatio=this.refractionRatio;if(this.gradientMap&&this.gradientMap.isTexture){r.gradientMap=this.gradientMap.toJSON(e).uuid}if(this.transmission!==void 0)r.transmission=this.transmission;if(this.transmissionMap&&this.transmissionMap.isTexture)r.transmissionMap=this.transmissionMap.toJSON(e).uuid;if(this.thickness!==void 0)r.thickness=this.thickness;if(this.thicknessMap&&this.thicknessMap.isTexture)r.thicknessMap=this.thicknessMap.toJSON(e).uuid;if(this.attenuationDistance!==void 0)r.attenuationDistance=this.attenuationDistance;if(this.attenuationColor!==void 0)r.attenuationColor=this.attenuationColor.getHex();if(this.size!==void 0)r.size=this.size;if(null!==this.shadowSide)r.shadowSide=this.shadowSide;if(this.sizeAttenuation!==void 0)r.sizeAttenuation=this.sizeAttenuation;if(this.blending!==Or)r.blending=this.blending;if(this.side!==Pr)r.side=this.side;if(this.vertexColors)r.vertexColors=!0;if(1>this.opacity)r.opacity=this.opacity;if(this.format!==an)r.format=this.format;if(!0===this.transparent)r.transparent=this.transparent;r.depthFunc=this.depthFunc;r.depthTest=this.depthTest;r.depthWrite=this.depthWrite;r.colorWrite=this.colorWrite;r.stencilWrite=this.stencilWrite;r.stencilWriteMask=this.stencilWriteMask;r.stencilFunc=this.stencilFunc;r.stencilRef=this.stencilRef;r.stencilFuncMask=this.stencilFuncMask;r.stencilFail=this.stencilFail;r.stencilZFail=this.stencilZFail;r.stencilZPass=this.stencilZPass;if(this.rotation&&0!==this.rotation)r.rotation=this.rotation;if(!0===this.polygonOffset)r.polygonOffset=!0;if(0!==this.polygonOffsetFactor)r.polygonOffsetFactor=this.polygonOffsetFactor;if(0!==this.polygonOffsetUnits)r.polygonOffsetUnits=this.polygonOffsetUnits;if(this.linewidth&&1!==this.linewidth)r.linewidth=this.linewidth;if(this.dashSize!==void 0)r.dashSize=this.dashSize;if(this.gapSize!==void 0)r.gapSize=this.gapSize;if(this.scale!==void 0)r.scale=this.scale;if(!0===this.dithering)r.dithering=!0;if(0<this.alphaTest)r.alphaTest=this.alphaTest;if(!0===this.alphaToCoverage)r.alphaToCoverage=this.alphaToCoverage;if(!0===this.premultipliedAlpha)r.premultipliedAlpha=this.premultipliedAlpha;if(!0===this.wireframe)r.wireframe=this.wireframe;if(1<this.wireframeLinewidth)r.wireframeLinewidth=this.wireframeLinewidth;if("round"!==this.wireframeLinecap)r.wireframeLinecap=this.wireframeLinecap;if("round"!==this.wireframeLinejoin)r.wireframeLinejoin=this.wireframeLinejoin;if(!0===this.flatShading)r.flatShading=this.flatShading;if(!1===this.visible)r.visible=!1;if(!1===this.toneMapped)r.toneMapped=!1;if("{}"!==JSON.stringify(this.userData))r.userData=this.userData;function t(e){var t=[];for(var a in e){var r=e[a];delete r.metadata;t.push(r)}return t}if(a){var i=t(e.textures),n=t(e.images);if(0<i.length)r.textures=i;if(0<n.length)r.images=n}return r}},{key:"clone",value:function clone(){return new this.constructor().copy(this)}},{key:"copy",value:function copy(e){this.name=e.name;this.fog=e.fog;this.blending=e.blending;this.side=e.side;this.vertexColors=e.vertexColors;this.opacity=e.opacity;this.format=e.format;this.transparent=e.transparent;this.blendSrc=e.blendSrc;this.blendDst=e.blendDst;this.blendEquation=e.blendEquation;this.blendSrcAlpha=e.blendSrcAlpha;this.blendDstAlpha=e.blendDstAlpha;this.blendEquationAlpha=e.blendEquationAlpha;this.depthFunc=e.depthFunc;this.depthTest=e.depthTest;this.depthWrite=e.depthWrite;this.stencilWriteMask=e.stencilWriteMask;this.stencilFunc=e.stencilFunc;this.stencilRef=e.stencilRef;this.stencilFuncMask=e.stencilFuncMask;this.stencilFail=e.stencilFail;this.stencilZFail=e.stencilZFail;this.stencilZPass=e.stencilZPass;this.stencilWrite=e.stencilWrite;var t=e.clippingPlanes,a=null;if(null!==t){var r=t.length;a=Array(r);for(var i=0;i!==r;++i){a[i]=t[i].clone()}}this.clippingPlanes=a;this.clipIntersection=e.clipIntersection;this.clipShadows=e.clipShadows;this.shadowSide=e.shadowSide;this.colorWrite=e.colorWrite;this.precision=e.precision;this.polygonOffset=e.polygonOffset;this.polygonOffsetFactor=e.polygonOffsetFactor;this.polygonOffsetUnits=e.polygonOffsetUnits;this.dithering=e.dithering;this.alphaTest=e.alphaTest;this.alphaToCoverage=e.alphaToCoverage;this.premultipliedAlpha=e.premultipliedAlpha;this.visible=e.visible;this.toneMapped=e.toneMapped;this.userData=JSON.parse(JSON.stringify(e.userData));return this}},{key:"dispose",value:function dispose(){this.dispatchEvent({type:"dispose"})}},{key:"alphaTest",get:function get(){return this._alphaTest},set:function set(e){if(0<this._alphaTest!=0<e){this.version++}this._alphaTest=e}},{key:"needsUpdate",set:function set(e){if(!0===e)this.version++}}]);return a}(es);Ll.prototype.isMaterial=!0;var Pl={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074},Il={h:0,s:0,l:0},Dl={h:0,s:0,l:0};function y(e,a,r){if(0>r)r+=1;if(1<r)r-=1;if(r<1/6)return e+6*(a-e)*r;if(r<1/2)return a;if(r<2/3)return e+6*(a-e)*(2/3-r);return e}function v(e){return .04045>e?.0773993808*e:Math.pow(.9478672986*e+.0521327014,2.4)}function _(e){return .0031308>e?12.92*e:1.055*Math.pow(e,.41666)-.055}var zl=function(){function e(t,a,r){_classCallCheck2(this,e);if(a===void 0&&r===void 0){return this.set(t)}return this.setRGB(t,a,r)}_createClass2(e,[{key:"set",value:function set(e){if(e&&e.isColor){this.copy(e)}else if("number"==typeof e){this.setHex(e)}else if("string"==typeof e){this.setStyle(e)}return this}},{key:"setScalar",value:function setScalar(e){this.r=e;this.g=e;this.b=e;return this}},{key:"setHex",value:function setHex(e){e=Math.floor(e);this.r=(255&e>>16)/255;this.g=(255&e>>8)/255;this.b=(255&e)/255;return this}},{key:"setRGB",value:function setRGB(e,t,a){this.r=e;this.g=t;this.b=a;return this}},{key:"setHSL",value:function setHSL(e,t,i){e=r(e,1);t=a(t,0,1);i=a(i,0,1);if(0===t){this.r=this.g=this.b=i}else{var n=.5>=i?i*(1+t):i+t-i*t,o=2*i-n;this.r=y(o,n,e+1/3);this.g=y(o,n,e);this.b=y(o,n,e-1/3)}return this}},{key:"setStyle",value:function setStyle(e){function t(t){if(t===void 0)return;if(1>parseFloat(t)){console.warn("THREE.Color: Alpha component of "+e+" will be ignored.")}}var a;if(a=/^((?:rgb|hsl)a?)\(([^\)]*)\)/.exec(e)){var r,i=a[1],n=a[2];switch(i){case"rgb":case"rgba":if(r=/^\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(n)){this.r=Math.min(255,parseInt(r[1],10))/255;this.g=Math.min(255,parseInt(r[2],10))/255;this.b=Math.min(255,parseInt(r[3],10))/255;t(r[4]);return this}if(r=/^\s*(\d+)\%\s*,\s*(\d+)\%\s*,\s*(\d+)\%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(n)){this.r=Math.min(100,parseInt(r[1],10))/100;this.g=Math.min(100,parseInt(r[2],10))/100;this.b=Math.min(100,parseInt(r[3],10))/100;t(r[4]);return this}break;case"hsl":case"hsla":if(r=/^\s*(\d*\.?\d+)\s*,\s*(\d+)\%\s*,\s*(\d+)\%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(n)){var o=parseFloat(r[1])/360,d=parseInt(r[2],10)/100,s=parseInt(r[3],10)/100;t(r[4]);return this.setHSL(o,d,s)}break;}}else if(a=/^\#([A-Fa-f\d]+)$/.exec(e)){var l=a[1],c=l.length;if(3===c){this.r=parseInt(l.charAt(0)+l.charAt(0),16)/255;this.g=parseInt(l.charAt(1)+l.charAt(1),16)/255;this.b=parseInt(l.charAt(2)+l.charAt(2),16)/255;return this}else if(6===c){this.r=parseInt(l.charAt(0)+l.charAt(1),16)/255;this.g=parseInt(l.charAt(2)+l.charAt(3),16)/255;this.b=parseInt(l.charAt(4)+l.charAt(5),16)/255;return this}}if(e&&0<e.length){return this.setColorName(e)}return this}},{key:"setColorName",value:function setColorName(e){var t=Pl[e.toLowerCase()];if(t!==void 0){this.setHex(t)}else{console.warn("THREE.Color: Unknown color "+e)}return this}},{key:"clone",value:function clone(){return new this.constructor(this.r,this.g,this.b)}},{key:"copy",value:function copy(e){this.r=e.r;this.g=e.g;this.b=e.b;return this}},{key:"copyGammaToLinear",value:function copyGammaToLinear(e){var t=1<arguments.length&&arguments[1]!==void 0?arguments[1]:2;this.r=Math.pow(e.r,t);this.g=Math.pow(e.g,t);this.b=Math.pow(e.b,t);return this}},{key:"copyLinearToGamma",value:function copyLinearToGamma(e){var t=1<arguments.length&&arguments[1]!==void 0?arguments[1]:2,a=0<t?1/t:1;this.r=Math.pow(e.r,a);this.g=Math.pow(e.g,a);this.b=Math.pow(e.b,a);return this}},{key:"convertGammaToLinear",value:function convertGammaToLinear(e){this.copyGammaToLinear(this,e);return this}},{key:"convertLinearToGamma",value:function convertLinearToGamma(e){this.copyLinearToGamma(this,e);return this}},{key:"copySRGBToLinear",value:function copySRGBToLinear(e){this.r=v(e.r);this.g=v(e.g);this.b=v(e.b);return this}},{key:"copyLinearToSRGB",value:function copyLinearToSRGB(e){this.r=_(e.r);this.g=_(e.g);this.b=_(e.b);return this}},{key:"convertSRGBToLinear",value:function convertSRGBToLinear(){this.copySRGBToLinear(this);return this}},{key:"convertLinearToSRGB",value:function convertLinearToSRGB(){this.copyLinearToSRGB(this);return this}},{key:"getHex",value:function getHex(){return 255*this.r<<16^255*this.g<<8^255*this.b<<0}},{key:"getHexString",value:function getHexString(){return("000000"+this.getHex().toString(16)).slice(-6)}},{key:"getHSL",value:function getHSL(e){var t=this.r,a=this.g,r=this.b,i=Math.max(t,a,r),n=Math.min(t,a,r),o,s,l=(n+i)/2;if(n===i){o=0;s=0}else{var d=i-n;s=.5>=l?d/(i+n):d/(2-i-n);switch(i){case t:o=(a-r)/d+(a<r?6:0);break;case a:o=(r-t)/d+2;break;case r:o=(t-a)/d+4;break;}o/=6}e.h=o;e.s=s;e.l=l;return e}},{key:"getStyle",value:function getStyle(){return"rgb("+(0|255*this.r)+","+(0|255*this.g)+","+(0|255*this.b)+")"}},{key:"offsetHSL",value:function offsetHSL(e,t,a){this.getHSL(Il);Il.h+=e;Il.s+=t;Il.l+=a;this.setHSL(Il.h,Il.s,Il.l);return this}},{key:"add",value:function add(e){this.r+=e.r;this.g+=e.g;this.b+=e.b;return this}},{key:"addColors",value:function addColors(e,t){this.r=e.r+t.r;this.g=e.g+t.g;this.b=e.b+t.b;return this}},{key:"addScalar",value:function addScalar(e){this.r+=e;this.g+=e;this.b+=e;return this}},{key:"sub",value:function sub(e){this.r=Math.max(0,this.r-e.r);this.g=Math.max(0,this.g-e.g);this.b=Math.max(0,this.b-e.b);return this}},{key:"multiply",value:function multiply(e){this.r*=e.r;this.g*=e.g;this.b*=e.b;return this}},{key:"multiplyScalar",value:function multiplyScalar(e){this.r*=e;this.g*=e;this.b*=e;return this}},{key:"lerp",value:function(e,t){this.r+=(e.r-this.r)*t;this.g+=(e.g-this.g)*t;this.b+=(e.b-this.b)*t;return this}},{key:"lerpColors",value:function lerpColors(e,t,a){this.r=e.r+(t.r-e.r)*a;this.g=e.g+(t.g-e.g)*a;this.b=e.b+(t.b-e.b)*a;return this}},{key:"lerpHSL",value:function lerpHSL(e,t){this.getHSL(Il);e.getHSL(Dl);var a=n(Il.h,Dl.h,t),r=n(Il.s,Dl.s,t),i=n(Il.l,Dl.l,t);this.setHSL(a,r,i);return this}},{key:"equals",value:function(e){return e.r===this.r&&e.g===this.g&&e.b===this.b}},{key:"fromArray",value:function fromArray(e){var t=1<arguments.length&&arguments[1]!==void 0?arguments[1]:0;this.r=e[t];this.g=e[t+1];this.b=e[t+2];return this}},{key:"toArray",value:function toArray(){var e=0<arguments.length&&arguments[0]!==void 0?arguments[0]:[],t=1<arguments.length&&arguments[1]!==void 0?arguments[1]:0;e[t]=this.r;e[t+1]=this.g;e[t+2]=this.b;return e}},{key:"fromBufferAttribute",value:function fromBufferAttribute(e,t){this.r=e.getX(t);this.g=e.getY(t);this.b=e.getZ(t);if(!0===e.normalized){this.r/=255;this.g/=255;this.b/=255}return this}},{key:"toJSON",value:function toJSON(){return this.getHex()}}]);return e}();zl.NAMES=Pl;zl.prototype.isColor=!0;zl.prototype.r=1;zl.prototype.g=1;zl.prototype.b=1;var Nl=function(e){_inherits(t,e);var a=_createSuper(t);function t(e){var r;_classCallCheck2(this,t);r=a.call(this);r.type="MeshBasicMaterial";r.color=new zl(16777215);r.map=null;r.lightMap=null;r.lightMapIntensity=1;r.aoMap=null;r.aoMapIntensity=1;r.specularMap=null;r.alphaMap=null;r.envMap=null;r.combine=mi;r.reflectivity=1;r.refractionRatio=.98;r.wireframe=!1;r.wireframeLinewidth=1;r.wireframeLinecap="round";r.wireframeLinejoin="round";r.setValues(e);return r}_createClass2(t,[{key:"copy",value:function copy(e){_get(_getPrototypeOf(t.prototype),"copy",this).call(this,e);this.color.copy(e.color);this.map=e.map;this.lightMap=e.lightMap;this.lightMapIntensity=e.lightMapIntensity;this.aoMap=e.aoMap;this.aoMapIntensity=e.aoMapIntensity;this.specularMap=e.specularMap;this.alphaMap=e.alphaMap;this.envMap=e.envMap;this.combine=e.combine;this.reflectivity=e.reflectivity;this.refractionRatio=e.refractionRatio;this.wireframe=e.wireframe;this.wireframeLinewidth=e.wireframeLinewidth;this.wireframeLinecap=e.wireframeLinecap;this.wireframeLinejoin=e.wireframeLinejoin;return this}}]);return t}(Ll);Nl.prototype.isMeshBasicMaterial=!0;var Fl=new vs,Ol=new os,Bl=function(){function e(t,a,r){_classCallCheck2(this,e);if(Array.isArray(t)){throw new TypeError("THREE.BufferAttribute: array should be a Typed Array.")}this.name="";this.array=t;this.itemSize=a;this.count=t!==void 0?t.length/a:0;this.normalized=!0===r;this.usage=Vo;this.updateRange={offset:0,count:-1};this.version=0}_createClass2(e,[{key:"onUploadCallback",value:function onUploadCallback(){}},{key:"setUsage",value:function setUsage(e){this.usage=e;return this}},{key:"copy",value:function copy(e){this.name=e.name;this.array=new e.array.constructor(e.array);this.itemSize=e.itemSize;this.count=e.count;this.normalized=e.normalized;this.usage=e.usage;return this}},{key:"copyAt",value:function copyAt(e,t,a){e*=this.itemSize;a*=t.itemSize;for(var r=0,i=this.itemSize;r<i;r++){this.array[e+r]=t.array[a+r]}return this}},{key:"copyArray",value:function(e){this.array.set(e);return this}},{key:"copyColorsArray",value:function copyColorsArray(e){for(var t=this.array,a=0,r=0,i=e.length,n;r<i;r++){n=e[r];if(n===void 0){console.warn("THREE.BufferAttribute.copyColorsArray(): color is undefined",r);n=new zl}t[a++]=n.r;t[a++]=n.g;t[a++]=n.b}return this}},{key:"copyVector2sArray",value:function copyVector2sArray(e){for(var t=this.array,a=0,r=0,i=e.length,n;r<i;r++){n=e[r];if(n===void 0){console.warn("THREE.BufferAttribute.copyVector2sArray(): vector is undefined",r);n=new os}t[a++]=n.x;t[a++]=n.y}return this}},{key:"copyVector3sArray",value:function copyVector3sArray(e){for(var t=this.array,a=0,r=0,i=e.length,n;r<i;r++){n=e[r];if(n===void 0){console.warn("THREE.BufferAttribute.copyVector3sArray(): vector is undefined",r);n=new vs}t[a++]=n.x;t[a++]=n.y;t[a++]=n.z}return this}},{key:"copyVector4sArray",value:function copyVector4sArray(e){for(var t=this.array,a=0,r=0,i=e.length,n;r<i;r++){n=e[r];if(n===void 0){console.warn("THREE.BufferAttribute.copyVector4sArray(): vector is undefined",r);n=new ms}t[a++]=n.x;t[a++]=n.y;t[a++]=n.z;t[a++]=n.w}return this}},{key:"applyMatrix3",value:function applyMatrix3(e){if(2===this.itemSize){for(var t=0,a=this.count;t<a;t++){Ol.fromBufferAttribute(this,t);Ol.applyMatrix3(e);this.setXY(t,Ol.x,Ol.y)}}else if(3===this.itemSize){for(var r=0,i=this.count;r<i;r++){Fl.fromBufferAttribute(this,r);Fl.applyMatrix3(e);this.setXYZ(r,Fl.x,Fl.y,Fl.z)}}return this}},{key:"applyMatrix4",value:function applyMatrix4(e){for(var t=0,a=this.count;t<a;t++){Fl.x=this.getX(t);Fl.y=this.getY(t);Fl.z=this.getZ(t);Fl.applyMatrix4(e);this.setXYZ(t,Fl.x,Fl.y,Fl.z)}return this}},{key:"applyNormalMatrix",value:function applyNormalMatrix(e){for(var t=0,a=this.count;t<a;t++){Fl.x=this.getX(t);Fl.y=this.getY(t);Fl.z=this.getZ(t);Fl.applyNormalMatrix(e);this.setXYZ(t,Fl.x,Fl.y,Fl.z)}return this}},{key:"transformDirection",value:function transformDirection(e){for(var t=0,a=this.count;t<a;t++){Fl.x=this.getX(t);Fl.y=this.getY(t);Fl.z=this.getZ(t);Fl.transformDirection(e);this.setXYZ(t,Fl.x,Fl.y,Fl.z)}return this}},{key:"set",value:function set(e){var t=1<arguments.length&&arguments[1]!==void 0?arguments[1]:0;this.array.set(e,t);return this}},{key:"getX",value:function getX(e){return this.array[e*this.itemSize]}},{key:"setX",value:function setX(e,t){this.array[e*this.itemSize]=t;return this}},{key:"getY",value:function getY(e){return this.array[e*this.itemSize+1]}},{key:"setY",value:function setY(e,t){this.array[e*this.itemSize+1]=t;return this}},{key:"getZ",value:function getZ(e){return this.array[e*this.itemSize+2]}},{key:"setZ",value:function setZ(e,t){this.array[e*this.itemSize+2]=t;return this}},{key:"getW",value:function getW(e){return this.array[e*this.itemSize+3]}},{key:"setW",value:function setW(e,t){this.array[e*this.itemSize+3]=t;return this}},{key:"setXY",value:function setXY(e,t,a){e*=this.itemSize;this.array[e+0]=t;this.array[e+1]=a;return this}},{key:"setXYZ",value:function setXYZ(e,t,a,r){e*=this.itemSize;this.array[e+0]=t;this.array[e+1]=a;this.array[e+2]=r;return this}},{key:"setXYZW",value:function setXYZW(e,t,a,r,i){e*=this.itemSize;this.array[e+0]=t;this.array[e+1]=a;this.array[e+2]=r;this.array[e+3]=i;return this}},{key:"onUpload",value:function onUpload(e){this.onUploadCallback=e;return this}},{key:"clone",value:function clone(){return new this.constructor(this.array,this.itemSize).copy(this)}},{key:"toJSON",value:function toJSON(){var e={itemSize:this.itemSize,type:this.array.constructor.name,array:Array.prototype.slice.call(this.array),normalized:this.normalized};if(""!==this.name)e.name=this.name;if(this.usage!==Vo)e.usage=this.usage;if(0!==this.updateRange.offset||-1!==this.updateRange.count)e.updateRange=this.updateRange;return e}},{key:"needsUpdate",set:function set(e){if(!0===e)this.version++}}]);return e}();Bl.prototype.isBufferAttribute=!0;var Ul=function(e){_inherits(t,e);var a=_createSuper(t);function t(e,r,i){_classCallCheck2(this,t);return a.call(this,new Int8Array(e),r,i)}return t}(Bl),Gl=function(e){_inherits(t,e);var a=_createSuper(t);function t(e,r,i){_classCallCheck2(this,t);return a.call(this,new Uint8Array(e),r,i)}return t}(Bl),Hl=function(e){_inherits(t,e);var a=_createSuper(t);function t(e,r,i){_classCallCheck2(this,t);return a.call(this,new Uint8ClampedArray(e),r,i)}return t}(Bl),Vl=function(e){_inherits(t,e);var a=_createSuper(t);function t(e,r,i){_classCallCheck2(this,t);return a.call(this,new Int16Array(e),r,i)}return t}(Bl),Wl=function(e){_inherits(t,e);var a=_createSuper(t);function t(e,r,i){_classCallCheck2(this,t);return a.call(this,new Uint16Array(e),r,i)}return t}(Bl),jl=function(e){_inherits(t,e);var a=_createSuper(t);function t(e,r,i){_classCallCheck2(this,t);return a.call(this,new Int32Array(e),r,i)}return t}(Bl),ql=function(e){_inherits(t,e);var a=_createSuper(t);function t(e,r,i){_classCallCheck2(this,t);return a.call(this,new Uint32Array(e),r,i)}return t}(Bl),Xl=function(e){_inherits(t,e);var a=_createSuper(t);function t(e,r,i){_classCallCheck2(this,t);return a.call(this,new Uint16Array(e),r,i)}return t}(Bl);Xl.prototype.isFloat16BufferAttribute=!0;var Yl=function(e){_inherits(t,e);var a=_createSuper(t);function t(e,r,i){_classCallCheck2(this,t);return a.call(this,new Float32Array(e),r,i)}return t}(Bl),Zl=function(e){_inherits(t,e);var a=_createSuper(t);function t(e,r,i){_classCallCheck2(this,t);return a.call(this,new Float64Array(e),r,i)}return t}(Bl),Jl=0,Ql=new Ys,Kl=new vl,$l=new vs,ed=new bs,td=new bs,ad=new vs,rd=function(e){_inherits(a,e);var r=_createSuper(a);function a(){var e;_classCallCheck2(this,a);e=r.call(this);Object.defineProperty(_assertThisInitialized(e),"id",{value:Jl++});e.uuid=t();e.name="";e.type="BufferGeometry";e.index=null;e.attributes={};e.morphAttributes={};e.morphTargetsRelative=!1;e.groups=[];e.boundingBox=null;e.boundingSphere=null;e.drawRange={start:0,count:1/0};e.userData={};return e}_createClass2(a,[{key:"getIndex",value:function getIndex(){return this.index}},{key:"setIndex",value:function setIndex(e){if(Array.isArray(e)){this.index=new(65535<u(e)?ql:Wl)(e,1)}else{this.index=e}return this}},{key:"getAttribute",value:function getAttribute(e){return this.attributes[e]}},{key:"setAttribute",value:function setAttribute(e,t){this.attributes[e]=t;return this}},{key:"deleteAttribute",value:function deleteAttribute(e){delete this.attributes[e];return this}},{key:"hasAttribute",value:function hasAttribute(e){return this.attributes[e]!==void 0}},{key:"addGroup",value:function addGroup(e,t){var a=2<arguments.length&&arguments[2]!==void 0?arguments[2]:0;this.groups.push({start:e,count:t,materialIndex:a})}},{key:"clearGroups",value:function clearGroups(){this.groups=[]}},{key:"setDrawRange",value:function setDrawRange(e,t){this.drawRange.start=e;this.drawRange.count=t}},{key:"applyMatrix4",value:function applyMatrix4(e){var t=this.attributes.position;if(t!==void 0){t.applyMatrix4(e);t.needsUpdate=!0}var a=this.attributes.normal;if(a!==void 0){var i=new ss().getNormalMatrix(e);a.applyNormalMatrix(i);a.needsUpdate=!0}var r=this.attributes.tangent;if(r!==void 0){r.transformDirection(e);r.needsUpdate=!0}if(null!==this.boundingBox){this.computeBoundingBox()}if(null!==this.boundingSphere){this.computeBoundingSphere()}return this}},{key:"applyQuaternion",value:function applyQuaternion(e){Ql.makeRotationFromQuaternion(e);this.applyMatrix4(Ql);return this}},{key:"rotateX",value:function rotateX(e){Ql.makeRotationX(e);this.applyMatrix4(Ql);return this}},{key:"rotateY",value:function rotateY(e){Ql.makeRotationY(e);this.applyMatrix4(Ql);return this}},{key:"rotateZ",value:function rotateZ(e){Ql.makeRotationZ(e);this.applyMatrix4(Ql);return this}},{key:"translate",value:function translate(e,t,a){Ql.makeTranslation(e,t,a);this.applyMatrix4(Ql);return this}},{key:"scale",value:function scale(e,t,a){Ql.makeScale(e,t,a);this.applyMatrix4(Ql);return this}},{key:"lookAt",value:function lookAt(e){Kl.lookAt(e);Kl.updateMatrix();this.applyMatrix4(Kl.matrix);return this}},{key:"center",value:function center(){this.computeBoundingBox();this.boundingBox.getCenter($l).negate();this.translate($l.x,$l.y,$l.z);return this}},{key:"setFromPoints",value:function setFromPoints(e){for(var t=[],a=0,r=e.length,i;a<r;a++){i=e[a];t.push(i.x,i.y,i.z||0)}this.setAttribute("position",new Yl(t,3));return this}},{key:"computeBoundingBox",value:function computeBoundingBox(){if(null===this.boundingBox){this.boundingBox=new bs}var e=this.attributes.position,t=this.morphAttributes.position;if(e&&e.isGLBufferAttribute){console.error("THREE.BufferGeometry.computeBoundingBox(): GLBufferAttribute requires a manual bounding box. Alternatively set \"mesh.frustumCulled\" to \"false\".",this);this.boundingBox.set(new vs(-Infinity,-Infinity,-Infinity),new vs(+Infinity,+Infinity,+Infinity));return}if(e!==void 0){this.boundingBox.setFromBufferAttribute(e);if(t){for(var a=0,r=t.length,i;a<r;a++){i=t[a];ed.setFromBufferAttribute(i);if(this.morphTargetsRelative){ad.addVectors(this.boundingBox.min,ed.min);this.boundingBox.expandByPoint(ad);ad.addVectors(this.boundingBox.max,ed.max);this.boundingBox.expandByPoint(ad)}else{this.boundingBox.expandByPoint(ed.min);this.boundingBox.expandByPoint(ed.max)}}}}else{this.boundingBox.makeEmpty()}if(isNaN(this.boundingBox.min.x)||isNaN(this.boundingBox.min.y)||isNaN(this.boundingBox.min.z)){console.error("THREE.BufferGeometry.computeBoundingBox(): Computed min/max have NaN values. The \"position\" attribute is likely to have NaN values.",this)}}},{key:"computeBoundingSphere",value:function computeBoundingSphere(){if(null===this.boundingSphere){this.boundingSphere=new Bs}var e=this.attributes.position,t=this.morphAttributes.position;if(e&&e.isGLBufferAttribute){console.error("THREE.BufferGeometry.computeBoundingSphere(): GLBufferAttribute requires a manual bounding sphere. Alternatively set \"mesh.frustumCulled\" to \"false\".",this);this.boundingSphere.set(new vs,1/0);return}if(e){var d=this.boundingSphere.center;ed.setFromBufferAttribute(e);if(t){for(var c=0,u=t.length,p;c<u;c++){p=t[c];td.setFromBufferAttribute(p);if(this.morphTargetsRelative){ad.addVectors(ed.min,td.min);ed.expandByPoint(ad);ad.addVectors(ed.max,td.max);ed.expandByPoint(ad)}else{ed.expandByPoint(td.min);ed.expandByPoint(td.max)}}}ed.getCenter(d);for(var a=0,r=0,i=e.count;r<i;r++){ad.fromBufferAttribute(e,r);a=Math.max(a,d.distanceToSquared(ad))}if(t){for(var m=0,g=t.length;m<g;m++){for(var n=t[m],o=this.morphTargetsRelative,s=0,l=n.count;s<l;s++){ad.fromBufferAttribute(n,s);if(o){$l.fromBufferAttribute(e,s);ad.add($l)}a=Math.max(a,d.distanceToSquared(ad))}}}this.boundingSphere.radius=Math.sqrt(a);if(isNaN(this.boundingSphere.radius)){console.error("THREE.BufferGeometry.computeBoundingSphere(): Computed radius is NaN. The \"position\" attribute is likely to have NaN values.",this)}}}},{key:"computeTangents",value:function computeTangents(){var a=this.index,r=this.attributes;if(null===a||r.position===void 0||r.normal===void 0||r.uv===void 0){console.error("THREE.BufferGeometry: .computeTangents() failed. Missing required attributes (index, position, normal or uv)");return}var i=a.array,o=r.position.array,s=r.normal.array,l=r.uv.array,d=o.length/3;if(r.tangent===void 0){this.setAttribute("tangent",new Bl(new Float32Array(4*d),4))}for(var c=r.tangent.array,u=[],p=[],m=0;m<d;m++){u[m]=new vs;p[m]=new vs}var g=new vs,f=new vs,h=new vs,y=new os,v=new os,_=new os,x=new vs,S=new vs;function e(e,t,a){g.fromArray(o,3*e);f.fromArray(o,3*t);h.fromArray(o,3*a);y.fromArray(l,2*e);v.fromArray(l,2*t);_.fromArray(l,2*a);f.sub(g);h.sub(g);v.sub(y);_.sub(y);var i=1/(v.x*_.y-_.x*v.y);if(!isFinite(i))return;x.copy(f).multiplyScalar(_.y).addScaledVector(h,-v.y).multiplyScalar(i);S.copy(h).multiplyScalar(v.x).addScaledVector(f,-_.x).multiplyScalar(i);u[e].add(x);u[t].add(x);u[a].add(x);p[e].add(S);p[t].add(S);p[a].add(S)}var M=this.groups;if(0===M.length){M=[{start:0,count:i.length}]}for(var D=0,z=M.length;D<z;++D){for(var T=M[D],E=T.start,w=T.count,A=E;A<E+w;A+=3){e(i[A+0],i[A+1],i[A+2])}}var b=new vs,k=new vs,C=new vs,n=new vs;function t(e){C.fromArray(s,3*e);n.copy(C);var a=u[e];b.copy(a);b.sub(C.multiplyScalar(C.dot(a))).normalize();k.crossVectors(n,a);var t=k.dot(p[e]),r=0>t?-1:1;c[4*e]=b.x;c[4*e+1]=b.y;c[4*e+2]=b.z;c[4*e+3]=r}for(var N=0,F=M.length;N<F;++N){for(var R=M[N],L=R.start,P=R.count,I=L;I<L+P;I+=3){t(i[I+0]);t(i[I+1]);t(i[I+2])}}}},{key:"computeVertexNormals",value:function computeVertexNormals(){var e=this.index,t=this.getAttribute("position");if(t!==void 0){var m=this.getAttribute("normal");if(m===void 0){m=new Bl(new Float32Array(3*t.count),3);this.setAttribute("normal",m)}else{for(var g=0,f=m.count;g<f;g++){m.setXYZ(g,0,0,0)}}var a=new vs,r=new vs,i=new vs,n=new vs,o=new vs,s=new vs,l=new vs,d=new vs;if(e){for(var h=0,y=e.count;h<y;h+=3){var c=e.getX(h+0),u=e.getX(h+1),p=e.getX(h+2);a.fromBufferAttribute(t,c);r.fromBufferAttribute(t,u);i.fromBufferAttribute(t,p);l.subVectors(i,r);d.subVectors(a,r);l.cross(d);n.fromBufferAttribute(m,c);o.fromBufferAttribute(m,u);s.fromBufferAttribute(m,p);n.add(l);o.add(l);s.add(l);m.setXYZ(c,n.x,n.y,n.z);m.setXYZ(u,o.x,o.y,o.z);m.setXYZ(p,s.x,s.y,s.z)}}else{for(var v=0,_=t.count;v<_;v+=3){a.fromBufferAttribute(t,v+0);r.fromBufferAttribute(t,v+1);i.fromBufferAttribute(t,v+2);l.subVectors(i,r);d.subVectors(a,r);l.cross(d);m.setXYZ(v+0,l.x,l.y,l.z);m.setXYZ(v+1,l.x,l.y,l.z);m.setXYZ(v+2,l.x,l.y,l.z)}}this.normalizeNormals();m.needsUpdate=!0}}},{key:"merge",value:function merge(e,t){if(!(e&&e.isBufferGeometry)){console.error("THREE.BufferGeometry.merge(): geometry not an instance of THREE.BufferGeometry.",e);return}if(t===void 0){t=0;console.warn("THREE.BufferGeometry.merge(): Overwriting original geometry, starting at offset=0. Use BufferGeometryUtils.mergeBufferGeometries() for lossless merge.")}var a=this.attributes;for(var u in a){if(e.attributes[u]===void 0)continue;for(var r=a[u],i=r.array,n=e.attributes[u],o=n.array,s=n.itemSize*t,l=Math.min(o.length,i.length-s),d=0,c=s;d<l;d++,c++){i[c]=o[d]}}return this}},{key:"normalizeNormals",value:function normalizeNormals(){for(var e=this.attributes.normal,t=0,a=e.count;t<a;t++){ad.fromBufferAttribute(e,t);ad.normalize();e.setXYZ(t,ad.x,ad.y,ad.z)}}},{key:"toNonIndexed",value:function toNonIndexed(){function e(e,t){for(var a=e.array,r=e.itemSize,i=e.normalized,n=new a.constructor(t.length*r),o=0,s=0,d=0,c=t.length;d<c;d++){if(e.isInterleavedBufferAttribute){o=t[d]*e.data.stride+e.offset}else{o=t[d]*r}for(var l=0;l<r;l++){n[s++]=a[o++]}}return new Bl(n,r,i)}if(null===this.index){console.warn("THREE.BufferGeometry.toNonIndexed(): BufferGeometry is already non-indexed.");return this}var t=new a,r=this.index.array,i=this.attributes;for(var v in i){var n=i[v],o=e(n,r);t.setAttribute(v,o)}var s=this.morphAttributes;for(var _ in s){for(var d=[],c=s[_],u=0,p=c.length;u<p;u++){var m=c[u],g=e(m,r);d.push(g)}t.morphAttributes[_]=d}t.morphTargetsRelative=this.morphTargetsRelative;for(var f=this.groups,h=0,y=f.length,l;h<y;h++){l=f[h];t.addGroup(l.start,l.count,l.materialIndex)}return t}},{key:"toJSON",value:function toJSON(){var e={metadata:{version:4.5,type:"BufferGeometry",generator:"BufferGeometry.toJSON"},uuid:this.uuid,type:this.type};if(""!==this.name)e.name=this.name;if(0<Object.keys(this.userData).length)e.userData=this.userData;if(this.parameters!==void 0){var p=this.parameters;for(var m in p){if(p[m]!==void 0)e[m]=p[m]}return e}e.data={attributes:{}};var t=this.index;if(null!==t){e.data.index={type:t.array.constructor.name,array:Array.prototype.slice.call(t.array)}}var a=this.attributes;for(var g in a){var f=a[g];e.data.attributes[g]=f.toJSON(e.data)}var r={},i=!1;for(var h in this.morphAttributes){for(var n=this.morphAttributes[h],o=[],s=0,l=n.length,d;s<l;s++){d=n[s];o.push(d.toJSON(e.data))}if(0<o.length){r[h]=o;i=!0}}if(i){e.data.morphAttributes=r;e.data.morphTargetsRelative=this.morphTargetsRelative}var c=this.groups;if(0<c.length){e.data.groups=JSON.parse(JSON.stringify(c))}var u=this.boundingSphere;if(null!==u){e.data.boundingSphere={center:u.center.toArray(),radius:u.radius}}return e}},{key:"clone",value:function clone(){return new this.constructor().copy(this)}},{key:"copy",value:function copy(e){this.index=null;this.attributes={};this.morphAttributes={};this.groups=[];this.boundingBox=null;this.boundingSphere=null;var t={};this.name=e.name;var a=e.index;if(null!==a){this.setIndex(a.clone(t))}var r=e.attributes;for(var f in r){var h=r[f];this.setAttribute(f,h.clone(t))}var i=e.morphAttributes;for(var y in i){for(var n=[],o=i[y],s=0,d=o.length;s<d;s++){n.push(o[s].clone(t))}this.morphAttributes[y]=n}this.morphTargetsRelative=e.morphTargetsRelative;for(var l=e.groups,c=0,u=l.length,p;c<u;c++){p=l[c];this.addGroup(p.start,p.count,p.materialIndex)}var m=e.boundingBox;if(null!==m){this.boundingBox=m.clone()}var g=e.boundingSphere;if(null!==g){this.boundingSphere=g.clone()}this.drawRange.start=e.drawRange.start;this.drawRange.count=e.drawRange.count;this.userData=e.userData;if(e.parameters!==void 0)this.parameters=Object.assign({},e.parameters);return this}},{key:"dispose",value:function dispose(){this.dispatchEvent({type:"dispose"})}}]);return a}(es);rd.prototype.isBufferGeometry=!0;var id=new Ys,nd=new Xs,od=new Bs,sd=new vs,ld=new vs,dd=new vs,cd=new vs,ud=new vs,pd=new vs,md=new vs,gd=new vs,fd=new vs,hd=new os,yd=new os,vd=new os,_d=new vs,xd=new vs,bd=function(e){_inherits(t,e);var a=_createSuper(t);function t(){var e,r=0<arguments.length&&arguments[0]!==void 0?arguments[0]:new rd,i=1<arguments.length&&arguments[1]!==void 0?arguments[1]:new Nl;_classCallCheck2(this,t);e=a.call(this);e.type="Mesh";e.geometry=r;e.material=i;e.updateMorphTargets();return e}_createClass2(t,[{key:"copy",value:function copy(e){_get(_getPrototypeOf(t.prototype),"copy",this).call(this,e);if(e.morphTargetInfluences!==void 0){this.morphTargetInfluences=e.morphTargetInfluences.slice()}if(e.morphTargetDictionary!==void 0){this.morphTargetDictionary=Object.assign({},e.morphTargetDictionary)}this.material=e.material;this.geometry=e.geometry;return this}},{key:"updateMorphTargets",value:function updateMorphTargets(){var e=this.geometry;if(e.isBufferGeometry){var t=e.morphAttributes,a=Object.keys(t);if(0<a.length){var r=t[a[0]];if(r!==void 0){this.morphTargetInfluences=[];this.morphTargetDictionary={};for(var i=0,n=r.length,o;i<n;i++){o=r[i].name||i+"";this.morphTargetInfluences.push(0);this.morphTargetDictionary[o]=i}}}}else{var s=e.morphTargets;if(s!==void 0&&0<s.length){console.error("THREE.Mesh.updateMorphTargets() no longer supports THREE.Geometry. Use THREE.BufferGeometry instead.")}}}},{key:"raycast",value:function raycast(e,t){var r=this.geometry,i=this.material,n=this.matrixWorld;if(i===void 0)return;if(null===r.boundingSphere)r.computeBoundingSphere();od.copy(r.boundingSphere);od.applyMatrix4(n);if(!1===e.ray.intersectsSphere(od))return;id.copy(n).invert();nd.copy(e.ray).applyMatrix4(id);if(null!==r.boundingBox){if(!1===nd.intersectsBox(r.boundingBox))return}var o;if(r.isBufferGeometry){var s=r.index,l=r.attributes.position,d=r.morphAttributes.position,u=r.morphTargetsRelative,p=r.attributes.uv,m=r.attributes.uv2,g=r.groups,f=r.drawRange;if(null!==s){if(Array.isArray(i)){for(var V=0,W=g.length;V<W;V++){for(var h=g[V],y=i[h.materialIndex],v=Math.max(h.start,f.start),_=Math.min(s.count,Math.min(h.start+h.count,f.start+f.count)),x=v;x<_;x+=3){var M=s.getX(x),a=s.getX(x+1),b=s.getX(x+2);o=S(this,y,e,nd,l,d,u,p,m,M,a,b);if(o){o.faceIndex=Math.floor(x/3);o.face.materialIndex=h.materialIndex;t.push(o)}}}}else{for(var c=Math.max(0,f.start),T=Math.min(s.count,f.start+f.count),E=c;E<T;E+=3){var w=s.getX(E),A=s.getX(E+1),k=s.getX(E+2);o=S(this,i,e,nd,l,d,u,p,m,w,A,k);if(o){o.faceIndex=Math.floor(E/3);t.push(o)}}}}else if(l!==void 0){if(Array.isArray(i)){for(var q=0,X=g.length;q<X;q++){for(var C=g[q],R=i[C.materialIndex],L=Math.max(C.start,f.start),P=Math.min(l.count,Math.min(C.start+C.count,f.start+f.count)),I=L;I<P;I+=3){var D=I,z=I+1,N=I+2;o=S(this,R,e,nd,l,d,u,p,m,D,z,N);if(o){o.faceIndex=Math.floor(I/3);o.face.materialIndex=C.materialIndex;t.push(o)}}}}else{for(var F=Math.max(0,f.start),O=Math.min(l.count,f.start+f.count),B=F;B<O;B+=3){var U=B,G=B+1,H=B+2;o=S(this,i,e,nd,l,d,u,p,m,U,G,H);if(o){o.faceIndex=Math.floor(B/3);t.push(o)}}}}}else if(r.isGeometry){console.error("THREE.Mesh.raycast() no longer supports THREE.Geometry. Use THREE.BufferGeometry instead.")}}}]);return t}(vl);bd.prototype.isMesh=!0;function x(e,t,a,r,i,n,o,s){var l;if(t.side===Ir){l=r.intersectTriangle(o,n,i,!0,s)}else{l=r.intersectTriangle(i,n,o,t.side!==Dr,s)}if(null===l)return null;xd.copy(s);xd.applyMatrix4(e.matrixWorld);var d=a.ray.origin.distanceTo(xd);if(d<a.near||d>a.far)return null;return{distance:d,point:xd.clone(),object:e}}function S(e,t,r,i,n,o,s,l,d,u,a,p){sd.fromBufferAttribute(n,u);ld.fromBufferAttribute(n,a);dd.fromBufferAttribute(n,p);var c=e.morphTargetInfluences;if(o&&c){md.set(0,0,0);gd.set(0,0,0);fd.set(0,0,0);for(var h=0,y=o.length;h<y;h++){var m=c[h],g=o[h];if(0===m)continue;cd.fromBufferAttribute(g,u);ud.fromBufferAttribute(g,a);pd.fromBufferAttribute(g,p);if(s){md.addScaledVector(cd,m);gd.addScaledVector(ud,m);fd.addScaledVector(pd,m)}else{md.addScaledVector(cd.sub(sd),m);gd.addScaledVector(ud.sub(ld),m);fd.addScaledVector(pd.sub(dd),m)}}sd.add(md);ld.add(gd);dd.add(fd)}if(e.isSkinnedMesh){e.boneTransform(u,sd);e.boneTransform(a,ld);e.boneTransform(p,dd)}var f=x(e,t,r,i,sd,ld,dd,_d);if(f){if(l){hd.fromBufferAttribute(l,u);yd.fromBufferAttribute(l,a);vd.fromBufferAttribute(l,p);f.uv=Cl.getUV(_d,sd,ld,dd,hd,yd,vd,new os)}if(d){hd.fromBufferAttribute(d,u);yd.fromBufferAttribute(d,a);vd.fromBufferAttribute(d,p);f.uv2=Cl.getUV(_d,sd,ld,dd,hd,yd,vd,new os)}var v={a:u,b:a,c:p,normal:new vs,materialIndex:0};Cl.getNormal(sd,ld,dd,v.normal);f.face=v}return f}var Sd=function(e){_inherits(t,e);var a=_createSuper(t);function t(){var r,i=0<arguments.length&&arguments[0]!==void 0?arguments[0]:1,n=1<arguments.length&&arguments[1]!==void 0?arguments[1]:1,o=2<arguments.length&&arguments[2]!==void 0?arguments[2]:1,s=3<arguments.length&&arguments[3]!==void 0?arguments[3]:1,l=4<arguments.length&&arguments[4]!==void 0?arguments[4]:1,d=5<arguments.length&&arguments[5]!==void 0?arguments[5]:1;_classCallCheck2(this,t);r=a.call(this);r.type="BoxGeometry";r.parameters={width:i,height:n,depth:o,widthSegments:s,heightSegments:l,depthSegments:d};var p=_assertThisInitialized(r);s=Math.floor(s);l=Math.floor(l);d=Math.floor(d);var m=[],g=[],f=[],h=[],_=0,S=0;e("z","y","x",-1,-1,o,n,i,d,l,0);e("z","y","x",1,-1,o,n,-i,d,l,1);e("x","z","y",1,1,i,o,n,s,d,2);e("x","z","y",1,-1,i,o,-n,s,d,3);e("x","y","z",1,-1,i,n,o,s,l,4);e("x","y","z",-1,-1,i,n,-o,s,l,5);r.setIndex(m);r.setAttribute("position",new Yl(g,3));r.setAttribute("normal",new Yl(f,3));r.setAttribute("uv",new Yl(h,2));function e(e,t,r,i,n,o,s,l,u,v,M){for(var T=u+1,E=0,w=0,A=new vs,k=0,C;k<v+1;k++){C=k*(s/v)-s/2;for(var d=0,L;d<T;d++){L=d*(o/u)-o/2;A[e]=L*i;A[t]=C*n;A[r]=l/2;g.push(A.x,A.y,A.z);A[e]=0;A[t]=0;A[r]=0<l?1:-1;f.push(A.x,A.y,A.z);h.push(d/u);h.push(1-k/v);E+=1}}for(var x=0;x<v;x++){for(var P=0;P<u;P++){var R=_+P+T*x,a=_+P+T*(x+1),b=_+(P+1)+T*(x+1),c=_+(P+1)+T*x;m.push(R,a,c);m.push(a,b,c);w+=6}}p.addGroup(S,w,M);S+=w;_+=E}return r}_createClass2(t,null,[{key:"fromJSON",value:function fromJSON(e){return new t(e.width,e.height,e.depth,e.widthSegments,e.heightSegments,e.depthSegments)}}]);return t}(rd);function M(e){var t={};for(var a in e){t[a]={};for(var r in e[a]){var i=e[a][r];if(i&&(i.isColor||i.isMatrix3||i.isMatrix4||i.isVector2||i.isVector3||i.isVector4||i.isTexture||i.isQuaternion)){t[a][r]=i.clone()}else if(Array.isArray(i)){t[a][r]=i.slice()}else{t[a][r]=i}}}return t}function T(e){for(var t={},a=0,r;a<e.length;a++){r=M(e[a]);for(var i in r){t[i]=r[i]}}return t}var Md={clone:M,merge:T},Td=function(e){_inherits(t,e);var a=_createSuper(t);function t(e){var r;_classCallCheck2(this,t);r=a.call(this);r.type="ShaderMaterial";r.defines={};r.uniforms={};r.vertexShader="void main() {\n\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n}";r.fragmentShader="void main() {\n\tgl_FragColor = vec4( 1.0, 0.0, 0.0, 1.0 );\n}";r.linewidth=1;r.wireframe=!1;r.wireframeLinewidth=1;r.fog=!1;r.lights=!1;r.clipping=!1;r.extensions={derivatives:!1,fragDepth:!1,drawBuffers:!1,shaderTextureLOD:!1};r.defaultAttributeValues={color:[1,1,1],uv:[0,0],uv2:[0,0]};r.index0AttributeName=void 0;r.uniformsNeedUpdate=!1;r.glslVersion=null;if(e!==void 0){if(e.attributes!==void 0){console.error("THREE.ShaderMaterial: attributes should now be defined in THREE.BufferGeometry instead.")}r.setValues(e)}return r}_createClass2(t,[{key:"copy",value:function copy(e){_get(_getPrototypeOf(t.prototype),"copy",this).call(this,e);this.fragmentShader=e.fragmentShader;this.vertexShader=e.vertexShader;this.uniforms=M(e.uniforms);this.defines=Object.assign({},e.defines);this.wireframe=e.wireframe;this.wireframeLinewidth=e.wireframeLinewidth;this.lights=e.lights;this.clipping=e.clipping;this.extensions=Object.assign({},e.extensions);this.glslVersion=e.glslVersion;return this}},{key:"toJSON",value:function toJSON(e){var a=_get(_getPrototypeOf(t.prototype),"toJSON",this).call(this,e);a.glslVersion=this.glslVersion;a.uniforms={};for(var o in this.uniforms){var r=this.uniforms[o],i=r.value;if(i&&i.isTexture){a.uniforms[o]={type:"t",value:i.toJSON(e).uuid}}else if(i&&i.isColor){a.uniforms[o]={type:"c",value:i.getHex()}}else if(i&&i.isVector2){a.uniforms[o]={type:"v2",value:i.toArray()}}else if(i&&i.isVector3){a.uniforms[o]={type:"v3",value:i.toArray()}}else if(i&&i.isVector4){a.uniforms[o]={type:"v4",value:i.toArray()}}else if(i&&i.isMatrix3){a.uniforms[o]={type:"m3",value:i.toArray()}}else if(i&&i.isMatrix4){a.uniforms[o]={type:"m4",value:i.toArray()}}else{a.uniforms[o]={value:i}}}if(0<Object.keys(this.defines).length)a.defines=this.defines;a.vertexShader=this.vertexShader;a.fragmentShader=this.fragmentShader;var n={};for(var s in this.extensions){if(!0===this.extensions[s])n[s]=!0}if(0<Object.keys(n).length)a.extensions=n;return a}}]);return t}(Ll);Td.prototype.isShaderMaterial=!0;var Ed=function(e){_inherits(t,e);var a=_createSuper(t);function t(){var e;_classCallCheck2(this,t);e=a.call(this);e.type="Camera";e.matrixWorldInverse=new Ys;e.projectionMatrix=new Ys;e.projectionMatrixInverse=new Ys;return e}_createClass2(t,[{key:"copy",value:function copy(e,a){_get(_getPrototypeOf(t.prototype),"copy",this).call(this,e,a);this.matrixWorldInverse.copy(e.matrixWorldInverse);this.projectionMatrix.copy(e.projectionMatrix);this.projectionMatrixInverse.copy(e.projectionMatrixInverse);return this}},{key:"getWorldDirection",value:function getWorldDirection(t){this.updateWorldMatrix(!0,!1);var a=this.matrixWorld.elements;return t.set(-a[8],-a[9],-a[10]).normalize()}},{key:"updateMatrixWorld",value:function updateMatrixWorld(e){_get(_getPrototypeOf(t.prototype),"updateMatrixWorld",this).call(this,e);this.matrixWorldInverse.copy(this.matrixWorld).invert()}},{key:"updateWorldMatrix",value:function updateWorldMatrix(e,a){_get(_getPrototypeOf(t.prototype),"updateWorldMatrix",this).call(this,e,a);this.matrixWorldInverse.copy(this.matrixWorld).invert()}},{key:"clone",value:function clone(){return new this.constructor().copy(this)}}]);return t}(vl);Ed.prototype.isCamera=!0;var wd=function(e){_inherits(t,e);var a=_createSuper(t);function t(){var e,r=0<arguments.length&&arguments[0]!==void 0?arguments[0]:50,i=1<arguments.length&&arguments[1]!==void 0?arguments[1]:1,n=2<arguments.length&&arguments[2]!==void 0?arguments[2]:.1,o=3<arguments.length&&arguments[3]!==void 0?arguments[3]:2e3;_classCallCheck2(this,t);e=a.call(this);e.type="PerspectiveCamera";e.fov=r;e.zoom=1;e.near=n;e.far=o;e.focus=10;e.aspect=i;e.view=null;e.filmGauge=35;e.filmOffset=0;e.updateProjectionMatrix();return e}_createClass2(t,[{key:"copy",value:function copy(e,a){_get(_getPrototypeOf(t.prototype),"copy",this).call(this,e,a);this.fov=e.fov;this.zoom=e.zoom;this.near=e.near;this.far=e.far;this.focus=e.focus;this.aspect=e.aspect;this.view=null===e.view?null:Object.assign({},e.view);this.filmGauge=e.filmGauge;this.filmOffset=e.filmOffset;return this}},{key:"setFocalLength",value:function setFocalLength(e){var t=.5*this.getFilmHeight()/e;this.fov=2*is*Math.atan(t);this.updateProjectionMatrix()}},{key:"getFocalLength",value:function getFocalLength(){var e=Math.tan(.5*rs*this.fov);return .5*this.getFilmHeight()/e}},{key:"getEffectiveFOV",value:function getEffectiveFOV(){return 2*is*Math.atan(Math.tan(.5*rs*this.fov)/this.zoom)}},{key:"getFilmWidth",value:function getFilmWidth(){return this.filmGauge*Math.min(this.aspect,1)}},{key:"getFilmHeight",value:function getFilmHeight(){return this.filmGauge/Math.max(this.aspect,1)}},{key:"setViewOffset",value:function setViewOffset(e,t,a,r,i,n){this.aspect=e/t;if(null===this.view){this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}}this.view.enabled=!0;this.view.fullWidth=e;this.view.fullHeight=t;this.view.offsetX=a;this.view.offsetY=r;this.view.width=i;this.view.height=n;this.updateProjectionMatrix()}},{key:"clearViewOffset",value:function clearViewOffset(){if(null!==this.view){this.view.enabled=!1}this.updateProjectionMatrix()}},{key:"updateProjectionMatrix",value:function updateProjectionMatrix(){var e=this.near,t=e*Math.tan(.5*rs*this.fov)/this.zoom,a=2*t,r=this.aspect*a,i=-.5*r,n=this.view;if(null!==this.view&&this.view.enabled){var s=n.fullWidth,l=n.fullHeight;i+=n.offsetX*r/s;t-=n.offsetY*a/l;r*=n.width/s;a*=n.height/l}var o=this.filmOffset;if(0!==o)i+=e*o/this.getFilmWidth();this.projectionMatrix.makePerspective(i,i+r,t,t-a,e,this.far);this.projectionMatrixInverse.copy(this.projectionMatrix).invert()}},{key:"toJSON",value:function toJSON(e){var a=_get(_getPrototypeOf(t.prototype),"toJSON",this).call(this,e);a.object.fov=this.fov;a.object.zoom=this.zoom;a.object.near=this.near;a.object.far=this.far;a.object.focus=this.focus;a.object.aspect=this.aspect;if(null!==this.view)a.object.view=Object.assign({},this.view);a.object.filmGauge=this.filmGauge;a.object.filmOffset=this.filmOffset;return a}}]);return t}(Ed);wd.prototype.isPerspectiveCamera=!0;var Ad=function(e){_inherits(t,e);var a=_createSuper(t);function t(e,r,i){var n;_classCallCheck2(this,t);n=a.call(this);n.type="CubeCamera";if(!0!==i.isWebGLCubeRenderTarget){console.error("THREE.CubeCamera: The constructor now expects an instance of WebGLCubeRenderTarget as third parameter.");return _possibleConstructorReturn(n)}n.renderTarget=i;var o=new wd(90,1,e,r);o.layers=n.layers;o.up.set(0,-1,0);o.lookAt(new vs(1,0,0));n.add(o);var s=new wd(90,1,e,r);s.layers=n.layers;s.up.set(0,-1,0);s.lookAt(new vs(-1,0,0));n.add(s);var l=new wd(90,1,e,r);l.layers=n.layers;l.up.set(0,0,1);l.lookAt(new vs(0,1,0));n.add(l);var d=new wd(90,1,e,r);d.layers=n.layers;d.up.set(0,0,-1);d.lookAt(new vs(0,-1,0));n.add(d);var c=new wd(90,1,e,r);c.layers=n.layers;c.up.set(0,-1,0);c.lookAt(new vs(0,0,1));n.add(c);var u=new wd(90,1,e,r);u.layers=n.layers;u.up.set(0,-1,0);u.lookAt(new vs(0,0,-1));n.add(u);return n}_createClass2(t,[{key:"update",value:function update(e,t){if(null===this.parent)this.updateMatrixWorld();var a=this.renderTarget,r=_slicedToArray2(this.children,6),i=r[0],n=r[1],o=r[2],s=r[3],l=r[4],d=r[5],c=e.xr.enabled,u=e.getRenderTarget();e.xr.enabled=!1;var p=a.texture.generateMipmaps;a.texture.generateMipmaps=!1;e.setRenderTarget(a,0);e.render(t,i);e.setRenderTarget(a,1);e.render(t,n);e.setRenderTarget(a,2);e.render(t,o);e.setRenderTarget(a,3);e.render(t,s);e.setRenderTarget(a,4);e.render(t,l);a.texture.generateMipmaps=p;e.setRenderTarget(a,5);e.render(t,d);e.setRenderTarget(u);e.xr.enabled=c}}]);return t}(vl),kd=function(e){_inherits(t,e);var a=_createSuper(t);function t(e,r,i,n,o,s,l,d,c,u){var p;_classCallCheck2(this,t);e=e!==void 0?e:[];r=r!==void 0?r:Mi;p=a.call(this,e,r,i,n,o,s,l,d,c,u);p.flipY=!1;return p}_createClass2(t,[{key:"images",get:function get(){return this.image},set:function set(e){this.image=e}}]);return t}(ps);kd.prototype.isCubeTexture=!0;var Cd=function(e){_inherits(t,e);var a=_createSuper(t);function t(e,r,i){var n;_classCallCheck2(this,t);if(Number.isInteger(r)){console.warn("THREE.WebGLCubeRenderTarget: constructor signature is now WebGLCubeRenderTarget( size, options )");r=i}n=a.call(this,e,e,r);r=r||{};n.texture=new kd(void 0,r.mapping,r.wrapS,r.wrapT,r.magFilter,r.minFilter,r.format,r.type,r.anisotropy,r.encoding);n.texture.isRenderTargetTexture=!0;n.texture.generateMipmaps=r.generateMipmaps!==void 0?r.generateMipmaps:!1;n.texture.minFilter=r.minFilter!==void 0?r.minFilter:Fi;n.texture._needsFlipEnvMap=!1;return n}_createClass2(t,[{key:"fromEquirectangularTexture",value:function fromEquirectangularTexture(e,t){this.texture.type=t.type;this.texture.format=an;this.texture.encoding=t.encoding;this.texture.generateMipmaps=t.generateMipmaps;this.texture.minFilter=t.minFilter;this.texture.magFilter=t.magFilter;var a={uniforms:{tEquirect:{value:null}},vertexShader:"\n\n\t\t\t\tvarying vec3 vWorldDirection;\n\n\t\t\t\tvec3 transformDirection( in vec3 dir, in mat4 matrix ) {\n\n\t\t\t\t\treturn normalize( ( matrix * vec4( dir, 0.0 ) ).xyz );\n\n\t\t\t\t}\n\n\t\t\t\tvoid main() {\n\n\t\t\t\t\tvWorldDirection = transformDirection( position, modelMatrix );\n\n\t\t\t\t\t#include <begin_vertex>\n\t\t\t\t\t#include <project_vertex>\n\n\t\t\t\t}\n\t\t\t",fragmentShader:"\n\n\t\t\t\tuniform sampler2D tEquirect;\n\n\t\t\t\tvarying vec3 vWorldDirection;\n\n\t\t\t\t#include <common>\n\n\t\t\t\tvoid main() {\n\n\t\t\t\t\tvec3 direction = normalize( vWorldDirection );\n\n\t\t\t\t\tvec2 sampleUV = equirectUv( direction );\n\n\t\t\t\t\tgl_FragColor = texture2D( tEquirect, sampleUV );\n\n\t\t\t\t}\n\t\t\t"},r=new Sd(5,5,5),i=new Td({name:"CubemapFromEquirect",uniforms:M(a.uniforms),vertexShader:a.vertexShader,fragmentShader:a.fragmentShader,side:Ir,blending:Fr});i.uniforms.tEquirect.value=t;var n=new bd(r,i),o=t.minFilter;if(t.minFilter===Ui)t.minFilter=Fi;var s=new Ad(1,10,this);s.update(e,n);t.minFilter=o;n.geometry.dispose();n.material.dispose();return this}},{key:"clear",value:function clear(e,t,a,r){for(var i=e.getRenderTarget(),n=0;6>n;n++){e.setRenderTarget(this,n);e.clear(t,a,r)}e.setRenderTarget(i)}}]);return t}(gs);Cd.prototype.isWebGLCubeRenderTarget=!0;var Rd=new vs,Ld=new vs,Pd=new ss,Id=function(){function e(){var t=0<arguments.length&&arguments[0]!==void 0?arguments[0]:new vs(1,0,0),a=1<arguments.length&&arguments[1]!==void 0?arguments[1]:0;_classCallCheck2(this,e);this.normal=t;this.constant=a}_createClass2(e,[{key:"set",value:function set(e,t){this.normal.copy(e);this.constant=t;return this}},{key:"setComponents",value:function setComponents(e,t,a,r){this.normal.set(e,t,a);this.constant=r;return this}},{key:"setFromNormalAndCoplanarPoint",value:function setFromNormalAndCoplanarPoint(e,t){this.normal.copy(e);this.constant=-t.dot(this.normal);return this}},{key:"setFromCoplanarPoints",value:function setFromCoplanarPoints(e,t,a){var r=Rd.subVectors(a,t).cross(Ld.subVectors(e,t)).normalize();this.setFromNormalAndCoplanarPoint(r,e);return this}},{key:"copy",value:function copy(e){this.normal.copy(e.normal);this.constant=e.constant;return this}},{key:"normalize",value:function normalize(){var e=1/this.normal.length();this.normal.multiplyScalar(e);this.constant*=e;return this}},{key:"negate",value:function negate(){this.constant*=-1;this.normal.negate();return this}},{key:"distanceToPoint",value:function distanceToPoint(e){return this.normal.dot(e)+this.constant}},{key:"distanceToSphere",value:function distanceToSphere(e){return this.distanceToPoint(e.center)-e.radius}},{key:"projectPoint",value:function projectPoint(e,t){return t.copy(this.normal).multiplyScalar(-this.distanceToPoint(e)).add(e)}},{key:"intersectLine",value:function intersectLine(e,a){var r=e.delta(Rd),i=this.normal.dot(r);if(0===i){if(0===this.distanceToPoint(e.start)){return a.copy(e.start)}return null}var n=-(e.start.dot(this.normal)+this.constant)/i;if(0>n||1<n){return null}return a.copy(r).multiplyScalar(n).add(e.start)}},{key:"intersectsLine",value:function intersectsLine(e){var t=this.distanceToPoint(e.start),a=this.distanceToPoint(e.end);return 0>t&&0<a||0>a&&0<t}},{key:"intersectsBox",value:function intersectsBox(e){return e.intersectsPlane(this)}},{key:"intersectsSphere",value:function intersectsSphere(e){return e.intersectsPlane(this)}},{key:"coplanarPoint",value:function coplanarPoint(e){return e.copy(this.normal).multiplyScalar(-this.constant)}},{key:"applyMatrix4",value:function applyMatrix4(e,t){var a=t||Pd.getNormalMatrix(e),r=this.coplanarPoint(Rd).applyMatrix4(e),i=this.normal.applyMatrix3(a).normalize();this.constant=-r.dot(i);return this}},{key:"translate",value:function translate(e){this.constant-=e.dot(this.normal);return this}},{key:"equals",value:function(e){return e.normal.equals(this.normal)&&e.constant===this.constant}},{key:"clone",value:function clone(){return new this.constructor().copy(this)}}]);return e}();Id.prototype.isPlane=!0;var Dd=new Bs,zd=new vs,Nd=function(){function e(){var t=0<arguments.length&&arguments[0]!==void 0?arguments[0]:new Id,a=1<arguments.length&&arguments[1]!==void 0?arguments[1]:new Id,r=2<arguments.length&&arguments[2]!==void 0?arguments[2]:new Id,i=3<arguments.length&&arguments[3]!==void 0?arguments[3]:new Id,n=4<arguments.length&&arguments[4]!==void 0?arguments[4]:new Id,o=5<arguments.length&&arguments[5]!==void 0?arguments[5]:new Id;_classCallCheck2(this,e);this.planes=[t,a,r,i,n,o]}_createClass2(e,[{key:"set",value:function set(e,t,a,r,i,n){var o=this.planes;o[0].copy(e);o[1].copy(t);o[2].copy(a);o[3].copy(r);o[4].copy(i);o[5].copy(n);return this}},{key:"copy",value:function copy(e){for(var t=this.planes,a=0;6>a;a++){t[a].copy(e.planes[a])}return this}},{key:"setFromProjectionMatrix",value:function setFromProjectionMatrix(e){var t=this.planes,a=e.elements,r=a[0],i=a[1],n=a[2],o=a[3],s=a[4],l=a[5],d=a[6],c=a[7],u=a[8],p=a[9],m=a[10],g=a[11],f=a[12],h=a[13],y=a[14],v=a[15];t[0].setComponents(o-r,c-s,g-u,v-f).normalize();t[1].setComponents(o+r,c+s,g+u,v+f).normalize();t[2].setComponents(o+i,c+l,g+p,v+h).normalize();t[3].setComponents(o-i,c-l,g-p,v-h).normalize();t[4].setComponents(o-n,c-d,g-m,v-y).normalize();t[5].setComponents(o+n,c+d,g+m,v+y).normalize();return this}},{key:"intersectsObject",value:function intersectsObject(e){var t=e.geometry;if(null===t.boundingSphere)t.computeBoundingSphere();Dd.copy(t.boundingSphere).applyMatrix4(e.matrixWorld);return this.intersectsSphere(Dd)}},{key:"intersectsSprite",value:function intersectsSprite(e){Dd.center.set(0,0,0);Dd.radius=.7071067811865476;Dd.applyMatrix4(e.matrixWorld);return this.intersectsSphere(Dd)}},{key:"intersectsSphere",value:function intersectsSphere(e){for(var t=this.planes,a=e.center,r=-e.radius,i=0,n;6>i;i++){n=t[i].distanceToPoint(a);if(n<r){return!1}}return!0}},{key:"intersectsBox",value:function intersectsBox(e){for(var t=this.planes,a=0,r;6>a;a++){r=t[a];zd.x=0<r.normal.x?e.max.x:e.min.x;zd.y=0<r.normal.y?e.max.y:e.min.y;zd.z=0<r.normal.z?e.max.z:e.min.z;if(0>r.distanceToPoint(zd)){return!1}}return!0}},{key:"containsPoint",value:function containsPoint(e){for(var t=this.planes,a=0;6>a;a++){if(0>t[a].distanceToPoint(e)){return!1}}return!0}},{key:"clone",value:function clone(){return new this.constructor().copy(this)}}]);return e}();function E(){var t=null,a=!1,r=null,i=null;function e(a,n){r(a,n);i=t.requestAnimationFrame(e)}return{start:function start(){if(!0===a)return;if(null===r)return;i=t.requestAnimationFrame(e);a=!0},stop:function stop(){t.cancelAnimationFrame(i);a=!1},setAnimationLoop:function setAnimationLoop(e){r=e},setContext:function setContext(e){t=e}}}function A(e,t){var i=t.isWebGL2,n=new WeakMap;function a(t,a){var r=t.array,n=t.usage,o=e.createBuffer();e.bindBuffer(a,o);e.bufferData(a,r,n);t.onUploadCallback();var s=5126;if(r instanceof Float32Array){s=5126}else if(r instanceof Float64Array){console.warn("THREE.WebGLAttributes: Unsupported data buffer format: Float64Array.")}else if(r instanceof Uint16Array){if(t.isFloat16BufferAttribute){if(i){s=5131}else{console.warn("THREE.WebGLAttributes: Usage of Float16BufferAttribute requires WebGL2.")}}else{s=5123}}else if(r instanceof Int16Array){s=5122}else if(r instanceof Uint32Array){s=5125}else if(r instanceof Int32Array){s=5124}else if(r instanceof Int8Array){s=5120}else if(r instanceof Uint8Array){s=5121}else if(r instanceof Uint8ClampedArray){s=5121}return{buffer:o,type:s,bytesPerElement:r.BYTES_PER_ELEMENT,version:t.version}}function r(t,a,r){var n=a.array,o=a.updateRange;e.bindBuffer(r,t);if(-1===o.count){e.bufferSubData(r,0,n)}else{if(i){e.bufferSubData(r,o.offset*n.BYTES_PER_ELEMENT,n,o.offset,o.count)}else{e.bufferSubData(r,o.offset*n.BYTES_PER_ELEMENT,n.subarray(o.offset,o.offset+o.count))}o.count=-1}}return{get:function(e){if(e.isInterleavedBufferAttribute)e=e.data;return n.get(e)},remove:function(t){if(t.isInterleavedBufferAttribute)t=t.data;var a=n.get(t);if(a){e.deleteBuffer(a.buffer);n.delete(t)}},update:function(e,t){if(e.isGLBufferAttribute){var o=n.get(e);if(!o||o.version<e.version){n.set(e,{buffer:e.buffer,type:e.type,bytesPerElement:e.elementSize,version:e.version})}return}if(e.isInterleavedBufferAttribute)e=e.data;var i=n.get(e);if(i===void 0){n.set(e,a(e,t))}else if(i.version<e.version){r(i.buffer,e,t);i.version=e.version}}}}var Fd=function(e){_inherits(t,e);var r=_createSuper(t);function t(){var e,i=0<arguments.length&&arguments[0]!==void 0?arguments[0]:1,n=1<arguments.length&&arguments[1]!==void 0?arguments[1]:1,o=2<arguments.length&&arguments[2]!==void 0?arguments[2]:1,s=3<arguments.length&&arguments[3]!==void 0?arguments[3]:1;_classCallCheck2(this,t);e=r.call(this);e.type="PlaneGeometry";e.parameters={width:i,height:n,widthSegments:o,heightSegments:s};for(var l=Math.floor(o),u=Math.floor(s),p=l+1,m=[],g=[],f=[],h=[],v=0,_;v<u+1;v++){_=v*(n/u)-n/2;for(var d=0,M;d<p;d++){M=d*(i/l)-i/2;g.push(M,-_,0);f.push(0,0,1);h.push(d/l);h.push(1-v/u)}}for(var x=0;x<u;x++){for(var T=0;T<l;T++){var S=T+p*x,a=T+p*(x+1),b=T+1+p*(x+1),c=T+1+p*x;m.push(S,a,c);m.push(a,b,c)}}e.setIndex(m);e.setAttribute("position",new Yl(g,3));e.setAttribute("normal",new Yl(f,3));e.setAttribute("uv",new Yl(h,2));return e}_createClass2(t,null,[{key:"fromJSON",value:function fromJSON(e){return new t(e.width,e.height,e.widthSegments,e.heightSegments)}}]);return t}(rd),Od={alphamap_fragment:"#ifdef USE_ALPHAMAP\n\tdiffuseColor.a *= texture2D( alphaMap, vUv ).g;\n#endif",alphamap_pars_fragment:"#ifdef USE_ALPHAMAP\n\tuniform sampler2D alphaMap;\n#endif",alphatest_fragment:"#ifdef USE_ALPHATEST\n\tif ( diffuseColor.a < alphaTest ) discard;\n#endif",alphatest_pars_fragment:"#ifdef USE_ALPHATEST\n\tuniform float alphaTest;\n#endif",aomap_fragment:"#ifdef USE_AOMAP\n\tfloat ambientOcclusion = ( texture2D( aoMap, vUv2 ).r - 1.0 ) * aoMapIntensity + 1.0;\n\treflectedLight.indirectDiffuse *= ambientOcclusion;\n\t#if defined( USE_ENVMAP ) && defined( STANDARD )\n\t\tfloat dotNV = saturate( dot( geometry.normal, geometry.viewDir ) );\n\t\treflectedLight.indirectSpecular *= computeSpecularOcclusion( dotNV, ambientOcclusion, material.roughness );\n\t#endif\n#endif",aomap_pars_fragment:"#ifdef USE_AOMAP\n\tuniform sampler2D aoMap;\n\tuniform float aoMapIntensity;\n#endif",begin_vertex:"vec3 transformed = vec3( position );",beginnormal_vertex:"vec3 objectNormal = vec3( normal );\n#ifdef USE_TANGENT\n\tvec3 objectTangent = vec3( tangent.xyz );\n#endif",bsdfs:"vec3 BRDF_Lambert( const in vec3 diffuseColor ) {\n\treturn RECIPROCAL_PI * diffuseColor;\n}\nvec3 F_Schlick( const in vec3 f0, const in float f90, const in float dotVH ) {\n\tfloat fresnel = exp2( ( - 5.55473 * dotVH - 6.98316 ) * dotVH );\n\treturn f0 * ( 1.0 - fresnel ) + ( f90 * fresnel );\n}\nfloat V_GGX_SmithCorrelated( const in float alpha, const in float dotNL, const in float dotNV ) {\n\tfloat a2 = pow2( alpha );\n\tfloat gv = dotNL * sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNV ) );\n\tfloat gl = dotNV * sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNL ) );\n\treturn 0.5 / max( gv + gl, EPSILON );\n}\nfloat D_GGX( const in float alpha, const in float dotNH ) {\n\tfloat a2 = pow2( alpha );\n\tfloat denom = pow2( dotNH ) * ( a2 - 1.0 ) + 1.0;\n\treturn RECIPROCAL_PI * a2 / pow2( denom );\n}\nvec3 BRDF_GGX( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, const in vec3 f0, const in float f90, const in float roughness ) {\n\tfloat alpha = pow2( roughness );\n\tvec3 halfDir = normalize( lightDir + viewDir );\n\tfloat dotNL = saturate( dot( normal, lightDir ) );\n\tfloat dotNV = saturate( dot( normal, viewDir ) );\n\tfloat dotNH = saturate( dot( normal, halfDir ) );\n\tfloat dotVH = saturate( dot( viewDir, halfDir ) );\n\tvec3 F = F_Schlick( f0, f90, dotVH );\n\tfloat V = V_GGX_SmithCorrelated( alpha, dotNL, dotNV );\n\tfloat D = D_GGX( alpha, dotNH );\n\treturn F * ( V * D );\n}\nvec2 LTC_Uv( const in vec3 N, const in vec3 V, const in float roughness ) {\n\tconst float LUT_SIZE = 64.0;\n\tconst float LUT_SCALE = ( LUT_SIZE - 1.0 ) / LUT_SIZE;\n\tconst float LUT_BIAS = 0.5 / LUT_SIZE;\n\tfloat dotNV = saturate( dot( N, V ) );\n\tvec2 uv = vec2( roughness, sqrt( 1.0 - dotNV ) );\n\tuv = uv * LUT_SCALE + LUT_BIAS;\n\treturn uv;\n}\nfloat LTC_ClippedSphereFormFactor( const in vec3 f ) {\n\tfloat l = length( f );\n\treturn max( ( l * l + f.z ) / ( l + 1.0 ), 0.0 );\n}\nvec3 LTC_EdgeVectorFormFactor( const in vec3 v1, const in vec3 v2 ) {\n\tfloat x = dot( v1, v2 );\n\tfloat y = abs( x );\n\tfloat a = 0.8543985 + ( 0.4965155 + 0.0145206 * y ) * y;\n\tfloat b = 3.4175940 + ( 4.1616724 + y ) * y;\n\tfloat v = a / b;\n\tfloat theta_sintheta = ( x > 0.0 ) ? v : 0.5 * inversesqrt( max( 1.0 - x * x, 1e-7 ) ) - v;\n\treturn cross( v1, v2 ) * theta_sintheta;\n}\nvec3 LTC_Evaluate( const in vec3 N, const in vec3 V, const in vec3 P, const in mat3 mInv, const in vec3 rectCoords[ 4 ] ) {\n\tvec3 v1 = rectCoords[ 1 ] - rectCoords[ 0 ];\n\tvec3 v2 = rectCoords[ 3 ] - rectCoords[ 0 ];\n\tvec3 lightNormal = cross( v1, v2 );\n\tif( dot( lightNormal, P - rectCoords[ 0 ] ) < 0.0 ) return vec3( 0.0 );\n\tvec3 T1, T2;\n\tT1 = normalize( V - N * dot( V, N ) );\n\tT2 = - cross( N, T1 );\n\tmat3 mat = mInv * transposeMat3( mat3( T1, T2, N ) );\n\tvec3 coords[ 4 ];\n\tcoords[ 0 ] = mat * ( rectCoords[ 0 ] - P );\n\tcoords[ 1 ] = mat * ( rectCoords[ 1 ] - P );\n\tcoords[ 2 ] = mat * ( rectCoords[ 2 ] - P );\n\tcoords[ 3 ] = mat * ( rectCoords[ 3 ] - P );\n\tcoords[ 0 ] = normalize( coords[ 0 ] );\n\tcoords[ 1 ] = normalize( coords[ 1 ] );\n\tcoords[ 2 ] = normalize( coords[ 2 ] );\n\tcoords[ 3 ] = normalize( coords[ 3 ] );\n\tvec3 vectorFormFactor = vec3( 0.0 );\n\tvectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 0 ], coords[ 1 ] );\n\tvectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 1 ], coords[ 2 ] );\n\tvectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 2 ], coords[ 3 ] );\n\tvectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 3 ], coords[ 0 ] );\n\tfloat result = LTC_ClippedSphereFormFactor( vectorFormFactor );\n\treturn vec3( result );\n}\nfloat G_BlinnPhong_Implicit( ) {\n\treturn 0.25;\n}\nfloat D_BlinnPhong( const in float shininess, const in float dotNH ) {\n\treturn RECIPROCAL_PI * ( shininess * 0.5 + 1.0 ) * pow( dotNH, shininess );\n}\nvec3 BRDF_BlinnPhong( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, const in vec3 specularColor, const in float shininess ) {\n\tvec3 halfDir = normalize( lightDir + viewDir );\n\tfloat dotNH = saturate( dot( normal, halfDir ) );\n\tfloat dotVH = saturate( dot( viewDir, halfDir ) );\n\tvec3 F = F_Schlick( specularColor, 1.0, dotVH );\n\tfloat G = G_BlinnPhong_Implicit( );\n\tfloat D = D_BlinnPhong( shininess, dotNH );\n\treturn F * ( G * D );\n}\n#if defined( USE_SHEEN )\nfloat D_Charlie( float roughness, float dotNH ) {\n\tfloat alpha = pow2( roughness );\n\tfloat invAlpha = 1.0 / alpha;\n\tfloat cos2h = dotNH * dotNH;\n\tfloat sin2h = max( 1.0 - cos2h, 0.0078125 );\n\treturn ( 2.0 + invAlpha ) * pow( sin2h, invAlpha * 0.5 ) / ( 2.0 * PI );\n}\nfloat V_Neubelt( float dotNV, float dotNL ) {\n\treturn saturate( 1.0 / ( 4.0 * ( dotNL + dotNV - dotNL * dotNV ) ) );\n}\nvec3 BRDF_Sheen( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, vec3 sheenColor, const in float sheenRoughness ) {\n\tvec3 halfDir = normalize( lightDir + viewDir );\n\tfloat dotNL = saturate( dot( normal, lightDir ) );\n\tfloat dotNV = saturate( dot( normal, viewDir ) );\n\tfloat dotNH = saturate( dot( normal, halfDir ) );\n\tfloat D = D_Charlie( sheenRoughness, dotNH );\n\tfloat V = V_Neubelt( dotNV, dotNL );\n\treturn sheenColor * ( D * V );\n}\n#endif",bumpmap_pars_fragment:"#ifdef USE_BUMPMAP\n\tuniform sampler2D bumpMap;\n\tuniform float bumpScale;\n\tvec2 dHdxy_fwd() {\n\t\tvec2 dSTdx = dFdx( vUv );\n\t\tvec2 dSTdy = dFdy( vUv );\n\t\tfloat Hll = bumpScale * texture2D( bumpMap, vUv ).x;\n\t\tfloat dBx = bumpScale * texture2D( bumpMap, vUv + dSTdx ).x - Hll;\n\t\tfloat dBy = bumpScale * texture2D( bumpMap, vUv + dSTdy ).x - Hll;\n\t\treturn vec2( dBx, dBy );\n\t}\n\tvec3 perturbNormalArb( vec3 surf_pos, vec3 surf_norm, vec2 dHdxy, float faceDirection ) {\n\t\tvec3 vSigmaX = vec3( dFdx( surf_pos.x ), dFdx( surf_pos.y ), dFdx( surf_pos.z ) );\n\t\tvec3 vSigmaY = vec3( dFdy( surf_pos.x ), dFdy( surf_pos.y ), dFdy( surf_pos.z ) );\n\t\tvec3 vN = surf_norm;\n\t\tvec3 R1 = cross( vSigmaY, vN );\n\t\tvec3 R2 = cross( vN, vSigmaX );\n\t\tfloat fDet = dot( vSigmaX, R1 ) * faceDirection;\n\t\tvec3 vGrad = sign( fDet ) * ( dHdxy.x * R1 + dHdxy.y * R2 );\n\t\treturn normalize( abs( fDet ) * surf_norm - vGrad );\n\t}\n#endif",clipping_planes_fragment:"#if NUM_CLIPPING_PLANES > 0\n\tvec4 plane;\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < UNION_CLIPPING_PLANES; i ++ ) {\n\t\tplane = clippingPlanes[ i ];\n\t\tif ( dot( vClipPosition, plane.xyz ) > plane.w ) discard;\n\t}\n\t#pragma unroll_loop_end\n\t#if UNION_CLIPPING_PLANES < NUM_CLIPPING_PLANES\n\t\tbool clipped = true;\n\t\t#pragma unroll_loop_start\n\t\tfor ( int i = UNION_CLIPPING_PLANES; i < NUM_CLIPPING_PLANES; i ++ ) {\n\t\t\tplane = clippingPlanes[ i ];\n\t\t\tclipped = ( dot( vClipPosition, plane.xyz ) > plane.w ) && clipped;\n\t\t}\n\t\t#pragma unroll_loop_end\n\t\tif ( clipped ) discard;\n\t#endif\n#endif",clipping_planes_pars_fragment:"#if NUM_CLIPPING_PLANES > 0\n\tvarying vec3 vClipPosition;\n\tuniform vec4 clippingPlanes[ NUM_CLIPPING_PLANES ];\n#endif",clipping_planes_pars_vertex:"#if NUM_CLIPPING_PLANES > 0\n\tvarying vec3 vClipPosition;\n#endif",clipping_planes_vertex:"#if NUM_CLIPPING_PLANES > 0\n\tvClipPosition = - mvPosition.xyz;\n#endif",color_fragment:"#if defined( USE_COLOR_ALPHA )\n\tdiffuseColor *= vColor;\n#elif defined( USE_COLOR )\n\tdiffuseColor.rgb *= vColor;\n#endif",color_pars_fragment:"#if defined( USE_COLOR_ALPHA )\n\tvarying vec4 vColor;\n#elif defined( USE_COLOR )\n\tvarying vec3 vColor;\n#endif",color_pars_vertex:"#if defined( USE_COLOR_ALPHA )\n\tvarying vec4 vColor;\n#elif defined( USE_COLOR ) || defined( USE_INSTANCING_COLOR )\n\tvarying vec3 vColor;\n#endif",color_vertex:"#if defined( USE_COLOR_ALPHA )\n\tvColor = vec4( 1.0 );\n#elif defined( USE_COLOR ) || defined( USE_INSTANCING_COLOR )\n\tvColor = vec3( 1.0 );\n#endif\n#ifdef USE_COLOR\n\tvColor *= color;\n#endif\n#ifdef USE_INSTANCING_COLOR\n\tvColor.xyz *= instanceColor.xyz;\n#endif",common:"#define PI 3.141592653589793\n#define PI2 6.283185307179586\n#define PI_HALF 1.5707963267948966\n#define RECIPROCAL_PI 0.3183098861837907\n#define RECIPROCAL_PI2 0.15915494309189535\n#define EPSILON 1e-6\n#ifndef saturate\n#define saturate( a ) clamp( a, 0.0, 1.0 )\n#endif\n#define whiteComplement( a ) ( 1.0 - saturate( a ) )\nfloat pow2( const in float x ) { return x*x; }\nfloat pow3( const in float x ) { return x*x*x; }\nfloat pow4( const in float x ) { float x2 = x*x; return x2*x2; }\nfloat max3( const in vec3 v ) { return max( max( v.x, v.y ), v.z ); }\nfloat average( const in vec3 color ) { return dot( color, vec3( 0.3333 ) ); }\nhighp float rand( const in vec2 uv ) {\n\tconst highp float a = 12.9898, b = 78.233, c = 43758.5453;\n\thighp float dt = dot( uv.xy, vec2( a,b ) ), sn = mod( dt, PI );\n\treturn fract( sin( sn ) * c );\n}\n#ifdef HIGH_PRECISION\n\tfloat precisionSafeLength( vec3 v ) { return length( v ); }\n#else\n\tfloat precisionSafeLength( vec3 v ) {\n\t\tfloat maxComponent = max3( abs( v ) );\n\t\treturn length( v / maxComponent ) * maxComponent;\n\t}\n#endif\nstruct IncidentLight {\n\tvec3 color;\n\tvec3 direction;\n\tbool visible;\n};\nstruct ReflectedLight {\n\tvec3 directDiffuse;\n\tvec3 directSpecular;\n\tvec3 indirectDiffuse;\n\tvec3 indirectSpecular;\n};\nstruct GeometricContext {\n\tvec3 position;\n\tvec3 normal;\n\tvec3 viewDir;\n#ifdef USE_CLEARCOAT\n\tvec3 clearcoatNormal;\n#endif\n};\nvec3 transformDirection( in vec3 dir, in mat4 matrix ) {\n\treturn normalize( ( matrix * vec4( dir, 0.0 ) ).xyz );\n}\nvec3 inverseTransformDirection( in vec3 dir, in mat4 matrix ) {\n\treturn normalize( ( vec4( dir, 0.0 ) * matrix ).xyz );\n}\nmat3 transposeMat3( const in mat3 m ) {\n\tmat3 tmp;\n\ttmp[ 0 ] = vec3( m[ 0 ].x, m[ 1 ].x, m[ 2 ].x );\n\ttmp[ 1 ] = vec3( m[ 0 ].y, m[ 1 ].y, m[ 2 ].y );\n\ttmp[ 2 ] = vec3( m[ 0 ].z, m[ 1 ].z, m[ 2 ].z );\n\treturn tmp;\n}\nfloat linearToRelativeLuminance( const in vec3 color ) {\n\tvec3 weights = vec3( 0.2126, 0.7152, 0.0722 );\n\treturn dot( weights, color.rgb );\n}\nbool isPerspectiveMatrix( mat4 m ) {\n\treturn m[ 2 ][ 3 ] == - 1.0;\n}\nvec2 equirectUv( in vec3 dir ) {\n\tfloat u = atan( dir.z, dir.x ) * RECIPROCAL_PI2 + 0.5;\n\tfloat v = asin( clamp( dir.y, - 1.0, 1.0 ) ) * RECIPROCAL_PI + 0.5;\n\treturn vec2( u, v );\n}",cube_uv_reflection_fragment:"#ifdef ENVMAP_TYPE_CUBE_UV\n\t#define cubeUV_maxMipLevel 8.0\n\t#define cubeUV_minMipLevel 4.0\n\t#define cubeUV_maxTileSize 256.0\n\t#define cubeUV_minTileSize 16.0\n\tfloat getFace( vec3 direction ) {\n\t\tvec3 absDirection = abs( direction );\n\t\tfloat face = - 1.0;\n\t\tif ( absDirection.x > absDirection.z ) {\n\t\t\tif ( absDirection.x > absDirection.y )\n\t\t\t\tface = direction.x > 0.0 ? 0.0 : 3.0;\n\t\t\telse\n\t\t\t\tface = direction.y > 0.0 ? 1.0 : 4.0;\n\t\t} else {\n\t\t\tif ( absDirection.z > absDirection.y )\n\t\t\t\tface = direction.z > 0.0 ? 2.0 : 5.0;\n\t\t\telse\n\t\t\t\tface = direction.y > 0.0 ? 1.0 : 4.0;\n\t\t}\n\t\treturn face;\n\t}\n\tvec2 getUV( vec3 direction, float face ) {\n\t\tvec2 uv;\n\t\tif ( face == 0.0 ) {\n\t\t\tuv = vec2( direction.z, direction.y ) / abs( direction.x );\n\t\t} else if ( face == 1.0 ) {\n\t\t\tuv = vec2( - direction.x, - direction.z ) / abs( direction.y );\n\t\t} else if ( face == 2.0 ) {\n\t\t\tuv = vec2( - direction.x, direction.y ) / abs( direction.z );\n\t\t} else if ( face == 3.0 ) {\n\t\t\tuv = vec2( - direction.z, direction.y ) / abs( direction.x );\n\t\t} else if ( face == 4.0 ) {\n\t\t\tuv = vec2( - direction.x, direction.z ) / abs( direction.y );\n\t\t} else {\n\t\t\tuv = vec2( direction.x, direction.y ) / abs( direction.z );\n\t\t}\n\t\treturn 0.5 * ( uv + 1.0 );\n\t}\n\tvec3 bilinearCubeUV( sampler2D envMap, vec3 direction, float mipInt ) {\n\t\tfloat face = getFace( direction );\n\t\tfloat filterInt = max( cubeUV_minMipLevel - mipInt, 0.0 );\n\t\tmipInt = max( mipInt, cubeUV_minMipLevel );\n\t\tfloat faceSize = exp2( mipInt );\n\t\tfloat texelSize = 1.0 / ( 3.0 * cubeUV_maxTileSize );\n\t\tvec2 uv = getUV( direction, face ) * ( faceSize - 1.0 );\n\t\tvec2 f = fract( uv );\n\t\tuv += 0.5 - f;\n\t\tif ( face > 2.0 ) {\n\t\t\tuv.y += faceSize;\n\t\t\tface -= 3.0;\n\t\t}\n\t\tuv.x += face * faceSize;\n\t\tif ( mipInt < cubeUV_maxMipLevel ) {\n\t\t\tuv.y += 2.0 * cubeUV_maxTileSize;\n\t\t}\n\t\tuv.y += filterInt * 2.0 * cubeUV_minTileSize;\n\t\tuv.x += 3.0 * max( 0.0, cubeUV_maxTileSize - 2.0 * faceSize );\n\t\tuv *= texelSize;\n\t\tvec3 tl = envMapTexelToLinear( texture2D( envMap, uv ) ).rgb;\n\t\tuv.x += texelSize;\n\t\tvec3 tr = envMapTexelToLinear( texture2D( envMap, uv ) ).rgb;\n\t\tuv.y += texelSize;\n\t\tvec3 br = envMapTexelToLinear( texture2D( envMap, uv ) ).rgb;\n\t\tuv.x -= texelSize;\n\t\tvec3 bl = envMapTexelToLinear( texture2D( envMap, uv ) ).rgb;\n\t\tvec3 tm = mix( tl, tr, f.x );\n\t\tvec3 bm = mix( bl, br, f.x );\n\t\treturn mix( tm, bm, f.y );\n\t}\n\t#define r0 1.0\n\t#define v0 0.339\n\t#define m0 - 2.0\n\t#define r1 0.8\n\t#define v1 0.276\n\t#define m1 - 1.0\n\t#define r4 0.4\n\t#define v4 0.046\n\t#define m4 2.0\n\t#define r5 0.305\n\t#define v5 0.016\n\t#define m5 3.0\n\t#define r6 0.21\n\t#define v6 0.0038\n\t#define m6 4.0\n\tfloat roughnessToMip( float roughness ) {\n\t\tfloat mip = 0.0;\n\t\tif ( roughness >= r1 ) {\n\t\t\tmip = ( r0 - roughness ) * ( m1 - m0 ) / ( r0 - r1 ) + m0;\n\t\t} else if ( roughness >= r4 ) {\n\t\t\tmip = ( r1 - roughness ) * ( m4 - m1 ) / ( r1 - r4 ) + m1;\n\t\t} else if ( roughness >= r5 ) {\n\t\t\tmip = ( r4 - roughness ) * ( m5 - m4 ) / ( r4 - r5 ) + m4;\n\t\t} else if ( roughness >= r6 ) {\n\t\t\tmip = ( r5 - roughness ) * ( m6 - m5 ) / ( r5 - r6 ) + m5;\n\t\t} else {\n\t\t\tmip = - 2.0 * log2( 1.16 * roughness );\t\t}\n\t\treturn mip;\n\t}\n\tvec4 textureCubeUV( sampler2D envMap, vec3 sampleDir, float roughness ) {\n\t\tfloat mip = clamp( roughnessToMip( roughness ), m0, cubeUV_maxMipLevel );\n\t\tfloat mipF = fract( mip );\n\t\tfloat mipInt = floor( mip );\n\t\tvec3 color0 = bilinearCubeUV( envMap, sampleDir, mipInt );\n\t\tif ( mipF == 0.0 ) {\n\t\t\treturn vec4( color0, 1.0 );\n\t\t} else {\n\t\t\tvec3 color1 = bilinearCubeUV( envMap, sampleDir, mipInt + 1.0 );\n\t\t\treturn vec4( mix( color0, color1, mipF ), 1.0 );\n\t\t}\n\t}\n#endif",defaultnormal_vertex:"vec3 transformedNormal = objectNormal;\n#ifdef USE_INSTANCING\n\tmat3 m = mat3( instanceMatrix );\n\ttransformedNormal /= vec3( dot( m[ 0 ], m[ 0 ] ), dot( m[ 1 ], m[ 1 ] ), dot( m[ 2 ], m[ 2 ] ) );\n\ttransformedNormal = m * transformedNormal;\n#endif\ntransformedNormal = normalMatrix * transformedNormal;\n#ifdef FLIP_SIDED\n\ttransformedNormal = - transformedNormal;\n#endif\n#ifdef USE_TANGENT\n\tvec3 transformedTangent = ( modelViewMatrix * vec4( objectTangent, 0.0 ) ).xyz;\n\t#ifdef FLIP_SIDED\n\t\ttransformedTangent = - transformedTangent;\n\t#endif\n#endif",displacementmap_pars_vertex:"#ifdef USE_DISPLACEMENTMAP\n\tuniform sampler2D displacementMap;\n\tuniform float displacementScale;\n\tuniform float displacementBias;\n#endif",displacementmap_vertex:"#ifdef USE_DISPLACEMENTMAP\n\ttransformed += normalize( objectNormal ) * ( texture2D( displacementMap, vUv ).x * displacementScale + displacementBias );\n#endif",emissivemap_fragment:"#ifdef USE_EMISSIVEMAP\n\tvec4 emissiveColor = texture2D( emissiveMap, vUv );\n\temissiveColor.rgb = emissiveMapTexelToLinear( emissiveColor ).rgb;\n\ttotalEmissiveRadiance *= emissiveColor.rgb;\n#endif",emissivemap_pars_fragment:"#ifdef USE_EMISSIVEMAP\n\tuniform sampler2D emissiveMap;\n#endif",encodings_fragment:"gl_FragColor = linearToOutputTexel( gl_FragColor );",encodings_pars_fragment:"\nvec4 LinearToLinear( in vec4 value ) {\n\treturn value;\n}\nvec4 GammaToLinear( in vec4 value, in float gammaFactor ) {\n\treturn vec4( pow( value.rgb, vec3( gammaFactor ) ), value.a );\n}\nvec4 LinearToGamma( in vec4 value, in float gammaFactor ) {\n\treturn vec4( pow( value.rgb, vec3( 1.0 / gammaFactor ) ), value.a );\n}\nvec4 sRGBToLinear( in vec4 value ) {\n\treturn vec4( mix( pow( value.rgb * 0.9478672986 + vec3( 0.0521327014 ), vec3( 2.4 ) ), value.rgb * 0.0773993808, vec3( lessThanEqual( value.rgb, vec3( 0.04045 ) ) ) ), value.a );\n}\nvec4 LinearTosRGB( in vec4 value ) {\n\treturn vec4( mix( pow( value.rgb, vec3( 0.41666 ) ) * 1.055 - vec3( 0.055 ), value.rgb * 12.92, vec3( lessThanEqual( value.rgb, vec3( 0.0031308 ) ) ) ), value.a );\n}\nvec4 RGBEToLinear( in vec4 value ) {\n\treturn vec4( value.rgb * exp2( value.a * 255.0 - 128.0 ), 1.0 );\n}\nvec4 LinearToRGBE( in vec4 value ) {\n\tfloat maxComponent = max( max( value.r, value.g ), value.b );\n\tfloat fExp = clamp( ceil( log2( maxComponent ) ), -128.0, 127.0 );\n\treturn vec4( value.rgb / exp2( fExp ), ( fExp + 128.0 ) / 255.0 );\n}\nvec4 RGBMToLinear( in vec4 value, in float maxRange ) {\n\treturn vec4( value.rgb * value.a * maxRange, 1.0 );\n}\nvec4 LinearToRGBM( in vec4 value, in float maxRange ) {\n\tfloat maxRGB = max( value.r, max( value.g, value.b ) );\n\tfloat M = clamp( maxRGB / maxRange, 0.0, 1.0 );\n\tM = ceil( M * 255.0 ) / 255.0;\n\treturn vec4( value.rgb / ( M * maxRange ), M );\n}\nvec4 RGBDToLinear( in vec4 value, in float maxRange ) {\n\treturn vec4( value.rgb * ( ( maxRange / 255.0 ) / value.a ), 1.0 );\n}\nvec4 LinearToRGBD( in vec4 value, in float maxRange ) {\n\tfloat maxRGB = max( value.r, max( value.g, value.b ) );\n\tfloat D = max( maxRange / maxRGB, 1.0 );\n\tD = clamp( floor( D ) / 255.0, 0.0, 1.0 );\n\treturn vec4( value.rgb * ( D * ( 255.0 / maxRange ) ), D );\n}",envmap_fragment:"#ifdef USE_ENVMAP\n\t#ifdef ENV_WORLDPOS\n\t\tvec3 cameraToFrag;\n\t\tif ( isOrthographic ) {\n\t\t\tcameraToFrag = normalize( vec3( - viewMatrix[ 0 ][ 2 ], - viewMatrix[ 1 ][ 2 ], - viewMatrix[ 2 ][ 2 ] ) );\n\t\t} else {\n\t\t\tcameraToFrag = normalize( vWorldPosition - cameraPosition );\n\t\t}\n\t\tvec3 worldNormal = inverseTransformDirection( normal, viewMatrix );\n\t\t#ifdef ENVMAP_MODE_REFLECTION\n\t\t\tvec3 reflectVec = reflect( cameraToFrag, worldNormal );\n\t\t#else\n\t\t\tvec3 reflectVec = refract( cameraToFrag, worldNormal, refractionRatio );\n\t\t#endif\n\t#else\n\t\tvec3 reflectVec = vReflect;\n\t#endif\n\t#ifdef ENVMAP_TYPE_CUBE\n\t\tvec4 envColor = textureCube( envMap, vec3( flipEnvMap * reflectVec.x, reflectVec.yz ) );\n\t\tenvColor = envMapTexelToLinear( envColor );\n\t#elif defined( ENVMAP_TYPE_CUBE_UV )\n\t\tvec4 envColor = textureCubeUV( envMap, reflectVec, 0.0 );\n\t#else\n\t\tvec4 envColor = vec4( 0.0 );\n\t#endif\n\t#ifdef ENVMAP_BLENDING_MULTIPLY\n\t\toutgoingLight = mix( outgoingLight, outgoingLight * envColor.xyz, specularStrength * reflectivity );\n\t#elif defined( ENVMAP_BLENDING_MIX )\n\t\toutgoingLight = mix( outgoingLight, envColor.xyz, specularStrength * reflectivity );\n\t#elif defined( ENVMAP_BLENDING_ADD )\n\t\toutgoingLight += envColor.xyz * specularStrength * reflectivity;\n\t#endif\n#endif",envmap_common_pars_fragment:"#ifdef USE_ENVMAP\n\tuniform float envMapIntensity;\n\tuniform float flipEnvMap;\n\t#ifdef ENVMAP_TYPE_CUBE\n\t\tuniform samplerCube envMap;\n\t#else\n\t\tuniform sampler2D envMap;\n\t#endif\n\t\n#endif",envmap_pars_fragment:"#ifdef USE_ENVMAP\n\tuniform float reflectivity;\n\t#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG )\n\t\t#define ENV_WORLDPOS\n\t#endif\n\t#ifdef ENV_WORLDPOS\n\t\tvarying vec3 vWorldPosition;\n\t\tuniform float refractionRatio;\n\t#else\n\t\tvarying vec3 vReflect;\n\t#endif\n#endif",envmap_pars_vertex:"#ifdef USE_ENVMAP\n\t#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) ||defined( PHONG )\n\t\t#define ENV_WORLDPOS\n\t#endif\n\t#ifdef ENV_WORLDPOS\n\t\t\n\t\tvarying vec3 vWorldPosition;\n\t#else\n\t\tvarying vec3 vReflect;\n\t\tuniform float refractionRatio;\n\t#endif\n#endif",envmap_physical_pars_fragment:"#if defined( USE_ENVMAP )\n\t#ifdef ENVMAP_MODE_REFRACTION\n\t\tuniform float refractionRatio;\n\t#endif\n\tvec3 getIBLIrradiance( const in vec3 normal ) {\n\t\t#if defined( ENVMAP_TYPE_CUBE_UV )\n\t\t\tvec3 worldNormal = inverseTransformDirection( normal, viewMatrix );\n\t\t\tvec4 envMapColor = textureCubeUV( envMap, worldNormal, 1.0 );\n\t\t\treturn PI * envMapColor.rgb * envMapIntensity;\n\t\t#else\n\t\t\treturn vec3( 0.0 );\n\t\t#endif\n\t}\n\tvec3 getIBLRadiance( const in vec3 viewDir, const in vec3 normal, const in float roughness ) {\n\t\t#if defined( ENVMAP_TYPE_CUBE_UV )\n\t\t\tvec3 reflectVec;\n\t\t\t#ifdef ENVMAP_MODE_REFLECTION\n\t\t\t\treflectVec = reflect( - viewDir, normal );\n\t\t\t\treflectVec = normalize( mix( reflectVec, normal, roughness * roughness) );\n\t\t\t#else\n\t\t\t\treflectVec = refract( - viewDir, normal, refractionRatio );\n\t\t\t#endif\n\t\t\treflectVec = inverseTransformDirection( reflectVec, viewMatrix );\n\t\t\tvec4 envMapColor = textureCubeUV( envMap, reflectVec, roughness );\n\t\t\treturn envMapColor.rgb * envMapIntensity;\n\t\t#else\n\t\t\treturn vec3( 0.0 );\n\t\t#endif\n\t}\n#endif",envmap_vertex:"#ifdef USE_ENVMAP\n\t#ifdef ENV_WORLDPOS\n\t\tvWorldPosition = worldPosition.xyz;\n\t#else\n\t\tvec3 cameraToVertex;\n\t\tif ( isOrthographic ) {\n\t\t\tcameraToVertex = normalize( vec3( - viewMatrix[ 0 ][ 2 ], - viewMatrix[ 1 ][ 2 ], - viewMatrix[ 2 ][ 2 ] ) );\n\t\t} else {\n\t\t\tcameraToVertex = normalize( worldPosition.xyz - cameraPosition );\n\t\t}\n\t\tvec3 worldNormal = inverseTransformDirection( transformedNormal, viewMatrix );\n\t\t#ifdef ENVMAP_MODE_REFLECTION\n\t\t\tvReflect = reflect( cameraToVertex, worldNormal );\n\t\t#else\n\t\t\tvReflect = refract( cameraToVertex, worldNormal, refractionRatio );\n\t\t#endif\n\t#endif\n#endif",fog_vertex:"#ifdef USE_FOG\n\tvFogDepth = - mvPosition.z;\n#endif",fog_pars_vertex:"#ifdef USE_FOG\n\tvarying float vFogDepth;\n#endif",fog_fragment:"#ifdef USE_FOG\n\t#ifdef FOG_EXP2\n\t\tfloat fogFactor = 1.0 - exp( - fogDensity * fogDensity * vFogDepth * vFogDepth );\n\t#else\n\t\tfloat fogFactor = smoothstep( fogNear, fogFar, vFogDepth );\n\t#endif\n\tgl_FragColor.rgb = mix( gl_FragColor.rgb, fogColor, fogFactor );\n#endif",fog_pars_fragment:"#ifdef USE_FOG\n\tuniform vec3 fogColor;\n\tvarying float vFogDepth;\n\t#ifdef FOG_EXP2\n\t\tuniform float fogDensity;\n\t#else\n\t\tuniform float fogNear;\n\t\tuniform float fogFar;\n\t#endif\n#endif",gradientmap_pars_fragment:"#ifdef USE_GRADIENTMAP\n\tuniform sampler2D gradientMap;\n#endif\nvec3 getGradientIrradiance( vec3 normal, vec3 lightDirection ) {\n\tfloat dotNL = dot( normal, lightDirection );\n\tvec2 coord = vec2( dotNL * 0.5 + 0.5, 0.0 );\n\t#ifdef USE_GRADIENTMAP\n\t\treturn texture2D( gradientMap, coord ).rgb;\n\t#else\n\t\treturn ( coord.x < 0.7 ) ? vec3( 0.7 ) : vec3( 1.0 );\n\t#endif\n}",lightmap_fragment:"#ifdef USE_LIGHTMAP\n\tvec4 lightMapTexel = texture2D( lightMap, vUv2 );\n\tvec3 lightMapIrradiance = lightMapTexelToLinear( lightMapTexel ).rgb * lightMapIntensity;\n\t#ifndef PHYSICALLY_CORRECT_LIGHTS\n\t\tlightMapIrradiance *= PI;\n\t#endif\n\treflectedLight.indirectDiffuse += lightMapIrradiance;\n#endif",lightmap_pars_fragment:"#ifdef USE_LIGHTMAP\n\tuniform sampler2D lightMap;\n\tuniform float lightMapIntensity;\n#endif",lights_lambert_vertex:"vec3 diffuse = vec3( 1.0 );\nGeometricContext geometry;\ngeometry.position = mvPosition.xyz;\ngeometry.normal = normalize( transformedNormal );\ngeometry.viewDir = ( isOrthographic ) ? vec3( 0, 0, 1 ) : normalize( -mvPosition.xyz );\nGeometricContext backGeometry;\nbackGeometry.position = geometry.position;\nbackGeometry.normal = -geometry.normal;\nbackGeometry.viewDir = geometry.viewDir;\nvLightFront = vec3( 0.0 );\nvIndirectFront = vec3( 0.0 );\n#ifdef DOUBLE_SIDED\n\tvLightBack = vec3( 0.0 );\n\tvIndirectBack = vec3( 0.0 );\n#endif\nIncidentLight directLight;\nfloat dotNL;\nvec3 directLightColor_Diffuse;\nvIndirectFront += getAmbientLightIrradiance( ambientLightColor );\nvIndirectFront += getLightProbeIrradiance( lightProbe, geometry.normal );\n#ifdef DOUBLE_SIDED\n\tvIndirectBack += getAmbientLightIrradiance( ambientLightColor );\n\tvIndirectBack += getLightProbeIrradiance( lightProbe, backGeometry.normal );\n#endif\n#if NUM_POINT_LIGHTS > 0\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_POINT_LIGHTS; i ++ ) {\n\t\tgetPointLightInfo( pointLights[ i ], geometry, directLight );\n\t\tdotNL = dot( geometry.normal, directLight.direction );\n\t\tdirectLightColor_Diffuse = directLight.color;\n\t\tvLightFront += saturate( dotNL ) * directLightColor_Diffuse;\n\t\t#ifdef DOUBLE_SIDED\n\t\t\tvLightBack += saturate( - dotNL ) * directLightColor_Diffuse;\n\t\t#endif\n\t}\n\t#pragma unroll_loop_end\n#endif\n#if NUM_SPOT_LIGHTS > 0\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_SPOT_LIGHTS; i ++ ) {\n\t\tgetSpotLightInfo( spotLights[ i ], geometry, directLight );\n\t\tdotNL = dot( geometry.normal, directLight.direction );\n\t\tdirectLightColor_Diffuse = directLight.color;\n\t\tvLightFront += saturate( dotNL ) * directLightColor_Diffuse;\n\t\t#ifdef DOUBLE_SIDED\n\t\t\tvLightBack += saturate( - dotNL ) * directLightColor_Diffuse;\n\t\t#endif\n\t}\n\t#pragma unroll_loop_end\n#endif\n#if NUM_DIR_LIGHTS > 0\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_DIR_LIGHTS; i ++ ) {\n\t\tgetDirectionalLightInfo( directionalLights[ i ], geometry, directLight );\n\t\tdotNL = dot( geometry.normal, directLight.direction );\n\t\tdirectLightColor_Diffuse = directLight.color;\n\t\tvLightFront += saturate( dotNL ) * directLightColor_Diffuse;\n\t\t#ifdef DOUBLE_SIDED\n\t\t\tvLightBack += saturate( - dotNL ) * directLightColor_Diffuse;\n\t\t#endif\n\t}\n\t#pragma unroll_loop_end\n#endif\n#if NUM_HEMI_LIGHTS > 0\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_HEMI_LIGHTS; i ++ ) {\n\t\tvIndirectFront += getHemisphereLightIrradiance( hemisphereLights[ i ], geometry.normal );\n\t\t#ifdef DOUBLE_SIDED\n\t\t\tvIndirectBack += getHemisphereLightIrradiance( hemisphereLights[ i ], backGeometry.normal );\n\t\t#endif\n\t}\n\t#pragma unroll_loop_end\n#endif",lights_pars_begin:"uniform bool receiveShadow;\nuniform vec3 ambientLightColor;\nuniform vec3 lightProbe[ 9 ];\nvec3 shGetIrradianceAt( in vec3 normal, in vec3 shCoefficients[ 9 ] ) {\n\tfloat x = normal.x, y = normal.y, z = normal.z;\n\tvec3 result = shCoefficients[ 0 ] * 0.886227;\n\tresult += shCoefficients[ 1 ] * 2.0 * 0.511664 * y;\n\tresult += shCoefficients[ 2 ] * 2.0 * 0.511664 * z;\n\tresult += shCoefficients[ 3 ] * 2.0 * 0.511664 * x;\n\tresult += shCoefficients[ 4 ] * 2.0 * 0.429043 * x * y;\n\tresult += shCoefficients[ 5 ] * 2.0 * 0.429043 * y * z;\n\tresult += shCoefficients[ 6 ] * ( 0.743125 * z * z - 0.247708 );\n\tresult += shCoefficients[ 7 ] * 2.0 * 0.429043 * x * z;\n\tresult += shCoefficients[ 8 ] * 0.429043 * ( x * x - y * y );\n\treturn result;\n}\nvec3 getLightProbeIrradiance( const in vec3 lightProbe[ 9 ], const in vec3 normal ) {\n\tvec3 worldNormal = inverseTransformDirection( normal, viewMatrix );\n\tvec3 irradiance = shGetIrradianceAt( worldNormal, lightProbe );\n\treturn irradiance;\n}\nvec3 getAmbientLightIrradiance( const in vec3 ambientLightColor ) {\n\tvec3 irradiance = ambientLightColor;\n\treturn irradiance;\n}\nfloat getDistanceAttenuation( const in float lightDistance, const in float cutoffDistance, const in float decayExponent ) {\n\t#if defined ( PHYSICALLY_CORRECT_LIGHTS )\n\t\tfloat distanceFalloff = 1.0 / max( pow( lightDistance, decayExponent ), 0.01 );\n\t\tif ( cutoffDistance > 0.0 ) {\n\t\t\tdistanceFalloff *= pow2( saturate( 1.0 - pow4( lightDistance / cutoffDistance ) ) );\n\t\t}\n\t\treturn distanceFalloff;\n\t#else\n\t\tif ( cutoffDistance > 0.0 && decayExponent > 0.0 ) {\n\t\t\treturn pow( saturate( - lightDistance / cutoffDistance + 1.0 ), decayExponent );\n\t\t}\n\t\treturn 1.0;\n\t#endif\n}\nfloat getSpotAttenuation( const in float coneCosine, const in float penumbraCosine, const in float angleCosine ) {\n\treturn smoothstep( coneCosine, penumbraCosine, angleCosine );\n}\n#if NUM_DIR_LIGHTS > 0\n\tstruct DirectionalLight {\n\t\tvec3 direction;\n\t\tvec3 color;\n\t};\n\tuniform DirectionalLight directionalLights[ NUM_DIR_LIGHTS ];\n\tvoid getDirectionalLightInfo( const in DirectionalLight directionalLight, const in GeometricContext geometry, out IncidentLight light ) {\n\t\tlight.color = directionalLight.color;\n\t\tlight.direction = directionalLight.direction;\n\t\tlight.visible = true;\n\t}\n#endif\n#if NUM_POINT_LIGHTS > 0\n\tstruct PointLight {\n\t\tvec3 position;\n\t\tvec3 color;\n\t\tfloat distance;\n\t\tfloat decay;\n\t};\n\tuniform PointLight pointLights[ NUM_POINT_LIGHTS ];\n\tvoid getPointLightInfo( const in PointLight pointLight, const in GeometricContext geometry, out IncidentLight light ) {\n\t\tvec3 lVector = pointLight.position - geometry.position;\n\t\tlight.direction = normalize( lVector );\n\t\tfloat lightDistance = length( lVector );\n\t\tlight.color = pointLight.color;\n\t\tlight.color *= getDistanceAttenuation( lightDistance, pointLight.distance, pointLight.decay );\n\t\tlight.visible = ( light.color != vec3( 0.0 ) );\n\t}\n#endif\n#if NUM_SPOT_LIGHTS > 0\n\tstruct SpotLight {\n\t\tvec3 position;\n\t\tvec3 direction;\n\t\tvec3 color;\n\t\tfloat distance;\n\t\tfloat decay;\n\t\tfloat coneCos;\n\t\tfloat penumbraCos;\n\t};\n\tuniform SpotLight spotLights[ NUM_SPOT_LIGHTS ];\n\tvoid getSpotLightInfo( const in SpotLight spotLight, const in GeometricContext geometry, out IncidentLight light ) {\n\t\tvec3 lVector = spotLight.position - geometry.position;\n\t\tlight.direction = normalize( lVector );\n\t\tfloat angleCos = dot( light.direction, spotLight.direction );\n\t\tfloat spotAttenuation = getSpotAttenuation( spotLight.coneCos, spotLight.penumbraCos, angleCos );\n\t\tif ( spotAttenuation > 0.0 ) {\n\t\t\tfloat lightDistance = length( lVector );\n\t\t\tlight.color = spotLight.color * spotAttenuation;\n\t\t\tlight.color *= getDistanceAttenuation( lightDistance, spotLight.distance, spotLight.decay );\n\t\t\tlight.visible = ( light.color != vec3( 0.0 ) );\n\t\t} else {\n\t\t\tlight.color = vec3( 0.0 );\n\t\t\tlight.visible = false;\n\t\t}\n\t}\n#endif\n#if NUM_RECT_AREA_LIGHTS > 0\n\tstruct RectAreaLight {\n\t\tvec3 color;\n\t\tvec3 position;\n\t\tvec3 halfWidth;\n\t\tvec3 halfHeight;\n\t};\n\tuniform sampler2D ltc_1;\tuniform sampler2D ltc_2;\n\tuniform RectAreaLight rectAreaLights[ NUM_RECT_AREA_LIGHTS ];\n#endif\n#if NUM_HEMI_LIGHTS > 0\n\tstruct HemisphereLight {\n\t\tvec3 direction;\n\t\tvec3 skyColor;\n\t\tvec3 groundColor;\n\t};\n\tuniform HemisphereLight hemisphereLights[ NUM_HEMI_LIGHTS ];\n\tvec3 getHemisphereLightIrradiance( const in HemisphereLight hemiLight, const in vec3 normal ) {\n\t\tfloat dotNL = dot( normal, hemiLight.direction );\n\t\tfloat hemiDiffuseWeight = 0.5 * dotNL + 0.5;\n\t\tvec3 irradiance = mix( hemiLight.groundColor, hemiLight.skyColor, hemiDiffuseWeight );\n\t\treturn irradiance;\n\t}\n#endif",lights_toon_fragment:"ToonMaterial material;\nmaterial.diffuseColor = diffuseColor.rgb;",lights_toon_pars_fragment:"varying vec3 vViewPosition;\nstruct ToonMaterial {\n\tvec3 diffuseColor;\n};\nvoid RE_Direct_Toon( const in IncidentLight directLight, const in GeometricContext geometry, const in ToonMaterial material, inout ReflectedLight reflectedLight ) {\n\tvec3 irradiance = getGradientIrradiance( geometry.normal, directLight.direction ) * directLight.color;\n\treflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n}\nvoid RE_IndirectDiffuse_Toon( const in vec3 irradiance, const in GeometricContext geometry, const in ToonMaterial material, inout ReflectedLight reflectedLight ) {\n\treflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n}\n#define RE_Direct\t\t\t\tRE_Direct_Toon\n#define RE_IndirectDiffuse\t\tRE_IndirectDiffuse_Toon\n#define Material_LightProbeLOD( material )\t(0)",lights_phong_fragment:"BlinnPhongMaterial material;\nmaterial.diffuseColor = diffuseColor.rgb;\nmaterial.specularColor = specular;\nmaterial.specularShininess = shininess;\nmaterial.specularStrength = specularStrength;",lights_phong_pars_fragment:"varying vec3 vViewPosition;\nstruct BlinnPhongMaterial {\n\tvec3 diffuseColor;\n\tvec3 specularColor;\n\tfloat specularShininess;\n\tfloat specularStrength;\n};\nvoid RE_Direct_BlinnPhong( const in IncidentLight directLight, const in GeometricContext geometry, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {\n\tfloat dotNL = saturate( dot( geometry.normal, directLight.direction ) );\n\tvec3 irradiance = dotNL * directLight.color;\n\treflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n\treflectedLight.directSpecular += irradiance * BRDF_BlinnPhong( directLight.direction, geometry.viewDir, geometry.normal, material.specularColor, material.specularShininess ) * material.specularStrength;\n}\nvoid RE_IndirectDiffuse_BlinnPhong( const in vec3 irradiance, const in GeometricContext geometry, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {\n\treflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n}\n#define RE_Direct\t\t\t\tRE_Direct_BlinnPhong\n#define RE_IndirectDiffuse\t\tRE_IndirectDiffuse_BlinnPhong\n#define Material_LightProbeLOD( material )\t(0)",lights_physical_fragment:"PhysicalMaterial material;\nmaterial.diffuseColor = diffuseColor.rgb * ( 1.0 - metalnessFactor );\nvec3 dxy = max( abs( dFdx( geometryNormal ) ), abs( dFdy( geometryNormal ) ) );\nfloat geometryRoughness = max( max( dxy.x, dxy.y ), dxy.z );\nmaterial.roughness = max( roughnessFactor, 0.0525 );material.roughness += geometryRoughness;\nmaterial.roughness = min( material.roughness, 1.0 );\n#ifdef IOR\n\t#ifdef SPECULAR\n\t\tfloat specularIntensityFactor = specularIntensity;\n\t\tvec3 specularColorFactor = specularColor;\n\t\t#ifdef USE_SPECULARINTENSITYMAP\n\t\t\tspecularIntensityFactor *= texture2D( specularIntensityMap, vUv ).a;\n\t\t#endif\n\t\t#ifdef USE_SPECULARCOLORMAP\n\t\t\tspecularColorFactor *= specularColorMapTexelToLinear( texture2D( specularColorMap, vUv ) ).rgb;\n\t\t#endif\n\t\tmaterial.specularF90 = mix( specularIntensityFactor, 1.0, metalnessFactor );\n\t#else\n\t\tfloat specularIntensityFactor = 1.0;\n\t\tvec3 specularColorFactor = vec3( 1.0 );\n\t\tmaterial.specularF90 = 1.0;\n\t#endif\n\tmaterial.specularColor = mix( min( pow2( ( ior - 1.0 ) / ( ior + 1.0 ) ) * specularColorFactor, vec3( 1.0 ) ) * specularIntensityFactor, diffuseColor.rgb, metalnessFactor );\n#else\n\tmaterial.specularColor = mix( vec3( 0.04 ), diffuseColor.rgb, metalnessFactor );\n\tmaterial.specularF90 = 1.0;\n#endif\n#ifdef USE_CLEARCOAT\n\tmaterial.clearcoat = clearcoat;\n\tmaterial.clearcoatRoughness = clearcoatRoughness;\n\tmaterial.clearcoatF0 = vec3( 0.04 );\n\tmaterial.clearcoatF90 = 1.0;\n\t#ifdef USE_CLEARCOATMAP\n\t\tmaterial.clearcoat *= texture2D( clearcoatMap, vUv ).x;\n\t#endif\n\t#ifdef USE_CLEARCOAT_ROUGHNESSMAP\n\t\tmaterial.clearcoatRoughness *= texture2D( clearcoatRoughnessMap, vUv ).y;\n\t#endif\n\tmaterial.clearcoat = saturate( material.clearcoat );\tmaterial.clearcoatRoughness = max( material.clearcoatRoughness, 0.0525 );\n\tmaterial.clearcoatRoughness += geometryRoughness;\n\tmaterial.clearcoatRoughness = min( material.clearcoatRoughness, 1.0 );\n#endif\n#ifdef USE_SHEEN\n\tmaterial.sheenColor = sheenColor;\n\t#ifdef USE_SHEENCOLORMAP\n\t\tmaterial.sheenColor *= sheenColorMapTexelToLinear( texture2D( sheenColorMap, vUv ) ).rgb;\n\t#endif\n\tmaterial.sheenRoughness = clamp( sheenRoughness, 0.07, 1.0 );\n\t#ifdef USE_SHEENROUGHNESSMAP\n\t\tmaterial.sheenRoughness *= texture2D( sheenRoughnessMap, vUv ).a;\n\t#endif\n#endif",lights_physical_pars_fragment:"struct PhysicalMaterial {\n\tvec3 diffuseColor;\n\tfloat roughness;\n\tvec3 specularColor;\n\tfloat specularF90;\n\t#ifdef USE_CLEARCOAT\n\t\tfloat clearcoat;\n\t\tfloat clearcoatRoughness;\n\t\tvec3 clearcoatF0;\n\t\tfloat clearcoatF90;\n\t#endif\n\t#ifdef USE_SHEEN\n\t\tvec3 sheenColor;\n\t\tfloat sheenRoughness;\n\t#endif\n};\nvec3 clearcoatSpecular = vec3( 0.0 );\nvec2 DFGApprox( const in vec3 normal, const in vec3 viewDir, const in float roughness ) {\n\tfloat dotNV = saturate( dot( normal, viewDir ) );\n\tconst vec4 c0 = vec4( - 1, - 0.0275, - 0.572, 0.022 );\n\tconst vec4 c1 = vec4( 1, 0.0425, 1.04, - 0.04 );\n\tvec4 r = roughness * c0 + c1;\n\tfloat a004 = min( r.x * r.x, exp2( - 9.28 * dotNV ) ) * r.x + r.y;\n\tvec2 fab = vec2( - 1.04, 1.04 ) * a004 + r.zw;\n\treturn fab;\n}\nvec3 EnvironmentBRDF( const in vec3 normal, const in vec3 viewDir, const in vec3 specularColor, const in float specularF90, const in float roughness ) {\n\tvec2 fab = DFGApprox( normal, viewDir, roughness );\n\treturn specularColor * fab.x + specularF90 * fab.y;\n}\nvoid computeMultiscattering( const in vec3 normal, const in vec3 viewDir, const in vec3 specularColor, const in float specularF90, const in float roughness, inout vec3 singleScatter, inout vec3 multiScatter ) {\n\tvec2 fab = DFGApprox( normal, viewDir, roughness );\n\tvec3 FssEss = specularColor * fab.x + specularF90 * fab.y;\n\tfloat Ess = fab.x + fab.y;\n\tfloat Ems = 1.0 - Ess;\n\tvec3 Favg = specularColor + ( 1.0 - specularColor ) * 0.047619;\tvec3 Fms = FssEss * Favg / ( 1.0 - Ems * Favg );\n\tsingleScatter += FssEss;\n\tmultiScatter += Fms * Ems;\n}\n#if NUM_RECT_AREA_LIGHTS > 0\n\tvoid RE_Direct_RectArea_Physical( const in RectAreaLight rectAreaLight, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {\n\t\tvec3 normal = geometry.normal;\n\t\tvec3 viewDir = geometry.viewDir;\n\t\tvec3 position = geometry.position;\n\t\tvec3 lightPos = rectAreaLight.position;\n\t\tvec3 halfWidth = rectAreaLight.halfWidth;\n\t\tvec3 halfHeight = rectAreaLight.halfHeight;\n\t\tvec3 lightColor = rectAreaLight.color;\n\t\tfloat roughness = material.roughness;\n\t\tvec3 rectCoords[ 4 ];\n\t\trectCoords[ 0 ] = lightPos + halfWidth - halfHeight;\t\trectCoords[ 1 ] = lightPos - halfWidth - halfHeight;\n\t\trectCoords[ 2 ] = lightPos - halfWidth + halfHeight;\n\t\trectCoords[ 3 ] = lightPos + halfWidth + halfHeight;\n\t\tvec2 uv = LTC_Uv( normal, viewDir, roughness );\n\t\tvec4 t1 = texture2D( ltc_1, uv );\n\t\tvec4 t2 = texture2D( ltc_2, uv );\n\t\tmat3 mInv = mat3(\n\t\t\tvec3( t1.x, 0, t1.y ),\n\t\t\tvec3(    0, 1,    0 ),\n\t\t\tvec3( t1.z, 0, t1.w )\n\t\t);\n\t\tvec3 fresnel = ( material.specularColor * t2.x + ( vec3( 1.0 ) - material.specularColor ) * t2.y );\n\t\treflectedLight.directSpecular += lightColor * fresnel * LTC_Evaluate( normal, viewDir, position, mInv, rectCoords );\n\t\treflectedLight.directDiffuse += lightColor * material.diffuseColor * LTC_Evaluate( normal, viewDir, position, mat3( 1.0 ), rectCoords );\n\t}\n#endif\nvoid RE_Direct_Physical( const in IncidentLight directLight, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {\n\tfloat dotNL = saturate( dot( geometry.normal, directLight.direction ) );\n\tvec3 irradiance = dotNL * directLight.color;\n\t#ifdef USE_CLEARCOAT\n\t\tfloat dotNLcc = saturate( dot( geometry.clearcoatNormal, directLight.direction ) );\n\t\tvec3 ccIrradiance = dotNLcc * directLight.color;\n\t\tclearcoatSpecular += ccIrradiance * BRDF_GGX( directLight.direction, geometry.viewDir, geometry.clearcoatNormal, material.clearcoatF0, material.clearcoatF90, material.clearcoatRoughness );\n\t#endif\n\t#ifdef USE_SHEEN\n\t\treflectedLight.directSpecular += irradiance * BRDF_Sheen( directLight.direction, geometry.viewDir, geometry.normal, material.sheenColor, material.sheenRoughness );\n\t#endif\n\treflectedLight.directSpecular += irradiance * BRDF_GGX( directLight.direction, geometry.viewDir, geometry.normal, material.specularColor, material.specularF90, material.roughness );\n\treflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n}\nvoid RE_IndirectDiffuse_Physical( const in vec3 irradiance, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {\n\treflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n}\nvoid RE_IndirectSpecular_Physical( const in vec3 radiance, const in vec3 irradiance, const in vec3 clearcoatRadiance, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight) {\n\t#ifdef USE_CLEARCOAT\n\t\tclearcoatSpecular += clearcoatRadiance * EnvironmentBRDF( geometry.clearcoatNormal, geometry.viewDir, material.clearcoatF0, material.clearcoatF90, material.clearcoatRoughness );\n\t#endif\n\tvec3 singleScattering = vec3( 0.0 );\n\tvec3 multiScattering = vec3( 0.0 );\n\tvec3 cosineWeightedIrradiance = irradiance * RECIPROCAL_PI;\n\tcomputeMultiscattering( geometry.normal, geometry.viewDir, material.specularColor, material.specularF90, material.roughness, singleScattering, multiScattering );\n\tvec3 diffuse = material.diffuseColor * ( 1.0 - ( singleScattering + multiScattering ) );\n\treflectedLight.indirectSpecular += radiance * singleScattering;\n\treflectedLight.indirectSpecular += multiScattering * cosineWeightedIrradiance;\n\treflectedLight.indirectDiffuse += diffuse * cosineWeightedIrradiance;\n}\n#define RE_Direct\t\t\t\tRE_Direct_Physical\n#define RE_Direct_RectArea\t\tRE_Direct_RectArea_Physical\n#define RE_IndirectDiffuse\t\tRE_IndirectDiffuse_Physical\n#define RE_IndirectSpecular\t\tRE_IndirectSpecular_Physical\nfloat computeSpecularOcclusion( const in float dotNV, const in float ambientOcclusion, const in float roughness ) {\n\treturn saturate( pow( dotNV + ambientOcclusion, exp2( - 16.0 * roughness - 1.0 ) ) - 1.0 + ambientOcclusion );\n}",lights_fragment_begin:"\nGeometricContext geometry;\ngeometry.position = - vViewPosition;\ngeometry.normal = normal;\ngeometry.viewDir = ( isOrthographic ) ? vec3( 0, 0, 1 ) : normalize( vViewPosition );\n#ifdef USE_CLEARCOAT\n\tgeometry.clearcoatNormal = clearcoatNormal;\n#endif\nIncidentLight directLight;\n#if ( NUM_POINT_LIGHTS > 0 ) && defined( RE_Direct )\n\tPointLight pointLight;\n\t#if defined( USE_SHADOWMAP ) && NUM_POINT_LIGHT_SHADOWS > 0\n\tPointLightShadow pointLightShadow;\n\t#endif\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_POINT_LIGHTS; i ++ ) {\n\t\tpointLight = pointLights[ i ];\n\t\tgetPointLightInfo( pointLight, geometry, directLight );\n\t\t#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_POINT_LIGHT_SHADOWS )\n\t\tpointLightShadow = pointLightShadows[ i ];\n\t\tdirectLight.color *= all( bvec2( directLight.visible, receiveShadow ) ) ? getPointShadow( pointShadowMap[ i ], pointLightShadow.shadowMapSize, pointLightShadow.shadowBias, pointLightShadow.shadowRadius, vPointShadowCoord[ i ], pointLightShadow.shadowCameraNear, pointLightShadow.shadowCameraFar ) : 1.0;\n\t\t#endif\n\t\tRE_Direct( directLight, geometry, material, reflectedLight );\n\t}\n\t#pragma unroll_loop_end\n#endif\n#if ( NUM_SPOT_LIGHTS > 0 ) && defined( RE_Direct )\n\tSpotLight spotLight;\n\t#if defined( USE_SHADOWMAP ) && NUM_SPOT_LIGHT_SHADOWS > 0\n\tSpotLightShadow spotLightShadow;\n\t#endif\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_SPOT_LIGHTS; i ++ ) {\n\t\tspotLight = spotLights[ i ];\n\t\tgetSpotLightInfo( spotLight, geometry, directLight );\n\t\t#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS )\n\t\tspotLightShadow = spotLightShadows[ i ];\n\t\tdirectLight.color *= all( bvec2( directLight.visible, receiveShadow ) ) ? getShadow( spotShadowMap[ i ], spotLightShadow.shadowMapSize, spotLightShadow.shadowBias, spotLightShadow.shadowRadius, vSpotShadowCoord[ i ] ) : 1.0;\n\t\t#endif\n\t\tRE_Direct( directLight, geometry, material, reflectedLight );\n\t}\n\t#pragma unroll_loop_end\n#endif\n#if ( NUM_DIR_LIGHTS > 0 ) && defined( RE_Direct )\n\tDirectionalLight directionalLight;\n\t#if defined( USE_SHADOWMAP ) && NUM_DIR_LIGHT_SHADOWS > 0\n\tDirectionalLightShadow directionalLightShadow;\n\t#endif\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_DIR_LIGHTS; i ++ ) {\n\t\tdirectionalLight = directionalLights[ i ];\n\t\tgetDirectionalLightInfo( directionalLight, geometry, directLight );\n\t\t#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_DIR_LIGHT_SHADOWS )\n\t\tdirectionalLightShadow = directionalLightShadows[ i ];\n\t\tdirectLight.color *= all( bvec2( directLight.visible, receiveShadow ) ) ? getShadow( directionalShadowMap[ i ], directionalLightShadow.shadowMapSize, directionalLightShadow.shadowBias, directionalLightShadow.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;\n\t\t#endif\n\t\tRE_Direct( directLight, geometry, material, reflectedLight );\n\t}\n\t#pragma unroll_loop_end\n#endif\n#if ( NUM_RECT_AREA_LIGHTS > 0 ) && defined( RE_Direct_RectArea )\n\tRectAreaLight rectAreaLight;\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_RECT_AREA_LIGHTS; i ++ ) {\n\t\trectAreaLight = rectAreaLights[ i ];\n\t\tRE_Direct_RectArea( rectAreaLight, geometry, material, reflectedLight );\n\t}\n\t#pragma unroll_loop_end\n#endif\n#if defined( RE_IndirectDiffuse )\n\tvec3 iblIrradiance = vec3( 0.0 );\n\tvec3 irradiance = getAmbientLightIrradiance( ambientLightColor );\n\tirradiance += getLightProbeIrradiance( lightProbe, geometry.normal );\n\t#if ( NUM_HEMI_LIGHTS > 0 )\n\t\t#pragma unroll_loop_start\n\t\tfor ( int i = 0; i < NUM_HEMI_LIGHTS; i ++ ) {\n\t\t\tirradiance += getHemisphereLightIrradiance( hemisphereLights[ i ], geometry.normal );\n\t\t}\n\t\t#pragma unroll_loop_end\n\t#endif\n#endif\n#if defined( RE_IndirectSpecular )\n\tvec3 radiance = vec3( 0.0 );\n\tvec3 clearcoatRadiance = vec3( 0.0 );\n#endif",lights_fragment_maps:"#if defined( RE_IndirectDiffuse )\n\t#ifdef USE_LIGHTMAP\n\t\tvec4 lightMapTexel = texture2D( lightMap, vUv2 );\n\t\tvec3 lightMapIrradiance = lightMapTexelToLinear( lightMapTexel ).rgb * lightMapIntensity;\n\t\t#ifndef PHYSICALLY_CORRECT_LIGHTS\n\t\t\tlightMapIrradiance *= PI;\n\t\t#endif\n\t\tirradiance += lightMapIrradiance;\n\t#endif\n\t#if defined( USE_ENVMAP ) && defined( STANDARD ) && defined( ENVMAP_TYPE_CUBE_UV )\n\t\tiblIrradiance += getIBLIrradiance( geometry.normal );\n\t#endif\n#endif\n#if defined( USE_ENVMAP ) && defined( RE_IndirectSpecular )\n\tradiance += getIBLRadiance( geometry.viewDir, geometry.normal, material.roughness );\n\t#ifdef USE_CLEARCOAT\n\t\tclearcoatRadiance += getIBLRadiance( geometry.viewDir, geometry.clearcoatNormal, material.clearcoatRoughness );\n\t#endif\n#endif",lights_fragment_end:"#if defined( RE_IndirectDiffuse )\n\tRE_IndirectDiffuse( irradiance, geometry, material, reflectedLight );\n#endif\n#if defined( RE_IndirectSpecular )\n\tRE_IndirectSpecular( radiance, iblIrradiance, clearcoatRadiance, geometry, material, reflectedLight );\n#endif",logdepthbuf_fragment:"#if defined( USE_LOGDEPTHBUF ) && defined( USE_LOGDEPTHBUF_EXT )\n\tgl_FragDepthEXT = vIsPerspective == 0.0 ? gl_FragCoord.z : log2( vFragDepth ) * logDepthBufFC * 0.5;\n#endif",logdepthbuf_pars_fragment:"#if defined( USE_LOGDEPTHBUF ) && defined( USE_LOGDEPTHBUF_EXT )\n\tuniform float logDepthBufFC;\n\tvarying float vFragDepth;\n\tvarying float vIsPerspective;\n#endif",logdepthbuf_pars_vertex:"#ifdef USE_LOGDEPTHBUF\n\t#ifdef USE_LOGDEPTHBUF_EXT\n\t\tvarying float vFragDepth;\n\t\tvarying float vIsPerspective;\n\t#else\n\t\tuniform float logDepthBufFC;\n\t#endif\n#endif",logdepthbuf_vertex:"#ifdef USE_LOGDEPTHBUF\n\t#ifdef USE_LOGDEPTHBUF_EXT\n\t\tvFragDepth = 1.0 + gl_Position.w;\n\t\tvIsPerspective = float( isPerspectiveMatrix( projectionMatrix ) );\n\t#else\n\t\tif ( isPerspectiveMatrix( projectionMatrix ) ) {\n\t\t\tgl_Position.z = log2( max( EPSILON, gl_Position.w + 1.0 ) ) * logDepthBufFC - 1.0;\n\t\t\tgl_Position.z *= gl_Position.w;\n\t\t}\n\t#endif\n#endif",map_fragment:"#ifdef USE_MAP\n\tvec4 texelColor = texture2D( map, vUv );\n\ttexelColor = mapTexelToLinear( texelColor );\n\tdiffuseColor *= texelColor;\n#endif",map_pars_fragment:"#ifdef USE_MAP\n\tuniform sampler2D map;\n#endif",map_particle_fragment:"#if defined( USE_MAP ) || defined( USE_ALPHAMAP )\n\tvec2 uv = ( uvTransform * vec3( gl_PointCoord.x, 1.0 - gl_PointCoord.y, 1 ) ).xy;\n#endif\n#ifdef USE_MAP\n\tvec4 mapTexel = texture2D( map, uv );\n\tdiffuseColor *= mapTexelToLinear( mapTexel );\n#endif\n#ifdef USE_ALPHAMAP\n\tdiffuseColor.a *= texture2D( alphaMap, uv ).g;\n#endif",map_particle_pars_fragment:"#if defined( USE_MAP ) || defined( USE_ALPHAMAP )\n\tuniform mat3 uvTransform;\n#endif\n#ifdef USE_MAP\n\tuniform sampler2D map;\n#endif\n#ifdef USE_ALPHAMAP\n\tuniform sampler2D alphaMap;\n#endif",metalnessmap_fragment:"float metalnessFactor = metalness;\n#ifdef USE_METALNESSMAP\n\tvec4 texelMetalness = texture2D( metalnessMap, vUv );\n\tmetalnessFactor *= texelMetalness.b;\n#endif",metalnessmap_pars_fragment:"#ifdef USE_METALNESSMAP\n\tuniform sampler2D metalnessMap;\n#endif",morphnormal_vertex:"#ifdef USE_MORPHNORMALS\n\tobjectNormal *= morphTargetBaseInfluence;\n\t#ifdef MORPHTARGETS_TEXTURE\n\t\tfor ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {\n\t\t\tif ( morphTargetInfluences[ i ] > 0.0 ) objectNormal += getMorph( gl_VertexID, i, 1, 2 ) * morphTargetInfluences[ i ];\n\t\t}\n\t#else\n\t\tobjectNormal += morphNormal0 * morphTargetInfluences[ 0 ];\n\t\tobjectNormal += morphNormal1 * morphTargetInfluences[ 1 ];\n\t\tobjectNormal += morphNormal2 * morphTargetInfluences[ 2 ];\n\t\tobjectNormal += morphNormal3 * morphTargetInfluences[ 3 ];\n\t#endif\n#endif",morphtarget_pars_vertex:"#ifdef USE_MORPHTARGETS\n\tuniform float morphTargetBaseInfluence;\n\t#ifdef MORPHTARGETS_TEXTURE\n\t\tuniform float morphTargetInfluences[ MORPHTARGETS_COUNT ];\n\t\tuniform sampler2DArray morphTargetsTexture;\n\t\tuniform vec2 morphTargetsTextureSize;\n\t\tvec3 getMorph( const in int vertexIndex, const in int morphTargetIndex, const in int offset, const in int stride ) {\n\t\t\tfloat texelIndex = float( vertexIndex * stride + offset );\n\t\t\tfloat y = floor( texelIndex / morphTargetsTextureSize.x );\n\t\t\tfloat x = texelIndex - y * morphTargetsTextureSize.x;\n\t\t\tvec3 morphUV = vec3( ( x + 0.5 ) / morphTargetsTextureSize.x, y / morphTargetsTextureSize.y, morphTargetIndex );\n\t\t\treturn texture( morphTargetsTexture, morphUV ).xyz;\n\t\t}\n\t#else\n\t\t#ifndef USE_MORPHNORMALS\n\t\t\tuniform float morphTargetInfluences[ 8 ];\n\t\t#else\n\t\t\tuniform float morphTargetInfluences[ 4 ];\n\t\t#endif\n\t#endif\n#endif",morphtarget_vertex:"#ifdef USE_MORPHTARGETS\n\ttransformed *= morphTargetBaseInfluence;\n\t#ifdef MORPHTARGETS_TEXTURE\n\t\tfor ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {\n\t\t\t#ifndef USE_MORPHNORMALS\n\t\t\t\tif ( morphTargetInfluences[ i ] > 0.0 ) transformed += getMorph( gl_VertexID, i, 0, 1 ) * morphTargetInfluences[ i ];\n\t\t\t#else\n\t\t\t\tif ( morphTargetInfluences[ i ] > 0.0 ) transformed += getMorph( gl_VertexID, i, 0, 2 ) * morphTargetInfluences[ i ];\n\t\t\t#endif\n\t\t}\n\t#else\n\t\ttransformed += morphTarget0 * morphTargetInfluences[ 0 ];\n\t\ttransformed += morphTarget1 * morphTargetInfluences[ 1 ];\n\t\ttransformed += morphTarget2 * morphTargetInfluences[ 2 ];\n\t\ttransformed += morphTarget3 * morphTargetInfluences[ 3 ];\n\t\t#ifndef USE_MORPHNORMALS\n\t\t\ttransformed += morphTarget4 * morphTargetInfluences[ 4 ];\n\t\t\ttransformed += morphTarget5 * morphTargetInfluences[ 5 ];\n\t\t\ttransformed += morphTarget6 * morphTargetInfluences[ 6 ];\n\t\t\ttransformed += morphTarget7 * morphTargetInfluences[ 7 ];\n\t\t#endif\n\t#endif\n#endif",normal_fragment_begin:"float faceDirection = gl_FrontFacing ? 1.0 : - 1.0;\n#ifdef FLAT_SHADED\n\tvec3 fdx = vec3( dFdx( vViewPosition.x ), dFdx( vViewPosition.y ), dFdx( vViewPosition.z ) );\n\tvec3 fdy = vec3( dFdy( vViewPosition.x ), dFdy( vViewPosition.y ), dFdy( vViewPosition.z ) );\n\tvec3 normal = normalize( cross( fdx, fdy ) );\n#else\n\tvec3 normal = normalize( vNormal );\n\t#ifdef DOUBLE_SIDED\n\t\tnormal = normal * faceDirection;\n\t#endif\n\t#ifdef USE_TANGENT\n\t\tvec3 tangent = normalize( vTangent );\n\t\tvec3 bitangent = normalize( vBitangent );\n\t\t#ifdef DOUBLE_SIDED\n\t\t\ttangent = tangent * faceDirection;\n\t\t\tbitangent = bitangent * faceDirection;\n\t\t#endif\n\t\t#if defined( TANGENTSPACE_NORMALMAP ) || defined( USE_CLEARCOAT_NORMALMAP )\n\t\t\tmat3 vTBN = mat3( tangent, bitangent, normal );\n\t\t#endif\n\t#endif\n#endif\nvec3 geometryNormal = normal;",normal_fragment_maps:"#ifdef OBJECTSPACE_NORMALMAP\n\tnormal = texture2D( normalMap, vUv ).xyz * 2.0 - 1.0;\n\t#ifdef FLIP_SIDED\n\t\tnormal = - normal;\n\t#endif\n\t#ifdef DOUBLE_SIDED\n\t\tnormal = normal * faceDirection;\n\t#endif\n\tnormal = normalize( normalMatrix * normal );\n#elif defined( TANGENTSPACE_NORMALMAP )\n\tvec3 mapN = texture2D( normalMap, vUv ).xyz * 2.0 - 1.0;\n\tmapN.xy *= normalScale;\n\t#ifdef USE_TANGENT\n\t\tnormal = normalize( vTBN * mapN );\n\t#else\n\t\tnormal = perturbNormal2Arb( - vViewPosition, normal, mapN, faceDirection );\n\t#endif\n#elif defined( USE_BUMPMAP )\n\tnormal = perturbNormalArb( - vViewPosition, normal, dHdxy_fwd(), faceDirection );\n#endif",normal_pars_fragment:"#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n\t#ifdef USE_TANGENT\n\t\tvarying vec3 vTangent;\n\t\tvarying vec3 vBitangent;\n\t#endif\n#endif",normal_pars_vertex:"#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n\t#ifdef USE_TANGENT\n\t\tvarying vec3 vTangent;\n\t\tvarying vec3 vBitangent;\n\t#endif\n#endif",normal_vertex:"#ifndef FLAT_SHADED\n\tvNormal = normalize( transformedNormal );\n\t#ifdef USE_TANGENT\n\t\tvTangent = normalize( transformedTangent );\n\t\tvBitangent = normalize( cross( vNormal, vTangent ) * tangent.w );\n\t#endif\n#endif",normalmap_pars_fragment:"#ifdef USE_NORMALMAP\n\tuniform sampler2D normalMap;\n\tuniform vec2 normalScale;\n#endif\n#ifdef OBJECTSPACE_NORMALMAP\n\tuniform mat3 normalMatrix;\n#endif\n#if ! defined ( USE_TANGENT ) && ( defined ( TANGENTSPACE_NORMALMAP ) || defined ( USE_CLEARCOAT_NORMALMAP ) )\n\tvec3 perturbNormal2Arb( vec3 eye_pos, vec3 surf_norm, vec3 mapN, float faceDirection ) {\n\t\tvec3 q0 = vec3( dFdx( eye_pos.x ), dFdx( eye_pos.y ), dFdx( eye_pos.z ) );\n\t\tvec3 q1 = vec3( dFdy( eye_pos.x ), dFdy( eye_pos.y ), dFdy( eye_pos.z ) );\n\t\tvec2 st0 = dFdx( vUv.st );\n\t\tvec2 st1 = dFdy( vUv.st );\n\t\tvec3 N = surf_norm;\n\t\tvec3 q1perp = cross( q1, N );\n\t\tvec3 q0perp = cross( N, q0 );\n\t\tvec3 T = q1perp * st0.x + q0perp * st1.x;\n\t\tvec3 B = q1perp * st0.y + q0perp * st1.y;\n\t\tfloat det = max( dot( T, T ), dot( B, B ) );\n\t\tfloat scale = ( det == 0.0 ) ? 0.0 : faceDirection * inversesqrt( det );\n\t\treturn normalize( T * ( mapN.x * scale ) + B * ( mapN.y * scale ) + N * mapN.z );\n\t}\n#endif",clearcoat_normal_fragment_begin:"#ifdef USE_CLEARCOAT\n\tvec3 clearcoatNormal = geometryNormal;\n#endif",clearcoat_normal_fragment_maps:"#ifdef USE_CLEARCOAT_NORMALMAP\n\tvec3 clearcoatMapN = texture2D( clearcoatNormalMap, vUv ).xyz * 2.0 - 1.0;\n\tclearcoatMapN.xy *= clearcoatNormalScale;\n\t#ifdef USE_TANGENT\n\t\tclearcoatNormal = normalize( vTBN * clearcoatMapN );\n\t#else\n\t\tclearcoatNormal = perturbNormal2Arb( - vViewPosition, clearcoatNormal, clearcoatMapN, faceDirection );\n\t#endif\n#endif",clearcoat_pars_fragment:"#ifdef USE_CLEARCOATMAP\n\tuniform sampler2D clearcoatMap;\n#endif\n#ifdef USE_CLEARCOAT_ROUGHNESSMAP\n\tuniform sampler2D clearcoatRoughnessMap;\n#endif\n#ifdef USE_CLEARCOAT_NORMALMAP\n\tuniform sampler2D clearcoatNormalMap;\n\tuniform vec2 clearcoatNormalScale;\n#endif",output_fragment:"#ifdef OPAQUE\ndiffuseColor.a = 1.0;\n#endif\n#ifdef USE_TRANSMISSION\ndiffuseColor.a *= transmissionAlpha + 0.1;\n#endif\ngl_FragColor = vec4( outgoingLight, diffuseColor.a );",packing:"vec3 packNormalToRGB( const in vec3 normal ) {\n\treturn normalize( normal ) * 0.5 + 0.5;\n}\nvec3 unpackRGBToNormal( const in vec3 rgb ) {\n\treturn 2.0 * rgb.xyz - 1.0;\n}\nconst float PackUpscale = 256. / 255.;const float UnpackDownscale = 255. / 256.;\nconst vec3 PackFactors = vec3( 256. * 256. * 256., 256. * 256., 256. );\nconst vec4 UnpackFactors = UnpackDownscale / vec4( PackFactors, 1. );\nconst float ShiftRight8 = 1. / 256.;\nvec4 packDepthToRGBA( const in float v ) {\n\tvec4 r = vec4( fract( v * PackFactors ), v );\n\tr.yzw -= r.xyz * ShiftRight8;\treturn r * PackUpscale;\n}\nfloat unpackRGBAToDepth( const in vec4 v ) {\n\treturn dot( v, UnpackFactors );\n}\nvec4 pack2HalfToRGBA( vec2 v ) {\n\tvec4 r = vec4( v.x, fract( v.x * 255.0 ), v.y, fract( v.y * 255.0 ) );\n\treturn vec4( r.x - r.y / 255.0, r.y, r.z - r.w / 255.0, r.w );\n}\nvec2 unpackRGBATo2Half( vec4 v ) {\n\treturn vec2( v.x + ( v.y / 255.0 ), v.z + ( v.w / 255.0 ) );\n}\nfloat viewZToOrthographicDepth( const in float viewZ, const in float near, const in float far ) {\n\treturn ( viewZ + near ) / ( near - far );\n}\nfloat orthographicDepthToViewZ( const in float linearClipZ, const in float near, const in float far ) {\n\treturn linearClipZ * ( near - far ) - near;\n}\nfloat viewZToPerspectiveDepth( const in float viewZ, const in float near, const in float far ) {\n\treturn ( ( near + viewZ ) * far ) / ( ( far - near ) * viewZ );\n}\nfloat perspectiveDepthToViewZ( const in float invClipZ, const in float near, const in float far ) {\n\treturn ( near * far ) / ( ( far - near ) * invClipZ - far );\n}",premultiplied_alpha_fragment:"#ifdef PREMULTIPLIED_ALPHA\n\tgl_FragColor.rgb *= gl_FragColor.a;\n#endif",project_vertex:"vec4 mvPosition = vec4( transformed, 1.0 );\n#ifdef USE_INSTANCING\n\tmvPosition = instanceMatrix * mvPosition;\n#endif\nmvPosition = modelViewMatrix * mvPosition;\ngl_Position = projectionMatrix * mvPosition;",dithering_fragment:"#ifdef DITHERING\n\tgl_FragColor.rgb = dithering( gl_FragColor.rgb );\n#endif",dithering_pars_fragment:"#ifdef DITHERING\n\tvec3 dithering( vec3 color ) {\n\t\tfloat grid_position = rand( gl_FragCoord.xy );\n\t\tvec3 dither_shift_RGB = vec3( 0.25 / 255.0, -0.25 / 255.0, 0.25 / 255.0 );\n\t\tdither_shift_RGB = mix( 2.0 * dither_shift_RGB, -2.0 * dither_shift_RGB, grid_position );\n\t\treturn color + dither_shift_RGB;\n\t}\n#endif",roughnessmap_fragment:"float roughnessFactor = roughness;\n#ifdef USE_ROUGHNESSMAP\n\tvec4 texelRoughness = texture2D( roughnessMap, vUv );\n\troughnessFactor *= texelRoughness.g;\n#endif",roughnessmap_pars_fragment:"#ifdef USE_ROUGHNESSMAP\n\tuniform sampler2D roughnessMap;\n#endif",shadowmap_pars_fragment:"#ifdef USE_SHADOWMAP\n\t#if NUM_DIR_LIGHT_SHADOWS > 0\n\t\tuniform sampler2D directionalShadowMap[ NUM_DIR_LIGHT_SHADOWS ];\n\t\tvarying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHT_SHADOWS ];\n\t\tstruct DirectionalLightShadow {\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t};\n\t\tuniform DirectionalLightShadow directionalLightShadows[ NUM_DIR_LIGHT_SHADOWS ];\n\t#endif\n\t#if NUM_SPOT_LIGHT_SHADOWS > 0\n\t\tuniform sampler2D spotShadowMap[ NUM_SPOT_LIGHT_SHADOWS ];\n\t\tvarying vec4 vSpotShadowCoord[ NUM_SPOT_LIGHT_SHADOWS ];\n\t\tstruct SpotLightShadow {\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t};\n\t\tuniform SpotLightShadow spotLightShadows[ NUM_SPOT_LIGHT_SHADOWS ];\n\t#endif\n\t#if NUM_POINT_LIGHT_SHADOWS > 0\n\t\tuniform sampler2D pointShadowMap[ NUM_POINT_LIGHT_SHADOWS ];\n\t\tvarying vec4 vPointShadowCoord[ NUM_POINT_LIGHT_SHADOWS ];\n\t\tstruct PointLightShadow {\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t\tfloat shadowCameraNear;\n\t\t\tfloat shadowCameraFar;\n\t\t};\n\t\tuniform PointLightShadow pointLightShadows[ NUM_POINT_LIGHT_SHADOWS ];\n\t#endif\n\tfloat texture2DCompare( sampler2D depths, vec2 uv, float compare ) {\n\t\treturn step( compare, unpackRGBAToDepth( texture2D( depths, uv ) ) );\n\t}\n\tvec2 texture2DDistribution( sampler2D shadow, vec2 uv ) {\n\t\treturn unpackRGBATo2Half( texture2D( shadow, uv ) );\n\t}\n\tfloat VSMShadow (sampler2D shadow, vec2 uv, float compare ){\n\t\tfloat occlusion = 1.0;\n\t\tvec2 distribution = texture2DDistribution( shadow, uv );\n\t\tfloat hard_shadow = step( compare , distribution.x );\n\t\tif (hard_shadow != 1.0 ) {\n\t\t\tfloat distance = compare - distribution.x ;\n\t\t\tfloat variance = max( 0.00000, distribution.y * distribution.y );\n\t\t\tfloat softness_probability = variance / (variance + distance * distance );\t\t\tsoftness_probability = clamp( ( softness_probability - 0.3 ) / ( 0.95 - 0.3 ), 0.0, 1.0 );\t\t\tocclusion = clamp( max( hard_shadow, softness_probability ), 0.0, 1.0 );\n\t\t}\n\t\treturn occlusion;\n\t}\n\tfloat getShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowBias, float shadowRadius, vec4 shadowCoord ) {\n\t\tfloat shadow = 1.0;\n\t\tshadowCoord.xyz /= shadowCoord.w;\n\t\tshadowCoord.z += shadowBias;\n\t\tbvec4 inFrustumVec = bvec4 ( shadowCoord.x >= 0.0, shadowCoord.x <= 1.0, shadowCoord.y >= 0.0, shadowCoord.y <= 1.0 );\n\t\tbool inFrustum = all( inFrustumVec );\n\t\tbvec2 frustumTestVec = bvec2( inFrustum, shadowCoord.z <= 1.0 );\n\t\tbool frustumTest = all( frustumTestVec );\n\t\tif ( frustumTest ) {\n\t\t#if defined( SHADOWMAP_TYPE_PCF )\n\t\t\tvec2 texelSize = vec2( 1.0 ) / shadowMapSize;\n\t\t\tfloat dx0 = - texelSize.x * shadowRadius;\n\t\t\tfloat dy0 = - texelSize.y * shadowRadius;\n\t\t\tfloat dx1 = + texelSize.x * shadowRadius;\n\t\t\tfloat dy1 = + texelSize.y * shadowRadius;\n\t\t\tfloat dx2 = dx0 / 2.0;\n\t\t\tfloat dy2 = dy0 / 2.0;\n\t\t\tfloat dx3 = dx1 / 2.0;\n\t\t\tfloat dy3 = dy1 / 2.0;\n\t\t\tshadow = (\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, dy0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, dy0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, dy2 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy2 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, dy2 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, dy3 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy3 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, dy3 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, dy1 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy1 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, dy1 ), shadowCoord.z )\n\t\t\t) * ( 1.0 / 17.0 );\n\t\t#elif defined( SHADOWMAP_TYPE_PCF_SOFT )\n\t\t\tvec2 texelSize = vec2( 1.0 ) / shadowMapSize;\n\t\t\tfloat dx = texelSize.x;\n\t\t\tfloat dy = texelSize.y;\n\t\t\tvec2 uv = shadowCoord.xy;\n\t\t\tvec2 f = fract( uv * shadowMapSize + 0.5 );\n\t\t\tuv -= f * texelSize;\n\t\t\tshadow = (\n\t\t\t\ttexture2DCompare( shadowMap, uv, shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, uv + vec2( dx, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, uv + vec2( 0.0, dy ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, uv + texelSize, shadowCoord.z ) +\n\t\t\t\tmix( texture2DCompare( shadowMap, uv + vec2( -dx, 0.0 ), shadowCoord.z ), \n\t\t\t\t\t texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, 0.0 ), shadowCoord.z ),\n\t\t\t\t\t f.x ) +\n\t\t\t\tmix( texture2DCompare( shadowMap, uv + vec2( -dx, dy ), shadowCoord.z ), \n\t\t\t\t\t texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, dy ), shadowCoord.z ),\n\t\t\t\t\t f.x ) +\n\t\t\t\tmix( texture2DCompare( shadowMap, uv + vec2( 0.0, -dy ), shadowCoord.z ), \n\t\t\t\t\t texture2DCompare( shadowMap, uv + vec2( 0.0, 2.0 * dy ), shadowCoord.z ),\n\t\t\t\t\t f.y ) +\n\t\t\t\tmix( texture2DCompare( shadowMap, uv + vec2( dx, -dy ), shadowCoord.z ), \n\t\t\t\t\t texture2DCompare( shadowMap, uv + vec2( dx, 2.0 * dy ), shadowCoord.z ),\n\t\t\t\t\t f.y ) +\n\t\t\t\tmix( mix( texture2DCompare( shadowMap, uv + vec2( -dx, -dy ), shadowCoord.z ), \n\t\t\t\t\t\t  texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, -dy ), shadowCoord.z ),\n\t\t\t\t\t\t  f.x ),\n\t\t\t\t\t mix( texture2DCompare( shadowMap, uv + vec2( -dx, 2.0 * dy ), shadowCoord.z ), \n\t\t\t\t\t\t  texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, 2.0 * dy ), shadowCoord.z ),\n\t\t\t\t\t\t  f.x ),\n\t\t\t\t\t f.y )\n\t\t\t) * ( 1.0 / 9.0 );\n\t\t#elif defined( SHADOWMAP_TYPE_VSM )\n\t\t\tshadow = VSMShadow( shadowMap, shadowCoord.xy, shadowCoord.z );\n\t\t#else\n\t\t\tshadow = texture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z );\n\t\t#endif\n\t\t}\n\t\treturn shadow;\n\t}\n\tvec2 cubeToUV( vec3 v, float texelSizeY ) {\n\t\tvec3 absV = abs( v );\n\t\tfloat scaleToCube = 1.0 / max( absV.x, max( absV.y, absV.z ) );\n\t\tabsV *= scaleToCube;\n\t\tv *= scaleToCube * ( 1.0 - 2.0 * texelSizeY );\n\t\tvec2 planar = v.xy;\n\t\tfloat almostATexel = 1.5 * texelSizeY;\n\t\tfloat almostOne = 1.0 - almostATexel;\n\t\tif ( absV.z >= almostOne ) {\n\t\t\tif ( v.z > 0.0 )\n\t\t\t\tplanar.x = 4.0 - v.x;\n\t\t} else if ( absV.x >= almostOne ) {\n\t\t\tfloat signX = sign( v.x );\n\t\t\tplanar.x = v.z * signX + 2.0 * signX;\n\t\t} else if ( absV.y >= almostOne ) {\n\t\t\tfloat signY = sign( v.y );\n\t\t\tplanar.x = v.x + 2.0 * signY + 2.0;\n\t\t\tplanar.y = v.z * signY - 2.0;\n\t\t}\n\t\treturn vec2( 0.125, 0.25 ) * planar + vec2( 0.375, 0.75 );\n\t}\n\tfloat getPointShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowBias, float shadowRadius, vec4 shadowCoord, float shadowCameraNear, float shadowCameraFar ) {\n\t\tvec2 texelSize = vec2( 1.0 ) / ( shadowMapSize * vec2( 4.0, 2.0 ) );\n\t\tvec3 lightToPosition = shadowCoord.xyz;\n\t\tfloat dp = ( length( lightToPosition ) - shadowCameraNear ) / ( shadowCameraFar - shadowCameraNear );\t\tdp += shadowBias;\n\t\tvec3 bd3D = normalize( lightToPosition );\n\t\t#if defined( SHADOWMAP_TYPE_PCF ) || defined( SHADOWMAP_TYPE_PCF_SOFT ) || defined( SHADOWMAP_TYPE_VSM )\n\t\t\tvec2 offset = vec2( - 1, 1 ) * shadowRadius * texelSize.y;\n\t\t\treturn (\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xyy, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yyy, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xyx, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yyx, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xxy, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yxy, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xxx, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yxx, texelSize.y ), dp )\n\t\t\t) * ( 1.0 / 9.0 );\n\t\t#else\n\t\t\treturn texture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), dp );\n\t\t#endif\n\t}\n#endif",shadowmap_pars_vertex:"#ifdef USE_SHADOWMAP\n\t#if NUM_DIR_LIGHT_SHADOWS > 0\n\t\tuniform mat4 directionalShadowMatrix[ NUM_DIR_LIGHT_SHADOWS ];\n\t\tvarying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHT_SHADOWS ];\n\t\tstruct DirectionalLightShadow {\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t};\n\t\tuniform DirectionalLightShadow directionalLightShadows[ NUM_DIR_LIGHT_SHADOWS ];\n\t#endif\n\t#if NUM_SPOT_LIGHT_SHADOWS > 0\n\t\tuniform mat4 spotShadowMatrix[ NUM_SPOT_LIGHT_SHADOWS ];\n\t\tvarying vec4 vSpotShadowCoord[ NUM_SPOT_LIGHT_SHADOWS ];\n\t\tstruct SpotLightShadow {\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t};\n\t\tuniform SpotLightShadow spotLightShadows[ NUM_SPOT_LIGHT_SHADOWS ];\n\t#endif\n\t#if NUM_POINT_LIGHT_SHADOWS > 0\n\t\tuniform mat4 pointShadowMatrix[ NUM_POINT_LIGHT_SHADOWS ];\n\t\tvarying vec4 vPointShadowCoord[ NUM_POINT_LIGHT_SHADOWS ];\n\t\tstruct PointLightShadow {\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t\tfloat shadowCameraNear;\n\t\t\tfloat shadowCameraFar;\n\t\t};\n\t\tuniform PointLightShadow pointLightShadows[ NUM_POINT_LIGHT_SHADOWS ];\n\t#endif\n#endif",shadowmap_vertex:"#ifdef USE_SHADOWMAP\n\t#if NUM_DIR_LIGHT_SHADOWS > 0 || NUM_SPOT_LIGHT_SHADOWS > 0 || NUM_POINT_LIGHT_SHADOWS > 0\n\t\tvec3 shadowWorldNormal = inverseTransformDirection( transformedNormal, viewMatrix );\n\t\tvec4 shadowWorldPosition;\n\t#endif\n\t#if NUM_DIR_LIGHT_SHADOWS > 0\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_DIR_LIGHT_SHADOWS; i ++ ) {\n\t\tshadowWorldPosition = worldPosition + vec4( shadowWorldNormal * directionalLightShadows[ i ].shadowNormalBias, 0 );\n\t\tvDirectionalShadowCoord[ i ] = directionalShadowMatrix[ i ] * shadowWorldPosition;\n\t}\n\t#pragma unroll_loop_end\n\t#endif\n\t#if NUM_SPOT_LIGHT_SHADOWS > 0\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_SPOT_LIGHT_SHADOWS; i ++ ) {\n\t\tshadowWorldPosition = worldPosition + vec4( shadowWorldNormal * spotLightShadows[ i ].shadowNormalBias, 0 );\n\t\tvSpotShadowCoord[ i ] = spotShadowMatrix[ i ] * shadowWorldPosition;\n\t}\n\t#pragma unroll_loop_end\n\t#endif\n\t#if NUM_POINT_LIGHT_SHADOWS > 0\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_POINT_LIGHT_SHADOWS; i ++ ) {\n\t\tshadowWorldPosition = worldPosition + vec4( shadowWorldNormal * pointLightShadows[ i ].shadowNormalBias, 0 );\n\t\tvPointShadowCoord[ i ] = pointShadowMatrix[ i ] * shadowWorldPosition;\n\t}\n\t#pragma unroll_loop_end\n\t#endif\n#endif",shadowmask_pars_fragment:"float getShadowMask() {\n\tfloat shadow = 1.0;\n\t#ifdef USE_SHADOWMAP\n\t#if NUM_DIR_LIGHT_SHADOWS > 0\n\tDirectionalLightShadow directionalLight;\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_DIR_LIGHT_SHADOWS; i ++ ) {\n\t\tdirectionalLight = directionalLightShadows[ i ];\n\t\tshadow *= receiveShadow ? getShadow( directionalShadowMap[ i ], directionalLight.shadowMapSize, directionalLight.shadowBias, directionalLight.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;\n\t}\n\t#pragma unroll_loop_end\n\t#endif\n\t#if NUM_SPOT_LIGHT_SHADOWS > 0\n\tSpotLightShadow spotLight;\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_SPOT_LIGHT_SHADOWS; i ++ ) {\n\t\tspotLight = spotLightShadows[ i ];\n\t\tshadow *= receiveShadow ? getShadow( spotShadowMap[ i ], spotLight.shadowMapSize, spotLight.shadowBias, spotLight.shadowRadius, vSpotShadowCoord[ i ] ) : 1.0;\n\t}\n\t#pragma unroll_loop_end\n\t#endif\n\t#if NUM_POINT_LIGHT_SHADOWS > 0\n\tPointLightShadow pointLight;\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_POINT_LIGHT_SHADOWS; i ++ ) {\n\t\tpointLight = pointLightShadows[ i ];\n\t\tshadow *= receiveShadow ? getPointShadow( pointShadowMap[ i ], pointLight.shadowMapSize, pointLight.shadowBias, pointLight.shadowRadius, vPointShadowCoord[ i ], pointLight.shadowCameraNear, pointLight.shadowCameraFar ) : 1.0;\n\t}\n\t#pragma unroll_loop_end\n\t#endif\n\t#endif\n\treturn shadow;\n}",skinbase_vertex:"#ifdef USE_SKINNING\n\tmat4 boneMatX = getBoneMatrix( skinIndex.x );\n\tmat4 boneMatY = getBoneMatrix( skinIndex.y );\n\tmat4 boneMatZ = getBoneMatrix( skinIndex.z );\n\tmat4 boneMatW = getBoneMatrix( skinIndex.w );\n#endif",skinning_pars_vertex:"#ifdef USE_SKINNING\n\tuniform mat4 bindMatrix;\n\tuniform mat4 bindMatrixInverse;\n\t#ifdef BONE_TEXTURE\n\t\tuniform highp sampler2D boneTexture;\n\t\tuniform int boneTextureSize;\n\t\tmat4 getBoneMatrix( const in float i ) {\n\t\t\tfloat j = i * 4.0;\n\t\t\tfloat x = mod( j, float( boneTextureSize ) );\n\t\t\tfloat y = floor( j / float( boneTextureSize ) );\n\t\t\tfloat dx = 1.0 / float( boneTextureSize );\n\t\t\tfloat dy = 1.0 / float( boneTextureSize );\n\t\t\ty = dy * ( y + 0.5 );\n\t\t\tvec4 v1 = texture2D( boneTexture, vec2( dx * ( x + 0.5 ), y ) );\n\t\t\tvec4 v2 = texture2D( boneTexture, vec2( dx * ( x + 1.5 ), y ) );\n\t\t\tvec4 v3 = texture2D( boneTexture, vec2( dx * ( x + 2.5 ), y ) );\n\t\t\tvec4 v4 = texture2D( boneTexture, vec2( dx * ( x + 3.5 ), y ) );\n\t\t\tmat4 bone = mat4( v1, v2, v3, v4 );\n\t\t\treturn bone;\n\t\t}\n\t#else\n\t\tuniform mat4 boneMatrices[ MAX_BONES ];\n\t\tmat4 getBoneMatrix( const in float i ) {\n\t\t\tmat4 bone = boneMatrices[ int(i) ];\n\t\t\treturn bone;\n\t\t}\n\t#endif\n#endif",skinning_vertex:"#ifdef USE_SKINNING\n\tvec4 skinVertex = bindMatrix * vec4( transformed, 1.0 );\n\tvec4 skinned = vec4( 0.0 );\n\tskinned += boneMatX * skinVertex * skinWeight.x;\n\tskinned += boneMatY * skinVertex * skinWeight.y;\n\tskinned += boneMatZ * skinVertex * skinWeight.z;\n\tskinned += boneMatW * skinVertex * skinWeight.w;\n\ttransformed = ( bindMatrixInverse * skinned ).xyz;\n#endif",skinnormal_vertex:"#ifdef USE_SKINNING\n\tmat4 skinMatrix = mat4( 0.0 );\n\tskinMatrix += skinWeight.x * boneMatX;\n\tskinMatrix += skinWeight.y * boneMatY;\n\tskinMatrix += skinWeight.z * boneMatZ;\n\tskinMatrix += skinWeight.w * boneMatW;\n\tskinMatrix = bindMatrixInverse * skinMatrix * bindMatrix;\n\tobjectNormal = vec4( skinMatrix * vec4( objectNormal, 0.0 ) ).xyz;\n\t#ifdef USE_TANGENT\n\t\tobjectTangent = vec4( skinMatrix * vec4( objectTangent, 0.0 ) ).xyz;\n\t#endif\n#endif",specularmap_fragment:"float specularStrength;\n#ifdef USE_SPECULARMAP\n\tvec4 texelSpecular = texture2D( specularMap, vUv );\n\tspecularStrength = texelSpecular.r;\n#else\n\tspecularStrength = 1.0;\n#endif",specularmap_pars_fragment:"#ifdef USE_SPECULARMAP\n\tuniform sampler2D specularMap;\n#endif",tonemapping_fragment:"#if defined( TONE_MAPPING )\n\tgl_FragColor.rgb = toneMapping( gl_FragColor.rgb );\n#endif",tonemapping_pars_fragment:"#ifndef saturate\n#define saturate( a ) clamp( a, 0.0, 1.0 )\n#endif\nuniform float toneMappingExposure;\nvec3 LinearToneMapping( vec3 color ) {\n\treturn toneMappingExposure * color;\n}\nvec3 ReinhardToneMapping( vec3 color ) {\n\tcolor *= toneMappingExposure;\n\treturn saturate( color / ( vec3( 1.0 ) + color ) );\n}\nvec3 OptimizedCineonToneMapping( vec3 color ) {\n\tcolor *= toneMappingExposure;\n\tcolor = max( vec3( 0.0 ), color - 0.004 );\n\treturn pow( ( color * ( 6.2 * color + 0.5 ) ) / ( color * ( 6.2 * color + 1.7 ) + 0.06 ), vec3( 2.2 ) );\n}\nvec3 RRTAndODTFit( vec3 v ) {\n\tvec3 a = v * ( v + 0.0245786 ) - 0.000090537;\n\tvec3 b = v * ( 0.983729 * v + 0.4329510 ) + 0.238081;\n\treturn a / b;\n}\nvec3 ACESFilmicToneMapping( vec3 color ) {\n\tconst mat3 ACESInputMat = mat3(\n\t\tvec3( 0.59719, 0.07600, 0.02840 ),\t\tvec3( 0.35458, 0.90834, 0.13383 ),\n\t\tvec3( 0.04823, 0.01566, 0.83777 )\n\t);\n\tconst mat3 ACESOutputMat = mat3(\n\t\tvec3(  1.60475, -0.10208, -0.00327 ),\t\tvec3( -0.53108,  1.10813, -0.07276 ),\n\t\tvec3( -0.07367, -0.00605,  1.07602 )\n\t);\n\tcolor *= toneMappingExposure / 0.6;\n\tcolor = ACESInputMat * color;\n\tcolor = RRTAndODTFit( color );\n\tcolor = ACESOutputMat * color;\n\treturn saturate( color );\n}\nvec3 CustomToneMapping( vec3 color ) { return color; }",transmission_fragment:"#ifdef USE_TRANSMISSION\n\tfloat transmissionAlpha = 1.0;\n\tfloat transmissionFactor = transmission;\n\tfloat thicknessFactor = thickness;\n\t#ifdef USE_TRANSMISSIONMAP\n\t\ttransmissionFactor *= texture2D( transmissionMap, vUv ).r;\n\t#endif\n\t#ifdef USE_THICKNESSMAP\n\t\tthicknessFactor *= texture2D( thicknessMap, vUv ).g;\n\t#endif\n\tvec3 pos = vWorldPosition;\n\tvec3 v = normalize( cameraPosition - pos );\n\tvec3 n = inverseTransformDirection( normal, viewMatrix );\n\tvec4 transmission = getIBLVolumeRefraction(\n\t\tn, v, roughnessFactor, material.diffuseColor, material.specularColor, material.specularF90,\n\t\tpos, modelMatrix, viewMatrix, projectionMatrix, ior, thicknessFactor,\n\t\tattenuationColor, attenuationDistance );\n\ttotalDiffuse = mix( totalDiffuse, transmission.rgb, transmissionFactor );\n\ttransmissionAlpha = mix( transmissionAlpha, transmission.a, transmissionFactor );\n#endif",transmission_pars_fragment:"#ifdef USE_TRANSMISSION\n\tuniform float transmission;\n\tuniform float thickness;\n\tuniform float attenuationDistance;\n\tuniform vec3 attenuationColor;\n\t#ifdef USE_TRANSMISSIONMAP\n\t\tuniform sampler2D transmissionMap;\n\t#endif\n\t#ifdef USE_THICKNESSMAP\n\t\tuniform sampler2D thicknessMap;\n\t#endif\n\tuniform vec2 transmissionSamplerSize;\n\tuniform sampler2D transmissionSamplerMap;\n\tuniform mat4 modelMatrix;\n\tuniform mat4 projectionMatrix;\n\tvarying vec3 vWorldPosition;\n\tvec3 getVolumeTransmissionRay( vec3 n, vec3 v, float thickness, float ior, mat4 modelMatrix ) {\n\t\tvec3 refractionVector = refract( - v, normalize( n ), 1.0 / ior );\n\t\tvec3 modelScale;\n\t\tmodelScale.x = length( vec3( modelMatrix[ 0 ].xyz ) );\n\t\tmodelScale.y = length( vec3( modelMatrix[ 1 ].xyz ) );\n\t\tmodelScale.z = length( vec3( modelMatrix[ 2 ].xyz ) );\n\t\treturn normalize( refractionVector ) * thickness * modelScale;\n\t}\n\tfloat applyIorToRoughness( float roughness, float ior ) {\n\t\treturn roughness * clamp( ior * 2.0 - 2.0, 0.0, 1.0 );\n\t}\n\tvec4 getTransmissionSample( vec2 fragCoord, float roughness, float ior ) {\n\t\tfloat framebufferLod = log2( transmissionSamplerSize.x ) * applyIorToRoughness( roughness, ior );\n\t\t#ifdef TEXTURE_LOD_EXT\n\t\t\treturn texture2DLodEXT( transmissionSamplerMap, fragCoord.xy, framebufferLod );\n\t\t#else\n\t\t\treturn texture2D( transmissionSamplerMap, fragCoord.xy, framebufferLod );\n\t\t#endif\n\t}\n\tvec3 applyVolumeAttenuation( vec3 radiance, float transmissionDistance, vec3 attenuationColor, float attenuationDistance ) {\n\t\tif ( attenuationDistance == 0.0 ) {\n\t\t\treturn radiance;\n\t\t} else {\n\t\t\tvec3 attenuationCoefficient = -log( attenuationColor ) / attenuationDistance;\n\t\t\tvec3 transmittance = exp( - attenuationCoefficient * transmissionDistance );\t\t\treturn transmittance * radiance;\n\t\t}\n\t}\n\tvec4 getIBLVolumeRefraction( vec3 n, vec3 v, float roughness, vec3 diffuseColor, vec3 specularColor, float specularF90,\n\t\tvec3 position, mat4 modelMatrix, mat4 viewMatrix, mat4 projMatrix, float ior, float thickness,\n\t\tvec3 attenuationColor, float attenuationDistance ) {\n\t\tvec3 transmissionRay = getVolumeTransmissionRay( n, v, thickness, ior, modelMatrix );\n\t\tvec3 refractedRayExit = position + transmissionRay;\n\t\tvec4 ndcPos = projMatrix * viewMatrix * vec4( refractedRayExit, 1.0 );\n\t\tvec2 refractionCoords = ndcPos.xy / ndcPos.w;\n\t\trefractionCoords += 1.0;\n\t\trefractionCoords /= 2.0;\n\t\tvec4 transmittedLight = getTransmissionSample( refractionCoords, roughness, ior );\n\t\tvec3 attenuatedColor = applyVolumeAttenuation( transmittedLight.rgb, length( transmissionRay ), attenuationColor, attenuationDistance );\n\t\tvec3 F = EnvironmentBRDF( n, v, specularColor, specularF90, roughness );\n\t\treturn vec4( ( 1.0 - F ) * attenuatedColor * diffuseColor, transmittedLight.a );\n\t}\n#endif",uv_pars_fragment:"#if ( defined( USE_UV ) && ! defined( UVS_VERTEX_ONLY ) )\n\tvarying vec2 vUv;\n#endif",uv_pars_vertex:"#ifdef USE_UV\n\t#ifdef UVS_VERTEX_ONLY\n\t\tvec2 vUv;\n\t#else\n\t\tvarying vec2 vUv;\n\t#endif\n\tuniform mat3 uvTransform;\n#endif",uv_vertex:"#ifdef USE_UV\n\tvUv = ( uvTransform * vec3( uv, 1 ) ).xy;\n#endif",uv2_pars_fragment:"#if defined( USE_LIGHTMAP ) || defined( USE_AOMAP )\n\tvarying vec2 vUv2;\n#endif",uv2_pars_vertex:"#if defined( USE_LIGHTMAP ) || defined( USE_AOMAP )\n\tattribute vec2 uv2;\n\tvarying vec2 vUv2;\n\tuniform mat3 uv2Transform;\n#endif",uv2_vertex:"#if defined( USE_LIGHTMAP ) || defined( USE_AOMAP )\n\tvUv2 = ( uv2Transform * vec3( uv2, 1 ) ).xy;\n#endif",worldpos_vertex:"#if defined( USE_ENVMAP ) || defined( DISTANCE ) || defined ( USE_SHADOWMAP ) || defined ( USE_TRANSMISSION )\n\tvec4 worldPosition = vec4( transformed, 1.0 );\n\t#ifdef USE_INSTANCING\n\t\tworldPosition = instanceMatrix * worldPosition;\n\t#endif\n\tworldPosition = modelMatrix * worldPosition;\n#endif",background_vert:"varying vec2 vUv;\nuniform mat3 uvTransform;\nvoid main() {\n\tvUv = ( uvTransform * vec3( uv, 1 ) ).xy;\n\tgl_Position = vec4( position.xy, 1.0, 1.0 );\n}",background_frag:"uniform sampler2D t2D;\nvarying vec2 vUv;\nvoid main() {\n\tvec4 texColor = texture2D( t2D, vUv );\n\tgl_FragColor = mapTexelToLinear( texColor );\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n}",cube_vert:"varying vec3 vWorldDirection;\n#include <common>\nvoid main() {\n\tvWorldDirection = transformDirection( position, modelMatrix );\n\t#include <begin_vertex>\n\t#include <project_vertex>\n\tgl_Position.z = gl_Position.w;\n}",cube_frag:"#include <envmap_common_pars_fragment>\nuniform float opacity;\nvarying vec3 vWorldDirection;\n#include <cube_uv_reflection_fragment>\nvoid main() {\n\tvec3 vReflect = vWorldDirection;\n\t#include <envmap_fragment>\n\tgl_FragColor = envColor;\n\tgl_FragColor.a *= opacity;\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n}",depth_vert:"#include <common>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvarying vec2 vHighPrecisionZW;\nvoid main() {\n\t#include <uv_vertex>\n\t#include <skinbase_vertex>\n\t#ifdef USE_DISPLACEMENTMAP\n\t\t#include <beginnormal_vertex>\n\t\t#include <morphnormal_vertex>\n\t\t#include <skinnormal_vertex>\n\t#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\tvHighPrecisionZW = gl_Position.zw;\n}",depth_frag:"#if DEPTH_PACKING == 3200\n\tuniform float opacity;\n#endif\n#include <common>\n#include <packing>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvarying vec2 vHighPrecisionZW;\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( 1.0 );\n\t#if DEPTH_PACKING == 3200\n\t\tdiffuseColor.a = opacity;\n\t#endif\n\t#include <map_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <logdepthbuf_fragment>\n\tfloat fragCoordZ = 0.5 * vHighPrecisionZW[0] / vHighPrecisionZW[1] + 0.5;\n\t#if DEPTH_PACKING == 3200\n\t\tgl_FragColor = vec4( vec3( 1.0 - fragCoordZ ), opacity );\n\t#elif DEPTH_PACKING == 3201\n\t\tgl_FragColor = packDepthToRGBA( fragCoordZ );\n\t#endif\n}",distanceRGBA_vert:"#define DISTANCE\nvarying vec3 vWorldPosition;\n#include <common>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <skinbase_vertex>\n\t#ifdef USE_DISPLACEMENTMAP\n\t\t#include <beginnormal_vertex>\n\t\t#include <morphnormal_vertex>\n\t\t#include <skinnormal_vertex>\n\t#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <worldpos_vertex>\n\t#include <clipping_planes_vertex>\n\tvWorldPosition = worldPosition.xyz;\n}",distanceRGBA_frag:"#define DISTANCE\nuniform vec3 referencePosition;\nuniform float nearDistance;\nuniform float farDistance;\nvarying vec3 vWorldPosition;\n#include <common>\n#include <packing>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main () {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( 1.0 );\n\t#include <map_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\tfloat dist = length( vWorldPosition - referencePosition );\n\tdist = ( dist - nearDistance ) / ( farDistance - nearDistance );\n\tdist = saturate( dist );\n\tgl_FragColor = packDepthToRGBA( dist );\n}",equirect_vert:"varying vec3 vWorldDirection;\n#include <common>\nvoid main() {\n\tvWorldDirection = transformDirection( position, modelMatrix );\n\t#include <begin_vertex>\n\t#include <project_vertex>\n}",equirect_frag:"uniform sampler2D tEquirect;\nvarying vec3 vWorldDirection;\n#include <common>\nvoid main() {\n\tvec3 direction = normalize( vWorldDirection );\n\tvec2 sampleUV = equirectUv( direction );\n\tvec4 texColor = texture2D( tEquirect, sampleUV );\n\tgl_FragColor = mapTexelToLinear( texColor );\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n}",linedashed_vert:"uniform float scale;\nattribute float lineDistance;\nvarying float vLineDistance;\n#include <common>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\tvLineDistance = scale * lineDistance;\n\t#include <color_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <fog_vertex>\n}",linedashed_frag:"uniform vec3 diffuse;\nuniform float opacity;\nuniform float dashSize;\nuniform float totalSize;\nvarying float vLineDistance;\n#include <common>\n#include <color_pars_fragment>\n#include <fog_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tif ( mod( vLineDistance, totalSize ) > dashSize ) {\n\t\tdiscard;\n\t}\n\tvec3 outgoingLight = vec3( 0.0 );\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <logdepthbuf_fragment>\n\t#include <color_fragment>\n\toutgoingLight = diffuseColor.rgb;\n\t#include <output_fragment>\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n}",meshbasic_vert:"#include <common>\n#include <uv_pars_vertex>\n#include <uv2_pars_vertex>\n#include <envmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <uv2_vertex>\n\t#include <color_vertex>\n\t#if defined ( USE_ENVMAP ) || defined ( USE_SKINNING )\n\t\t#include <beginnormal_vertex>\n\t\t#include <morphnormal_vertex>\n\t\t#include <skinbase_vertex>\n\t\t#include <skinnormal_vertex>\n\t\t#include <defaultnormal_vertex>\n\t#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <worldpos_vertex>\n\t#include <envmap_vertex>\n\t#include <fog_vertex>\n}",meshbasic_frag:"uniform vec3 diffuse;\nuniform float opacity;\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n#endif\n#include <common>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <uv2_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <envmap_common_pars_fragment>\n#include <envmap_pars_fragment>\n#include <cube_uv_reflection_fragment>\n#include <fog_pars_fragment>\n#include <specularmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <specularmap_fragment>\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\t#ifdef USE_LIGHTMAP\n\t\tvec4 lightMapTexel= texture2D( lightMap, vUv2 );\n\t\treflectedLight.indirectDiffuse += lightMapTexelToLinear( lightMapTexel ).rgb * lightMapIntensity;\n\t#else\n\t\treflectedLight.indirectDiffuse += vec3( 1.0 );\n\t#endif\n\t#include <aomap_fragment>\n\treflectedLight.indirectDiffuse *= diffuseColor.rgb;\n\tvec3 outgoingLight = reflectedLight.indirectDiffuse;\n\t#include <envmap_fragment>\n\t#include <output_fragment>\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",meshlambert_vert:"#define LAMBERT\nvarying vec3 vLightFront;\nvarying vec3 vIndirectFront;\n#ifdef DOUBLE_SIDED\n\tvarying vec3 vLightBack;\n\tvarying vec3 vIndirectBack;\n#endif\n#include <common>\n#include <uv_pars_vertex>\n#include <uv2_pars_vertex>\n#include <envmap_pars_vertex>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <uv2_vertex>\n\t#include <color_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <worldpos_vertex>\n\t#include <envmap_vertex>\n\t#include <lights_lambert_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n}",meshlambert_frag:"uniform vec3 diffuse;\nuniform vec3 emissive;\nuniform float opacity;\nvarying vec3 vLightFront;\nvarying vec3 vIndirectFront;\n#ifdef DOUBLE_SIDED\n\tvarying vec3 vLightBack;\n\tvarying vec3 vIndirectBack;\n#endif\n#include <common>\n#include <packing>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <uv2_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <envmap_common_pars_fragment>\n#include <envmap_pars_fragment>\n#include <cube_uv_reflection_fragment>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <fog_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <shadowmask_pars_fragment>\n#include <specularmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\tvec3 totalEmissiveRadiance = emissive;\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <specularmap_fragment>\n\t#include <emissivemap_fragment>\n\t#ifdef DOUBLE_SIDED\n\t\treflectedLight.indirectDiffuse += ( gl_FrontFacing ) ? vIndirectFront : vIndirectBack;\n\t#else\n\t\treflectedLight.indirectDiffuse += vIndirectFront;\n\t#endif\n\t#include <lightmap_fragment>\n\treflectedLight.indirectDiffuse *= BRDF_Lambert( diffuseColor.rgb );\n\t#ifdef DOUBLE_SIDED\n\t\treflectedLight.directDiffuse = ( gl_FrontFacing ) ? vLightFront : vLightBack;\n\t#else\n\t\treflectedLight.directDiffuse = vLightFront;\n\t#endif\n\treflectedLight.directDiffuse *= BRDF_Lambert( diffuseColor.rgb ) * getShadowMask();\n\t#include <aomap_fragment>\n\tvec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + totalEmissiveRadiance;\n\t#include <envmap_fragment>\n\t#include <output_fragment>\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",meshmatcap_vert:"#define MATCAP\nvarying vec3 vViewPosition;\n#include <common>\n#include <uv_pars_vertex>\n#include <color_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <fog_pars_vertex>\n#include <normal_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <color_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <normal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <fog_vertex>\n\tvViewPosition = - mvPosition.xyz;\n}",meshmatcap_frag:"#define MATCAP\nuniform vec3 diffuse;\nuniform float opacity;\nuniform sampler2D matcap;\nvarying vec3 vViewPosition;\n#include <common>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <fog_pars_fragment>\n#include <normal_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\tvec3 viewDir = normalize( vViewPosition );\n\tvec3 x = normalize( vec3( viewDir.z, 0.0, - viewDir.x ) );\n\tvec3 y = cross( viewDir, x );\n\tvec2 uv = vec2( dot( x, normal ), dot( y, normal ) ) * 0.495 + 0.5;\n\t#ifdef USE_MATCAP\n\t\tvec4 matcapColor = texture2D( matcap, uv );\n\t\tmatcapColor = matcapTexelToLinear( matcapColor );\n\t#else\n\t\tvec4 matcapColor = vec4( 1.0 );\n\t#endif\n\tvec3 outgoingLight = diffuseColor.rgb * matcapColor.rgb;\n\t#include <output_fragment>\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",meshnormal_vert:"#define NORMAL\n#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( TANGENTSPACE_NORMALMAP )\n\tvarying vec3 vViewPosition;\n#endif\n#include <common>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <normal_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <normal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( TANGENTSPACE_NORMALMAP )\n\tvViewPosition = - mvPosition.xyz;\n#endif\n}",meshnormal_frag:"#define NORMAL\nuniform float opacity;\n#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( TANGENTSPACE_NORMALMAP )\n\tvarying vec3 vViewPosition;\n#endif\n#include <packing>\n#include <uv_pars_fragment>\n#include <normal_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\t#include <logdepthbuf_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\tgl_FragColor = vec4( packNormalToRGB( normal ), opacity );\n}",meshphong_vert:"#define PHONG\nvarying vec3 vViewPosition;\n#include <common>\n#include <uv_pars_vertex>\n#include <uv2_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <envmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <normal_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <uv2_vertex>\n\t#include <color_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <normal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\tvViewPosition = - mvPosition.xyz;\n\t#include <worldpos_vertex>\n\t#include <envmap_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n}",meshphong_frag:"#define PHONG\nuniform vec3 diffuse;\nuniform vec3 emissive;\nuniform vec3 specular;\nuniform float shininess;\nuniform float opacity;\n#include <common>\n#include <packing>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <uv2_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <envmap_common_pars_fragment>\n#include <envmap_pars_fragment>\n#include <cube_uv_reflection_fragment>\n#include <fog_pars_fragment>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <normal_pars_fragment>\n#include <lights_phong_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <specularmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\tvec3 totalEmissiveRadiance = emissive;\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <specularmap_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\t#include <emissivemap_fragment>\n\t#include <lights_phong_fragment>\n\t#include <lights_fragment_begin>\n\t#include <lights_fragment_maps>\n\t#include <lights_fragment_end>\n\t#include <aomap_fragment>\n\tvec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + reflectedLight.directSpecular + reflectedLight.indirectSpecular + totalEmissiveRadiance;\n\t#include <envmap_fragment>\n\t#include <output_fragment>\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",meshphysical_vert:"#define STANDARD\nvarying vec3 vViewPosition;\n#ifdef USE_TRANSMISSION\n\tvarying vec3 vWorldPosition;\n#endif\n#include <common>\n#include <uv_pars_vertex>\n#include <uv2_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <normal_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <uv2_vertex>\n\t#include <color_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <normal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\tvViewPosition = - mvPosition.xyz;\n\t#include <worldpos_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n#ifdef USE_TRANSMISSION\n\tvWorldPosition = worldPosition.xyz;\n#endif\n}",meshphysical_frag:"#define STANDARD\n#ifdef PHYSICAL\n\t#define IOR\n\t#define SPECULAR\n#endif\nuniform vec3 diffuse;\nuniform vec3 emissive;\nuniform float roughness;\nuniform float metalness;\nuniform float opacity;\n#ifdef IOR\n\tuniform float ior;\n#endif\n#ifdef SPECULAR\n\tuniform float specularIntensity;\n\tuniform vec3 specularColor;\n\t#ifdef USE_SPECULARINTENSITYMAP\n\t\tuniform sampler2D specularIntensityMap;\n\t#endif\n\t#ifdef USE_SPECULARCOLORMAP\n\t\tuniform sampler2D specularColorMap;\n\t#endif\n#endif\n#ifdef USE_CLEARCOAT\n\tuniform float clearcoat;\n\tuniform float clearcoatRoughness;\n#endif\n#ifdef USE_SHEEN\n\tuniform vec3 sheenColor;\n\tuniform float sheenRoughness;\n\t#ifdef USE_SHEENCOLORMAP\n\t\tuniform sampler2D sheenColorMap;\n\t#endif\n\t#ifdef USE_SHEENROUGHNESSMAP\n\t\tuniform sampler2D sheenRoughnessMap;\n\t#endif\n#endif\nvarying vec3 vViewPosition;\n#include <common>\n#include <packing>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <uv2_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <bsdfs>\n#include <cube_uv_reflection_fragment>\n#include <envmap_common_pars_fragment>\n#include <envmap_physical_pars_fragment>\n#include <fog_pars_fragment>\n#include <lights_pars_begin>\n#include <normal_pars_fragment>\n#include <lights_physical_pars_fragment>\n#include <transmission_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <clearcoat_pars_fragment>\n#include <roughnessmap_pars_fragment>\n#include <metalnessmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\tvec3 totalEmissiveRadiance = emissive;\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <roughnessmap_fragment>\n\t#include <metalnessmap_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\t#include <clearcoat_normal_fragment_begin>\n\t#include <clearcoat_normal_fragment_maps>\n\t#include <emissivemap_fragment>\n\t#include <lights_physical_fragment>\n\t#include <lights_fragment_begin>\n\t#include <lights_fragment_maps>\n\t#include <lights_fragment_end>\n\t#include <aomap_fragment>\n\tvec3 totalDiffuse = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse;\n\tvec3 totalSpecular = reflectedLight.directSpecular + reflectedLight.indirectSpecular;\n\t#include <transmission_fragment>\n\tvec3 outgoingLight = totalDiffuse + totalSpecular + totalEmissiveRadiance;\n\t#ifdef USE_CLEARCOAT\n\t\tfloat dotNVcc = saturate( dot( geometry.clearcoatNormal, geometry.viewDir ) );\n\t\tvec3 Fcc = F_Schlick( material.clearcoatF0, material.clearcoatF90, dotNVcc );\n\t\toutgoingLight = outgoingLight * ( 1.0 - material.clearcoat * Fcc ) + clearcoatSpecular * material.clearcoat;\n\t#endif\n\t#include <output_fragment>\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",meshtoon_vert:"#define TOON\nvarying vec3 vViewPosition;\n#include <common>\n#include <uv_pars_vertex>\n#include <uv2_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <normal_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <uv2_vertex>\n\t#include <color_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <normal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\tvViewPosition = - mvPosition.xyz;\n\t#include <worldpos_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n}",meshtoon_frag:"#define TOON\nuniform vec3 diffuse;\nuniform vec3 emissive;\nuniform float opacity;\n#include <common>\n#include <packing>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <uv2_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <gradientmap_pars_fragment>\n#include <fog_pars_fragment>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <normal_pars_fragment>\n#include <lights_toon_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\tvec3 totalEmissiveRadiance = emissive;\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\t#include <emissivemap_fragment>\n\t#include <lights_toon_fragment>\n\t#include <lights_fragment_begin>\n\t#include <lights_fragment_maps>\n\t#include <lights_fragment_end>\n\t#include <aomap_fragment>\n\tvec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + totalEmissiveRadiance;\n\t#include <output_fragment>\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",points_vert:"uniform float size;\nuniform float scale;\n#include <common>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <color_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <project_vertex>\n\tgl_PointSize = size;\n\t#ifdef USE_SIZEATTENUATION\n\t\tbool isPerspective = isPerspectiveMatrix( projectionMatrix );\n\t\tif ( isPerspective ) gl_PointSize *= ( scale / - mvPosition.z );\n\t#endif\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <worldpos_vertex>\n\t#include <fog_vertex>\n}",points_frag:"uniform vec3 diffuse;\nuniform float opacity;\n#include <common>\n#include <color_pars_fragment>\n#include <map_particle_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <fog_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec3 outgoingLight = vec3( 0.0 );\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <logdepthbuf_fragment>\n\t#include <map_particle_fragment>\n\t#include <color_fragment>\n\t#include <alphatest_fragment>\n\toutgoingLight = diffuseColor.rgb;\n\t#include <output_fragment>\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n}",shadow_vert:"#include <common>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\nvoid main() {\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <project_vertex>\n\t#include <worldpos_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n}",shadow_frag:"uniform vec3 color;\nuniform float opacity;\n#include <common>\n#include <packing>\n#include <fog_pars_fragment>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <shadowmap_pars_fragment>\n#include <shadowmask_pars_fragment>\nvoid main() {\n\tgl_FragColor = vec4( color, opacity * ( 1.0 - getShadowMask() ) );\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n}",sprite_vert:"uniform float rotation;\nuniform vec2 center;\n#include <common>\n#include <uv_pars_vertex>\n#include <fog_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\tvec4 mvPosition = modelViewMatrix * vec4( 0.0, 0.0, 0.0, 1.0 );\n\tvec2 scale;\n\tscale.x = length( vec3( modelMatrix[ 0 ].x, modelMatrix[ 0 ].y, modelMatrix[ 0 ].z ) );\n\tscale.y = length( vec3( modelMatrix[ 1 ].x, modelMatrix[ 1 ].y, modelMatrix[ 1 ].z ) );\n\t#ifndef USE_SIZEATTENUATION\n\t\tbool isPerspective = isPerspectiveMatrix( projectionMatrix );\n\t\tif ( isPerspective ) scale *= - mvPosition.z;\n\t#endif\n\tvec2 alignedPosition = ( position.xy - ( center - vec2( 0.5 ) ) ) * scale;\n\tvec2 rotatedPosition;\n\trotatedPosition.x = cos( rotation ) * alignedPosition.x - sin( rotation ) * alignedPosition.y;\n\trotatedPosition.y = sin( rotation ) * alignedPosition.x + cos( rotation ) * alignedPosition.y;\n\tmvPosition.xy += rotatedPosition;\n\tgl_Position = projectionMatrix * mvPosition;\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <fog_vertex>\n}",sprite_frag:"uniform vec3 diffuse;\nuniform float opacity;\n#include <common>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <fog_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec3 outgoingLight = vec3( 0.0 );\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\toutgoingLight = diffuseColor.rgb;\n\t#include <output_fragment>\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n}"},Bd={common:{diffuse:{value:new zl(16777215)},opacity:{value:1},map:{value:null},uvTransform:{value:new ss},uv2Transform:{value:new ss},alphaMap:{value:null},alphaTest:{value:0}},specularmap:{specularMap:{value:null}},envmap:{envMap:{value:null},flipEnvMap:{value:-1},reflectivity:{value:1},ior:{value:1.5},refractionRatio:{value:.98}},aomap:{aoMap:{value:null},aoMapIntensity:{value:1}},lightmap:{lightMap:{value:null},lightMapIntensity:{value:1}},emissivemap:{emissiveMap:{value:null}},bumpmap:{bumpMap:{value:null},bumpScale:{value:1}},normalmap:{normalMap:{value:null},normalScale:{value:new os(1,1)}},displacementmap:{displacementMap:{value:null},displacementScale:{value:1},displacementBias:{value:0}},roughnessmap:{roughnessMap:{value:null}},metalnessmap:{metalnessMap:{value:null}},gradientmap:{gradientMap:{value:null}},fog:{fogDensity:{value:25e-5},fogNear:{value:1},fogFar:{value:2e3},fogColor:{value:new zl(16777215)}},lights:{ambientLightColor:{value:[]},lightProbe:{value:[]},directionalLights:{value:[],properties:{direction:{},color:{}}},directionalLightShadows:{value:[],properties:{shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{}}},directionalShadowMap:{value:[]},directionalShadowMatrix:{value:[]},spotLights:{value:[],properties:{color:{},position:{},direction:{},distance:{},coneCos:{},penumbraCos:{},decay:{}}},spotLightShadows:{value:[],properties:{shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{}}},spotShadowMap:{value:[]},spotShadowMatrix:{value:[]},pointLights:{value:[],properties:{color:{},position:{},decay:{},distance:{}}},pointLightShadows:{value:[],properties:{shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{},shadowCameraNear:{},shadowCameraFar:{}}},pointShadowMap:{value:[]},pointShadowMatrix:{value:[]},hemisphereLights:{value:[],properties:{direction:{},skyColor:{},groundColor:{}}},rectAreaLights:{value:[],properties:{color:{},position:{},width:{},height:{}}},ltc_1:{value:null},ltc_2:{value:null}},points:{diffuse:{value:new zl(16777215)},opacity:{value:1},size:{value:1},scale:{value:1},map:{value:null},alphaMap:{value:null},alphaTest:{value:0},uvTransform:{value:new ss}},sprite:{diffuse:{value:new zl(16777215)},opacity:{value:1},center:{value:new os(.5,.5)},rotation:{value:0},map:{value:null},alphaMap:{value:null},alphaTest:{value:0},uvTransform:{value:new ss}}},Ud={basic:{uniforms:T([Bd.common,Bd.specularmap,Bd.envmap,Bd.aomap,Bd.lightmap,Bd.fog]),vertexShader:Od.meshbasic_vert,fragmentShader:Od.meshbasic_frag},lambert:{uniforms:T([Bd.common,Bd.specularmap,Bd.envmap,Bd.aomap,Bd.lightmap,Bd.emissivemap,Bd.fog,Bd.lights,{emissive:{value:new zl(0)}}]),vertexShader:Od.meshlambert_vert,fragmentShader:Od.meshlambert_frag},phong:{uniforms:T([Bd.common,Bd.specularmap,Bd.envmap,Bd.aomap,Bd.lightmap,Bd.emissivemap,Bd.bumpmap,Bd.normalmap,Bd.displacementmap,Bd.fog,Bd.lights,{emissive:{value:new zl(0)},specular:{value:new zl(1118481)},shininess:{value:30}}]),vertexShader:Od.meshphong_vert,fragmentShader:Od.meshphong_frag},standard:{uniforms:T([Bd.common,Bd.envmap,Bd.aomap,Bd.lightmap,Bd.emissivemap,Bd.bumpmap,Bd.normalmap,Bd.displacementmap,Bd.roughnessmap,Bd.metalnessmap,Bd.fog,Bd.lights,{emissive:{value:new zl(0)},roughness:{value:1},metalness:{value:0},envMapIntensity:{value:1}}]),vertexShader:Od.meshphysical_vert,fragmentShader:Od.meshphysical_frag},toon:{uniforms:T([Bd.common,Bd.aomap,Bd.lightmap,Bd.emissivemap,Bd.bumpmap,Bd.normalmap,Bd.displacementmap,Bd.gradientmap,Bd.fog,Bd.lights,{emissive:{value:new zl(0)}}]),vertexShader:Od.meshtoon_vert,fragmentShader:Od.meshtoon_frag},matcap:{uniforms:T([Bd.common,Bd.bumpmap,Bd.normalmap,Bd.displacementmap,Bd.fog,{matcap:{value:null}}]),vertexShader:Od.meshmatcap_vert,fragmentShader:Od.meshmatcap_frag},points:{uniforms:T([Bd.points,Bd.fog]),vertexShader:Od.points_vert,fragmentShader:Od.points_frag},dashed:{uniforms:T([Bd.common,Bd.fog,{scale:{value:1},dashSize:{value:1},totalSize:{value:2}}]),vertexShader:Od.linedashed_vert,fragmentShader:Od.linedashed_frag},depth:{uniforms:T([Bd.common,Bd.displacementmap]),vertexShader:Od.depth_vert,fragmentShader:Od.depth_frag},normal:{uniforms:T([Bd.common,Bd.bumpmap,Bd.normalmap,Bd.displacementmap,{opacity:{value:1}}]),vertexShader:Od.meshnormal_vert,fragmentShader:Od.meshnormal_frag},sprite:{uniforms:T([Bd.sprite,Bd.fog]),vertexShader:Od.sprite_vert,fragmentShader:Od.sprite_frag},background:{uniforms:{uvTransform:{value:new ss},t2D:{value:null}},vertexShader:Od.background_vert,fragmentShader:Od.background_frag},cube:{uniforms:T([Bd.envmap,{opacity:{value:1}}]),vertexShader:Od.cube_vert,fragmentShader:Od.cube_frag},equirect:{uniforms:{tEquirect:{value:null}},vertexShader:Od.equirect_vert,fragmentShader:Od.equirect_frag},distanceRGBA:{uniforms:T([Bd.common,Bd.displacementmap,{referencePosition:{value:new vs},nearDistance:{value:1},farDistance:{value:1e3}}]),vertexShader:Od.distanceRGBA_vert,fragmentShader:Od.distanceRGBA_frag},shadow:{uniforms:T([Bd.lights,Bd.fog,{color:{value:new zl(0)},opacity:{value:1}}]),vertexShader:Od.shadow_vert,fragmentShader:Od.shadow_frag}};Ud.physical={uniforms:T([Ud.standard.uniforms,{clearcoat:{value:0},clearcoatMap:{value:null},clearcoatRoughness:{value:0},clearcoatRoughnessMap:{value:null},clearcoatNormalScale:{value:new os(1,1)},clearcoatNormalMap:{value:null},sheen:{value:0},sheenColor:{value:new zl(0)},sheenColorMap:{value:null},sheenRoughness:{value:0},sheenRoughnessMap:{value:null},transmission:{value:0},transmissionMap:{value:null},transmissionSamplerSize:{value:new os},transmissionSamplerMap:{value:null},thickness:{value:0},thicknessMap:{value:null},attenuationDistance:{value:0},attenuationColor:{value:new zl(0)},specularIntensity:{value:0},specularIntensityMap:{value:null},specularColor:{value:new zl(1,1,1)},specularColorMap:{value:null}}]),vertexShader:Od.meshphysical_vert,fragmentShader:Od.meshphysical_frag};function k(e,t,a,r,i){var s=new zl(0),l=0,d,c,u=null,p=0,m=null;function n(a,i){var n=!1,g=!0===i.isScene?i.background:null;if(g&&g.isTexture){g=t.get(g)}var f=e.xr,h=f.getSession&&f.getSession();if(h&&"additive"===h.environmentBlendMode){g=null}if(null===g){o(s,l)}else if(g&&g.isColor){o(g,1);n=!0}if(e.autoClear||n){e.clear(e.autoClearColor,e.autoClearDepth,e.autoClearStencil)}if(g&&(g.isCubeTexture||g.mapping===Ai)){if(c===void 0){c=new bd(new Sd(1,1,1),new Td({name:"BackgroundCubeMaterial",uniforms:M(Ud.cube.uniforms),vertexShader:Ud.cube.vertexShader,fragmentShader:Ud.cube.fragmentShader,side:Ir,depthTest:!1,depthWrite:!1,fog:!1}));c.geometry.deleteAttribute("normal");c.geometry.deleteAttribute("uv");c.onBeforeRender=function(e,t,a){this.matrixWorld.copyPosition(a.matrixWorld)};Object.defineProperty(c.material,"envMap",{get:function get(){return this.uniforms.envMap.value}});r.update(c)}c.material.uniforms.envMap.value=g;c.material.uniforms.flipEnvMap.value=g.isCubeTexture&&!1===g.isRenderTargetTexture?-1:1;if(u!==g||p!==g.version||m!==e.toneMapping){c.material.needsUpdate=!0;u=g;p=g.version;m=e.toneMapping}a.unshift(c,c.geometry,c.material,0,0,null)}else if(g&&g.isTexture){if(d===void 0){d=new bd(new Fd(2,2),new Td({name:"BackgroundMaterial",uniforms:M(Ud.background.uniforms),vertexShader:Ud.background.vertexShader,fragmentShader:Ud.background.fragmentShader,side:Pr,depthTest:!1,depthWrite:!1,fog:!1}));d.geometry.deleteAttribute("normal");Object.defineProperty(d.material,"map",{get:function get(){return this.uniforms.t2D.value}});r.update(d)}d.material.uniforms.t2D.value=g;if(!0===g.matrixAutoUpdate){g.updateMatrix()}d.material.uniforms.uvTransform.value.copy(g.matrix);if(u!==g||p!==g.version||m!==e.toneMapping){d.material.needsUpdate=!0;u=g;p=g.version;m=e.toneMapping}a.unshift(d,d.geometry,d.material,0,0,null)}}function o(e,t){a.buffers.color.setClear(e.r,e.g,e.b,t,i)}return{getClearColor:function getClearColor(){return s},setClearColor:function setClearColor(e){var t=1<arguments.length&&arguments[1]!==void 0?arguments[1]:1;s.set(e);l=t;o(s,l)},getClearAlpha:function getClearAlpha(){return l},setClearAlpha:function setClearAlpha(e){l=e;o(s,l)},render:n}}function C(e,t,a,r){var x=e.getParameter(34921),b=r.isWebGL2?null:t.get("OES_vertex_array_object"),S=r.isWebGL2||null!==b,M={},T=d(null),E=T;function i(t,r,i,n,s){var d=!1;if(S){var p=l(n,i,r);if(E!==p){E=p;o(E.object)}d=c(n,s);if(d)u(n,s)}else{var m=!0===r.wireframe;if(E.geometry!==n.id||E.program!==i.id||E.wireframe!==m){E.geometry=n.id;E.program=i.id;E.wireframe=m;d=!0}}if(!0===t.isInstancedMesh){d=!0}if(null!==s){a.update(s,34963)}if(d){y(t,r,i,n);if(null!==s){e.bindBuffer(34963,a.get(s).buffer)}}}function n(){if(r.isWebGL2)return e.createVertexArray();return b.createVertexArrayOES()}function o(t){if(r.isWebGL2)return e.bindVertexArray(t);return b.bindVertexArrayOES(t)}function s(t){if(r.isWebGL2)return e.deleteVertexArray(t);return b.deleteVertexArrayOES(t)}function l(e,t,a){var r=!0===a.wireframe,i=M[e.id];if(i===void 0){i={};M[e.id]=i}var o=i[t.id];if(o===void 0){o={};i[t.id]=o}var s=o[r];if(s===void 0){s=d(n());o[r]=s}return s}function d(e){for(var t=[],a=[],r=[],i=0;i<x;i++){t[i]=0;a[i]=0;r[i]=0}return{geometry:null,program:null,wireframe:!1,newAttributes:t,enabledAttributes:a,attributeDivisors:r,object:e,attributes:{},index:null}}function c(e,t){var a=E.attributes,r=e.attributes,i=0;for(var s in r){var n=a[s],o=r[s];if(n===void 0)return!0;if(n.attribute!==o)return!0;if(n.data!==o.data)return!0;i++}if(E.attributesNum!==i)return!0;if(E.index!==t)return!0;return!1}function u(e,t){var a={},r=e.attributes,i=0;for(var s in r){var n=r[s],o={};o.attribute=n;if(n.data){o.data=n.data}a[s]=o;i++}E.attributes=a;E.attributesNum=i;E.index=t}function p(){for(var e=E.newAttributes,t=0,a=e.length;t<a;t++){e[t]=0}}function m(e){g(e,0)}function g(a,i){var n=E.newAttributes,o=E.enabledAttributes,s=E.attributeDivisors;n[a]=1;if(0===o[a]){e.enableVertexAttribArray(a);o[a]=1}if(s[a]!==i){var l=r.isWebGL2?e:t.get("ANGLE_instanced_arrays");l[r.isWebGL2?"vertexAttribDivisor":"vertexAttribDivisorANGLE"](a,i);s[a]=i}}function f(){for(var t=E.newAttributes,a=E.enabledAttributes,r=0,i=a.length;r<i;r++){if(a[r]!==t[r]){e.disableVertexAttribArray(r);a[r]=0}}}function h(t,a,i,n,o,s){if(!0===r.isWebGL2&&(5124===i||5125===i)){e.vertexAttribIPointer(t,a,i,o,s)}else{e.vertexAttribPointer(t,a,i,n,o,s)}}function y(i,n,o,s){if(!1===r.isWebGL2&&(i.isInstancedMesh||s.isInstancedBufferGeometry)){if(null===t.get("ANGLE_instanced_arrays"))return}p();var l=s.attributes,d=o.getAttributes(),c=n.defaultAttributeValues;for(var E in d){var w=d[E];if(0<=w.location){var A=l[E];if(A===void 0){if("instanceMatrix"===E&&i.instanceMatrix)A=i.instanceMatrix;if("instanceColor"===E&&i.instanceColor)A=i.instanceColor}if(A!==void 0){var u=A.normalized,y=A.itemSize,v=a.get(A);if(v===void 0)continue;var _=v.buffer,x=v.type,b=v.bytesPerElement;if(A.isInterleavedBufferAttribute){var S=A.data,M=S.stride,T=A.offset;if(S&&S.isInstancedInterleavedBuffer){for(var k=0;k<w.locationSize;k++){g(w.location+k,S.meshPerAttribute)}if(!0!==i.isInstancedMesh&&s._maxInstanceCount===void 0){s._maxInstanceCount=S.meshPerAttribute*S.count}}else{for(var C=0;C<w.locationSize;C++){m(w.location+C)}}e.bindBuffer(34962,_);for(var R=0;R<w.locationSize;R++){h(w.location+R,y/w.locationSize,x,u,M*b,(T+y/w.locationSize*R)*b)}}else{if(A.isInstancedBufferAttribute){for(var L=0;L<w.locationSize;L++){g(w.location+L,A.meshPerAttribute)}if(!0!==i.isInstancedMesh&&s._maxInstanceCount===void 0){s._maxInstanceCount=A.meshPerAttribute*A.count}}else{for(var P=0;P<w.locationSize;P++){m(w.location+P)}}e.bindBuffer(34962,_);for(var I=0;I<w.locationSize;I++){h(w.location+I,y/w.locationSize,x,u,y*b,y/w.locationSize*I*b)}}}else if(c!==void 0){var D=c[E];if(D!==void 0){switch(D.length){case 2:e.vertexAttrib2fv(w.location,D);break;case 3:e.vertexAttrib3fv(w.location,D);break;case 4:e.vertexAttrib4fv(w.location,D);break;default:e.vertexAttrib1fv(w.location,D);}}}}}f()}function v(){_();if(E===T)return;E=T;o(E.object)}function _(){T.geometry=null;T.program=null;T.wireframe=!1}return{setup:i,reset:v,resetDefaultState:_,dispose:function(){v();for(var e in M){var t=M[e];for(var a in t){var r=t[a];for(var i in r){s(r[i].object);delete r[i]}delete t[a]}delete M[e]}},releaseStatesOfGeometry:function(e){if(M[e.id]===void 0)return;var t=M[e.id];for(var a in t){var r=t[a];for(var i in r){s(r[i].object);delete r[i]}delete t[a]}delete M[e.id]},releaseStatesOfProgram:function(e){for(var t in M){var a=M[t];if(a[e.id]===void 0)continue;var r=a[e.id];for(var i in r){s(r[i].object);delete r[i]}delete a[e.id]}},initAttributes:p,enableAttribute:m,disableUnusedAttributes:f}}function R(e,t,a,r){var o=r.isWebGL2,s;function i(t,r){e.drawArrays(s,t,r);a.update(r,s,1)}function n(r,i,n){if(0===n)return;var l,d;if(o){l=e;d="drawArraysInstanced"}else{l=t.get("ANGLE_instanced_arrays");d="drawArraysInstancedANGLE";if(null===l){console.error("THREE.WebGLBufferRenderer: using THREE.InstancedBufferGeometry but hardware does not support extension ANGLE_instanced_arrays.");return}}l[d](s,r,i,n);a.update(i,s,n)}this.setMode=function(e){s=e};this.render=i;this.renderInstances=n}function L(e,t,a){var n;function r(){if(n!==void 0)return n;if(!0===t.has("EXT_texture_filter_anisotropic")){var a=t.get("EXT_texture_filter_anisotropic");n=e.getParameter(a.MAX_TEXTURE_MAX_ANISOTROPY_EXT)}else{n=0}return n}function i(t){if("highp"===t){if(0<e.getShaderPrecisionFormat(35633,36338).precision&&0<e.getShaderPrecisionFormat(35632,36338).precision){return"highp"}t="mediump"}if("mediump"===t){if(0<e.getShaderPrecisionFormat(35633,36337).precision&&0<e.getShaderPrecisionFormat(35632,36337).precision){return"mediump"}}return"lowp"}var o="undefined"!=typeof WebGL2RenderingContext&&e instanceof WebGL2RenderingContext||"undefined"!=typeof WebGL2ComputeRenderingContext&&e instanceof WebGL2ComputeRenderingContext,s=a.precision!==void 0?a.precision:"highp",l=i(s);if(l!==s){console.warn("THREE.WebGLRenderer:",s,"not supported, using",l,"instead.");s=l}var d=o||t.has("WEBGL_draw_buffers"),c=!0===a.logarithmicDepthBuffer,u=e.getParameter(34930),p=e.getParameter(35660),m=e.getParameter(3379),g=e.getParameter(34076),f=e.getParameter(34921),h=e.getParameter(36347),y=e.getParameter(36348),v=e.getParameter(36349),_=0<p,x=o||t.has("OES_texture_float"),b=o?e.getParameter(36183):0;return{isWebGL2:o,drawBuffers:d,getMaxAnisotropy:r,getMaxPrecision:i,precision:s,logarithmicDepthBuffer:c,maxTextures:u,maxVertexTextures:p,maxTextureSize:m,maxCubemapSize:g,maxAttributes:f,maxVertexUniforms:h,maxVaryings:y,maxFragmentUniforms:v,vertexTextures:_,floatFragmentTextures:x,floatVertexTextures:_&&x,maxSamples:b}}function P(e){var r=this,i=null,n=0,o=!1,s=!1,l=new Id,d=new ss,c={value:null,needsUpdate:!1};this.uniform=c;this.numPlanes=0;this.numIntersection=0;this.init=function(e,t,r){var s=0!==e.length||t||0!==n||o;o=t;i=a(e,r,0);n=e.length;return s};this.beginShadows=function(){s=!0;a(null)};this.endShadows=function(){s=!1;t()};this.setState=function(r,l,d){var u=r.clippingPlanes,p=r.clipIntersection,m=r.clipShadows,g=e.get(r);if(!o||null===u||0===u.length||s&&!m){if(s){a(null)}else{t()}}else{var f=s?0:n,h=4*f,y=g.clippingState||null;c.value=y;y=a(u,l,h,d);for(var v=0;v!=h;++v){y[v]=i[v]}g.clippingState=y;this.numIntersection=p?this.numPlanes:0;this.numPlanes+=f}};function t(){if(c.value!==i){c.value=i;c.needsUpdate=0<n}r.numPlanes=n;r.numIntersection=0}function a(e,t,a,i){var n=null!==e?e.length:0,o=null;if(0!==n){o=c.value;if(!0!==i||null===o){var s=a+4*n,u=t.matrixWorldInverse;d.getNormalMatrix(u);if(null===o||o.length<s){o=new Float32Array(s)}for(var p=0,m=a;p!==n;++p,m+=4){l.copy(e[p]).applyMatrix4(u,d);l.normal.toArray(o,m);o[m+3]=l.constant}}c.value=o;c.needsUpdate=!0}r.numPlanes=n;r.numIntersection=0;return o}}function I(e){var i=new WeakMap;function t(e,t){if(t===Ei){e.mapping=Mi}else if(t===wi){e.mapping=Ti}return e}function a(a){if(a&&a.isTexture&&!1===a.isRenderTargetTexture){var s=a.mapping;if(s===Ei||s===wi){if(i.has(a)){var l=i.get(a).texture;return t(l,a.mapping)}else{var d=a.image;if(d&&0<d.height){var n=e.getRenderTarget(),o=new Cd(d.height/2);o.fromEquirectangularTexture(e,a);i.set(a,o);e.setRenderTarget(n);a.addEventListener("dispose",r);return t(o.texture,a.mapping)}else{return null}}}}return a}function r(e){var t=e.target;t.removeEventListener("dispose",r);var a=i.get(t);if(a!==void 0){i.delete(t);a.dispose()}}return{get:a,dispose:function(){i=new WeakMap}}}var Gd=function(e){_inherits(t,e);var a=_createSuper(t);function t(){var e,r=0<arguments.length&&arguments[0]!==void 0?arguments[0]:-1,i=1<arguments.length&&arguments[1]!==void 0?arguments[1]:1,n=2<arguments.length&&arguments[2]!==void 0?arguments[2]:1,o=3<arguments.length&&arguments[3]!==void 0?arguments[3]:-1,s=4<arguments.length&&arguments[4]!==void 0?arguments[4]:.1,l=5<arguments.length&&arguments[5]!==void 0?arguments[5]:2e3;_classCallCheck2(this,t);e=a.call(this);e.type="OrthographicCamera";e.zoom=1;e.view=null;e.left=r;e.right=i;e.top=n;e.bottom=o;e.near=s;e.far=l;e.updateProjectionMatrix();return e}_createClass2(t,[{key:"copy",value:function copy(e,a){_get(_getPrototypeOf(t.prototype),"copy",this).call(this,e,a);this.left=e.left;this.right=e.right;this.top=e.top;this.bottom=e.bottom;this.near=e.near;this.far=e.far;this.zoom=e.zoom;this.view=null===e.view?null:Object.assign({},e.view);return this}},{key:"setViewOffset",value:function setViewOffset(e,t,a,r,i,n){if(null===this.view){this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}}this.view.enabled=!0;this.view.fullWidth=e;this.view.fullHeight=t;this.view.offsetX=a;this.view.offsetY=r;this.view.width=i;this.view.height=n;this.updateProjectionMatrix()}},{key:"clearViewOffset",value:function clearViewOffset(){if(null!==this.view){this.view.enabled=!1}this.updateProjectionMatrix()}},{key:"updateProjectionMatrix",value:function updateProjectionMatrix(){var e=(this.right-this.left)/(2*this.zoom),t=(this.top-this.bottom)/(2*this.zoom),a=(this.right+this.left)/2,r=(this.top+this.bottom)/2,i=a-e,n=a+e,o=r+t,s=r-t;if(null!==this.view&&this.view.enabled){var l=(this.right-this.left)/this.view.fullWidth/this.zoom,d=(this.top-this.bottom)/this.view.fullHeight/this.zoom;i+=l*this.view.offsetX;n=i+l*this.view.width;o-=d*this.view.offsetY;s=o-d*this.view.height}this.projectionMatrix.makeOrthographic(i,n,o,s,this.near,this.far);this.projectionMatrixInverse.copy(this.projectionMatrix).invert()}},{key:"toJSON",value:function toJSON(e){var a=_get(_getPrototypeOf(t.prototype),"toJSON",this).call(this,e);a.object.zoom=this.zoom;a.object.left=this.left;a.object.right=this.right;a.object.top=this.top;a.object.bottom=this.bottom;a.object.near=this.near;a.object.far=this.far;if(null!==this.view)a.object.view=Object.assign({},this.view);return a}}]);return t}(Ed);Gd.prototype.isOrthographicCamera=!0;var Hd=function(e){_inherits(t,e);var a=_createSuper(t);function t(e){var r;_classCallCheck2(this,t);r=a.call(this,e);r.type="RawShaderMaterial";return r}return t}(Td);Hd.prototype.isRawShaderMaterial=!0;var Vd=8,Wd=Math.pow(2,Vd),jd=[.125,.215,.35,.446,.526,.582],qd=Vd-4+1+jd.length,Xd=20,Yd=(xr={},_defineProperty2(xr,ho,0),_defineProperty2(xr,yo,1),_defineProperty2(xr,_o,2),_defineProperty2(xr,xo,3),_defineProperty2(xr,bo,4),_defineProperty2(xr,So,5),_defineProperty2(xr,vo,6),xr),Zd=new Gd,Jd=function(){for(var e=[],t=[],a=[],r=Vd,i=0,n;i<qd;i++){n=Math.pow(2,r);t.push(n);var y=1/n;if(i>Vd-4){y=jd[i-Vd+4-1]}else if(0==i){y=0}a.push(y);for(var o=1/(n-1),s=-o/2,l=1+o/2,d=[s,s,l,s,l,l,s,s,l,l,s,l],c=6,u=6,p=3,m=2,g=1,f=new Float32Array(p*u*c),h=new Float32Array(m*u*c),v=new Float32Array(g*u*c),_=0;_<c;_++){var b=2*(_%3)/3-1,x=2<_?0:-1;f.set([b,x,0,b+2/3,x,0,b+2/3,x+1,0,b,x,0,b+2/3,x+1,0,b,x+1,0],p*u*_);h.set(d,m*u*_);var S=[_,_,_,_,_,_];v.set(S,g*u*_)}var M=new rd;M.setAttribute("position",new Bl(f,p));M.setAttribute("uv",new Bl(h,m));M.setAttribute("faceIndex",new Bl(v,g));e.push(M);if(r>4){r--}}return{_lodPlanes:e,_sizeLods:t,_sigmas:a}}(),Qd=Jd._lodPlanes,Kd=Jd._sizeLods,$d=Jd._sigmas,ec=new zl,tc=null,ac=(1+Math.sqrt(5))/2,rc=1/ac,ic=[new vs(1,1,1),new vs(-1,1,1),new vs(1,1,-1),new vs(-1,1,-1),new vs(0,ac,rc),new vs(0,ac,-rc),new vs(rc,0,ac),new vs(-rc,0,ac),new vs(ac,rc,0),new vs(-ac,rc,0)],nc=function(){function e(t){_classCallCheck2(this,e);this._renderer=t;this._pingPongRenderTarget=null;this._blurMaterial=F(Xd);this._equirectShader=null;this._cubemapShader=null;this._compileMaterial(this._blurMaterial)}_createClass2(e,[{key:"fromScene",value:function fromScene(e){var t=1<arguments.length&&arguments[1]!==void 0?arguments[1]:0,a=2<arguments.length&&arguments[2]!==void 0?arguments[2]:.1,r=3<arguments.length&&arguments[3]!==void 0?arguments[3]:100;tc=this._renderer.getRenderTarget();var i=this._allocateTargets();this._sceneToCubeUV(e,a,r,i);if(0<t){this._blur(i,0,0,t)}this._applyPMREM(i);this._cleanup(i);return i}},{key:"fromEquirectangular",value:function fromEquirectangular(e){return this._fromTexture(e)}},{key:"fromCubemap",value:function fromCubemap(e){return this._fromTexture(e)}},{key:"compileCubemapShader",value:function compileCubemapShader(){if(null===this._cubemapShader){this._cubemapShader=B();this._compileMaterial(this._cubemapShader)}}},{key:"compileEquirectangularShader",value:function compileEquirectangularShader(){if(null===this._equirectShader){this._equirectShader=O();this._compileMaterial(this._equirectShader)}}},{key:"dispose",value:function dispose(){this._blurMaterial.dispose();if(null!==this._cubemapShader)this._cubemapShader.dispose();if(null!==this._equirectShader)this._equirectShader.dispose();for(var e=0;e<Qd.length;e++){Qd[e].dispose()}}},{key:"_cleanup",value:function _cleanup(e){this._pingPongRenderTarget.dispose();this._renderer.setRenderTarget(tc);e.scissorTest=!1;N(e,0,0,e.width,e.height)}},{key:"_fromTexture",value:function _fromTexture(e){tc=this._renderer.getRenderTarget();var t=this._allocateTargets(e);this._textureToCubeUV(e,t);this._applyPMREM(t);this._cleanup(t);return t}},{key:"_allocateTargets",value:function _allocateTargets(e){var t={magFilter:Pi,minFilter:Pi,generateMipmaps:!1,type:Hi,format:on,encoding:D(e)?e.encoding:_o,depthBuffer:!1},a=z(t);a.depthBuffer=e?!1:!0;this._pingPongRenderTarget=z(t);return a}},{key:"_compileMaterial",value:function _compileMaterial(e){var t=new bd(Qd[0],e);this._renderer.compile(t,Zd)}},{key:"_sceneToCubeUV",value:function _sceneToCubeUV(e,t,a,r){var i=new wd(90,1,t,a),n=[1,-1,1,1,1,1],o=[1,1,1,-1,-1,-1],s=this._renderer,l=s.autoClear,d=s.outputEncoding,c=s.toneMapping;s.getClearColor(ec);s.toneMapping=hi;s.outputEncoding=ho;s.autoClear=!1;var u=new Nl({name:"PMREM.Background",side:Ir,depthWrite:!1,depthTest:!1}),p=new bd(new Sd(),u),m=!1,g=e.background;if(g){if(g.isColor){u.color.copy(g);e.background=null;m=!0}}else{u.color.copy(ec);m=!0}for(var f=0,h;6>f;f++){h=f%3;if(0==h){i.up.set(0,n[f],0);i.lookAt(o[f],0,0)}else if(1==h){i.up.set(0,0,n[f]);i.lookAt(0,o[f],0)}else{i.up.set(0,n[f],0);i.lookAt(0,0,o[f])}N(r,h*Wd,2<f?Wd:0,Wd,Wd);s.setRenderTarget(r);if(m){s.render(p,i)}s.render(e,i)}p.geometry.dispose();p.material.dispose();s.toneMapping=c;s.outputEncoding=d;s.autoClear=l;e.background=g}},{key:"_setEncoding",value:function _setEncoding(e,t){e.value=Yd[t.encoding]}},{key:"_textureToCubeUV",value:function _textureToCubeUV(e,t){var a=this._renderer,r=e.mapping===Mi||e.mapping===Ti;if(r){if(null==this._cubemapShader){this._cubemapShader=B()}}else{if(null==this._equirectShader){this._equirectShader=O()}}var i=r?this._cubemapShader:this._equirectShader,n=new bd(Qd[0],i),o=i.uniforms;o.envMap.value=e;if(!r){o.texelSize.value.set(1/e.image.width,1/e.image.height)}this._setEncoding(o.inputEncoding,e);this._setEncoding(o.outputEncoding,t.texture);N(t,0,0,3*Wd,2*Wd);a.setRenderTarget(t);a.render(n,Zd)}},{key:"_applyPMREM",value:function _applyPMREM(e){var t=this._renderer,a=t.autoClear;t.autoClear=!1;for(var n=1;n<qd;n++){var r=Math.sqrt($d[n]*$d[n]-$d[n-1]*$d[n-1]),i=ic[(n-1)%ic.length];this._blur(e,n-1,n,r,i)}t.autoClear=a}},{key:"_blur",value:function _blur(e,t,a,r,i){var n=this._pingPongRenderTarget;this._halfBlur(e,n,t,a,r,"latitudinal",i);this._halfBlur(n,e,a,a,r,"longitudinal",i)}},{key:"_halfBlur",value:function _halfBlur(e,t,a,r,i,n,o){var s=this._renderer,l=this._blurMaterial;if("latitudinal"!==n&&"longitudinal"!==n){console.error("blur direction must be either latitudinal or longitudinal!")}var d=new bd(Qd[r],l),c=l.uniforms,u=Kd[a]-1,p=isFinite(i)?Math.PI/(2*u):2*Math.PI/(2*Xd-1),m=i/p,g=isFinite(i)?1+Math.floor(3*m):Xd;if(g>Xd){console.warn("sigmaRadians, ".concat(i,", is too large and will clip, as it requested ").concat(g," samples when the maximum is set to ").concat(Xd))}for(var f=[],h=0,v=0;v<Xd;++v){var _=v/m,b=Math.exp(-_*_/2);f.push(b);if(0==v){h+=b}else if(v<g){h+=2*b}}for(var y=0;y<f.length;y++){f[y]=f[y]/h}c.envMap.value=e.texture;c.samples.value=g;c.weights.value=f;c.latitudinal.value="latitudinal"===n;if(o){c.poleAxis.value=o}c.dTheta.value=p;c.mipInt.value=Vd-a;this._setEncoding(c.inputEncoding,e.texture);this._setEncoding(c.outputEncoding,e.texture);var S=Kd[r],M=3*Math.max(0,Wd-2*S),x=(0===r?0:2*Wd)+2*S*(r>Vd-4?r-Vd+4:0);N(t,M,x,3*S,2*S);s.setRenderTarget(t);s.render(d,Zd)}}]);return e}();function D(e){if(e===void 0||e.type!==Hi)return!1;return e.encoding===ho||e.encoding===yo||e.encoding===vo}function z(e){var t=new gs(3*Wd,3*Wd,e);t.texture.mapping=Ai;t.texture.name="PMREM.cubeUv";t.scissorTest=!0;return t}function N(e,t,a,r,i){e.viewport.set(t,a,r,i);e.scissor.set(t,a,r,i)}function F(e){var t=new Float32Array(e),a=new vs(0,1,0),r=new Hd({name:"SphericalGaussianBlur",defines:{n:e},uniforms:{envMap:{value:null},samples:{value:1},weights:{value:t},latitudinal:{value:!1},dTheta:{value:0},mipInt:{value:0},poleAxis:{value:a},inputEncoding:{value:Yd[ho]},outputEncoding:{value:Yd[ho]}},vertexShader:U(),fragmentShader:"\n\n\t\t\tprecision mediump float;\n\t\t\tprecision mediump int;\n\n\t\t\tvarying vec3 vOutputDirection;\n\n\t\t\tuniform sampler2D envMap;\n\t\t\tuniform int samples;\n\t\t\tuniform float weights[ n ];\n\t\t\tuniform bool latitudinal;\n\t\t\tuniform float dTheta;\n\t\t\tuniform float mipInt;\n\t\t\tuniform vec3 poleAxis;\n\n\t\t\t".concat(G(),"\n\n\t\t\t#define ENVMAP_TYPE_CUBE_UV\n\t\t\t#include <cube_uv_reflection_fragment>\n\n\t\t\tvec3 getSample( float theta, vec3 axis ) {\n\n\t\t\t\tfloat cosTheta = cos( theta );\n\t\t\t\t// Rodrigues' axis-angle rotation\n\t\t\t\tvec3 sampleDirection = vOutputDirection * cosTheta\n\t\t\t\t\t+ cross( axis, vOutputDirection ) * sin( theta )\n\t\t\t\t\t+ axis * dot( axis, vOutputDirection ) * ( 1.0 - cosTheta );\n\n\t\t\t\treturn bilinearCubeUV( envMap, sampleDirection, mipInt );\n\n\t\t\t}\n\n\t\t\tvoid main() {\n\n\t\t\t\tvec3 axis = latitudinal ? poleAxis : cross( poleAxis, vOutputDirection );\n\n\t\t\t\tif ( all( equal( axis, vec3( 0.0 ) ) ) ) {\n\n\t\t\t\t\taxis = vec3( vOutputDirection.z, 0.0, - vOutputDirection.x );\n\n\t\t\t\t}\n\n\t\t\t\taxis = normalize( axis );\n\n\t\t\t\tgl_FragColor = vec4( 0.0, 0.0, 0.0, 1.0 );\n\t\t\t\tgl_FragColor.rgb += weights[ 0 ] * getSample( 0.0, axis );\n\n\t\t\t\tfor ( int i = 1; i < n; i++ ) {\n\n\t\t\t\t\tif ( i >= samples ) {\n\n\t\t\t\t\t\tbreak;\n\n\t\t\t\t\t}\n\n\t\t\t\t\tfloat theta = dTheta * float( i );\n\t\t\t\t\tgl_FragColor.rgb += weights[ i ] * getSample( -1.0 * theta, axis );\n\t\t\t\t\tgl_FragColor.rgb += weights[ i ] * getSample( theta, axis );\n\n\t\t\t\t}\n\n\t\t\t\tgl_FragColor = linearToOutputTexel( gl_FragColor );\n\n\t\t\t}\n\t\t"),blending:Fr,depthTest:!1,depthWrite:!1});return r}function O(){var e=new os(1,1),t=new Hd({name:"EquirectangularToCubeUV",uniforms:{envMap:{value:null},texelSize:{value:e},inputEncoding:{value:Yd[ho]},outputEncoding:{value:Yd[ho]}},vertexShader:U(),fragmentShader:"\n\n\t\t\tprecision mediump float;\n\t\t\tprecision mediump int;\n\n\t\t\tvarying vec3 vOutputDirection;\n\n\t\t\tuniform sampler2D envMap;\n\t\t\tuniform vec2 texelSize;\n\n\t\t\t".concat(G(),"\n\n\t\t\t#include <common>\n\n\t\t\tvoid main() {\n\n\t\t\t\tgl_FragColor = vec4( 0.0, 0.0, 0.0, 1.0 );\n\n\t\t\t\tvec3 outputDirection = normalize( vOutputDirection );\n\t\t\t\tvec2 uv = equirectUv( outputDirection );\n\n\t\t\t\tvec2 f = fract( uv / texelSize - 0.5 );\n\t\t\t\tuv -= f * texelSize;\n\t\t\t\tvec3 tl = envMapTexelToLinear( texture2D ( envMap, uv ) ).rgb;\n\t\t\t\tuv.x += texelSize.x;\n\t\t\t\tvec3 tr = envMapTexelToLinear( texture2D ( envMap, uv ) ).rgb;\n\t\t\t\tuv.y += texelSize.y;\n\t\t\t\tvec3 br = envMapTexelToLinear( texture2D ( envMap, uv ) ).rgb;\n\t\t\t\tuv.x -= texelSize.x;\n\t\t\t\tvec3 bl = envMapTexelToLinear( texture2D ( envMap, uv ) ).rgb;\n\n\t\t\t\tvec3 tm = mix( tl, tr, f.x );\n\t\t\t\tvec3 bm = mix( bl, br, f.x );\n\t\t\t\tgl_FragColor.rgb = mix( tm, bm, f.y );\n\n\t\t\t\tgl_FragColor = linearToOutputTexel( gl_FragColor );\n\n\t\t\t}\n\t\t"),blending:Fr,depthTest:!1,depthWrite:!1});return t}function B(){var e=new Hd({name:"CubemapToCubeUV",uniforms:{envMap:{value:null},inputEncoding:{value:Yd[ho]},outputEncoding:{value:Yd[ho]}},vertexShader:U(),fragmentShader:"\n\n\t\t\tprecision mediump float;\n\t\t\tprecision mediump int;\n\n\t\t\tvarying vec3 vOutputDirection;\n\n\t\t\tuniform samplerCube envMap;\n\n\t\t\t".concat(G(),"\n\n\t\t\tvoid main() {\n\n\t\t\t\tgl_FragColor = vec4( 0.0, 0.0, 0.0, 1.0 );\n\t\t\t\tgl_FragColor.rgb = envMapTexelToLinear( textureCube( envMap, vec3( - vOutputDirection.x, vOutputDirection.yz ) ) ).rgb;\n\t\t\t\tgl_FragColor = linearToOutputTexel( gl_FragColor );\n\n\t\t\t}\n\t\t"),blending:Fr,depthTest:!1,depthWrite:!1});return e}function U(){return"\n\n\t\tprecision mediump float;\n\t\tprecision mediump int;\n\n\t\tattribute vec3 position;\n\t\tattribute vec2 uv;\n\t\tattribute float faceIndex;\n\n\t\tvarying vec3 vOutputDirection;\n\n\t\t// RH coordinate system; PMREM face-indexing convention\n\t\tvec3 getDirection( vec2 uv, float face ) {\n\n\t\t\tuv = 2.0 * uv - 1.0;\n\n\t\t\tvec3 direction = vec3( uv, 1.0 );\n\n\t\t\tif ( face == 0.0 ) {\n\n\t\t\t\tdirection = direction.zyx; // ( 1, v, u ) pos x\n\n\t\t\t} else if ( face == 1.0 ) {\n\n\t\t\t\tdirection = direction.xzy;\n\t\t\t\tdirection.xz *= -1.0; // ( -u, 1, -v ) pos y\n\n\t\t\t} else if ( face == 2.0 ) {\n\n\t\t\t\tdirection.x *= -1.0; // ( -u, v, 1 ) pos z\n\n\t\t\t} else if ( face == 3.0 ) {\n\n\t\t\t\tdirection = direction.zyx;\n\t\t\t\tdirection.xz *= -1.0; // ( -1, v, -u ) neg x\n\n\t\t\t} else if ( face == 4.0 ) {\n\n\t\t\t\tdirection = direction.xzy;\n\t\t\t\tdirection.xy *= -1.0; // ( -u, -1, v ) neg y\n\n\t\t\t} else if ( face == 5.0 ) {\n\n\t\t\t\tdirection.z *= -1.0; // ( u, v, -1 ) neg z\n\n\t\t\t}\n\n\t\t\treturn direction;\n\n\t\t}\n\n\t\tvoid main() {\n\n\t\t\tvOutputDirection = getDirection( uv, faceIndex );\n\t\t\tgl_Position = vec4( position, 1.0 );\n\n\t\t}\n\t"}function G(){return"\n\n\t\tuniform int inputEncoding;\n\t\tuniform int outputEncoding;\n\n\t\t#include <encodings_pars_fragment>\n\n\t\tvec4 inputTexelToLinear( vec4 value ) {\n\n\t\t\tif ( inputEncoding == 0 ) {\n\n\t\t\t\treturn value;\n\n\t\t\t} else if ( inputEncoding == 1 ) {\n\n\t\t\t\treturn sRGBToLinear( value );\n\n\t\t\t} else if ( inputEncoding == 2 ) {\n\n\t\t\t\treturn RGBEToLinear( value );\n\n\t\t\t} else if ( inputEncoding == 3 ) {\n\n\t\t\t\treturn RGBMToLinear( value, 7.0 );\n\n\t\t\t} else if ( inputEncoding == 4 ) {\n\n\t\t\t\treturn RGBMToLinear( value, 16.0 );\n\n\t\t\t} else if ( inputEncoding == 5 ) {\n\n\t\t\t\treturn RGBDToLinear( value, 256.0 );\n\n\t\t\t} else {\n\n\t\t\t\treturn GammaToLinear( value, 2.2 );\n\n\t\t\t}\n\n\t\t}\n\n\t\tvec4 linearToOutputTexel( vec4 value ) {\n\n\t\t\tif ( outputEncoding == 0 ) {\n\n\t\t\t\treturn value;\n\n\t\t\t} else if ( outputEncoding == 1 ) {\n\n\t\t\t\treturn LinearTosRGB( value );\n\n\t\t\t} else if ( outputEncoding == 2 ) {\n\n\t\t\t\treturn LinearToRGBE( value );\n\n\t\t\t} else if ( outputEncoding == 3 ) {\n\n\t\t\t\treturn LinearToRGBM( value, 7.0 );\n\n\t\t\t} else if ( outputEncoding == 4 ) {\n\n\t\t\t\treturn LinearToRGBM( value, 16.0 );\n\n\t\t\t} else if ( outputEncoding == 5 ) {\n\n\t\t\t\treturn LinearToRGBD( value, 256.0 );\n\n\t\t\t} else {\n\n\t\t\t\treturn LinearToGamma( value, 2.2 );\n\n\t\t\t}\n\n\t\t}\n\n\t\tvec4 envMapTexelToLinear( vec4 color ) {\n\n\t\t\treturn inputTexelToLinear( color );\n\n\t\t}\n\t"}function H(e){var n=new WeakMap,o=null;function t(t){if(t&&t.isTexture&&!1===t.isRenderTargetTexture){var i=t.mapping,s=i===Ei||i===wi,l=i===Mi||i===Ti;if(s||l){if(n.has(t)){return n.get(t).texture}else{var d=t.image;if(s&&d&&0<d.height||l&&d&&a(d)){var c=e.getRenderTarget();if(null===o)o=new nc(e);var u=s?o.fromEquirectangular(t):o.fromCubemap(t);n.set(t,u);e.setRenderTarget(c);t.addEventListener("dispose",r);return u.texture}else{return null}}}}return t}function a(e){for(var t=0,a=6,r=0;r<a;r++){if(e[r]!==void 0)t++}return t===a}function r(e){var t=e.target;t.removeEventListener("dispose",r);var a=n.get(t);if(a!==void 0){n.delete(t);a.dispose()}}function i(){n=new WeakMap;if(null!==o){o.dispose();o=null}}return{get:t,dispose:i}}function V(e){var a={};function t(t){if(a[t]!==void 0){return a[t]}var r;switch(t){case"WEBGL_depth_texture":r=e.getExtension("WEBGL_depth_texture")||e.getExtension("MOZ_WEBGL_depth_texture")||e.getExtension("WEBKIT_WEBGL_depth_texture");break;case"EXT_texture_filter_anisotropic":r=e.getExtension("EXT_texture_filter_anisotropic")||e.getExtension("MOZ_EXT_texture_filter_anisotropic")||e.getExtension("WEBKIT_EXT_texture_filter_anisotropic");break;case"WEBGL_compressed_texture_s3tc":r=e.getExtension("WEBGL_compressed_texture_s3tc")||e.getExtension("MOZ_WEBGL_compressed_texture_s3tc")||e.getExtension("WEBKIT_WEBGL_compressed_texture_s3tc");break;case"WEBGL_compressed_texture_pvrtc":r=e.getExtension("WEBGL_compressed_texture_pvrtc")||e.getExtension("WEBKIT_WEBGL_compressed_texture_pvrtc");break;default:r=e.getExtension(t);}a[t]=r;return r}return{has:function has(e){return null!==t(e)},init:function init(e){if(e.isWebGL2){t("EXT_color_buffer_float")}else{t("WEBGL_depth_texture");t("OES_texture_float");t("OES_texture_half_float");t("OES_texture_half_float_linear");t("OES_standard_derivatives");t("OES_element_index_uint");t("OES_vertex_array_object");t("ANGLE_instanced_arrays")}t("OES_texture_float_linear");t("EXT_color_buffer_half_float");t("WEBGL_multisampled_render_to_texture")},get:function get(e){var a=t(e);if(null===a){console.warn("THREE.WebGLRenderer: "+e+" extension not supported.")}return a}}}function W(e,t,a,r){var o={},s=new WeakMap;function i(e){var n=e.target;if(null!==n.index){t.remove(n.index)}for(var d in n.attributes){t.remove(n.attributes[d])}n.removeEventListener("dispose",i);delete o[n.id];var l=s.get(n);if(l){t.remove(l);s.delete(n)}r.releaseStatesOfGeometry(n);if(!0===n.isInstancedBufferGeometry){delete n._maxInstanceCount}a.memory.geometries--}function n(e){var r=[],i=e.index,n=e.attributes.position,o=0;if(null!==i){var y=i.array;o=i.version;for(var v=0,_=y.length;v<_;v+=3){var d=y[v+0],a=y[v+1],p=y[v+2];r.push(d,a,a,p,p,d)}}else{var l=n.array;o=n.version;for(var x=0,b=l.length/3-1;x<b;x+=3){var c=x+0,m=x+1,g=x+2;r.push(c,m,m,g,g,c)}}var f=new(65535<u(r)?ql:Wl)(r,1);f.version=o;var h=s.get(e);if(h)t.remove(h);s.set(e,f)}return{get:function(e,t){if(!0===o[t.id])return t;t.addEventListener("dispose",i);o[t.id]=!0;a.memory.geometries++;return t},update:function(e){var a=e.attributes;for(var s in a){t.update(a[s],34962)}var r=e.morphAttributes;for(var l in r){for(var i=r[l],n=0,o=i.length;n<o;n++){t.update(i[n],34962)}}},getWireframeAttribute:function(e){var t=s.get(e);if(t){var a=e.index;if(null!==a){if(t.version<a.version){n(e)}}}else{n(e)}return s.get(e)}}}function j(e,t,a,r){var o=r.isWebGL2,s;var l,d;function i(t,r){e.drawElements(s,r,l,t*d);a.update(r,s,1)}function n(r,i,n){if(0===n)return;var c,u;if(o){c=e;u="drawElementsInstanced"}else{c=t.get("ANGLE_instanced_arrays");u="drawElementsInstancedANGLE";if(null===c){console.error("THREE.WebGLIndexedBufferRenderer: using THREE.InstancedBufferGeometry but hardware does not support extension ANGLE_instanced_arrays.");return}}c[u](s,i,l,r*d,n);a.update(i,s,n)}this.setMode=function(e){s=e};this.setIndex=function(e){l=e.type;d=e.bytesPerElement};this.render=i;this.renderInstances=n}function q(){var e={frame:0,calls:0,triangles:0,points:0,lines:0};return{memory:{geometries:0,textures:0},render:e,programs:null,autoReset:!0,reset:function(){e.frame++;e.calls=0;e.triangles=0;e.points=0;e.lines=0},update:function(t,a,r){e.calls++;switch(a){case 4:e.triangles+=r*(t/3);break;case 1:e.lines+=r*(t/2);break;case 3:e.lines+=r*(t-1);break;case 2:e.lines+=r*t;break;case 0:e.points+=r*t;break;default:console.error("THREE.WebGLInfo: Unknown draw mode:",a);break;}}}}var oc=function(e){_inherits(t,e);var a=_createSuper(t);function t(){var e,r=0<arguments.length&&arguments[0]!==void 0?arguments[0]:null,i=1<arguments.length&&arguments[1]!==void 0?arguments[1]:1,n=2<arguments.length&&arguments[2]!==void 0?arguments[2]:1,o=3<arguments.length&&arguments[3]!==void 0?arguments[3]:1;_classCallCheck2(this,t);e=a.call(this,null);e.image={data:r,width:i,height:n,depth:o};e.magFilter=Pi;e.minFilter=Pi;e.wrapR=Ri;e.generateMipmaps=!1;e.flipY=!1;e.unpackAlignment=1;e.needsUpdate=!0;return e}return t}(ps);oc.prototype.isDataTexture2DArray=!0;function X(e,t){return e[0]-t[0]}function Y(e,t){return Math.abs(t[1])-Math.abs(e[1])}function Z(e,t){var a=1,r=t.isInterleavedBufferAttribute?t.data.array:t.array;if(r instanceof Int8Array)a=127;else if(r instanceof Int16Array)a=32767;else if(r instanceof Int32Array)a=2147483647;else console.error("THREE.WebGLMorphtargets: Unsupported morph attribute data type: ",r);e.divideScalar(a)}function J(e,t,a){for(var r={},i=new Float32Array(8),n=new WeakMap,o=new vs,s=[],l=0;8>l;l++){s[l]=[l,0]}return{update:function(l,d,c,u){var p=l.morphTargetInfluences;if(!0===t.isWebGL2){var m=d.morphAttributes.position.length,g=n.get(d);if(g===void 0||g.count!==m){if(g!==void 0)g.texture.dispose();var f=d.morphAttributes.normal!==void 0,h=d.morphAttributes.position,y=d.morphAttributes.normal||[],v=d.attributes.position.count,_=!0===f?2:1,x=v*_,b=1;if(x>t.maxTextureSize){b=Math.ceil(x/t.maxTextureSize);x=t.maxTextureSize}var S=new Float32Array(4*(x*b)*m),M=new oc(S,x,b,m);M.format=an;M.type=Yi;for(var T=0;T<m;T++){for(var E=h[T],w=y[T],A=4*(x*b)*T,k=0;k<E.count;k++){o.fromBufferAttribute(E,k);if(!0===E.normalized)Z(o,E);var U=k*(4*_);S[A+U+0]=o.x;S[A+U+1]=o.y;S[A+U+2]=o.z;S[A+U+3]=0;if(!0===f){o.fromBufferAttribute(w,k);if(!0===w.normalized)Z(o,w);S[A+U+4]=o.x;S[A+U+5]=o.y;S[A+U+6]=o.z;S[A+U+7]=0}}}g={count:m,texture:M,size:new os(x,b)};n.set(d,g)}for(var C=0,R=0;R<p.length;R++){C+=p[R]}var G=d.morphTargetsRelative?1:1-C;u.getUniforms().setValue(e,"morphTargetBaseInfluence",G);u.getUniforms().setValue(e,"morphTargetInfluences",p);u.getUniforms().setValue(e,"morphTargetsTexture",g.texture,a);u.getUniforms().setValue(e,"morphTargetsTextureSize",g.size)}else{var L=p===void 0?0:p.length,P=r[d.id];if(P===void 0||P.length!==L){P=[];for(var H=0;H<L;H++){P[H]=[H,0]}r[d.id]=P}for(var V=0,W;V<L;V++){W=P[V];W[0]=V;W[1]=p[V]}P.sort(Y);for(var q=0;8>q;q++){if(q<L&&P[q][1]){s[q][0]=P[q][0];s[q][1]=P[q][1]}else{s[q][0]=Number.MAX_SAFE_INTEGER;s[q][1]=0}}s.sort(X);for(var I=d.morphAttributes.position,D=d.morphAttributes.normal,z=0,N=0;8>N;N++){var F=s[N],O=F[0],B=F[1];if(O!==Number.MAX_SAFE_INTEGER&&B){if(I&&d.getAttribute("morphTarget"+N)!==I[O]){d.setAttribute("morphTarget"+N,I[O])}if(D&&d.getAttribute("morphNormal"+N)!==D[O]){d.setAttribute("morphNormal"+N,D[O])}i[N]=B;z+=B}else{if(I&&!0===d.hasAttribute("morphTarget"+N)){d.deleteAttribute("morphTarget"+N)}if(D&&!0===d.hasAttribute("morphNormal"+N)){d.deleteAttribute("morphNormal"+N)}i[N]=0}}var J=d.morphTargetsRelative?1:1-z;u.getUniforms().setValue(e,"morphTargetBaseInfluence",J);u.getUniforms().setValue(e,"morphTargetInfluences",i)}}}}function Q(e,t,a,r){var o=new WeakMap;function i(e){var i=r.render.frame,s=e.geometry,l=t.get(e,s);if(o.get(l)!==i){t.update(l);o.set(l,i)}if(e.isInstancedMesh){if(!1===e.hasEventListener("dispose",n)){e.addEventListener("dispose",n)}a.update(e.instanceMatrix,34962);if(null!==e.instanceColor){a.update(e.instanceColor,34962)}}return l}function n(e){var t=e.target;t.removeEventListener("dispose",n);a.remove(t.instanceMatrix);if(null!==t.instanceColor)a.remove(t.instanceColor)}return{update:i,dispose:function(){o=new WeakMap}}}var sc=function(e){_inherits(t,e);var a=_createSuper(t);function t(){var e,r=0<arguments.length&&arguments[0]!==void 0?arguments[0]:null,i=1<arguments.length&&arguments[1]!==void 0?arguments[1]:1,n=2<arguments.length&&arguments[2]!==void 0?arguments[2]:1,o=3<arguments.length&&arguments[3]!==void 0?arguments[3]:1;_classCallCheck2(this,t);e=a.call(this,null);e.image={data:r,width:i,height:n,depth:o};e.magFilter=Pi;e.minFilter=Pi;e.wrapR=Ri;e.generateMipmaps=!1;e.flipY=!1;e.unpackAlignment=1;e.needsUpdate=!0;return e}return t}(ps);sc.prototype.isDataTexture3D=!0;var lc=new ps,dc=new oc,cc=new sc,uc=new kd,pc=[],mc=[],gc=new Float32Array(16),fc=new Float32Array(9),hc=new Float32Array(4);function K(e,t,a){var i=e[0];if(0>=i||0<i)return e;var o=t*a,n=pc[o];if(n===void 0){n=new Float32Array(o);pc[o]=n}if(0!==t){i.toArray(n,0);for(var s=1,l=0;s!==t;++s){l+=a;e[s].toArray(n,l)}}return n}function $(e,t){if(e.length!==t.length)return!1;for(var a=0,r=e.length;a<r;a++){if(e[a]!==t[a])return!1}return!0}function ee(e,t){for(var a=0,r=t.length;a<r;a++){e[a]=t[a]}}function te(e,t){var a=mc[t];if(a===void 0){a=new Int32Array(t);mc[t]=a}for(var i=0;i!==t;++i){a[i]=e.allocateTextureUnit()}return a}function ae(e,t){var a=this.cache;if(a[0]===t)return;e.uniform1f(this.addr,t);a[0]=t}function re(e,t){var a=this.cache;if(t.x!==void 0){if(a[0]!==t.x||a[1]!==t.y){e.uniform2f(this.addr,t.x,t.y);a[0]=t.x;a[1]=t.y}}else{if($(a,t))return;e.uniform2fv(this.addr,t);ee(a,t)}}function ie(e,t){var a=this.cache;if(t.x!==void 0){if(a[0]!==t.x||a[1]!==t.y||a[2]!==t.z){e.uniform3f(this.addr,t.x,t.y,t.z);a[0]=t.x;a[1]=t.y;a[2]=t.z}}else if(t.r!==void 0){if(a[0]!==t.r||a[1]!==t.g||a[2]!==t.b){e.uniform3f(this.addr,t.r,t.g,t.b);a[0]=t.r;a[1]=t.g;a[2]=t.b}}else{if($(a,t))return;e.uniform3fv(this.addr,t);ee(a,t)}}function ne(e,t){var a=this.cache;if(t.x!==void 0){if(a[0]!==t.x||a[1]!==t.y||a[2]!==t.z||a[3]!==t.w){e.uniform4f(this.addr,t.x,t.y,t.z,t.w);a[0]=t.x;a[1]=t.y;a[2]=t.z;a[3]=t.w}}else{if($(a,t))return;e.uniform4fv(this.addr,t);ee(a,t)}}function oe(e,t){var a=this.cache,r=t.elements;if(r===void 0){if($(a,t))return;e.uniformMatrix2fv(this.addr,!1,t);ee(a,t)}else{if($(a,r))return;hc.set(r);e.uniformMatrix2fv(this.addr,!1,hc);ee(a,r)}}function se(e,t){var a=this.cache,r=t.elements;if(r===void 0){if($(a,t))return;e.uniformMatrix3fv(this.addr,!1,t);ee(a,t)}else{if($(a,r))return;fc.set(r);e.uniformMatrix3fv(this.addr,!1,fc);ee(a,r)}}function le(e,t){var a=this.cache,r=t.elements;if(r===void 0){if($(a,t))return;e.uniformMatrix4fv(this.addr,!1,t);ee(a,t)}else{if($(a,r))return;gc.set(r);e.uniformMatrix4fv(this.addr,!1,gc);ee(a,r)}}function de(e,t){var a=this.cache;if(a[0]===t)return;e.uniform1i(this.addr,t);a[0]=t}function ce(e,t){var a=this.cache;if($(a,t))return;e.uniform2iv(this.addr,t);ee(a,t)}function ue(e,t){var a=this.cache;if($(a,t))return;e.uniform3iv(this.addr,t);ee(a,t)}function pe(e,t){var a=this.cache;if($(a,t))return;e.uniform4iv(this.addr,t);ee(a,t)}function me(e,t){var a=this.cache;if(a[0]===t)return;e.uniform1ui(this.addr,t);a[0]=t}function ge(e,t){var a=this.cache;if($(a,t))return;e.uniform2uiv(this.addr,t);ee(a,t)}function fe(e,t){var a=this.cache;if($(a,t))return;e.uniform3uiv(this.addr,t);ee(a,t)}function he(e,t){var a=this.cache;if($(a,t))return;e.uniform4uiv(this.addr,t);ee(a,t)}function ye(e,t,a){var r=this.cache,i=a.allocateTextureUnit();if(r[0]!==i){e.uniform1i(this.addr,i);r[0]=i}a.safeSetTexture2D(t||lc,i)}function ve(e,t,a){var r=this.cache,i=a.allocateTextureUnit();if(r[0]!==i){e.uniform1i(this.addr,i);r[0]=i}a.setTexture3D(t||cc,i)}function _e(e,t,a){var r=this.cache,i=a.allocateTextureUnit();if(r[0]!==i){e.uniform1i(this.addr,i);r[0]=i}a.safeSetTextureCube(t||uc,i)}function xe(e,t,a){var r=this.cache,i=a.allocateTextureUnit();if(r[0]!==i){e.uniform1i(this.addr,i);r[0]=i}a.setTexture2DArray(t||dc,i)}function be(e){switch(e){case 5126:return ae;case 35664:return re;case 35665:return ie;case 35666:return ne;case 35674:return oe;case 35675:return se;case 35676:return le;case 5124:case 35670:return de;case 35667:case 35671:return ce;case 35668:case 35672:return ue;case 35669:case 35673:return pe;case 5125:return me;case 36294:return ge;case 36295:return fe;case 36296:return he;case 35678:case 36198:case 36298:case 36306:case 35682:return ye;case 35679:case 36299:case 36307:return ve;case 35680:case 36300:case 36308:case 36293:return _e;case 36289:case 36303:case 36311:case 36292:return xe;}}function Se(e,t){e.uniform1fv(this.addr,t)}function Me(e,t){var a=K(t,this.size,2);e.uniform2fv(this.addr,a)}function Te(e,t){var a=K(t,this.size,3);e.uniform3fv(this.addr,a)}function Ee(e,t){var a=K(t,this.size,4);e.uniform4fv(this.addr,a)}function we(e,t){var a=K(t,this.size,4);e.uniformMatrix2fv(this.addr,!1,a)}function Ae(e,t){var a=K(t,this.size,9);e.uniformMatrix3fv(this.addr,!1,a)}function ke(e,t){var a=K(t,this.size,16);e.uniformMatrix4fv(this.addr,!1,a)}function Ce(e,t){e.uniform1iv(this.addr,t)}function Re(e,t){e.uniform2iv(this.addr,t)}function Le(e,t){e.uniform3iv(this.addr,t)}function Pe(e,t){e.uniform4iv(this.addr,t)}function Ie(e,t){e.uniform1uiv(this.addr,t)}function De(e,t){e.uniform2uiv(this.addr,t)}function ze(e,t){e.uniform3uiv(this.addr,t)}function Ne(e,t){e.uniform4uiv(this.addr,t)}function Fe(e,t,a){var r=t.length,i=te(a,r);e.uniform1iv(this.addr,i);for(var n=0;n!==r;++n){a.safeSetTexture2D(t[n]||lc,i[n])}}function Oe(e,t,a){var r=t.length,i=te(a,r);e.uniform1iv(this.addr,i);for(var n=0;n!==r;++n){a.setTexture3D(t[n]||cc,i[n])}}function Be(e,t,a){var r=t.length,i=te(a,r);e.uniform1iv(this.addr,i);for(var n=0;n!==r;++n){a.safeSetTextureCube(t[n]||uc,i[n])}}function Ue(e,t,a){var r=t.length,i=te(a,r);e.uniform1iv(this.addr,i);for(var n=0;n!==r;++n){a.setTexture2DArray(t[n]||dc,i[n])}}function Ge(e){switch(e){case 5126:return Se;case 35664:return Me;case 35665:return Te;case 35666:return Ee;case 35674:return we;case 35675:return Ae;case 35676:return ke;case 5124:case 35670:return Ce;case 35667:case 35671:return Re;case 35668:case 35672:return Le;case 35669:case 35673:return Pe;case 5125:return Ie;case 36294:return De;case 36295:return ze;case 36296:return Ne;case 35678:case 36198:case 36298:case 36306:case 35682:return Fe;case 35679:case 36299:case 36307:return Oe;case 35680:case 36300:case 36308:case 36293:return Be;case 36289:case 36303:case 36311:case 36292:return Ue;}}function He(e,t,a){this.id=e;this.addr=a;this.cache=[];this.setValue=be(t.type)}function Ve(e,t,a){this.id=e;this.addr=a;this.cache=[];this.size=t.size;this.setValue=Ge(t.type)}Ve.prototype.updateCache=function(e){var t=this.cache;if(e instanceof Float32Array&&t.length!==e.length){this.cache=new Float32Array(e.length)}ee(t,e)};function We(e){this.id=e;this.seq=[];this.map={}}We.prototype.setValue=function(e,t,a){for(var r=this.seq,i=0,o=r.length,n;i!==o;++i){n=r[i];n.setValue(e,t[n.id],a)}};var yc=/(\w+)(\])?(\[|\.)?/g;function je(e,t){e.seq.push(t);e.map[t.id]=t}function qe(e,t,a){var r=e.name,i=r.length;yc.lastIndex=0;while(!0){var n=yc.exec(r),o=yc.lastIndex,s=n[1],l="]"===n[2],d=n[3];if(l)s=0|s;if(d===void 0||"["===d&&o+2===i){je(a,d===void 0?new He(s,e,t):new Ve(s,e,t));break}else{var c=a.map,u=c[s];if(u===void 0){u=new We(s);je(a,u)}a=u}}}function Xe(e,t){this.seq=[];this.map={};for(var a=e.getProgramParameter(t,35718),r=0;r<a;++r){var i=e.getActiveUniform(t,r),n=e.getUniformLocation(t,i.name);qe(i,n,this)}}Xe.prototype.setValue=function(e,t,a,r){var i=this.map[t];if(i!==void 0)i.setValue(e,a,r)};Xe.prototype.setOptional=function(e,t,a){var r=t[a];if(r!==void 0)this.setValue(e,a,r)};Xe.upload=function(e,t,a,r){for(var i=0,o=t.length;i!==o;++i){var n=t[i],s=a[n.id];if(!1!==s.needsUpdate){n.setValue(e,s.value,r)}}};Xe.seqWithValue=function(e,t){for(var a=[],r=0,i=e.length,n;r!==i;++r){n=e[r];if(n.id in t)a.push(n)}return a};function Ye(e,t,a){var r=e.createShader(t);e.shaderSource(r,a);e.compileShader(r);return r}var vc=0;function Ze(e){for(var t=e.split("\n"),a=0;a<t.length;a++){t[a]=a+1+": "+t[a]}return t.join("\n")}function Je(e){switch(e){case ho:return["Linear","( value )"];case yo:return["sRGB","( value )"];case _o:return["RGBE","( value )"];case xo:return["RGBM","( value, 7.0 )"];case bo:return["RGBM","( value, 16.0 )"];case So:return["RGBD","( value, 256.0 )"];case vo:return["Gamma","( value, float( GAMMA_FACTOR ) )"];default:console.warn("THREE.WebGLProgram: Unsupported encoding:",e);return["Linear","( value )"];}}function Qe(e,t,a){var r=e.getShaderParameter(t,35713),i=e.getShaderInfoLog(t).trim();if(r&&""===i)return"";return a.toUpperCase()+"\n\n"+i+"\n\n"+Ze(e.getShaderSource(t))}function Ke(e,t){var a=Je(t);return"vec4 "+e+"( vec4 value ) { return "+a[0]+"ToLinear"+a[1]+"; }"}function $e(e,t){var a=Je(t);return"vec4 "+e+"( vec4 value ) { return LinearTo"+a[0]+a[1]+"; }"}function et(e,t){var a;switch(t){case yi:a="Linear";break;case vi:a="Reinhard";break;case _i:a="OptimizedCineon";break;case xi:a="ACESFilmic";break;case bi:a="Custom";break;default:console.warn("THREE.WebGLProgram: Unsupported toneMapping:",t);a="Linear";}return"vec3 "+e+"( vec3 color ) { return "+a+"ToneMapping( color ); }"}function tt(e){var t=[e.extensionDerivatives||e.envMapCubeUV||e.bumpMap||e.tangentSpaceNormalMap||e.clearcoatNormalMap||e.flatShading||"physical"===e.shaderID?"#extension GL_OES_standard_derivatives : enable":"",(e.extensionFragDepth||e.logarithmicDepthBuffer)&&e.rendererExtensionFragDepth?"#extension GL_EXT_frag_depth : enable":"",e.extensionDrawBuffers&&e.rendererExtensionDrawBuffers?"#extension GL_EXT_draw_buffers : require":"",(e.extensionShaderTextureLOD||e.envMap||e.transmission)&&e.rendererExtensionShaderTextureLod?"#extension GL_EXT_shader_texture_lod : enable":""];return t.filter(it).join("\n")}function at(e){var t=[];for(var a in e){var r=e[a];if(!1===r)continue;t.push("#define "+a+" "+r)}return t.join("\n")}function rt(e,t){for(var a={},r=e.getProgramParameter(t,35721),i=0;i<r;i++){var n=e.getActiveAttrib(t,i),o=n.name,s=1;if(35674===n.type)s=2;if(35675===n.type)s=3;if(35676===n.type)s=4;a[o]={type:n.type,location:e.getAttribLocation(t,o),locationSize:s}}return a}function it(e){return""!==e}function nt(e,t){return e.replace(/NUM_DIR_LIGHTS/g,t.numDirLights).replace(/NUM_SPOT_LIGHTS/g,t.numSpotLights).replace(/NUM_RECT_AREA_LIGHTS/g,t.numRectAreaLights).replace(/NUM_POINT_LIGHTS/g,t.numPointLights).replace(/NUM_HEMI_LIGHTS/g,t.numHemiLights).replace(/NUM_DIR_LIGHT_SHADOWS/g,t.numDirLightShadows).replace(/NUM_SPOT_LIGHT_SHADOWS/g,t.numSpotLightShadows).replace(/NUM_POINT_LIGHT_SHADOWS/g,t.numPointLightShadows)}function ot(e,t){return e.replace(/NUM_CLIPPING_PLANES/g,t.numClippingPlanes).replace(/UNION_CLIPPING_PLANES/g,t.numClippingPlanes-t.numClipIntersection)}function st(e){return e.replace(/^[ \t]*#include +<([\w\d./]+)>/gm,lt)}function lt(e,t){var a=Od[t];if(a===void 0){throw new Error("Can not resolve #include <"+t+">")}return st(a)}function dt(e){return e.replace(/#pragma unroll_loop_start\s+for\s*\(\s*int\s+i\s*=\s*(\d+)\s*;\s*i\s*<\s*(\d+)\s*;\s*i\s*\+\+\s*\)\s*{([\s\S]+?)}\s+#pragma unroll_loop_end/g,ut).replace(/#pragma unroll_loop[\s]+?for \( int i \= (\d+)\; i < (\d+)\; i \+\+ \) \{([\s\S]+?)(?=\})\}/g,ct)}function ct(e,t,a,r){console.warn("WebGLProgram: #pragma unroll_loop shader syntax is deprecated. Please use #pragma unroll_loop_start syntax instead.");return ut(e,t,a,r)}function ut(e,t,a,r){for(var i="",n=parseInt(t);n<parseInt(a);n++){i+=r.replace(/\[\s*i\s*\]/g,"[ "+n+" ]").replace(/UNROLLED_LOOP_INDEX/g,n)}return i}function pt(e){var t="precision "+e.precision+" float;\nprecision "+e.precision+" int;";if("highp"===e.precision){t+="\n#define HIGH_PRECISION"}else if("mediump"===e.precision){t+="\n#define MEDIUM_PRECISION"}else if("lowp"===e.precision){t+="\n#define LOW_PRECISION"}return t}function mt(e){var t="SHADOWMAP_TYPE_BASIC";if(e.shadowMapType===Cr){t="SHADOWMAP_TYPE_PCF"}else if(e.shadowMapType===Rr){t="SHADOWMAP_TYPE_PCF_SOFT"}else if(e.shadowMapType===Lr){t="SHADOWMAP_TYPE_VSM"}return t}function gt(e){var t="ENVMAP_TYPE_CUBE";if(e.envMap){switch(e.envMapMode){case Mi:case Ti:t="ENVMAP_TYPE_CUBE";break;case Ai:case ki:t="ENVMAP_TYPE_CUBE_UV";break;}}return t}function ft(e){var t="ENVMAP_MODE_REFLECTION";if(e.envMap){switch(e.envMapMode){case Ti:case ki:t="ENVMAP_MODE_REFRACTION";break;}}return t}function ht(e){var t="ENVMAP_BLENDING_NONE";if(e.envMap){switch(e.combine){case mi:t="ENVMAP_BLENDING_MULTIPLY";break;case gi:t="ENVMAP_BLENDING_MIX";break;case fi:t="ENVMAP_BLENDING_ADD";break;}}return t}function yt(e,t,a,r){var i=e.getContext(),n=a.defines,o=a.vertexShader,s=a.fragmentShader,l=mt(a),d=gt(a),c=ft(a),u=ht(a),p=0<e.gammaFactor?e.gammaFactor:1,m=a.isWebGL2?"":tt(a),g=at(n),f=i.createProgram(),h,y,v=a.glslVersion?"#version "+a.glslVersion+"\n":"";if(a.isRawShaderMaterial){h=[g].filter(it).join("\n");if(0<h.length){h+="\n"}y=[m,g].filter(it).join("\n");if(0<y.length){y+="\n"}}else{h=[pt(a),"#define SHADER_NAME "+a.shaderName,g,a.instancing?"#define USE_INSTANCING":"",a.instancingColor?"#define USE_INSTANCING_COLOR":"",a.supportsVertexTextures?"#define VERTEX_TEXTURES":"","#define GAMMA_FACTOR "+p,"#define MAX_BONES "+a.maxBones,a.useFog&&a.fog?"#define USE_FOG":"",a.useFog&&a.fogExp2?"#define FOG_EXP2":"",a.map?"#define USE_MAP":"",a.envMap?"#define USE_ENVMAP":"",a.envMap?"#define "+c:"",a.lightMap?"#define USE_LIGHTMAP":"",a.aoMap?"#define USE_AOMAP":"",a.emissiveMap?"#define USE_EMISSIVEMAP":"",a.bumpMap?"#define USE_BUMPMAP":"",a.normalMap?"#define USE_NORMALMAP":"",a.normalMap&&a.objectSpaceNormalMap?"#define OBJECTSPACE_NORMALMAP":"",a.normalMap&&a.tangentSpaceNormalMap?"#define TANGENTSPACE_NORMALMAP":"",a.clearcoatMap?"#define USE_CLEARCOATMAP":"",a.clearcoatRoughnessMap?"#define USE_CLEARCOAT_ROUGHNESSMAP":"",a.clearcoatNormalMap?"#define USE_CLEARCOAT_NORMALMAP":"",a.displacementMap&&a.supportsVertexTextures?"#define USE_DISPLACEMENTMAP":"",a.specularMap?"#define USE_SPECULARMAP":"",a.specularIntensityMap?"#define USE_SPECULARINTENSITYMAP":"",a.specularColorMap?"#define USE_SPECULARCOLORMAP":"",a.roughnessMap?"#define USE_ROUGHNESSMAP":"",a.metalnessMap?"#define USE_METALNESSMAP":"",a.alphaMap?"#define USE_ALPHAMAP":"",a.transmission?"#define USE_TRANSMISSION":"",a.transmissionMap?"#define USE_TRANSMISSIONMAP":"",a.thicknessMap?"#define USE_THICKNESSMAP":"",a.sheenColorMap?"#define USE_SHEENCOLORMAP":"",a.sheenRoughnessMap?"#define USE_SHEENROUGHNESSMAP":"",a.vertexTangents?"#define USE_TANGENT":"",a.vertexColors?"#define USE_COLOR":"",a.vertexAlphas?"#define USE_COLOR_ALPHA":"",a.vertexUvs?"#define USE_UV":"",a.uvsVertexOnly?"#define UVS_VERTEX_ONLY":"",a.flatShading?"#define FLAT_SHADED":"",a.skinning?"#define USE_SKINNING":"",a.useVertexTexture?"#define BONE_TEXTURE":"",a.morphTargets?"#define USE_MORPHTARGETS":"",a.morphNormals&&!1===a.flatShading?"#define USE_MORPHNORMALS":"",a.morphTargets&&a.isWebGL2?"#define MORPHTARGETS_TEXTURE":"",a.morphTargets&&a.isWebGL2?"#define MORPHTARGETS_COUNT "+a.morphTargetsCount:"",a.doubleSided?"#define DOUBLE_SIDED":"",a.flipSided?"#define FLIP_SIDED":"",a.shadowMapEnabled?"#define USE_SHADOWMAP":"",a.shadowMapEnabled?"#define "+l:"",a.sizeAttenuation?"#define USE_SIZEATTENUATION":"",a.logarithmicDepthBuffer?"#define USE_LOGDEPTHBUF":"",a.logarithmicDepthBuffer&&a.rendererExtensionFragDepth?"#define USE_LOGDEPTHBUF_EXT":"","uniform mat4 modelMatrix;","uniform mat4 modelViewMatrix;","uniform mat4 projectionMatrix;","uniform mat4 viewMatrix;","uniform mat3 normalMatrix;","uniform vec3 cameraPosition;","uniform bool isOrthographic;","#ifdef USE_INSTANCING","\tattribute mat4 instanceMatrix;","#endif","#ifdef USE_INSTANCING_COLOR","\tattribute vec3 instanceColor;","#endif","attribute vec3 position;","attribute vec3 normal;","attribute vec2 uv;","#ifdef USE_TANGENT","\tattribute vec4 tangent;","#endif","#if defined( USE_COLOR_ALPHA )","\tattribute vec4 color;","#elif defined( USE_COLOR )","\tattribute vec3 color;","#endif","#if ( defined( USE_MORPHTARGETS ) && ! defined( MORPHTARGETS_TEXTURE ) )","\tattribute vec3 morphTarget0;","\tattribute vec3 morphTarget1;","\tattribute vec3 morphTarget2;","\tattribute vec3 morphTarget3;","\t#ifdef USE_MORPHNORMALS","\t\tattribute vec3 morphNormal0;","\t\tattribute vec3 morphNormal1;","\t\tattribute vec3 morphNormal2;","\t\tattribute vec3 morphNormal3;","\t#else","\t\tattribute vec3 morphTarget4;","\t\tattribute vec3 morphTarget5;","\t\tattribute vec3 morphTarget6;","\t\tattribute vec3 morphTarget7;","\t#endif","#endif","#ifdef USE_SKINNING","\tattribute vec4 skinIndex;","\tattribute vec4 skinWeight;","#endif","\n"].filter(it).join("\n");y=[m,pt(a),"#define SHADER_NAME "+a.shaderName,g,"#define GAMMA_FACTOR "+p,a.useFog&&a.fog?"#define USE_FOG":"",a.useFog&&a.fogExp2?"#define FOG_EXP2":"",a.map?"#define USE_MAP":"",a.matcap?"#define USE_MATCAP":"",a.envMap?"#define USE_ENVMAP":"",a.envMap?"#define "+d:"",a.envMap?"#define "+c:"",a.envMap?"#define "+u:"",a.lightMap?"#define USE_LIGHTMAP":"",a.aoMap?"#define USE_AOMAP":"",a.emissiveMap?"#define USE_EMISSIVEMAP":"",a.bumpMap?"#define USE_BUMPMAP":"",a.normalMap?"#define USE_NORMALMAP":"",a.normalMap&&a.objectSpaceNormalMap?"#define OBJECTSPACE_NORMALMAP":"",a.normalMap&&a.tangentSpaceNormalMap?"#define TANGENTSPACE_NORMALMAP":"",a.clearcoat?"#define USE_CLEARCOAT":"",a.clearcoatMap?"#define USE_CLEARCOATMAP":"",a.clearcoatRoughnessMap?"#define USE_CLEARCOAT_ROUGHNESSMAP":"",a.clearcoatNormalMap?"#define USE_CLEARCOAT_NORMALMAP":"",a.specularMap?"#define USE_SPECULARMAP":"",a.specularIntensityMap?"#define USE_SPECULARINTENSITYMAP":"",a.specularColorMap?"#define USE_SPECULARCOLORMAP":"",a.roughnessMap?"#define USE_ROUGHNESSMAP":"",a.metalnessMap?"#define USE_METALNESSMAP":"",a.alphaMap?"#define USE_ALPHAMAP":"",a.alphaTest?"#define USE_ALPHATEST":"",a.sheen?"#define USE_SHEEN":"",a.sheenColorMap?"#define USE_SHEENCOLORMAP":"",a.sheenRoughnessMap?"#define USE_SHEENROUGHNESSMAP":"",a.transmission?"#define USE_TRANSMISSION":"",a.transmissionMap?"#define USE_TRANSMISSIONMAP":"",a.thicknessMap?"#define USE_THICKNESSMAP":"",a.vertexTangents?"#define USE_TANGENT":"",a.vertexColors||a.instancingColor?"#define USE_COLOR":"",a.vertexAlphas?"#define USE_COLOR_ALPHA":"",a.vertexUvs?"#define USE_UV":"",a.uvsVertexOnly?"#define UVS_VERTEX_ONLY":"",a.gradientMap?"#define USE_GRADIENTMAP":"",a.flatShading?"#define FLAT_SHADED":"",a.doubleSided?"#define DOUBLE_SIDED":"",a.flipSided?"#define FLIP_SIDED":"",a.shadowMapEnabled?"#define USE_SHADOWMAP":"",a.shadowMapEnabled?"#define "+l:"",a.premultipliedAlpha?"#define PREMULTIPLIED_ALPHA":"",a.physicallyCorrectLights?"#define PHYSICALLY_CORRECT_LIGHTS":"",a.logarithmicDepthBuffer?"#define USE_LOGDEPTHBUF":"",a.logarithmicDepthBuffer&&a.rendererExtensionFragDepth?"#define USE_LOGDEPTHBUF_EXT":"",(a.extensionShaderTextureLOD||a.envMap)&&a.rendererExtensionShaderTextureLod?"#define TEXTURE_LOD_EXT":"","uniform mat4 viewMatrix;","uniform vec3 cameraPosition;","uniform bool isOrthographic;",a.toneMapping!==hi?"#define TONE_MAPPING":"",a.toneMapping!==hi?Od.tonemapping_pars_fragment:"",a.toneMapping!==hi?et("toneMapping",a.toneMapping):"",a.dithering?"#define DITHERING":"",a.format===tn?"#define OPAQUE":"",Od.encodings_pars_fragment,a.map?Ke("mapTexelToLinear",a.mapEncoding):"",a.matcap?Ke("matcapTexelToLinear",a.matcapEncoding):"",a.envMap?Ke("envMapTexelToLinear",a.envMapEncoding):"",a.emissiveMap?Ke("emissiveMapTexelToLinear",a.emissiveMapEncoding):"",a.specularColorMap?Ke("specularColorMapTexelToLinear",a.specularColorMapEncoding):"",a.sheenColorMap?Ke("sheenColorMapTexelToLinear",a.sheenColorMapEncoding):"",a.lightMap?Ke("lightMapTexelToLinear",a.lightMapEncoding):"",$e("linearToOutputTexel",a.outputEncoding),a.depthPacking?"#define DEPTH_PACKING "+a.depthPacking:"","\n"].filter(it).join("\n")}o=st(o);o=nt(o,a);o=ot(o,a);s=st(s);s=nt(s,a);s=ot(s,a);o=dt(o);s=dt(s);if(a.isWebGL2&&!0!==a.isRawShaderMaterial){v="#version 300 es\n";h="precision mediump sampler2DArray;\n#define attribute in\n#define varying out\n#define texture2D texture"+"\n"+h;y=["#define varying in",a.glslVersion===$o?"":"out highp vec4 pc_fragColor;",a.glslVersion===$o?"":"#define gl_FragColor pc_fragColor","#define gl_FragDepthEXT gl_FragDepth","#define texture2D texture","#define textureCube texture","#define texture2DProj textureProj","#define texture2DLodEXT textureLod","#define texture2DProjLodEXT textureProjLod","#define textureCubeLodEXT textureLod","#define texture2DGradEXT textureGrad","#define texture2DProjGradEXT textureProjGrad","#define textureCubeGradEXT textureGrad"].join("\n")+"\n"+y}var _=v+h+o,x=v+y+s,b=Ye(i,35633,_),S=Ye(i,35632,x);i.attachShader(f,b);i.attachShader(f,S);if(a.index0AttributeName!==void 0){i.bindAttribLocation(f,0,a.index0AttributeName)}else if(!0===a.morphTargets){i.bindAttribLocation(f,0,"position")}i.linkProgram(f);if(e.debug.checkShaderErrors){var M=i.getProgramInfoLog(f).trim(),T=i.getShaderInfoLog(b).trim(),E=i.getShaderInfoLog(S).trim(),w=!0,A=!0;if(!1===i.getProgramParameter(f,35714)){w=!1;var k=Qe(i,b,"vertex"),C=Qe(i,S,"fragment");console.error("THREE.WebGLProgram: Shader Error "+i.getError()+" - VALIDATE_STATUS "+i.getProgramParameter(f,35715)+"\n\nProgram Info Log: "+M+"\n"+k+"\n"+C)}else if(""!==M){console.warn("THREE.WebGLProgram: Program Info Log:",M)}else if(""===T||""===E){A=!1}if(A){this.diagnostics={runnable:w,programLog:M,vertexShader:{log:T,prefix:h},fragmentShader:{log:E,prefix:y}}}}i.deleteShader(b);i.deleteShader(S);var R;this.getUniforms=function(){if(R===void 0){R=new Xe(i,f)}return R};var L;this.getAttributes=function(){if(L===void 0){L=rt(i,f)}return L};this.destroy=function(){r.releaseStatesOfProgram(this);i.deleteProgram(f);this.program=void 0};this.name=a.shaderName;this.id=vc++;this.cacheKey=t;this.usedTimes=1;this.program=f;this.vertexShader=b;this.fragmentShader=S;return this}function vt(e,t,a,r,i,n,o){var c=[],u=i.isWebGL2,p=i.logarithmicDepthBuffer,m=i.floatVertexTextures,f=i.maxVertexUniforms,h=i.vertexTextures,y=i.precision,v={MeshDepthMaterial:"depth",MeshDistanceMaterial:"distanceRGBA",MeshNormalMaterial:"normal",MeshBasicMaterial:"basic",MeshLambertMaterial:"lambert",MeshPhongMaterial:"phong",MeshToonMaterial:"toon",MeshStandardMaterial:"physical",MeshPhysicalMaterial:"physical",MeshMatcapMaterial:"matcap",LineBasicMaterial:"basic",LineDashedMaterial:"dashed",PointsMaterial:"points",ShadowMaterial:"shadow",SpriteMaterial:"sprite"},_=["precision","isWebGL2","supportsVertexTextures","outputEncoding","instancing","instancingColor","map","mapEncoding","matcap","matcapEncoding","envMap","envMapMode","envMapEncoding","envMapCubeUV","lightMap","lightMapEncoding","aoMap","emissiveMap","emissiveMapEncoding","bumpMap","normalMap","objectSpaceNormalMap","tangentSpaceNormalMap","clearcoat","clearcoatMap","clearcoatRoughnessMap","clearcoatNormalMap","displacementMap","specularMap",,"roughnessMap","metalnessMap","gradientMap","alphaMap","alphaTest","combine","vertexColors","vertexAlphas","vertexTangents","vertexUvs","uvsVertexOnly","fog","useFog","fogExp2","flatShading","sizeAttenuation","logarithmicDepthBuffer","skinning","maxBones","useVertexTexture","morphTargets","morphNormals","morphTargetsCount","premultipliedAlpha","numDirLights","numPointLights","numSpotLights","numHemiLights","numRectAreaLights","numDirLightShadows","numPointLightShadows","numSpotLightShadows","shadowMapEnabled","shadowMapType","toneMapping","physicallyCorrectLights","doubleSided","flipSided","numClippingPlanes","numClipIntersection","depthPacking","dithering","format","specularIntensityMap","specularColorMap","specularColorMapEncoding","transmission","transmissionMap","thicknessMap","sheen","sheenColorMap","sheenColorMapEncoding","sheenRoughnessMap"];function s(e){var t=e.skeleton,a=t.bones;if(m){return 1024}else{var r=Math.floor((f-20)/4),i=Math.min(r,a.length);if(i<a.length){console.warn("THREE.WebGLRenderer: Skeleton has "+a.length+" bones. This GPU supports "+i+".");return 0}return i}}function l(e){var t;if(e&&e.isTexture){t=e.encoding}else if(e&&e.isWebGLRenderTarget){console.warn("THREE.WebGLPrograms.getTextureEncodingFromMap: don't use render targets as textures. Use their .texture property instead.");t=e.texture.encoding}else{t=ho}return t}function d(n,d,c,g,f){var _=g.fog,x=n.isMeshStandardMaterial?g.environment:null,b=(n.isMeshStandardMaterial?a:t).get(n.envMap||x),S=v[n.type],M=f.isSkinnedMesh?s(f):0;if(null!==n.precision){y=i.getMaxPrecision(n.precision);if(y!==n.precision){console.warn("THREE.WebGLProgram.getParameters:",n.precision,"not supported, using",y,"instead.")}}var T,E;if(S){var R=Ud[S];T=R.vertexShader;E=R.fragmentShader}else{T=n.vertexShader;E=n.fragmentShader}var w=e.getRenderTarget(),A=0<n.alphaTest,k=0<n.clearcoat,C={isWebGL2:u,shaderID:S,shaderName:n.type,vertexShader:T,fragmentShader:E,defines:n.defines,isRawShaderMaterial:!0===n.isRawShaderMaterial,glslVersion:n.glslVersion,precision:y,instancing:!0===f.isInstancedMesh,instancingColor:!0===f.isInstancedMesh&&null!==f.instanceColor,supportsVertexTextures:h,outputEncoding:null!==w?l(w.texture):e.outputEncoding,map:!!n.map,mapEncoding:l(n.map),matcap:!!n.matcap,matcapEncoding:l(n.matcap),envMap:!!b,envMapMode:b&&b.mapping,envMapEncoding:l(b),envMapCubeUV:!!b&&(b.mapping===Ai||b.mapping===ki),lightMap:!!n.lightMap,lightMapEncoding:l(n.lightMap),aoMap:!!n.aoMap,emissiveMap:!!n.emissiveMap,emissiveMapEncoding:l(n.emissiveMap),bumpMap:!!n.bumpMap,normalMap:!!n.normalMap,objectSpaceNormalMap:n.normalMapType===wo,tangentSpaceNormalMap:n.normalMapType===Eo,clearcoat:k,clearcoatMap:k&&!!n.clearcoatMap,clearcoatRoughnessMap:k&&!!n.clearcoatRoughnessMap,clearcoatNormalMap:k&&!!n.clearcoatNormalMap,displacementMap:!!n.displacementMap,roughnessMap:!!n.roughnessMap,metalnessMap:!!n.metalnessMap,specularMap:!!n.specularMap,specularIntensityMap:!!n.specularIntensityMap,specularColorMap:!!n.specularColorMap,specularColorMapEncoding:l(n.specularColorMap),alphaMap:!!n.alphaMap,alphaTest:A,gradientMap:!!n.gradientMap,sheen:0<n.sheen,sheenColorMap:!!n.sheenColorMap,sheenColorMapEncoding:l(n.sheenColorMap),sheenRoughnessMap:!!n.sheenRoughnessMap,transmission:0<n.transmission,transmissionMap:!!n.transmissionMap,thicknessMap:!!n.thicknessMap,combine:n.combine,vertexTangents:!!n.normalMap&&!!f.geometry&&!!f.geometry.attributes.tangent,vertexColors:n.vertexColors,vertexAlphas:!0===n.vertexColors&&!!f.geometry&&!!f.geometry.attributes.color&&4===f.geometry.attributes.color.itemSize,vertexUvs:!!n.map||!!n.bumpMap||!!n.normalMap||!!n.specularMap||!!n.alphaMap||!!n.emissiveMap||!!n.roughnessMap||!!n.metalnessMap||!!n.clearcoatMap||!!n.clearcoatRoughnessMap||!!n.clearcoatNormalMap||!!n.displacementMap||!!n.transmissionMap||!!n.thicknessMap||!!n.specularIntensityMap||!!n.specularColorMap||!!n.sheenColorMap||n.sheenRoughnessMap,uvsVertexOnly:!(!!n.map||!!n.bumpMap||!!n.normalMap||!!n.specularMap||!!n.alphaMap||!!n.emissiveMap||!!n.roughnessMap||!!n.metalnessMap||!!n.clearcoatNormalMap||0<n.transmission||!!n.transmissionMap||!!n.thicknessMap||!!n.specularIntensityMap||!!n.specularColorMap||0<n.sheen||!!n.sheenColorMap||!!n.sheenRoughnessMap)&&!!n.displacementMap,fog:!!_,useFog:n.fog,fogExp2:_&&_.isFogExp2,flatShading:!!n.flatShading,sizeAttenuation:n.sizeAttenuation,logarithmicDepthBuffer:p,skinning:!0===f.isSkinnedMesh&&0<M,maxBones:M,useVertexTexture:m,morphTargets:!!f.geometry&&!!f.geometry.morphAttributes.position,morphNormals:!!f.geometry&&!!f.geometry.morphAttributes.normal,morphTargetsCount:!!f.geometry&&!!f.geometry.morphAttributes.position?f.geometry.morphAttributes.position.length:0,numDirLights:d.directional.length,numPointLights:d.point.length,numSpotLights:d.spot.length,numRectAreaLights:d.rectArea.length,numHemiLights:d.hemi.length,numDirLightShadows:d.directionalShadowMap.length,numPointLightShadows:d.pointShadowMap.length,numSpotLightShadows:d.spotShadowMap.length,numClippingPlanes:o.numPlanes,numClipIntersection:o.numIntersection,format:n.format,dithering:n.dithering,shadowMapEnabled:e.shadowMap.enabled&&0<c.length,shadowMapType:e.shadowMap.type,toneMapping:n.toneMapped?e.toneMapping:hi,physicallyCorrectLights:e.physicallyCorrectLights,premultipliedAlpha:n.premultipliedAlpha,doubleSided:n.side===Dr,flipSided:n.side===Ir,depthPacking:n.depthPacking!==void 0?n.depthPacking:!1,index0AttributeName:n.index0AttributeName,extensionDerivatives:n.extensions&&n.extensions.derivatives,extensionFragDepth:n.extensions&&n.extensions.fragDepth,extensionDrawBuffers:n.extensions&&n.extensions.drawBuffers,extensionShaderTextureLOD:n.extensions&&n.extensions.shaderTextureLOD,rendererExtensionFragDepth:u||r.has("EXT_frag_depth"),rendererExtensionDrawBuffers:u||r.has("WEBGL_draw_buffers"),rendererExtensionShaderTextureLod:u||r.has("EXT_shader_texture_lod"),customProgramCacheKey:n.customProgramCacheKey()};return C}return{getParameters:d,getProgramCacheKey:function(t){var a=[];if(t.shaderID){a.push(t.shaderID)}else{a.push(g(t.fragmentShader));a.push(g(t.vertexShader))}if(t.defines!==void 0){for(var r in t.defines){a.push(r);a.push(t.defines[r])}}if(!1===t.isRawShaderMaterial){for(var i=0;i<_.length;i++){a.push(t[_[i]])}a.push(e.outputEncoding);a.push(e.gammaFactor)}a.push(t.customProgramCacheKey);return a.join()},getUniforms:function(e){var t=v[e.type],a;if(t){var r=Ud[t];a=Md.clone(r.uniforms)}else{a=e.uniforms}return a},acquireProgram:function(t,a){for(var r,i=0,o=c.length,s;i<o;i++){s=c[i];if(s.cacheKey===a){r=s;++r.usedTimes;break}}if(r===void 0){r=new yt(e,a,t,n);c.push(r)}return r},releaseProgram:function(e){if(0==--e.usedTimes){var t=c.indexOf(e);c[t]=c[c.length-1];c.pop();e.destroy()}},programs:c}}function _t(){var r=new WeakMap;function e(e){var t=r.get(e);if(t===void 0){t={};r.set(e,t)}return t}function t(e){r.delete(e)}function a(e,t,a){r.get(e)[t]=a}return{get:e,remove:t,update:a,dispose:function(){r=new WeakMap}}}function xt(e,t){if(e.groupOrder!==t.groupOrder){return e.groupOrder-t.groupOrder}else if(e.renderOrder!==t.renderOrder){return e.renderOrder-t.renderOrder}else if(e.program!==t.program){return e.program.id-t.program.id}else if(e.material.id!==t.material.id){return e.material.id-t.material.id}else if(e.z!==t.z){return e.z-t.z}else{return e.id-t.id}}function bt(e,t){if(e.groupOrder!==t.groupOrder){return e.groupOrder-t.groupOrder}else if(e.renderOrder!==t.renderOrder){return e.renderOrder-t.renderOrder}else if(e.z!==t.z){return t.z-e.z}else{return e.id-t.id}}function St(e){var r=[],i=0,n=[],o=[],s=[],l={id:-1};function t(t,a,n,o,s,d){var c=r[i],u=e.get(n);if(c===void 0){c={id:t.id,object:t,geometry:a,material:n,program:u.program||l,groupOrder:o,renderOrder:t.renderOrder,z:s,group:d};r[i]=c}else{c.id=t.id;c.object=t;c.geometry=a;c.material=n;c.program=u.program||l;c.groupOrder=o;c.renderOrder=t.renderOrder;c.z=s;c.group=d}i++;return c}function a(){for(var e=i,t=r.length,a;e<t;e++){a=r[e];if(null===a.id)break;a.id=null;a.object=null;a.geometry=null;a.material=null;a.program=null;a.group=null}}return{opaque:n,transmissive:o,transparent:s,init:function(){i=0;n.length=0;o.length=0;s.length=0},push:function(e,a,r,i,l,d){var c=t(e,a,r,i,l,d);if(0<r.transmission){o.push(c)}else if(!0===r.transparent){s.push(c)}else{n.push(c)}},unshift:function(e,a,r,i,l,d){var c=t(e,a,r,i,l,d);if(0<r.transmission){o.unshift(c)}else if(!0===r.transparent){s.unshift(c)}else{n.unshift(c)}},finish:a,sort:function(e,t){if(1<n.length)n.sort(e||xt);if(1<o.length)o.sort(t||bt);if(1<s.length)s.sort(t||bt)}}}function Mt(e){var a=new WeakMap;function t(t,r){var i;if(!1===a.has(t)){i=new St(e);a.set(t,[i])}else{if(r>=a.get(t).length){i=new St(e);a.get(t).push(i)}else{i=a.get(t)[r]}}return i}return{get:t,dispose:function(){a=new WeakMap}}}function Tt(){var e={};return{get:function get(t){if(e[t.id]!==void 0){return e[t.id]}var a;switch(t.type){case"DirectionalLight":a={direction:new vs,color:new zl};break;case"SpotLight":a={position:new vs,direction:new vs,color:new zl,distance:0,coneCos:0,penumbraCos:0,decay:0};break;case"PointLight":a={position:new vs,color:new zl,distance:0,decay:0};break;case"HemisphereLight":a={direction:new vs,skyColor:new zl,groundColor:new zl};break;case"RectAreaLight":a={color:new zl,position:new vs,halfWidth:new vs,halfHeight:new vs};break;}e[t.id]=a;return a}}}function Et(){var e={};return{get:function get(t){if(e[t.id]!==void 0){return e[t.id]}var a;switch(t.type){case"DirectionalLight":a={shadowBias:0,shadowNormalBias:0,shadowRadius:1,shadowMapSize:new os};break;case"SpotLight":a={shadowBias:0,shadowNormalBias:0,shadowRadius:1,shadowMapSize:new os};break;case"PointLight":a={shadowBias:0,shadowNormalBias:0,shadowRadius:1,shadowMapSize:new os,shadowCameraNear:1,shadowCameraFar:1e3};break;}e[t.id]=a;return a}}}var _c=0;function wt(e,t){return(t.castShadow?1:0)-(e.castShadow?1:0)}function At(e,t){for(var r=new Tt,i=Et(),n={version:0,hash:{directionalLength:-1,pointLength:-1,spotLength:-1,rectAreaLength:-1,hemiLength:-1,numDirectionalShadows:-1,numPointShadows:-1,numSpotShadows:-1},ambient:[0,0,0],probe:[],directional:[],directionalShadow:[],directionalShadowMap:[],directionalShadowMatrix:[],spot:[],spotShadow:[],spotShadowMap:[],spotShadowMatrix:[],rectArea:[],rectAreaLTC1:null,rectAreaLTC2:null,point:[],pointShadow:[],pointShadowMap:[],pointShadowMatrix:[],hemi:[]},o=0;9>o;o++){n.probe.push(new vs)}var s=new vs,l=new Ys,d=new Ys;function a(a,o){for(var s=0,d=0,c=0,u=0;9>u;u++){n.probe[u].set(0,0,0)}var p=0,m=0,f=0,h=0,y=0,v=0,_=0,x=0;a.sort(wt);for(var S=!0!==o?Math.PI:1,M=0,T=a.length;M<T;M++){var l=a[M],E=l.color,w=l.intensity,A=l.distance,k=l.shadow&&l.shadow.map?l.shadow.map.texture:null;if(l.isAmbientLight){s+=E.r*w*S;d+=E.g*w*S;c+=E.b*w*S}else if(l.isLightProbe){for(var N=0;9>N;N++){n.probe[N].addScaledVector(l.sh.coefficients[N],w)}}else if(l.isDirectionalLight){var F=r.get(l);F.color.copy(l.color).multiplyScalar(l.intensity*S);if(l.castShadow){var C=l.shadow,R=i.get(l);R.shadowBias=C.bias;R.shadowNormalBias=C.normalBias;R.shadowRadius=C.radius;R.shadowMapSize=C.mapSize;n.directionalShadow[p]=R;n.directionalShadowMap[p]=k;n.directionalShadowMatrix[p]=l.shadow.matrix;v++}n.directional[p]=F;p++}else if(l.isSpotLight){var O=r.get(l);O.position.setFromMatrixPosition(l.matrixWorld);O.color.copy(E).multiplyScalar(w*S);O.distance=A;O.coneCos=Math.cos(l.angle);O.penumbraCos=Math.cos(l.angle*(1-l.penumbra));O.decay=l.decay;if(l.castShadow){var L=l.shadow,P=i.get(l);P.shadowBias=L.bias;P.shadowNormalBias=L.normalBias;P.shadowRadius=L.radius;P.shadowMapSize=L.mapSize;n.spotShadow[f]=P;n.spotShadowMap[f]=k;n.spotShadowMatrix[f]=l.shadow.matrix;x++}n.spot[f]=O;f++}else if(l.isRectAreaLight){var B=r.get(l);B.color.copy(E).multiplyScalar(w);B.halfWidth.set(.5*l.width,0,0);B.halfHeight.set(0,.5*l.height,0);n.rectArea[h]=B;h++}else if(l.isPointLight){var U=r.get(l);U.color.copy(l.color).multiplyScalar(l.intensity*S);U.distance=l.distance;U.decay=l.decay;if(l.castShadow){var I=l.shadow,D=i.get(l);D.shadowBias=I.bias;D.shadowNormalBias=I.normalBias;D.shadowRadius=I.radius;D.shadowMapSize=I.mapSize;D.shadowCameraNear=I.camera.near;D.shadowCameraFar=I.camera.far;n.pointShadow[m]=D;n.pointShadowMap[m]=k;n.pointShadowMatrix[m]=l.shadow.matrix;_++}n.point[m]=U;m++}else if(l.isHemisphereLight){var G=r.get(l);G.skyColor.copy(l.color).multiplyScalar(w*S);G.groundColor.copy(l.groundColor).multiplyScalar(w*S);n.hemi[y]=G;y++}}if(0<h){if(t.isWebGL2){n.rectAreaLTC1=Bd.LTC_FLOAT_1;n.rectAreaLTC2=Bd.LTC_FLOAT_2}else{if(!0===e.has("OES_texture_float_linear")){n.rectAreaLTC1=Bd.LTC_FLOAT_1;n.rectAreaLTC2=Bd.LTC_FLOAT_2}else if(!0===e.has("OES_texture_half_float_linear")){n.rectAreaLTC1=Bd.LTC_HALF_1;n.rectAreaLTC2=Bd.LTC_HALF_2}else{console.error("THREE.WebGLRenderer: Unable to use RectAreaLight. Missing WebGL extensions.")}}}n.ambient[0]=s;n.ambient[1]=d;n.ambient[2]=c;var z=n.hash;if(z.directionalLength!==p||z.pointLength!==m||z.spotLength!==f||z.rectAreaLength!==h||z.hemiLength!==y||z.numDirectionalShadows!==v||z.numPointShadows!==_||z.numSpotShadows!==x){n.directional.length=p;n.spot.length=f;n.rectArea.length=h;n.point.length=m;n.hemi.length=y;n.directionalShadow.length=v;n.directionalShadowMap.length=v;n.pointShadow.length=_;n.pointShadowMap.length=_;n.spotShadow.length=x;n.spotShadowMap.length=x;n.directionalShadowMatrix.length=v;n.pointShadowMatrix.length=_;n.spotShadowMatrix.length=x;z.directionalLength=p;z.pointLength=m;z.spotLength=f;z.rectAreaLength=h;z.hemiLength=y;z.numDirectionalShadows=v;z.numPointShadows=_;z.numSpotShadows=x;n.version=_c++}}return{setup:a,setupView:function(e,t){for(var a=0,r=0,i=0,o=0,c=0,u=t.matrixWorldInverse,p=0,m=e.length,g;p<m;p++){g=e[p];if(g.isDirectionalLight){var f=n.directional[a];f.direction.setFromMatrixPosition(g.matrixWorld);s.setFromMatrixPosition(g.target.matrixWorld);f.direction.sub(s);f.direction.transformDirection(u);a++}else if(g.isSpotLight){var h=n.spot[i];h.position.setFromMatrixPosition(g.matrixWorld);h.position.applyMatrix4(u);h.direction.setFromMatrixPosition(g.matrixWorld);s.setFromMatrixPosition(g.target.matrixWorld);h.direction.sub(s);h.direction.transformDirection(u);i++}else if(g.isRectAreaLight){var y=n.rectArea[o];y.position.setFromMatrixPosition(g.matrixWorld);y.position.applyMatrix4(u);d.identity();l.copy(g.matrixWorld);l.premultiply(u);d.extractRotation(l);y.halfWidth.set(.5*g.width,0,0);y.halfHeight.set(0,.5*g.height,0);y.halfWidth.applyMatrix4(d);y.halfHeight.applyMatrix4(d);o++}else if(g.isPointLight){var v=n.point[r];v.position.setFromMatrixPosition(g.matrixWorld);v.position.applyMatrix4(u);r++}else if(g.isHemisphereLight){var _=n.hemi[c];_.direction.setFromMatrixPosition(g.matrixWorld);_.direction.transformDirection(u);_.direction.normalize();c++}}},state:n}}function kt(e,t){var a=new At(e,t),r=[],i=[];return{init:function(){r.length=0;i.length=0},state:{lightsArray:r,shadowsArray:i,lights:a},setupLights:function(e){a.setup(r,e)},setupLightsView:function(e){a.setupView(r,e)},pushLight:function(e){r.push(e)},pushShadow:function(e){i.push(e)}}}function Ct(e,t){var r=new WeakMap;function a(a){var i=1<arguments.length&&arguments[1]!==void 0?arguments[1]:0,n;if(!1===r.has(a)){n=new kt(e,t);r.set(a,[n])}else{if(i>=r.get(a).length){n=new kt(e,t);r.get(a).push(n)}else{n=r.get(a)[i]}}return n}return{get:a,dispose:function(){r=new WeakMap}}}var xc=function(e){_inherits(t,e);var a=_createSuper(t);function t(e){var r;_classCallCheck2(this,t);r=a.call(this);r.type="MeshDepthMaterial";r.depthPacking=Mo;r.map=null;r.alphaMap=null;r.displacementMap=null;r.displacementScale=1;r.displacementBias=0;r.wireframe=!1;r.wireframeLinewidth=1;r.fog=!1;r.setValues(e);return r}_createClass2(t,[{key:"copy",value:function copy(e){_get(_getPrototypeOf(t.prototype),"copy",this).call(this,e);this.depthPacking=e.depthPacking;this.map=e.map;this.alphaMap=e.alphaMap;this.displacementMap=e.displacementMap;this.displacementScale=e.displacementScale;this.displacementBias=e.displacementBias;this.wireframe=e.wireframe;this.wireframeLinewidth=e.wireframeLinewidth;return this}}]);return t}(Ll);xc.prototype.isMeshDepthMaterial=!0;var bc=function(e){_inherits(t,e);var a=_createSuper(t);function t(e){var r;_classCallCheck2(this,t);r=a.call(this);r.type="MeshDistanceMaterial";r.referencePosition=new vs;r.nearDistance=1;r.farDistance=1e3;r.map=null;r.alphaMap=null;r.displacementMap=null;r.displacementScale=1;r.displacementBias=0;r.fog=!1;r.setValues(e);return r}_createClass2(t,[{key:"copy",value:function copy(e){_get(_getPrototypeOf(t.prototype),"copy",this).call(this,e);this.referencePosition.copy(e.referencePosition);this.nearDistance=e.nearDistance;this.farDistance=e.farDistance;this.map=e.map;this.alphaMap=e.alphaMap;this.displacementMap=e.displacementMap;this.displacementScale=e.displacementScale;this.displacementBias=e.displacementBias;return this}}]);return t}(Ll);bc.prototype.isMeshDistanceMaterial=!0;function Rt(e,t,a){var o=new Nd,s=new os,l=new os,d=new ms,c=new xc({depthPacking:To}),u=new bc,p={},m=a.maxTextureSize,g={0:Ir,1:Pr,2:Dr},f=new Td({defines:{VSM_SAMPLES:8},uniforms:{shadow_pass:{value:null},resolution:{value:new os},radius:{value:4}},vertexShader:"void main() {\n\tgl_Position = vec4( position, 1.0 );\n}",fragmentShader:"uniform sampler2D shadow_pass;\nuniform vec2 resolution;\nuniform float radius;\n#include <packing>\nvoid main() {\n\tconst float samples = float( VSM_SAMPLES );\n\tfloat mean = 0.0;\n\tfloat squared_mean = 0.0;\n\tfloat uvStride = samples <= 1.0 ? 0.0 : 2.0 / ( samples - 1.0 );\n\tfloat uvStart = samples <= 1.0 ? 0.0 : - 1.0;\n\tfor ( float i = 0.0; i < samples; i ++ ) {\n\t\tfloat uvOffset = uvStart + i * uvStride;\n\t\t#ifdef HORIZONTAL_PASS\n\t\t\tvec2 distribution = unpackRGBATo2Half( texture2D( shadow_pass, ( gl_FragCoord.xy + vec2( uvOffset, 0.0 ) * radius ) / resolution ) );\n\t\t\tmean += distribution.x;\n\t\t\tsquared_mean += distribution.y * distribution.y + distribution.x * distribution.x;\n\t\t#else\n\t\t\tfloat depth = unpackRGBAToDepth( texture2D( shadow_pass, ( gl_FragCoord.xy + vec2( 0.0, uvOffset ) * radius ) / resolution ) );\n\t\t\tmean += depth;\n\t\t\tsquared_mean += depth * depth;\n\t\t#endif\n\t}\n\tmean = mean / samples;\n\tsquared_mean = squared_mean / samples;\n\tfloat std_dev = sqrt( squared_mean - mean * mean );\n\tgl_FragColor = pack2HalfToRGBA( vec2( mean, std_dev ) );\n}"}),h=f.clone();h.defines.HORIZONTAL_PASS=1;var y=new rd;y.setAttribute("position",new Bl(new Float32Array([-1,-1,.5,3,-1,.5,-1,3,.5]),3));var v=new bd(y,f),_=this;this.enabled=!1;this.autoUpdate=!0;this.needsUpdate=!1;this.type=Cr;this.render=function(t,a,i){if(!1===_.enabled)return;if(!1===_.autoUpdate&&!1===_.needsUpdate)return;if(0===t.length)return;var c=e.getRenderTarget(),u=e.getActiveCubeFace(),p=e.getActiveMipmapLevel(),g=e.state;g.setBlending(Fr);g.buffers.color.setClear(1,1,1,1);g.buffers.depth.setTest(!0);g.setScissorTest(!1);for(var b=0,S=t.length;b<S;b++){var f=t[b],h=f.shadow;if(h===void 0){console.warn("THREE.WebGLShadowMap:",f,"has no shadow.");continue}if(!1===h.autoUpdate&&!1===h.needsUpdate)continue;s.copy(h.mapSize);var M=h.getFrameExtents();s.multiply(M);l.copy(h.mapSize);if(s.x>m||s.y>m){if(s.x>m){l.x=Math.floor(m/M.x);s.x=l.x*M.x;h.mapSize.x=l.x}if(s.y>m){l.y=Math.floor(m/M.y);s.y=l.y*M.y;h.mapSize.y=l.y}}if(null===h.map&&!h.isPointLightShadow&&this.type===Lr){var T={minFilter:Fi,magFilter:Fi,format:an};h.map=new gs(s.x,s.y,T);h.map.texture.name=f.name+".shadowMap";h.mapPass=new gs(s.x,s.y,T);h.camera.updateProjectionMatrix()}if(null===h.map){h.map=new gs(s.x,s.y,{minFilter:Pi,magFilter:Pi,format:an});h.map.texture.name=f.name+".shadowMap";h.camera.updateProjectionMatrix()}e.setRenderTarget(h.map);e.clear();for(var y=h.getViewportCount(),v=0,x;v<y;v++){x=h.getViewport(v);d.set(l.x*x.x,l.y*x.y,l.x*x.z,l.y*x.w);g.viewport(d);h.updateMatrices(f,v);o=h.getFrustum();n(a,i,h.camera,f,this.type)}if(!h.isPointLightShadow&&this.type===Lr){r(h,i)}h.needsUpdate=!1}_.needsUpdate=!1;e.setRenderTarget(c,u,p)};function r(a,r){var i=t.update(v);if(f.defines.VSM_SAMPLES!==a.blurSamples){f.defines.VSM_SAMPLES=a.blurSamples;h.defines.VSM_SAMPLES=a.blurSamples;f.needsUpdate=!0;h.needsUpdate=!0}f.uniforms.shadow_pass.value=a.map.texture;f.uniforms.resolution.value=a.mapSize;f.uniforms.radius.value=a.radius;e.setRenderTarget(a.mapPass);e.clear();e.renderBufferDirect(r,null,i,f,v,null);h.uniforms.shadow_pass.value=a.mapPass.texture;h.uniforms.resolution.value=a.mapSize;h.uniforms.radius.value=a.radius;e.setRenderTarget(a.map);e.clear();e.renderBufferDirect(r,null,i,h,v,null)}function i(t,a,r,i,n,o,s){var l=null,d=!0===i.isPointLight?t.customDistanceMaterial:t.customDepthMaterial;if(d!==void 0){l=d}else{l=!0===i.isPointLight?u:c}if(e.localClippingEnabled&&!0===r.clipShadows&&0!==r.clippingPlanes.length||r.displacementMap&&0!==r.displacementScale||r.alphaMap&&0<r.alphaTest){var m=l.uuid,f=r.uuid,h=p[m];if(h===void 0){h={};p[m]=h}var y=h[f];if(y===void 0){y=l.clone();h[f]=y}l=y}l.visible=r.visible;l.wireframe=r.wireframe;if(s===Lr){l.side=null!==r.shadowSide?r.shadowSide:r.side}else{l.side=null!==r.shadowSide?r.shadowSide:g[r.side]}l.alphaMap=r.alphaMap;l.alphaTest=r.alphaTest;l.clipShadows=r.clipShadows;l.clippingPlanes=r.clippingPlanes;l.clipIntersection=r.clipIntersection;l.displacementMap=r.displacementMap;l.displacementScale=r.displacementScale;l.displacementBias=r.displacementBias;l.wireframeLinewidth=r.wireframeLinewidth;l.linewidth=r.linewidth;if(!0===i.isPointLight&&!0===l.isMeshDistanceMaterial){l.referencePosition.setFromMatrixPosition(i.matrixWorld);l.nearDistance=n;l.farDistance=o}return l}function n(a,r,s,d,c){if(!1===a.visible)return;var u=a.layers.test(r.layers);if(u&&(a.isMesh||a.isLine||a.isPoints)){if((a.castShadow||a.receiveShadow&&c===Lr)&&(!a.frustumCulled||o.intersectsObject(a))){a.modelViewMatrix.multiplyMatrices(s.matrixWorldInverse,a.matrixWorld);var p=t.update(a),m=a.material;if(Array.isArray(m)){for(var g=p.groups,f=0,h=g.length;f<h;f++){var y=g[f],v=m[y.materialIndex];if(v&&v.visible){var l=i(a,p,v,d,s.near,s.far,c);e.renderBufferDirect(s,null,p,l,a,y)}}}else if(m.visible){var S=i(a,p,m,d,s.near,s.far,c);e.renderBufferDirect(s,null,p,S,a,null)}}}for(var _=a.children,x=0,b=_.length;x<b;x++){n(_[x],r,s,d,c)}}}function Lt(e,t,a){var v,_,x=a.isWebGL2;var b=new function(){var t=!1,i=new ms,n=null,o=new ms(0,0,0,0);return{setMask:function setMask(a){if(n!==a&&!t){e.colorMask(a,a,a,a);n=a}},setLocked:function setLocked(e){t=e},setClear:function setClear(t,n,s,l,a){if(!0===a){t*=l;n*=l;s*=l}i.set(t,n,s,l);if(!1===o.equals(i)){e.clearColor(t,n,s,l);o.copy(i)}},reset:function reset(){t=!1;n=null;o.set(-1,0,0,0)}}},S=new function(){var t=!1,a=null,r=null,o=null;return{setTest:function setTest(e){if(e){i(2929)}else{n(2929)}},setMask:function setMask(r){if(a!==r&&!t){e.depthMask(r);a=r}},setFunc:function setFunc(t){if(r!==t){if(t){switch(t){case ni:e.depthFunc(512);break;case oi:e.depthFunc(519);break;case si:e.depthFunc(513);break;case li:e.depthFunc(515);break;case di:e.depthFunc(514);break;case ci:e.depthFunc(518);break;case ui:e.depthFunc(516);break;case pi:e.depthFunc(517);break;default:e.depthFunc(515);}}else{e.depthFunc(515)}r=t}},setLocked:function setLocked(e){t=e},setClear:function setClear(t){if(o!==t){e.clearDepth(t);o=t}},reset:function reset(){t=!1;a=null;r=null;o=null}}},M=new function(){var t=!1,a=null,r=null,o=null,s=null,l=null,d=null,c=null,u=null;return{setTest:function setTest(e){if(!t){if(e){i(2960)}else{n(2960)}}},setMask:function setMask(r){if(a!==r&&!t){e.stencilMask(r);a=r}},setFunc:function setFunc(t,a,i){if(r!==t||o!==a||s!==i){e.stencilFunc(t,a,i);r=t;o=a;s=i}},setOp:function setOp(t,a,r){if(l!==t||d!==a||c!==r){e.stencilOp(t,a,r);l=t;d=a;c=r}},setLocked:function setLocked(e){t=e},setClear:function setClear(t){if(u!==t){e.clearStencil(t);u=t}},reset:function reset(){t=!1;a=null;r=null;o=null;s=null;l=null;d=null;c=null;u=null}}},T={},E={},w=null,A=!1,k=null,C=null,R=null,L=null,P=null,I=null,D=null,z=!1,N=null,F=null,O=null,B=null,U=null,G=e.getParameter(35661),H=!1,V=0,W=e.getParameter(7938);if(-1!==W.indexOf("WebGL")){V=parseFloat(/^WebGL (\d)/.exec(W)[1]);H=1<=V}else if(-1!==W.indexOf("OpenGL ES")){V=parseFloat(/^OpenGL ES (\d)/.exec(W)[1]);H=2<=V}var j=null,q={},X=e.getParameter(3088),Y=e.getParameter(2978),Z=new ms().fromArray(X),J=new ms().fromArray(Y);function r(t,a,r){var i=new Uint8Array(4),n=e.createTexture();e.bindTexture(t,n);e.texParameteri(t,10241,9728);e.texParameteri(t,10240,9728);for(var o=0;o<r;o++){e.texImage2D(a+o,0,6408,1,1,0,6408,5121,i)}return n}var Q={3553:r(3553,3553,1),34067:r(34067,34069,6)};b.setClear(0,0,0,1);S.setClear(1);M.setClear(0);i(2929);S.setFunc(li);d(!1);c(Er);i(2884);l(Fr);function i(t){if(!0!==T[t]){e.enable(t);T[t]=!0}}function n(t){if(!1!==T[t]){e.disable(t);T[t]=!1}}function o(t,a){if(E[t]!==a){e.bindFramebuffer(t,a);E[t]=a;if(x){if(36009===t){E[36160]=a}if(36160===t){E[36009]=a}}return!0}return!1}function s(t){if(w!==t){e.useProgram(t);w=t;return!0}return!1}var K=(v={},_defineProperty2(v,Vr,32774),_defineProperty2(v,Wr,32778),_defineProperty2(v,jr,32779),v);if(x){K[qr]=32775;K[Xr]=32776}else{var ee=t.get("EXT_blend_minmax");if(null!==ee){K[qr]=ee.MIN_EXT;K[Xr]=ee.MAX_EXT}}var $=(_={},_defineProperty2(_,Yr,0),_defineProperty2(_,Zr,1),_defineProperty2(_,Jr,768),_defineProperty2(_,Kr,770),_defineProperty2(_,ii,776),_defineProperty2(_,ai,774),_defineProperty2(_,ei,772),_defineProperty2(_,Qr,769),_defineProperty2(_,$r,771),_defineProperty2(_,ri,775),_defineProperty2(_,ti,773),_);function l(t,a,r,o,s,l,d,c){if(t===Fr){if(!0===A){n(3042);A=!1}return}if(!1===A){i(3042);A=!0}if(t!==Hr){if(t!==k||c!==z){if(C!==Vr||P!==Vr){e.blendEquation(32774);C=Vr;P=Vr}if(c){switch(t){case Or:e.blendFuncSeparate(1,771,1,771);break;case Br:e.blendFunc(1,1);break;case Ur:e.blendFuncSeparate(0,0,769,771);break;case Gr:e.blendFuncSeparate(0,768,0,770);break;default:console.error("THREE.WebGLState: Invalid blending: ",t);break;}}else{switch(t){case Or:e.blendFuncSeparate(770,771,1,771);break;case Br:e.blendFunc(770,1);break;case Ur:e.blendFunc(0,769);break;case Gr:e.blendFunc(0,768);break;default:console.error("THREE.WebGLState: Invalid blending: ",t);break;}}R=null;L=null;I=null;D=null;k=t;z=c}return}s=s||a;l=l||r;d=d||o;if(a!==C||s!==P){e.blendEquationSeparate(K[a],K[s]);C=a;P=s}if(r!==R||o!==L||l!==I||d!==D){e.blendFuncSeparate($[r],$[o],$[l],$[d]);R=r;L=o;I=l;D=d}k=t;z=null}function d(t){if(N!==t){if(t){e.frontFace(2304)}else{e.frontFace(2305)}N=t}}function c(t){if(t!==Tr){i(2884);if(t!==F){if(t===Er){e.cullFace(1029)}else if(t===wr){e.cullFace(1028)}else{e.cullFace(1032)}}}else{n(2884)}F=t}function u(t){if(t!==O){if(H)e.lineWidth(t);O=t}}function p(t,a,r){if(t){i(32823);if(B!==a||U!==r){e.polygonOffset(a,r);B=a;U=r}}else{n(32823)}}function m(t){if(t===void 0)t=33984+G-1;if(j!==t){e.activeTexture(t);j=t}}function g(t,a){if(null===j){m()}var r=q[j];if(r===void 0){r={type:void 0,texture:void 0};q[j]=r}if(r.type!==t||r.texture!==a){e.bindTexture(t,a||Q[t]);r.type=t;r.texture=a}}function f(){var t=q[j];if(t!==void 0&&t.type!==void 0){e.bindTexture(t.type,null);t.type=void 0;t.texture=void 0}}function h(t){if(!1===Z.equals(t)){e.scissor(t.x,t.y,t.z,t.w);Z.copy(t)}}function y(t){if(!1===J.equals(t)){e.viewport(t.x,t.y,t.z,t.w);J.copy(t)}}return{buffers:{color:b,depth:S,stencil:M},enable:i,disable:n,bindFramebuffer:o,useProgram:s,setBlending:l,setMaterial:function(e,t){e.side===Dr?n(2884):i(2884);var a=e.side===Ir;if(t)a=!a;d(a);e.blending===Or&&!1===e.transparent?l(Fr):l(e.blending,e.blendEquation,e.blendSrc,e.blendDst,e.blendEquationAlpha,e.blendSrcAlpha,e.blendDstAlpha,e.premultipliedAlpha);S.setFunc(e.depthFunc);S.setTest(e.depthTest);S.setMask(e.depthWrite);b.setMask(e.colorWrite);var r=e.stencilWrite;M.setTest(r);if(r){M.setMask(e.stencilWriteMask);M.setFunc(e.stencilFunc,e.stencilRef,e.stencilFuncMask);M.setOp(e.stencilFail,e.stencilZFail,e.stencilZPass)}p(e.polygonOffset,e.polygonOffsetFactor,e.polygonOffsetUnits);!0===e.alphaToCoverage?i(32926):n(32926)},setFlipSided:d,setCullFace:c,setLineWidth:u,setPolygonOffset:p,setScissorTest:function(e){if(e){i(3089)}else{n(3089)}},activeTexture:m,bindTexture:g,unbindTexture:f,compressedTexImage2D:function(){try{e.compressedTexImage2D.apply(e,arguments)}catch(e){console.error("THREE.WebGLState:",e)}},texImage2D:function(){try{e.texImage2D.apply(e,arguments)}catch(e){console.error("THREE.WebGLState:",e)}},texImage3D:function(){try{e.texImage3D.apply(e,arguments)}catch(e){console.error("THREE.WebGLState:",e)}},texStorage2D:function(){try{e.texStorage2D.apply(e,arguments)}catch(e){console.error("THREE.WebGLState:",e)}},texSubImage2D:function(){try{e.texSubImage2D.apply(e,arguments)}catch(e){console.error("THREE.WebGLState:",e)}},scissor:h,viewport:y,reset:function(){e.disable(3042);e.disable(2884);e.disable(2929);e.disable(32823);e.disable(3089);e.disable(2960);e.disable(32926);e.blendEquation(32774);e.blendFunc(1,0);e.blendFuncSeparate(1,0,1,0);e.colorMask(!0,!0,!0,!0);e.clearColor(0,0,0,0);e.depthMask(!0);e.depthFunc(513);e.clearDepth(1);e.stencilMask(4294967295);e.stencilFunc(519,0,4294967295);e.stencilOp(7680,7680,7680);e.clearStencil(0);e.cullFace(1029);e.frontFace(2305);e.polygonOffset(0,0);e.activeTexture(33984);e.bindFramebuffer(36160,null);if(!0===x){e.bindFramebuffer(36009,null);e.bindFramebuffer(36008,null)}e.useProgram(null);e.lineWidth(1);e.scissor(0,0,e.canvas.width,e.canvas.height);e.viewport(0,0,e.canvas.width,e.canvas.height);T={};j=null;q={};E={};w=null;A=!1;k=null;C=null;R=null;L=null;P=null;I=null;D=null;z=!1;N=null;F=null;O=null;B=null;U=null;Z.set(0,0,e.canvas.width,e.canvas.height);J.set(0,0,e.canvas.width,e.canvas.height);b.reset();S.reset();M.reset()}}}function Pt(e,t,a,r,i,n,o){var O,B,U=i.isWebGL2,G=i.maxTextures,H=i.maxCubemapSize,V=i.maxTextureSize,W=i.maxSamples,j=t.has("WEBGL_multisampled_render_to_texture"),q=j?t.get("WEBGL_multisampled_render_to_texture"):void 0,X=new WeakMap,Y,Z=!1;try{Z="undefined"!=typeof OffscreenCanvas&&null!==new OffscreenCanvas(1,1).getContext("2d")}catch(e){}function l(e,t){return Z?new OffscreenCanvas(e,t):m("canvas")}function c(e,t,a,r){var i=1;if(e.width>r||e.height>r){i=r/Math.max(e.width,e.height)}if(1>i||!0===t){if("undefined"!=typeof HTMLImageElement&&e instanceof HTMLImageElement||"undefined"!=typeof HTMLCanvasElement&&e instanceof HTMLCanvasElement||"undefined"!=typeof ImageBitmap&&e instanceof ImageBitmap){var n=t?d:Math.floor,o=n(i*e.width),s=n(i*e.height);if(Y===void 0)Y=l(o,s);var c=a?l(o,s):Y;c.width=o;c.height=s;var u=c.getContext("2d");u.drawImage(e,0,0,o,s);console.warn("THREE.WebGLRenderer: Texture has been resized from ("+e.width+"x"+e.height+") to ("+o+"x"+s+").");return c}else{if("data"in e){console.warn("THREE.WebGLRenderer: Image in DataTexture is too big ("+e.width+"x"+e.height+").")}return e}}return e}function u(e){return s(e.width)&&s(e.height)}function p(e){if(U)return!1;return e.wrapS!==Ri||e.wrapT!==Ri||e.minFilter!==Pi&&e.minFilter!==Fi}function g(e,t){return e.generateMipmaps&&t&&e.minFilter!==Pi&&e.minFilter!==Fi}function f(t){e.generateMipmap(t)}function h(a,r,i){if(!1===U)return r;if(null!==a){if(e[a]!==void 0)return e[a];console.warn("THREE.WebGLRenderer: Attempt to use non-existing WebGL internal format '"+a+"'")}var n=r;if(6403===r){if(5126===i)n=33326;if(5131===i)n=33325;if(5121===i)n=33321}if(6407===r){if(5126===i)n=34837;if(5131===i)n=34843;if(5121===i)n=32849}if(6408===r){if(5126===i)n=34836;if(5131===i)n=34842;if(5121===i)n=32856}if(33325===n||33326===n||34842===n||34836===n){t.get("EXT_color_buffer_float")}return n}function y(e,t,a){if(!0===g(e,a)){return Math.log2(Math.max(t.width,t.height))+1}else if(0<e.mipmaps.length){return e.mipmaps.length}else{return 1}}function v(e){if(e===Pi||e===Ii||e===zi){return 9728}return 9729}function _(e){var t=e.target;t.removeEventListener("dispose",_);b(t);if(t.isVideoTexture){X.delete(t)}o.memory.textures--}function x(e){var t=e.target;t.removeEventListener("dispose",x);S(t)}function b(t){var a=r.get(t);if(a.__webglInit===void 0)return;e.deleteTexture(a.__webglTexture);r.remove(t)}function S(t){var a=t.texture,i=r.get(t),n=r.get(a);if(!t)return;if(n.__webglTexture!==void 0){e.deleteTexture(n.__webglTexture);o.memory.textures--}if(t.depthTexture){t.depthTexture.dispose()}if(t.isWebGLCubeRenderTarget){for(var s=0;6>s;s++){e.deleteFramebuffer(i.__webglFramebuffer[s]);if(i.__webglDepthbuffer)e.deleteRenderbuffer(i.__webglDepthbuffer[s])}}else{e.deleteFramebuffer(i.__webglFramebuffer);if(i.__webglDepthbuffer)e.deleteRenderbuffer(i.__webglDepthbuffer);if(i.__webglMultisampledFramebuffer)e.deleteFramebuffer(i.__webglMultisampledFramebuffer);if(i.__webglColorRenderbuffer)e.deleteRenderbuffer(i.__webglColorRenderbuffer);if(i.__webglDepthRenderbuffer)e.deleteRenderbuffer(i.__webglDepthRenderbuffer)}if(t.isWebGLMultipleRenderTargets){for(var l=0,d=a.length,c;l<d;l++){c=r.get(a[l]);if(c.__webglTexture){e.deleteTexture(c.__webglTexture);o.memory.textures--}r.remove(a[l])}}r.remove(a);r.remove(t)}var J=0;function M(){var e=J;if(e>=G){console.warn("THREE.WebGLTextures: Trying to use "+e+" texture units while this GPU supports only "+G)}J+=1;return e}function T(e,t){var i=r.get(e);if(e.isVideoTexture)z(e);if(0<e.version&&i.__version!==e.version){var n=e.image;if(n===void 0){console.warn("THREE.WebGLRenderer: Texture marked for update but image is undefined")}else if(!1===n.complete){console.warn("THREE.WebGLRenderer: Texture marked for update but image is incomplete")}else{k(i,e,t);return}}a.activeTexture(33984+t);a.bindTexture(3553,i.__webglTexture)}function E(e,t){var i=r.get(e);if(0<e.version&&i.__version!==e.version){C(i,e,t);return}a.activeTexture(33984+t);a.bindTexture(34067,i.__webglTexture)}var Q=(O={},_defineProperty2(O,Ci,10497),_defineProperty2(O,Ri,33071),_defineProperty2(O,Li,33648),O),K=(B={},_defineProperty2(B,Pi,9728),_defineProperty2(B,Ii,9984),_defineProperty2(B,zi,9986),_defineProperty2(B,Fi,9729),_defineProperty2(B,Oi,9985),_defineProperty2(B,Ui,9987),B);function w(a,n,o){if(o){e.texParameteri(a,10242,Q[n.wrapS]);e.texParameteri(a,10243,Q[n.wrapT]);if(32879===a||35866===a){e.texParameteri(a,32882,Q[n.wrapR])}e.texParameteri(a,10240,K[n.magFilter]);e.texParameteri(a,10241,K[n.minFilter])}else{e.texParameteri(a,10242,33071);e.texParameteri(a,10243,33071);if(32879===a||35866===a){e.texParameteri(a,32882,33071)}if(n.wrapS!==Ri||n.wrapT!==Ri){console.warn("THREE.WebGLRenderer: Texture is not power of two. Texture.wrapS and Texture.wrapT should be set to THREE.ClampToEdgeWrapping.")}e.texParameteri(a,10240,v(n.magFilter));e.texParameteri(a,10241,v(n.minFilter));if(n.minFilter!==Pi&&n.minFilter!==Fi){console.warn("THREE.WebGLRenderer: Texture is not power of two. Texture.minFilter should be set to THREE.NearestFilter or THREE.LinearFilter.")}}if(!0===t.has("EXT_texture_filter_anisotropic")){var s=t.get("EXT_texture_filter_anisotropic");if(n.type===Yi&&!1===t.has("OES_texture_float_linear"))return;if(!1===U&&n.type===Zi&&!1===t.has("OES_texture_half_float_linear"))return;if(1<n.anisotropy||r.get(n).__currentAnisotropy){e.texParameterf(a,s.TEXTURE_MAX_ANISOTROPY_EXT,Math.min(n.anisotropy,i.getMaxAnisotropy()));r.get(n).__currentAnisotropy=n.anisotropy}}}function A(t,a){if(t.__webglInit===void 0){t.__webglInit=!0;a.addEventListener("dispose",_);t.__webglTexture=e.createTexture();o.memory.textures++}}function k(t,r,i){var o=3553;if(r.isDataTexture2DArray)o=35866;if(r.isDataTexture3D)o=32879;A(t,r);a.activeTexture(33984+i);a.bindTexture(o,t.__webglTexture);e.pixelStorei(37440,r.flipY);e.pixelStorei(37441,r.premultiplyAlpha);e.pixelStorei(3317,r.unpackAlignment);e.pixelStorei(37443,0);var s=p(r)&&!1===u(r.image),l=c(r.image,s,!1,V),d=u(l)||U,m=n.convert(r.format),v=n.convert(r.type),_=h(r.internalFormat,m,v,r.encoding);w(o,r,d);var x,b=r.mipmaps;if(r.isDepthTexture){_=6402;if(U){if(r.type===Yi){_=36012}else if(r.type===Xi){_=33190}else if(r.type===$i){_=35056}else{_=33189}}else{if(r.type===Yi){console.error("WebGLRenderer: Floating point depth texture requires WebGL2.")}}if(r.format===sn&&6402===_){if(r.type!==ji&&r.type!==Xi){console.warn("THREE.WebGLRenderer: Use UnsignedShortType or UnsignedIntType for DepthFormat DepthTexture.");r.type=ji;v=n.convert(r.type)}}if(r.format===ln&&6402===_){_=34041;if(r.type!==$i){console.warn("THREE.WebGLRenderer: Use UnsignedInt248Type for DepthStencilFormat DepthTexture.");r.type=$i;v=n.convert(r.type)}}a.texImage2D(3553,0,_,l.width,l.height,0,m,v,null)}else if(r.isDataTexture){if(0<b.length&&d){for(var E=0,k=b.length;E<k;E++){x=b[E];a.texImage2D(3553,E,_,x.width,x.height,0,m,v,x.data)}r.generateMipmaps=!1}else{a.texImage2D(3553,0,_,l.width,l.height,0,m,v,l.data)}}else if(r.isCompressedTexture){for(var C=0,R=b.length;C<R;C++){x=b[C];if(r.format!==an&&r.format!==tn){if(null!==m){a.compressedTexImage2D(3553,C,_,x.width,x.height,0,x.data)}else{console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .uploadTexture()")}}else{a.texImage2D(3553,C,_,x.width,x.height,0,m,v,x.data)}}}else if(r.isDataTexture2DArray){a.texImage3D(35866,0,_,l.width,l.height,l.depth,0,m,v,l.data)}else if(r.isDataTexture3D){a.texImage3D(32879,0,_,l.width,l.height,l.depth,0,m,v,l.data)}else{var S=y(r,l,d),M=U&&!0!==r.isVideoTexture,T=t.__version===void 0;if(0<b.length&&d){if(M&&T){a.texStorage2D(3553,S,_,b[0].width,b[0].height)}for(var L=0,P=b.length;L<P;L++){x=b[L];if(M){a.texSubImage2D(3553,L,0,0,m,v,x)}else{a.texImage2D(3553,L,_,m,v,x)}}r.generateMipmaps=!1}else{if(M){if(T){a.texStorage2D(3553,S,_,l.width,l.height)}a.texSubImage2D(3553,0,0,0,m,v,l)}else{a.texImage2D(3553,0,_,m,v,l)}}}if(g(r,d)){f(o)}t.__version=r.version;if(r.onUpdate)r.onUpdate(r)}function C(t,r,i){if(6!==r.image.length)return;A(t,r);a.activeTexture(33984+i);a.bindTexture(34067,t.__webglTexture);e.pixelStorei(37440,r.flipY);e.pixelStorei(37441,r.premultiplyAlpha);e.pixelStorei(3317,r.unpackAlignment);e.pixelStorei(37443,0);for(var o=r&&(r.isCompressedTexture||r.image[0].isCompressedTexture),s=r.image[0]&&r.image[0].isDataTexture,l=[],d=0;6>d;d++){if(!o&&!s){l[d]=c(r.image[d],!1,!0,H)}else{l[d]=s?r.image[d].image:r.image[d]}}var p=l[0],m=u(p)||U,y=n.convert(r.format),v=n.convert(r.type),_=h(r.internalFormat,y,v,r.encoding);w(34067,r,m);var x;if(o){for(var M=0;6>M;M++){x=l[M].mipmaps;for(var T=0,E;T<x.length;T++){E=x[T];if(r.format!==an&&r.format!==tn){if(null!==y){a.compressedTexImage2D(34069+M,T,_,E.width,E.height,0,E.data)}else{console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .setTextureCube()")}}else{a.texImage2D(34069+M,T,_,E.width,E.height,0,y,v,E.data)}}}}else{x=r.mipmaps;for(var k=0;6>k;k++){if(s){a.texImage2D(34069+k,0,_,l[k].width,l[k].height,0,y,v,l[k].data);for(var C=0;C<x.length;C++){var b=x[C],S=b.image[k].image;a.texImage2D(34069+k,C+1,_,S.width,S.height,0,y,v,S.data)}}else{a.texImage2D(34069+k,0,_,y,v,l[k]);for(var R=0,L;R<x.length;R++){L=x[R];a.texImage2D(34069+k,R+1,_,y,v,L.image[k])}}}}if(g(r,m)){f(34067)}t.__version=r.version;if(r.onUpdate)r.onUpdate(r)}function R(t,i,o,s,l){var d=n.convert(o.format),c=n.convert(o.type),u=h(o.internalFormat,d,c,o.encoding),p=r.get(i);if(!p.__hasExternalTextures){if(32879===l||35866===l){a.texImage3D(l,0,u,i.width,i.height,i.depth,0,d,c,null)}else{a.texImage2D(l,0,u,i.width,i.height,0,d,c,null)}}a.bindFramebuffer(36160,t);if(i.useRenderToTexture){q.framebufferTexture2DMultisampleEXT(36160,s,l,r.get(o).__webglTexture,0,D(i))}else{e.framebufferTexture2D(36160,s,l,r.get(o).__webglTexture,0)}a.bindFramebuffer(36160,null)}function L(t,a,r){e.bindRenderbuffer(36161,t);if(a.depthBuffer&&!a.stencilBuffer){var c=33189;if(r||a.useRenderToTexture){var u=a.depthTexture;if(u&&u.isDepthTexture){if(u.type===Yi){c=36012}else if(u.type===Xi){c=33190}}var p=D(a);if(a.useRenderToTexture){q.renderbufferStorageMultisampleEXT(36161,p,c,a.width,a.height)}else{e.renderbufferStorageMultisample(36161,p,c,a.width,a.height)}}else{e.renderbufferStorage(36161,c,a.width,a.height)}e.framebufferRenderbuffer(36160,36096,36161,t)}else if(a.depthBuffer&&a.stencilBuffer){var m=D(a);if(r&&a.useRenderbuffer){e.renderbufferStorageMultisample(36161,m,35056,a.width,a.height)}else if(a.useRenderToTexture){q.renderbufferStorageMultisampleEXT(36161,m,35056,a.width,a.height)}else{e.renderbufferStorage(36161,34041,a.width,a.height)}e.framebufferRenderbuffer(36160,33306,36161,t)}else{var i=!0===a.isWebGLMultipleRenderTargets?a.texture[0]:a.texture,o=n.convert(i.format),s=n.convert(i.type),l=h(i.internalFormat,o,s,i.encoding),d=D(a);if(r&&a.useRenderbuffer){e.renderbufferStorageMultisample(36161,d,l,a.width,a.height)}else if(a.useRenderToTexture){q.renderbufferStorageMultisampleEXT(36161,d,l,a.width,a.height)}else{e.renderbufferStorage(36161,l,a.width,a.height)}}e.bindRenderbuffer(36161,null)}function P(t,i){var n=i&&i.isWebGLCubeRenderTarget;if(n)throw new Error("Depth Texture with cube render targets is not supported");a.bindFramebuffer(36160,t);if(!(i.depthTexture&&i.depthTexture.isDepthTexture)){throw new Error("renderTarget.depthTexture must be an instance of THREE.DepthTexture")}if(!r.get(i.depthTexture).__webglTexture||i.depthTexture.image.width!==i.width||i.depthTexture.image.height!==i.height){i.depthTexture.image.width=i.width;i.depthTexture.image.height=i.height;i.depthTexture.needsUpdate=!0}T(i.depthTexture,0);var o=r.get(i.depthTexture).__webglTexture,s=D(i);if(i.depthTexture.format===sn){if(i.useRenderToTexture){q.framebufferTexture2DMultisampleEXT(36160,36096,3553,o,0,s)}else{e.framebufferTexture2D(36160,36096,3553,o,0)}}else if(i.depthTexture.format===ln){if(i.useRenderToTexture){q.framebufferTexture2DMultisampleEXT(36160,33306,3553,o,0,s)}else{e.framebufferTexture2D(36160,33306,3553,o,0)}}else{throw new Error("Unknown depthTexture format")}}function I(t){var i=r.get(t),n=!0===t.isWebGLCubeRenderTarget;if(t.depthTexture&&!i.__autoAllocateDepthBuffer){if(n)throw new Error("target.depthTexture not supported in Cube render targets");P(i.__webglFramebuffer,t)}else{if(n){i.__webglDepthbuffer=[];for(var o=0;6>o;o++){a.bindFramebuffer(36160,i.__webglFramebuffer[o]);i.__webglDepthbuffer[o]=e.createRenderbuffer();L(i.__webglDepthbuffer[o],t,!1)}}else{a.bindFramebuffer(36160,i.__webglFramebuffer);i.__webglDepthbuffer=e.createRenderbuffer();L(i.__webglDepthbuffer,t,!1)}}a.bindFramebuffer(36160,null)}function D(e){return U&&(e.useRenderbuffer||e.useRenderToTexture)?Math.min(W,e.samples):0}function z(e){var t=o.render.frame;if(X.get(e)!==t){X.set(e,t);e.update()}}var $=!1,ee=!1;function N(e,t){if(e&&e.isWebGLRenderTarget){if(!1===$){console.warn("THREE.WebGLTextures.safeSetTexture2D: don't use render targets as textures. Use their .texture property instead.");$=!0}e=e.texture}T(e,t)}function F(e,t){if(e&&e.isWebGLCubeRenderTarget){if(!1===ee){console.warn("THREE.WebGLTextures.safeSetTextureCube: don't use cube render targets as textures. Use their .texture property instead.");ee=!0}e=e.texture}E(e,t)}this.allocateTextureUnit=M;this.resetTextureUnits=function(){J=0};this.setTexture2D=T;this.setTexture2DArray=function(e,t){var i=r.get(e);if(0<e.version&&i.__version!==e.version){k(i,e,t);return}a.activeTexture(33984+t);a.bindTexture(35866,i.__webglTexture)};this.setTexture3D=function(e,t){var i=r.get(e);if(0<e.version&&i.__version!==e.version){k(i,e,t);return}a.activeTexture(33984+t);a.bindTexture(32879,i.__webglTexture)};this.setTextureCube=E;this.rebindTextures=function(e,t,a){var i=r.get(e);if(t!==void 0){R(i.__webglFramebuffer,e,e.texture,36064,3553)}if(a!==void 0){I(e)}};this.setupRenderTarget=function(t){var s=t.texture,l=r.get(t),d=r.get(s);t.addEventListener("dispose",x);if(!0!==t.isWebGLMultipleRenderTargets){if(d.__webglTexture===void 0){d.__webglTexture=e.createTexture()}d.__version=s.version;o.memory.textures++}var c=!0===t.isWebGLCubeRenderTarget,p=!0===t.isWebGLMultipleRenderTargets,m=s.isDataTexture3D||s.isDataTexture2DArray,y=u(t)||U;if(U&&s.format===tn&&(s.type===Yi||s.type===Zi)){s.format=an;console.warn("THREE.WebGLRenderer: Rendering to textures with RGB format is not supported. Using RGBA format instead.")}if(c){l.__webglFramebuffer=[];for(var F=0;6>F;F++){l.__webglFramebuffer[F]=e.createFramebuffer()}}else{l.__webglFramebuffer=e.createFramebuffer();if(p){if(i.drawBuffers){for(var v=t.texture,_=0,b=v.length,S;_<b;_++){S=r.get(v[_]);if(S.__webglTexture===void 0){S.__webglTexture=e.createTexture();o.memory.textures++}}}else{console.warn("THREE.WebGLRenderer: WebGLMultipleRenderTargets can only be used with WebGL2 or WEBGL_draw_buffers extension.")}}else if(t.useRenderbuffer){if(U){l.__webglMultisampledFramebuffer=e.createFramebuffer();l.__webglColorRenderbuffer=e.createRenderbuffer();e.bindRenderbuffer(36161,l.__webglColorRenderbuffer);var M=n.convert(s.format),T=n.convert(s.type),E=h(s.internalFormat,M,T,s.encoding),A=D(t);e.renderbufferStorageMultisample(36161,A,E,t.width,t.height);a.bindFramebuffer(36160,l.__webglMultisampledFramebuffer);e.framebufferRenderbuffer(36160,36064,36161,l.__webglColorRenderbuffer);e.bindRenderbuffer(36161,null);if(t.depthBuffer){l.__webglDepthRenderbuffer=e.createRenderbuffer();L(l.__webglDepthRenderbuffer,t,!0)}a.bindFramebuffer(36160,null)}else{console.warn("THREE.WebGLRenderer: WebGLMultisampleRenderTarget can only be used with WebGL2.")}}}if(c){a.bindTexture(34067,d.__webglTexture);w(34067,s,y);for(var O=0;6>O;O++){R(l.__webglFramebuffer[O],t,s,36064,34069+O)}if(g(s,y)){f(34067)}a.unbindTexture()}else if(p){for(var k=t.texture,C=0,P=k.length;C<P;C++){var z=k[C],N=r.get(z);a.bindTexture(3553,N.__webglTexture);w(3553,z,y);R(l.__webglFramebuffer,t,z,36064+C,3553);if(g(z,y)){f(3553)}}a.unbindTexture()}else{var B=3553;if(m){if(U){var G=s.isDataTexture3D;B=G?32879:35866}else{console.warn("THREE.DataTexture3D and THREE.DataTexture2DArray only supported with WebGL2.")}}a.bindTexture(B,d.__webglTexture);w(B,s,y);R(l.__webglFramebuffer,t,s,36064,B);if(g(s,y)){f(B)}a.unbindTexture()}if(t.depthBuffer){I(t)}};this.updateRenderTargetMipmap=function(e){for(var t=u(e)||U,i=!0===e.isWebGLMultipleRenderTargets?e.texture:[e.texture],n=0,o=i.length,s;n<o;n++){s=i[n];if(g(s,t)){var l=e.isWebGLCubeRenderTarget?34067:3553,d=r.get(s).__webglTexture;a.bindTexture(l,d);f(l);a.unbindTexture()}}};this.updateMultisampleRenderTarget=function(t){if(t.useRenderbuffer){if(U){var i=t.width,n=t.height,o=16384,s=[36064],l=t.stencilBuffer?33306:36096;if(t.depthBuffer){s.push(l)}if(!t.ignoreDepthForMultisampleCopy){if(t.depthBuffer)o|=256;if(t.stencilBuffer)o|=1024}var d=r.get(t);a.bindFramebuffer(36008,d.__webglMultisampledFramebuffer);a.bindFramebuffer(36009,d.__webglFramebuffer);if(t.ignoreDepthForMultisampleCopy){e.invalidateFramebuffer(36008,[l]);e.invalidateFramebuffer(36009,[l])}e.blitFramebuffer(0,0,i,n,0,0,i,n,o,9728);e.invalidateFramebuffer(36008,s);a.bindFramebuffer(36008,null);a.bindFramebuffer(36009,d.__webglMultisampledFramebuffer)}else{console.warn("THREE.WebGLRenderer: WebGLMultisampleRenderTarget can only be used with WebGL2.")}}};this.setupDepthRenderbuffer=I;this.setupFrameBufferTexture=R;this.safeSetTexture2D=N;this.safeSetTextureCube=F}function It(e,t,a){var r=a.isWebGL2;return{convert:function(e){var a;if(e===Hi)return 5121;if(e===Ji)return 32819;if(e===Qi)return 32820;if(e===Ki)return 33635;if(e===Vi)return 5120;if(e===Wi)return 5122;if(e===ji)return 5123;if(e===qi)return 5124;if(e===Xi)return 5125;if(e===Yi)return 5126;if(e===Zi){if(r)return 5131;a=t.get("OES_texture_half_float");if(null!==a){return a.HALF_FLOAT_OES}else{return null}}if(e===en)return 6406;if(e===tn)return 6407;if(e===an)return 6408;if(e===rn)return 6409;if(e===nn)return 6410;if(e===sn)return 6402;if(e===ln)return 34041;if(e===dn)return 6403;if(e===cn)return 36244;if(e===un)return 33319;if(e===pn)return 33320;if(e===mn)return 36248;if(e===gn)return 36249;if(e===fn||e===hn||e===yn||e===vn){a=t.get("WEBGL_compressed_texture_s3tc");if(null!==a){if(e===fn)return a.COMPRESSED_RGB_S3TC_DXT1_EXT;if(e===hn)return a.COMPRESSED_RGBA_S3TC_DXT1_EXT;if(e===yn)return a.COMPRESSED_RGBA_S3TC_DXT3_EXT;if(e===vn)return a.COMPRESSED_RGBA_S3TC_DXT5_EXT}else{return null}}if(e===_n||e===xn||e===bn||e===Sn){a=t.get("WEBGL_compressed_texture_pvrtc");if(null!==a){if(e===_n)return a.COMPRESSED_RGB_PVRTC_4BPPV1_IMG;if(e===xn)return a.COMPRESSED_RGB_PVRTC_2BPPV1_IMG;if(e===bn)return a.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG;if(e===Sn)return a.COMPRESSED_RGBA_PVRTC_2BPPV1_IMG}else{return null}}if(e===Mn){a=t.get("WEBGL_compressed_texture_etc1");if(null!==a){return a.COMPRESSED_RGB_ETC1_WEBGL}else{return null}}if(e===Tn||e===En){a=t.get("WEBGL_compressed_texture_etc");if(null!==a){if(e===Tn)return a.COMPRESSED_RGB8_ETC2;if(e===En)return a.COMPRESSED_RGBA8_ETC2_EAC}}if(e===wn||e===An||e===kn||e===Cn||e===Rn||e===Ln||e===Pn||e===In||e===Dn||e===zn||e===Nn||e===Fn||e===On||e===Bn||e===Gn||e===Hn||e===Vn||e===Wn||e===jn||e===qn||e===Xn||e===Yn||e===Zn||e===Jn||e===Qn||e===Kn||e===$n||e===eo){a=t.get("WEBGL_compressed_texture_astc");if(null!==a){return e}else{return null}}if(e===Un){a=t.get("EXT_texture_compression_bptc");if(null!==a){return e}else{return null}}if(e===$i){if(r)return 34042;a=t.get("WEBGL_depth_texture");if(null!==a){return a.UNSIGNED_INT_24_8_WEBGL}else{return null}}}}}var Sc=function(e){_inherits(t,e);var a=_createSuper(t);function t(){var e,r=0<arguments.length&&arguments[0]!==void 0?arguments[0]:[];_classCallCheck2(this,t);e=a.call(this);e.cameras=r;return e}return t}(wd);Sc.prototype.isArrayCamera=!0;var Mc=function(e){_inherits(t,e);var a=_createSuper(t);function t(){var e;_classCallCheck2(this,t);e=a.call(this);e.type="Group";return e}return t}(vl);Mc.prototype.isGroup=!0;var Tc={type:"move"},Ec=function(){function e(){_classCallCheck2(this,e);this._targetRay=null;this._grip=null;this._hand=null}_createClass2(e,[{key:"getHandSpace",value:function getHandSpace(){if(null===this._hand){this._hand=new Mc;this._hand.matrixAutoUpdate=!1;this._hand.visible=!1;this._hand.joints={};this._hand.inputState={pinching:!1}}return this._hand}},{key:"getTargetRaySpace",value:function getTargetRaySpace(){if(null===this._targetRay){this._targetRay=new Mc;this._targetRay.matrixAutoUpdate=!1;this._targetRay.visible=!1;this._targetRay.hasLinearVelocity=!1;this._targetRay.linearVelocity=new vs;this._targetRay.hasAngularVelocity=!1;this._targetRay.angularVelocity=new vs}return this._targetRay}},{key:"getGripSpace",value:function getGripSpace(){if(null===this._grip){this._grip=new Mc;this._grip.matrixAutoUpdate=!1;this._grip.visible=!1;this._grip.hasLinearVelocity=!1;this._grip.linearVelocity=new vs;this._grip.hasAngularVelocity=!1;this._grip.angularVelocity=new vs}return this._grip}},{key:"dispatchEvent",value:function dispatchEvent(e){if(null!==this._targetRay){this._targetRay.dispatchEvent(e)}if(null!==this._grip){this._grip.dispatchEvent(e)}if(null!==this._hand){this._hand.dispatchEvent(e)}return this}},{key:"disconnect",value:function disconnect(e){this.dispatchEvent({type:"disconnected",data:e});if(null!==this._targetRay){this._targetRay.visible=!1}if(null!==this._grip){this._grip.visible=!1}if(null!==this._hand){this._hand.visible=!1}return this}},{key:"update",value:function update(e,t,a){var r=null,i=null,n=null,o=this._targetRay,s=this._grip,l=this._hand;if(e&&"visible-blurred"!==t.session.visibilityState){if(null!==o){r=t.getPose(e.targetRaySpace,a);if(null!==r){o.matrix.fromArray(r.transform.matrix);o.matrix.decompose(o.position,o.rotation,o.scale);if(r.linearVelocity){o.hasLinearVelocity=!0;o.linearVelocity.copy(r.linearVelocity)}else{o.hasLinearVelocity=!1}if(r.angularVelocity){o.hasAngularVelocity=!0;o.angularVelocity.copy(r.angularVelocity)}else{o.hasAngularVelocity=!1}this.dispatchEvent(Tc)}}if(l&&e.hand){n=!0;var d=_createForOfIteratorHelper(e.hand.values()),c;try{for(d.s();!(c=d.n()).done;){var u=c.value,p=t.getJointPose(u,a);if(l.joints[u.jointName]===void 0){var v=new Mc;v.matrixAutoUpdate=!1;v.visible=!1;l.joints[u.jointName]=v;l.add(v)}var _=l.joints[u.jointName];if(null!==p){_.matrix.fromArray(p.transform.matrix);_.matrix.decompose(_.position,_.rotation,_.scale);_.jointRadius=p.radius}_.visible=null!==p}}catch(e){d.e(e)}finally{d.f()}var m=l.joints["index-finger-tip"],g=l.joints["thumb-tip"],f=m.position.distanceTo(g.position),h=.02,y=.005;if(l.inputState.pinching&&f>h+y){l.inputState.pinching=!1;this.dispatchEvent({type:"pinchend",handedness:e.handedness,target:this})}else if(!l.inputState.pinching&&f<=h-y){l.inputState.pinching=!0;this.dispatchEvent({type:"pinchstart",handedness:e.handedness,target:this})}}else{if(null!==s&&e.gripSpace){i=t.getPose(e.gripSpace,a);if(null!==i){s.matrix.fromArray(i.transform.matrix);s.matrix.decompose(s.position,s.rotation,s.scale);if(i.linearVelocity){s.hasLinearVelocity=!0;s.linearVelocity.copy(i.linearVelocity)}else{s.hasLinearVelocity=!1}if(i.angularVelocity){s.hasAngularVelocity=!0;s.angularVelocity.copy(i.angularVelocity)}else{s.hasAngularVelocity=!1}}}}}if(null!==o){o.visible=null!==r}if(null!==s){s.visible=null!==i}if(null!==l){l.visible=null!==n}return this}}]);return e}(),wc=function(e){_inherits(t,e);var a=_createSuper(t);function t(e,r,i,n,o,s,l,d,c,u){var p;_classCallCheck2(this,t);u=u!==void 0?u:sn;if(u!==sn&&u!==ln){throw new Error("DepthTexture format must be either THREE.DepthFormat or THREE.DepthStencilFormat")}if(i===void 0&&u===sn)i=ji;if(i===void 0&&u===ln)i=$i;p=a.call(this,null,n,o,s,l,d,u,i,c);p.image={width:e,height:r};p.magFilter=l!==void 0?l:Pi;p.minFilter=d!==void 0?d:Pi;p.flipY=!1;p.generateMipmaps=!1;return p}return t}(ps);wc.prototype.isDepthTexture=!0;var Ac=function(e){_inherits(t,e);var a=_createSuper(t);function t(e,r){var u;_classCallCheck2(this,t);u=a.call(this);var p=_assertThisInitialized(u),m=null,g=1,f=null,h="local-floor",y=e.extensions.has("WEBGL_multisampled_render_to_texture"),v=null,_=null,x=null,b=null,S=!1,M=null,T=r.getContextAttributes(),w=null,A=null,k=[],C=new Map,R=new wd;R.layers.enable(1);R.viewport=new ms;var L=new wd;L.layers.enable(2);L.viewport=new ms;var P=[R,L],I=new Sc;I.layers.enable(1);I.layers.enable(2);var D=null,z=null;u.cameraAutoUpdate=!0;u.enabled=!1;u.isPresenting=!1;u.getController=function(e){var t=k[e];if(t===void 0){t=new Ec;k[e]=t}return t.getTargetRaySpace()};u.getControllerGrip=function(e){var t=k[e];if(t===void 0){t=new Ec;k[e]=t}return t.getGripSpace()};u.getHand=function(e){var t=k[e];if(t===void 0){t=new Ec;k[e]=t}return t.getHandSpace()};function i(e){var t=C.get(e.inputSource);if(t){t.dispatchEvent({type:e.type,data:e.inputSource})}}function n(){C.forEach(function(e,t){e.disconnect(t)});C.clear();D=null;z=null;e.setRenderTarget(w);b=null;x=null;_=null;m=null;A=null;B.stop();p.isPresenting=!1;p.dispatchEvent({type:"sessionend"})}u.setFramebufferScaleFactor=function(e){g=e;if(!0===p.isPresenting){console.warn("THREE.WebXRManager: Cannot change framebuffer scale while presenting.")}};u.setReferenceSpaceType=function(e){h=e;if(!0===p.isPresenting){console.warn("THREE.WebXRManager: Cannot change reference space type while presenting.")}};u.getReferenceSpace=function(){return f};u.getBaseLayer=function(){return null!==x?x:b};u.getBinding=function(){return _};u.getFrame=function(){return M};u.getSession=function(){return m};u.setSession=function(){var t=_asyncToGenerator(regeneratorRuntime.mark(function t(a){var s,l,d,c,u;return regeneratorRuntime.wrap(function(t){while(1){switch(t.prev=t.next){case 0:m=a;if(!(null!==m)){t.next=23;break}w=e.getRenderTarget();m.addEventListener("select",i);m.addEventListener("selectstart",i);m.addEventListener("selectend",i);m.addEventListener("squeeze",i);m.addEventListener("squeezestart",i);m.addEventListener("squeezeend",i);m.addEventListener("end",n);m.addEventListener("inputsourceschange",o);if(!(!0!==T.xrCompatible)){t.next=14;break}t.next=14;return r.makeXRCompatible();case 14:if(m.renderState.layers===void 0||!1===e.capabilities.isWebGL2){s={antialias:m.renderState.layers===void 0?T.antialias:!0,alpha:T.alpha,depth:T.depth,stencil:T.stencil,framebufferScaleFactor:g};b=new XRWebGLLayer(m,r,s);m.updateRenderState({baseLayer:b});A=new gs(b.framebufferWidth,b.framebufferHeight)}else{S=T.antialias;l=null;d=null;c=null;if(T.depth){c=T.stencil?35056:33189;l=T.stencil?ln:sn;d=T.stencil?$i:ji}u={colorFormat:T.alpha||S?32856:32849,depthFormat:c,scaleFactor:g};_=new XRWebGLBinding(m,r);x=_.createProjectionLayer(u);m.updateRenderState({layers:[x]});if(S){A=new hs(x.textureWidth,x.textureHeight,{format:an,type:Hi,depthTexture:new wc(x.textureWidth,x.textureHeight,d,void 0,void 0,void 0,void 0,void 0,void 0,l),stencilBuffer:T.stencil,ignoreDepth:x.ignoreDepthValues,useRenderToTexture:y})}else{A=new gs(x.textureWidth,x.textureHeight,{format:T.alpha?an:tn,type:Hi,depthTexture:new wc(x.textureWidth,x.textureHeight,d,void 0,void 0,void 0,void 0,void 0,void 0,l),stencilBuffer:T.stencil,ignoreDepth:x.ignoreDepthValues})}}this.setFoveation(0);t.next=18;return m.requestReferenceSpace(h);case 18:f=t.sent;B.setContext(m);B.start();p.isPresenting=!0;p.dispatchEvent({type:"sessionstart"});case 23:case"end":return t.stop();}}},t,this)}));return function(){return t.apply(this,arguments)}}();function o(e){for(var t=m.inputSources,a=0;a<k.length;a++){C.set(t[a],k[a])}for(var s=0;s<e.removed.length;s++){var r=e.removed[s],i=C.get(r);if(i){i.dispatchEvent({type:"disconnected",data:r});C.delete(r)}}for(var l=0;l<e.added.length;l++){var n=e.added[l],o=C.get(n);if(o){o.dispatchEvent({type:"connected",data:n})}}}var N=new vs,F=new vs;function s(e,t,a){N.setFromMatrixPosition(t.matrixWorld);F.setFromMatrixPosition(a.matrixWorld);var r=N.distanceTo(F),i=t.projectionMatrix.elements,n=a.projectionMatrix.elements,o=i[14]/(i[10]-1),s=i[14]/(i[10]+1),l=(i[9]+1)/i[5],d=(i[9]-1)/i[5],c=(i[8]-1)/i[0],u=(n[8]+1)/n[0],p=r/(-c+u),m=p*-c;t.matrixWorld.decompose(e.position,e.quaternion,e.scale);e.translateX(m);e.translateZ(p);e.matrixWorld.compose(e.position,e.quaternion,e.scale);e.matrixWorldInverse.copy(e.matrixWorld).invert();var g=o+p,f=s+p;e.projectionMatrix.makePerspective(o*c-m,o*u+(r-m),l*s/f*g,d*s/f*g,g,f)}function d(e,t){if(null===t){e.matrixWorld.copy(e.matrix)}else{e.matrixWorld.multiplyMatrices(t.matrixWorld,e.matrix)}e.matrixWorldInverse.copy(e.matrixWorld).invert()}u.updateCamera=function(e){if(null===m)return;I.near=L.near=R.near=e.near;I.far=L.far=R.far=e.far;if(D!==I.near||z!==I.far){m.updateRenderState({depthNear:I.near,depthFar:I.far});D=I.near;z=I.far}var t=e.parent,a=I.cameras;d(I,t);for(var o=0;o<a.length;o++){d(a[o],t)}I.matrixWorld.decompose(I.position,I.quaternion,I.scale);e.position.copy(I.position);e.quaternion.copy(I.quaternion);e.scale.copy(I.scale);e.matrix.copy(I.matrix);e.matrixWorld.copy(I.matrixWorld);for(var r=e.children,i=0,n=r.length;i<n;i++){r[i].updateMatrixWorld(!0)}if(2===a.length){s(I,R,L)}else{I.projectionMatrix.copy(R.projectionMatrix)}};u.getCamera=function(){return I};u.getFoveation=function(){if(null!==x){return x.fixedFoveation}if(null!==b){return b.fixedFoveation}};u.setFoveation=function(e){if(null!==x){x.fixedFoveation=e}if(null!==b&&b.fixedFoveation!==void 0){b.fixedFoveation=e}};var O=null;function c(t,a){v=a.getViewerPose(f);M=a;if(null!==v){var d=v.views;if(null!==b){e.setRenderTargetFramebuffer(A,b.framebuffer);e.setRenderTarget(A)}var c=!1;if(d.length!==I.cameras.length){I.cameras.length=0;c=!0}for(var u=0;u<d.length;u++){var r=d[u],i=null;if(null!==b){i=b.getViewport(r)}else{var p=_.getViewSubImage(x,r);i=p.viewport;if(0===u){e.setRenderTargetTextures(A,p.colorTexture,x.ignoreDepthValues?void 0:p.depthStencilTexture);e.setRenderTarget(A)}}var g=P[u];g.matrix.fromArray(r.transform.matrix);g.projectionMatrix.fromArray(r.projectionMatrix);g.viewport.set(i.x,i.y,i.width,i.height);if(0==u){I.matrix.copy(g.matrix)}if(!0===c){I.cameras.push(g)}}}for(var n=m.inputSources,o=0;o<k.length;o++){var s=k[o],l=n[o];s.update(l,a,f)}if(O)O(t,a);M=null}var B=new E;B.setAnimationLoop(c);u.setAnimationLoop=function(e){O=e};u.dispose=function(){};return u}return t}(es);function Dt(e){function t(t,a){t.opacity.value=a.opacity;if(a.color){t.diffuse.value.copy(a.color)}if(a.emissive){t.emissive.value.copy(a.emissive).multiplyScalar(a.emissiveIntensity)}if(a.map){t.map.value=a.map}if(a.alphaMap){t.alphaMap.value=a.alphaMap}if(a.specularMap){t.specularMap.value=a.specularMap}if(0<a.alphaTest){t.alphaTest.value=a.alphaTest}var r=e.get(a).envMap;if(r){t.envMap.value=r;t.flipEnvMap.value=r.isCubeTexture&&!1===r.isRenderTargetTexture?-1:1;t.reflectivity.value=a.reflectivity;t.ior.value=a.ior;t.refractionRatio.value=a.refractionRatio}if(a.lightMap){t.lightMap.value=a.lightMap;t.lightMapIntensity.value=a.lightMapIntensity}if(a.aoMap){t.aoMap.value=a.aoMap;t.aoMapIntensity.value=a.aoMapIntensity}var i;if(a.map){i=a.map}else if(a.specularMap){i=a.specularMap}else if(a.displacementMap){i=a.displacementMap}else if(a.normalMap){i=a.normalMap}else if(a.bumpMap){i=a.bumpMap}else if(a.roughnessMap){i=a.roughnessMap}else if(a.metalnessMap){i=a.metalnessMap}else if(a.alphaMap){i=a.alphaMap}else if(a.emissiveMap){i=a.emissiveMap}else if(a.clearcoatMap){i=a.clearcoatMap}else if(a.clearcoatNormalMap){i=a.clearcoatNormalMap}else if(a.clearcoatRoughnessMap){i=a.clearcoatRoughnessMap}else if(a.specularIntensityMap){i=a.specularIntensityMap}else if(a.specularColorMap){i=a.specularColorMap}else if(a.transmissionMap){i=a.transmissionMap}else if(a.thicknessMap){i=a.thicknessMap}else if(a.sheenColorMap){i=a.sheenColorMap}else if(a.sheenRoughnessMap){i=a.sheenRoughnessMap}if(i!==void 0){if(i.isWebGLRenderTarget){i=i.texture}if(!0===i.matrixAutoUpdate){i.updateMatrix()}t.uvTransform.value.copy(i.matrix)}var n;if(a.aoMap){n=a.aoMap}else if(a.lightMap){n=a.lightMap}if(n!==void 0){if(n.isWebGLRenderTarget){n=n.texture}if(!0===n.matrixAutoUpdate){n.updateMatrix()}t.uv2Transform.value.copy(n.matrix)}}function a(e,t){e.diffuse.value.copy(t.color);e.opacity.value=t.opacity}function r(e,t){e.dashSize.value=t.dashSize;e.totalSize.value=t.dashSize+t.gapSize;e.scale.value=t.scale}function i(e,t,a,r){e.diffuse.value.copy(t.color);e.opacity.value=t.opacity;e.size.value=t.size*a;e.scale.value=.5*r;if(t.map){e.map.value=t.map}if(t.alphaMap){e.alphaMap.value=t.alphaMap}if(0<t.alphaTest){e.alphaTest.value=t.alphaTest}var i;if(t.map){i=t.map}else if(t.alphaMap){i=t.alphaMap}if(i!==void 0){if(!0===i.matrixAutoUpdate){i.updateMatrix()}e.uvTransform.value.copy(i.matrix)}}function n(e,t){e.diffuse.value.copy(t.color);e.opacity.value=t.opacity;e.rotation.value=t.rotation;if(t.map){e.map.value=t.map}if(t.alphaMap){e.alphaMap.value=t.alphaMap}if(0<t.alphaTest){e.alphaTest.value=t.alphaTest}var a;if(t.map){a=t.map}else if(t.alphaMap){a=t.alphaMap}if(a!==void 0){if(!0===a.matrixAutoUpdate){a.updateMatrix()}e.uvTransform.value.copy(a.matrix)}}function o(e,t){if(t.emissiveMap){e.emissiveMap.value=t.emissiveMap}}function s(e,t){e.specular.value.copy(t.specular);e.shininess.value=Math.max(t.shininess,1e-4);if(t.emissiveMap){e.emissiveMap.value=t.emissiveMap}if(t.bumpMap){e.bumpMap.value=t.bumpMap;e.bumpScale.value=t.bumpScale;if(t.side===Ir)e.bumpScale.value*=-1}if(t.normalMap){e.normalMap.value=t.normalMap;e.normalScale.value.copy(t.normalScale);if(t.side===Ir)e.normalScale.value.negate()}if(t.displacementMap){e.displacementMap.value=t.displacementMap;e.displacementScale.value=t.displacementScale;e.displacementBias.value=t.displacementBias}}function l(e,t){if(t.gradientMap){e.gradientMap.value=t.gradientMap}if(t.emissiveMap){e.emissiveMap.value=t.emissiveMap}if(t.bumpMap){e.bumpMap.value=t.bumpMap;e.bumpScale.value=t.bumpScale;if(t.side===Ir)e.bumpScale.value*=-1}if(t.normalMap){e.normalMap.value=t.normalMap;e.normalScale.value.copy(t.normalScale);if(t.side===Ir)e.normalScale.value.negate()}if(t.displacementMap){e.displacementMap.value=t.displacementMap;e.displacementScale.value=t.displacementScale;e.displacementBias.value=t.displacementBias}}function d(t,a){t.roughness.value=a.roughness;t.metalness.value=a.metalness;if(a.roughnessMap){t.roughnessMap.value=a.roughnessMap}if(a.metalnessMap){t.metalnessMap.value=a.metalnessMap}if(a.emissiveMap){t.emissiveMap.value=a.emissiveMap}if(a.bumpMap){t.bumpMap.value=a.bumpMap;t.bumpScale.value=a.bumpScale;if(a.side===Ir)t.bumpScale.value*=-1}if(a.normalMap){t.normalMap.value=a.normalMap;t.normalScale.value.copy(a.normalScale);if(a.side===Ir)t.normalScale.value.negate()}if(a.displacementMap){t.displacementMap.value=a.displacementMap;t.displacementScale.value=a.displacementScale;t.displacementBias.value=a.displacementBias}var r=e.get(a).envMap;if(r){t.envMapIntensity.value=a.envMapIntensity}}function c(e,t,a){d(e,t);e.ior.value=t.ior;if(0<t.sheen){e.sheenColor.value.copy(t.sheenColor).multiplyScalar(t.sheen);e.sheenRoughness.value=t.sheenRoughness;if(t.sheenColorMap){e.sheenColorMap.value=t.sheenColorMap}if(t.sheenRoughnessMap){e.sheenRoughnessMap.value=t.sheenRoughnessMap}}if(0<t.clearcoat){e.clearcoat.value=t.clearcoat;e.clearcoatRoughness.value=t.clearcoatRoughness;if(t.clearcoatMap){e.clearcoatMap.value=t.clearcoatMap}if(t.clearcoatRoughnessMap){e.clearcoatRoughnessMap.value=t.clearcoatRoughnessMap}if(t.clearcoatNormalMap){e.clearcoatNormalScale.value.copy(t.clearcoatNormalScale);e.clearcoatNormalMap.value=t.clearcoatNormalMap;if(t.side===Ir){e.clearcoatNormalScale.value.negate()}}}if(0<t.transmission){e.transmission.value=t.transmission;e.transmissionSamplerMap.value=a.texture;e.transmissionSamplerSize.value.set(a.width,a.height);if(t.transmissionMap){e.transmissionMap.value=t.transmissionMap}e.thickness.value=t.thickness;if(t.thicknessMap){e.thicknessMap.value=t.thicknessMap}e.attenuationDistance.value=t.attenuationDistance;e.attenuationColor.value.copy(t.attenuationColor)}e.specularIntensity.value=t.specularIntensity;e.specularColor.value.copy(t.specularColor);if(t.specularIntensityMap){e.specularIntensityMap.value=t.specularIntensityMap}if(t.specularColorMap){e.specularColorMap.value=t.specularColorMap}}function u(e,t){if(t.matcap){e.matcap.value=t.matcap}if(t.bumpMap){e.bumpMap.value=t.bumpMap;e.bumpScale.value=t.bumpScale;if(t.side===Ir)e.bumpScale.value*=-1}if(t.normalMap){e.normalMap.value=t.normalMap;e.normalScale.value.copy(t.normalScale);if(t.side===Ir)e.normalScale.value.negate()}if(t.displacementMap){e.displacementMap.value=t.displacementMap;e.displacementScale.value=t.displacementScale;e.displacementBias.value=t.displacementBias}}function p(e,t){if(t.displacementMap){e.displacementMap.value=t.displacementMap;e.displacementScale.value=t.displacementScale;e.displacementBias.value=t.displacementBias}}function m(e,t){if(t.displacementMap){e.displacementMap.value=t.displacementMap;e.displacementScale.value=t.displacementScale;e.displacementBias.value=t.displacementBias}e.referencePosition.value.copy(t.referencePosition);e.nearDistance.value=t.nearDistance;e.farDistance.value=t.farDistance}function g(e,t){if(t.bumpMap){e.bumpMap.value=t.bumpMap;e.bumpScale.value=t.bumpScale;if(t.side===Ir)e.bumpScale.value*=-1}if(t.normalMap){e.normalMap.value=t.normalMap;e.normalScale.value.copy(t.normalScale);if(t.side===Ir)e.normalScale.value.negate()}if(t.displacementMap){e.displacementMap.value=t.displacementMap;e.displacementScale.value=t.displacementScale;e.displacementBias.value=t.displacementBias}}return{refreshFogUniforms:function(e,t){e.fogColor.value.copy(t.color);if(t.isFog){e.fogNear.value=t.near;e.fogFar.value=t.far}else if(t.isFogExp2){e.fogDensity.value=t.density}},refreshMaterialUniforms:function(e,f,h,y,v){if(f.isMeshBasicMaterial){t(e,f)}else if(f.isMeshLambertMaterial){t(e,f);o(e,f)}else if(f.isMeshToonMaterial){t(e,f);l(e,f)}else if(f.isMeshPhongMaterial){t(e,f);s(e,f)}else if(f.isMeshStandardMaterial){t(e,f);if(f.isMeshPhysicalMaterial){c(e,f,v)}else{d(e,f)}}else if(f.isMeshMatcapMaterial){t(e,f);u(e,f)}else if(f.isMeshDepthMaterial){t(e,f);p(e,f)}else if(f.isMeshDistanceMaterial){t(e,f);m(e,f)}else if(f.isMeshNormalMaterial){t(e,f);g(e,f)}else if(f.isLineBasicMaterial){a(e,f);if(f.isLineDashedMaterial){r(e,f)}}else if(f.isPointsMaterial){i(e,f,h,y)}else if(f.isSpriteMaterial){n(e,f)}else if(f.isShadowMaterial){e.color.value.copy(f.color);e.opacity.value=f.opacity}else if(f.isShaderMaterial){f.uniformsNeedUpdate=!1}}}}function zt(){var e=m("canvas");e.style.display="block";return e}function Nt(){var b=0<arguments.length&&arguments[0]!==void 0?arguments[0]:{},S=b.canvas!==void 0?b.canvas:zt(),M=b.context!==void 0?b.context:null,T=b.alpha!==void 0?b.alpha:!1,w=b.depth!==void 0?b.depth:!0,D=b.stencil!==void 0?b.stencil:!0,z=b.antialias!==void 0?b.antialias:!1,N=b.premultipliedAlpha!==void 0?b.premultipliedAlpha:!0,F=b.preserveDrawingBuffer!==void 0?b.preserveDrawingBuffer:!1,O=b.powerPreference!==void 0?b.powerPreference:"default",B=b.failIfMajorPerformanceCaveat!==void 0?b.failIfMajorPerformanceCaveat:!1,U=null,G=null,X=[],Y=[];this.domElement=S;this.debug={checkShaderErrors:!0};this.autoClear=!0;this.autoClearColor=!0;this.autoClearDepth=!0;this.autoClearStencil=!0;this.sortObjects=!0;this.clippingPlanes=[];this.localClippingEnabled=!1;this.gammaFactor=2;this.outputEncoding=ho;this.physicallyCorrectLights=!1;this.toneMapping=hi;this.toneMappingExposure=1;var Z=this,K=!1,$=0,ee=0,te=null,ae=-1,re=null,ie=new ms,ne=new ms,oe=null,se=S.width,le=S.height,de=1,ce=null,ue=null,pe=new ms(0,0,se,le),me=new ms(0,0,se,le),ge=!1,fe=[],he=new Nd,ye=!1,ve=!1,_e=null,xe=new Ys,be=new vs,Se={background:null,fog:null,environment:null,overrideMaterial:null,isScene:!0};function e(){return null===te?de:1}var Me=M;function t(e,t){for(var i=0;i<e.length;i++){var a=e[i],r=S.getContext(a,t);if(null!==r)return r}return null}try{if("setAttribute"in S)S.setAttribute("data-engine","three.js r".concat(br));S.addEventListener("webglcontextlost",r,!1);S.addEventListener("webglcontextrestored",i,!1);if(null===Me){var Qe=["webgl2","webgl","experimental-webgl"];if(!0===Z.isWebGL1Renderer){Qe.shift()}Me=t(Qe,{alpha:T,depth:w,stencil:D,antialias:z,premultipliedAlpha:N,preserveDrawingBuffer:F,powerPreference:O,failIfMajorPerformanceCaveat:B});if(null===Me){if(t(Qe)){throw new Error("Error creating WebGL context with your selected attributes.")}else{throw new Error("Error creating WebGL context.")}}}if(Me.getShaderPrecisionFormat===void 0){Me.getShaderPrecisionFormat=function(){return{rangeMin:1,rangeMax:1,precision:1}}}}catch(e){console.error("THREE.WebGLRenderer: "+e.message);throw e}var Te,Ee,we,Ae,ke,Ce,Re,Le,Pe,Ie,De,ze,Ne,Fe,Oe,Be,Ue,Ge,He,Ve,We,je,qe;function a(){Te=new V(Me);Ee=new L(Me,Te,b);Te.init(Ee);je=new It(Me,Te,Ee);we=new Lt(Me,Te,Ee);fe[0]=1029;Ae=new q(Me);ke=new _t;Ce=new Pt(Me,Te,we,ke,Ee,je,Ae);Re=new I(Z);Le=new H(Z);Pe=new A(Me,Ee);qe=new C(Me,Te,Pe,Ee);Ie=new W(Me,Pe,Ae,qe);De=new Q(Me,Ie,Pe,Ae);He=new J(Me,Ee,Ce);Be=new P(ke);ze=new vt(Z,Re,Le,Te,Ee,qe,Be);Ne=new Dt(ke);Fe=new Mt(ke);Oe=new Ct(Te,Ee);Ge=new k(Z,Re,we,De,N);Ue=new Rt(Z,De,Ee);Ve=new R(Me,Te,Ae,Ee);We=new j(Me,Te,Ae,Ee);Ae.programs=ze.programs;Z.capabilities=Ee;Z.extensions=Te;Z.properties=ke;Z.renderLists=Fe;Z.shadowMap=Ue;Z.state=we;Z.info=Ae}a();var Ye=new Ac(Z,Me);this.xr=Ye;this.getContext=function(){return Me};this.getContextAttributes=function(){return Me.getContextAttributes()};this.forceContextLoss=function(){var e=Te.get("WEBGL_lose_context");if(e)e.loseContext()};this.forceContextRestore=function(){var e=Te.get("WEBGL_lose_context");if(e)e.restoreContext()};this.getPixelRatio=function(){return de};this.setPixelRatio=function(e){if(e===void 0)return;de=e;this.setSize(se,le,!1)};this.getSize=function(e){return e.set(se,le)};this.setSize=function(e,t,a){if(Ye.isPresenting){console.warn("THREE.WebGLRenderer: Can't change size while VR device is presenting.");return}se=e;le=t;S.width=Math.floor(e*de);S.height=Math.floor(t*de);if(!1!==a){S.style.width=e+"px";S.style.height=t+"px"}this.setViewport(0,0,e,t)};this.getDrawingBufferSize=function(e){return e.set(se*de,le*de).floor()};this.setDrawingBufferSize=function(e,t,a){se=e;le=t;de=a;S.width=Math.floor(e*a);S.height=Math.floor(t*a);this.setViewport(0,0,e,t)};this.getCurrentViewport=function(e){return e.copy(ie)};this.getViewport=function(e){return e.copy(pe)};this.setViewport=function(e,t,a,r){if(e.isVector4){pe.set(e.x,e.y,e.z,e.w)}else{pe.set(e,t,a,r)}we.viewport(ie.copy(pe).multiplyScalar(de).floor())};this.getScissor=function(e){return e.copy(me)};this.setScissor=function(e,t,a,r){if(e.isVector4){me.set(e.x,e.y,e.z,e.w)}else{me.set(e,t,a,r)}we.scissor(ne.copy(me).multiplyScalar(de).floor())};this.getScissorTest=function(){return ge};this.setScissorTest=function(e){we.setScissorTest(ge=e)};this.setOpaqueSort=function(e){ce=e};this.setTransparentSort=function(e){ue=e};this.getClearColor=function(e){return e.copy(Ge.getClearColor())};this.setClearColor=function(){Ge.setClearColor.apply(Ge,arguments)};this.getClearAlpha=function(){return Ge.getClearAlpha()};this.setClearAlpha=function(){Ge.setClearAlpha.apply(Ge,arguments)};this.clear=function(e,t,a){var r=0;if(e===void 0||e)r|=16384;if(t===void 0||t)r|=256;if(a===void 0||a)r|=1024;Me.clear(r)};this.clearColor=function(){this.clear(!0,!1,!1)};this.clearDepth=function(){this.clear(!1,!0,!1)};this.clearStencil=function(){this.clear(!1,!1,!0)};this.dispose=function(){S.removeEventListener("webglcontextlost",r,!1);S.removeEventListener("webglcontextrestored",i,!1);Fe.dispose();Oe.dispose();ke.dispose();Re.dispose();Le.dispose();De.dispose();qe.dispose();Ye.dispose();Ye.removeEventListener("sessionstart",d);Ye.removeEventListener("sessionend",c);if(_e){_e.dispose();_e=null}Je.stop()};function r(e){e.preventDefault();console.log("THREE.WebGLRenderer: Context Lost.");K=!0}function i(){console.log("THREE.WebGLRenderer: Context Restored.");K=!1;var e=Ae.autoReset,t=Ue.enabled,r=Ue.autoUpdate,i=Ue.needsUpdate,n=Ue.type;a();Ae.autoReset=e;Ue.enabled=t;Ue.autoUpdate=r;Ue.needsUpdate=i;Ue.type=n}function n(e){var t=e.target;t.removeEventListener("dispose",n);o(t)}function o(e){s(e);ke.remove(e)}function s(e){var t=ke.get(e).programs;if(t!==void 0){t.forEach(function(e){ze.releaseProgram(e)})}}this.renderBufferDirect=function(t,a,r,i,n,o){if(null===a)a=Se;var s=n.isMesh&&0>n.matrixWorld.determinant(),l=v(t,a,r,i,n);we.setMaterial(i,s);var d=r.index,c=r.attributes.position;if(null===d){if(c===void 0||0===c.count)return}else if(0===d.count){return}var u=1;if(!0===i.wireframe){d=Ie.getWireframeAttribute(r);u=2}qe.setup(n,i,l,r,d);var p,m=Ve;if(null!==d){p=Pe.get(d);m=We;m.setIndex(p)}var g=null!==d?d.count:c.count,f=r.drawRange.start*u,h=r.drawRange.count*u,y=null!==o?o.start*u:0,_=null!==o?o.count*u:1/0,x=Math.max(f,y),b=Math.min(g,f+h,y+_)-1,S=Math.max(0,b-x+1);if(0===S)return;if(n.isMesh){if(!0===i.wireframe){we.setLineWidth(i.wireframeLinewidth*e());m.setMode(1)}else{m.setMode(4)}}else if(n.isLine){var M=i.linewidth;if(M===void 0)M=1;we.setLineWidth(M*e());if(n.isLineSegments){m.setMode(1)}else if(n.isLineLoop){m.setMode(2)}else{m.setMode(3)}}else if(n.isPoints){m.setMode(0)}else if(n.isSprite){m.setMode(4)}if(n.isInstancedMesh){m.renderInstances(x,S,n.count)}else if(r.isInstancedBufferGeometry){var T=Math.min(r.instanceCount,r._maxInstanceCount);m.renderInstances(x,S,T)}else{m.render(x,S)}};this.compile=function(e,t){G=Oe.get(e);G.init();Y.push(G);e.traverseVisible(function(e){if(e.isLight&&e.layers.test(t.layers)){G.pushLight(e);if(e.castShadow){G.pushShadow(e)}}});G.setupLights(Z.physicallyCorrectLights);e.traverse(function(t){var a=t.material;if(a){if(Array.isArray(a)){for(var r=0,i;r<a.length;r++){i=a[r];h(i,e,t)}}else{h(a,e,t)}}});Y.pop();G=null};var Ze=null;function l(e){if(Ze)Ze(e)}function d(){Je.stop()}function c(){Je.start()}var Je=new E;Je.setAnimationLoop(l);if("undefined"!=typeof window)Je.setContext(window);this.setAnimationLoop=function(e){Ze=e;Ye.setAnimationLoop(e);null===e?Je.stop():Je.start()};Ye.addEventListener("sessionstart",d);Ye.addEventListener("sessionend",c);this.render=function(e,t){if(t!==void 0&&!0!==t.isCamera){console.error("THREE.WebGLRenderer.render: camera is not an instance of THREE.Camera.");return}if(!0===K)return;if(!0===e.autoUpdate)e.updateMatrixWorld();if(null===t.parent)t.updateMatrixWorld();if(!0===Ye.enabled&&!0===Ye.isPresenting){if(!0===Ye.cameraAutoUpdate)Ye.updateCamera(t);t=Ye.getCamera()}if(!0===e.isScene)e.onBeforeRender(Z,e,t,te);G=Oe.get(e,Y.length);G.init();Y.push(G);xe.multiplyMatrices(t.projectionMatrix,t.matrixWorldInverse);he.setFromProjectionMatrix(xe);ve=this.localClippingEnabled;ye=Be.init(this.clippingPlanes,ve,t);U=Fe.get(e,X.length);U.init();X.push(U);u(e,t,0,Z.sortObjects);U.finish();if(!0===Z.sortObjects){U.sort(ce,ue)}if(!0===ye)Be.beginShadows();var a=G.state.shadowsArray;Ue.render(a,e,t);if(!0===ye)Be.endShadows();if(!0===this.info.autoReset)this.info.reset();Ge.render(U,e);G.setupLights(Z.physicallyCorrectLights);if(t.isArrayCamera){for(var r=t.cameras,i=0,n=r.length,o;i<n;i++){o=r[i];p(U,e,o,o.viewport)}}else{p(U,e,t)}if(null!==te){Ce.updateMultisampleRenderTarget(te);Ce.updateRenderTargetMipmap(te)}if(!0===e.isScene)e.onAfterRender(Z,e,t);we.buffers.depth.setTest(!0);we.buffers.depth.setMask(!0);we.buffers.color.setMask(!0);we.setPolygonOffset(!1);qe.resetDefaultState();ae=-1;re=null;Y.pop();if(0<Y.length){G=Y[Y.length-1]}else{G=null}X.pop();if(0<X.length){U=X[X.length-1]}else{U=null}};function u(e,t,a,r){if(!1===e.visible)return;var i=e.layers.test(t.layers);if(i){if(e.isGroup){a=e.renderOrder}else if(e.isLOD){if(!0===e.autoUpdate)e.update(t)}else if(e.isLight){G.pushLight(e);if(e.castShadow){G.pushShadow(e)}}else if(e.isSprite){if(!e.frustumCulled||he.intersectsSprite(e)){if(r){be.setFromMatrixPosition(e.matrixWorld).applyMatrix4(xe)}var n=De.update(e),o=e.material;if(o.visible){U.push(e,n,o,a,be.z,null)}}}else if(e.isMesh||e.isLine||e.isPoints){if(e.isSkinnedMesh){if(e.skeleton.frame!==Ae.render.frame){e.skeleton.update();e.skeleton.frame=Ae.render.frame}}if(!e.frustumCulled||he.intersectsObject(e)){if(r){be.setFromMatrixPosition(e.matrixWorld).applyMatrix4(xe)}var s=De.update(e),d=e.material;if(Array.isArray(d)){for(var c=s.groups,p=0,m=c.length;p<m;p++){var l=c[p],g=d[l.materialIndex];if(g&&g.visible){U.push(e,s,g,a,be.z,l)}}}else if(d.visible){U.push(e,s,d,a,be.z,null)}}}}for(var f=e.children,h=0,y=f.length;h<y;h++){u(f[h],t,a,r)}}function p(e,t,a,r){var i=e.opaque,n=e.transmissive,o=e.transparent;G.setupLightsView(a);if(0<n.length)m(i,t,a);if(r)we.viewport(ie.copy(r));if(0<i.length)g(i,t,a);if(0<n.length)g(n,t,a);if(0<o.length)g(o,t,a)}function m(e,t,a){if(null===_e){var r=!0===z&&!0===Ee.isWebGL2,i=r?hs:gs;_e=new i(1024,1024,{generateMipmaps:!0,type:null!==je.convert(Zi)?Zi:Hi,minFilter:Ui,magFilter:Pi,wrapS:Ri,wrapT:Ri,useRenderToTexture:Te.has("WEBGL_multisampled_render_to_texture")})}var n=Z.getRenderTarget();Z.setRenderTarget(_e);Z.clear();var o=Z.toneMapping;Z.toneMapping=hi;g(e,t,a);Z.toneMapping=o;Ce.updateMultisampleRenderTarget(_e);Ce.updateRenderTargetMipmap(_e);Z.setRenderTarget(n)}function g(e,t,a){for(var r=!0===t.isScene?t.overrideMaterial:null,i=0,n=e.length;i<n;i++){var o=e[i],s=o.object,l=o.geometry,d=null===r?o.material:r,c=o.group;if(s.layers.test(a.layers)){f(s,t,a,l,d,c)}}}function f(e,t,a,r,i,n){e.onBeforeRender(Z,t,a,r,i,n);e.modelViewMatrix.multiplyMatrices(a.matrixWorldInverse,e.matrixWorld);e.normalMatrix.getNormalMatrix(e.modelViewMatrix);i.onBeforeRender(Z,t,a,r,e,n);if(!0===i.transparent&&i.side===Dr){i.side=Ir;i.needsUpdate=!0;Z.renderBufferDirect(a,t,r,i,e,n);i.side=Pr;i.needsUpdate=!0;Z.renderBufferDirect(a,t,r,i,e,n);i.side=Dr}else{Z.renderBufferDirect(a,t,r,i,e,n)}e.onAfterRender(Z,t,a,r,i,n)}function h(e,t,a){if(!0!==t.isScene)t=Se;var r=ke.get(e),i=G.state.lights,o=G.state.shadowsArray,s=i.state.version,l=ze.getParameters(e,i.state,o,t,a),d=ze.getProgramCacheKey(l),c=r.programs;r.environment=e.isMeshStandardMaterial?t.environment:null;r.fog=t.fog;r.envMap=(e.isMeshStandardMaterial?Le:Re).get(e.envMap||r.environment);if(c===void 0){e.addEventListener("dispose",n);c=new Map;r.programs=c}var u=c.get(d);if(u!==void 0){if(r.currentProgram===u&&r.lightsStateVersion===s){y(e,l);return u}}else{l.uniforms=ze.getUniforms(e);e.onBuild(a,l,Z);e.onBeforeCompile(l,Z);u=ze.acquireProgram(l,d);c.set(d,u);r.uniforms=l.uniforms}var p=r.uniforms;if(!e.isShaderMaterial&&!e.isRawShaderMaterial||!0===e.clipping){p.clippingPlanes=Be.uniform}y(e,l);r.needsLights=x(e);r.lightsStateVersion=s;if(r.needsLights){p.ambientLightColor.value=i.state.ambient;p.lightProbe.value=i.state.probe;p.directionalLights.value=i.state.directional;p.directionalLightShadows.value=i.state.directionalShadow;p.spotLights.value=i.state.spot;p.spotLightShadows.value=i.state.spotShadow;p.rectAreaLights.value=i.state.rectArea;p.ltc_1.value=i.state.rectAreaLTC1;p.ltc_2.value=i.state.rectAreaLTC2;p.pointLights.value=i.state.point;p.pointLightShadows.value=i.state.pointShadow;p.hemisphereLights.value=i.state.hemi;p.directionalShadowMap.value=i.state.directionalShadowMap;p.directionalShadowMatrix.value=i.state.directionalShadowMatrix;p.spotShadowMap.value=i.state.spotShadowMap;p.spotShadowMatrix.value=i.state.spotShadowMatrix;p.pointShadowMap.value=i.state.pointShadowMap;p.pointShadowMatrix.value=i.state.pointShadowMatrix}var m=u.getUniforms(),g=Xe.seqWithValue(m.seq,p);r.currentProgram=u;r.uniformsList=g;return u}function y(e,t){var a=ke.get(e);a.outputEncoding=t.outputEncoding;a.instancing=t.instancing;a.skinning=t.skinning;a.morphTargets=t.morphTargets;a.morphNormals=t.morphNormals;a.morphTargetsCount=t.morphTargetsCount;a.numClippingPlanes=t.numClippingPlanes;a.numIntersection=t.numClipIntersection;a.vertexAlphas=t.vertexAlphas;a.vertexTangents=t.vertexTangents}function v(e,t,a,r,i){if(!0!==t.isScene)t=Se;Ce.resetTextureUnits();var n=t.fog,o=r.isMeshStandardMaterial?t.environment:null,s=null===te?Z.outputEncoding:te.texture.encoding,l=(r.isMeshStandardMaterial?Le:Re).get(r.envMap||o),d=!0===r.vertexColors&&!!a.attributes.color&&4===a.attributes.color.itemSize,c=!!r.normalMap&&!!a.attributes.tangent,u=!!a.morphAttributes.position,p=!!a.morphAttributes.normal,m=!!a.morphAttributes.position?a.morphAttributes.position.length:0,g=ke.get(r),f=G.state.lights;if(!0===ye){if(!0===ve||e!==re){var E=e===re&&r.id===ae;Be.setState(r,e,E)}}var y=!1;if(r.version===g.__version){if(g.needsLights&&g.lightsStateVersion!==f.state.version){y=!0}else if(g.outputEncoding!==s){y=!0}else if(i.isInstancedMesh&&!1===g.instancing){y=!0}else if(!i.isInstancedMesh&&!0===g.instancing){y=!0}else if(i.isSkinnedMesh&&!1===g.skinning){y=!0}else if(!i.isSkinnedMesh&&!0===g.skinning){y=!0}else if(g.envMap!==l){y=!0}else if(r.fog&&g.fog!==n){y=!0}else if(g.numClippingPlanes!==void 0&&(g.numClippingPlanes!==Be.numPlanes||g.numIntersection!==Be.numIntersection)){y=!0}else if(g.vertexAlphas!==d){y=!0}else if(g.vertexTangents!==c){y=!0}else if(g.morphTargets!==u){y=!0}else if(g.morphNormals!==p){y=!0}else if(!0===Ee.isWebGL2&&g.morphTargetsCount!==m){y=!0}}else{y=!0;g.__version=r.version}var v=g.currentProgram;if(!0==y){v=h(r,t,i)}var x=!1,b=!1,S=!1,M=v.getUniforms(),T=g.uniforms;if(we.useProgram(v.program)){x=!0;b=!0;S=!0}if(r.id!==ae){ae=r.id;b=!0}if(x||re!==e){M.setValue(Me,"projectionMatrix",e.projectionMatrix);if(Ee.logarithmicDepthBuffer){M.setValue(Me,"logDepthBufFC",2/(Math.log(e.far+1)/Math.LN2))}if(re!==e){re=e;b=!0;S=!0}if(r.isShaderMaterial||r.isMeshPhongMaterial||r.isMeshToonMaterial||r.isMeshStandardMaterial||r.envMap){var w=M.map.cameraPosition;if(w!==void 0){w.setValue(Me,be.setFromMatrixPosition(e.matrixWorld))}}if(r.isMeshPhongMaterial||r.isMeshToonMaterial||r.isMeshLambertMaterial||r.isMeshBasicMaterial||r.isMeshStandardMaterial||r.isShaderMaterial){M.setValue(Me,"isOrthographic",!0===e.isOrthographicCamera)}if(r.isMeshPhongMaterial||r.isMeshToonMaterial||r.isMeshLambertMaterial||r.isMeshBasicMaterial||r.isMeshStandardMaterial||r.isShaderMaterial||r.isShadowMaterial||i.isSkinnedMesh){M.setValue(Me,"viewMatrix",e.matrixWorldInverse)}}if(i.isSkinnedMesh){M.setOptional(Me,i,"bindMatrix");M.setOptional(Me,i,"bindMatrixInverse");var A=i.skeleton;if(A){if(Ee.floatVertexTextures){if(null===A.boneTexture)A.computeBoneTexture();M.setValue(Me,"boneTexture",A.boneTexture,Ce);M.setValue(Me,"boneTextureSize",A.boneTextureSize)}else{M.setOptional(Me,A,"boneMatrices")}}}if(!!a&&(a.morphAttributes.position!==void 0||a.morphAttributes.normal!==void 0)){He.update(i,a,r,v)}if(b||g.receiveShadow!==i.receiveShadow){g.receiveShadow=i.receiveShadow;M.setValue(Me,"receiveShadow",i.receiveShadow)}if(b){M.setValue(Me,"toneMappingExposure",Z.toneMappingExposure);if(g.needsLights){_(T,S)}if(n&&r.fog){Ne.refreshFogUniforms(T,n)}Ne.refreshMaterialUniforms(T,r,de,le,_e);Xe.upload(Me,g.uniformsList,T,Ce)}if(r.isShaderMaterial&&!0===r.uniformsNeedUpdate){Xe.upload(Me,g.uniformsList,T,Ce);r.uniformsNeedUpdate=!1}if(r.isSpriteMaterial){M.setValue(Me,"center",i.center)}M.setValue(Me,"modelViewMatrix",i.modelViewMatrix);M.setValue(Me,"normalMatrix",i.normalMatrix);M.setValue(Me,"modelMatrix",i.matrixWorld);return v}function _(e,t){e.ambientLightColor.needsUpdate=t;e.lightProbe.needsUpdate=t;e.directionalLights.needsUpdate=t;e.directionalLightShadows.needsUpdate=t;e.pointLights.needsUpdate=t;e.pointLightShadows.needsUpdate=t;e.spotLights.needsUpdate=t;e.spotLightShadows.needsUpdate=t;e.rectAreaLights.needsUpdate=t;e.hemisphereLights.needsUpdate=t}function x(e){return e.isMeshLambertMaterial||e.isMeshToonMaterial||e.isMeshPhongMaterial||e.isMeshStandardMaterial||e.isShadowMaterial||e.isShaderMaterial&&!0===e.lights}this.getActiveCubeFace=function(){return $};this.getActiveMipmapLevel=function(){return ee};this.getRenderTarget=function(){return te};this.setRenderTargetTextures=function(e,t,a){ke.get(e.texture).__webglTexture=t;ke.get(e.depthTexture).__webglTexture=a;var r=ke.get(e);r.__hasExternalTextures=!0;if(r.__hasExternalTextures){r.__autoAllocateDepthBuffer=a===void 0;if(!r.__autoAllocateDepthBuffer){if(e.useRenderToTexture){console.warn("render-to-texture extension was disabled because an external texture was provided");e.useRenderToTexture=!1;e.useRenderbuffer=!0}}}};this.setRenderTargetFramebuffer=function(e,t){var a=ke.get(e);a.__webglFramebuffer=t;a.__useDefaultFramebuffer=t===void 0};this.setRenderTarget=function(e){var t=1<arguments.length&&arguments[1]!==void 0?arguments[1]:0,a=2<arguments.length&&arguments[2]!==void 0?arguments[2]:0;te=e;$=t;ee=a;var r=!0;if(e){var d=ke.get(e);if(d.__useDefaultFramebuffer!==void 0){we.bindFramebuffer(36160,null);r=!1}else if(d.__webglFramebuffer===void 0){Ce.setupRenderTarget(e)}else if(d.__hasExternalTextures){Ce.rebindTextures(e,ke.get(e.texture).__webglTexture,ke.get(e.depthTexture).__webglTexture)}}var i=null,n=!1,o=!1;if(e){var c=e.texture;if(c.isDataTexture3D||c.isDataTexture2DArray){o=!0}var u=ke.get(e).__webglFramebuffer;if(e.isWebGLCubeRenderTarget){i=u[t];n=!0}else if(e.useRenderbuffer){i=ke.get(e).__webglMultisampledFramebuffer}else{i=u}ie.copy(e.viewport);ne.copy(e.scissor);oe=e.scissorTest}else{ie.copy(pe).multiplyScalar(de).floor();ne.copy(me).multiplyScalar(de).floor();oe=ge}var s=we.bindFramebuffer(36160,i);if(s&&Ee.drawBuffers&&r){var p=!1;if(e){if(e.isWebGLMultipleRenderTargets){var m=e.texture;if(fe.length!==m.length||36064!==fe[0]){for(var g=0,f=m.length;g<f;g++){fe[g]=36064+g}fe.length=m.length;p=!0}}else{if(1!==fe.length||36064!==fe[0]){fe[0]=36064;fe.length=1;p=!0}}}else{if(1!==fe.length||1029!==fe[0]){fe[0]=1029;fe.length=1;p=!0}}if(p){if(Ee.isWebGL2){Me.drawBuffers(fe)}else{Te.get("WEBGL_draw_buffers").drawBuffersWEBGL(fe)}}}we.viewport(ie);we.scissor(ne);we.setScissorTest(oe);if(n){var h=ke.get(e.texture);Me.framebufferTexture2D(36160,36064,34069+t,h.__webglTexture,a)}else if(o){var l=ke.get(e.texture);Me.framebufferTextureLayer(36160,36064,l.__webglTexture,a||0,t||0)}ae=-1};this.readRenderTargetPixels=function(e,t,a,r,i,n,o){if(!(e&&e.isWebGLRenderTarget)){console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not THREE.WebGLRenderTarget.");return}var s=ke.get(e).__webglFramebuffer;if(e.isWebGLCubeRenderTarget&&o!==void 0){s=s[o]}if(s){we.bindFramebuffer(36160,s);try{var l=e.texture,d=l.format,c=l.type;if(d!==an&&je.convert(d)!==Me.getParameter(35739)){console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not in RGBA or implementation defined format.");return}var u=c===Zi&&(Te.has("EXT_color_buffer_half_float")||Ee.isWebGL2&&Te.has("EXT_color_buffer_float"));if(c!==Hi&&je.convert(c)!==Me.getParameter(35738)&&!(c===Yi&&(Ee.isWebGL2||Te.has("OES_texture_float")||Te.has("WEBGL_color_buffer_float")))&&!u){console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not in UnsignedByteType or implementation defined type.");return}if(36053===Me.checkFramebufferStatus(36160)){if(0<=t&&t<=e.width-r&&0<=a&&a<=e.height-i){Me.readPixels(t,a,r,i,je.convert(d),je.convert(c),n)}}else{console.error("THREE.WebGLRenderer.readRenderTargetPixels: readPixels from renderTarget failed. Framebuffer not complete.")}}finally{var p=null!==te?ke.get(te).__webglFramebuffer:null;we.bindFramebuffer(36160,p)}}};this.copyFramebufferToTexture=function(e,t){var a=2<arguments.length&&arguments[2]!==void 0?arguments[2]:0,r=Math.pow(2,-a),i=Math.floor(t.image.width*r),n=Math.floor(t.image.height*r),o=je.convert(t.format);if(Ee.isWebGL2){if(6407===o)o=32849;if(6408===o)o=32856}Ce.setTexture2D(t,0);Me.copyTexImage2D(3553,a,o,e.x,e.y,i,n,0);we.unbindTexture()};this.copyTextureToTexture=function(e,t,a){var r=3<arguments.length&&arguments[3]!==void 0?arguments[3]:0,i=t.image.width,n=t.image.height,o=je.convert(a.format),s=je.convert(a.type);Ce.setTexture2D(a,0);Me.pixelStorei(37440,a.flipY);Me.pixelStorei(37441,a.premultiplyAlpha);Me.pixelStorei(3317,a.unpackAlignment);if(t.isDataTexture){Me.texSubImage2D(3553,r,e.x,e.y,i,n,o,s,t.image.data)}else{if(t.isCompressedTexture){Me.compressedTexSubImage2D(3553,r,e.x,e.y,t.mipmaps[0].width,t.mipmaps[0].height,o,t.mipmaps[0].data)}else{Me.texSubImage2D(3553,r,e.x,e.y,o,s,t.image)}}if(0===r&&a.generateMipmaps)Me.generateMipmap(3553);we.unbindTexture()};this.copyTextureToTexture3D=function(e,t,a,r){var i=4<arguments.length&&arguments[4]!==void 0?arguments[4]:0;if(Z.isWebGL1Renderer){console.warn("THREE.WebGLRenderer.copyTextureToTexture3D: can only be used with WebGL2.");return}var n=e.max.x-e.min.x+1,o=e.max.y-e.min.y+1,s=e.max.z-e.min.z+1,l=je.convert(r.format),d=je.convert(r.type),c;if(r.isDataTexture3D){Ce.setTexture3D(r,0);c=32879}else if(r.isDataTexture2DArray){Ce.setTexture2DArray(r,0);c=35866}else{console.warn("THREE.WebGLRenderer.copyTextureToTexture3D: only supports THREE.DataTexture3D and THREE.DataTexture2DArray.");return}Me.pixelStorei(37440,r.flipY);Me.pixelStorei(37441,r.premultiplyAlpha);Me.pixelStorei(3317,r.unpackAlignment);var u=Me.getParameter(3314),p=Me.getParameter(32878),m=Me.getParameter(3316),g=Me.getParameter(3315),f=Me.getParameter(32877),h=a.isCompressedTexture?a.mipmaps[0]:a.image;Me.pixelStorei(3314,h.width);Me.pixelStorei(32878,h.height);Me.pixelStorei(3316,e.min.x);Me.pixelStorei(3315,e.min.y);Me.pixelStorei(32877,e.min.z);if(a.isDataTexture||a.isDataTexture3D){Me.texSubImage3D(c,i,t.x,t.y,t.z,n,o,s,l,d,h.data)}else{if(a.isCompressedTexture){console.warn("THREE.WebGLRenderer.copyTextureToTexture3D: untested support for compressed srcTexture.");Me.compressedTexSubImage3D(c,i,t.x,t.y,t.z,n,o,s,l,h.data)}else{Me.texSubImage3D(c,i,t.x,t.y,t.z,n,o,s,l,d,h)}}Me.pixelStorei(3314,u);Me.pixelStorei(32878,p);Me.pixelStorei(3316,m);Me.pixelStorei(3315,g);Me.pixelStorei(32877,f);if(0===i&&r.generateMipmaps)Me.generateMipmap(c);we.unbindTexture()};this.initTexture=function(e){Ce.setTexture2D(e,0);we.unbindTexture()};this.resetState=function(){$=0;ee=0;te=null;we.reset();qe.reset()};if("undefined"!=typeof __THREE_DEVTOOLS__){__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("observe",{detail:this}))}}Nt.prototype.isWebGLRenderer=!0;var kc=function(e){_inherits(t,e);var a=_createSuper(t);function t(){_classCallCheck2(this,t);return a.apply(this,arguments)}return t}(Nt);kc.prototype.isWebGL1Renderer=!0;var Cc=function(){function e(t){var a=1<arguments.length&&arguments[1]!==void 0?arguments[1]:25e-5;_classCallCheck2(this,e);this.name="";this.color=new zl(t);this.density=a}_createClass2(e,[{key:"clone",value:function clone(){return new e(this.color,this.density)}},{key:"toJSON",value:function toJSON(){return{type:"FogExp2",color:this.color.getHex(),density:this.density}}}]);return e}();Cc.prototype.isFogExp2=!0;var Rc=function(){function e(t){var a=1<arguments.length&&arguments[1]!==void 0?arguments[1]:1,r=2<arguments.length&&arguments[2]!==void 0?arguments[2]:1e3;_classCallCheck2(this,e);this.name="";this.color=new zl(t);this.near=a;this.far=r}_createClass2(e,[{key:"clone",value:function clone(){return new e(this.color,this.near,this.far)}},{key:"toJSON",value:function toJSON(){return{type:"Fog",color:this.color.getHex(),near:this.near,far:this.far}}}]);return e}();Rc.prototype.isFog=!0;var Lc=function(e){_inherits(t,e);var a=_createSuper(t);function t(){var e;_classCallCheck2(this,t);e=a.call(this);e.type="Scene";e.background=null;e.environment=null;e.fog=null;e.overrideMaterial=null;e.autoUpdate=!0;if("undefined"!=typeof __THREE_DEVTOOLS__){__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("observe",{detail:_assertThisInitialized(e)}))}return e}_createClass2(t,[{key:"copy",value:function copy(e,a){_get(_getPrototypeOf(t.prototype),"copy",this).call(this,e,a);if(null!==e.background)this.background=e.background.clone();if(null!==e.environment)this.environment=e.environment.clone();if(null!==e.fog)this.fog=e.fog.clone();if(null!==e.overrideMaterial)this.overrideMaterial=e.overrideMaterial.clone();this.autoUpdate=e.autoUpdate;this.matrixAutoUpdate=e.matrixAutoUpdate;return this}},{key:"toJSON",value:function toJSON(e){var a=_get(_getPrototypeOf(t.prototype),"toJSON",this).call(this,e);if(null!==this.fog)a.object.fog=this.fog.toJSON();return a}}]);return t}(vl);Lc.prototype.isScene=!0;var Pc=function(){function e(a,r){_classCallCheck2(this,e);this.array=a;this.stride=r;this.count=a!==void 0?a.length/r:0;this.usage=Vo;this.updateRange={offset:0,count:-1};this.version=0;this.uuid=t()}_createClass2(e,[{key:"onUploadCallback",value:function onUploadCallback(){}},{key:"setUsage",value:function setUsage(e){this.usage=e;return this}},{key:"copy",value:function copy(e){this.array=new e.array.constructor(e.array);this.count=e.count;this.stride=e.stride;this.usage=e.usage;return this}},{key:"copyAt",value:function copyAt(e,t,a){e*=this.stride;a*=t.stride;for(var r=0,i=this.stride;r<i;r++){this.array[e+r]=t.array[a+r]}return this}},{key:"set",value:function set(e){var t=1<arguments.length&&arguments[1]!==void 0?arguments[1]:0;this.array.set(e,t);return this}},{key:"clone",value:function clone(e){if(e.arrayBuffers===void 0){e.arrayBuffers={}}if(this.array.buffer._uuid===void 0){this.array.buffer._uuid=t()}if(e.arrayBuffers[this.array.buffer._uuid]===void 0){e.arrayBuffers[this.array.buffer._uuid]=this.array.slice(0).buffer}var a=new this.array.constructor(e.arrayBuffers[this.array.buffer._uuid]),r=new this.constructor(a,this.stride);r.setUsage(this.usage);return r}},{key:"onUpload",value:function onUpload(e){this.onUploadCallback=e;return this}},{key:"toJSON",value:function toJSON(e){if(e.arrayBuffers===void 0){e.arrayBuffers={}}if(this.array.buffer._uuid===void 0){this.array.buffer._uuid=t()}if(e.arrayBuffers[this.array.buffer._uuid]===void 0){e.arrayBuffers[this.array.buffer._uuid]=Array.prototype.slice.call(new Uint32Array(this.array.buffer))}return{uuid:this.uuid,buffer:this.array.buffer._uuid,type:this.array.constructor.name,stride:this.stride}}},{key:"needsUpdate",set:function set(e){if(!0===e)this.version++}}]);return e}();Pc.prototype.isInterleavedBuffer=!0;var Ic=new vs,Dc=function(){function e(t,a,r){var i=3<arguments.length&&arguments[3]!==void 0?arguments[3]:!1;_classCallCheck2(this,e);this.name="";this.data=t;this.itemSize=a;this.offset=r;this.normalized=!0===i}_createClass2(e,[{key:"applyMatrix4",value:function applyMatrix4(e){for(var t=0,a=this.data.count;t<a;t++){Ic.x=this.getX(t);Ic.y=this.getY(t);Ic.z=this.getZ(t);Ic.applyMatrix4(e);this.setXYZ(t,Ic.x,Ic.y,Ic.z)}return this}},{key:"applyNormalMatrix",value:function applyNormalMatrix(e){for(var t=0,a=this.count;t<a;t++){Ic.x=this.getX(t);Ic.y=this.getY(t);Ic.z=this.getZ(t);Ic.applyNormalMatrix(e);this.setXYZ(t,Ic.x,Ic.y,Ic.z)}return this}},{key:"transformDirection",value:function transformDirection(e){for(var t=0,a=this.count;t<a;t++){Ic.x=this.getX(t);Ic.y=this.getY(t);Ic.z=this.getZ(t);Ic.transformDirection(e);this.setXYZ(t,Ic.x,Ic.y,Ic.z)}return this}},{key:"setX",value:function setX(e,t){this.data.array[e*this.data.stride+this.offset]=t;return this}},{key:"setY",value:function setY(e,t){this.data.array[e*this.data.stride+this.offset+1]=t;return this}},{key:"setZ",value:function setZ(e,t){this.data.array[e*this.data.stride+this.offset+2]=t;return this}},{key:"setW",value:function setW(e,t){this.data.array[e*this.data.stride+this.offset+3]=t;return this}},{key:"getX",value:function getX(e){return this.data.array[e*this.data.stride+this.offset]}},{key:"getY",value:function getY(e){return this.data.array[e*this.data.stride+this.offset+1]}},{key:"getZ",value:function getZ(e){return this.data.array[e*this.data.stride+this.offset+2]}},{key:"getW",value:function getW(e){return this.data.array[e*this.data.stride+this.offset+3]}},{key:"setXY",value:function setXY(e,t,a){e=e*this.data.stride+this.offset;this.data.array[e+0]=t;this.data.array[e+1]=a;return this}},{key:"setXYZ",value:function setXYZ(e,t,a,r){e=e*this.data.stride+this.offset;this.data.array[e+0]=t;this.data.array[e+1]=a;this.data.array[e+2]=r;return this}},{key:"setXYZW",value:function setXYZW(e,t,a,r,i){e=e*this.data.stride+this.offset;this.data.array[e+0]=t;this.data.array[e+1]=a;this.data.array[e+2]=r;this.data.array[e+3]=i;return this}},{key:"clone",value:function clone(t){if(t===void 0){console.log("THREE.InterleavedBufferAttribute.clone(): Cloning an interlaved buffer attribute will deinterleave buffer data.");for(var a=[],r=0,i;r<this.count;r++){i=r*this.data.stride+this.offset;for(var n=0;n<this.itemSize;n++){a.push(this.data.array[i+n])}}return new Bl(new this.array.constructor(a),this.itemSize,this.normalized)}else{if(t.interleavedBuffers===void 0){t.interleavedBuffers={}}if(t.interleavedBuffers[this.data.uuid]===void 0){t.interleavedBuffers[this.data.uuid]=this.data.clone(t)}return new e(t.interleavedBuffers[this.data.uuid],this.itemSize,this.offset,this.normalized)}}},{key:"toJSON",value:function toJSON(e){if(e===void 0){console.log("THREE.InterleavedBufferAttribute.toJSON(): Serializing an interlaved buffer attribute will deinterleave buffer data.");for(var t=[],a=0,r;a<this.count;a++){r=a*this.data.stride+this.offset;for(var i=0;i<this.itemSize;i++){t.push(this.data.array[r+i])}}return{itemSize:this.itemSize,type:this.array.constructor.name,array:t,normalized:this.normalized}}else{if(e.interleavedBuffers===void 0){e.interleavedBuffers={}}if(e.interleavedBuffers[this.data.uuid]===void 0){e.interleavedBuffers[this.data.uuid]=this.data.toJSON(e)}return{isInterleavedBufferAttribute:!0,itemSize:this.itemSize,data:this.data.uuid,offset:this.offset,normalized:this.normalized}}}},{key:"count",get:function get(){return this.data.count}},{key:"array",get:function get(){return this.data.array}},{key:"needsUpdate",set:function set(e){this.data.needsUpdate=e}}]);return e}();Dc.prototype.isInterleavedBufferAttribute=!0;var zc=function(e){_inherits(t,e);var a=_createSuper(t);function t(e){var r;_classCallCheck2(this,t);r=a.call(this);r.type="SpriteMaterial";r.color=new zl(16777215);r.map=null;r.alphaMap=null;r.rotation=0;r.sizeAttenuation=!0;r.transparent=!0;r.setValues(e);return r}_createClass2(t,[{key:"copy",value:function copy(e){_get(_getPrototypeOf(t.prototype),"copy",this).call(this,e);this.color.copy(e.color);this.map=e.map;this.alphaMap=e.alphaMap;this.rotation=e.rotation;this.sizeAttenuation=e.sizeAttenuation;return this}}]);return t}(Ll);zc.prototype.isSpriteMaterial=!0;var Nc,Fc=new vs,Oc=new vs,Bc=new vs,Uc=new os,Gc=new os,Hc=new Ys,Vc=new vs,Wc=new vs,jc=new vs,qc=new os,Xc=new os,Yc=new os,Zc=function(e){_inherits(t,e);var a=_createSuper(t);function t(e){var r;_classCallCheck2(this,t);r=a.call(this);r.type="Sprite";if(Nc===void 0){Nc=new rd;var i=new Float32Array([-.5,-.5,0,0,0,.5,-.5,0,1,0,.5,.5,0,1,1,-.5,.5,0,0,1]),n=new Pc(i,5);Nc.setIndex([0,1,2,0,2,3]);Nc.setAttribute("position",new Dc(n,3,0,!1));Nc.setAttribute("uv",new Dc(n,2,3,!1))}r.geometry=Nc;r.material=e!==void 0?e:new zc;r.center=new os(.5,.5);return r}_createClass2(t,[{key:"raycast",value:function raycast(e,t){if(null===e.camera){console.error("THREE.Sprite: \"Raycaster.camera\" needs to be set in order to raycast against sprites.")}Oc.setFromMatrixScale(this.matrixWorld);Hc.copy(e.camera.matrixWorld);this.modelViewMatrix.multiplyMatrices(e.camera.matrixWorldInverse,this.matrixWorld);Bc.setFromMatrixPosition(this.modelViewMatrix);if(e.camera.isPerspectiveCamera&&!1===this.material.sizeAttenuation){Oc.multiplyScalar(-Bc.z)}var a=this.material.rotation,r,i;if(0!==a){i=Math.cos(a);r=Math.sin(a)}var n=this.center;Ft(Vc.set(-.5,-.5,0),Bc,n,Oc,r,i);Ft(Wc.set(.5,-.5,0),Bc,n,Oc,r,i);Ft(jc.set(.5,.5,0),Bc,n,Oc,r,i);qc.set(0,0);Xc.set(1,0);Yc.set(1,1);var o=e.ray.intersectTriangle(Vc,Wc,jc,!1,Fc);if(null===o){Ft(Wc.set(-.5,.5,0),Bc,n,Oc,r,i);Xc.set(0,1);o=e.ray.intersectTriangle(Vc,jc,Wc,!1,Fc);if(null===o){return}}var s=e.ray.origin.distanceTo(Fc);if(s<e.near||s>e.far)return;t.push({distance:s,point:Fc.clone(),uv:Cl.getUV(Fc,Vc,Wc,jc,qc,Xc,Yc,new os),face:null,object:this})}},{key:"copy",value:function copy(e){_get(_getPrototypeOf(t.prototype),"copy",this).call(this,e);if(e.center!==void 0)this.center.copy(e.center);this.material=e.material;return this}}]);return t}(vl);Zc.prototype.isSprite=!0;function Ft(e,t,a,r,i,n){Uc.subVectors(e,a).addScalar(.5).multiply(r);if(i!==void 0){Gc.x=n*Uc.x-i*Uc.y;Gc.y=i*Uc.x+n*Uc.y}else{Gc.copy(Uc)}e.copy(t);e.x+=Gc.x;e.y+=Gc.y;e.applyMatrix4(Hc)}var Jc=new vs,Qc=new vs,Kc=function(e){_inherits(t,e);var a=_createSuper(t);function t(){var e;_classCallCheck2(this,t);e=a.call(this);e._currentLevel=0;e.type="LOD";Object.defineProperties(_assertThisInitialized(e),{levels:{enumerable:!0,value:[]},isLOD:{value:!0}});e.autoUpdate=!0;return e}_createClass2(t,[{key:"copy",value:function copy(e){_get(_getPrototypeOf(t.prototype),"copy",this).call(this,e,!1);for(var a=e.levels,r=0,i=a.length,n;r<i;r++){n=a[r];this.addLevel(n.object.clone(),n.distance)}this.autoUpdate=e.autoUpdate;return this}},{key:"addLevel",value:function addLevel(e){var t=1<arguments.length&&arguments[1]!==void 0?arguments[1]:0;t=Math.abs(t);var a=this.levels,r;for(r=0;r<a.length;r++){if(t<a[r].distance){break}}a.splice(r,0,{distance:t,object:e});this.add(e);return this}},{key:"getCurrentLevel",value:function getCurrentLevel(){return this._currentLevel}},{key:"getObjectForDistance",value:function getObjectForDistance(e){var t=this.levels;if(0<t.length){var a,r;for(a=1,r=t.length;a<r;a++){if(e<t[a].distance){break}}return t[a-1].object}return null}},{key:"raycast",value:function raycast(e,t){var a=this.levels;if(0<a.length){Jc.setFromMatrixPosition(this.matrixWorld);var r=e.ray.origin.distanceTo(Jc);this.getObjectForDistance(r).raycast(e,t)}}},{key:"update",value:function update(e){var t=this.levels;if(1<t.length){Jc.setFromMatrixPosition(e.matrixWorld);Qc.setFromMatrixPosition(this.matrixWorld);var a=Jc.distanceTo(Qc)/e.zoom;t[0].object.visible=!0;var r,i;for(r=1,i=t.length;r<i;r++){if(a>=t[r].distance){t[r-1].object.visible=!1;t[r].object.visible=!0}else{break}}this._currentLevel=r-1;for(;r<i;r++){t[r].object.visible=!1}}}},{key:"toJSON",value:function toJSON(e){var a=_get(_getPrototypeOf(t.prototype),"toJSON",this).call(this,e);if(!1===this.autoUpdate)a.object.autoUpdate=!1;a.object.levels=[];for(var r=this.levels,i=0,n=r.length,o;i<n;i++){o=r[i];a.object.levels.push({object:o.object.uuid,distance:o.distance})}return a}}]);return t}(vl),$c=new vs,eu=new ms,tu=new ms,au=new vs,ru=new Ys,iu=function(e){_inherits(t,e);var a=_createSuper(t);function t(e,r){var i;_classCallCheck2(this,t);i=a.call(this,e,r);i.type="SkinnedMesh";i.bindMode="attached";i.bindMatrix=new Ys;i.bindMatrixInverse=new Ys;return i}_createClass2(t,[{key:"copy",value:function copy(e){_get(_getPrototypeOf(t.prototype),"copy",this).call(this,e);this.bindMode=e.bindMode;this.bindMatrix.copy(e.bindMatrix);this.bindMatrixInverse.copy(e.bindMatrixInverse);this.skeleton=e.skeleton;return this}},{key:"bind",value:function bind(e,t){this.skeleton=e;if(t===void 0){this.updateMatrixWorld(!0);this.skeleton.calculateInverses();t=this.matrixWorld}this.bindMatrix.copy(t);this.bindMatrixInverse.copy(t).invert()}},{key:"pose",value:function pose(){this.skeleton.pose()}},{key:"normalizeSkinWeights",value:function normalizeSkinWeights(){for(var e=new ms,t=this.geometry.attributes.skinWeight,a=0,r=t.count;a<r;a++){e.x=t.getX(a);e.y=t.getY(a);e.z=t.getZ(a);e.w=t.getW(a);var i=1/e.manhattanLength();if(i!=1/0){e.multiplyScalar(i)}else{e.set(1,0,0,0)}t.setXYZW(a,e.x,e.y,e.z,e.w)}}},{key:"updateMatrixWorld",value:function updateMatrixWorld(e){_get(_getPrototypeOf(t.prototype),"updateMatrixWorld",this).call(this,e);if("attached"===this.bindMode){this.bindMatrixInverse.copy(this.matrixWorld).invert()}else if("detached"===this.bindMode){this.bindMatrixInverse.copy(this.bindMatrix).invert()}else{console.warn("THREE.SkinnedMesh: Unrecognized bindMode: "+this.bindMode)}}},{key:"boneTransform",value:function boneTransform(e,t){var a=this.skeleton,r=this.geometry;eu.fromBufferAttribute(r.attributes.skinIndex,e);tu.fromBufferAttribute(r.attributes.skinWeight,e);$c.copy(t).applyMatrix4(this.bindMatrix);t.set(0,0,0);for(var i=0,n;4>i;i++){n=tu.getComponent(i);if(0!==n){var o=eu.getComponent(i);ru.multiplyMatrices(a.bones[o].matrixWorld,a.boneInverses[o]);t.addScaledVector(au.copy($c).applyMatrix4(ru),n)}}return t.applyMatrix4(this.bindMatrixInverse)}}]);return t}(bd);iu.prototype.isSkinnedMesh=!0;var nu=function(e){_inherits(t,e);var a=_createSuper(t);function t(){var e;_classCallCheck2(this,t);e=a.call(this);e.type="Bone";return e}return t}(vl);nu.prototype.isBone=!0;var ou=function(e){_inherits(t,e);var a=_createSuper(t);function t(){var e,r=0<arguments.length&&arguments[0]!==void 0?arguments[0]:null,i=1<arguments.length&&arguments[1]!==void 0?arguments[1]:1,n=2<arguments.length&&arguments[2]!==void 0?arguments[2]:1,o=3<arguments.length?arguments[3]:void 0,s=4<arguments.length?arguments[4]:void 0,l=5<arguments.length?arguments[5]:void 0,d=6<arguments.length?arguments[6]:void 0,c=7<arguments.length?arguments[7]:void 0,u=8<arguments.length&&arguments[8]!==void 0?arguments[8]:Pi,p=9<arguments.length&&arguments[9]!==void 0?arguments[9]:Pi,m=10<arguments.length?arguments[10]:void 0,g=11<arguments.length?arguments[11]:void 0;_classCallCheck2(this,t);e=a.call(this,null,l,d,c,u,p,o,s,m,g);e.image={data:r,width:i,height:n};e.magFilter=u;e.minFilter=p;e.generateMipmaps=!1;e.flipY=!1;e.unpackAlignment=1;e.needsUpdate=!0;return e}return t}(ps);ou.prototype.isDataTexture=!0;var su=new Ys,lu=new Ys,du=function(){function e(){var a=0<arguments.length&&arguments[0]!==void 0?arguments[0]:[],r=1<arguments.length&&arguments[1]!==void 0?arguments[1]:[];_classCallCheck2(this,e);this.uuid=t();this.bones=a.slice(0);this.boneInverses=r;this.boneMatrices=null;this.boneTexture=null;this.boneTextureSize=0;this.frame=-1;this.init()}_createClass2(e,[{key:"init",value:function init(){var e=this.bones,t=this.boneInverses;this.boneMatrices=new Float32Array(16*e.length);if(0===t.length){this.calculateInverses()}else{if(e.length!==t.length){console.warn("THREE.Skeleton: Number of inverse bone matrices does not match amount of bones.");this.boneInverses=[];for(var a=0,r=this.bones.length;a<r;a++){this.boneInverses.push(new Ys)}}}}},{key:"calculateInverses",value:function calculateInverses(){this.boneInverses.length=0;for(var e=0,t=this.bones.length,a;e<t;e++){a=new Ys;if(this.bones[e]){a.copy(this.bones[e].matrixWorld).invert()}this.boneInverses.push(a)}}},{key:"pose",value:function pose(){for(var e=0,t=this.bones.length,a;e<t;e++){a=this.bones[e];if(a){a.matrixWorld.copy(this.boneInverses[e]).invert()}}for(var r=0,i=this.bones.length,n;r<i;r++){n=this.bones[r];if(n){if(n.parent&&n.parent.isBone){n.matrix.copy(n.parent.matrixWorld).invert();n.matrix.multiply(n.matrixWorld)}else{n.matrix.copy(n.matrixWorld)}n.matrix.decompose(n.position,n.quaternion,n.scale)}}}},{key:"update",value:function update(){for(var e=this.bones,t=this.boneInverses,a=this.boneMatrices,r=this.boneTexture,i=0,n=e.length,o;i<n;i++){o=e[i]?e[i].matrixWorld:lu;su.multiplyMatrices(o,t[i]);su.toArray(a,16*i)}if(null!==r){r.needsUpdate=!0}}},{key:"clone",value:function clone(){return new e(this.bones,this.boneInverses)}},{key:"computeBoneTexture",value:function computeBoneTexture(){var e=Math.sqrt(4*this.bones.length);e=l(e);e=Math.max(e,4);var t=new Float32Array(4*(e*e));t.set(this.boneMatrices);var a=new ou(t,e,e,an,Yi);this.boneMatrices=t;this.boneTexture=a;this.boneTextureSize=e;return this}},{key:"getBoneByName",value:function getBoneByName(e){for(var t=0,a=this.bones.length,r;t<a;t++){r=this.bones[t];if(r.name===e){return r}}}},{key:"dispose",value:function dispose(){if(null!==this.boneTexture){this.boneTexture.dispose();this.boneTexture=null}}},{key:"fromJSON",value:function fromJSON(e,t){this.uuid=e.uuid;for(var i=0,n=e.bones.length;i<n;i++){var a=e.bones[i],r=t[a];if(r===void 0){console.warn("THREE.Skeleton: No bone found with UUID:",a);r=new nu}this.bones.push(r);this.boneInverses.push(new Ys().fromArray(e.boneInverses[i]))}this.init();return this}},{key:"toJSON",value:function toJSON(){for(var e={metadata:{version:4.5,type:"Skeleton",generator:"Skeleton.toJSON"},bones:[],boneInverses:[],uuid:this.uuid},t=this.bones,a=this.boneInverses,r=0,i=t.length,n;r<i;r++){n=t[r];e.bones.push(n.uuid);var o=a[r];e.boneInverses.push(o.toArray())}return e}}]);return e}(),cu=function(e){_inherits(t,e);var a=_createSuper(t);function t(e,r,i){var n,o=3<arguments.length&&arguments[3]!==void 0?arguments[3]:1;_classCallCheck2(this,t);if("number"==typeof i){o=i;i=!1;console.error("THREE.InstancedBufferAttribute: The constructor now expects normalized as the third argument.")}n=a.call(this,e,r,i);n.meshPerAttribute=o;return n}_createClass2(t,[{key:"copy",value:function copy(e){_get(_getPrototypeOf(t.prototype),"copy",this).call(this,e);this.meshPerAttribute=e.meshPerAttribute;return this}},{key:"toJSON",value:function toJSON(){var e=_get(_getPrototypeOf(t.prototype),"toJSON",this).call(this);e.meshPerAttribute=this.meshPerAttribute;e.isInstancedBufferAttribute=!0;return e}}]);return t}(Bl);cu.prototype.isInstancedBufferAttribute=!0;var uu=new Ys,pu=new Ys,mu=[],gu=new bd,fu=function(e){_inherits(t,e);var a=_createSuper(t);function t(e,r,i){var n;_classCallCheck2(this,t);n=a.call(this,e,r);n.instanceMatrix=new cu(new Float32Array(16*i),16);n.instanceColor=null;n.count=i;n.frustumCulled=!1;return n}_createClass2(t,[{key:"copy",value:function copy(e){_get(_getPrototypeOf(t.prototype),"copy",this).call(this,e);this.instanceMatrix.copy(e.instanceMatrix);if(null!==e.instanceColor)this.instanceColor=e.instanceColor.clone();this.count=e.count;return this}},{key:"getColorAt",value:function getColorAt(e,t){t.fromArray(this.instanceColor.array,3*e)}},{key:"getMatrixAt",value:function getMatrixAt(e,t){t.fromArray(this.instanceMatrix.array,16*e)}},{key:"raycast",value:function raycast(e,t){var a=this.matrixWorld,r=this.count;gu.geometry=this.geometry;gu.material=this.material;if(gu.material===void 0)return;for(var i=0;i<r;i++){this.getMatrixAt(i,uu);pu.multiplyMatrices(a,uu);gu.matrixWorld=pu;gu.raycast(e,mu);for(var n=0,o=mu.length,s;n<o;n++){s=mu[n];s.instanceId=i;s.object=this;t.push(s)}mu.length=0}}},{key:"setColorAt",value:function setColorAt(e,t){if(null===this.instanceColor){this.instanceColor=new cu(new Float32Array(3*this.instanceMatrix.count),3)}t.toArray(this.instanceColor.array,3*e)}},{key:"setMatrixAt",value:function setMatrixAt(e,t){t.toArray(this.instanceMatrix.array,16*e)}},{key:"updateMorphTargets",value:function updateMorphTargets(){}},{key:"dispose",value:function dispose(){this.dispatchEvent({type:"dispose"})}}]);return t}(bd);fu.prototype.isInstancedMesh=!0;var hu=function(e){_inherits(t,e);var a=_createSuper(t);function t(e){var r;_classCallCheck2(this,t);r=a.call(this);r.type="LineBasicMaterial";r.color=new zl(16777215);r.linewidth=1;r.linecap="round";r.linejoin="round";r.setValues(e);return r}_createClass2(t,[{key:"copy",value:function copy(e){_get(_getPrototypeOf(t.prototype),"copy",this).call(this,e);this.color.copy(e.color);this.linewidth=e.linewidth;this.linecap=e.linecap;this.linejoin=e.linejoin;return this}}]);return t}(Ll);hu.prototype.isLineBasicMaterial=!0;var yu=new vs,vu=new vs,_u=new Ys,xu=new Xs,bu=new Bs,Su=function(e){_inherits(t,e);var a=_createSuper(t);function t(){var e,r=0<arguments.length&&arguments[0]!==void 0?arguments[0]:new rd,i=1<arguments.length&&arguments[1]!==void 0?arguments[1]:new hu;_classCallCheck2(this,t);e=a.call(this);e.type="Line";e.geometry=r;e.material=i;e.updateMorphTargets();return e}_createClass2(t,[{key:"copy",value:function copy(e){_get(_getPrototypeOf(t.prototype),"copy",this).call(this,e);this.material=e.material;this.geometry=e.geometry;return this}},{key:"computeLineDistances",value:function computeLineDistances(){var e=this.geometry;if(e.isBufferGeometry){if(null===e.index){for(var t=e.attributes.position,a=[0],r=1,i=t.count;r<i;r++){yu.fromBufferAttribute(t,r-1);vu.fromBufferAttribute(t,r);a[r]=a[r-1];a[r]+=yu.distanceTo(vu)}e.setAttribute("lineDistance",new Yl(a,1))}else{console.warn("THREE.Line.computeLineDistances(): Computation only possible with non-indexed BufferGeometry.")}}else if(e.isGeometry){console.error("THREE.Line.computeLineDistances() no longer supports THREE.Geometry. Use THREE.BufferGeometry instead.")}return this}},{key:"raycast",value:function raycast(e,t){var r=this.geometry,i=this.matrixWorld,n=e.params.Line.threshold,o=r.drawRange;if(null===r.boundingSphere)r.computeBoundingSphere();bu.copy(r.boundingSphere);bu.applyMatrix4(i);bu.radius+=n;if(!1===e.ray.intersectsSphere(bu))return;_u.copy(i).invert();xu.copy(e.ray).applyMatrix4(_u);var s=n/((this.scale.x+this.scale.y+this.scale.z)/3),l=s*s,d=new vs,c=new vs,u=new vs,p=new vs,m=this.isLineSegments?2:1;if(r.isBufferGeometry){var g=r.index,f=r.attributes,h=f.position;if(null!==g){for(var y=Math.max(0,o.start),v=Math.min(g.count,o.start+o.count),_=y;_<v-1;_+=m){var x=g.getX(_),a=g.getX(_+1);d.fromBufferAttribute(h,x);c.fromBufferAttribute(h,a);var T=xu.distanceSqToSegment(d,c,p,u);if(T>l)continue;p.applyMatrix4(this.matrixWorld);var E=e.ray.origin.distanceTo(p);if(E<e.near||E>e.far)continue;t.push({distance:E,point:u.clone().applyMatrix4(this.matrixWorld),index:_,face:null,faceIndex:null,object:this})}}else{for(var b=Math.max(0,o.start),S=Math.min(h.count,o.start+o.count),M=b;M<S-1;M+=m){d.fromBufferAttribute(h,M);c.fromBufferAttribute(h,M+1);var w=xu.distanceSqToSegment(d,c,p,u);if(w>l)continue;p.applyMatrix4(this.matrixWorld);var A=e.ray.origin.distanceTo(p);if(A<e.near||A>e.far)continue;t.push({distance:A,point:u.clone().applyMatrix4(this.matrixWorld),index:M,face:null,faceIndex:null,object:this})}}}else if(r.isGeometry){console.error("THREE.Line.raycast() no longer supports THREE.Geometry. Use THREE.BufferGeometry instead.")}}},{key:"updateMorphTargets",value:function updateMorphTargets(){var e=this.geometry;if(e.isBufferGeometry){var t=e.morphAttributes,a=Object.keys(t);if(0<a.length){var r=t[a[0]];if(r!==void 0){this.morphTargetInfluences=[];this.morphTargetDictionary={};for(var i=0,n=r.length,o;i<n;i++){o=r[i].name||i+"";this.morphTargetInfluences.push(0);this.morphTargetDictionary[o]=i}}}}else{var s=e.morphTargets;if(s!==void 0&&0<s.length){console.error("THREE.Line.updateMorphTargets() does not support THREE.Geometry. Use THREE.BufferGeometry instead.")}}}}]);return t}(vl);Su.prototype.isLine=!0;var Mu=new vs,Tu=new vs,Eu=function(e){_inherits(t,e);var a=_createSuper(t);function t(e,r){var i;_classCallCheck2(this,t);i=a.call(this,e,r);i.type="LineSegments";return i}_createClass2(t,[{key:"computeLineDistances",value:function computeLineDistances(){var e=this.geometry;if(e.isBufferGeometry){if(null===e.index){for(var t=e.attributes.position,a=[],r=0,i=t.count;r<i;r+=2){Mu.fromBufferAttribute(t,r);Tu.fromBufferAttribute(t,r+1);a[r]=0==r?0:a[r-1];a[r+1]=a[r]+Mu.distanceTo(Tu)}e.setAttribute("lineDistance",new Yl(a,1))}else{console.warn("THREE.LineSegments.computeLineDistances(): Computation only possible with non-indexed BufferGeometry.")}}else if(e.isGeometry){console.error("THREE.LineSegments.computeLineDistances() no longer supports THREE.Geometry. Use THREE.BufferGeometry instead.")}return this}}]);return t}(Su);Eu.prototype.isLineSegments=!0;var wu=function(e){_inherits(t,e);var a=_createSuper(t);function t(e,r){var i;_classCallCheck2(this,t);i=a.call(this,e,r);i.type="LineLoop";return i}return t}(Su);wu.prototype.isLineLoop=!0;var Au=function(e){_inherits(t,e);var a=_createSuper(t);function t(e){var r;_classCallCheck2(this,t);r=a.call(this);r.type="PointsMaterial";r.color=new zl(16777215);r.map=null;r.alphaMap=null;r.size=1;r.sizeAttenuation=!0;r.setValues(e);return r}_createClass2(t,[{key:"copy",value:function copy(e){_get(_getPrototypeOf(t.prototype),"copy",this).call(this,e);this.color.copy(e.color);this.map=e.map;this.alphaMap=e.alphaMap;this.size=e.size;this.sizeAttenuation=e.sizeAttenuation;return this}}]);return t}(Ll);Au.prototype.isPointsMaterial=!0;var ku=new Ys,Cu=new Xs,Ru=new Bs,Lu=new vs,Pu=function(e){_inherits(t,e);var a=_createSuper(t);function t(){var e,r=0<arguments.length&&arguments[0]!==void 0?arguments[0]:new rd,i=1<arguments.length&&arguments[1]!==void 0?arguments[1]:new Au;_classCallCheck2(this,t);e=a.call(this);e.type="Points";e.geometry=r;e.material=i;e.updateMorphTargets();return e}_createClass2(t,[{key:"copy",value:function copy(e){_get(_getPrototypeOf(t.prototype),"copy",this).call(this,e);this.material=e.material;this.geometry=e.geometry;return this}},{key:"raycast",value:function raycast(e,t){var r=this.geometry,i=this.matrixWorld,n=e.params.Points.threshold,o=r.drawRange;if(null===r.boundingSphere)r.computeBoundingSphere();Ru.copy(r.boundingSphere);Ru.applyMatrix4(i);Ru.radius+=n;if(!1===e.ray.intersectsSphere(Ru))return;ku.copy(i).invert();Cu.copy(e.ray).applyMatrix4(ku);var s=n/((this.scale.x+this.scale.y+this.scale.z)/3),l=s*s;if(r.isBufferGeometry){var d=r.index,c=r.attributes,u=c.position;if(null!==d){for(var p=Math.max(0,o.start),m=Math.min(d.count,o.start+o.count),g=p,f;g<m;g++){f=d.getX(g);Lu.fromBufferAttribute(u,f);Ot(Lu,f,l,i,e,t,this)}}else{for(var h=Math.max(0,o.start),y=Math.min(u.count,o.start+o.count),v=h;v<y;v++){Lu.fromBufferAttribute(u,v);Ot(Lu,v,l,i,e,t,this)}}}else{console.error("THREE.Points.raycast() no longer supports THREE.Geometry. Use THREE.BufferGeometry instead.")}}},{key:"updateMorphTargets",value:function updateMorphTargets(){var e=this.geometry;if(e.isBufferGeometry){var t=e.morphAttributes,a=Object.keys(t);if(0<a.length){var r=t[a[0]];if(r!==void 0){this.morphTargetInfluences=[];this.morphTargetDictionary={};for(var i=0,n=r.length,o;i<n;i++){o=r[i].name||i+"";this.morphTargetInfluences.push(0);this.morphTargetDictionary[o]=i}}}}else{var s=e.morphTargets;if(s!==void 0&&0<s.length){console.error("THREE.Points.updateMorphTargets() does not support THREE.Geometry. Use THREE.BufferGeometry instead.")}}}}]);return t}(vl);Pu.prototype.isPoints=!0;function Ot(e,t,a,r,i,n,o){var s=Cu.distanceSqToPoint(e);if(s<a){var l=new vs;Cu.closestPointToPoint(e,l);l.applyMatrix4(r);var d=i.ray.origin.distanceTo(l);if(d<i.near||d>i.far)return;n.push({distance:d,distanceToRay:Math.sqrt(s),point:l,index:t,face:null,object:o})}}var Iu=function(e){_inherits(t,e);var a=_createSuper(t);function t(e,r,i,n,o,s,l,d,c){var p;_classCallCheck2(this,t);p=a.call(this,e,r,i,n,o,s,l,d,c);p.format=l!==void 0?l:tn;p.minFilter=s!==void 0?s:Fi;p.magFilter=o!==void 0?o:Fi;p.generateMipmaps=!1;var m=_assertThisInitialized(p);function u(){m.needsUpdate=!0;e.requestVideoFrameCallback(u)}if("requestVideoFrameCallback"in e){e.requestVideoFrameCallback(u)}return p}_createClass2(t,[{key:"clone",value:function clone(){return new this.constructor(this.image).copy(this)}},{key:"update",value:function update(){var e=this.image,t=("requestVideoFrameCallback"in e);if(!1===t&&e.readyState>=e.HAVE_CURRENT_DATA){this.needsUpdate=!0}}}]);return t}(ps);Iu.prototype.isVideoTexture=!0;var Du=function(e){_inherits(t,e);var a=_createSuper(t);function t(e,r,i,n,o,s,l,d,c,u,p,m){var g;_classCallCheck2(this,t);g=a.call(this,null,s,l,d,c,u,n,o,p,m);g.image={width:r,height:i};g.mipmaps=e;g.flipY=!1;g.generateMipmaps=!1;return g}return t}(ps);Du.prototype.isCompressedTexture=!0;var zu=function(e){_inherits(t,e);var a=_createSuper(t);function t(e,r,i,n,o,s,l,d,c){var u;_classCallCheck2(this,t);u=a.call(this,e,r,i,n,o,s,l,d,c);u.needsUpdate=!0;return u}return t}(ps);zu.prototype.isCanvasTexture=!0;var Nu=function(e){_inherits(t,e);var a=_createSuper(t);function t(){var e,r=0<arguments.length&&arguments[0]!==void 0?arguments[0]:1,i=1<arguments.length&&arguments[1]!==void 0?arguments[1]:8,n=2<arguments.length&&arguments[2]!==void 0?arguments[2]:0,o=3<arguments.length&&arguments[3]!==void 0?arguments[3]:2*Math.PI;_classCallCheck2(this,t);e=a.call(this);e.type="CircleGeometry";e.parameters={radius:r,segments:i,thetaStart:n,thetaLength:o};i=Math.max(3,i);var l=[],d=[],c=[],u=[],p=new vs,m=new os;d.push(0,0,0);c.push(0,0,1);u.push(.5,.5);for(var g=0,s=3,f;g<=i;g++,s+=3){f=n+g/i*o;"void main() {\n\tgl_Position = vec4( position, 1.0 );\n}".x=r*Math.cos(f);"void main() {\n\tgl_Position = vec4( position, 1.0 );\n}".y=r*Math.sin(f);d.push("void main() {\n\tgl_Position = vec4( position, 1.0 );\n}".x,"void main() {\n\tgl_Position = vec4( position, 1.0 );\n}".y,"void main() {\n\tgl_Position = vec4( position, 1.0 );\n}".z);c.push(0,0,1);m.x=(d[s]/r+1)/2;m.y=(d[s+1]/r+1)/2;u.push(m.x,m.y)}for(var h=1;h<=i;h++){l.push(h,h+1,0)}e.setIndex(l);e.setAttribute("position",new Yl(d,3));e.setAttribute("normal",new Yl(c,3));e.setAttribute("uv",new Yl(u,2));return e}_createClass2(t,null,[{key:"fromJSON",value:function fromJSON(e){return new t(e.radius,e.segments,e.thetaStart,e.thetaLength)}}]);return t}(rd),Fu=function(e){_inherits(t,e);var a=_createSuper(t);function t(){var i,n=0<arguments.length&&arguments[0]!==void 0?arguments[0]:1,o=1<arguments.length&&arguments[1]!==void 0?arguments[1]:1,s=2<arguments.length&&arguments[2]!==void 0?arguments[2]:1,l=3<arguments.length&&arguments[3]!==void 0?arguments[3]:8,p=4<arguments.length&&arguments[4]!==void 0?arguments[4]:1,m=5<arguments.length&&arguments[5]!==void 0?arguments[5]:!1,g=6<arguments.length&&arguments[6]!==void 0?arguments[6]:0,f=7<arguments.length&&arguments[7]!==void 0?arguments[7]:2*Math.PI;_classCallCheck2(this,t);i=a.call(this);i.type="CylinderGeometry";i.parameters={radiusTop:n,radiusBottom:o,height:s,radialSegments:l,heightSegments:p,openEnded:m,thetaStart:g,thetaLength:f};var h=_assertThisInitialized(i);l=Math.floor(l);p=Math.floor(p);var y=[],_=[],b=[],S=[],M=0,T=[],E=s/2,w=0;e();if(!1===m){if(0<n)r(!0);if(0<o)r(!1)}i.setIndex(y);i.setAttribute("position",new Yl(_,3));i.setAttribute("normal",new Yl(b,3));i.setAttribute("uv",new Yl(S,2));function e(){for(var e=new vs,t=new vs,r=0,i=0;i<=p;i++){for(var m=[],A=i/p,v=A*(o-n)+n,k=0;k<=l;k++){var C=k/l,u=C*f+g,R=Math.sin(u),L=Math.cos(u);t.x=v*R;t.y=-A*s+E;t.z=v*L;_.push(t.x,t.y,t.z);e.set(R,(o-n)/s,L).normalize();b.push(e.x,e.y,e.z);S.push(C,1-A);m.push(M++)}T.push(m)}for(var d=0;d<l;d++){for(var D=0;D<p;D++){var P=T[D][d],a=T[D+1][d],I=T[D+1][d+1],c=T[D][d+1];y.push(P,a,c);y.push(a,I,c);r+=6}}h.addGroup(w,r,0);w+=r}function r(e){for(var t=M,a=new os,r=new vs,i=0,s=!0===e?n:o,d=!0===e?1:-1,p=1;p<=l;p++){_.push(0,E*d,0);b.push(0,d,0);S.push(.5,.5);M++}for(var m=M,v=0;v<=l;v++){var T=v/l,u=T*f+g,A=Math.cos(u),k=Math.sin(u);r.x=s*k;r.y=E*d;r.z=s*A;_.push(r.x,r.y,r.z);b.push(0,d,0);a.x=.5*A+.5;a.y=.5*k*d+.5;S.push(a.x,a.y);M++}for(var R=0;R<l;R++){var C=t+R,c=m+R;if(!0===e){y.push(c,c+1,C)}else{y.push(c+1,c,C)}i+=3}h.addGroup(w,i,!0===e?1:2);w+=i}return i}_createClass2(t,null,[{key:"fromJSON",value:function fromJSON(e){return new t(e.radiusTop,e.radiusBottom,e.height,e.radialSegments,e.heightSegments,e.openEnded,e.thetaStart,e.thetaLength)}}]);return t}(rd),Ou=function(e){_inherits(t,e);var a=_createSuper(t);function t(){var e,r=0<arguments.length&&arguments[0]!==void 0?arguments[0]:1,i=1<arguments.length&&arguments[1]!==void 0?arguments[1]:1,n=2<arguments.length&&arguments[2]!==void 0?arguments[2]:8,o=3<arguments.length&&arguments[3]!==void 0?arguments[3]:1,s=4<arguments.length&&arguments[4]!==void 0?arguments[4]:!1,l=5<arguments.length&&arguments[5]!==void 0?arguments[5]:0,d=6<arguments.length&&arguments[6]!==void 0?arguments[6]:2*Math.PI;_classCallCheck2(this,t);e=a.call(this,0,r,i,n,o,s,l,d);e.type="ConeGeometry";e.parameters={radius:r,height:i,radialSegments:n,heightSegments:o,openEnded:s,thetaStart:l,thetaLength:d};return e}_createClass2(t,null,[{key:"fromJSON",value:function fromJSON(e){return new t(e.radius,e.height,e.radialSegments,e.heightSegments,e.openEnded,e.thetaStart,e.thetaLength)}}]);return t}(Fu),Bu=function(e){_inherits(t,e);var a=_createSuper(t);function t(){var c,u=0<arguments.length&&arguments[0]!==void 0?arguments[0]:[],p=1<arguments.length&&arguments[1]!==void 0?arguments[1]:[],m=2<arguments.length&&arguments[2]!==void 0?arguments[2]:1,g=3<arguments.length&&arguments[3]!==void 0?arguments[3]:0;_classCallCheck2(this,t);c=a.call(this);c.type="PolyhedronGeometry";c.parameters={vertices:u,indices:p,radius:m,detail:g};var f=[],h=[];(function(t){for(var r=new vs,a=new vs,i=new vs,o=0;o<p.length;o+=3){n(p[o+0],r);n(p[o+1],a);n(p[o+2],i);e(r,a,i,t)}})(g);(function(e){for(var t=new vs,a=0;a<f.length;a+=3){t.x=f[a+0];t.y=f[a+1];t.z=f[a+2];t.normalize().multiplyScalar(e);f[a+0]=t.x;f[a+1]=t.y;f[a+2]=t.z}})(m);(function(){for(var e=new vs,t=0;t<f.length;t+=3){e.x=f[t+0];e.y=f[t+1];e.z=f[t+2];var a=l(e)/2/Math.PI+.5,i=d(e)/Math.PI+.5;h.push(a,1-i)}o();r()})();c.setAttribute("position",new Yl(f,3));c.setAttribute("normal",new Yl(f.slice(),3));c.setAttribute("uv",new Yl(h,2));if(0===g){c.computeVertexNormals()}else{c.normalizeNormals()}function e(e,t,a,r){for(var n=r+1,o=[],s=0;s<=n;s++){o[s]=[];for(var l=e.clone().lerp(a,s/n),d=t.clone().lerp(a,s/n),c=n-s,u=0;u<=c;u++){if(0==u&&s===n){o[s][u]=l}else{o[s][u]=l.clone().lerp(d,u/c)}}}for(var p=0;p<n;p++){for(var m=0,g;m<2*(n-p)-1;m++){g=Math.floor(m/2);if(0==m%2){i(o[p][g+1]);i(o[p+1][g]);i(o[p][g])}else{i(o[p][g+1]);i(o[p+1][g+1]);i(o[p+1][g])}}}}function r(){for(var n=0;n<h.length;n+=6){var e=h[n+0],t=h[n+2],a=h[n+4],r=Math.max(e,t,a),i=Math.min(e,t,a);if(.9<r&&.1>i){if(.2>e)h[n+0]+=1;if(.2>t)h[n+2]+=1;if(.2>a)h[n+4]+=1}}}function i(e){f.push(e.x,e.y,e.z)}function n(e,t){var a=3*e;t.x=u[a+0];t.y=u[a+1];t.z=u[a+2]}function o(){for(var e=new vs,t=new vs,a=new vs,r=new vs,i=new os,n=new os,o=new os,d=0,c=0;d<f.length;d+=9,c+=6){e.set(f[d+0],f[d+1],f[d+2]);t.set(f[d+3],f[d+4],f[d+5]);a.set(f[d+6],f[d+7],f[d+8]);i.set(h[c+0],h[c+1]);n.set(h[c+2],h[c+3]);o.set(h[c+4],h[c+5]);r.copy(e).add(t).add(a).divideScalar(3);var u=l(r);s(i,c+0,e,u);s(n,c+2,t,u);s(o,c+4,a,u)}}function s(e,t,a,r){if(0>r&&1===e.x){h[t]=e.x-1}if(0===a.x&&0===a.z){h[t]=r/2/Math.PI+.5}}function l(e){return Math.atan2(e.z,-e.x)}function d(e){return Math.atan2(-e.y,Math.sqrt(e.x*e.x+e.z*e.z))}return c}_createClass2(t,null,[{key:"fromJSON",value:function fromJSON(e){return new t(e.vertices,e.indices,e.radius,e.details)}}]);return t}(rd),Uu=function(e){_inherits(a,e);var i=_createSuper(a);function a(){var e,n=0<arguments.length&&arguments[0]!==void 0?arguments[0]:1,o=1<arguments.length&&arguments[1]!==void 0?arguments[1]:0;_classCallCheck2(this,a);var s=(1+Math.sqrt(5))/2,t=1/s;e=i.call(this,[-1,-1,-1,-1,-1,1,-1,1,-1,-1,1,1,1,-1,-1,1,-1,1,1,1,-1,1,1,1,0,-t,-s,0,-t,s,0,t,-s,0,t,s,-t,-s,0,-t,s,0,t,-s,0,t,s,0,-s,0,-t,s,0,-t,-s,0,t,s,0,t],[3,11,7,3,7,15,3,15,13,7,19,17,7,17,6,7,6,15,17,4,8,17,8,10,17,10,6,8,0,16,8,16,2,8,2,10,0,12,1,0,1,18,0,18,16,6,10,2,6,2,13,6,13,15,2,16,18,2,18,3,2,3,13,18,1,9,18,9,11,18,11,3,4,14,12,4,12,0,4,0,8,11,9,5,11,5,19,11,19,7,19,5,14,19,14,4,19,4,17,1,12,14,1,14,5,1,5,9],n,o);e.type="DodecahedronGeometry";e.parameters={radius:n,detail:o};return e}_createClass2(a,null,[{key:"fromJSON",value:function fromJSON(e){return new a(e.radius,e.detail)}}]);return a}(Bu),Gu=new vs,Hu=new vs,Vu=new vs,Wu=new Cl,ju=function(e){_inherits(t,e);var r=_createSuper(t);function t(){var e,i=0<arguments.length&&arguments[0]!==void 0?arguments[0]:null,n=1<arguments.length&&arguments[1]!==void 0?arguments[1]:1;_classCallCheck2(this,t);e=r.call(this);e.type="EdgesGeometry";e.parameters={geometry:i,thresholdAngle:n};if(null!==i){for(var o=Math.pow(10,4),s=Math.cos(rs*n),l=i.getIndex(),d=i.getAttribute("position"),u=l?l.count:d.count,p=[0,0,0],m=["a","b","c"],g=[,,,],f={},h=[],y=0;y<u;y+=3){if(l){p[0]=l.getX(y);p[1]=l.getX(y+1);p[2]=l.getX(y+2)}else{p[0]=y;p[1]=y+1;p[2]=y+2}var v=Wu.a,a=Wu.b,_=Wu.c;v.fromBufferAttribute(d,p[0]);a.fromBufferAttribute(d,p[1]);_.fromBufferAttribute(d,p[2]);Wu.getNormal(Vu);g[0]="".concat(Math.round(v.x*o),",").concat(Math.round(v.y*o),",").concat(Math.round(v.z*o));g[1]="".concat(Math.round(a.x*o),",").concat(Math.round(a.y*o),",").concat(Math.round(a.z*o));g[2]="".concat(Math.round(_.x*o),",").concat(Math.round(_.y*o),",").concat(Math.round(_.z*o));if(g[0]===g[1]||g[1]===g[2]||g[2]===g[0]){continue}for(var C=0;3>C;C++){var c=(C+1)%3,x=g[C],b=g[c],S=Wu[m[C]],M=Wu[m[c]],T="".concat(x,"_").concat(b),E="".concat(b,"_").concat(x);if(E in f&&f[E]){if(Vu.dot(f[E].normal)<=s){h.push(S.x,S.y,S.z);h.push(M.x,M.y,M.z)}f[E]=null}else if(!(T in f)){f[T]={index0:p[C],index1:p[c],normal:Vu.clone()}}}}for(var R in f){if(f[R]){var w=f[R],A=w.index0,k=w.index1;Gu.fromBufferAttribute(d,A);Hu.fromBufferAttribute(d,k);h.push(Gu.x,Gu.y,Gu.z);h.push(Hu.x,Hu.y,Hu.z)}}e.setAttribute("position",new Yl(h,3))}return e}return t}(rd),qu=function(){function e(){_classCallCheck2(this,e);this.type="Curve";this.arcLengthDivisions=200}_createClass2(e,[{key:"getPoint",value:function getPoint(){console.warn("THREE.Curve: .getPoint() not implemented.");return null}},{key:"getPointAt",value:function getPointAt(e,a){var r=this.getUtoTmapping(e);return this.getPoint(r,a)}},{key:"getPoints",value:function getPoints(){for(var e=0<arguments.length&&arguments[0]!==void 0?arguments[0]:5,t=[],a=0;a<=e;a++){t.push(this.getPoint(a/e))}return t}},{key:"getSpacedPoints",value:function getSpacedPoints(){for(var e=0<arguments.length&&arguments[0]!==void 0?arguments[0]:5,t=[],a=0;a<=e;a++){t.push(this.getPointAt(a/e))}return t}},{key:"getLength",value:function getLength(){var e=this.getLengths();return e[e.length-1]}},{key:"getLengths",value:function getLengths(){var e=0<arguments.length&&arguments[0]!==void 0?arguments[0]:this.arcLengthDivisions;if(this.cacheArcLengths&&this.cacheArcLengths.length===e+1&&!this.needsUpdate){return this.cacheArcLengths}this.needsUpdate=!1;var t=[],a,r=this.getPoint(0),i=0;t.push(0);for(var n=1;n<=e;n++){a=this.getPoint(n/e);i+=a.distanceTo(r);t.push(i);r=a}this.cacheArcLengths=t;return t}},{key:"updateArcLengths",value:function updateArcLengths(){this.needsUpdate=!0;this.getLengths()}},{key:"getUtoTmapping",value:function getUtoTmapping(e,a){var r=this.getLengths(),n=0,o=r.length,s;if(a){s=a}else{s=e*r[o-1]}var l=0,d=o-1,c;while(l<=d){n=Math.floor(l+(d-l)/2);c=r[n]-s;if(0>c){l=n+1}else if(0<c){d=n-1}else{d=n;break}}n=d;if(r[n]===s){return n/(o-1)}var u=r[n],p=r[n+1],m=(s-u)/(p-u),g=(n+m)/(o-1);return g}},{key:"getTangent",value:function getTangent(e,t){var a=1e-4,r=e-a,i=e+a;if(0>r)r=0;if(1<i)i=1;var n=this.getPoint(r),o=this.getPoint(i),s=t||(n.isVector2?new os:new vs);s.copy(o).sub(n).normalize();return s}},{key:"getTangentAt",value:function getTangentAt(e,a){var r=this.getUtoTmapping(e);return this.getTangent(r,a)}},{key:"computeFrenetFrames",value:function computeFrenetFrames(e,t){for(var r=new vs,i=[],n=[],o=[],s=new vs,l=new Ys,d=0,c;d<=e;d++){c=d/e;i[d]=this.getTangentAt(c,new vs)}n[0]=new vs;o[0]=new vs;var p=Number.MAX_VALUE,m=Math.abs(i[0].x),g=Math.abs(i[0].y),f=Math.abs(i[0].z);if(m<=p){p=m;r.set(1,0,0)}if(g<=p){p=g;r.set(0,1,0)}if(f<=p){r.set(0,0,1)}s.crossVectors(i[0],r).normalize();n[0].crossVectors(i[0],s);o[0].crossVectors(i[0],n[0]);for(var h=1;h<=e;h++){n[h]=n[h-1].clone();o[h]=o[h-1].clone();s.crossVectors(i[h-1],i[h]);if(s.length()>Number.EPSILON){s.normalize();var y=Math.acos(a(i[h-1].dot(i[h]),-1,1));n[h].applyMatrix4(l.makeRotationAxis(s,y))}o[h].crossVectors(i[h],n[h])}if(!0===t){var v=Math.acos(a(n[0].dot(n[e]),-1,1));v/=e;if(0<i[0].dot(s.crossVectors(n[0],n[e]))){v=-v}for(var _=1;_<=e;_++){n[_].applyMatrix4(l.makeRotationAxis(i[_],v*_));o[_].crossVectors(i[_],n[_])}}return{tangents:i,normals:n,binormals:o}}},{key:"clone",value:function clone(){return new this.constructor().copy(this)}},{key:"copy",value:function copy(e){this.arcLengthDivisions=e.arcLengthDivisions;return this}},{key:"toJSON",value:function toJSON(){var e={metadata:{version:4.5,type:"Curve",generator:"Curve.toJSON"},arcLengthDivisions:this.arcLengthDivisions,type:this.type};return e}},{key:"fromJSON",value:function fromJSON(e){this.arcLengthDivisions=e.arcLengthDivisions;return this}}]);return e}(),Xu=function(e){_inherits(t,e);var a=_createSuper(t);function t(){var e,r=0<arguments.length&&arguments[0]!==void 0?arguments[0]:0,i=1<arguments.length&&arguments[1]!==void 0?arguments[1]:0,n=2<arguments.length&&arguments[2]!==void 0?arguments[2]:1,o=3<arguments.length&&arguments[3]!==void 0?arguments[3]:1,s=4<arguments.length&&arguments[4]!==void 0?arguments[4]:0,l=5<arguments.length&&arguments[5]!==void 0?arguments[5]:2*Math.PI,d=6<arguments.length&&arguments[6]!==void 0?arguments[6]:!1,c=7<arguments.length&&arguments[7]!==void 0?arguments[7]:0;_classCallCheck2(this,t);e=a.call(this);e.type="EllipseCurve";e.aX=r;e.aY=i;e.xRadius=n;e.yRadius=o;e.aStartAngle=s;e.aEndAngle=l;e.aClockwise=d;e.aRotation=c;return e}_createClass2(t,[{key:"getPoint",value:function getPoint(e,t){var a=t||new os,r=2*Math.PI,i=this.aEndAngle-this.aStartAngle,n=Math.abs(i)<Number.EPSILON;while(0>i){i+=r}while(i>r){i-=r}if(i<Number.EPSILON){if(n){i=0}else{i=r}}if(!0===this.aClockwise&&!n){if(i===r){i=-r}else{i=i-r}}var o=this.aStartAngle+e*i,s=this.aX+this.xRadius*Math.cos(o),l=this.aY+this.yRadius*Math.sin(o);if(0!==this.aRotation){var d=Math.cos(this.aRotation),c=Math.sin(this.aRotation),u=s-this.aX,p=l-this.aY;s=u*d-p*c+this.aX;l=u*c+p*d+this.aY}return a.set(s,l)}},{key:"copy",value:function copy(e){_get(_getPrototypeOf(t.prototype),"copy",this).call(this,e);this.aX=e.aX;this.aY=e.aY;this.xRadius=e.xRadius;this.yRadius=e.yRadius;this.aStartAngle=e.aStartAngle;this.aEndAngle=e.aEndAngle;this.aClockwise=e.aClockwise;this.aRotation=e.aRotation;return this}},{key:"toJSON",value:function toJSON(){var e=_get(_getPrototypeOf(t.prototype),"toJSON",this).call(this);e.aX=this.aX;e.aY=this.aY;e.xRadius=this.xRadius;e.yRadius=this.yRadius;e.aStartAngle=this.aStartAngle;e.aEndAngle=this.aEndAngle;e.aClockwise=this.aClockwise;e.aRotation=this.aRotation;return e}},{key:"fromJSON",value:function fromJSON(e){_get(_getPrototypeOf(t.prototype),"fromJSON",this).call(this,e);this.aX=e.aX;this.aY=e.aY;this.xRadius=e.xRadius;this.yRadius=e.yRadius;this.aStartAngle=e.aStartAngle;this.aEndAngle=e.aEndAngle;this.aClockwise=e.aClockwise;this.aRotation=e.aRotation;return this}}]);return t}(qu);Xu.prototype.isEllipseCurve=!0;var Yu=function(e){_inherits(t,e);var a=_createSuper(t);function t(e,r,i,n,o,s){var l;_classCallCheck2(this,t);l=a.call(this,e,r,i,i,n,o,s);l.type="ArcCurve";return l}return t}(Xu);Yu.prototype.isArcCurve=!0;function Bt(){var a=0,r=0,i=0,n=0;function e(e,t,o,s){a=e;r=o;i=-3*e+3*t-2*o-s;n=2*e-2*t+o+s}return{initCatmullRom:function initCatmullRom(t,a,r,i,n){e(a,r,n*(r-t),n*(i-a))},initNonuniformCatmullRom:function initNonuniformCatmullRom(t,a,r,i,n,o,s){var l=(a-t)/n-(r-t)/(n+o)+(r-a)/o,d=(r-a)/o-(i-a)/(o+s)+(i-r)/s;l*=o;d*=o;e(a,r,l,d)},calc:function calc(e){var t=e*e;return a+r*e+i*t+n*(t*e)}}}var Zu=new vs,Ju=new Bt,Qu=new Bt,Ku=new Bt,$u=function(e){_inherits(t,e);var a=_createSuper(t);function t(){var e,r=0<arguments.length&&arguments[0]!==void 0?arguments[0]:[],i=1<arguments.length&&arguments[1]!==void 0?arguments[1]:!1,n=2<arguments.length&&arguments[2]!==void 0?arguments[2]:"centripetal",o=3<arguments.length&&arguments[3]!==void 0?arguments[3]:.5;_classCallCheck2(this,t);e=a.call(this);e.type="CatmullRomCurve3";e.points=r;e.closed=i;e.curveType=n;e.tension=o;return e}_createClass2(t,[{key:"getPoint",value:function getPoint(e){var t=1<arguments.length&&arguments[1]!==void 0?arguments[1]:new vs,a=t,r=this.points,i=r.length,n=(i-(this.closed?0:1))*e,o=Math.floor(n),s=n-o;if(this.closed){o+=0<o?0:(Math.floor(Math.abs(o)/i)+1)*i}else if(0===s&&o===i-1){o=i-2;s=1}var l,d;if(this.closed||0<o){l=r[(o-1)%i]}else{Zu.subVectors(r[0],r[1]).add(r[0]);l=Zu}var c=r[o%i],u=r[(o+1)%i];if(this.closed||o+2<i){d=r[(o+2)%i]}else{Zu.subVectors(r[i-1],r[i-2]).add(r[i-1]);d=Zu}if("centripetal"===this.curveType||"chordal"===this.curveType){var p="chordal"===this.curveType?.5:.25,m=Math.pow(l.distanceToSquared(c),p),g=Math.pow(c.distanceToSquared(u),p),f=Math.pow(u.distanceToSquared(d),p);if(1e-4>g)g=1;if(1e-4>m)m=g;if(1e-4>f)f=g;Ju.initNonuniformCatmullRom(l.x,c.x,u.x,d.x,m,g,f);Qu.initNonuniformCatmullRom(l.y,c.y,u.y,d.y,m,g,f);Ku.initNonuniformCatmullRom(l.z,c.z,u.z,d.z,m,g,f)}else if("catmullrom"===this.curveType){Ju.initCatmullRom(l.x,c.x,u.x,d.x,this.tension);Qu.initCatmullRom(l.y,c.y,u.y,d.y,this.tension);Ku.initCatmullRom(l.z,c.z,u.z,d.z,this.tension)}a.set(Ju.calc(s),Qu.calc(s),Ku.calc(s));return a}},{key:"copy",value:function copy(e){_get(_getPrototypeOf(t.prototype),"copy",this).call(this,e);this.points=[];for(var a=0,r=e.points.length,i;a<r;a++){i=e.points[a];this.points.push(i.clone())}this.closed=e.closed;this.curveType=e.curveType;this.tension=e.tension;return this}},{key:"toJSON",value:function toJSON(){var e=_get(_getPrototypeOf(t.prototype),"toJSON",this).call(this);e.points=[];for(var a=0,r=this.points.length,i;a<r;a++){i=this.points[a];e.points.push(i.toArray())}e.closed=this.closed;e.curveType=this.curveType;e.tension=this.tension;return e}},{key:"fromJSON",value:function fromJSON(e){_get(_getPrototypeOf(t.prototype),"fromJSON",this).call(this,e);this.points=[];for(var a=0,r=e.points.length,i;a<r;a++){i=e.points[a];this.points.push(new vs().fromArray(i))}this.closed=e.closed;this.curveType=e.curveType;this.tension=e.tension;return this}}]);return t}(qu);$u.prototype.isCatmullRomCurve3=!0;function Ut(e,t,a,r,i){var n=.5*(r-t),o=.5*(i-a),s=e*e;return(2*a-2*r+n+o)*(e*s)+(-3*a+3*r-2*n-o)*s+n*e+a}function Gt(e,t){var a=1-e;return a*a*t}function Ht(e,t){return 2*(1-e)*e*t}function Vt(e,t){return e*e*t}function Wt(e,t,a,r){return Gt(e,t)+Ht(e,a)+Vt(e,r)}function jt(e,t){var a=1-e;return a*a*a*t}function qt(e,t){var a=1-e;return 3*a*a*e*t}function Xt(e,t){return 3*(1-e)*e*e*t}function Yt(e,t){return e*e*e*t}function Zt(e,t,a,r,i){return jt(e,t)+qt(e,a)+Xt(e,r)+Yt(e,i)}var ep=function(e){_inherits(t,e);var a=_createSuper(t);function t(){var e,r=0<arguments.length&&arguments[0]!==void 0?arguments[0]:new os,i=1<arguments.length&&arguments[1]!==void 0?arguments[1]:new os,n=2<arguments.length&&arguments[2]!==void 0?arguments[2]:new os,o=3<arguments.length&&arguments[3]!==void 0?arguments[3]:new os;_classCallCheck2(this,t);e=a.call(this);e.type="CubicBezierCurve";e.v0=r;e.v1=i;e.v2=n;e.v3=o;return e}_createClass2(t,[{key:"getPoint",value:function getPoint(e){var t=1<arguments.length&&arguments[1]!==void 0?arguments[1]:new os,a=t,r=this.v0,i=this.v1,n=this.v2,o=this.v3;a.set(Zt(e,r.x,i.x,n.x,o.x),Zt(e,r.y,i.y,n.y,o.y));return a}},{key:"copy",value:function copy(e){_get(_getPrototypeOf(t.prototype),"copy",this).call(this,e);this.v0.copy(e.v0);this.v1.copy(e.v1);this.v2.copy(e.v2);this.v3.copy(e.v3);return this}},{key:"toJSON",value:function toJSON(){var e=_get(_getPrototypeOf(t.prototype),"toJSON",this).call(this);e.v0=this.v0.toArray();e.v1=this.v1.toArray();e.v2=this.v2.toArray();e.v3=this.v3.toArray();return e}},{key:"fromJSON",value:function fromJSON(e){_get(_getPrototypeOf(t.prototype),"fromJSON",this).call(this,e);this.v0.fromArray(e.v0);this.v1.fromArray(e.v1);this.v2.fromArray(e.v2);this.v3.fromArray(e.v3);return this}}]);return t}(qu);ep.prototype.isCubicBezierCurve=!0;var tp=function(e){_inherits(t,e);var a=_createSuper(t);function t(){var e,r=0<arguments.length&&arguments[0]!==void 0?arguments[0]:new vs,i=1<arguments.length&&arguments[1]!==void 0?arguments[1]:new vs,n=2<arguments.length&&arguments[2]!==void 0?arguments[2]:new vs,o=3<arguments.length&&arguments[3]!==void 0?arguments[3]:new vs;_classCallCheck2(this,t);e=a.call(this);e.type="CubicBezierCurve3";e.v0=r;e.v1=i;e.v2=n;e.v3=o;return e}_createClass2(t,[{key:"getPoint",value:function getPoint(e){var t=1<arguments.length&&arguments[1]!==void 0?arguments[1]:new vs,a=t,r=this.v0,i=this.v1,n=this.v2,o=this.v3;a.set(Zt(e,r.x,i.x,n.x,o.x),Zt(e,r.y,i.y,n.y,o.y),Zt(e,r.z,i.z,n.z,o.z));return a}},{key:"copy",value:function copy(e){_get(_getPrototypeOf(t.prototype),"copy",this).call(this,e);this.v0.copy(e.v0);this.v1.copy(e.v1);this.v2.copy(e.v2);this.v3.copy(e.v3);return this}},{key:"toJSON",value:function toJSON(){var e=_get(_getPrototypeOf(t.prototype),"toJSON",this).call(this);e.v0=this.v0.toArray();e.v1=this.v1.toArray();e.v2=this.v2.toArray();e.v3=this.v3.toArray();return e}},{key:"fromJSON",value:function fromJSON(e){_get(_getPrototypeOf(t.prototype),"fromJSON",this).call(this,e);this.v0.fromArray(e.v0);this.v1.fromArray(e.v1);this.v2.fromArray(e.v2);this.v3.fromArray(e.v3);return this}}]);return t}(qu);tp.prototype.isCubicBezierCurve3=!0;var ap=function(e){_inherits(t,e);var a=_createSuper(t);function t(){var e,r=0<arguments.length&&arguments[0]!==void 0?arguments[0]:new os,i=1<arguments.length&&arguments[1]!==void 0?arguments[1]:new os;_classCallCheck2(this,t);e=a.call(this);e.type="LineCurve";e.v1=r;e.v2=i;return e}_createClass2(t,[{key:"getPoint",value:function getPoint(e){var t=1<arguments.length&&arguments[1]!==void 0?arguments[1]:new os,a=t;if(1===e){a.copy(this.v2)}else{a.copy(this.v2).sub(this.v1);a.multiplyScalar(e).add(this.v1)}return a}},{key:"getPointAt",value:function getPointAt(e,t){return this.getPoint(e,t)}},{key:"getTangent",value:function getTangent(e,t){var a=t||new os;a.copy(this.v2).sub(this.v1).normalize();return a}},{key:"copy",value:function copy(e){_get(_getPrototypeOf(t.prototype),"copy",this).call(this,e);this.v1.copy(e.v1);this.v2.copy(e.v2);return this}},{key:"toJSON",value:function toJSON(){var e=_get(_getPrototypeOf(t.prototype),"toJSON",this).call(this);e.v1=this.v1.toArray();e.v2=this.v2.toArray();return e}},{key:"fromJSON",value:function fromJSON(e){_get(_getPrototypeOf(t.prototype),"fromJSON",this).call(this,e);this.v1.fromArray(e.v1);this.v2.fromArray(e.v2);return this}}]);return t}(qu);ap.prototype.isLineCurve=!0;var rp=function(e){_inherits(t,e);var a=_createSuper(t);function t(){var e,r=0<arguments.length&&arguments[0]!==void 0?arguments[0]:new vs,i=1<arguments.length&&arguments[1]!==void 0?arguments[1]:new vs;_classCallCheck2(this,t);e=a.call(this);e.type="LineCurve3";e.isLineCurve3=!0;e.v1=r;e.v2=i;return e}_createClass2(t,[{key:"getPoint",value:function getPoint(e){var t=1<arguments.length&&arguments[1]!==void 0?arguments[1]:new vs,a=t;if(1===e){a.copy(this.v2)}else{a.copy(this.v2).sub(this.v1);a.multiplyScalar(e).add(this.v1)}return a}},{key:"getPointAt",value:function getPointAt(e,t){return this.getPoint(e,t)}},{key:"copy",value:function copy(e){_get(_getPrototypeOf(t.prototype),"copy",this).call(this,e);this.v1.copy(e.v1);this.v2.copy(e.v2);return this}},{key:"toJSON",value:function toJSON(){var e=_get(_getPrototypeOf(t.prototype),"toJSON",this).call(this);e.v1=this.v1.toArray();e.v2=this.v2.toArray();return e}},{key:"fromJSON",value:function fromJSON(e){_get(_getPrototypeOf(t.prototype),"fromJSON",this).call(this,e);this.v1.fromArray(e.v1);this.v2.fromArray(e.v2);return this}}]);return t}(qu),ip=function(e){_inherits(t,e);var a=_createSuper(t);function t(){var e,r=0<arguments.length&&arguments[0]!==void 0?arguments[0]:new os,i=1<arguments.length&&arguments[1]!==void 0?arguments[1]:new os,n=2<arguments.length&&arguments[2]!==void 0?arguments[2]:new os;_classCallCheck2(this,t);e=a.call(this);e.type="QuadraticBezierCurve";e.v0=r;e.v1=i;e.v2=n;return e}_createClass2(t,[{key:"getPoint",value:function getPoint(e){var t=1<arguments.length&&arguments[1]!==void 0?arguments[1]:new os,a=t,r=this.v0,i=this.v1,n=this.v2;a.set(Wt(e,r.x,i.x,n.x),Wt(e,r.y,i.y,n.y));return a}},{key:"copy",value:function copy(e){_get(_getPrototypeOf(t.prototype),"copy",this).call(this,e);this.v0.copy(e.v0);this.v1.copy(e.v1);this.v2.copy(e.v2);return this}},{key:"toJSON",value:function toJSON(){var e=_get(_getPrototypeOf(t.prototype),"toJSON",this).call(this);e.v0=this.v0.toArray();e.v1=this.v1.toArray();e.v2=this.v2.toArray();return e}},{key:"fromJSON",value:function fromJSON(e){_get(_getPrototypeOf(t.prototype),"fromJSON",this).call(this,e);this.v0.fromArray(e.v0);this.v1.fromArray(e.v1);this.v2.fromArray(e.v2);return this}}]);return t}(qu);ip.prototype.isQuadraticBezierCurve=!0;var np=function(e){_inherits(t,e);var a=_createSuper(t);function t(){var e,r=0<arguments.length&&arguments[0]!==void 0?arguments[0]:new vs,i=1<arguments.length&&arguments[1]!==void 0?arguments[1]:new vs,n=2<arguments.length&&arguments[2]!==void 0?arguments[2]:new vs;_classCallCheck2(this,t);e=a.call(this);e.type="QuadraticBezierCurve3";e.v0=r;e.v1=i;e.v2=n;return e}_createClass2(t,[{key:"getPoint",value:function getPoint(e){var t=1<arguments.length&&arguments[1]!==void 0?arguments[1]:new vs,a=t,r=this.v0,i=this.v1,n=this.v2;a.set(Wt(e,r.x,i.x,n.x),Wt(e,r.y,i.y,n.y),Wt(e,r.z,i.z,n.z));return a}},{key:"copy",value:function copy(e){_get(_getPrototypeOf(t.prototype),"copy",this).call(this,e);this.v0.copy(e.v0);this.v1.copy(e.v1);this.v2.copy(e.v2);return this}},{key:"toJSON",value:function toJSON(){var e=_get(_getPrototypeOf(t.prototype),"toJSON",this).call(this);e.v0=this.v0.toArray();e.v1=this.v1.toArray();e.v2=this.v2.toArray();return e}},{key:"fromJSON",value:function fromJSON(e){_get(_getPrototypeOf(t.prototype),"fromJSON",this).call(this,e);this.v0.fromArray(e.v0);this.v1.fromArray(e.v1);this.v2.fromArray(e.v2);return this}}]);return t}(qu);np.prototype.isQuadraticBezierCurve3=!0;var op=function(e){_inherits(t,e);var a=_createSuper(t);function t(){var e,r=0<arguments.length&&arguments[0]!==void 0?arguments[0]:[];_classCallCheck2(this,t);e=a.call(this);e.type="SplineCurve";e.points=r;return e}_createClass2(t,[{key:"getPoint",value:function getPoint(e){var t=1<arguments.length&&arguments[1]!==void 0?arguments[1]:new os,a=t,r=this.points,i=(r.length-1)*e,n=Math.floor(i),o=i-n,s=r[0===n?n:n-1],l=r[n],d=r[n>r.length-2?r.length-1:n+1],c=r[n>r.length-3?r.length-1:n+2];a.set(Ut(o,s.x,l.x,d.x,c.x),Ut(o,s.y,l.y,d.y,c.y));return a}},{key:"copy",value:function copy(e){_get(_getPrototypeOf(t.prototype),"copy",this).call(this,e);this.points=[];for(var a=0,r=e.points.length,i;a<r;a++){i=e.points[a];this.points.push(i.clone())}return this}},{key:"toJSON",value:function toJSON(){var e=_get(_getPrototypeOf(t.prototype),"toJSON",this).call(this);e.points=[];for(var a=0,r=this.points.length,i;a<r;a++){i=this.points[a];e.points.push(i.toArray())}return e}},{key:"fromJSON",value:function fromJSON(e){_get(_getPrototypeOf(t.prototype),"fromJSON",this).call(this,e);this.points=[];for(var a=0,r=e.points.length,i;a<r;a++){i=e.points[a];this.points.push(new os().fromArray(i))}return this}}]);return t}(qu);op.prototype.isSplineCurve=!0;var sp=Object.freeze({__proto__:null,ArcCurve:Yu,CatmullRomCurve3:$u,CubicBezierCurve:ep,CubicBezierCurve3:tp,EllipseCurve:Xu,LineCurve:ap,LineCurve3:rp,QuadraticBezierCurve:ip,QuadraticBezierCurve3:np,SplineCurve:op}),lp=function(e){_inherits(t,e);var a=_createSuper(t);function t(){var e;_classCallCheck2(this,t);e=a.call(this);e.type="CurvePath";e.curves=[];e.autoClose=!1;return e}_createClass2(t,[{key:"add",value:function add(e){this.curves.push(e)}},{key:"closePath",value:function closePath(){var e=this.curves[0].getPoint(0),t=this.curves[this.curves.length-1].getPoint(1);if(!e.equals(t)){this.curves.push(new ap(t,e))}}},{key:"getPoint",value:function getPoint(e,t){var a=e*this.getLength(),r=this.getCurveLengths(),n=0;while(n<r.length){if(r[n]>=a){var o=r[n]-a,s=this.curves[n],l=s.getLength(),d=0===l?0:1-o/l;return s.getPointAt(d,t)}n++}return null}},{key:"getLength",value:function getLength(){var e=this.getCurveLengths();return e[e.length-1]}},{key:"updateArcLengths",value:function updateArcLengths(){this.needsUpdate=!0;this.cacheLengths=null;this.getCurveLengths()}},{key:"getCurveLengths",value:function getCurveLengths(){if(this.cacheLengths&&this.cacheLengths.length===this.curves.length){return this.cacheLengths}for(var e=[],t=0,a=0,r=this.curves.length;a<r;a++){t+=this.curves[a].getLength();e.push(t)}this.cacheLengths=e;return e}},{key:"getSpacedPoints",value:function getSpacedPoints(){for(var e=0<arguments.length&&arguments[0]!==void 0?arguments[0]:40,t=[],a=0;a<=e;a++){t.push(this.getPoint(a/e))}if(this.autoClose){t.push(t[0])}return t}},{key:"getPoints",value:function getPoints(){for(var e=0<arguments.length&&arguments[0]!==void 0?arguments[0]:12,t=[],a,r=0,i=this.curves;r<i.length;r++){for(var n=i[r],o=n&&n.isEllipseCurve?2*e:n&&(n.isLineCurve||n.isLineCurve3)?1:n&&n.isSplineCurve?e*n.points.length:e,s=n.getPoints(o),l=0,d;l<s.length;l++){d=s[l];if(a&&a.equals(d))continue;t.push(d);a=d}}if(this.autoClose&&1<t.length&&!t[t.length-1].equals(t[0])){t.push(t[0])}return t}},{key:"copy",value:function copy(e){_get(_getPrototypeOf(t.prototype),"copy",this).call(this,e);this.curves=[];for(var a=0,r=e.curves.length,i;a<r;a++){i=e.curves[a];this.curves.push(i.clone())}this.autoClose=e.autoClose;return this}},{key:"toJSON",value:function toJSON(){var e=_get(_getPrototypeOf(t.prototype),"toJSON",this).call(this);e.autoClose=this.autoClose;e.curves=[];for(var a=0,r=this.curves.length,i;a<r;a++){i=this.curves[a];e.curves.push(i.toJSON())}return e}},{key:"fromJSON",value:function fromJSON(e){_get(_getPrototypeOf(t.prototype),"fromJSON",this).call(this,e);this.autoClose=e.autoClose;this.curves=[];for(var a=0,r=e.curves.length,i;a<r;a++){i=e.curves[a];this.curves.push(new sp[i.type]().fromJSON(i))}return this}}]);return t}(qu),dp=function(e){_inherits(t,e);var a=_createSuper(t);function t(e){var r;_classCallCheck2(this,t);r=a.call(this);r.type="Path";r.currentPoint=new os;if(e){r.setFromPoints(e)}return r}_createClass2(t,[{key:"setFromPoints",value:function setFromPoints(e){this.moveTo(e[0].x,e[0].y);for(var t=1,a=e.length;t<a;t++){this.lineTo(e[t].x,e[t].y)}return this}},{key:"moveTo",value:function moveTo(e,t){this.currentPoint.set(e,t);return this}},{key:"lineTo",value:function lineTo(e,t){var a=new ap(this.currentPoint.clone(),new os(e,t));this.curves.push(a);this.currentPoint.set(e,t);return this}},{key:"quadraticCurveTo",value:function quadraticCurveTo(e,t,a,r){var i=new ip(this.currentPoint.clone(),new os(e,t),new os(a,r));this.curves.push(i);this.currentPoint.set(a,r);return this}},{key:"bezierCurveTo",value:function bezierCurveTo(e,t,a,r,i,n){var o=new ep(this.currentPoint.clone(),new os(e,t),new os(a,r),new os(i,n));this.curves.push(o);this.currentPoint.set(i,n);return this}},{key:"splineThru",value:function splineThru(e){var t=[this.currentPoint.clone()].concat(e),a=new op(t);this.curves.push(a);this.currentPoint.copy(e[e.length-1]);return this}},{key:"arc",value:function arc(e,t,a,r,i,n){var o=this.currentPoint.x,s=this.currentPoint.y;this.absarc(e+o,t+s,a,r,i,n);return this}},{key:"absarc",value:function absarc(e,t,a,r,i,n){this.absellipse(e,t,a,a,r,i,n);return this}},{key:"ellipse",value:function ellipse(e,t,a,r,i,n,o,s){var l=this.currentPoint.x,d=this.currentPoint.y;this.absellipse(e+l,t+d,a,r,i,n,o,s);return this}},{key:"absellipse",value:function absellipse(e,t,a,r,i,n,o,s){var l=new Xu(e,t,a,r,i,n,o,s);if(0<this.curves.length){var c=l.getPoint(0);if(!c.equals(this.currentPoint)){this.lineTo(c.x,c.y)}}this.curves.push(l);var d=l.getPoint(1);this.currentPoint.copy(d);return this}},{key:"copy",value:function copy(e){_get(_getPrototypeOf(t.prototype),"copy",this).call(this,e);this.currentPoint.copy(e.currentPoint);return this}},{key:"toJSON",value:function toJSON(){var e=_get(_getPrototypeOf(t.prototype),"toJSON",this).call(this);e.currentPoint=this.currentPoint.toArray();return e}},{key:"fromJSON",value:function fromJSON(e){_get(_getPrototypeOf(t.prototype),"fromJSON",this).call(this,e);this.currentPoint.fromArray(e.currentPoint);return this}}]);return t}(lp),cp=function(e){_inherits(a,e);var r=_createSuper(a);function a(e){var i;_classCallCheck2(this,a);i=r.call(this,e);i.uuid=t();i.type="Shape";i.holes=[];return i}_createClass2(a,[{key:"getPointsHoles",value:function getPointsHoles(e){for(var t=[],a=0,r=this.holes.length;a<r;a++){t[a]=this.holes[a].getPoints(e)}return t}},{key:"extractPoints",value:function extractPoints(e){return{shape:this.getPoints(e),holes:this.getPointsHoles(e)}}},{key:"copy",value:function copy(e){_get(_getPrototypeOf(a.prototype),"copy",this).call(this,e);this.holes=[];for(var t=0,r=e.holes.length,i;t<r;t++){i=e.holes[t];this.holes.push(i.clone())}return this}},{key:"toJSON",value:function toJSON(){var e=_get(_getPrototypeOf(a.prototype),"toJSON",this).call(this);e.uuid=this.uuid;e.holes=[];for(var t=0,r=this.holes.length,i;t<r;t++){i=this.holes[t];e.holes.push(i.toJSON())}return e}},{key:"fromJSON",value:function fromJSON(e){_get(_getPrototypeOf(a.prototype),"fromJSON",this).call(this,e);this.uuid=e.uuid;this.holes=[];for(var t=0,r=e.holes.length,i;t<r;t++){i=e.holes[t];this.holes.push(new dp().fromJSON(i))}return this}}]);return a}(dp),up={triangulate:function triangulate(e,t){var a=2<arguments.length&&arguments[2]!==void 0?arguments[2]:2,r=t&&t.length,i=r?t[0]*a:e.length,n=Jt(e,0,i,a,!0),o=[];if(!n||n.next===n.prev)return o;var s,l,d,c,u,p,m;if(r)n=ra(e,t,n,a);if(e.length>80*a){s=d=e[0];l=c=e[1];for(var g=a;g<i;g+=a){u=e[g];p=e[g+1];if(u<s)s=u;if(p<l)l=p;if(u>d)d=u;if(p>c)c=p}m=Math.max(d-s,c-l);m=0!==m?1/m:0}Kt(n,o,a,s,l,m);return o}};function Jt(e,t,a,r,n){var o,s;if(n===0<Aa(e,t,a,r)){for(o=t;o<a;o+=r){s=Ta(o,e[o],e[o+1],s)}}else{for(o=a-r;o>=t;o-=r){s=Ta(o,e[o],e[o+1],s)}}if(s&&fa(s,s.next)){Ea(s);s=s.next}return s}function Qt(e,t){if(!e)return e;if(!t)t=e;var a=e,r;do{r=!1;if(!a.steiner&&(fa(a,a.next)||0===ga(a.prev,a,a.next))){Ea(a);a=t=a.prev;if(a===a.next)break;r=!0}else{a=a.next}}while(r||a!==t);return t}function Kt(e,t,a,r,i,n,o){if(!e)return;if(!o&&n)la(e,r,i,n);var s=e,l,d;while(e.prev!==e.next){l=e.prev;d=e.next;if(n?ea(e,r,i,n):$t(e)){t.push(l.i/a);t.push(e.i/a);t.push(d.i/a);Ea(e);e=d.next;s=d.next;continue}e=d;if(e===s){if(!o){Kt(Qt(e),t,a,r,i,n,1)}else if(1===o){e=ta(Qt(e),t,a);Kt(e,t,a,r,i,n,2)}else if(2===o){aa(e,t,a,r,i,n)}break}}}function $t(e){var t=e.prev,a=e,r=e.next;if(0<=ga(t,a,r))return!1;var i=e.next.next;while(i!==e.prev){if(pa(t.x,t.y,a.x,a.y,r.x,r.y,i.x,i.y)&&0<=ga(i.prev,i,i.next))return!1;i=i.next}return!0}function ea(e,t,r,i){var o=e.prev,a=e,s=e.next;if(0<=ga(o,a,s))return!1;var l=o.x<a.x?o.x<s.x?o.x:s.x:a.x<s.x?a.x:s.x,d=o.y<a.y?o.y<s.y?o.y:s.y:a.y<s.y?a.y:s.y,c=o.x>a.x?o.x>s.x?o.x:s.x:a.x>s.x?a.x:s.x,u=o.y>a.y?o.y>s.y?o.y:s.y:a.y>s.y?a.y:s.y,m=ca(l,d,t,r,i),g=ca(c,u,t,r,i),f=e.prevZ,h=e.nextZ;while(f&&f.z>=m&&h&&h.z<=g){if(f!==e.prev&&f!==e.next&&pa(o.x,o.y,a.x,a.y,s.x,s.y,f.x,f.y)&&0<=ga(f.prev,f,f.next))return!1;f=f.prevZ;if(h!==e.prev&&h!==e.next&&pa(o.x,o.y,a.x,a.y,s.x,s.y,h.x,h.y)&&0<=ga(h.prev,h,h.next))return!1;h=h.nextZ}while(f&&f.z>=m){if(f!==e.prev&&f!==e.next&&pa(o.x,o.y,a.x,a.y,s.x,s.y,f.x,f.y)&&0<=ga(f.prev,f,f.next))return!1;f=f.prevZ}while(h&&h.z<=g){if(h!==e.prev&&h!==e.next&&pa(o.x,o.y,a.x,a.y,s.x,s.y,h.x,h.y)&&0<=ga(h.prev,h,h.next))return!1;h=h.nextZ}return!0}function ta(e,t,r){var i=e;do{var n=i.prev,a=i.next.next;if(!fa(n,a)&&ha(n,i,i.next,a)&&ba(n,a)&&ba(a,n)){t.push(n.i/r);t.push(i.i/r);t.push(a.i/r);Ea(i);Ea(i.next);i=e=a}i=i.next}while(i!==e);return Qt(i)}function aa(e,t,r,i,n,o){var s=e;do{var l=s.next.next;while(l!==s.prev){if(s.i!==l.i&&ma(s,l)){var d=Ma(s,l);s=Qt(s,s.next);d=Qt(d,d.next);Kt(s,t,r,i,n,o);Kt(d,t,r,i,n,o);return}l=l.next}s=s.next}while(s!==e)}function ra(e,t,a,r){var n=[],o,s,l,d,c;for(o=0,s=t.length;o<s;o++){l=t[o]*r;d=o<s-1?t[o+1]*r:e.length;c=Jt(e,l,d,r,!1);if(c===c.next)c.steiner=!0;n.push(ua(c))}n.sort(ia);for(o=0;o<n.length;o++){na(n[o],a);a=Qt(a,a.next)}return a}function ia(e,t){return e.x-t.x}function na(e,t){t=oa(e,t);if(t){var a=Ma(t,e);Qt(t,t.next);Qt(a,a.next)}}function oa(e,t){var a=t,r=e.x,i=e.y,n=-Infinity,o;do{if(i<=a.y&&i>=a.next.y&&a.next.y!==a.y){var g=a.x+(i-a.y)*(a.next.x-a.x)/(a.next.y-a.y);if(g<=r&&g>n){n=g;if(g===r){if(i===a.y)return a;if(i===a.next.y)return a.next}o=a.x<a.next.x?a:a.next}}a=a.next}while(a!==t);if(!o)return null;if(r===n)return o;var s=o,l=o.x,d=o.y,c=1/0,u;a=o;do{if(r>=a.x&&a.x>=l&&r!==a.x&&pa(i<d?r:n,i,l,d,i<d?n:r,i,a.x,a.y)){u=Math.abs(i-a.y)/(r-a.x);if(ba(a,e)&&(u<c||u===c&&(a.x>o.x||a.x===o.x&&sa(o,a)))){o=a;c=u}}a=a.next}while(a!==s);return o}function sa(e,t){return 0>ga(e.prev,e,t.prev)&&0>ga(t.next,e,e.next)}function la(e,t,a,r){var i=e;do{if(null===i.z)i.z=ca(i.x,i.y,t,a,r);i.prevZ=i.prev;i.nextZ=i.next;i=i.next}while(i!==e);i.prevZ.nextZ=null;i.prevZ=null;da(i)}function da(t){var a,r,n,o,s,l,d,c,u=1;do{r=t;t=null;s=null;l=0;while(r){l++;n=r;d=0;for(a=0;a<u;a++){d++;n=n.nextZ;if(!n)break}c=u;while(0<d||0<c&&n){if(0!==d&&(0===c||!n||r.z<=n.z)){o=r;r=r.nextZ;d--}else{o=n;n=n.nextZ;c--}if(s)s.nextZ=o;else t=o;o.prevZ=s;s=o}r=n}s.nextZ=null;u*=2}while(1<l);return t}function ca(e,t,a,r,i){e=32767*(e-a)*i;t=32767*(t-r)*i;e=16711935&(e|e<<8);e=252645135&(e|e<<4);e=858993459&(e|e<<2);e=1431655765&(e|e<<1);t=16711935&(t|t<<8);t=252645135&(t|t<<4);t=858993459&(t|t<<2);t=1431655765&(t|t<<1);return e|t<<1}function ua(e){var t=e,a=e;do{if(t.x<a.x||t.x===a.x&&t.y<a.y)a=t;t=t.next}while(t!==e);return a}function pa(e,t,a,r,i,n,o,s){return 0<=(i-o)*(t-s)-(e-o)*(n-s)&&0<=(e-o)*(r-s)-(a-o)*(t-s)&&0<=(a-o)*(n-s)-(i-o)*(r-s)}function ma(e,t){return e.next.i!==t.i&&e.prev.i!==t.i&&!xa(e,t)&&(ba(e,t)&&ba(t,e)&&Sa(e,t)&&(ga(e.prev,e,t.prev)||ga(e,t.prev,t))||fa(e,t)&&0<ga(e.prev,e,e.next)&&0<ga(t.prev,t,t.next))}function ga(e,t,a){return(t.y-e.y)*(a.x-t.x)-(t.x-e.x)*(a.y-t.y)}function fa(e,t){return e.x===t.x&&e.y===t.y}function ha(e,t,a,r){var i=va(ga(e,t,a)),n=va(ga(e,t,r)),o=va(ga(a,r,e)),s=va(ga(a,r,t));if(i!==n&&o!==s)return!0;if(0===i&&ya(e,a,t))return!0;if(0===n&&ya(e,r,t))return!0;if(0===o&&ya(a,e,r))return!0;if(0===s&&ya(a,t,r))return!0;return!1}function ya(e,t,a){return t.x<=Math.max(e.x,a.x)&&t.x>=Math.min(e.x,a.x)&&t.y<=Math.max(e.y,a.y)&&t.y>=Math.min(e.y,a.y)}function va(e){return 0<e?1:0>e?-1:0}function xa(e,t){var a=e;do{if(a.i!==e.i&&a.next.i!==e.i&&a.i!==t.i&&a.next.i!==t.i&&ha(a,a.next,e,t))return!0;a=a.next}while(a!==e);return!1}function ba(e,t){return 0>ga(e.prev,e,e.next)?0<=ga(e,t,e.next)&&0<=ga(e,e.prev,t):0>ga(e,t,e.prev)||0>ga(e,e.next,t)}function Sa(e,t){var a=e,r=!1,i=(e.x+t.x)/2,n=(e.y+t.y)/2;do{if(a.y>n!=a.next.y>n&&a.next.y!==a.y&&i<(a.next.x-a.x)*(n-a.y)/(a.next.y-a.y)+a.x)r=!r;a=a.next}while(a!==e);return r}function Ma(e,t){var a=new wa(e.i,e.x,e.y),r=new wa(t.i,t.x,t.y),i=e.next,n=t.prev;e.next=t;t.prev=e;a.next=i;i.prev=a;r.next=a;a.prev=r;n.next=r;r.prev=n;return r}function Ta(e,t,a,r){var i=new wa(e,t,a);if(!r){i.prev=i;i.next=i}else{i.next=r.next;i.prev=r;r.next.prev=i;r.next=i}return i}function Ea(e){e.next.prev=e.prev;e.prev.next=e.next;if(e.prevZ)e.prevZ.nextZ=e.nextZ;if(e.nextZ)e.nextZ.prevZ=e.prevZ}function wa(e,t,a){this.i=e;this.x=t;this.y=a;this.prev=null;this.next=null;this.z=null;this.prevZ=null;this.nextZ=null;this.steiner=!1}function Aa(e,t,a,r){for(var i=0,n=t,o=a-r;n<a;n+=r){i+=(e[o]-e[n])*(e[n+1]+e[o+1]);o=n}return i}var pp=function(){function e(){_classCallCheck2(this,e)}_createClass2(e,null,[{key:"area",value:function(e){for(var t=e.length,r=0,i=t-1,n=0;n<t;i=n++){r+=e[i].x*e[n].y-e[n].x*e[i].y}return .5*r}},{key:"isClockWise",value:function isClockWise(t){return 0>e.area(t)}},{key:"triangulateShape",value:function triangulateShape(e,t){var a=[],r=[],i=[];ka(e);Ca(a,e);var n=e.length;t.forEach(ka);for(var l=0;l<t.length;l++){r.push(n);n+=t[l].length;Ca(a,t[l])}for(var o=up.triangulate(a,r),s=0;s<o.length;s+=3){i.push(o.slice(s,s+3))}return i}}]);return e}();function ka(e){var t=e.length;if(2<t&&e[t-1].equals(e[0])){e.pop()}}function Ca(e,t){for(var a=0;a<t.length;a++){e.push(t[a].x);e.push(t[a].y)}}var mp=function(e){_inherits(t,e);var a=_createSuper(t);function t(){var r,i=0<arguments.length&&arguments[0]!==void 0?arguments[0]:new cp([new os(.5,.5),new os(-.5,.5),new os(-.5,-.5),new os(.5,-.5)]),n=1<arguments.length&&arguments[1]!==void 0?arguments[1]:{};_classCallCheck2(this,t);r=a.call(this);r.type="ExtrudeGeometry";r.parameters={shapes:i,options:n};i=Array.isArray(i)?i:[i];for(var o=_assertThisInitialized(r),s=[],d=[],c=0,u=i.length,l;c<u;c++){l=i[c];e(l)}r.setAttribute("position",new Yl(s,3));r.setAttribute("uv",new Yl(d,2));r.computeVertexNormals();function e(e){var f=[],y=n.curveSegments!==void 0?n.curveSegments:12,v=n.steps!==void 0?n.steps:1,_=n.depth!==void 0?n.depth:1,x=n.bevelEnabled!==void 0?n.bevelEnabled:!0,S=n.bevelThickness!==void 0?n.bevelThickness:.2,M=n.bevelSize!==void 0?n.bevelSize:S-.1,T=n.bevelOffset!==void 0?n.bevelOffset:0,E=n.bevelSegments!==void 0?n.bevelSegments:3,w=n.extrudePath,A=n.UVGenerator!==void 0?n.UVGenerator:gp;if(n.amount!==void 0){console.warn("THREE.ExtrudeBufferGeometry: amount has been renamed to depth.");_=n.amount}var C,R=!1,L,P,I,D;if(w){C=w.getSpacedPoints(v);R=!0;x=!1;L=w.computeFrenetFrames(v,!1);P=new vs;I=new vs;D=new vs}if(!x){E=0;S=0;M=0;T=0}var N=e.extractPoints(y),F=N.shape,O=N.holes,B=!pp.isClockWise(F);if(B){F=F.reverse();for(var ve=0,h=O.length,_e;ve<h;ve++){_e=O[ve];if(pp.isClockWise(_e)){O[ve]=_e.reverse()}}}for(var U=pp.triangulateShape(F,O),G=F,H=0,V=O.length,W;H<V;H++){W=O[H];F=F.concat(W)}function a(e,t,a){if(!t)console.error("THREE.ExtrudeGeometry: vec does not exist");return t.clone().multiplyScalar(a).add(e)}var q=F.length,X=U.length;function r(e,t,a){var r,i,n,o=e.x-t.x,s=e.y-t.y,l=a.x-e.x,d=a.y-e.y,c=o*o+s*s;if(Math.abs(o*d-s*l)>Number.EPSILON){var u=Math.sqrt(c),p=Math.sqrt(l*l+d*d),m=t.x-s/u,g=t.y+o/u,f=a.x-d/p,h=a.y+l/p,y=((f-m)*d-(h-g)*l)/(o*d-s*l);r=m+o*y-e.x;i=g+s*y-e.y;var v=r*r+i*i;if(2>=v){return new os(r,i)}else{n=Math.sqrt(v/2)}}else{var _=!1;if(o>Number.EPSILON){if(l>Number.EPSILON){_=!0}}else{if(o<-Number.EPSILON){if(l<-Number.EPSILON){_=!0}}else{if(Math.sign(s)===Math.sign(d)){_=!0}}}if(_){r=-s;i=o;n=Math.sqrt(c)}else{r=o;i=s;n=Math.sqrt(c/2)}}return new os(r/n,i/n)}for(var Y=[],Z=0,J=G.length,Q=J-1,K=Z+1;Z<J;Z++,Q++,K++){if(Q===J)Q=0;if(K===J)K=0;Y[Z]=r(G[Z],G[Q],G[K])}for(var $=[],ee,te=Y.concat(),ae=0,re=O.length,ie;ae<re;ae++){ie=O[ae];ee=[];for(var xe=0,be=ie.length,Se=be-1,Me=xe+1;xe<be;xe++,Se++,Me++){if(Se===be)Se=0;if(Me===be)Me=0;ee[xe]=r(ie[xe],ie[Se],ie[Me])}$.push(ee);te=te.concat(ee)}for(var Te=0;Te<E;Te++){for(var ne=Te/E,t=S*Math.cos(ne*Math.PI/2),z=M*Math.sin(ne*Math.PI/2)+T,oe=0,se=G.length,le;oe<se;oe++){le=a(G[oe],Y[oe],z);c(le.x,le.y,-t)}for(var b=0,Ee=O.length,we;b<Ee;b++){we=O[b];ee=$[b];for(var Ae=0,ke=we.length,Ce;Ae<ke;Ae++){Ce=a(we[Ae],ee[Ae],z);c(Ce.x,Ce.y,-t)}}}for(var de=M+T,ce=0,ue;ce<q;ce++){ue=x?a(F[ce],te[ce],de):F[ce];if(!R){c(ue.x,ue.y,0)}else{I.copy(L.normals[0]).multiplyScalar(ue.x);P.copy(L.binormals[0]).multiplyScalar(ue.y);D.copy(C[0]).add(I).add(P);c(D.x,D.y,D.z)}}for(var Re=1;Re<=v;Re++){for(var Le=0,Pe;Le<q;Le++){Pe=x?a(F[Le],te[Le],de):F[Le];if(!R){c(Pe.x,Pe.y,_/v*Re)}else{I.copy(L.normals[Re]).multiplyScalar(Pe.x);P.copy(L.binormals[Re]).multiplyScalar(Pe.y);D.copy(C[Re]).add(I).add(P);c(D.x,D.y,D.z)}}}for(var Ie=E-1;0<=Ie;Ie--){for(var pe=Ie/E,me=S*Math.cos(pe*Math.PI/2),ge=M*Math.sin(pe*Math.PI/2)+T,fe=0,he=G.length,ye;fe<he;fe++){ye=a(G[fe],Y[fe],ge);c(ye.x,ye.y,_+me)}for(var De=0,ze=O.length,Ne;De<ze;De++){Ne=O[De];ee=$[De];for(var Fe=0,Oe=Ne.length,Be;Fe<Oe;Fe++){Be=a(Ne[Fe],ee[Fe],ge);if(!R){c(Be.x,Be.y,_+me)}else{c(Be.x,Be.y+C[v-1].y,C[v-1].x+me)}}}}i();(function(){var e=s.length/3,t=0;l(G,t);t+=G.length;for(var a=0,r=O.length,i;a<r;a++){i=O[a];l(i,t);t+=i.length}o.addGroup(e,s.length/3-e,1)})();function i(){var e=s.length/3;if(x){for(var t=0,a=q*t,r=0,i;r<X;r++){i=U[r];u(i[2]+a,i[1]+a,i[0]+a)}t=v+2*E;a=q*t;for(var n=0,l;n<X;n++){l=U[n];u(l[0]+a,l[1]+a,l[2]+a)}}else{for(var d=0,c;d<X;d++){c=U[d];u(c[2],c[1],c[0])}for(var p=0,m;p<X;p++){m=U[p];u(m[0]+q*v,m[1]+q*v,m[2]+q*v)}}o.addGroup(e,s.length/3-e,0)}function l(e,t){var a=e.length;while(0<=--a){var r=a,n=a-1;if(0>n)n=e.length-1;for(var c=0,u=v+2*E;c<u;c++){var o=q*c,s=q*(c+1),l=t+n+o,d=t+n+s;p(t+r+o,l,d,t+r+s)}}}function c(e,t,a){f.push(e);f.push(t);f.push(a)}function u(e,t,a){m(e);m(t);m(a);var r=s.length/3,i=A.generateTopUV(o,s,r-3,r-2,r-1);g(i[0]);g(i[1]);g(i[2])}function p(e,t,a,r){m(e);m(t);m(r);m(t);m(a);m(r);var i=s.length/3,n=A.generateSideWallUV(o,s,i-6,i-3,i-2,i-1);g(n[0]);g(n[1]);g(n[3]);g(n[1]);g(n[2]);g(n[3])}function m(e){s.push(f[3*e+0]);s.push(f[3*e+1]);s.push(f[3*e+2])}function g(e){d.push(e.x);d.push(e.y)}}return r}_createClass2(t,[{key:"toJSON",value:function toJSON(){var e=_get(_getPrototypeOf(t.prototype),"toJSON",this).call(this),a=this.parameters.shapes,r=this.parameters.options;return Ra(a,r,e)}}],[{key:"fromJSON",value:function fromJSON(e,a){for(var r=[],i=0,n=e.shapes.length,o;i<n;i++){o=a[e.shapes[i]];r.push(o)}var s=e.options.extrudePath;if(s!==void 0){e.options.extrudePath=new sp[s.type]().fromJSON(s)}return new t(r,e.options)}}]);return t}(rd),gp={generateTopUV:function generateTopUV(e,t,a,r,i){var n=t[3*a],o=t[3*a+1],s=t[3*r],l=t[3*r+1],d=t[3*i],c=t[3*i+1];return[new os(n,o),new os(s,l),new os(d,c)]},generateSideWallUV:function generateSideWallUV(e,t,a,r,i,n){var o=t[3*a],s=t[3*a+1],l=t[3*a+2],d=t[3*r],c=t[3*r+1],u=t[3*r+2],p=t[3*i],m=t[3*i+1],g=t[3*i+2],f=t[3*n],h=t[3*n+1],y=t[3*n+2];if(Math.abs(s-c)<Math.abs(o-d)){return[new os(o,1-l),new os(d,1-u),new os(p,1-g),new os(f,1-y)]}else{return[new os(s,1-l),new os(c,1-u),new os(m,1-g),new os(h,1-y)]}}};function Ra(e,t,a){a.shapes=[];if(Array.isArray(e)){for(var r=0,i=e.length,n;r<i;r++){n=e[r];a.shapes.push(n.uuid)}}else{a.shapes.push(e.uuid)}if(t.extrudePath!==void 0)a.options.extrudePath=t.extrudePath.toJSON();return a}var fp=function(e){_inherits(a,e);var r=_createSuper(a);function a(){var e,i=0<arguments.length&&arguments[0]!==void 0?arguments[0]:1,n=1<arguments.length&&arguments[1]!==void 0?arguments[1]:0;_classCallCheck2(this,a);var o=(1+Math.sqrt(5))/2;e=r.call(this,[-1,o,0,1,o,0,-1,-o,0,1,-o,0,0,-1,o,0,1,o,0,-1,-o,0,1,-o,o,0,-1,o,0,1,-o,0,-1,-o,0,1],[0,11,5,0,5,1,0,1,7,0,7,10,0,10,11,1,5,9,5,11,4,11,10,2,10,7,6,7,1,8,3,9,4,3,4,2,3,2,6,3,6,8,3,8,9,4,9,5,2,4,11,6,2,10,8,6,7,9,8,1],i,n);e.type="IcosahedronGeometry";e.parameters={radius:i,detail:n};return e}_createClass2(a,null,[{key:"fromJSON",value:function fromJSON(e){return new a(e.radius,e.detail)}}]);return a}(Bu),hp=function(e){_inherits(t,e);var r=_createSuper(t);function t(){var e,i=0<arguments.length&&arguments[0]!==void 0?arguments[0]:[new os(0,.5),new os(.5,0),new os(0,-.5)],o=1<arguments.length&&arguments[1]!==void 0?arguments[1]:12,s=2<arguments.length&&arguments[2]!==void 0?arguments[2]:0,l=3<arguments.length&&arguments[3]!==void 0?arguments[3]:2*Math.PI;_classCallCheck2(this,t);e=r.call(this);e.type="LatheGeometry";e.parameters={points:i,segments:o,phiStart:s,phiLength:l};o=Math.floor(o);l=a(l,0,2*Math.PI);for(var u=[],p=[],m=[],g=1/o,f=new vs,h=new os,y=0;y<=o;y++){for(var v=s+y*g*l,_=Math.sin(v),x=Math.cos(v),S=0;S<=i.length-1;S++){f.x=i[S].x*_;f.y=i[S].y;f.z=i[S].x*x;p.push(f.x,f.y,f.z);h.x=y/o;h.y=S/(i.length-1);m.push(h.x,h.y)}}for(var R=0;R<o;R++){for(var L=0;L<i.length-1;L++){var M=L+R*i.length,T=M+i.length,b=M+i.length+1,c=M+1;u.push(M,T,c);u.push(T,b,c)}}e.setIndex(u);e.setAttribute("position",new Yl(p,3));e.setAttribute("uv",new Yl(m,2));e.computeVertexNormals();if(l===2*Math.PI){for(var d=e.attributes.normal.array,E=new vs,w=new vs,A=new vs,n=3*(o*i.length),k=0,C=0;k<i.length;k++,C+=3){E.x=d[C+0];E.y=d[C+1];E.z=d[C+2];w.x=d[n+C+0];w.y=d[n+C+1];w.z=d[n+C+2];A.addVectors(E,w).normalize();d[C+0]=d[n+C+0]=A.x;d[C+1]=d[n+C+1]=A.y;d[C+2]=d[n+C+2]=A.z}}return e}_createClass2(t,null,[{key:"fromJSON",value:function fromJSON(e){return new t(e.points,e.segments,e.phiStart,e.phiLength)}}]);return t}(rd),yp=function(e){_inherits(t,e);var a=_createSuper(t);function t(){var e,r=0<arguments.length&&arguments[0]!==void 0?arguments[0]:1,i=1<arguments.length&&arguments[1]!==void 0?arguments[1]:0;_classCallCheck2(this,t);e=a.call(this,[1,0,0,-1,0,0,0,1,0,0,-1,0,0,0,1,0,0,-1],[0,2,4,0,4,3,0,3,5,0,5,2,1,2,5,1,5,3,1,3,4,1,4,2],r,i);e.type="OctahedronGeometry";e.parameters={radius:r,detail:i};return e}_createClass2(t,null,[{key:"fromJSON",value:function fromJSON(e){return new t(e.radius,e.detail)}}]);return t}(Bu),vp=function(e){_inherits(t,e);var a=_createSuper(t);function t(){var e,r=0<arguments.length&&arguments[0]!==void 0?arguments[0]:.5,i=1<arguments.length&&arguments[1]!==void 0?arguments[1]:1,n=2<arguments.length&&arguments[2]!==void 0?arguments[2]:8,o=3<arguments.length&&arguments[3]!==void 0?arguments[3]:1,s=4<arguments.length&&arguments[4]!==void 0?arguments[4]:0,l=5<arguments.length&&arguments[5]!==void 0?arguments[5]:2*Math.PI;_classCallCheck2(this,t);e=a.call(this);e.type="RingGeometry";e.parameters={innerRadius:r,outerRadius:i,thetaSegments:n,phiSegments:o,thetaStart:s,thetaLength:l};n=Math.max(3,n);o=Math.max(1,o);for(var u=[],p=[],m=[],g=[],f=r,h=(i-r)/o,y=new vs,v=new os,_=0;_<=o;_++){for(var d=0,M;d<=n;d++){M=s+d/n*l;y.x=f*Math.cos(M);y.y=f*Math.sin(M);p.push(y.x,y.y,y.z);m.push(0,0,1);v.x=(y.x/i+1)/2;v.y=(y.y/i+1)/2;g.push(v.x,v.y)}f+=h}for(var T=0,E;T<o;T++){E=T*(n+1);for(var w=0;w<n;w++){var x=w+E,S=x+n+1,b=x+n+2,c=x+1;u.push(x,S,c);u.push(S,b,c)}}e.setIndex(u);e.setAttribute("position",new Yl(p,3));e.setAttribute("normal",new Yl(m,3));e.setAttribute("uv",new Yl(g,2));return e}_createClass2(t,null,[{key:"fromJSON",value:function fromJSON(e){return new t(e.innerRadius,e.outerRadius,e.thetaSegments,e.phiSegments,e.thetaStart,e.thetaLength)}}]);return t}(rd),_p=function(e){_inherits(t,e);var a=_createSuper(t);function t(){var r,i=0<arguments.length&&arguments[0]!==void 0?arguments[0]:new cp([new os(0,.5),new os(-.5,-.5),new os(.5,-.5)]),n=1<arguments.length&&arguments[1]!==void 0?arguments[1]:12;_classCallCheck2(this,t);r=a.call(this);r.type="ShapeGeometry";r.parameters={shapes:i,curveSegments:n};var o=[],s=[],l=[],d=[],c=0,u=0;if(!1===Array.isArray(i)){e(i)}else{for(var p=0;p<i.length;p++){e(i[p]);r.addGroup(c,u,p);c+=u;u=0}}r.setIndex(o);r.setAttribute("position",new Yl(s,3));r.setAttribute("normal",new Yl(l,3));r.setAttribute("uv",new Yl(d,2));function e(e){var t=s.length/3,r=e.extractPoints(n),i=r.shape,p=r.holes;if(!1===pp.isClockWise(i)){i=i.reverse()}for(var c=0,x=p.length,l;c<x;c++){l=p[c];if(!0===pp.isClockWise(l)){p[c]=l.reverse()}}for(var m=pp.triangulateShape(i,p),g=0,f=p.length,h;g<f;g++){h=p[g];i=i.concat(h)}for(var b=0,S=i.length,M;b<S;b++){M=i[b];s.push(M.x,M.y,0);l.push(0,0,1);d.push(M.x,M.y)}for(var T=0,E=m.length;T<E;T++){var y=m[T],v=y[0]+t,a=y[1]+t,_=y[2]+t;o.push(v,a,_);u+=3}}return r}_createClass2(t,[{key:"toJSON",value:function toJSON(){var e=_get(_getPrototypeOf(t.prototype),"toJSON",this).call(this),a=this.parameters.shapes;return La(a,e)}}],[{key:"fromJSON",value:function fromJSON(e,a){for(var r=[],i=0,n=e.shapes.length,o;i<n;i++){o=a[e.shapes[i]];r.push(o)}return new t(r,e.curveSegments)}}]);return t}(rd);function La(e,t){t.shapes=[];if(Array.isArray(e)){for(var a=0,r=e.length,i;a<r;a++){i=e[a];t.shapes.push(i.uuid)}}else{t.shapes.push(e.uuid)}return t}var xp=function(e){_inherits(t,e);var r=_createSuper(t);function t(){var e,i=0<arguments.length&&arguments[0]!==void 0?arguments[0]:1,n=1<arguments.length&&arguments[1]!==void 0?arguments[1]:32,o=2<arguments.length&&arguments[2]!==void 0?arguments[2]:16,s=3<arguments.length&&arguments[3]!==void 0?arguments[3]:0,l=4<arguments.length&&arguments[4]!==void 0?arguments[4]:2*Math.PI,p=5<arguments.length&&arguments[5]!==void 0?arguments[5]:0,m=6<arguments.length&&arguments[6]!==void 0?arguments[6]:Math.PI;_classCallCheck2(this,t);e=r.call(this);e.type="SphereGeometry";e.parameters={radius:i,widthSegments:n,heightSegments:o,phiStart:s,phiLength:l,thetaStart:p,thetaLength:m};n=Math.max(3,Math.floor(n));o=Math.max(2,Math.floor(o));for(var g=Math.min(p+m,Math.PI),f=0,h=[],y=new vs,_=new vs,x=[],S=[],M=[],T=[],E=0;E<=o;E++){var w=[],A=E/o,v=0;if(0==E&&0==p){v=.5/n}else if(E==o&&g==Math.PI){v=-.5/n}for(var d=0,C;d<=n;d++){C=d/n;y.x=-i*Math.cos(s+C*l)*Math.sin(p+A*m);y.y=i*Math.cos(p+A*m);y.z=i*Math.sin(s+C*l)*Math.sin(p+A*m);S.push(y.x,y.y,y.z);_.copy(y).normalize();M.push(_.x,_.y,_.z);T.push(C+v,1-A);w.push(f++)}h.push(w)}for(var u=0;u<o;u++){for(var R=0;R<n;R++){var k=h[u][R+1],a=h[u][R],b=h[u+1][R],c=h[u+1][R+1];if(0!==u||0<p)x.push(k,a,c);if(u!==o-1||g<Math.PI)x.push(a,b,c)}}e.setIndex(x);e.setAttribute("position",new Yl(S,3));e.setAttribute("normal",new Yl(M,3));e.setAttribute("uv",new Yl(T,2));return e}_createClass2(t,null,[{key:"fromJSON",value:function fromJSON(e){return new t(e.radius,e.widthSegments,e.heightSegments,e.phiStart,e.phiLength,e.thetaStart,e.thetaLength)}}]);return t}(rd),bp=function(e){_inherits(t,e);var a=_createSuper(t);function t(){var e,r=0<arguments.length&&arguments[0]!==void 0?arguments[0]:1,i=1<arguments.length&&arguments[1]!==void 0?arguments[1]:0;_classCallCheck2(this,t);e=a.call(this,[1,1,1,-1,-1,1,-1,1,-1,1,-1,-1],[2,1,0,0,3,2,1,3,0,2,3,1],r,i);e.type="TetrahedronGeometry";e.parameters={radius:r,detail:i};return e}_createClass2(t,null,[{key:"fromJSON",value:function fromJSON(e){return new t(e.radius,e.detail)}}]);return t}(Bu),Sp=function(e){_inherits(t,e);var r=_createSuper(t);function t(){var e,i=0<arguments.length&&arguments[0]!==void 0?arguments[0]:1,n=1<arguments.length&&arguments[1]!==void 0?arguments[1]:.4,o=2<arguments.length&&arguments[2]!==void 0?arguments[2]:8,s=3<arguments.length&&arguments[3]!==void 0?arguments[3]:6,l=4<arguments.length&&arguments[4]!==void 0?arguments[4]:2*Math.PI;_classCallCheck2(this,t);e=r.call(this);e.type="TorusGeometry";e.parameters={radius:i,tube:n,radialSegments:o,tubularSegments:s,arc:l};o=Math.floor(o);s=Math.floor(s);for(var p=[],m=[],g=[],f=[],h=new vs,y=new vs,_=new vs,x=0;x<=o;x++){for(var d=0;d<=s;d++){var S=d/s*l,u=2*(x/o*Math.PI);y.x=(i+n*Math.cos(u))*Math.cos(S);y.y=(i+n*Math.cos(u))*Math.sin(S);y.z=n*Math.sin(u);m.push(y.x,y.y,y.z);h.x=i*Math.cos(S);h.y=i*Math.sin(S);_.subVectors(y,h).normalize();g.push(_.x,_.y,_.z);f.push(d/s);f.push(x/o)}}for(var M=1;M<=o;M++){for(var T=1;T<=s;T++){var v=(s+1)*M+T-1,a=(s+1)*(M-1)+T-1,b=(s+1)*(M-1)+T,c=(s+1)*M+T;p.push(v,a,c);p.push(a,b,c)}}e.setIndex(p);e.setAttribute("position",new Yl(m,3));e.setAttribute("normal",new Yl(g,3));e.setAttribute("uv",new Yl(f,2));return e}_createClass2(t,null,[{key:"fromJSON",value:function fromJSON(e){return new t(e.radius,e.tube,e.radialSegments,e.tubularSegments,e.arc)}}]);return t}(rd),Mp=function(e){_inherits(t,e);var r=_createSuper(t);function t(){var i,n=0<arguments.length&&arguments[0]!==void 0?arguments[0]:1,o=1<arguments.length&&arguments[1]!==void 0?arguments[1]:.4,s=2<arguments.length&&arguments[2]!==void 0?arguments[2]:64,l=3<arguments.length&&arguments[3]!==void 0?arguments[3]:8,m=4<arguments.length&&arguments[4]!==void 0?arguments[4]:2,p=5<arguments.length&&arguments[5]!==void 0?arguments[5]:3;_classCallCheck2(this,t);i=r.call(this);i.type="TorusKnotGeometry";i.parameters={radius:n,tube:o,tubularSegments:s,radialSegments:l,p:m,q:p};s=Math.floor(s);l=Math.floor(l);for(var g=[],f=[],h=[],y=[],_=new vs,x=new vs,S=new vs,M=new vs,E=new vs,w=new vs,T=new vs,A=0,k;A<=s;++A){k=2*(A/s*m*Math.PI);e(k,m,p,n,S);e(k+.01,m,p,n,M);w.subVectors(M,S);T.addVectors(M,S);E.crossVectors(w,T);T.crossVectors(E,w);E.normalize();T.normalize();for(var d=0;d<=l;++d){var C=2*(d/l*Math.PI),v=-o*Math.cos(C),R=o*Math.sin(C);_.x=S.x+(v*T.x+R*E.x);_.y=S.y+(v*T.y+R*E.y);_.z=S.z+(v*T.z+R*E.z);f.push(_.x,_.y,_.z);x.subVectors(_,S).normalize();h.push(x.x,x.y,x.z);y.push(A/s);y.push(d/l)}}for(var P=1;P<=s;P++){for(var I=1;I<=l;I++){var L=(l+1)*(P-1)+(I-1),a=(l+1)*P+(I-1),b=(l+1)*P+I,c=(l+1)*(P-1)+I;g.push(L,a,c);g.push(a,b,c)}}i.setIndex(g);i.setAttribute("position",new Yl(f,3));i.setAttribute("normal",new Yl(h,3));i.setAttribute("uv",new Yl(y,2));function e(e,t,a,r,i){var n=Math.cos(e),o=Math.sin(e),s=a/t*e,l=Math.cos(s);i.x=.5*(r*(2+l))*n;i.y=.5*(r*(2+l)*o);i.z=.5*(r*Math.sin(s))}return i}_createClass2(t,null,[{key:"fromJSON",value:function fromJSON(e){return new t(e.radius,e.tube,e.tubularSegments,e.radialSegments,e.p,e.q)}}]);return t}(rd),Tp=function(e){_inherits(t,e);var a=_createSuper(t);function t(){var n,o=0<arguments.length&&arguments[0]!==void 0?arguments[0]:new np(new vs(-1,-1,0),new vs(-1,1,0),new vs(1,1,0)),s=1<arguments.length&&arguments[1]!==void 0?arguments[1]:64,l=2<arguments.length&&arguments[2]!==void 0?arguments[2]:1,u=3<arguments.length&&arguments[3]!==void 0?arguments[3]:8,p=4<arguments.length&&arguments[4]!==void 0?arguments[4]:!1;_classCallCheck2(this,t);n=a.call(this);n.type="TubeGeometry";n.parameters={path:o,tubularSegments:s,radius:l,radialSegments:u,closed:p};var m=o.computeFrenetFrames(s,p);n.tangents=m.tangents;n.normals=m.normals;n.binormals=m.binormals;var g=new vs,f=new vs,h=new os,d=new vs,c=[],y=[],v=[],_=[];(function(){for(var t=0;t<s;t++){e(t)}e(!1===p?s:0);i();r()})();n.setIndex(_);n.setAttribute("position",new Yl(c,3));n.setAttribute("normal",new Yl(y,3));n.setAttribute("uv",new Yl(v,2));function e(e){d=o.getPointAt(e/s,d);for(var t=m.normals[e],a=m.binormals[e],r=0;r<=u;r++){var i=2*(r/u*Math.PI),n=Math.sin(i),p=-Math.cos(i);f.x=p*t.x+n*a.x;f.y=p*t.y+n*a.y;f.z=p*t.z+n*a.z;f.normalize();y.push(f.x,f.y,f.z);g.x=d.x+l*f.x;g.y=d.y+l*f.y;g.z=d.z+l*f.z;c.push(g.x,g.y,g.z)}}function r(){for(var i=1;i<=s;i++){for(var n=1;n<=u;n++){var e=(u+1)*(i-1)+(n-1),t=(u+1)*i+(n-1),a=(u+1)*i+n,r=(u+1)*(i-1)+n;_.push(e,t,r);_.push(t,a,r)}}}function i(){for(var e=0;e<=s;e++){for(var t=0;t<=u;t++){h.x=e/s;h.y=t/u;v.push(h.x,h.y)}}}return n}_createClass2(t,[{key:"toJSON",value:function toJSON(){var e=_get(_getPrototypeOf(t.prototype),"toJSON",this).call(this);e.path=this.parameters.path.toJSON();return e}}],[{key:"fromJSON",value:function fromJSON(e){return new t(new sp[e.path.type]().fromJSON(e.path),e.tubularSegments,e.radius,e.radialSegments,e.closed)}}]);return t}(rd),Ep=function(e){_inherits(t,e);var a=_createSuper(t);function t(){var e,r=0<arguments.length&&arguments[0]!==void 0?arguments[0]:null;_classCallCheck2(this,t);e=a.call(this);e.type="WireframeGeometry";e.parameters={geometry:r};if(null!==r){var i=[],n=new Set,s=new vs,l=new vs;if(null!==r.index){var d=r.attributes.position,c=r.index,u=r.groups;if(0===u.length){u=[{start:0,count:c.count,materialIndex:0}]}for(var M=0,o=u.length;M<o;++M){for(var p=u[M],m=p.start,g=p.count,f=m;f<m+g;f+=3){for(var T=0;3>T;T++){var h=c.getX(f+T),y=c.getX(f+(T+1)%3);s.fromBufferAttribute(d,h);l.fromBufferAttribute(d,y);if(!0===Pa(s,l,n)){i.push(s.x,s.y,s.z);i.push(l.x,l.y,l.z)}}}}}else{for(var v=r.attributes.position,_=0,x=v.count/3;_<x;_++){for(var E=0;3>E;E++){var b=3*_+E,S=3*_+(E+1)%3;s.fromBufferAttribute(v,b);l.fromBufferAttribute(v,S);if(!0===Pa(s,l,n)){i.push(s.x,s.y,s.z);i.push(l.x,l.y,l.z)}}}}e.setAttribute("position",new Yl(i,3))}return e}return t}(rd);function Pa(e,t,a){var r="".concat(e.x,",").concat(e.y,",").concat(e.z,"-").concat(t.x,",").concat(t.y,",").concat(t.z),i="".concat(t.x,",").concat(t.y,",").concat(t.z,"-").concat(e.x,",").concat(e.y,",").concat(e.z);if(!0===a.has(r)||!0===a.has(i)){return!1}else{a.add(r,i);return!0}}var wp=Object.freeze({__proto__:null,BoxGeometry:Sd,BoxBufferGeometry:Sd,CircleGeometry:Nu,CircleBufferGeometry:Nu,ConeGeometry:Ou,ConeBufferGeometry:Ou,CylinderGeometry:Fu,CylinderBufferGeometry:Fu,DodecahedronGeometry:Uu,DodecahedronBufferGeometry:Uu,EdgesGeometry:ju,ExtrudeGeometry:mp,ExtrudeBufferGeometry:mp,IcosahedronGeometry:fp,IcosahedronBufferGeometry:fp,LatheGeometry:hp,LatheBufferGeometry:hp,OctahedronGeometry:yp,OctahedronBufferGeometry:yp,PlaneGeometry:Fd,PlaneBufferGeometry:Fd,PolyhedronGeometry:Bu,PolyhedronBufferGeometry:Bu,RingGeometry:vp,RingBufferGeometry:vp,ShapeGeometry:_p,ShapeBufferGeometry:_p,SphereGeometry:xp,SphereBufferGeometry:xp,TetrahedronGeometry:bp,TetrahedronBufferGeometry:bp,TorusGeometry:Sp,TorusBufferGeometry:Sp,TorusKnotGeometry:Mp,TorusKnotBufferGeometry:Mp,TubeGeometry:Tp,TubeBufferGeometry:Tp,WireframeGeometry:Ep}),Ap=function(e){_inherits(t,e);var a=_createSuper(t);function t(e){var r;_classCallCheck2(this,t);r=a.call(this);r.type="ShadowMaterial";r.color=new zl(0);r.transparent=!0;r.setValues(e);return r}_createClass2(t,[{key:"copy",value:function copy(e){_get(_getPrototypeOf(t.prototype),"copy",this).call(this,e);this.color.copy(e.color);return this}}]);return t}(Ll);Ap.prototype.isShadowMaterial=!0;var kp=function(e){_inherits(t,e);var a=_createSuper(t);function t(e){var r;_classCallCheck2(this,t);r=a.call(this);r.defines={STANDARD:""};r.type="MeshStandardMaterial";r.color=new zl(16777215);r.roughness=1;r.metalness=0;r.map=null;r.lightMap=null;r.lightMapIntensity=1;r.aoMap=null;r.aoMapIntensity=1;r.emissive=new zl(0);r.emissiveIntensity=1;r.emissiveMap=null;r.bumpMap=null;r.bumpScale=1;r.normalMap=null;r.normalMapType=Eo;r.normalScale=new os(1,1);r.displacementMap=null;r.displacementScale=1;r.displacementBias=0;r.roughnessMap=null;r.metalnessMap=null;r.alphaMap=null;r.envMap=null;r.envMapIntensity=1;r.refractionRatio=.98;r.wireframe=!1;r.wireframeLinewidth=1;r.wireframeLinecap="round";r.wireframeLinejoin="round";r.flatShading=!1;r.setValues(e);return r}_createClass2(t,[{key:"copy",value:function copy(e){_get(_getPrototypeOf(t.prototype),"copy",this).call(this,e);this.defines={STANDARD:""};this.color.copy(e.color);this.roughness=e.roughness;this.metalness=e.metalness;this.map=e.map;this.lightMap=e.lightMap;this.lightMapIntensity=e.lightMapIntensity;this.aoMap=e.aoMap;this.aoMapIntensity=e.aoMapIntensity;this.emissive.copy(e.emissive);this.emissiveMap=e.emissiveMap;this.emissiveIntensity=e.emissiveIntensity;this.bumpMap=e.bumpMap;this.bumpScale=e.bumpScale;this.normalMap=e.normalMap;this.normalMapType=e.normalMapType;this.normalScale.copy(e.normalScale);this.displacementMap=e.displacementMap;this.displacementScale=e.displacementScale;this.displacementBias=e.displacementBias;this.roughnessMap=e.roughnessMap;this.metalnessMap=e.metalnessMap;this.alphaMap=e.alphaMap;this.envMap=e.envMap;this.envMapIntensity=e.envMapIntensity;this.refractionRatio=e.refractionRatio;this.wireframe=e.wireframe;this.wireframeLinewidth=e.wireframeLinewidth;this.wireframeLinecap=e.wireframeLinecap;this.wireframeLinejoin=e.wireframeLinejoin;this.flatShading=e.flatShading;return this}}]);return t}(Ll);kp.prototype.isMeshStandardMaterial=!0;var Cp=function(e){_inherits(t,e);var r=_createSuper(t);function t(e){var i;_classCallCheck2(this,t);i=r.call(this);i.defines={STANDARD:"",PHYSICAL:""};i.type="MeshPhysicalMaterial";i.clearcoatMap=null;i.clearcoatRoughness=0;i.clearcoatRoughnessMap=null;i.clearcoatNormalScale=new os(1,1);i.clearcoatNormalMap=null;i.ior=1.5;Object.defineProperty(_assertThisInitialized(i),"reflectivity",{get:function get(){return a(2.5*(this.ior-1)/(this.ior+1),0,1)},set:function set(e){this.ior=(1+.4*e)/(1-.4*e)}});i.sheenColor=new zl(0);i.sheenColorMap=null;i.sheenRoughness=1;i.sheenRoughnessMap=null;i.transmissionMap=null;i.thickness=0;i.thicknessMap=null;i.attenuationDistance=0;i.attenuationColor=new zl(1,1,1);i.specularIntensity=1;i.specularIntensityMap=null;i.specularColor=new zl(1,1,1);i.specularColorMap=null;i._sheen=0;i._clearcoat=0;i._transmission=0;i.setValues(e);return i}_createClass2(t,[{key:"copy",value:function copy(e){_get(_getPrototypeOf(t.prototype),"copy",this).call(this,e);this.defines={STANDARD:"",PHYSICAL:""};this.clearcoat=e.clearcoat;this.clearcoatMap=e.clearcoatMap;this.clearcoatRoughness=e.clearcoatRoughness;this.clearcoatRoughnessMap=e.clearcoatRoughnessMap;this.clearcoatNormalMap=e.clearcoatNormalMap;this.clearcoatNormalScale.copy(e.clearcoatNormalScale);this.ior=e.ior;this.sheen=e.sheen;this.sheenColor.copy(e.sheenColor);this.sheenColorMap=e.sheenColorMap;this.sheenRoughness=e.sheenRoughness;this.sheenRoughnessMap=e.sheenRoughnessMap;this.transmission=e.transmission;this.transmissionMap=e.transmissionMap;this.thickness=e.thickness;this.thicknessMap=e.thicknessMap;this.attenuationDistance=e.attenuationDistance;this.attenuationColor.copy(e.attenuationColor);this.specularIntensity=e.specularIntensity;this.specularIntensityMap=e.specularIntensityMap;this.specularColor.copy(e.specularColor);this.specularColorMap=e.specularColorMap;return this}},{key:"sheen",get:function get(){return this._sheen},set:function set(e){if(0<this._sheen!=0<e){this.version++}this._sheen=e}},{key:"clearcoat",get:function get(){return this._clearcoat},set:function set(e){if(0<this._clearcoat!=0<e){this.version++}this._clearcoat=e}},{key:"transmission",get:function get(){return this._transmission},set:function set(e){if(0<this._transmission!=0<e){this.version++}this._transmission=e}}]);return t}(kp);Cp.prototype.isMeshPhysicalMaterial=!0;var Rp=function(e){_inherits(t,e);var a=_createSuper(t);function t(e){var r;_classCallCheck2(this,t);r=a.call(this);r.type="MeshPhongMaterial";r.color=new zl(16777215);r.specular=new zl(1118481);r.shininess=30;r.map=null;r.lightMap=null;r.lightMapIntensity=1;r.aoMap=null;r.aoMapIntensity=1;r.emissive=new zl(0);r.emissiveIntensity=1;r.emissiveMap=null;r.bumpMap=null;r.bumpScale=1;r.normalMap=null;r.normalMapType=Eo;r.normalScale=new os(1,1);r.displacementMap=null;r.displacementScale=1;r.displacementBias=0;r.specularMap=null;r.alphaMap=null;r.envMap=null;r.combine=mi;r.reflectivity=1;r.refractionRatio=.98;r.wireframe=!1;r.wireframeLinewidth=1;r.wireframeLinecap="round";r.wireframeLinejoin="round";r.flatShading=!1;r.setValues(e);return r}_createClass2(t,[{key:"copy",value:function copy(e){_get(_getPrototypeOf(t.prototype),"copy",this).call(this,e);this.color.copy(e.color);this.specular.copy(e.specular);this.shininess=e.shininess;this.map=e.map;this.lightMap=e.lightMap;this.lightMapIntensity=e.lightMapIntensity;this.aoMap=e.aoMap;this.aoMapIntensity=e.aoMapIntensity;this.emissive.copy(e.emissive);this.emissiveMap=e.emissiveMap;this.emissiveIntensity=e.emissiveIntensity;this.bumpMap=e.bumpMap;this.bumpScale=e.bumpScale;this.normalMap=e.normalMap;this.normalMapType=e.normalMapType;this.normalScale.copy(e.normalScale);this.displacementMap=e.displacementMap;this.displacementScale=e.displacementScale;this.displacementBias=e.displacementBias;this.specularMap=e.specularMap;this.alphaMap=e.alphaMap;this.envMap=e.envMap;this.combine=e.combine;this.reflectivity=e.reflectivity;this.refractionRatio=e.refractionRatio;this.wireframe=e.wireframe;this.wireframeLinewidth=e.wireframeLinewidth;this.wireframeLinecap=e.wireframeLinecap;this.wireframeLinejoin=e.wireframeLinejoin;this.flatShading=e.flatShading;return this}}]);return t}(Ll);Rp.prototype.isMeshPhongMaterial=!0;var Lp=function(e){_inherits(t,e);var a=_createSuper(t);function t(e){var r;_classCallCheck2(this,t);r=a.call(this);r.defines={TOON:""};r.type="MeshToonMaterial";r.color=new zl(16777215);r.map=null;r.gradientMap=null;r.lightMap=null;r.lightMapIntensity=1;r.aoMap=null;r.aoMapIntensity=1;r.emissive=new zl(0);r.emissiveIntensity=1;r.emissiveMap=null;r.bumpMap=null;r.bumpScale=1;r.normalMap=null;r.normalMapType=Eo;r.normalScale=new os(1,1);r.displacementMap=null;r.displacementScale=1;r.displacementBias=0;r.alphaMap=null;r.wireframe=!1;r.wireframeLinewidth=1;r.wireframeLinecap="round";r.wireframeLinejoin="round";r.setValues(e);return r}_createClass2(t,[{key:"copy",value:function copy(e){_get(_getPrototypeOf(t.prototype),"copy",this).call(this,e);this.color.copy(e.color);this.map=e.map;this.gradientMap=e.gradientMap;this.lightMap=e.lightMap;this.lightMapIntensity=e.lightMapIntensity;this.aoMap=e.aoMap;this.aoMapIntensity=e.aoMapIntensity;this.emissive.copy(e.emissive);this.emissiveMap=e.emissiveMap;this.emissiveIntensity=e.emissiveIntensity;this.bumpMap=e.bumpMap;this.bumpScale=e.bumpScale;this.normalMap=e.normalMap;this.normalMapType=e.normalMapType;this.normalScale.copy(e.normalScale);this.displacementMap=e.displacementMap;this.displacementScale=e.displacementScale;this.displacementBias=e.displacementBias;this.alphaMap=e.alphaMap;this.wireframe=e.wireframe;this.wireframeLinewidth=e.wireframeLinewidth;this.wireframeLinecap=e.wireframeLinecap;this.wireframeLinejoin=e.wireframeLinejoin;return this}}]);return t}(Ll);Lp.prototype.isMeshToonMaterial=!0;var Pp=function(e){_inherits(t,e);var a=_createSuper(t);function t(e){var r;_classCallCheck2(this,t);r=a.call(this);r.type="MeshNormalMaterial";r.bumpMap=null;r.bumpScale=1;r.normalMap=null;r.normalMapType=Eo;r.normalScale=new os(1,1);r.displacementMap=null;r.displacementScale=1;r.displacementBias=0;r.wireframe=!1;r.wireframeLinewidth=1;r.fog=!1;r.flatShading=!1;r.setValues(e);return r}_createClass2(t,[{key:"copy",value:function copy(e){_get(_getPrototypeOf(t.prototype),"copy",this).call(this,e);this.bumpMap=e.bumpMap;this.bumpScale=e.bumpScale;this.normalMap=e.normalMap;this.normalMapType=e.normalMapType;this.normalScale.copy(e.normalScale);this.displacementMap=e.displacementMap;this.displacementScale=e.displacementScale;this.displacementBias=e.displacementBias;this.wireframe=e.wireframe;this.wireframeLinewidth=e.wireframeLinewidth;this.flatShading=e.flatShading;return this}}]);return t}(Ll);Pp.prototype.isMeshNormalMaterial=!0;var Ip=function(e){_inherits(t,e);var a=_createSuper(t);function t(e){var r;_classCallCheck2(this,t);r=a.call(this);r.type="MeshLambertMaterial";r.color=new zl(16777215);r.map=null;r.lightMap=null;r.lightMapIntensity=1;r.aoMap=null;r.aoMapIntensity=1;r.emissive=new zl(0);r.emissiveIntensity=1;r.emissiveMap=null;r.specularMap=null;r.alphaMap=null;r.envMap=null;r.combine=mi;r.reflectivity=1;r.refractionRatio=.98;r.wireframe=!1;r.wireframeLinewidth=1;r.wireframeLinecap="round";r.wireframeLinejoin="round";r.setValues(e);return r}_createClass2(t,[{key:"copy",value:function copy(e){_get(_getPrototypeOf(t.prototype),"copy",this).call(this,e);this.color.copy(e.color);this.map=e.map;this.lightMap=e.lightMap;this.lightMapIntensity=e.lightMapIntensity;this.aoMap=e.aoMap;this.aoMapIntensity=e.aoMapIntensity;this.emissive.copy(e.emissive);this.emissiveMap=e.emissiveMap;this.emissiveIntensity=e.emissiveIntensity;this.specularMap=e.specularMap;this.alphaMap=e.alphaMap;this.envMap=e.envMap;this.combine=e.combine;this.reflectivity=e.reflectivity;this.refractionRatio=e.refractionRatio;this.wireframe=e.wireframe;this.wireframeLinewidth=e.wireframeLinewidth;this.wireframeLinecap=e.wireframeLinecap;this.wireframeLinejoin=e.wireframeLinejoin;return this}}]);return t}(Ll);Ip.prototype.isMeshLambertMaterial=!0;var Dp=function(e){_inherits(t,e);var a=_createSuper(t);function t(e){var r;_classCallCheck2(this,t);r=a.call(this);r.defines={MATCAP:""};r.type="MeshMatcapMaterial";r.color=new zl(16777215);r.matcap=null;r.map=null;r.bumpMap=null;r.bumpScale=1;r.normalMap=null;r.normalMapType=Eo;r.normalScale=new os(1,1);r.displacementMap=null;r.displacementScale=1;r.displacementBias=0;r.alphaMap=null;r.flatShading=!1;r.setValues(e);return r}_createClass2(t,[{key:"copy",value:function copy(e){_get(_getPrototypeOf(t.prototype),"copy",this).call(this,e);this.defines={MATCAP:""};this.color.copy(e.color);this.matcap=e.matcap;this.map=e.map;this.bumpMap=e.bumpMap;this.bumpScale=e.bumpScale;this.normalMap=e.normalMap;this.normalMapType=e.normalMapType;this.normalScale.copy(e.normalScale);this.displacementMap=e.displacementMap;this.displacementScale=e.displacementScale;this.displacementBias=e.displacementBias;this.alphaMap=e.alphaMap;this.flatShading=e.flatShading;return this}}]);return t}(Ll);Dp.prototype.isMeshMatcapMaterial=!0;var zp=function(e){_inherits(t,e);var a=_createSuper(t);function t(e){var r;_classCallCheck2(this,t);r=a.call(this);r.type="LineDashedMaterial";r.scale=1;r.dashSize=3;r.gapSize=1;r.setValues(e);return r}_createClass2(t,[{key:"copy",value:function copy(e){_get(_getPrototypeOf(t.prototype),"copy",this).call(this,e);this.scale=e.scale;this.dashSize=e.dashSize;this.gapSize=e.gapSize;return this}}]);return t}(hu);zp.prototype.isLineDashedMaterial=!0;var Np=Object.freeze({__proto__:null,ShadowMaterial:Ap,SpriteMaterial:zc,RawShaderMaterial:Hd,ShaderMaterial:Td,PointsMaterial:Au,MeshPhysicalMaterial:Cp,MeshStandardMaterial:kp,MeshPhongMaterial:Rp,MeshToonMaterial:Lp,MeshNormalMaterial:Pp,MeshLambertMaterial:Ip,MeshDepthMaterial:xc,MeshDistanceMaterial:bc,MeshBasicMaterial:Nl,MeshMatcapMaterial:Dp,LineDashedMaterial:zp,LineBasicMaterial:hu,Material:Ll}),Fp={arraySlice:function arraySlice(e,t,a){if(Fp.isTypedArray(e)){return new e.constructor(e.subarray(t,a!==void 0?a:e.length))}return e.slice(t,a)},convertArray:function convertArray(e,t,a){if(!e||!a&&e.constructor===t)return e;if("number"==typeof t.BYTES_PER_ELEMENT){return new t(e)}return Array.prototype.slice.call(e)},isTypedArray:function isTypedArray(e){return ArrayBuffer.isView(e)&&!(e instanceof DataView)},getKeyframeOrder:function getKeyframeOrder(e){function t(t,a){return e[t]-e[a]}for(var a=e.length,r=Array(a),i=0;i!==a;++i){r[i]=i}r.sort(t);return r},sortedArray:function sortedArray(e,t,a){for(var r=e.length,i=new e.constructor(r),n=0,o=0,s;o!==r;++n){s=a[n]*t;for(var l=0;l!==t;++l){i[o++]=e[s+l]}}return i},flattenJSON:function flattenJSON(e,t,a,r){var n=1,o=e[0];while(o!==void 0&&o[r]===void 0){o=e[n++]}if(o===void 0)return;var s=o[r];if(s===void 0)return;if(Array.isArray(s)){do{s=o[r];if(s!==void 0){t.push(o.time);a.push.apply(a,s)}o=e[n++]}while(o!==void 0)}else if(s.toArray!==void 0){do{s=o[r];if(s!==void 0){t.push(o.time);s.toArray(a,a.length)}o=e[n++]}while(o!==void 0)}else{do{s=o[r];if(s!==void 0){t.push(o.time);a.push(s)}o=e[n++]}while(o!==void 0)}},subclip:function subclip(e,t,a,r){var i=4<arguments.length&&arguments[4]!==void 0?arguments[4]:30,n=e.clone();n.name=t;for(var o=[],s=0;s<n.tracks.length;++s){for(var l=n.tracks[s],d=l.getValueSize(),c=[],u=[],p=0,m;p<l.times.length;++p){m=l.times[p]*i;if(m<a||m>=r)continue;c.push(l.times[p]);for(var h=0;h<d;++h){u.push(l.values[p*d+h])}}if(0===c.length)continue;l.times=Fp.convertArray(c,l.times.constructor);l.values=Fp.convertArray(u,l.values.constructor);o.push(l)}n.tracks=o;for(var g=1/0,f=0;f<n.tracks.length;++f){if(g>n.tracks[f].times[0]){g=n.tracks[f].times[0]}}for(var y=0;y<n.tracks.length;++y){n.tracks[y].shift(-1*g)}n.resetDuration();return n},makeClipAdditive:function makeClipAdditive(e){var t=1<arguments.length&&arguments[1]!==void 0?arguments[1]:0,a=2<arguments.length&&arguments[2]!==void 0?arguments[2]:e,r=3<arguments.length&&arguments[3]!==void 0?arguments[3]:30;if(0>=r)r=30;for(var i=a.tracks.length,n=t/r,o=function(t){var r=a.tracks[t],i=r.ValueTypeName;if("bool"===i||"string"===i)return"continue";var o=e.tracks.find(function(e){return e.name===r.name&&e.ValueTypeName===i});if(o===void 0)return"continue";var s=0,l=r.getValueSize();if(r.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline){s=l/3}var d=0,c=o.getValueSize();if(o.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline){d=c/3}var u=r.times.length-1,p=void 0;if(n<=r.times[0]){var m=s,g=l-s;p=Fp.arraySlice(r.values,m,g)}else if(n>=r.times[u]){var f=u*l+s,h=f+l-s;p=Fp.arraySlice(r.values,f,h)}else{var y=r.createInterpolant(),v=s,_=l-s;y.evaluate(n);p=Fp.arraySlice(y.resultBuffer,v,_)}if("quaternion"===i){var E=new ys().fromArray(p).normalize().conjugate();E.toArray(p)}for(var x=o.times.length,b=0,S;b<x;++b){S=b*c+d;if("quaternion"===i){ys.multiplyQuaternionsFlat(o.values,S,p,0,o.values,S)}else{for(var M=c-2*d,T=0;T<M;++T){o.values[S+T]-=p[T]}}}},s=0,l;s<i;++s){l=o(s);if("continue"===l)continue}e.blendMode=po;return e}},Op=function(){function e(t,a,r,i){_classCallCheck2(this,e);this.parameterPositions=t;this._cachedIndex=0;this.resultBuffer=i!==void 0?i:new a.constructor(r);this.sampleValues=a;this.valueSize=r;this.settings=null;this.DefaultSettings_={}}_createClass2(e,[{key:"evaluate",value:function evaluate(e){var t=this.parameterPositions,a=this._cachedIndex,r=t[a],i=t[a-1];validate_interval:{seek:{var n;linear_scan:{forward_scan:if(!(e<r)){for(var o=a+2;;){if(r===void 0){if(e<i)break forward_scan;a=t.length;this._cachedIndex=a;return this.afterEnd_(a-1,e,i)}if(a===o)break;i=r;r=t[++a];if(e<r){break seek}}n=t.length;break linear_scan}if(!(e>=i)){var s=t[1];if(e<s){a=2;i=s}for(var l=a-2;;){if(i===void 0){this._cachedIndex=0;return this.beforeStart_(0,e,r)}if(a===l)break;r=i;i=t[--a-1];if(e>=i){break seek}}n=a;a=0;break linear_scan}break validate_interval}while(a<n){var d=a+n>>>1;if(e<t[d]){n=d}else{a=d+1}}r=t[a];i=t[a-1];if(i===void 0){this._cachedIndex=0;return this.beforeStart_(0,e,r)}if(r===void 0){a=t.length;this._cachedIndex=a;return this.afterEnd_(a-1,i,e)}}this._cachedIndex=a;this.intervalChanged_(a,i,r)}return this.interpolate_(a,i,e,r)}},{key:"getSettings_",value:function getSettings_(){return this.settings||this.DefaultSettings_}},{key:"copySampleValue_",value:function copySampleValue_(e){for(var t=this.resultBuffer,a=this.sampleValues,r=this.valueSize,i=0;i!==r;++i){t[i]=a[e*r+i]}return t}},{key:"interpolate_",value:function interpolate_(){throw new Error("call to abstract method")}},{key:"intervalChanged_",value:function intervalChanged_(){}}]);return e}();Op.prototype.beforeStart_=Op.prototype.copySampleValue_;Op.prototype.afterEnd_=Op.prototype.copySampleValue_;var Bp=function(e){_inherits(t,e);var a=_createSuper(t);function t(e,r,i,n){var o;_classCallCheck2(this,t);o=a.call(this,e,r,i,n);o._weightPrev=-0;o._offsetPrev=-0;o._weightNext=-0;o._offsetNext=-0;o.DefaultSettings_={endingStart:so,endingEnd:so};return o}_createClass2(t,[{key:"intervalChanged_",value:function intervalChanged_(e,t,a){var r=this.parameterPositions,i=e-2,n=e+1,o=r[i],s=r[n];if(o===void 0){switch(this.getSettings_().endingStart){case lo:i=e;o=2*t-a;break;case co:i=r.length-2;o=t+r[i]-r[i+1];break;default:i=e;o=a;}}if(s===void 0){switch(this.getSettings_().endingEnd){case lo:n=e;s=2*a-t;break;case co:n=1;s=a+r[1]-r[0];break;default:n=e-1;s=t;}}var l=.5*(a-t),d=this.valueSize;this._weightPrev=l/(t-o);this._weightNext=l/(s-a);this._offsetPrev=i*d;this._offsetNext=n*d}},{key:"interpolate_",value:function interpolate_(e,a,r,t){for(var i=this.resultBuffer,n=this.sampleValues,o=this.valueSize,s=e*o,l=this._offsetPrev,d=this._offsetNext,c=this._weightPrev,u=this._weightNext,m=(r-a)/(t-a),p=m*m,g=p*m,f=0;f!==o;++f){i[f]=(-c*g+2*c*p-c*m)*n[l+f]+((1+c)*g+(-1.5-2*c)*p+(-.5+c)*m+1)*n[s-o+f]+((-1-u)*g+(1.5+u)*p+.5*m)*n[s+f]+(u*g-u*p)*n[d+f]}return i}}]);return t}(Op),Up=function(e){_inherits(t,e);var a=_createSuper(t);function t(e,r,i,n){_classCallCheck2(this,t);return a.call(this,e,r,i,n)}_createClass2(t,[{key:"interpolate_",value:function interpolate_(e,a,r,t){for(var i=this.resultBuffer,n=this.sampleValues,o=this.valueSize,s=e*o,l=(r-a)/(t-a),d=0;d!==o;++d){i[d]=n[s-o+d]*(1-l)+n[s+d]*l}return i}}]);return t}(Op),Gp=function(e){_inherits(t,e);var a=_createSuper(t);function t(e,r,i,n){_classCallCheck2(this,t);return a.call(this,e,r,i,n)}_createClass2(t,[{key:"interpolate_",value:function interpolate_(e){return this.copySampleValue_(e-1)}}]);return t}(Op),Hp=function(){function e(t,a,r,i){_classCallCheck2(this,e);if(t===void 0)throw new Error("THREE.KeyframeTrack: track name is undefined");if(a===void 0||0===a.length)throw new Error("THREE.KeyframeTrack: no keyframes in track named "+t);this.name=t;this.times=Fp.convertArray(a,this.TimeBufferType);this.values=Fp.convertArray(r,this.ValueBufferType);this.setInterpolation(i||this.DefaultInterpolation)}_createClass2(e,[{key:"InterpolantFactoryMethodDiscrete",value:function InterpolantFactoryMethodDiscrete(e){return new Gp(this.times,this.values,this.getValueSize(),e)}},{key:"InterpolantFactoryMethodLinear",value:function InterpolantFactoryMethodLinear(e){return new Up(this.times,this.values,this.getValueSize(),e)}},{key:"InterpolantFactoryMethodSmooth",value:function InterpolantFactoryMethodSmooth(e){return new Bp(this.times,this.values,this.getValueSize(),e)}},{key:"setInterpolation",value:function setInterpolation(e){var t;switch(e){case io:t=this.InterpolantFactoryMethodDiscrete;break;case no:t=this.InterpolantFactoryMethodLinear;break;case oo:t=this.InterpolantFactoryMethodSmooth;break;}if(t===void 0){var a="unsupported interpolation for "+this.ValueTypeName+" keyframe track named "+this.name;if(this.createInterpolant===void 0){if(e!==this.DefaultInterpolation){this.setInterpolation(this.DefaultInterpolation)}else{throw new Error(a)}}console.warn("THREE.KeyframeTrack:",a);return this}this.createInterpolant=t;return this}},{key:"getInterpolation",value:function getInterpolation(){switch(this.createInterpolant){case this.InterpolantFactoryMethodDiscrete:return io;case this.InterpolantFactoryMethodLinear:return no;case this.InterpolantFactoryMethodSmooth:return oo;}}},{key:"getValueSize",value:function getValueSize(){return this.values.length/this.times.length}},{key:"shift",value:function shift(e){if(0!==e){for(var t=this.times,a=0,r=t.length;a!==r;++a){t[a]+=e}}return this}},{key:"scale",value:function scale(e){if(1!==e){for(var t=this.times,a=0,r=t.length;a!==r;++a){t[a]*=e}}return this}},{key:"trim",value:function trim(e,t){var a=this.times,r=a.length,i=0,n=r-1;while(i!==r&&a[i]<e){++i}while(-1!==n&&a[n]>t){--n}++n;if(0!==i||n!==r){if(i>=n){n=Math.max(n,1);i=n-1}var o=this.getValueSize();this.times=Fp.arraySlice(a,i,n);this.values=Fp.arraySlice(this.values,i*o,n*o)}return this}},{key:"validate",value:function validate(){var e=!0,t=this.getValueSize();if(0!=t-Math.floor(t)){console.error("THREE.KeyframeTrack: Invalid value size in track.",this);e=!1}var a=this.times,r=this.values,i=a.length;if(0===i){console.error("THREE.KeyframeTrack: Track is empty.",this);e=!1}for(var o=null,s=0,l;s!==i;s++){l=a[s];if("number"==typeof l&&isNaN(l)){console.error("THREE.KeyframeTrack: Time is not a valid number.",this,s,l);e=!1;break}if(null!==o&&o>l){console.error("THREE.KeyframeTrack: Out of order keys.",this,s,l,o);e=!1;break}o=l}if(r!==void 0){if(Fp.isTypedArray(r)){for(var d=0,c=r.length,n;d!==c;++d){n=r[d];if(isNaN(n)){console.error("THREE.KeyframeTrack: Value is not a valid number.",this,d,n);e=!1;break}}}}return e}},{key:"optimize",value:function optimize(){for(var e=Fp.arraySlice(this.times),t=Fp.arraySlice(this.values),a=this.getValueSize(),r=this.getInterpolation()===oo,i=e.length-1,n=1,o=1;o<i;++o){var s=!1,l=e[o],d=e[o+1];if(l!==d&&(1!==o||l!==e[0])){if(!r){for(var c=o*a,u=0,p;u!==a;++u){p=t[c+u];if(p!==t[c-a+u]||p!==t[c+a+u]){s=!0;break}}}else{s=!0}}if(s){if(o!==n){e[n]=e[o];for(var m=o*a,g=n*a,f=0;f!==a;++f){t[g+f]=t[m+f]}}++n}}if(0<i){e[n]=e[i];for(var h=n*a,y=0;y!==a;++y){t[h+y]=t[i*a+y]}++n}if(n!==e.length){this.times=Fp.arraySlice(e,0,n);this.values=Fp.arraySlice(t,0,n*a)}else{this.times=e;this.values=t}return this}},{key:"clone",value:function clone(){var e=Fp.arraySlice(this.times,0),t=Fp.arraySlice(this.values,0),a=this.constructor,r=new a(this.name,e,t);r.createInterpolant=this.createInterpolant;return r}}],[{key:"toJSON",value:function toJSON(e){var t=e.constructor,a;if(t.toJSON!==this.toJSON){a=t.toJSON(e)}else{a={name:e.name,times:Fp.convertArray(e.times,Array),values:Fp.convertArray(e.values,Array)};var r=e.getInterpolation();if(r!==e.DefaultInterpolation){a.interpolation=r}}a.type=e.ValueTypeName;return a}}]);return e}();Hp.prototype.TimeBufferType=Float32Array;Hp.prototype.ValueBufferType=Float32Array;Hp.prototype.DefaultInterpolation=no;var Vp=function(e){_inherits(t,e);var a=_createSuper(t);function t(){_classCallCheck2(this,t);return a.apply(this,arguments)}return t}(Hp);Vp.prototype.ValueTypeName="bool";Vp.prototype.ValueBufferType=Array;Vp.prototype.DefaultInterpolation=io;Vp.prototype.InterpolantFactoryMethodLinear=void 0;Vp.prototype.InterpolantFactoryMethodSmooth=void 0;var Wp=function(e){_inherits(t,e);var a=_createSuper(t);function t(){_classCallCheck2(this,t);return a.apply(this,arguments)}return t}(Hp);Wp.prototype.ValueTypeName="color";var jp=function(e){_inherits(t,e);var a=_createSuper(t);function t(){_classCallCheck2(this,t);return a.apply(this,arguments)}return t}(Hp);jp.prototype.ValueTypeName="number";var qp=function(e){_inherits(t,e);var a=_createSuper(t);function t(e,r,i,n){_classCallCheck2(this,t);return a.call(this,e,r,i,n)}_createClass2(t,[{key:"interpolate_",value:function interpolate_(e,a,r,t){for(var i=this.resultBuffer,n=this.sampleValues,o=this.valueSize,s=e*o,l=s+o;s!==l;s+=4){ys.slerpFlat(i,0,n,s-o,n,s,(r-a)/(t-a))}return i}}]);return t}(Op),Xp=function(e){_inherits(t,e);var a=_createSuper(t);function t(){_classCallCheck2(this,t);return a.apply(this,arguments)}_createClass2(t,[{key:"InterpolantFactoryMethodLinear",value:function InterpolantFactoryMethodLinear(e){return new qp(this.times,this.values,this.getValueSize(),e)}}]);return t}(Hp);Xp.prototype.ValueTypeName="quaternion";Xp.prototype.DefaultInterpolation=no;Xp.prototype.InterpolantFactoryMethodSmooth=void 0;var Yp=function(e){_inherits(t,e);var a=_createSuper(t);function t(){_classCallCheck2(this,t);return a.apply(this,arguments)}return t}(Hp);Yp.prototype.ValueTypeName="string";Yp.prototype.ValueBufferType=Array;Yp.prototype.DefaultInterpolation=io;Yp.prototype.InterpolantFactoryMethodLinear=void 0;Yp.prototype.InterpolantFactoryMethodSmooth=void 0;var Zp=function(e){_inherits(t,e);var a=_createSuper(t);function t(){_classCallCheck2(this,t);return a.apply(this,arguments)}return t}(Hp);Zp.prototype.ValueTypeName="vector";var Jp=function(){function e(a){var r=1<arguments.length&&arguments[1]!==void 0?arguments[1]:-1,i=2<arguments.length?arguments[2]:void 0,n=3<arguments.length&&arguments[3]!==void 0?arguments[3]:uo;_classCallCheck2(this,e);this.name=a;this.tracks=i;this.duration=r;this.blendMode=n;this.uuid=t();if(0>this.duration){this.resetDuration()}}_createClass2(e,[{key:"resetDuration",value:function resetDuration(){for(var e=this.tracks,t=0,a=0,r=e.length,i;a!==r;++a){i=this.tracks[a];t=Math.max(t,i.times[i.times.length-1])}this.duration=t;return this}},{key:"trim",value:function trim(){for(var e=0;e<this.tracks.length;e++){this.tracks[e].trim(0,this.duration)}return this}},{key:"validate",value:function validate(){for(var e=!0,t=0;t<this.tracks.length;t++){e=e&&this.tracks[t].validate()}return e}},{key:"optimize",value:function optimize(){for(var e=0;e<this.tracks.length;e++){this.tracks[e].optimize()}return this}},{key:"clone",value:function clone(){for(var e=[],t=0;t<this.tracks.length;t++){e.push(this.tracks[t].clone())}return new this.constructor(this.name,this.duration,e,this.blendMode)}},{key:"toJSON",value:function toJSON(){return this.constructor.toJSON(this)}}],[{key:"parse",value:function parse(e){for(var t=[],a=e.tracks,r=1/(e.fps||1),i=0,o=a.length;i!==o;++i){t.push(Da(a[i]).scale(r))}var n=new this(e.name,e.duration,t,e.blendMode);n.uuid=e.uuid;return n}},{key:"toJSON",value:function toJSON(e){for(var t=[],a=e.tracks,r={name:e.name,duration:e.duration,tracks:t,uuid:e.uuid,blendMode:e.blendMode},i=0,o=a.length;i!==o;++i){t.push(Hp.toJSON(a[i]))}return r}},{key:"CreateFromMorphTargetSequence",value:function CreateFromMorphTargetSequence(e,t,a,r){for(var i=t.length,n=[],o=0;o<i;o++){var s=[],l=[];s.push((o+i-1)%i,o,(o+1)%i);l.push(0,1,0);var d=Fp.getKeyframeOrder(s);s=Fp.sortedArray(s,1,d);l=Fp.sortedArray(l,1,d);if(!r&&0===s[0]){s.push(i);l.push(l[0])}n.push(new jp(".morphTargetInfluences["+t[o].name+"]",s,l).scale(1/a))}return new this(e,-1,n)}},{key:"findByName",value:function findByName(e,t){var a=e;if(!Array.isArray(e)){var r=e;a=r.geometry&&r.geometry.animations||r.animations}for(var i=0;i<a.length;i++){if(a[i].name===t){return a[i]}}return null}},{key:"CreateClipsFromMorphTargetSequences",value:function CreateClipsFromMorphTargetSequences(e,t,a){for(var r={},i=0,n=e.length;i<n;i++){var o=e[i],s=o.name.match(/^([\w-]*?)([\d]+)$/);if(s&&1<s.length){var l=s[1],d=r[l];if(!d){r[l]=d=[]}d.push(o)}}var c=[];for(var u in r){c.push(this.CreateFromMorphTargetSequence(u,r[u],t,a))}return c}},{key:"parseAnimation",value:function parseAnimation(e,t){if(!e){console.error("THREE.AnimationClip: No animation in JSONLoader data.");return null}for(var a=function(e,t,a,r,i){if(0!==a.length){var n=[],o=[];Fp.flattenJSON(a,n,o,r);if(0!==n.length){i.push(new e(t,n,o))}}},r=[],i=e.name||"default",n=e.fps||30,o=e.blendMode,s=e.length||-1,l=e.hierarchy||[],d=0,c;d<l.length;d++){c=l[d].keys;if(!c||0===c.length)continue;if(c[0].morphTargets){var u={},p=void 0;for(p=0;p<c.length;p++){if(c[p].morphTargets){for(var x=0;x<c[p].morphTargets.length;x++){u[c[p].morphTargets[x]]=-1}}}for(var m in u){for(var g=[],f=[],y=0,v;y!==c[p].morphTargets.length;++y){v=c[p];g.push(v.time);f.push(v.morphTarget===m?1:0)}r.push(new jp(".morphTargetInfluence["+m+"]",g,f))}s=u.length*(n||1)}else{var b=".bones["+t[d].name+"]";a(Zp,b+".position",c,"pos",r);a(Xp,b+".quaternion",c,"rot",r);a(Zp,b+".scale",c,"scl",r)}}if(0===r.length){return null}var _=new this(i,s,r,o);return _}}]);return e}();function Ia(e){switch(e.toLowerCase()){case"scalar":case"double":case"float":case"number":case"integer":return jp;case"vector":case"vector2":case"vector3":case"vector4":return Zp;case"color":return Wp;case"quaternion":return Xp;case"bool":case"boolean":return Vp;case"string":return Yp;}throw new Error("THREE.KeyframeTrack: Unsupported typeName: "+e)}function Da(e){if(e.type===void 0){throw new Error("THREE.KeyframeTrack: track type undefined, can not parse")}var t=Ia(e.type);if(e.times===void 0){var a=[],r=[];Fp.flattenJSON(e.keys,a,r,"value");e.times=a;e.values=r}if(t.parse!==void 0){return t.parse(e)}else{return new t(e.name,e.times,e.values,e.interpolation)}}var Qp={enabled:!1,files:{},add:function add(e,t){if(!1===this.enabled)return;this.files[e]=t},get:function get(e){if(!1===this.enabled)return;return this.files[e]},remove:function remove(e){delete this.files[e]},clear:function clear(){this.files={}}},Kp=function e(t,a,r){_classCallCheck2(this,e);var i=this,n=!1,o=0,s=0,l=void 0,d=[];this.onStart=void 0;this.onLoad=t;this.onProgress=a;this.onError=r;this.itemStart=function(e){s++;if(!1===n){if(i.onStart!==void 0){i.onStart(e,o,s)}}n=!0};this.itemEnd=function(e){o++;if(i.onProgress!==void 0){i.onProgress(e,o,s)}if(o===s){n=!1;if(i.onLoad!==void 0){i.onLoad()}}};this.itemError=function(e){if(i.onError!==void 0){i.onError(e)}};this.resolveURL=function(e){if(l){return l(e)}return e};this.setURLModifier=function(e){l=e;return this};this.addHandler=function(e,t){d.push(e,t);return this};this.removeHandler=function(e){var t=d.indexOf(e);if(-1!==t){d.splice(t,2)}return this};this.getHandler=function(e){for(var r=0,i=d.length;r<i;r+=2){var t=d[r],a=d[r+1];if(t.global)t.lastIndex=0;if(t.test(e)){return a}}return null}},$p=new Kp,em=function(){function e(t){_classCallCheck2(this,e);this.manager=t!==void 0?t:$p;this.crossOrigin="anonymous";this.withCredentials=!1;this.path="";this.resourcePath="";this.requestHeader={}}_createClass2(e,[{key:"load",value:function load(){}},{key:"loadAsync",value:function loadAsync(e,t){var a=this;return new Promise(function(r,i){a.load(e,r,t,i)})}},{key:"parse",value:function parse(){}},{key:"setCrossOrigin",value:function setCrossOrigin(e){this.crossOrigin=e;return this}},{key:"setWithCredentials",value:function setWithCredentials(e){this.withCredentials=e;return this}},{key:"setPath",value:function setPath(e){this.path=e;return this}},{key:"setResourcePath",value:function setResourcePath(e){this.resourcePath=e;return this}},{key:"setRequestHeader",value:function setRequestHeader(e){this.requestHeader=e;return this}}]);return e}(),tm={},am=function(e){_inherits(t,e);var a=_createSuper(t);function t(e){_classCallCheck2(this,t);return a.call(this,e)}_createClass2(t,[{key:"load",value:function load(e,t,a,r){var i=this;if(e===void 0)e="";if(this.path!==void 0)e=this.path+e;e=this.manager.resolveURL(e);var n=Qp.get(e);if(n!==void 0){this.manager.itemStart(e);setTimeout(function(){if(t)t(n);i.manager.itemEnd(e)},0);return n}if(tm[e]!==void 0){tm[e].push({onLoad:t,onProgress:a,onError:r});return}tm[e]=[];tm[e].push({onLoad:t,onProgress:a,onError:r});var o=new Request(e,{headers:new Headers(this.requestHeader),credentials:this.withCredentials?"include":"same-origin"});fetch(o).then(function(t){if(200===t.status||0===t.status){if(0===t.status){console.warn("THREE.FileLoader: HTTP Status 0 received.")}var a=tm[e],r=t.body.getReader(),i=t.headers.get("Content-Length"),n=i?parseInt(i):0,o=0;return new ReadableStream({start:function start(e){t();function t(){r.read().then(function(r){var i=r.done,s=r.value;if(i){e.close()}else{o+=s.byteLength;for(var l=new ProgressEvent("progress",{lengthComputable:0!==n,loaded:o,total:n}),d=0,c=a.length,u;d<c;d++){u=a[d];if(u.onProgress)u.onProgress(l)}e.enqueue(s);t()}})}}})}else{throw Error("fetch for \"".concat(t.url,"\" responded with ").concat(t.status,": ").concat(t.statusText))}}).then(function(e){var t=new Response(e);switch(i.responseType){case"arraybuffer":return t.arrayBuffer();case"blob":return t.blob();case"document":return t.text().then(function(e){var t=new DOMParser;return t.parseFromString(e,i.mimeType)});case"json":return t.json();default:return t.text();}}).then(function(t){Qp.add(e,t);var a=tm[e];delete tm[e];for(var r=0,n=a.length,o;r<n;r++){o=a[r];if(o.onLoad)o.onLoad(t)}i.manager.itemEnd(e)}).catch(function(t){var a=tm[e];delete tm[e];for(var r=0,n=a.length,o;r<n;r++){o=a[r];if(o.onError)o.onError(t)}i.manager.itemError(e);i.manager.itemEnd(e)});this.manager.itemStart(e)}},{key:"setResponseType",value:function setResponseType(e){this.responseType=e;return this}},{key:"setMimeType",value:function setMimeType(e){this.mimeType=e;return this}}]);return t}(em),rm=function(e){_inherits(t,e);var a=_createSuper(t);function t(e){_classCallCheck2(this,t);return a.call(this,e)}_createClass2(t,[{key:"load",value:function load(t,a,r,i){var n=this,o=new am(this.manager);o.setPath(this.path);o.setRequestHeader(this.requestHeader);o.setWithCredentials(this.withCredentials);o.load(t,function(e){try{a(n.parse(JSON.parse(e)))}catch(a){if(i){i(a)}else{console.error(a)}n.manager.itemError(t)}},r,i)}},{key:"parse",value:function parse(e){for(var t=[],a=0,r;a<e.length;a++){r=Jp.parse(e[a]);t.push(r)}return t}}]);return t}(em),im=function(e){_inherits(t,e);var a=_createSuper(t);function t(e){_classCallCheck2(this,t);return a.call(this,e)}_createClass2(t,[{key:"load",value:function load(e,t,a,r){var n=this,o=[],s=new Du,l=new am(this.manager);l.setPath(this.path);l.setResponseType("arraybuffer");l.setRequestHeader(this.requestHeader);l.setWithCredentials(n.withCredentials);var d=0;function i(c){l.load(e[c],function(e){var a=n.parse(e,!0);o[c]={width:a.width,height:a.height,format:a.format,mipmaps:a.mipmaps};d+=1;if(6==d){if(1===a.mipmapCount)s.minFilter=Fi;s.image=o;s.format=a.format;s.needsUpdate=!0;if(t)t(s)}},a,r)}if(Array.isArray(e)){for(var c=0,u=e.length;c<u;++c){i(c)}}else{l.load(e,function(e){var a=n.parse(e,!0);if(a.isCubemap){for(var r=a.mipmaps.length/a.mipmapCount,i=0;i<r;i++){o[i]={mipmaps:[]};for(var l=0;l<a.mipmapCount;l++){o[i].mipmaps.push(a.mipmaps[i*a.mipmapCount+l]);o[i].format=a.format;o[i].width=a.width;o[i].height=a.height}}s.image=o}else{s.image.width=a.width;s.image.height=a.height;s.mipmaps=a.mipmaps}if(1===a.mipmapCount){s.minFilter=Fi}s.format=a.format;s.needsUpdate=!0;if(t)t(s)},a,r)}return s}}]);return t}(em),nm=function(e){_inherits(t,e);var a=_createSuper(t);function t(e){_classCallCheck2(this,t);return a.call(this,e)}_createClass2(t,[{key:"load",value:function load(e,t,a,r){if(this.path!==void 0)e=this.path+e;e=this.manager.resolveURL(e);var s=this,l=Qp.get(e);if(l!==void 0){s.manager.itemStart(e);setTimeout(function(){if(t)t(l);s.manager.itemEnd(e)},0);return l}var d=m("img");function i(){o();Qp.add(e,this);if(t)t(this);s.manager.itemEnd(e)}function n(t){o();if(r)r(t);s.manager.itemError(e);s.manager.itemEnd(e)}function o(){d.removeEventListener("load",i,!1);d.removeEventListener("error",n,!1)}d.addEventListener("load",i,!1);d.addEventListener("error",n,!1);if("data:"!==e.substr(0,5)){if(this.crossOrigin!==void 0)d.crossOrigin=this.crossOrigin}s.manager.itemStart(e);d.src=e;return d}}]);return t}(em),om=function(e){_inherits(t,e);var a=_createSuper(t);function t(e){_classCallCheck2(this,t);return a.call(this,e)}_createClass2(t,[{key:"load",value:function load(e,t,a,r){var n=new kd,o=new nm(this.manager);o.setCrossOrigin(this.crossOrigin);o.setPath(this.path);var s=0;function i(a){o.load(e[a],function(e){n.images[a]=e;s++;if(6==s){n.needsUpdate=!0;if(t)t(n)}},void 0,r)}for(var l=0;l<e.length;++l){i(l)}return n}}]);return t}(em),sm=function(e){_inherits(t,e);var a=_createSuper(t);function t(e){_classCallCheck2(this,t);return a.call(this,e)}_createClass2(t,[{key:"load",value:function load(e,t,a,r){var i=this,n=new ou,o=new am(this.manager);o.setResponseType("arraybuffer");o.setRequestHeader(this.requestHeader);o.setPath(this.path);o.setWithCredentials(i.withCredentials);o.load(e,function(e){var a=i.parse(e);if(!a)return;if(a.image!==void 0){n.image=a.image}else if(a.data!==void 0){n.image.width=a.width;n.image.height=a.height;n.image.data=a.data}n.wrapS=a.wrapS!==void 0?a.wrapS:Ri;n.wrapT=a.wrapT!==void 0?a.wrapT:Ri;n.magFilter=a.magFilter!==void 0?a.magFilter:Fi;n.minFilter=a.minFilter!==void 0?a.minFilter:Fi;n.anisotropy=a.anisotropy!==void 0?a.anisotropy:1;if(a.encoding!==void 0){n.encoding=a.encoding}if(a.flipY!==void 0){n.flipY=a.flipY}if(a.format!==void 0){n.format=a.format}if(a.type!==void 0){n.type=a.type}if(a.mipmaps!==void 0){n.mipmaps=a.mipmaps;n.minFilter=Ui}if(1===a.mipmapCount){n.minFilter=Fi}if(a.generateMipmaps!==void 0){n.generateMipmaps=a.generateMipmaps}n.needsUpdate=!0;if(t)t(n,a)},a,r);return n}}]);return t}(em),lm=function(e){_inherits(t,e);var a=_createSuper(t);function t(e){_classCallCheck2(this,t);return a.call(this,e)}_createClass2(t,[{key:"load",value:function load(e,t,a,r){var i=new ps,n=new nm(this.manager);n.setCrossOrigin(this.crossOrigin);n.setPath(this.path);n.load(e,function(e){i.image=e;i.needsUpdate=!0;if(t!==void 0){t(i)}},a,r);return i}}]);return t}(em),dm=function(e){_inherits(t,e);var a=_createSuper(t);function t(e){var r,i=1<arguments.length&&arguments[1]!==void 0?arguments[1]:1;_classCallCheck2(this,t);r=a.call(this);r.type="Light";r.color=new zl(e);r.intensity=i;return r}_createClass2(t,[{key:"dispose",value:function dispose(){}},{key:"copy",value:function copy(e){_get(_getPrototypeOf(t.prototype),"copy",this).call(this,e);this.color.copy(e.color);this.intensity=e.intensity;return this}},{key:"toJSON",value:function toJSON(e){var a=_get(_getPrototypeOf(t.prototype),"toJSON",this).call(this,e);a.object.color=this.color.getHex();a.object.intensity=this.intensity;if(this.groundColor!==void 0)a.object.groundColor=this.groundColor.getHex();if(this.distance!==void 0)a.object.distance=this.distance;if(this.angle!==void 0)a.object.angle=this.angle;if(this.decay!==void 0)a.object.decay=this.decay;if(this.penumbra!==void 0)a.object.penumbra=this.penumbra;if(this.shadow!==void 0)a.object.shadow=this.shadow.toJSON();return a}}]);return t}(vl);dm.prototype.isLight=!0;var cm=function(e){_inherits(t,e);var a=_createSuper(t);function t(e,r,i){var n;_classCallCheck2(this,t);n=a.call(this,e,i);n.type="HemisphereLight";n.position.copy(vl.DefaultUp);n.updateMatrix();n.groundColor=new zl(r);return n}_createClass2(t,[{key:"copy",value:function copy(e){dm.prototype.copy.call(this,e);this.groundColor.copy(e.groundColor);return this}}]);return t}(dm);cm.prototype.isHemisphereLight=!0;var um=new Ys,pm=new vs,mm=new vs,gm=function(){function e(t){_classCallCheck2(this,e);this.camera=t;this.bias=0;this.normalBias=0;this.radius=1;this.blurSamples=8;this.mapSize=new os(512,512);this.map=null;this.mapPass=null;this.matrix=new Ys;this.autoUpdate=!0;this.needsUpdate=!1;this._frustum=new Nd;this._frameExtents=new os(1,1);this._viewportCount=1;this._viewports=[new ms(0,0,1,1)]}_createClass2(e,[{key:"getViewportCount",value:function getViewportCount(){return this._viewportCount}},{key:"getFrustum",value:function getFrustum(){return this._frustum}},{key:"updateMatrices",value:function updateMatrices(e){var t=this.camera,a=this.matrix;pm.setFromMatrixPosition(e.matrixWorld);t.position.copy(pm);mm.setFromMatrixPosition(e.target.matrixWorld);t.lookAt(mm);t.updateMatrixWorld();um.multiplyMatrices(t.projectionMatrix,t.matrixWorldInverse);this._frustum.setFromProjectionMatrix(um);a.set(.5,0,0,.5,0,.5,0,.5,0,0,.5,.5,0,0,0,1);a.multiply(t.projectionMatrix);a.multiply(t.matrixWorldInverse)}},{key:"getViewport",value:function getViewport(e){return this._viewports[e]}},{key:"getFrameExtents",value:function getFrameExtents(){return this._frameExtents}},{key:"dispose",value:function dispose(){if(this.map){this.map.dispose()}if(this.mapPass){this.mapPass.dispose()}}},{key:"copy",value:function copy(e){this.camera=e.camera.clone();this.bias=e.bias;this.radius=e.radius;this.mapSize.copy(e.mapSize);return this}},{key:"clone",value:function clone(){return new this.constructor().copy(this)}},{key:"toJSON",value:function toJSON(){var e={};if(0!==this.bias)e.bias=this.bias;if(0!==this.normalBias)e.normalBias=this.normalBias;if(1!==this.radius)e.radius=this.radius;if(512!==this.mapSize.x||512!==this.mapSize.y)e.mapSize=this.mapSize.toArray();e.camera=this.camera.toJSON(!1).object;delete e.camera.matrix;return e}}]);return e}(),fm=function(e){_inherits(t,e);var a=_createSuper(t);function t(){var e;_classCallCheck2(this,t);e=a.call(this,new wd(50,1,.5,500));e.focus=1;return e}_createClass2(t,[{key:"updateMatrices",value:function updateMatrices(e){var a=this.camera,r=2*is*e.angle*this.focus,i=this.mapSize.width/this.mapSize.height,n=e.distance||a.far;if(90!==a.fov||1!==a.aspect||n!==a.far){a.fov=90;a.aspect=1;a.far=n;a.updateProjectionMatrix()}_get(_getPrototypeOf(t.prototype),"updateMatrices",this).call(this,e)}},{key:"copy",value:function copy(e){_get(_getPrototypeOf(t.prototype),"copy",this).call(this,e);this.focus=e.focus;return this}}]);return t}(gm);fm.prototype.isSpotLightShadow=!0;var hm=function(e){_inherits(t,e);var a=_createSuper(t);function t(e,r){var i,n=2<arguments.length&&arguments[2]!==void 0?arguments[2]:0,o=3<arguments.length&&arguments[3]!==void 0?arguments[3]:Math.PI/3,s=4<arguments.length&&arguments[4]!==void 0?arguments[4]:0,l=5<arguments.length&&arguments[5]!==void 0?arguments[5]:1;_classCallCheck2(this,t);i=a.call(this,e,r);i.type="SpotLight";i.position.copy(vl.DefaultUp);i.updateMatrix();i.target=new vl;i.distance=n;i.angle=o;i.penumbra=s;i.decay=l;i.shadow=new fm;return i}_createClass2(t,[{key:"dispose",value:function dispose(){this.shadow.dispose()}},{key:"copy",value:function copy(e){_get(_getPrototypeOf(t.prototype),"copy",this).call(this,e);this.distance=e.distance;this.angle=e.angle;this.penumbra=e.penumbra;this.decay=e.decay;this.target=e.target.clone();this.shadow=e.shadow.clone();return this}},{key:"power",get:function get(){return this.intensity*Math.PI},set:function set(e){this.intensity=e/Math.PI}}]);return t}(dm);hm.prototype.isSpotLight=!0;var ym=new Ys,vm=new vs,_m=new vs,xm=function(e){_inherits(t,e);var a=_createSuper(t);function t(){var e;_classCallCheck2(this,t);e=a.call(this,new wd(90,1,.5,500));e._frameExtents=new os(4,2);e._viewportCount=6;e._viewports=[new ms(2,1,1,1),new ms(0,1,1,1),new ms(3,1,1,1),new ms(1,1,1,1),new ms(3,0,1,1),new ms(1,0,1,1)];e._cubeDirections=[new vs(1,0,0),new vs(-1,0,0),new vs(0,0,1),new vs(0,0,-1),new vs(0,1,0),new vs(0,-1,0)];e._cubeUps=[new vs(0,1,0),new vs(0,1,0),new vs(0,1,0),new vs(0,1,0),new vs(0,0,1),new vs(0,0,-1)];return e}_createClass2(t,[{key:"updateMatrices",value:function updateMatrices(e){var t=1<arguments.length&&arguments[1]!==void 0?arguments[1]:0,a=this.camera,r=this.matrix,i=e.distance||a.far;if(i!==a.far){a.far=i;a.updateProjectionMatrix()}vm.setFromMatrixPosition(e.matrixWorld);a.position.copy(vm);_m.copy(a.position);_m.add(this._cubeDirections[t]);a.up.copy(this._cubeUps[t]);a.lookAt(_m);a.updateMatrixWorld();r.makeTranslation(-vm.x,-vm.y,-vm.z);ym.multiplyMatrices(a.projectionMatrix,a.matrixWorldInverse);this._frustum.setFromProjectionMatrix(ym)}}]);return t}(gm);xm.prototype.isPointLightShadow=!0;var bm=function(e){_inherits(t,e);var a=_createSuper(t);function t(e,r){var i,n=2<arguments.length&&arguments[2]!==void 0?arguments[2]:0,o=3<arguments.length&&arguments[3]!==void 0?arguments[3]:1;_classCallCheck2(this,t);i=a.call(this,e,r);i.type="PointLight";i.distance=n;i.decay=o;i.shadow=new xm;return i}_createClass2(t,[{key:"dispose",value:function dispose(){this.shadow.dispose()}},{key:"copy",value:function copy(e){_get(_getPrototypeOf(t.prototype),"copy",this).call(this,e);this.distance=e.distance;this.decay=e.decay;this.shadow=e.shadow.clone();return this}},{key:"power",get:function get(){return 4*this.intensity*Math.PI},set:function set(e){this.intensity=e/(4*Math.PI)}}]);return t}(dm);bm.prototype.isPointLight=!0;var Sm=function(e){_inherits(t,e);var a=_createSuper(t);function t(){_classCallCheck2(this,t);return a.call(this,new Gd(-5,5,5,-5,.5,500))}return t}(gm);Sm.prototype.isDirectionalLightShadow=!0;var Mm=function(e){_inherits(t,e);var a=_createSuper(t);function t(e,r){var i;_classCallCheck2(this,t);i=a.call(this,e,r);i.type="DirectionalLight";i.position.copy(vl.DefaultUp);i.updateMatrix();i.target=new vl;i.shadow=new Sm;return i}_createClass2(t,[{key:"dispose",value:function dispose(){this.shadow.dispose()}},{key:"copy",value:function copy(e){_get(_getPrototypeOf(t.prototype),"copy",this).call(this,e);this.target=e.target.clone();this.shadow=e.shadow.clone();return this}}]);return t}(dm);Mm.prototype.isDirectionalLight=!0;var Tm=function(e){_inherits(t,e);var a=_createSuper(t);function t(e,r){var i;_classCallCheck2(this,t);i=a.call(this,e,r);i.type="AmbientLight";return i}return t}(dm);Tm.prototype.isAmbientLight=!0;var Em=function(e){_inherits(t,e);var a=_createSuper(t);function t(e,r){var i,n=2<arguments.length&&arguments[2]!==void 0?arguments[2]:10,o=3<arguments.length&&arguments[3]!==void 0?arguments[3]:10;_classCallCheck2(this,t);i=a.call(this,e,r);i.type="RectAreaLight";i.width=n;i.height=o;return i}_createClass2(t,[{key:"copy",value:function copy(e){_get(_getPrototypeOf(t.prototype),"copy",this).call(this,e);this.width=e.width;this.height=e.height;return this}},{key:"toJSON",value:function toJSON(e){var a=_get(_getPrototypeOf(t.prototype),"toJSON",this).call(this,e);a.object.width=this.width;a.object.height=this.height;return a}},{key:"power",get:function get(){return this.intensity*this.width*this.height*Math.PI},set:function set(e){this.intensity=e/(this.width*this.height*Math.PI)}}]);return t}(dm);Em.prototype.isRectAreaLight=!0;var wm=function(){function e(){_classCallCheck2(this,e);this.coefficients=[];for(var t=0;9>t;t++){this.coefficients.push(new vs)}}_createClass2(e,[{key:"set",value:function set(e){for(var t=0;9>t;t++){this.coefficients[t].copy(e[t])}return this}},{key:"zero",value:function zero(){for(var e=0;9>e;e++){this.coefficients[e].set(0,0,0)}return this}},{key:"getAt",value:function getAt(e,t){var a=e.x,r=e.y,i=e.z,n=this.coefficients;t.copy(n[0]).multiplyScalar(.282095);t.addScaledVector(n[1],.488603*r);t.addScaledVector(n[2],.488603*i);t.addScaledVector(n[3],.488603*a);t.addScaledVector(n[4],1.092548*(a*r));t.addScaledVector(n[5],1.092548*(r*i));t.addScaledVector(n[6],.315392*(3*i*i-1));t.addScaledVector(n[7],1.092548*(a*i));t.addScaledVector(n[8],.546274*(a*a-r*r));return t}},{key:"getIrradianceAt",value:function getIrradianceAt(e,t){var a=e.x,r=e.y,i=e.z,n=this.coefficients;t.copy(n[0]).multiplyScalar(.886227);t.addScaledVector(n[1],.511664*2*r);t.addScaledVector(n[2],.511664*2*i);t.addScaledVector(n[3],.511664*2*a);t.addScaledVector(n[4],.429043*2*a*r);t.addScaledVector(n[5],.429043*2*r*i);t.addScaledVector(n[6],.743125*i*i-.247708);t.addScaledVector(n[7],.429043*2*a*i);t.addScaledVector(n[8],.429043*(a*a-r*r));return t}},{key:"add",value:function add(e){for(var t=0;9>t;t++){this.coefficients[t].add(e.coefficients[t])}return this}},{key:"addScaledSH",value:function addScaledSH(e,t){for(var a=0;9>a;a++){this.coefficients[a].addScaledVector(e.coefficients[a],t)}return this}},{key:"scale",value:function scale(e){for(var t=0;9>t;t++){this.coefficients[t].multiplyScalar(e)}return this}},{key:"lerp",value:function(e,t){for(var a=0;9>a;a++){this.coefficients[a].lerp(e.coefficients[a],t)}return this}},{key:"equals",value:function(e){for(var t=0;9>t;t++){if(!this.coefficients[t].equals(e.coefficients[t])){return!1}}return!0}},{key:"copy",value:function copy(e){return this.set(e.coefficients)}},{key:"clone",value:function clone(){return new this.constructor().copy(this)}},{key:"fromArray",value:function fromArray(e){for(var t=1<arguments.length&&arguments[1]!==void 0?arguments[1]:0,a=this.coefficients,r=0;9>r;r++){a[r].fromArray(e,t+3*r)}return this}},{key:"toArray",value:function toArray(){for(var e=0<arguments.length&&arguments[0]!==void 0?arguments[0]:[],t=1<arguments.length&&arguments[1]!==void 0?arguments[1]:0,a=this.coefficients,r=0;9>r;r++){a[r].toArray(e,t+3*r)}return e}}],[{key:"getBasisAt",value:function getBasisAt(e,t){var a=e.x,r=e.y,i=e.z;t[0]=.282095;t[1]=.488603*r;t[2]=.488603*i;t[3]=.488603*a;t[4]=1.092548*a*r;t[5]=1.092548*r*i;t[6]=.315392*(3*i*i-1);t[7]=1.092548*a*i;t[8]=.546274*(a*a-r*r)}}]);return e}();wm.prototype.isSphericalHarmonics3=!0;var Am=function(e){_inherits(t,e);var a=_createSuper(t);function t(){var e,r=0<arguments.length&&arguments[0]!==void 0?arguments[0]:new wm,i=1<arguments.length&&arguments[1]!==void 0?arguments[1]:1;_classCallCheck2(this,t);e=a.call(this,void 0,i);e.sh=r;return e}_createClass2(t,[{key:"copy",value:function copy(e){_get(_getPrototypeOf(t.prototype),"copy",this).call(this,e);this.sh.copy(e.sh);return this}},{key:"fromJSON",value:function fromJSON(e){this.intensity=e.intensity;this.sh.fromArray(e.sh);return this}},{key:"toJSON",value:function toJSON(e){var a=_get(_getPrototypeOf(t.prototype),"toJSON",this).call(this,e);a.object.sh=this.sh.toArray();return a}}]);return t}(dm);Am.prototype.isLightProbe=!0;var km=function(e){_inherits(t,e);var a=_createSuper(t);function t(e){var r;_classCallCheck2(this,t);r=a.call(this,e);r.textures={};return r}_createClass2(t,[{key:"load",value:function load(t,a,r,i){var n=this,o=new am(n.manager);o.setPath(n.path);o.setRequestHeader(n.requestHeader);o.setWithCredentials(n.withCredentials);o.load(t,function(e){try{a(n.parse(JSON.parse(e)))}catch(a){if(i){i(a)}else{console.error(a)}n.manager.itemError(t)}},r,i)}},{key:"parse",value:function parse(e){var a=this.textures;function t(e){if(a[e]===void 0){console.warn("THREE.MaterialLoader: Undefined texture",e)}return a[e]}var r=new Np[e.type];if(e.uuid!==void 0)r.uuid=e.uuid;if(e.name!==void 0)r.name=e.name;if(e.color!==void 0&&r.color!==void 0)r.color.setHex(e.color);if(e.roughness!==void 0)r.roughness=e.roughness;if(e.metalness!==void 0)r.metalness=e.metalness;if(e.sheen!==void 0)r.sheen=e.sheen;if(e.sheenColor!==void 0)r.sheenColor=new zl().setHex(e.sheenColor);if(e.sheenRoughness!==void 0)r.sheenRoughness=e.sheenRoughness;if(e.emissive!==void 0&&r.emissive!==void 0)r.emissive.setHex(e.emissive);if(e.specular!==void 0&&r.specular!==void 0)r.specular.setHex(e.specular);if(e.specularIntensity!==void 0)r.specularIntensity=e.specularIntensity;if(e.specularColor!==void 0&&r.specularColor!==void 0)r.specularColor.setHex(e.specularColor);if(e.shininess!==void 0)r.shininess=e.shininess;if(e.clearcoat!==void 0)r.clearcoat=e.clearcoat;if(e.clearcoatRoughness!==void 0)r.clearcoatRoughness=e.clearcoatRoughness;if(e.transmission!==void 0)r.transmission=e.transmission;if(e.thickness!==void 0)r.thickness=e.thickness;if(e.attenuationDistance!==void 0)r.attenuationDistance=e.attenuationDistance;if(e.attenuationColor!==void 0&&r.attenuationColor!==void 0)r.attenuationColor.setHex(e.attenuationColor);if(e.fog!==void 0)r.fog=e.fog;if(e.flatShading!==void 0)r.flatShading=e.flatShading;if(e.blending!==void 0)r.blending=e.blending;if(e.combine!==void 0)r.combine=e.combine;if(e.side!==void 0)r.side=e.side;if(e.shadowSide!==void 0)r.shadowSide=e.shadowSide;if(e.opacity!==void 0)r.opacity=e.opacity;if(e.format!==void 0)r.format=e.format;if(e.transparent!==void 0)r.transparent=e.transparent;if(e.alphaTest!==void 0)r.alphaTest=e.alphaTest;if(e.depthTest!==void 0)r.depthTest=e.depthTest;if(e.depthWrite!==void 0)r.depthWrite=e.depthWrite;if(e.colorWrite!==void 0)r.colorWrite=e.colorWrite;if(e.stencilWrite!==void 0)r.stencilWrite=e.stencilWrite;if(e.stencilWriteMask!==void 0)r.stencilWriteMask=e.stencilWriteMask;if(e.stencilFunc!==void 0)r.stencilFunc=e.stencilFunc;if(e.stencilRef!==void 0)r.stencilRef=e.stencilRef;if(e.stencilFuncMask!==void 0)r.stencilFuncMask=e.stencilFuncMask;if(e.stencilFail!==void 0)r.stencilFail=e.stencilFail;if(e.stencilZFail!==void 0)r.stencilZFail=e.stencilZFail;if(e.stencilZPass!==void 0)r.stencilZPass=e.stencilZPass;if(e.wireframe!==void 0)r.wireframe=e.wireframe;if(e.wireframeLinewidth!==void 0)r.wireframeLinewidth=e.wireframeLinewidth;if(e.wireframeLinecap!==void 0)r.wireframeLinecap=e.wireframeLinecap;if(e.wireframeLinejoin!==void 0)r.wireframeLinejoin=e.wireframeLinejoin;if(e.rotation!==void 0)r.rotation=e.rotation;if(1!==e.linewidth)r.linewidth=e.linewidth;if(e.dashSize!==void 0)r.dashSize=e.dashSize;if(e.gapSize!==void 0)r.gapSize=e.gapSize;if(e.scale!==void 0)r.scale=e.scale;if(e.polygonOffset!==void 0)r.polygonOffset=e.polygonOffset;if(e.polygonOffsetFactor!==void 0)r.polygonOffsetFactor=e.polygonOffsetFactor;if(e.polygonOffsetUnits!==void 0)r.polygonOffsetUnits=e.polygonOffsetUnits;if(e.dithering!==void 0)r.dithering=e.dithering;if(e.alphaToCoverage!==void 0)r.alphaToCoverage=e.alphaToCoverage;if(e.premultipliedAlpha!==void 0)r.premultipliedAlpha=e.premultipliedAlpha;if(e.visible!==void 0)r.visible=e.visible;if(e.toneMapped!==void 0)r.toneMapped=e.toneMapped;if(e.userData!==void 0)r.userData=e.userData;if(e.vertexColors!==void 0){if("number"==typeof e.vertexColors){r.vertexColors=0<e.vertexColors?!0:!1}else{r.vertexColors=e.vertexColors}}if(e.uniforms!==void 0){for(var i in e.uniforms){var n=e.uniforms[i];r.uniforms[i]={};switch(n.type){case"t":r.uniforms[i].value=t(n.value);break;case"c":r.uniforms[i].value=new zl().setHex(n.value);break;case"v2":r.uniforms[i].value=new os().fromArray(n.value);break;case"v3":r.uniforms[i].value=new vs().fromArray(n.value);break;case"v4":r.uniforms[i].value=new ms().fromArray(n.value);break;case"m3":r.uniforms[i].value=new ss().fromArray(n.value);break;case"m4":r.uniforms[i].value=new Ys().fromArray(n.value);break;default:r.uniforms[i].value=n.value;}}}if(e.defines!==void 0)r.defines=e.defines;if(e.vertexShader!==void 0)r.vertexShader=e.vertexShader;if(e.fragmentShader!==void 0)r.fragmentShader=e.fragmentShader;if(e.extensions!==void 0){for(var o in e.extensions){r.extensions[o]=e.extensions[o]}}if(e.shading!==void 0)r.flatShading=1===e.shading;if(e.size!==void 0)r.size=e.size;if(e.sizeAttenuation!==void 0)r.sizeAttenuation=e.sizeAttenuation;if(e.map!==void 0)r.map=t(e.map);if(e.matcap!==void 0)r.matcap=t(e.matcap);if(e.alphaMap!==void 0)r.alphaMap=t(e.alphaMap);if(e.bumpMap!==void 0)r.bumpMap=t(e.bumpMap);if(e.bumpScale!==void 0)r.bumpScale=e.bumpScale;if(e.normalMap!==void 0)r.normalMap=t(e.normalMap);if(e.normalMapType!==void 0)r.normalMapType=e.normalMapType;if(e.normalScale!==void 0){var s=e.normalScale;if(!1===Array.isArray(s)){s=[s,s]}r.normalScale=new os().fromArray(s)}if(e.displacementMap!==void 0)r.displacementMap=t(e.displacementMap);if(e.displacementScale!==void 0)r.displacementScale=e.displacementScale;if(e.displacementBias!==void 0)r.displacementBias=e.displacementBias;if(e.roughnessMap!==void 0)r.roughnessMap=t(e.roughnessMap);if(e.metalnessMap!==void 0)r.metalnessMap=t(e.metalnessMap);if(e.emissiveMap!==void 0)r.emissiveMap=t(e.emissiveMap);if(e.emissiveIntensity!==void 0)r.emissiveIntensity=e.emissiveIntensity;if(e.specularMap!==void 0)r.specularMap=t(e.specularMap);if(e.specularIntensityMap!==void 0)r.specularIntensityMap=t(e.specularIntensityMap);if(e.specularColorMap!==void 0)r.specularColorMap=t(e.specularColorMap);if(e.envMap!==void 0)r.envMap=t(e.envMap);if(e.envMapIntensity!==void 0)r.envMapIntensity=e.envMapIntensity;if(e.reflectivity!==void 0)r.reflectivity=e.reflectivity;if(e.refractionRatio!==void 0)r.refractionRatio=e.refractionRatio;if(e.lightMap!==void 0)r.lightMap=t(e.lightMap);if(e.lightMapIntensity!==void 0)r.lightMapIntensity=e.lightMapIntensity;if(e.aoMap!==void 0)r.aoMap=t(e.aoMap);if(e.aoMapIntensity!==void 0)r.aoMapIntensity=e.aoMapIntensity;if(e.gradientMap!==void 0)r.gradientMap=t(e.gradientMap);if(e.clearcoatMap!==void 0)r.clearcoatMap=t(e.clearcoatMap);if(e.clearcoatRoughnessMap!==void 0)r.clearcoatRoughnessMap=t(e.clearcoatRoughnessMap);if(e.clearcoatNormalMap!==void 0)r.clearcoatNormalMap=t(e.clearcoatNormalMap);if(e.clearcoatNormalScale!==void 0)r.clearcoatNormalScale=new os().fromArray(e.clearcoatNormalScale);if(e.transmissionMap!==void 0)r.transmissionMap=t(e.transmissionMap);if(e.thicknessMap!==void 0)r.thicknessMap=t(e.thicknessMap);if(e.sheenColorMap!==void 0)r.sheenColorMap=t(e.sheenColorMap);if(e.sheenRoughnessMap!==void 0)r.sheenRoughnessMap=t(e.sheenRoughnessMap);return r}},{key:"setTextures",value:function setTextures(e){this.textures=e;return this}}]);return t}(em),Cm=function(){function e(){_classCallCheck2(this,e)}_createClass2(e,null,[{key:"decodeText",value:function decodeText(e){if("undefined"!=typeof TextDecoder){return new TextDecoder().decode(e)}for(var t="",a=0,r=e.length;a<r;a++){t+=String.fromCharCode(e[a])}try{return decodeURIComponent(escape(t))}catch(a){return t}}},{key:"extractUrlBase",value:function extractUrlBase(e){var t=e.lastIndexOf("/");if(-1===t)return"./";return e.substr(0,t+1)}},{key:"resolveURL",value:function resolveURL(e,t){if("string"!=typeof e||""===e)return"";if(/^https?:\/\//i.test(t)&&/^\//.test(e)){t=t.replace(/(^https?:\/\/[^\/]+).*/i,"$1")}if(/^(https?:)?\/\//i.test(e))return e;if(/^data:.*,.*$/i.test(e))return e;if(/^blob:.*$/i.test(e))return e;return t+e}}]);return e}(),Rm=function(e){_inherits(t,e);var a=_createSuper(t);function t(){var e;_classCallCheck2(this,t);e=a.call(this);e.type="InstancedBufferGeometry";e.instanceCount=1/0;return e}_createClass2(t,[{key:"copy",value:function copy(e){_get(_getPrototypeOf(t.prototype),"copy",this).call(this,e);this.instanceCount=e.instanceCount;return this}},{key:"clone",value:function clone(){return new this.constructor().copy(this)}},{key:"toJSON",value:function toJSON(){var e=_get(_getPrototypeOf(t.prototype),"toJSON",this).call(this,this);e.instanceCount=this.instanceCount;e.isInstancedBufferGeometry=!0;return e}}]);return t}(rd);Rm.prototype.isInstancedBufferGeometry=!0;var Lm=function(e){_inherits(t,e);var a=_createSuper(t);function t(e){_classCallCheck2(this,t);return a.call(this,e)}_createClass2(t,[{key:"load",value:function load(t,a,r,i){var n=this,o=new am(n.manager);o.setPath(n.path);o.setRequestHeader(n.requestHeader);o.setWithCredentials(n.withCredentials);o.load(t,function(e){try{a(n.parse(JSON.parse(e)))}catch(a){if(i){i(a)}else{console.error(a)}n.manager.itemError(t)}},r,i)}},{key:"parse",value:function parse(e){var r={},i={};function t(e,t){if(r[t]!==void 0)return r[t];var i=e.interleavedBuffers,n=i[t],o=a(e,n.buffer),s=p(n.type,o),l=new Pc(s,n.stride);l.uuid=n.uuid;r[t]=l;return l}function a(e,t){if(i[t]!==void 0)return i[t];var a=e.arrayBuffers,r=a[t],n=new Uint32Array(r).buffer;i[t]=n;return n}var o=e.isInstancedBufferGeometry?new Rm:new rd,s=e.data.index;if(s!==void 0){var T=p(s.type,s.array);o.setIndex(new Bl(T,1))}var l=e.data.attributes;for(var E in l){var d=l[E],c=void 0;if(d.isInterleavedBufferAttribute){var w=t(e.data,d.data);c=new Dc(w,d.itemSize,d.offset,d.normalized)}else{var u=p(d.type,d.array),m=d.isInstancedBufferAttribute?cu:Bl;c=new m(u,d.itemSize,d.normalized)}if(d.name!==void 0)c.name=d.name;if(d.usage!==void 0)c.setUsage(d.usage);if(d.updateRange!==void 0){c.updateRange.offset=d.updateRange.offset;c.updateRange.count=d.updateRange.count}o.setAttribute(E,c)}var g=e.data.morphAttributes;if(g){for(var A in g){for(var f=g[A],h=[],y=0,v=f.length;y<v;y++){var _=f[y],x=void 0;if(_.isInterleavedBufferAttribute){var k=t(e.data,_.data);x=new Dc(k,_.itemSize,_.offset,_.normalized)}else{var C=p(_.type,_.array);x=new Bl(C,_.itemSize,_.normalized)}if(_.name!==void 0)x.name=_.name;h.push(x)}o.morphAttributes[A]=h}}var b=e.data.morphTargetsRelative;if(b){o.morphTargetsRelative=!0}var S=e.data.groups||e.data.drawcalls||e.data.offsets;if(S!==void 0){for(var R=0,L=S.length,n;R!==L;++R){n=S[R];o.addGroup(n.start,n.count,n.materialIndex)}}var M=e.data.boundingSphere;if(M!==void 0){var P=new vs;if(M.center!==void 0){P.fromArray(M.center)}o.boundingSphere=new Bs(P,M.radius)}if(e.name)o.name=e.name;if(e.userData)o.userData=e.userData;return o}}]);return t}(em),Pm=function(e){_inherits(t,e);var a=_createSuper(t);function t(e){_classCallCheck2(this,t);return a.call(this,e)}_createClass2(t,[{key:"load",value:function load(e,t,a,r){var i=this,n=""===this.path?Cm.extractUrlBase(e):this.path;this.resourcePath=this.resourcePath||n;var o=new am(this.manager);o.setPath(this.path);o.setRequestHeader(this.requestHeader);o.setWithCredentials(this.withCredentials);o.load(e,function(a){var n=null;try{n=JSON.parse(a)}catch(t){if(r!==void 0)r(t);console.error("THREE:ObjectLoader: Can't parse "+e+".",t.message);return}var o=n.metadata;if(o===void 0||o.type===void 0||"geometry"===o.type.toLowerCase()){console.error("THREE.ObjectLoader: Can't load "+e);return}i.parse(n,t)},a,r)}},{key:"loadAsync",value:function(){var e=_asyncToGenerator(regeneratorRuntime.mark(function e(t,a){var r,i,n,o,s,l;return regeneratorRuntime.wrap(function(e){while(1){switch(e.prev=e.next){case 0:r=this;i=""===this.path?Cm.extractUrlBase(t):this.path;this.resourcePath=this.resourcePath||i;n=new am(this.manager);n.setPath(this.path);n.setRequestHeader(this.requestHeader);n.setWithCredentials(this.withCredentials);e.next=9;return n.loadAsync(t,a);case 9:o=e.sent;s=JSON.parse(o);l=s.metadata;if(!(l===void 0||l.type===void 0||"geometry"===l.type.toLowerCase())){e.next=14;break}throw new Error("THREE.ObjectLoader: Can't load "+t);case 14:e.next=16;return r.parseAsync(s);case 16:return e.abrupt("return",e.sent);case 17:case"end":return e.stop();}}},e,this)}));return function loadAsync(){return e.apply(this,arguments)}}()},{key:"parse",value:function parse(e,t){var a=this.parseAnimations(e.animations),r=this.parseShapes(e.shapes),i=this.parseGeometries(e.geometries,r),n=this.parseImages(e.images,function(){if(t!==void 0)t(l)}),o=this.parseTextures(e.textures,n),s=this.parseMaterials(e.materials,o),l=this.parseObject(e.object,i,s,o,a),d=this.parseSkeletons(e.skeletons,l);this.bindSkeletons(l,d);if(t!==void 0){var c=!1;for(var u in n){if(n[u]instanceof HTMLImageElement){c=!0;break}}if(!1==c)t(l)}return l}},{key:"parseAsync",value:function(){var e=_asyncToGenerator(regeneratorRuntime.mark(function e(t){var a,r,i,n,o,s,l,d;return regeneratorRuntime.wrap(function(e){while(1){switch(e.prev=e.next){case 0:a=this.parseAnimations(t.animations);r=this.parseShapes(t.shapes);i=this.parseGeometries(t.geometries,r);e.next=5;return this.parseImagesAsync(t.images);case 5:n=e.sent;o=this.parseTextures(t.textures,n);s=this.parseMaterials(t.materials,o);l=this.parseObject(t.object,i,s,o,a);d=this.parseSkeletons(t.skeletons,l);this.bindSkeletons(l,d);return e.abrupt("return",l);case 12:case"end":return e.stop();}}},e,this)}));return function parseAsync(){return e.apply(this,arguments)}}()},{key:"parseShapes",value:function parseShapes(e){var t={};if(e!==void 0){for(var a=0,r=e.length,i;a<r;a++){i=new cp().fromJSON(e[a]);t[i.uuid]=i}}return t}},{key:"parseSkeletons",value:function parseSkeletons(e,t){var a={},r={};t.traverse(function(e){if(e.isBone)r[e.uuid]=e});if(e!==void 0){for(var i=0,n=e.length,o;i<n;i++){o=new du().fromJSON(e[i],r);a[o.uuid]=o}}return a}},{key:"parseGeometries",value:function parseGeometries(e,t){var a={};if(e!==void 0){for(var r=new Lm,i=0,n=e.length;i<n;i++){var o=void 0,s=e[i];switch(s.type){case"BufferGeometry":case"InstancedBufferGeometry":o=r.parse(s);break;case"Geometry":console.error("THREE.ObjectLoader: The legacy Geometry type is no longer supported.");break;default:if(s.type in wp){o=wp[s.type].fromJSON(s,t)}else{console.warn("THREE.ObjectLoader: Unsupported geometry type \"".concat(s.type,"\""))}}o.uuid=s.uuid;if(s.name!==void 0)o.name=s.name;if(!0===o.isBufferGeometry&&s.userData!==void 0)o.userData=s.userData;a[s.uuid]=o}}return a}},{key:"parseMaterials",value:function parseMaterials(e,t){var a={},r={};if(e!==void 0){var s=new km;s.setTextures(t);for(var d=0,c=e.length,l;d<c;d++){l=e[d];if("MultiMaterial"===l.type){for(var i=[],n=0,o;n<l.materials.length;n++){o=l.materials[n];if(a[o.uuid]===void 0){a[o.uuid]=s.parse(o)}i.push(a[o.uuid])}r[l.uuid]=i}else{if(a[l.uuid]===void 0){a[l.uuid]=s.parse(l)}r[l.uuid]=a[l.uuid]}}}return r}},{key:"parseAnimations",value:function parseAnimations(e){var t={};if(e!==void 0){for(var i=0;i<e.length;i++){var a=e[i],r=Jp.parse(a);t[r.uuid]=r}}return t}},{key:"parseImages",value:function parseImages(e,t){var i=this,n={},o;function a(e){i.manager.itemStart(e);return o.load(e,function(){i.manager.itemEnd(e)},void 0,function(){i.manager.itemError(e);i.manager.itemEnd(e)})}function r(e){if("string"==typeof e){var t=e,r=/^(\/\/)|([a-z]+:(\/\/)?)/i.test(t)?t:i.resourcePath+t;return a(r)}else{if(e.data){return{data:p(e.type,e.data),width:e.width,height:e.height}}else{return null}}}if(e!==void 0&&0<e.length){var u=new Kp(t);o=new nm(u);o.setCrossOrigin(this.crossOrigin);for(var m=0,g=e.length;m<g;m++){var s=e[m],l=s.url;if(Array.isArray(l)){n[s.uuid]=[];for(var f=0,h=l.length;f<h;f++){var d=l[f],c=r(d);if(null!==c){if(c instanceof HTMLImageElement){n[s.uuid].push(c)}else{n[s.uuid].push(new ou(c.data,c.width,c.height))}}}}else{var y=r(s.url);if(null!==y){n[s.uuid]=y}}}}return n}},{key:"parseImagesAsync",value:function(){var e=_asyncToGenerator(regeneratorRuntime.mark(function e(t){var a,r,i,n,o,s,l,d,c,u,m,g,f,h;return regeneratorRuntime.wrap(function(e){while(1){switch(e.prev=e.next){case 0:o=function(){o=_asyncToGenerator(regeneratorRuntime.mark(function e(t){var r,n;return regeneratorRuntime.wrap(function(e){while(1){switch(e.prev=e.next){case 0:if(!("string"==typeof t)){e.next=8;break}r=t;n=/^(\/\/)|([a-z]+:(\/\/)?)/i.test(r)?r:a.resourcePath+r;e.next=5;return i.loadAsync(n);case 5:return e.abrupt("return",e.sent);case 8:if(!t.data){e.next=12;break}return e.abrupt("return",{data:p(t.type,t.data),width:t.width,height:t.height});case 12:return e.abrupt("return",null);case 13:case"end":return e.stop();}}},e)}));return o.apply(this,arguments)};n=function(){return o.apply(this,arguments)};a=this;r={};if(!(t!==void 0&&0<t.length)){e.next=32;break}i=new nm(this.manager);i.setCrossOrigin(this.crossOrigin);s=0,l=t.length;case 8:if(!(s<l)){e.next=32;break}d=t[s];c=d.url;if(!Array.isArray(c)){e.next=25;break}r[d.uuid]=[];u=0,m=c.length;case 14:if(!(u<m)){e.next=23;break}g=c[u];e.next=18;return n(g);case 18:f=e.sent;if(null!==f){if(f instanceof HTMLImageElement){r[d.uuid].push(f)}else{r[d.uuid].push(new ou(f.data,f.width,f.height))}}case 20:u++;e.next=14;break;case 23:e.next=29;break;case 25:e.next=27;return n(d.url);case 27:h=e.sent;if(null!==h){r[d.uuid]=h}case 29:s++;e.next=8;break;case 32:return e.abrupt("return",r);case 33:case"end":return e.stop();}}},e,this)}));return function parseImagesAsync(){return e.apply(this,arguments)}}()},{key:"parseTextures",value:function parseTextures(e,t){function a(e,t){if("number"==typeof e)return e;console.warn("THREE.ObjectLoader.parseTexture: Constant should be in numeric form.",e);return t[e]}var r={};if(e!==void 0){for(var o=0,s=e.length,l;o<s;o++){l=e[o];if(l.image===void 0){console.warn("THREE.ObjectLoader: No \"image\" specified for",l.uuid)}if(t[l.image]===void 0){console.warn("THREE.ObjectLoader: Undefined image",l.image)}var i=void 0,n=t[l.image];if(Array.isArray(n)){i=new kd(n);if(6===n.length)i.needsUpdate=!0}else{if(n&&n.data){i=new ou(n.data,n.width,n.height)}else{i=new ps(n)}if(n)i.needsUpdate=!0}i.uuid=l.uuid;if(l.name!==void 0)i.name=l.name;if(l.mapping!==void 0)i.mapping=a(l.mapping,Im);if(l.offset!==void 0)i.offset.fromArray(l.offset);if(l.repeat!==void 0)i.repeat.fromArray(l.repeat);if(l.center!==void 0)i.center.fromArray(l.center);if(l.rotation!==void 0)i.rotation=l.rotation;if(l.wrap!==void 0){i.wrapS=a(l.wrap[0],Dm);i.wrapT=a(l.wrap[1],Dm)}if(l.format!==void 0)i.format=l.format;if(l.type!==void 0)i.type=l.type;if(l.encoding!==void 0)i.encoding=l.encoding;if(l.minFilter!==void 0)i.minFilter=a(l.minFilter,zm);if(l.magFilter!==void 0)i.magFilter=a(l.magFilter,zm);if(l.anisotropy!==void 0)i.anisotropy=l.anisotropy;if(l.flipY!==void 0)i.flipY=l.flipY;if(l.premultiplyAlpha!==void 0)i.premultiplyAlpha=l.premultiplyAlpha;if(l.unpackAlignment!==void 0)i.unpackAlignment=l.unpackAlignment;if(l.userData!==void 0)i.userData=l.userData;r[l.uuid]=i}}return r}},{key:"parseObject",value:function parseObject(e,t,a,r,i){var d;function n(e){if(t[e]===void 0){console.warn("THREE.ObjectLoader: Undefined geometry",e)}return t[e]}function o(e){if(e===void 0)return;if(Array.isArray(e)){for(var t=[],r=0,i=e.length,n;r<i;r++){n=e[r];if(a[n]===void 0){console.warn("THREE.ObjectLoader: Undefined material",n)}t.push(a[n])}return t}if(a[e]===void 0){console.warn("THREE.ObjectLoader: Undefined material",e)}return a[e]}function s(e){if(r[e]===void 0){console.warn("THREE.ObjectLoader: Undefined texture",e)}return r[e]}var c,u;switch(e.type){case"Scene":d=new Lc;if(e.background!==void 0){if(Number.isInteger(e.background)){d.background=new zl(e.background)}else{d.background=s(e.background)}}if(e.environment!==void 0){d.environment=s(e.environment)}if(e.fog!==void 0){if("Fog"===e.fog.type){d.fog=new Rc(e.fog.color,e.fog.near,e.fog.far)}else if("FogExp2"===e.fog.type){d.fog=new Cc(e.fog.color,e.fog.density)}}break;case"PerspectiveCamera":d=new wd(e.fov,e.aspect,e.near,e.far);if(e.focus!==void 0)d.focus=e.focus;if(e.zoom!==void 0)d.zoom=e.zoom;if(e.filmGauge!==void 0)d.filmGauge=e.filmGauge;if(e.filmOffset!==void 0)d.filmOffset=e.filmOffset;if(e.view!==void 0)d.view=Object.assign({},e.view);break;case"OrthographicCamera":d=new Gd(e.left,e.right,e.top,e.bottom,e.near,e.far);if(e.zoom!==void 0)d.zoom=e.zoom;if(e.view!==void 0)d.view=Object.assign({},e.view);break;case"AmbientLight":d=new Tm(e.color,e.intensity);break;case"DirectionalLight":d=new Mm(e.color,e.intensity);break;case"PointLight":d=new bm(e.color,e.intensity,e.distance,e.decay);break;case"RectAreaLight":d=new Em(e.color,e.intensity,e.width,e.height);break;case"SpotLight":d=new hm(e.color,e.intensity,e.distance,e.angle,e.penumbra,e.decay);break;case"HemisphereLight":d=new cm(e.color,e.groundColor,e.intensity);break;case"LightProbe":d=new Am().fromJSON(e);break;case"SkinnedMesh":c=n(e.geometry);u=o(e.material);d=new iu(c,u);if(e.bindMode!==void 0)d.bindMode=e.bindMode;if(e.bindMatrix!==void 0)d.bindMatrix.fromArray(e.bindMatrix);if(e.skeleton!==void 0)d.skeleton=e.skeleton;break;case"Mesh":c=n(e.geometry);u=o(e.material);d=new bd(c,u);break;case"InstancedMesh":c=n(e.geometry);u=o(e.material);var p=e.count,m=e.instanceMatrix,g=e.instanceColor;d=new fu(c,u,p);d.instanceMatrix=new cu(new Float32Array(m.array),16);if(g!==void 0)d.instanceColor=new cu(new Float32Array(g.array),g.itemSize);break;case"LOD":d=new Kc;break;case"Line":d=new Su(n(e.geometry),o(e.material));break;case"LineLoop":d=new wu(n(e.geometry),o(e.material));break;case"LineSegments":d=new Eu(n(e.geometry),o(e.material));break;case"PointCloud":case"Points":d=new Pu(n(e.geometry),o(e.material));break;case"Sprite":d=new Zc(o(e.material));break;case"Group":d=new Mc;break;case"Bone":d=new nu;break;default:d=new vl;}d.uuid=e.uuid;if(e.name!==void 0)d.name=e.name;if(e.matrix!==void 0){d.matrix.fromArray(e.matrix);if(e.matrixAutoUpdate!==void 0)d.matrixAutoUpdate=e.matrixAutoUpdate;if(d.matrixAutoUpdate)d.matrix.decompose(d.position,d.quaternion,d.scale)}else{if(e.position!==void 0)d.position.fromArray(e.position);if(e.rotation!==void 0)d.rotation.fromArray(e.rotation);if(e.quaternion!==void 0)d.quaternion.fromArray(e.quaternion);if(e.scale!==void 0)d.scale.fromArray(e.scale)}if(e.castShadow!==void 0)d.castShadow=e.castShadow;if(e.receiveShadow!==void 0)d.receiveShadow=e.receiveShadow;if(e.shadow){if(e.shadow.bias!==void 0)d.shadow.bias=e.shadow.bias;if(e.shadow.normalBias!==void 0)d.shadow.normalBias=e.shadow.normalBias;if(e.shadow.radius!==void 0)d.shadow.radius=e.shadow.radius;if(e.shadow.mapSize!==void 0)d.shadow.mapSize.fromArray(e.shadow.mapSize);if(e.shadow.camera!==void 0)d.shadow.camera=this.parseObject(e.shadow.camera)}if(e.visible!==void 0)d.visible=e.visible;if(e.frustumCulled!==void 0)d.frustumCulled=e.frustumCulled;if(e.renderOrder!==void 0)d.renderOrder=e.renderOrder;if(e.userData!==void 0)d.userData=e.userData;if(e.layers!==void 0)d.layers.mask=e.layers;if(e.children!==void 0){for(var f=e.children,h=0;h<f.length;h++){d.add(this.parseObject(f[h],t,a,r,i))}}if(e.animations!==void 0){for(var y=e.animations,v=0,_;v<y.length;v++){_=y[v];d.animations.push(i[_])}}if("LOD"===e.type){if(e.autoUpdate!==void 0)d.autoUpdate=e.autoUpdate;for(var x=e.levels,b=0;b<x.length;b++){var S=x[b],M=d.getObjectByProperty("uuid",S.object);if(M!==void 0){d.addLevel(M,S.distance)}}}return d}},{key:"bindSkeletons",value:function bindSkeletons(e,t){if(0===Object.keys(t).length)return;e.traverse(function(e){if(!0===e.isSkinnedMesh&&e.skeleton!==void 0){var a=t[e.skeleton];if(a===void 0){console.warn("THREE.ObjectLoader: No skeleton found with UUID:",e.skeleton)}else{e.bind(a,e.bindMatrix)}}})}},{key:"setTexturePath",value:function setTexturePath(e){console.warn("THREE.ObjectLoader: .setTexturePath() has been renamed to .setResourcePath().");return this.setResourcePath(e)}}]);return t}(em),Im={UVMapping:Si,CubeReflectionMapping:Mi,CubeRefractionMapping:Ti,EquirectangularReflectionMapping:Ei,EquirectangularRefractionMapping:wi,CubeUVReflectionMapping:Ai,CubeUVRefractionMapping:ki},Dm={RepeatWrapping:Ci,ClampToEdgeWrapping:Ri,MirroredRepeatWrapping:Li},zm={NearestFilter:Pi,NearestMipmapNearestFilter:Ii,NearestMipmapLinearFilter:zi,LinearFilter:Fi,LinearMipmapNearestFilter:Oi,LinearMipmapLinearFilter:Ui},Nm=function(e){_inherits(t,e);var a=_createSuper(t);function t(e){var r;_classCallCheck2(this,t);r=a.call(this,e);if("undefined"==typeof createImageBitmap){console.warn("THREE.ImageBitmapLoader: createImageBitmap() not supported.")}if("undefined"==typeof fetch){console.warn("THREE.ImageBitmapLoader: fetch() not supported.")}r.options={premultiplyAlpha:"none"};return r}_createClass2(t,[{key:"setOptions",value:function setOptions(e){this.options=e;return this}},{key:"load",value:function load(t,a,r,i){if(t===void 0)t="";if(this.path!==void 0)t=this.path+t;t=this.manager.resolveURL(t);var n=this,o=Qp.get(t);if(o!==void 0){n.manager.itemStart(t);setTimeout(function(){if(a)a(o);n.manager.itemEnd(t)},0);return o}var s={credentials:"anonymous"===this.crossOrigin?"same-origin":"include",headers:this.requestHeader};fetch(t,s).then(function(e){return e.blob()}).then(function(e){return createImageBitmap(e,Object.assign(n.options,{colorSpaceConversion:"none"}))}).then(function(e){Qp.add(t,e);if(a)a(e);n.manager.itemEnd(t)}).catch(function(a){if(i)i(a);n.manager.itemError(t);n.manager.itemEnd(t)});n.manager.itemStart(t)}}]);return t}(em);Nm.prototype.isImageBitmapLoader=!0;var Fm,Om={getContext:function getContext(){if(Fm===void 0){Fm=new(window.AudioContext||window.webkitAudioContext)}return Fm},setContext:function setContext(e){Fm=e}},Bm=function(e){_inherits(t,e);var a=_createSuper(t);function t(e){_classCallCheck2(this,t);return a.call(this,e)}_createClass2(t,[{key:"load",value:function load(t,a,r,i){var n=this,o=new am(this.manager);o.setResponseType("arraybuffer");o.setPath(this.path);o.setRequestHeader(this.requestHeader);o.setWithCredentials(this.withCredentials);o.load(t,function(e){try{var r=e.slice(0),o=Om.getContext();o.decodeAudioData(r,function(e){a(e)})}catch(a){if(i){i(a)}else{console.error(a)}n.manager.itemError(t)}},r,i)}}]);return t}(em),Um=function(e){_inherits(t,e);var a=_createSuper(t);function t(e,r){var i,n=2<arguments.length&&arguments[2]!==void 0?arguments[2]:1;_classCallCheck2(this,t);i=a.call(this,void 0,n);var o=new zl().set(e),s=new zl().set(r),l=new vs(o.r,o.g,o.b),d=new vs(s.r,s.g,s.b),c=Math.sqrt(Math.PI),u=c*Math.sqrt(.75);i.sh.coefficients[0].copy(l).add(d).multiplyScalar(c);i.sh.coefficients[1].copy(l).sub(d).multiplyScalar(u);return i}return t}(Am);Um.prototype.isHemisphereLightProbe=!0;var Gm=function(e){_inherits(t,e);var a=_createSuper(t);function t(e){var r,i=1<arguments.length&&arguments[1]!==void 0?arguments[1]:1;_classCallCheck2(this,t);r=a.call(this,void 0,i);var n=new zl().set(e);r.sh.coefficients[0].set(n.r,n.g,n.b).multiplyScalar(2*Math.sqrt(Math.PI));return r}return t}(Am);Gm.prototype.isAmbientLightProbe=!0;var Hm=new Ys,Vm=new Ys,Wm=new Ys,jm=function(){function e(){_classCallCheck2(this,e);this.type="StereoCamera";this.aspect=1;this.eyeSep=.064;this.cameraL=new wd;this.cameraL.layers.enable(1);this.cameraL.matrixAutoUpdate=!1;this.cameraR=new wd;this.cameraR.layers.enable(2);this.cameraR.matrixAutoUpdate=!1;this._cache={focus:null,fov:null,aspect:null,near:null,far:null,zoom:null,eyeSep:null}}_createClass2(e,[{key:"update",value:function update(e){var t=this._cache,a=t.focus!==e.focus||t.fov!==e.fov||t.aspect!==e.aspect*this.aspect||t.near!==e.near||t.far!==e.far||t.zoom!==e.zoom||t.eyeSep!==this.eyeSep;if(a){t.focus=e.focus;t.fov=e.fov;t.aspect=e.aspect*this.aspect;t.near=e.near;t.far=e.far;t.zoom=e.zoom;t.eyeSep=this.eyeSep;Wm.copy(e.projectionMatrix);var r=t.eyeSep/2,i=r*t.near/t.focus,n=t.near*Math.tan(.5*(rs*t.fov))/t.zoom,o,s;Vm.elements[12]=-r;Hm.elements[12]=r;o=-n*t.aspect+i;s=n*t.aspect+i;Wm.elements[0]=2*t.near/(s-o);Wm.elements[8]=(s+o)/(s-o);this.cameraL.projectionMatrix.copy(Wm);o=-n*t.aspect-i;s=n*t.aspect-i;Wm.elements[0]=2*t.near/(s-o);Wm.elements[8]=(s+o)/(s-o);this.cameraR.projectionMatrix.copy(Wm)}this.cameraL.matrixWorld.copy(e.matrixWorld).multiply(Vm);this.cameraR.matrixWorld.copy(e.matrixWorld).multiply(Hm)}}]);return e}(),qm=function(){function e(){var t=0<arguments.length&&arguments[0]!==void 0?arguments[0]:!0;_classCallCheck2(this,e);this.autoStart=t;this.startTime=0;this.oldTime=0;this.elapsedTime=0;this.running=!1}_createClass2(e,[{key:"start",value:function start(){this.startTime=za();this.oldTime=this.startTime;this.elapsedTime=0;this.running=!0}},{key:"stop",value:function stop(){this.getElapsedTime();this.running=!1;this.autoStart=!1}},{key:"getElapsedTime",value:function getElapsedTime(){this.getDelta();return this.elapsedTime}},{key:"getDelta",value:function getDelta(){var e=0;if(this.autoStart&&!this.running){this.start();return 0}if(this.running){var t=za();e=(t-this.oldTime)/1e3;this.oldTime=t;this.elapsedTime+=e}return e}}]);return e}();function za(){return("undefined"==typeof performance?Date:performance).now()}var Xm=new vs,Ym=new ys,Zm=new vs,Jm=new vs,Qm=function(e){_inherits(t,e);var a=_createSuper(t);function t(){var e;_classCallCheck2(this,t);e=a.call(this);e.type="AudioListener";e.context=Om.getContext();e.gain=e.context.createGain();e.gain.connect(e.context.destination);e.filter=null;e.timeDelta=0;e._clock=new qm;return e}_createClass2(t,[{key:"getInput",value:function getInput(){return this.gain}},{key:"removeFilter",value:function removeFilter(){if(null!==this.filter){this.gain.disconnect(this.filter);this.filter.disconnect(this.context.destination);this.gain.connect(this.context.destination);this.filter=null}return this}},{key:"getFilter",value:function getFilter(){return this.filter}},{key:"setFilter",value:function setFilter(e){if(null!==this.filter){this.gain.disconnect(this.filter);this.filter.disconnect(this.context.destination)}else{this.gain.disconnect(this.context.destination)}this.filter=e;this.gain.connect(this.filter);this.filter.connect(this.context.destination);return this}},{key:"getMasterVolume",value:function getMasterVolume(){return this.gain.gain.value}},{key:"setMasterVolume",value:function setMasterVolume(e){this.gain.gain.setTargetAtTime(e,this.context.currentTime,.01);return this}},{key:"updateMatrixWorld",value:function updateMatrixWorld(e){_get(_getPrototypeOf(t.prototype),"updateMatrixWorld",this).call(this,e);var a=this.context.listener,r=this.up;this.timeDelta=this._clock.getDelta();this.matrixWorld.decompose(Xm,Ym,Zm);Jm.set(0,0,-1).applyQuaternion(Ym);if(a.positionX){var i=this.context.currentTime+this.timeDelta;a.positionX.linearRampToValueAtTime(Xm.x,i);a.positionY.linearRampToValueAtTime(Xm.y,i);a.positionZ.linearRampToValueAtTime(Xm.z,i);a.forwardX.linearRampToValueAtTime(Jm.x,i);a.forwardY.linearRampToValueAtTime(Jm.y,i);a.forwardZ.linearRampToValueAtTime(Jm.z,i);a.upX.linearRampToValueAtTime(r.x,i);a.upY.linearRampToValueAtTime(r.y,i);a.upZ.linearRampToValueAtTime(r.z,i)}else{a.setPosition(Xm.x,Xm.y,Xm.z);a.setOrientation(Jm.x,Jm.y,Jm.z,r.x,r.y,r.z)}}}]);return t}(vl),Km=function(e){_inherits(t,e);var a=_createSuper(t);function t(e){var r;_classCallCheck2(this,t);r=a.call(this);r.type="Audio";r.listener=e;r.context=e.context;r.gain=r.context.createGain();r.gain.connect(e.getInput());r.autoplay=!1;r.buffer=null;r.detune=0;r.loop=!1;r.loopStart=0;r.loopEnd=0;r.offset=0;r.duration=void 0;r.playbackRate=1;r.isPlaying=!1;r.hasPlaybackControl=!0;r.source=null;r.sourceType="empty";r._startedAt=0;r._progress=0;r._connected=!1;r.filters=[];return r}_createClass2(t,[{key:"getOutput",value:function getOutput(){return this.gain}},{key:"setNodeSource",value:function setNodeSource(e){this.hasPlaybackControl=!1;this.sourceType="audioNode";this.source=e;this.connect();return this}},{key:"setMediaElementSource",value:function setMediaElementSource(e){this.hasPlaybackControl=!1;this.sourceType="mediaNode";this.source=this.context.createMediaElementSource(e);this.connect();return this}},{key:"setMediaStreamSource",value:function setMediaStreamSource(e){this.hasPlaybackControl=!1;this.sourceType="mediaStreamNode";this.source=this.context.createMediaStreamSource(e);this.connect();return this}},{key:"setBuffer",value:function setBuffer(e){this.buffer=e;this.sourceType="buffer";if(this.autoplay)this.play();return this}},{key:"play",value:function play(){var e=0<arguments.length&&arguments[0]!==void 0?arguments[0]:0;if(!0===this.isPlaying){console.warn("THREE.Audio: Audio is already playing.");return}if(!1===this.hasPlaybackControl){console.warn("THREE.Audio: this Audio has no playback control.");return}this._startedAt=this.context.currentTime+e;var t=this.context.createBufferSource();t.buffer=this.buffer;t.loop=this.loop;t.loopStart=this.loopStart;t.loopEnd=this.loopEnd;t.onended=this.onEnded.bind(this);t.start(this._startedAt,this._progress+this.offset,this.duration);this.isPlaying=!0;this.source=t;this.setDetune(this.detune);this.setPlaybackRate(this.playbackRate);return this.connect()}},{key:"pause",value:function pause(){if(!1===this.hasPlaybackControl){console.warn("THREE.Audio: this Audio has no playback control.");return}if(!0===this.isPlaying){this._progress+=Math.max(this.context.currentTime-this._startedAt,0)*this.playbackRate;if(!0===this.loop){this._progress=this._progress%(this.duration||this.buffer.duration)}this.source.stop();this.source.onended=null;this.isPlaying=!1}return this}},{key:"stop",value:function stop(){if(!1===this.hasPlaybackControl){console.warn("THREE.Audio: this Audio has no playback control.");return}this._progress=0;this.source.stop();this.source.onended=null;this.isPlaying=!1;return this}},{key:"connect",value:function connect(){if(0<this.filters.length){this.source.connect(this.filters[0]);for(var e=1,t=this.filters.length;e<t;e++){this.filters[e-1].connect(this.filters[e])}this.filters[this.filters.length-1].connect(this.getOutput())}else{this.source.connect(this.getOutput())}this._connected=!0;return this}},{key:"disconnect",value:function disconnect(){if(0<this.filters.length){this.source.disconnect(this.filters[0]);for(var e=1,t=this.filters.length;e<t;e++){this.filters[e-1].disconnect(this.filters[e])}this.filters[this.filters.length-1].disconnect(this.getOutput())}else{this.source.disconnect(this.getOutput())}this._connected=!1;return this}},{key:"getFilters",value:function getFilters(){return this.filters}},{key:"setFilters",value:function setFilters(e){if(!e)e=[];if(!0===this._connected){this.disconnect();this.filters=e.slice();this.connect()}else{this.filters=e.slice()}return this}},{key:"setDetune",value:function setDetune(e){this.detune=e;if(this.source.detune===void 0)return;if(!0===this.isPlaying){this.source.detune.setTargetAtTime(this.detune,this.context.currentTime,.01)}return this}},{key:"getDetune",value:function getDetune(){return this.detune}},{key:"getFilter",value:function getFilter(){return this.getFilters()[0]}},{key:"setFilter",value:function setFilter(e){return this.setFilters(e?[e]:[])}},{key:"setPlaybackRate",value:function setPlaybackRate(e){if(!1===this.hasPlaybackControl){console.warn("THREE.Audio: this Audio has no playback control.");return}this.playbackRate=e;if(!0===this.isPlaying){this.source.playbackRate.setTargetAtTime(this.playbackRate,this.context.currentTime,.01)}return this}},{key:"getPlaybackRate",value:function getPlaybackRate(){return this.playbackRate}},{key:"onEnded",value:function onEnded(){this.isPlaying=!1}},{key:"getLoop",value:function getLoop(){if(!1===this.hasPlaybackControl){console.warn("THREE.Audio: this Audio has no playback control.");return!1}return this.loop}},{key:"setLoop",value:function setLoop(e){if(!1===this.hasPlaybackControl){console.warn("THREE.Audio: this Audio has no playback control.");return}this.loop=e;if(!0===this.isPlaying){this.source.loop=this.loop}return this}},{key:"setLoopStart",value:function setLoopStart(e){this.loopStart=e;return this}},{key:"setLoopEnd",value:function setLoopEnd(e){this.loopEnd=e;return this}},{key:"getVolume",value:function getVolume(){return this.gain.gain.value}},{key:"setVolume",value:function setVolume(e){this.gain.gain.setTargetAtTime(e,this.context.currentTime,.01);return this}}]);return t}(vl),$m=new vs,eg=new ys,tg=new vs,ag=new vs,rg=function(e){_inherits(t,e);var a=_createSuper(t);function t(e){var r;_classCallCheck2(this,t);r=a.call(this,e);r.panner=r.context.createPanner();r.panner.panningModel="HRTF";r.panner.connect(r.gain);return r}_createClass2(t,[{key:"getOutput",value:function getOutput(){return this.panner}},{key:"getRefDistance",value:function getRefDistance(){return this.panner.refDistance}},{key:"setRefDistance",value:function setRefDistance(e){this.panner.refDistance=e;return this}},{key:"getRolloffFactor",value:function getRolloffFactor(){return this.panner.rolloffFactor}},{key:"setRolloffFactor",value:function setRolloffFactor(e){this.panner.rolloffFactor=e;return this}},{key:"getDistanceModel",value:function getDistanceModel(){return this.panner.distanceModel}},{key:"setDistanceModel",value:function setDistanceModel(e){this.panner.distanceModel=e;return this}},{key:"getMaxDistance",value:function getMaxDistance(){return this.panner.maxDistance}},{key:"setMaxDistance",value:function setMaxDistance(e){this.panner.maxDistance=e;return this}},{key:"setDirectionalCone",value:function setDirectionalCone(e,t,a){this.panner.coneInnerAngle=e;this.panner.coneOuterAngle=t;this.panner.coneOuterGain=a;return this}},{key:"updateMatrixWorld",value:function updateMatrixWorld(e){_get(_getPrototypeOf(t.prototype),"updateMatrixWorld",this).call(this,e);if(!0===this.hasPlaybackControl&&!1===this.isPlaying)return;this.matrixWorld.decompose($m,eg,tg);ag.set(0,0,1).applyQuaternion(eg);var a=this.panner;if(a.positionX){var r=this.context.currentTime+this.listener.timeDelta;a.positionX.linearRampToValueAtTime($m.x,r);a.positionY.linearRampToValueAtTime($m.y,r);a.positionZ.linearRampToValueAtTime($m.z,r);a.orientationX.linearRampToValueAtTime(ag.x,r);a.orientationY.linearRampToValueAtTime(ag.y,r);a.orientationZ.linearRampToValueAtTime(ag.z,r)}else{a.setPosition($m.x,$m.y,$m.z);a.setOrientation(ag.x,ag.y,ag.z)}}}]);return t}(Km),ig=function(){function e(t){var a=1<arguments.length&&arguments[1]!==void 0?arguments[1]:2048;_classCallCheck2(this,e);this.analyser=t.context.createAnalyser();this.analyser.fftSize=a;this.data=new Uint8Array(this.analyser.frequencyBinCount);t.getOutput().connect(this.analyser)}_createClass2(e,[{key:"getFrequencyData",value:function getFrequencyData(){this.analyser.getByteFrequencyData(this.data);return this.data}},{key:"getAverageFrequency",value:function getAverageFrequency(){for(var e=0,t=this.getFrequencyData(),a=0;a<t.length;a++){e+=t[a]}return e/t.length}}]);return e}(),ng=function(){function e(t,a,r){_classCallCheck2(this,e);this.binding=t;this.valueSize=r;var i,n,o;switch(a){case"quaternion":i=this._slerp;n=this._slerpAdditive;o=this._setAdditiveIdentityQuaternion;this.buffer=new Float64Array(6*r);this._workIndex=5;break;case"string":case"bool":i=this._select;n=this._select;o=this._setAdditiveIdentityOther;this.buffer=Array(5*r);break;default:i=this._lerp;n=this._lerpAdditive;o=this._setAdditiveIdentityNumeric;this.buffer=new Float64Array(5*r);}this._mixBufferRegion=i;this._mixBufferRegionAdditive=n;this._setIdentity=o;this._origIndex=3;this._addIndex=4;this.cumulativeWeight=0;this.cumulativeWeightAdditive=0;this.useCount=0;this.referenceCount=0}_createClass2(e,[{key:"accumulate",value:function accumulate(e,t){var a=this.buffer,r=this.valueSize,i=e*r+r,n=this.cumulativeWeight;if(0===n){for(var o=0;o!==r;++o){a[i+o]=a[o]}n=t}else{n+=t;var s=t/n;this._mixBufferRegion(a,i,0,s,r)}this.cumulativeWeight=n}},{key:"accumulateAdditive",value:function accumulateAdditive(e){var t=this.buffer,a=this.valueSize,r=a*this._addIndex;if(0===this.cumulativeWeightAdditive){this._setIdentity()}this._mixBufferRegionAdditive(t,r,0,e,a);this.cumulativeWeightAdditive+=e}},{key:"apply",value:function apply(e){var t=this.valueSize,a=this.buffer,r=e*t+t,i=this.cumulativeWeight,n=this.cumulativeWeightAdditive,o=this.binding;this.cumulativeWeight=0;this.cumulativeWeightAdditive=0;if(1>i){var s=t*this._origIndex;this._mixBufferRegion(a,r,s,1-i,t)}if(0<n){this._mixBufferRegionAdditive(a,r,this._addIndex*t,1,t)}for(var l=t;l!==t+t;++l){if(a[l]!==a[l+t]){o.setValue(a,r);break}}}},{key:"saveOriginalState",value:function saveOriginalState(){var e=this.binding,t=this.buffer,a=this.valueSize,r=a*this._origIndex;e.getValue(t,r);for(var i=a;i!==r;++i){t[i]=t[r+i%a]}this._setIdentity();this.cumulativeWeight=0;this.cumulativeWeightAdditive=0}},{key:"restoreOriginalState",value:function restoreOriginalState(){var e=3*this.valueSize;this.binding.setValue(this.buffer,e)}},{key:"_setAdditiveIdentityNumeric",value:function _setAdditiveIdentityNumeric(){for(var e=this._addIndex*this.valueSize,t=e+this.valueSize,a=e;a<t;a++){this.buffer[a]=0}}},{key:"_setAdditiveIdentityQuaternion",value:function _setAdditiveIdentityQuaternion(){this._setAdditiveIdentityNumeric();this.buffer[this._addIndex*this.valueSize+3]=1}},{key:"_setAdditiveIdentityOther",value:function _setAdditiveIdentityOther(){for(var e=this._origIndex*this.valueSize,t=this._addIndex*this.valueSize,a=0;a<this.valueSize;a++){this.buffer[t+a]=this.buffer[e+a]}}},{key:"_select",value:function _select(e,a,r,i,t){if(.5<=i){for(var n=0;n!==t;++n){e[a+n]=e[r+n]}}}},{key:"_slerp",value:function _slerp(e,a,r,i){ys.slerpFlat(e,a,e,a,e,r,i)}},{key:"_slerpAdditive",value:function _slerpAdditive(e,a,r,i,t){var n=this._workIndex*t;ys.multiplyQuaternionsFlat(e,n,e,a,e,r);ys.slerpFlat(e,a,e,a,e,n,i)}},{key:"_lerp",value:function _lerp(e,a,r,i,t){for(var n=0,o;n!==t;++n){o=a+n;e[o]=e[o]*(1-i)+e[r+n]*i}}},{key:"_lerpAdditive",value:function _lerpAdditive(e,a,r,i,t){for(var n=0,o;n!==t;++n){o=a+n;e[o]=e[o]+e[r+n]*i}}}]);return e}(),og="\\[\\]\\.:\\/",sg=new RegExp("["+og+"]","g"),lg="[^"+og+"]",dg="[^"+og.replace("\\.","")+"]",cg=/((?:WC+[\/:])*)/.source.replace("WC",lg),ug=/(WCOD+)?/.source.replace("WCOD",dg),pg=/(?:\.(WC+)(?:\[(.+)\])?)?/.source.replace("WC",lg),mg=/\.(WC+)(?:\[(.+)\])?/.source.replace("WC",lg),gg=new RegExp("^"+cg+ug+pg+mg+"$"),fg=["material","materials","bones"],hg=function(){function e(t,a,r){_classCallCheck2(this,e);var i=r||yg.parseTrackName(a);this._targetGroup=t;this._bindings=t.subscribe_(a,i)}_createClass2(e,[{key:"getValue",value:function getValue(e,t){this.bind();var a=this._targetGroup.nCachedObjects_,r=this._bindings[a];if(r!==void 0)r.getValue(e,t)}},{key:"setValue",value:function setValue(e,t){for(var a=this._bindings,r=this._targetGroup.nCachedObjects_,i=a.length;r!==i;++r){a[r].setValue(e,t)}}},{key:"bind",value:function bind(){for(var e=this._bindings,t=this._targetGroup.nCachedObjects_,a=e.length;t!==a;++t){e[t].bind()}}},{key:"unbind",value:function unbind(){for(var e=this._bindings,t=this._targetGroup.nCachedObjects_,a=e.length;t!==a;++t){e[t].unbind()}}}]);return e}(),yg=function(){function e(t,a,r){_classCallCheck2(this,e);this.path=a;this.parsedPath=r||e.parseTrackName(a);this.node=e.findNode(t,this.parsedPath.nodeName)||t;this.rootNode=t;this.getValue=this._getValue_unbound;this.setValue=this._setValue_unbound}_createClass2(e,[{key:"_getValue_unavailable",value:function _getValue_unavailable(){}},{key:"_setValue_unavailable",value:function _setValue_unavailable(){}},{key:"_getValue_direct",value:function _getValue_direct(e,t){e[t]=this.targetObject[this.propertyName]}},{key:"_getValue_array",value:function _getValue_array(e,t){for(var a=this.resolvedProperty,r=0,i=a.length;r!==i;++r){e[t++]=a[r]}}},{key:"_getValue_arrayElement",value:function _getValue_arrayElement(e,t){e[t]=this.resolvedProperty[this.propertyIndex]}},{key:"_getValue_toArray",value:function _getValue_toArray(e,t){this.resolvedProperty.toArray(e,t)}},{key:"_setValue_direct",value:function _setValue_direct(e,t){this.targetObject[this.propertyName]=e[t]}},{key:"_setValue_direct_setNeedsUpdate",value:function _setValue_direct_setNeedsUpdate(e,t){this.targetObject[this.propertyName]=e[t];this.targetObject.needsUpdate=!0}},{key:"_setValue_direct_setMatrixWorldNeedsUpdate",value:function _setValue_direct_setMatrixWorldNeedsUpdate(e,t){this.targetObject[this.propertyName]=e[t];this.targetObject.matrixWorldNeedsUpdate=!0}},{key:"_setValue_array",value:function _setValue_array(e,t){for(var a=this.resolvedProperty,r=0,i=a.length;r!==i;++r){a[r]=e[t++]}}},{key:"_setValue_array_setNeedsUpdate",value:function _setValue_array_setNeedsUpdate(e,t){for(var a=this.resolvedProperty,r=0,i=a.length;r!==i;++r){a[r]=e[t++]}this.targetObject.needsUpdate=!0}},{key:"_setValue_array_setMatrixWorldNeedsUpdate",value:function _setValue_array_setMatrixWorldNeedsUpdate(e,t){for(var a=this.resolvedProperty,r=0,i=a.length;r!==i;++r){a[r]=e[t++]}this.targetObject.matrixWorldNeedsUpdate=!0}},{key:"_setValue_arrayElement",value:function _setValue_arrayElement(e,t){this.resolvedProperty[this.propertyIndex]=e[t]}},{key:"_setValue_arrayElement_setNeedsUpdate",value:function _setValue_arrayElement_setNeedsUpdate(e,t){this.resolvedProperty[this.propertyIndex]=e[t];this.targetObject.needsUpdate=!0}},{key:"_setValue_arrayElement_setMatrixWorldNeedsUpdate",value:function _setValue_arrayElement_setMatrixWorldNeedsUpdate(e,t){this.resolvedProperty[this.propertyIndex]=e[t];this.targetObject.matrixWorldNeedsUpdate=!0}},{key:"_setValue_fromArray",value:function _setValue_fromArray(e,t){this.resolvedProperty.fromArray(e,t)}},{key:"_setValue_fromArray_setNeedsUpdate",value:function _setValue_fromArray_setNeedsUpdate(e,t){this.resolvedProperty.fromArray(e,t);this.targetObject.needsUpdate=!0}},{key:"_setValue_fromArray_setMatrixWorldNeedsUpdate",value:function _setValue_fromArray_setMatrixWorldNeedsUpdate(e,t){this.resolvedProperty.fromArray(e,t);this.targetObject.matrixWorldNeedsUpdate=!0}},{key:"_getValue_unbound",value:function _getValue_unbound(e,t){this.bind();this.getValue(e,t)}},{key:"_setValue_unbound",value:function _setValue_unbound(e,t){this.bind();this.setValue(e,t)}},{key:"bind",value:function bind(){var t=this.node,a=this.parsedPath,r=a.objectName,i=a.propertyName,n=a.propertyIndex;if(!t){t=e.findNode(this.rootNode,a.nodeName)||this.rootNode;this.node=t}this.getValue=this._getValue_unavailable;this.setValue=this._setValue_unavailable;if(!t){console.error("THREE.PropertyBinding: Trying to update node for track: "+this.path+" but it wasn't found.");return}if(r){var d=a.objectIndex;switch(r){case"materials":if(!t.material){console.error("THREE.PropertyBinding: Can not bind to material as node does not have a material.",this);return}if(!t.material.materials){console.error("THREE.PropertyBinding: Can not bind to material.materials as node.material does not have a materials array.",this);return}t=t.material.materials;break;case"bones":if(!t.skeleton){console.error("THREE.PropertyBinding: Can not bind to bones as node does not have a skeleton.",this);return}t=t.skeleton.bones;for(var c=0;c<t.length;c++){if(t[c].name===d){d=c;break}}break;default:if(t[r]===void 0){console.error("THREE.PropertyBinding: Can not bind to objectName of node undefined.",this);return}t=t[r];}if(d!==void 0){if(t[d]===void 0){console.error("THREE.PropertyBinding: Trying to bind to objectIndex of objectName, but is undefined.",this,t);return}t=t[d]}}var o=t[i];if(o===void 0){var u=a.nodeName;console.error("THREE.PropertyBinding: Trying to update property for track: "+u+"."+i+" but it wasn't found.",t);return}var s=this.Versioning.None;this.targetObject=t;if(t.needsUpdate!==void 0){s=this.Versioning.NeedsUpdate}else if(t.matrixWorldNeedsUpdate!==void 0){s=this.Versioning.MatrixWorldNeedsUpdate}var l=this.BindingType.Direct;if(n!==void 0){if("morphTargetInfluences"===i){if(!t.geometry){console.error("THREE.PropertyBinding: Can not bind to morphTargetInfluences because node does not have a geometry.",this);return}if(t.geometry.isBufferGeometry){if(!t.geometry.morphAttributes){console.error("THREE.PropertyBinding: Can not bind to morphTargetInfluences because node does not have a geometry.morphAttributes.",this);return}if(t.morphTargetDictionary[n]!==void 0){n=t.morphTargetDictionary[n]}}else{console.error("THREE.PropertyBinding: Can not bind to morphTargetInfluences on THREE.Geometry. Use THREE.BufferGeometry instead.",this);return}}l=this.BindingType.ArrayElement;this.resolvedProperty=o;this.propertyIndex=n}else if(o.fromArray!==void 0&&o.toArray!==void 0){l=this.BindingType.HasFromToArray;this.resolvedProperty=o}else if(Array.isArray(o)){l=this.BindingType.EntireArray;this.resolvedProperty=o}else{this.propertyName=i}this.getValue=this.GetterByBindingType[l];this.setValue=this.SetterByBindingTypeAndVersioning[l][s]}},{key:"unbind",value:function unbind(){this.node=null;this.getValue=this._getValue_unbound;this.setValue=this._setValue_unbound}}],[{key:"create",value:function create(t,a,r){if(!(t&&t.isAnimationObjectGroup)){return new e(t,a,r)}else{return new e.Composite(t,a,r)}}},{key:"sanitizeNodeName",value:function sanitizeNodeName(e){return e.replace(/\s/g,"_").replace(sg,"")}},{key:"parseTrackName",value:function parseTrackName(e){var t=gg.exec(e);if(!t){throw new Error("PropertyBinding: Cannot parse trackName: "+e)}var a={nodeName:t[2],objectName:t[3],objectIndex:t[4],propertyName:t[5],propertyIndex:t[6]},r=a.nodeName&&a.nodeName.lastIndexOf(".");if(r!==void 0&&-1!==r){var i=a.nodeName.substring(r+1);if(-1!==fg.indexOf(i)){a.nodeName=a.nodeName.substring(0,r);a.objectName=i}}if(null===a.propertyName||0===a.propertyName.length){throw new Error("PropertyBinding: can not parse propertyName from trackName: "+e)}return a}},{key:"findNode",value:function findNode(e,t){if(!t||""===t||"."===t||-1===t||t===e.name||t===e.uuid){return e}if(e.skeleton){var i=e.skeleton.getBoneByName(t);if(i!==void 0){return i}}if(e.children){var a=function(e){for(var r=0,i;r<e.length;r++){i=e[r];if(i.name===t||i.uuid===t){return i}var n=a(i.children);if(n)return n}return null},r=a(e.children);if(r){return r}}return null}}]);return e}();yg.Composite=hg;yg.prototype.BindingType={Direct:0,EntireArray:1,ArrayElement:2,HasFromToArray:3};yg.prototype.Versioning={None:0,NeedsUpdate:1,MatrixWorldNeedsUpdate:2};yg.prototype.GetterByBindingType=[yg.prototype._getValue_direct,yg.prototype._getValue_array,yg.prototype._getValue_arrayElement,yg.prototype._getValue_toArray];yg.prototype.SetterByBindingTypeAndVersioning=[[yg.prototype._setValue_direct,yg.prototype._setValue_direct_setNeedsUpdate,yg.prototype._setValue_direct_setMatrixWorldNeedsUpdate],[yg.prototype._setValue_array,yg.prototype._setValue_array_setNeedsUpdate,yg.prototype._setValue_array_setMatrixWorldNeedsUpdate],[yg.prototype._setValue_arrayElement,yg.prototype._setValue_arrayElement_setNeedsUpdate,yg.prototype._setValue_arrayElement_setMatrixWorldNeedsUpdate],[yg.prototype._setValue_fromArray,yg.prototype._setValue_fromArray_setNeedsUpdate,yg.prototype._setValue_fromArray_setMatrixWorldNeedsUpdate]];var vg=function(){function e(){_classCallCheck2(this,e);this.uuid=t();this._objects=Array.prototype.slice.call(arguments);this.nCachedObjects_=0;var a={};this._indicesByUUID=a;for(var i=0,o=arguments.length;i!==o;++i){a[arguments[i].uuid]=i}this._paths=[];this._parsedPaths=[];this._bindings=[];this._bindingsIndicesByPath={};var r=this;this.stats={objects:{get total(){return r._objects.length},get inUse(){return this.total-r.nCachedObjects_}},get bindingsPerObject(){return r._bindings.length}}}_createClass2(e,[{key:"add",value:function add(){for(var e=this._objects,t=this._indicesByUUID,a=this._paths,r=this._parsedPaths,i=this._bindings,o=i.length,s=void 0,l=e.length,d=this.nCachedObjects_,c=0,u=arguments.length;c!==u;++c){var n=arguments[c],p=n.uuid,m=t[p];if(m===void 0){m=l++;t[p]=m;e.push(n);for(var y=0;y!==o;++y){i[y].push(new yg(n,a[y],r[y]))}}else if(m<d){s=e[m];var v=--d,_=e[v];t[_.uuid]=m;e[m]=_;t[p]=v;e[v]=n;for(var x=0;x!==o;++x){var g=i[x],f=g[v],h=g[m];g[m]=f;if(h===void 0){h=new yg(n,a[x],r[x])}g[v]=h}}else if(e[m]!==s){console.error("THREE.AnimationObjectGroup: Different objects with the same UUID detected. Clean the caches or recreate your infrastructure when reloading scenes.")}}this.nCachedObjects_=d}},{key:"remove",value:function remove(){for(var e=this._objects,t=this._indicesByUUID,a=this._bindings,r=a.length,i=this.nCachedObjects_,o=0,s=arguments.length;o!==s;++o){var n=arguments[o],l=n.uuid,d=t[l];if(d!==void 0&&d>=i){var c=i++,u=e[c];t[u.uuid]=d;e[d]=u;t[l]=c;e[c]=n;for(var p=0;p!==r;++p){var m=a[p],g=m[c],f=m[d];m[d]=g;m[c]=f}}}this.nCachedObjects_=i}},{key:"uncache",value:function uncache(){for(var e=this._objects,t=this._indicesByUUID,a=this._bindings,r=a.length,i=this.nCachedObjects_,o=e.length,s=0,l=arguments.length;s!==l;++s){var n=arguments[s],d=n.uuid,c=t[d];if(c!==void 0){delete t[d];if(c<i){var u=--i,p=e[u],m=--o,g=e[m];t[p.uuid]=c;e[c]=p;t[g.uuid]=u;e[u]=g;e.pop();for(var f=0;f!==r;++f){var h=a[f],y=h[u],v=h[m];h[c]=y;h[u]=v;h.pop()}}else{var _=--o,x=e[_];if(0<_){t[x.uuid]=c}e[c]=x;e.pop();for(var b=0,S;b!==r;++b){S=a[b];S[c]=S[_];S.pop()}}}}this.nCachedObjects_=i}},{key:"subscribe_",value:function subscribe_(e,t){var a=this._bindingsIndicesByPath,r=a[e],i=this._bindings;if(r!==void 0)return i[r];var o=this._paths,s=this._parsedPaths,l=this._objects,d=l.length,c=this.nCachedObjects_,u=Array(d);r=i.length;a[e]=r;o.push(e);s.push(t);i.push(u);for(var p=c,m=l.length,n;p!==m;++p){n=l[p];u[p]=new yg(n,e,t)}return u}},{key:"unsubscribe_",value:function unsubscribe_(e){var t=this._bindingsIndicesByPath,a=t[e];if(a!==void 0){var r=this._paths,i=this._parsedPaths,n=this._bindings,o=n.length-1,s=n[o],l=e[o];t[l]=a;n[a]=s;n.pop();i[a]=i[o];i.pop();r[a]=r[o];r.pop()}}}]);return e}();vg.prototype.isAnimationObjectGroup=!0;var _g=function(){function e(t,a){var r=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null,i=3<arguments.length&&arguments[3]!==void 0?arguments[3]:a.blendMode;_classCallCheck2(this,e);this._mixer=t;this._clip=a;this._localRoot=r;this.blendMode=i;for(var n=a.tracks,o=n.length,s=Array(o),l={endingStart:so,endingEnd:so},d=0,c;d!==o;++d){c=n[d].createInterpolant(null);s[d]=c;c.settings=l}this._interpolantSettings=l;this._interpolants=s;this._propertyBindings=Array(o);this._cacheIndex=null;this._byClipCacheIndex=null;this._timeScaleInterpolant=null;this._weightInterpolant=null;this.loop=ao;this._loopCount=-1;this._startTime=null;this.time=0;this.timeScale=1;this._effectiveTimeScale=1;this.weight=1;this._effectiveWeight=1;this.repetitions=1/0;this.paused=!1;this.enabled=!0;this.clampWhenFinished=!1;this.zeroSlopeAtStart=!0;this.zeroSlopeAtEnd=!0}_createClass2(e,[{key:"play",value:function play(){this._mixer._activateAction(this);return this}},{key:"stop",value:function stop(){this._mixer._deactivateAction(this);return this.reset()}},{key:"reset",value:function reset(){this.paused=!1;this.enabled=!0;this.time=0;this._loopCount=-1;this._startTime=null;return this.stopFading().stopWarping()}},{key:"isRunning",value:function isRunning(){return this.enabled&&!this.paused&&0!==this.timeScale&&null===this._startTime&&this._mixer._isActiveAction(this)}},{key:"isScheduled",value:function isScheduled(){return this._mixer._isActiveAction(this)}},{key:"startAt",value:function startAt(e){this._startTime=e;return this}},{key:"setLoop",value:function setLoop(e,t){this.loop=e;this.repetitions=t;return this}},{key:"setEffectiveWeight",value:function setEffectiveWeight(e){this.weight=e;this._effectiveWeight=this.enabled?e:0;return this.stopFading()}},{key:"getEffectiveWeight",value:function getEffectiveWeight(){return this._effectiveWeight}},{key:"fadeIn",value:function fadeIn(e){return this._scheduleFading(e,0,1)}},{key:"fadeOut",value:function fadeOut(e){return this._scheduleFading(e,1,0)}},{key:"crossFadeFrom",value:function crossFadeFrom(e,t,a){e.fadeOut(t);this.fadeIn(t);if(a){var r=this._clip.duration,i=e._clip.duration;e.warp(1,i/r,t);this.warp(r/i,1,t)}return this}},{key:"crossFadeTo",value:function crossFadeTo(e,t,a){return e.crossFadeFrom(this,t,a)}},{key:"stopFading",value:function stopFading(){var e=this._weightInterpolant;if(null!==e){this._weightInterpolant=null;this._mixer._takeBackControlInterpolant(e)}return this}},{key:"setEffectiveTimeScale",value:function setEffectiveTimeScale(e){this.timeScale=e;this._effectiveTimeScale=this.paused?0:e;return this.stopWarping()}},{key:"getEffectiveTimeScale",value:function getEffectiveTimeScale(){return this._effectiveTimeScale}},{key:"setDuration",value:function setDuration(e){this.timeScale=this._clip.duration/e;return this.stopWarping()}},{key:"syncWith",value:function syncWith(e){this.time=e.time;this.timeScale=e.timeScale;return this.stopWarping()}},{key:"halt",value:function halt(e){return this.warp(this._effectiveTimeScale,0,e)}},{key:"warp",value:function warp(e,t,a){var r=this._mixer,i=r.time,n=this.timeScale,o=this._timeScaleInterpolant;if(null===o){o=r._lendControlInterpolant();this._timeScaleInterpolant=o}var s=o.parameterPositions,l=o.sampleValues;s[0]=i;s[1]=i+a;l[0]=e/n;l[1]=t/n;return this}},{key:"stopWarping",value:function stopWarping(){var e=this._timeScaleInterpolant;if(null!==e){this._timeScaleInterpolant=null;this._mixer._takeBackControlInterpolant(e)}return this}},{key:"getMixer",value:function getMixer(){return this._mixer}},{key:"getClip",value:function getClip(){return this._clip}},{key:"getRoot",value:function getRoot(){return this._localRoot||this._mixer._root}},{key:"_update",value:function _update(e,t,a,r){if(!this.enabled){this._updateWeight(e);return}var i=this._startTime;if(null!==i){var d=(e-i)*a;if(0>d||0===a){return}this._startTime=null;t=a*d}t*=this._updateTimeScale(e);var n=this._updateTime(t),o=this._updateWeight(e);if(0<o){var s=this._interpolants,l=this._propertyBindings;switch(this.blendMode){case po:for(var c=0,u=s.length;c!==u;++c){s[c].evaluate(n);l[c].accumulateAdditive(o)}break;case uo:default:for(var p=0,m=s.length;p!==m;++p){s[p].evaluate(n);l[p].accumulate(r,o)}}}}},{key:"_updateWeight",value:function _updateWeight(e){var t=0;if(this.enabled){t=this.weight;var a=this._weightInterpolant;if(null!==a){var r=a.evaluate(e)[0];t*=r;if(e>a.parameterPositions[1]){this.stopFading();if(0===r){this.enabled=!1}}}}this._effectiveWeight=t;return t}},{key:"_updateTimeScale",value:function _updateTimeScale(e){var t=0;if(!this.paused){t=this.timeScale;var a=this._timeScaleInterpolant;if(null!==a){var r=a.evaluate(e)[0];t*=r;if(e>a.parameterPositions[1]){this.stopWarping();if(0===t){this.paused=!0}else{this.timeScale=t}}}}this._effectiveTimeScale=t;return t}},{key:"_updateTime",value:function _updateTime(e){var t=this._clip.duration,a=this.loop,r=this.time+e,i=this._loopCount,n=a===ro;if(0===e){if(-1===i)return r;return n&&1==(1&i)?t-r:r}if(a===to){if(-1===i){this._loopCount=0;this._setEndings(!0,!0,!1)}handle_stop:{if(r>=t){r=t}else if(0>r){r=0}else{this.time=r;break handle_stop}if(this.clampWhenFinished)this.paused=!0;else this.enabled=!1;this.time=r;this._mixer.dispatchEvent({type:"finished",action:this,direction:0>e?-1:1})}}else{if(-1===i){if(0<=e){i=0;this._setEndings(!0,0===this.repetitions,n)}else{this._setEndings(0===this.repetitions,!0,n)}}if(r>=t||0>r){var o=Math.floor(r/t);r-=t*o;i+=Math.abs(o);var s=this.repetitions-i;if(0>=s){if(this.clampWhenFinished)this.paused=!0;else this.enabled=!1;r=0<e?t:0;this.time=r;this._mixer.dispatchEvent({type:"finished",action:this,direction:0<e?1:-1})}else{if(1===s){var l=0>e;this._setEndings(l,!l,n)}else{this._setEndings(!1,!1,n)}this._loopCount=i;this.time=r;this._mixer.dispatchEvent({type:"loop",action:this,loopDelta:o})}}else{this.time=r}if(n&&1==(1&i)){return t-r}}return r}},{key:"_setEndings",value:function _setEndings(e,t,a){var r=this._interpolantSettings;if(a){r.endingStart=lo;r.endingEnd=lo}else{if(e){r.endingStart=this.zeroSlopeAtStart?lo:so}else{r.endingStart=co}if(t){r.endingEnd=this.zeroSlopeAtEnd?lo:so}else{r.endingEnd=co}}}},{key:"_scheduleFading",value:function _scheduleFading(e,t,a){var r=this._mixer,i=r.time,n=this._weightInterpolant;if(null===n){n=r._lendControlInterpolant();this._weightInterpolant=n}var o=n.parameterPositions,s=n.sampleValues;o[0]=i;s[0]=t;o[1]=i+e;s[1]=a;return this}}]);return e}(),xg=function(e){_inherits(t,e);var a=_createSuper(t);function t(e){var r;_classCallCheck2(this,t);r=a.call(this);r._root=e;r._initMemoryManager();r._accuIndex=0;r.time=0;r.timeScale=1;return r}_createClass2(t,[{key:"_bindAction",value:function _bindAction(e,t){var a=e._localRoot||this._root,r=e._clip.tracks,i=r.length,n=e._propertyBindings,o=e._interpolants,s=a.uuid,l=this._bindingsByRootAndName,d=l[s];if(d===void 0){d={};l[s]=d}for(var m=0;m!==i;++m){var c=r[m],u=c.name,p=d[u];if(p!==void 0){n[m]=p}else{p=n[m];if(p!==void 0){if(null===p._cacheIndex){++p.referenceCount;this._addInactiveBinding(p,s,u)}continue}var g=t&&t._propertyBindings[m].binding.parsedPath;p=new ng(yg.create(a,u,g),c.ValueTypeName,c.getValueSize());++p.referenceCount;this._addInactiveBinding(p,s,u);n[m]=p}o[m].resultBuffer=p.buffer}}},{key:"_activateAction",value:function _activateAction(e){if(!this._isActiveAction(e)){if(null===e._cacheIndex){var n=(e._localRoot||this._root).uuid,o=e._clip.uuid,s=this._actionsByClip[o];this._bindAction(e,s&&s.knownActions[0]);this._addInactiveAction(e,o,n)}for(var t=e._propertyBindings,a=0,r=t.length,i;a!==r;++a){i=t[a];if(0==i.useCount++){this._lendBinding(i);i.saveOriginalState()}}this._lendAction(e)}}},{key:"_deactivateAction",value:function _deactivateAction(e){if(this._isActiveAction(e)){for(var t=e._propertyBindings,a=0,r=t.length,i;a!==r;++a){i=t[a];if(0==--i.useCount){i.restoreOriginalState();this._takeBackBinding(i)}}this._takeBackAction(e)}}},{key:"_initMemoryManager",value:function _initMemoryManager(){this._actions=[];this._nActiveActions=0;this._actionsByClip={};this._bindings=[];this._nActiveBindings=0;this._bindingsByRootAndName={};this._controlInterpolants=[];this._nActiveControlInterpolants=0;var e=this;this.stats={actions:{get total(){return e._actions.length},get inUse(){return e._nActiveActions}},bindings:{get total(){return e._bindings.length},get inUse(){return e._nActiveBindings}},controlInterpolants:{get total(){return e._controlInterpolants.length},get inUse(){return e._nActiveControlInterpolants}}}}},{key:"_isActiveAction",value:function _isActiveAction(e){var t=e._cacheIndex;return null!==t&&t<this._nActiveActions}},{key:"_addInactiveAction",value:function _addInactiveAction(e,t,a){var r=this._actions,i=this._actionsByClip,n=i[t];if(n===void 0){n={knownActions:[e],actionByRoot:{}};e._byClipCacheIndex=0;i[t]=n}else{var o=n.knownActions;e._byClipCacheIndex=o.length;o.push(e)}e._cacheIndex=r.length;r.push(e);n.actionByRoot[a]=e}},{key:"_removeInactiveAction",value:function _removeInactiveAction(e){var t=this._actions,a=t[t.length-1],r=e._cacheIndex;a._cacheIndex=r;t[r]=a;t.pop();e._cacheIndex=null;var i=e._clip.uuid,n=this._actionsByClip,o=n[i],s=o.knownActions,l=s[s.length-1],d=e._byClipCacheIndex;l._byClipCacheIndex=d;s[d]=l;s.pop();e._byClipCacheIndex=null;var c=o.actionByRoot,u=(e._localRoot||this._root).uuid;delete c[u];if(0===s.length){delete n[i]}this._removeInactiveBindingsForAction(e)}},{key:"_removeInactiveBindingsForAction",value:function _removeInactiveBindingsForAction(e){for(var t=e._propertyBindings,a=0,r=t.length,i;a!==r;++a){i=t[a];if(0==--i.referenceCount){this._removeInactiveBinding(i)}}}},{key:"_lendAction",value:function _lendAction(e){var t=this._actions,a=e._cacheIndex,r=this._nActiveActions++,i=t[r];e._cacheIndex=r;t[r]=e;i._cacheIndex=a;t[a]=i}},{key:"_takeBackAction",value:function _takeBackAction(e){var t=this._actions,a=e._cacheIndex,r=--this._nActiveActions,i=t[r];e._cacheIndex=r;t[r]=e;i._cacheIndex=a;t[a]=i}},{key:"_addInactiveBinding",value:function _addInactiveBinding(e,t,a){var r=this._bindingsByRootAndName,i=this._bindings,n=r[t];if(n===void 0){n={};r[t]=n}n[a]=e;e._cacheIndex=i.length;i.push(e)}},{key:"_removeInactiveBinding",value:function _removeInactiveBinding(e){var t=this._bindings,a=e.binding,r=a.rootNode.uuid,i=a.path,n=this._bindingsByRootAndName,o=n[r],s=t[t.length-1],l=e._cacheIndex;s._cacheIndex=l;t[l]=s;t.pop();delete o[i];if(0===Object.keys(o).length){delete n[r]}}},{key:"_lendBinding",value:function _lendBinding(e){var t=this._bindings,a=e._cacheIndex,r=this._nActiveBindings++,i=t[r];e._cacheIndex=r;t[r]=e;i._cacheIndex=a;t[a]=i}},{key:"_takeBackBinding",value:function _takeBackBinding(e){var t=this._bindings,a=e._cacheIndex,r=--this._nActiveBindings,i=t[r];e._cacheIndex=r;t[r]=e;i._cacheIndex=a;t[a]=i}},{key:"_lendControlInterpolant",value:function _lendControlInterpolant(){var e=this._controlInterpolants,t=this._nActiveControlInterpolants++,a=e[t];if(a===void 0){a=new Up(new Float32Array(2),new Float32Array(2),1,this._controlInterpolantsResultBuffer);a.__cacheIndex=t;e[t]=a}return a}},{key:"_takeBackControlInterpolant",value:function _takeBackControlInterpolant(e){var t=this._controlInterpolants,a=e.__cacheIndex,r=--this._nActiveControlInterpolants,i=t[r];e.__cacheIndex=r;t[r]=e;i.__cacheIndex=a;t[a]=i}},{key:"clipAction",value:function clipAction(e,t,a){var r=t||this._root,i=r.uuid,n="string"==typeof e?Jp.findByName(r,e):e,o=null!==n?n.uuid:e,s=this._actionsByClip[o],l=null;if(a===void 0){if(null!==n){a=n.blendMode}else{a=uo}}if(s!==void 0){var c=s.actionByRoot[i];if(c!==void 0&&c.blendMode===a){return c}l=s.knownActions[0];if(null===n)n=l._clip}if(null===n)return null;var d=new _g(this,n,t,a);this._bindAction(d,l);this._addInactiveAction(d,o,i);return d}},{key:"existingAction",value:function existingAction(e,t){var a=t||this._root,r=a.uuid,i="string"==typeof e?Jp.findByName(a,e):e,n=i?i.uuid:e,o=this._actionsByClip[n];if(o!==void 0){return o.actionByRoot[r]||null}return null}},{key:"stopAllAction",value:function stopAllAction(){for(var e=this._actions,t=this._nActiveActions,a=t-1;0<=a;--a){e[a].stop()}return this}},{key:"update",value:function update(e){e*=this.timeScale;for(var t=this._actions,a=this._nActiveActions,r=this.time+=e,i=Math.sign(e),n=this._accuIndex^=1,o=0,s;o!==a;++o){s=t[o];s._update(r,e,i,n)}for(var l=this._bindings,d=this._nActiveBindings,c=0;c!==d;++c){l[c].apply(n)}return this}},{key:"setTime",value:function setTime(e){this.time=0;for(var t=0;t<this._actions.length;t++){this._actions[t].time=0}return this.update(e)}},{key:"getRoot",value:function getRoot(){return this._root}},{key:"uncacheClip",value:function uncacheClip(e){var t=this._actions,a=e.uuid,r=this._actionsByClip,i=r[a];if(i!==void 0){for(var o=i.knownActions,s=0,l=o.length,n;s!==l;++s){n=o[s];this._deactivateAction(n);var d=n._cacheIndex,c=t[t.length-1];n._cacheIndex=null;n._byClipCacheIndex=null;c._cacheIndex=d;t[d]=c;t.pop();this._removeInactiveBindingsForAction(n)}delete r[a]}}},{key:"uncacheRoot",value:function uncacheRoot(e){var t=e.uuid,a=this._actionsByClip;for(var n in a){var o=a[n].actionByRoot,s=o[t];if(s!==void 0){this._deactivateAction(s);this._removeInactiveAction(s)}}var r=this._bindingsByRootAndName,i=r[t];if(i!==void 0){for(var l in i){var d=i[l];d.restoreOriginalState();this._removeInactiveBinding(d)}}}},{key:"uncacheAction",value:function uncacheAction(e,t){var a=this.existingAction(e,t);if(null!==a){this._deactivateAction(a);this._removeInactiveAction(a)}}}]);return t}(es);xg.prototype._controlInterpolantsResultBuffer=new Float32Array(1);var bg=function(){function e(t){_classCallCheck2(this,e);if("string"==typeof t){console.warn("THREE.Uniform: Type parameter is no longer needed.");t=arguments[1]}this.value=t}_createClass2(e,[{key:"clone",value:function clone(){return new e(this.value.clone===void 0?this.value:this.value.clone())}}]);return e}(),Sg=function(e){_inherits(t,e);var a=_createSuper(t);function t(e,r){var i,n=2<arguments.length&&arguments[2]!==void 0?arguments[2]:1;_classCallCheck2(this,t);i=a.call(this,e,r);i.meshPerAttribute=n;return i}_createClass2(t,[{key:"copy",value:function copy(e){_get(_getPrototypeOf(t.prototype),"copy",this).call(this,e);this.meshPerAttribute=e.meshPerAttribute;return this}},{key:"clone",value:function clone(e){var a=_get(_getPrototypeOf(t.prototype),"clone",this).call(this,e);a.meshPerAttribute=this.meshPerAttribute;return a}},{key:"toJSON",value:function toJSON(e){var a=_get(_getPrototypeOf(t.prototype),"toJSON",this).call(this,e);a.isInstancedInterleavedBuffer=!0;a.meshPerAttribute=this.meshPerAttribute;return a}}]);return t}(Pc);Sg.prototype.isInstancedInterleavedBuffer=!0;var Mg=function(){function e(t,a,r,i,n){_classCallCheck2(this,e);this.buffer=t;this.type=a;this.itemSize=r;this.elementSize=i;this.count=n;this.version=0}_createClass2(e,[{key:"setBuffer",value:function setBuffer(e){this.buffer=e;return this}},{key:"setType",value:function setType(e,t){this.type=e;this.elementSize=t;return this}},{key:"setItemSize",value:function setItemSize(e){this.itemSize=e;return this}},{key:"setCount",value:function setCount(e){this.count=e;return this}},{key:"needsUpdate",set:function set(e){if(!0===e)this.version++}}]);return e}();Mg.prototype.isGLBufferAttribute=!0;var Tg=function(){function e(t,a){var r=2<arguments.length&&arguments[2]!==void 0?arguments[2]:0,i=3<arguments.length&&arguments[3]!==void 0?arguments[3]:1/0;_classCallCheck2(this,e);this.ray=new Xs(t,a);this.near=r;this.far=i;this.camera=null;this.layers=new il;this.params={Mesh:{},Line:{threshold:1},LOD:{},Points:{threshold:1},Sprite:{}}}_createClass2(e,[{key:"set",value:function set(e,t){this.ray.set(e,t)}},{key:"setFromCamera",value:function setFromCamera(e,t){if(t&&t.isPerspectiveCamera){this.ray.origin.setFromMatrixPosition(t.matrixWorld);this.ray.direction.set(e.x,e.y,.5).unproject(t).sub(this.ray.origin).normalize();this.camera=t}else if(t&&t.isOrthographicCamera){this.ray.origin.set(e.x,e.y,(t.near+t.far)/(t.near-t.far)).unproject(t);this.ray.direction.set(0,0,-1).transformDirection(t.matrixWorld);this.camera=t}else{console.error("THREE.Raycaster: Unsupported camera type: "+t.type)}}},{key:"intersectObject",value:function intersectObject(e){var t=1<arguments.length&&arguments[1]!==void 0?arguments[1]:!0,a=2<arguments.length&&arguments[2]!==void 0?arguments[2]:[];Fa(e,this,a,t);a.sort(Na);return a}},{key:"intersectObjects",value:function intersectObjects(e){for(var t=1<arguments.length&&arguments[1]!==void 0?arguments[1]:!0,a=2<arguments.length&&arguments[2]!==void 0?arguments[2]:[],r=0,i=e.length;r<i;r++){Fa(e[r],this,a,t)}a.sort(Na);return a}}]);return e}();function Na(e,t){return e.distance-t.distance}function Fa(e,t,a,r){if(e.layers.test(t.layers)){e.raycast(t,a)}if(!0===r){for(var i=e.children,n=0,o=i.length;n<o;n++){Fa(i[n],t,a,!0)}}}var Eg=function(){function e(){var t=0<arguments.length&&arguments[0]!==void 0?arguments[0]:1,a=1<arguments.length&&arguments[1]!==void 0?arguments[1]:0,r=2<arguments.length&&arguments[2]!==void 0?arguments[2]:0;_classCallCheck2(this,e);this.radius=t;this.phi=a;this.theta=r;return this}_createClass2(e,[{key:"set",value:function set(e,t,a){this.radius=e;this.phi=t;this.theta=a;return this}},{key:"copy",value:function copy(e){this.radius=e.radius;this.phi=e.phi;this.theta=e.theta;return this}},{key:"makeSafe",value:function makeSafe(){var e=1e-6;this.phi=Math.max(e,Math.min(Math.PI-e,this.phi));return this}},{key:"setFromVector3",value:function setFromVector3(e){return this.setFromCartesianCoords(e.x,e.y,e.z)}},{key:"setFromCartesianCoords",value:function setFromCartesianCoords(e,t,r){this.radius=Math.sqrt(e*e+t*t+r*r);if(0===this.radius){this.theta=0;this.phi=0}else{this.theta=Math.atan2(e,r);this.phi=Math.acos(a(t/this.radius,-1,1))}return this}},{key:"clone",value:function clone(){return new this.constructor().copy(this)}}]);return e}(),wg=function(){function e(){var t=0<arguments.length&&arguments[0]!==void 0?arguments[0]:1,a=1<arguments.length&&arguments[1]!==void 0?arguments[1]:0,r=2<arguments.length&&arguments[2]!==void 0?arguments[2]:0;_classCallCheck2(this,e);this.radius=t;this.theta=a;this.y=r;return this}_createClass2(e,[{key:"set",value:function set(e,t,a){this.radius=e;this.theta=t;this.y=a;return this}},{key:"copy",value:function copy(e){this.radius=e.radius;this.theta=e.theta;this.y=e.y;return this}},{key:"setFromVector3",value:function setFromVector3(e){return this.setFromCartesianCoords(e.x,e.y,e.z)}},{key:"setFromCartesianCoords",value:function setFromCartesianCoords(e,t,a){this.radius=Math.sqrt(e*e+a*a);this.theta=Math.atan2(e,a);this.y=t;return this}},{key:"clone",value:function clone(){return new this.constructor().copy(this)}}]);return e}(),Ag=new os,kg=function(){function e(){var t=0<arguments.length&&arguments[0]!==void 0?arguments[0]:new os(+Infinity,+Infinity),a=1<arguments.length&&arguments[1]!==void 0?arguments[1]:new os(-Infinity,-Infinity);_classCallCheck2(this,e);this.min=t;this.max=a}_createClass2(e,[{key:"set",value:function set(e,t){this.min.copy(e);this.max.copy(t);return this}},{key:"setFromPoints",value:function setFromPoints(e){this.makeEmpty();for(var t=0,a=e.length;t<a;t++){this.expandByPoint(e[t])}return this}},{key:"setFromCenterAndSize",value:function setFromCenterAndSize(e,t){var a=Ag.copy(t).multiplyScalar(.5);this.min.copy(e).sub(a);this.max.copy(e).add(a);return this}},{key:"clone",value:function clone(){return new this.constructor().copy(this)}},{key:"copy",value:function copy(e){this.min.copy(e.min);this.max.copy(e.max);return this}},{key:"makeEmpty",value:function makeEmpty(){this.min.x=this.min.y=+Infinity;this.max.x=this.max.y=-Infinity;return this}},{key:"isEmpty",value:function isEmpty(){return this.max.x<this.min.x||this.max.y<this.min.y}},{key:"getCenter",value:function getCenter(e){return this.isEmpty()?e.set(0,0):e.addVectors(this.min,this.max).multiplyScalar(.5)}},{key:"getSize",value:function getSize(e){return this.isEmpty()?e.set(0,0):e.subVectors(this.max,this.min)}},{key:"expandByPoint",value:function expandByPoint(e){this.min.min(e);this.max.max(e);return this}},{key:"expandByVector",value:function expandByVector(e){this.min.sub(e);this.max.add(e);return this}},{key:"expandByScalar",value:function expandByScalar(e){this.min.addScalar(-e);this.max.addScalar(e);return this}},{key:"containsPoint",value:function containsPoint(e){return e.x<this.min.x||e.x>this.max.x||e.y<this.min.y||e.y>this.max.y?!1:!0}},{key:"containsBox",value:function containsBox(e){return this.min.x<=e.min.x&&e.max.x<=this.max.x&&this.min.y<=e.min.y&&e.max.y<=this.max.y}},{key:"getParameter",value:function getParameter(e,t){return t.set((e.x-this.min.x)/(this.max.x-this.min.x),(e.y-this.min.y)/(this.max.y-this.min.y))}},{key:"intersectsBox",value:function intersectsBox(e){return e.max.x<this.min.x||e.min.x>this.max.x||e.max.y<this.min.y||e.min.y>this.max.y?!1:!0}},{key:"clampPoint",value:function clampPoint(e,t){return t.copy(e).clamp(this.min,this.max)}},{key:"distanceToPoint",value:function distanceToPoint(e){var t=Ag.copy(e).clamp(this.min,this.max);return t.sub(e).length()}},{key:"intersect",value:function intersect(e){this.min.max(e.min);this.max.min(e.max);return this}},{key:"union",value:function union(e){this.min.min(e.min);this.max.max(e.max);return this}},{key:"translate",value:function translate(e){this.min.add(e);this.max.add(e);return this}},{key:"equals",value:function(e){return e.min.equals(this.min)&&e.max.equals(this.max)}}]);return e}();kg.prototype.isBox2=!0;var Cg=new vs,Rg=new vs,Lg=function(){function e(){var t=0<arguments.length&&arguments[0]!==void 0?arguments[0]:new vs,a=1<arguments.length&&arguments[1]!==void 0?arguments[1]:new vs;_classCallCheck2(this,e);this.start=t;this.end=a}_createClass2(e,[{key:"set",value:function set(e,t){this.start.copy(e);this.end.copy(t);return this}},{key:"copy",value:function copy(e){this.start.copy(e.start);this.end.copy(e.end);return this}},{key:"getCenter",value:function getCenter(e){return e.addVectors(this.start,this.end).multiplyScalar(.5)}},{key:"delta",value:function delta(e){return e.subVectors(this.end,this.start)}},{key:"distanceSq",value:function distanceSq(){return this.start.distanceToSquared(this.end)}},{key:"distance",value:function distance(){return this.start.distanceTo(this.end)}},{key:"at",value:function at(e,t){return this.delta(t).multiplyScalar(e).add(this.start)}},{key:"closestPointToPointParameter",value:function closestPointToPointParameter(e,r){Cg.subVectors(e,this.start);Rg.subVectors(this.end,this.start);var i=Rg.dot(Rg),n=Rg.dot(Cg),o=n/i;if(r){o=a(o,0,1)}return o}},{key:"closestPointToPoint",value:function closestPointToPoint(e,a,r){var i=this.closestPointToPointParameter(e,a);return this.delta(r).multiplyScalar(i).add(this.start)}},{key:"applyMatrix4",value:function applyMatrix4(e){this.start.applyMatrix4(e);this.end.applyMatrix4(e);return this}},{key:"equals",value:function(e){return e.start.equals(this.start)&&e.end.equals(this.end)}},{key:"clone",value:function clone(){return new this.constructor().copy(this)}}]);return e}(),Pg=new vs,Ig=function(e){_inherits(t,e);var a=_createSuper(t);function t(e,r){var i;_classCallCheck2(this,t);i=a.call(this);i.light=e;i.light.updateMatrixWorld();i.matrix=e.matrixWorld;i.matrixAutoUpdate=!1;i.color=r;for(var n=new rd,o=[0,0,0,0,0,1,0,0,0,1,0,1,0,0,0,-1,0,1,0,0,0,0,1,1,0,0,0,0,-1,1],s=0,d=1,c=32;s<c;s++,d++){var l=2*(s/c*Math.PI),u=2*(d/c*Math.PI);o.push(Math.cos(l),Math.sin(l),1,Math.cos(u),Math.sin(u),1)}n.setAttribute("position",new Yl(o,3));var p=new hu({fog:!1,toneMapped:!1});i.cone=new Eu(n,p);i.add(i.cone);i.update();return i}_createClass2(t,[{key:"dispose",value:function dispose(){this.cone.geometry.dispose();this.cone.material.dispose()}},{key:"update",value:function update(){this.light.updateMatrixWorld();var e=this.light.distance?this.light.distance:1e3,t=e*Math.tan(this.light.angle);this.cone.scale.set(t,t,e);Pg.setFromMatrixPosition(this.light.target.matrixWorld);this.cone.lookAt(Pg);if(this.color!==void 0){this.cone.material.color.set(this.color)}else{this.cone.material.color.copy(this.light.color)}}}]);return t}(vl),Dg=new vs,zg=new Ys,Ng=new Ys,Fg=function(e){_inherits(t,e);var a=_createSuper(t);function t(e){var r;_classCallCheck2(this,t);for(var i=Oa(e),n=new rd,o=[],s=[],l=new zl(0,0,1),d=new zl(0,1,0),c=0,u;c<i.length;c++){u=i[c];if(u.parent&&u.parent.isBone){o.push(0,0,0);o.push(0,0,0);s.push(l.r,l.g,l.b);s.push(d.r,d.g,d.b)}}n.setAttribute("position",new Yl(o,3));n.setAttribute("color",new Yl(s,3));var p=new hu({vertexColors:!0,depthTest:!1,depthWrite:!1,toneMapped:!1,transparent:!0});r=a.call(this,n,p);r.type="SkeletonHelper";r.isSkeletonHelper=!0;r.root=e;r.bones=i;r.matrix=e.matrixWorld;r.matrixAutoUpdate=!1;return r}_createClass2(t,[{key:"updateMatrixWorld",value:function updateMatrixWorld(e){var a=this.bones,r=this.geometry,i=r.getAttribute("position");Ng.copy(this.root.matrixWorld).invert();for(var n=0,o=0,s;n<a.length;n++){s=a[n];if(s.parent&&s.parent.isBone){zg.multiplyMatrices(Ng,s.matrixWorld);Dg.setFromMatrixPosition(zg);i.setXYZ(o,Dg.x,Dg.y,Dg.z);zg.multiplyMatrices(Ng,s.parent.matrixWorld);Dg.setFromMatrixPosition(zg);i.setXYZ(o+1,Dg.x,Dg.y,Dg.z);o+=2}}r.getAttribute("position").needsUpdate=!0;_get(_getPrototypeOf(t.prototype),"updateMatrixWorld",this).call(this,e)}}]);return t}(Eu);function Oa(e){var t=[];if(e&&e.isBone){t.push(e)}for(var a=0;a<e.children.length;a++){t.push.apply(t,Oa(e.children[a]))}return t}var Og=function(e){_inherits(t,e);var a=_createSuper(t);function t(e,r,i){var n;_classCallCheck2(this,t);var o=new xp(r,4,2),s=new Nl({wireframe:!0,fog:!1,toneMapped:!1});n=a.call(this,o,s);n.light=e;n.light.updateMatrixWorld();n.color=i;n.type="PointLightHelper";n.matrix=n.light.matrixWorld;n.matrixAutoUpdate=!1;n.update();return n}_createClass2(t,[{key:"dispose",value:function dispose(){this.geometry.dispose();this.material.dispose()}},{key:"update",value:function update(){if(this.color!==void 0){this.material.color.set(this.color)}else{this.material.color.copy(this.light.color)}}}]);return t}(bd),Bg=new vs,Ug=new zl,Gg=new zl,Hg=function(e){_inherits(t,e);var a=_createSuper(t);function t(e,r,i){var n;_classCallCheck2(this,t);n=a.call(this);n.light=e;n.light.updateMatrixWorld();n.matrix=e.matrixWorld;n.matrixAutoUpdate=!1;n.color=i;var o=new yp(r);o.rotateY(.5*Math.PI);n.material=new Nl({wireframe:!0,fog:!1,toneMapped:!1});if(n.color===void 0)n.material.vertexColors=!0;var s=o.getAttribute("position"),l=new Float32Array(3*s.count);o.setAttribute("color",new Bl(l,3));n.add(new bd(o,n.material));n.update();return n}_createClass2(t,[{key:"dispose",value:function dispose(){this.children[0].geometry.dispose();this.children[0].material.dispose()}},{key:"update",value:function update(){var e=this.children[0];if(this.color!==void 0){this.material.color.set(this.color)}else{var t=e.geometry.getAttribute("color");Ug.copy(this.light.color);Gg.copy(this.light.groundColor);for(var a=0,r=t.count,i;a<r;a++){i=a<r/2?Ug:Gg;t.setXYZ(a,i.r,i.g,i.b)}t.needsUpdate=!0}e.lookAt(Bg.setFromMatrixPosition(this.light.matrixWorld).negate())}}]);return t}(vl),Vg=function(e){_inherits(t,e);var a=_createSuper(t);function t(){var e,r=0<arguments.length&&arguments[0]!==void 0?arguments[0]:10,i=1<arguments.length&&arguments[1]!==void 0?arguments[1]:10,n=2<arguments.length&&arguments[2]!==void 0?arguments[2]:4473924,o=3<arguments.length&&arguments[3]!==void 0?arguments[3]:8947848;_classCallCheck2(this,t);n=new zl(n);o=new zl(o);for(var s=r/2,l=[],d=[],c=0,u=0,p=-s;c<=i;c++,p+=r/i){l.push(-s,0,p,s,0,p);l.push(p,0,-s,p,0,s);var f=c===i/2?n:o;f.toArray(d,u);u+=3;f.toArray(d,u);u+=3;f.toArray(d,u);u+=3;f.toArray(d,u);u+=3}var m=new rd;m.setAttribute("position",new Yl(l,3));m.setAttribute("color",new Yl(d,3));var g=new hu({vertexColors:!0,toneMapped:!1});e=a.call(this,m,g);e.type="GridHelper";return e}return t}(Eu),Wg=function(e){_inherits(t,e);var a=_createSuper(t);function t(){var e,i=0<arguments.length&&arguments[0]!==void 0?arguments[0]:10,n=1<arguments.length&&arguments[1]!==void 0?arguments[1]:16,o=2<arguments.length&&arguments[2]!==void 0?arguments[2]:8,s=3<arguments.length&&arguments[3]!==void 0?arguments[3]:64,l=4<arguments.length&&arguments[4]!==void 0?arguments[4]:4473924,d=5<arguments.length&&arguments[5]!==void 0?arguments[5]:8947848;_classCallCheck2(this,t);l=new zl(l);d=new zl(d);for(var c=[],u=[],p=0;p<=n;p++){var m=p/n*(2*Math.PI),g=Math.sin(m)*i,f=Math.cos(m)*i;c.push(0,0,0);c.push(g,0,f);var M=1&p?l:d;u.push(M.r,M.g,M.b);u.push(M.r,M.g,M.b)}for(var T=0;T<=o;T++){for(var h=1&T?l:d,y=i-i/o*T,r=0;r<s;r++){var v=r/s*(2*Math.PI),_=Math.sin(v)*y,x=Math.cos(v)*y;c.push(_,0,x);u.push(h.r,h.g,h.b);v=(r+1)/s*(2*Math.PI);_=Math.sin(v)*y;x=Math.cos(v)*y;c.push(_,0,x);u.push(h.r,h.g,h.b)}}var b=new rd;b.setAttribute("position",new Yl(c,3));b.setAttribute("color",new Yl(u,3));var S=new hu({vertexColors:!0,toneMapped:!1});e=a.call(this,b,S);e.type="PolarGridHelper";return e}return t}(Eu),jg=new vs,qg=new vs,Xg=new vs,Yg=function(e){_inherits(t,e);var a=_createSuper(t);function t(e,r,i){var n;_classCallCheck2(this,t);n=a.call(this);n.light=e;n.light.updateMatrixWorld();n.matrix=e.matrixWorld;n.matrixAutoUpdate=!1;n.color=i;if(r===void 0)r=1;var o=new rd;o.setAttribute("position",new Yl([-r,r,0,r,r,0,r,-r,0,-r,-r,0,-r,r,0],3));var s=new hu({fog:!1,toneMapped:!1});n.lightPlane=new Su(o,s);n.add(n.lightPlane);o=new rd;o.setAttribute("position",new Yl([0,0,0,0,0,1],3));n.targetLine=new Su(o,s);n.add(n.targetLine);n.update();return n}_createClass2(t,[{key:"dispose",value:function dispose(){this.lightPlane.geometry.dispose();this.lightPlane.material.dispose();this.targetLine.geometry.dispose();this.targetLine.material.dispose()}},{key:"update",value:function update(){jg.setFromMatrixPosition(this.light.matrixWorld);qg.setFromMatrixPosition(this.light.target.matrixWorld);Xg.subVectors(qg,jg);this.lightPlane.lookAt(qg);if(this.color!==void 0){this.lightPlane.material.color.set(this.color);this.targetLine.material.color.set(this.color)}else{this.lightPlane.material.color.copy(this.light.color);this.targetLine.material.color.copy(this.light.color)}this.targetLine.lookAt(qg);this.targetLine.scale.z=Xg.length()}}]);return t}(vl),Zg=new vs,Jg=new Ed,Qg=function(e){_inherits(t,e);var a=_createSuper(t);function t(e){var n;_classCallCheck2(this,t);var o=new rd,s=new hu({color:16777215,vertexColors:!0,toneMapped:!1}),l=[],d=[],c={},u=new zl(16755200),p=new zl(16711680),m=new zl(43775),g=new zl(16777215),f=new zl(3355443);r("n1","n2",u);r("n2","n4",u);r("n4","n3",u);r("n3","n1",u);r("f1","f2",u);r("f2","f4",u);r("f4","f3",u);r("f3","f1",u);r("n1","f1",u);r("n2","f2",u);r("n3","f3",u);r("n4","f4",u);r("p","n1",p);r("p","n2",p);r("p","n3",p);r("p","n4",p);r("u1","u2",m);r("u2","u3",m);r("u3","u1",m);r("c","t",g);r("p","c",f);r("cn1","cn2",f);r("cn3","cn4",f);r("cf1","cf2",f);r("cf3","cf4",f);function r(e,t,a){i(e,a);i(t,a)}function i(e,t){l.push(0,0,0);d.push(t.r,t.g,t.b);if(c[e]===void 0){c[e]=[]}c[e].push(l.length/3-1)}o.setAttribute("position",new Yl(l,3));o.setAttribute("color",new Yl(d,3));n=a.call(this,o,s);n.type="CameraHelper";n.camera=e;if(n.camera.updateProjectionMatrix)n.camera.updateProjectionMatrix();n.matrix=e.matrixWorld;n.matrixAutoUpdate=!1;n.pointMap=c;n.update();return n}_createClass2(t,[{key:"update",value:function update(){var e=this.geometry,t=this.pointMap,a=1,r=1;Jg.projectionMatrixInverse.copy(this.camera.projectionMatrixInverse);Ba("c",t,e,Jg,0,0,-1);Ba("t",t,e,Jg,0,0,1);Ba("n1",t,e,Jg,-a,-r,-1);Ba("n2",t,e,Jg,a,-r,-1);Ba("n3",t,e,Jg,-a,r,-1);Ba("n4",t,e,Jg,a,r,-1);Ba("f1",t,e,Jg,-a,-r,1);Ba("f2",t,e,Jg,a,-r,1);Ba("f3",t,e,Jg,-a,r,1);Ba("f4",t,e,Jg,a,r,1);Ba("u1",t,e,Jg,.7*a,1.1*r,-1);Ba("u2",t,e,Jg,.7*-a,1.1*r,-1);Ba("u3",t,e,Jg,0,2*r,-1);Ba("cf1",t,e,Jg,-a,0,1);Ba("cf2",t,e,Jg,a,0,1);Ba("cf3",t,e,Jg,0,-r,1);Ba("cf4",t,e,Jg,0,r,1);Ba("cn1",t,e,Jg,-a,0,-1);Ba("cn2",t,e,Jg,a,0,-1);Ba("cn3",t,e,Jg,0,-r,-1);Ba("cn4",t,e,Jg,0,r,-1);e.getAttribute("position").needsUpdate=!0}},{key:"dispose",value:function dispose(){this.geometry.dispose();this.material.dispose()}}]);return t}(Eu);function Ba(e,t,a,r,i,n,o){Zg.set(i,n,o).unproject(r);var s=t[e];if(s!==void 0){for(var d=a.getAttribute("position"),c=0,u=s.length;c<u;c++){d.setXYZ(s[c],Zg.x,Zg.y,Zg.z)}}}var Kg=new bs,$g=function(e){_inherits(t,e);var a=_createSuper(t);function t(e){var r,i=1<arguments.length&&arguments[1]!==void 0?arguments[1]:16776960;_classCallCheck2(this,t);var n=new Uint16Array([0,1,1,2,2,3,3,0,4,5,5,6,6,7,7,4,0,4,1,5,2,6,3,7]),o=new Float32Array(24),s=new rd;s.setIndex(new Bl(n,1));s.setAttribute("position",new Bl(o,3));r=a.call(this,s,new hu({color:i,toneMapped:!1}));r.object=e;r.type="BoxHelper";r.matrixAutoUpdate=!1;r.update();return r}_createClass2(t,[{key:"update",value:function update(e){if(e!==void 0){console.warn("THREE.BoxHelper: .update() has no longer arguments.")}if(this.object!==void 0){Kg.setFromObject(this.object)}if(Kg.isEmpty())return;var t=Kg.min,a=Kg.max,r=this.geometry.attributes.position,i=r.array;i[0]=a.x;i[1]=a.y;i[2]=a.z;i[3]=t.x;i[4]=a.y;i[5]=a.z;i[6]=t.x;i[7]=t.y;i[8]=a.z;i[9]=a.x;i[10]=t.y;i[11]=a.z;i[12]=a.x;i[13]=a.y;i[14]=t.z;i[15]=t.x;i[16]=a.y;i[17]=t.z;i[18]=t.x;i[19]=t.y;i[20]=t.z;i[21]=a.x;i[22]=t.y;i[23]=t.z;r.needsUpdate=!0;this.geometry.computeBoundingSphere()}},{key:"setFromObject",value:function setFromObject(e){this.object=e;this.update();return this}},{key:"copy",value:function copy(e){Eu.prototype.copy.call(this,e);this.object=e.object;return this}}]);return t}(Eu),ef=function(e){_inherits(t,e);var a=_createSuper(t);function t(e){var r,i=1<arguments.length&&arguments[1]!==void 0?arguments[1]:16776960;_classCallCheck2(this,t);var n=new Uint16Array([0,1,1,2,2,3,3,0,4,5,5,6,6,7,7,4,0,4,1,5,2,6,3,7]),o=new rd;o.setIndex(new Bl(n,1));o.setAttribute("position",new Yl([1,1,1,-1,1,1,-1,-1,1,1,-1,1,1,1,-1,-1,1,-1,-1,-1,-1,1,-1,-1],3));r=a.call(this,o,new hu({color:i,toneMapped:!1}));r.box=e;r.type="Box3Helper";r.geometry.computeBoundingSphere();return r}_createClass2(t,[{key:"updateMatrixWorld",value:function updateMatrixWorld(e){var a=this.box;if(a.isEmpty())return;a.getCenter(this.position);a.getSize(this.scale);this.scale.multiplyScalar(.5);_get(_getPrototypeOf(t.prototype),"updateMatrixWorld",this).call(this,e)}}]);return t}(Eu),tf=function(e){_inherits(t,e);var a=_createSuper(t);function t(e){var r,i=1<arguments.length&&arguments[1]!==void 0?arguments[1]:1,n=2<arguments.length&&arguments[2]!==void 0?arguments[2]:16776960;_classCallCheck2(this,t);var o=n,s=new rd;s.setAttribute("position",new Yl([1,-1,1,-1,1,1,-1,-1,1,1,1,1,-1,1,1,-1,-1,1,1,-1,1,1,1,1,0,0,1,0,0,0],3));s.computeBoundingSphere();r=a.call(this,s,new hu({color:o,toneMapped:!1}));r.type="PlaneHelper";r.plane=e;r.size=i;var l=new rd;l.setAttribute("position",new Yl([1,1,1,-1,1,1,-1,-1,1,1,1,1,-1,-1,1,1,-1,1],3));l.computeBoundingSphere();r.add(new bd(l,new Nl({color:o,opacity:.2,transparent:!0,depthWrite:!1,toneMapped:!1})));return r}_createClass2(t,[{key:"updateMatrixWorld",value:function updateMatrixWorld(e){var a=-this.plane.constant;if(1e-8>Math.abs(a))a=1e-8;this.scale.set(.5*this.size,.5*this.size,a);this.children[0].material.side=0>a?Ir:Pr;this.lookAt(this.plane.normal);_get(_getPrototypeOf(t.prototype),"updateMatrixWorld",this).call(this,e)}}]);return t}(Su),af=new vs,rf,nf,of=function(e){_inherits(t,e);var a=_createSuper(t);function t(){var e,r=0<arguments.length&&arguments[0]!==void 0?arguments[0]:new vs(0,0,1),i=1<arguments.length&&arguments[1]!==void 0?arguments[1]:new vs(0,0,0),n=2<arguments.length&&arguments[2]!==void 0?arguments[2]:1,o=3<arguments.length&&arguments[3]!==void 0?arguments[3]:16776960,s=4<arguments.length&&arguments[4]!==void 0?arguments[4]:.2*n,l=5<arguments.length&&arguments[5]!==void 0?arguments[5]:.2*s;_classCallCheck2(this,t);e=a.call(this);e.type="ArrowHelper";if(rf===void 0){rf=new rd;rf.setAttribute("position",new Yl([0,0,0,0,1,0],3));nf=new Fu(0,.5,1,5,1);nf.translate(0,-.5,0)}e.position.copy(i);e.line=new Su(rf,new hu({color:o,toneMapped:!1}));e.line.matrixAutoUpdate=!1;e.add(e.line);e.cone=new bd(nf,new Nl({color:o,toneMapped:!1}));e.cone.matrixAutoUpdate=!1;e.add(e.cone);e.setDirection(r);e.setLength(n,s,l);return e}_createClass2(t,[{key:"setDirection",value:function setDirection(e){if(.99999<e.y){this.quaternion.set(0,0,0,1)}else if(-.99999>e.y){this.quaternion.set(1,0,0,0)}else{af.set(e.z,0,-e.x).normalize();var t=Math.acos(e.y);this.quaternion.setFromAxisAngle(af,t)}}},{key:"setLength",value:function setLength(e){var t=1<arguments.length&&arguments[1]!==void 0?arguments[1]:.2*e,a=2<arguments.length&&arguments[2]!==void 0?arguments[2]:.2*t;this.line.scale.set(1,Math.max(1e-4,e-t),1);this.line.updateMatrix();this.cone.scale.set(a,t,a);this.cone.position.y=e;this.cone.updateMatrix()}},{key:"setColor",value:function setColor(e){this.line.material.color.set(e);this.cone.material.color.set(e)}},{key:"copy",value:function copy(e){_get(_getPrototypeOf(t.prototype),"copy",this).call(this,e,!1);this.line.copy(e.line);this.cone.copy(e.cone);return this}}]);return t}(vl),sf=function(e){_inherits(t,e);var a=_createSuper(t);function t(){var e,r=0<arguments.length&&arguments[0]!==void 0?arguments[0]:1;_classCallCheck2(this,t);var i=new rd;i.setAttribute("position",new Yl([0,0,0,r,0,0,0,0,0,0,r,0,0,0,0,0,0,r],3));i.setAttribute("color",new Yl([1,0,0,1,.6,0,0,1,0,.6,1,0,0,0,1,0,.6,1],3));var n=new hu({vertexColors:!0,toneMapped:!1});e=a.call(this,i,n);e.type="AxesHelper";return e}_createClass2(t,[{key:"setColors",value:function setColors(e,t,a){var r=new zl,i=this.geometry.attributes.color.array;r.set(e);r.toArray(i,0);r.toArray(i,3);r.set(t);r.toArray(i,6);r.toArray(i,9);r.set(a);r.toArray(i,12);r.toArray(i,15);this.geometry.attributes.color.needsUpdate=!0;return this}},{key:"dispose",value:function dispose(){this.geometry.dispose();this.material.dispose()}}]);return t}(Eu),lf=function(){function e(){_classCallCheck2(this,e);this.type="ShapePath";this.color=new zl;this.subPaths=[];this.currentPath=null}_createClass2(e,[{key:"moveTo",value:function moveTo(e,t){this.currentPath=new dp;this.subPaths.push(this.currentPath);this.currentPath.moveTo(e,t);return this}},{key:"lineTo",value:function lineTo(e,t){this.currentPath.lineTo(e,t);return this}},{key:"quadraticCurveTo",value:function quadraticCurveTo(e,t,a,r){this.currentPath.quadraticCurveTo(e,t,a,r);return this}},{key:"bezierCurveTo",value:function bezierCurveTo(e,t,a,r,i,n){this.currentPath.bezierCurveTo(e,t,a,r,i,n);return this}},{key:"splineThru",value:function splineThru(e){this.currentPath.splineThru(e);return this}},{key:"toShapes",value:function toShapes(e,t){function a(e){for(var t=[],a=0,r=e.length;a<r;a++){var i=e[a],n=new cp;n.curves=i.curves;t.push(n)}return t}function r(e,t){for(var a=t.length,r=!1,i=a-1,n=0;n<a;i=n++){var o=t[i],s=t[n],l=s.x-o.x,d=s.y-o.y;if(Math.abs(d)>Number.EPSILON){if(0>d){o=t[n];l=-l;s=t[i];d=-d}if(e.y<o.y||e.y>s.y)continue;if(e.y===o.y){if(e.x===o.x)return!0}else{var c=d*(e.x-o.x)-l*(e.y-o.y);if(0==c)return!0;if(0>c)continue;r=!r}}else{if(e.y!==o.y)continue;if(s.x<=e.x&&e.x<=o.x||o.x<=e.x&&e.x<=s.x)return!0}}return r}var i=pp.isClockWise,n=this.subPaths;if(0===n.length)return[];if(!0===t)return a(n);var o,s,d,c=[];if(1===n.length){s=n[0];d=new cp;d.curves=s.curves;c.push(d);return c}var u=!i(n[0].getPoints());u=e?!u:u;var p=[],m=[],g=[],f=0,h;m[f]=void 0;g[f]=[];for(var A=0,k=n.length;A<k;A++){s=n[A];h=s.getPoints();o=i(h);o=e?!o:o;if(o){if(!u&&m[f])f++;m[f]={s:new cp,p:h};m[f].s.curves=s.curves;if(u)f++;g[f]=[]}else{g[f].push({h:s,p:h[0]})}}if(!m[0])return a(n);if(1<m.length){for(var y=!1,v=[],_=0,x=m.length;_<x;_++){p[_]=[]}for(var l=0,C=m.length,R;l<C;l++){R=g[l];for(var L=0;L<R.length;L++){for(var b=R[L],S=!0,M=0;M<m.length;M++){if(r(b.p,m[M].p)){if(l!==M)v.push({froms:l,tos:M,hole:L});if(S){S=!1;p[M].push(b)}else{y=!0}}}if(S){p[l].push(b)}}}if(0<v.length){if(!y)g=p}}for(var T,E=0,w=m.length;E<w;E++){d=m[E].s;c.push(d);T=g[E];for(var P=0,I=T.length;P<I;P++){d.holes.push(T[P].h)}}return c}}]);return e}(),df=new Float32Array(1),cf=new Int32Array(df.buffer),uf=function(){function e(){_classCallCheck2(this,e)}_createClass2(e,null,[{key:"toHalfFloat",value:function toHalfFloat(t){if(65504<t){console.warn("THREE.DataUtils.toHalfFloat(): value exceeds 65504.");t=65504}df[0]=t;var a=cf[0],r=32768&a>>16,i=2047&a>>12,n=255&a>>23;if(103>n)return r;if(142<n){r|=31744;r|=(255==n?0:1)&&8388607&a;return r}if(113>n){i|=2048;r|=(i>>114-n)+(1&i>>113-n);return r}r|=n-112<<10|i>>1;r+=1&i;return r}}]);return e}();qu.create=function(e,t){console.log("THREE.Curve.create() has been deprecated");e.prototype=Object.create(qu.prototype);e.prototype.constructor=e;e.prototype.getPoint=t;return e};dp.prototype.fromPoints=function(e){console.warn("THREE.Path: .fromPoints() has been renamed to .setFromPoints().");return this.setFromPoints(e)};Vg.prototype.setColors=function(){console.error("THREE.GridHelper: setColors() has been deprecated, pass them in the constructor instead.")};Fg.prototype.update=function(){console.error("THREE.SkeletonHelper: update() no longer needs to be called.")};em.prototype.extractUrlBase=function(e){console.warn("THREE.Loader: .extractUrlBase() has been deprecated. Use THREE.LoaderUtils.extractUrlBase() instead.");return Cm.extractUrlBase(e)};em.Handlers={add:function add(){console.error("THREE.Loader: Handlers.add() has been removed. Use LoadingManager.addHandler() instead.")},get:function get(){console.error("THREE.Loader: Handlers.get() has been removed. Use LoadingManager.getHandler() instead.")}};kg.prototype.center=function(e){console.warn("THREE.Box2: .center() has been renamed to .getCenter().");return this.getCenter(e)};kg.prototype.empty=function(){console.warn("THREE.Box2: .empty() has been renamed to .isEmpty().");return this.isEmpty()};kg.prototype.isIntersectionBox=function(e){console.warn("THREE.Box2: .isIntersectionBox() has been renamed to .intersectsBox().");return this.intersectsBox(e)};kg.prototype.size=function(e){console.warn("THREE.Box2: .size() has been renamed to .getSize().");return this.getSize(e)};bs.prototype.center=function(e){console.warn("THREE.Box3: .center() has been renamed to .getCenter().");return this.getCenter(e)};bs.prototype.empty=function(){console.warn("THREE.Box3: .empty() has been renamed to .isEmpty().");return this.isEmpty()};bs.prototype.isIntersectionBox=function(e){console.warn("THREE.Box3: .isIntersectionBox() has been renamed to .intersectsBox().");return this.intersectsBox(e)};bs.prototype.isIntersectionSphere=function(e){console.warn("THREE.Box3: .isIntersectionSphere() has been renamed to .intersectsSphere().");return this.intersectsSphere(e)};bs.prototype.size=function(e){console.warn("THREE.Box3: .size() has been renamed to .getSize().");return this.getSize(e)};Bs.prototype.empty=function(){console.warn("THREE.Sphere: .empty() has been renamed to .isEmpty().");return this.isEmpty()};Nd.prototype.setFromMatrix=function(e){console.warn("THREE.Frustum: .setFromMatrix() has been renamed to .setFromProjectionMatrix().");return this.setFromProjectionMatrix(e)};Lg.prototype.center=function(e){console.warn("THREE.Line3: .center() has been renamed to .getCenter().");return this.getCenter(e)};ss.prototype.flattenToArrayOffset=function(e,t){console.warn("THREE.Matrix3: .flattenToArrayOffset() has been deprecated. Use .toArray() instead.");return this.toArray(e,t)};ss.prototype.multiplyVector3=function(e){console.warn("THREE.Matrix3: .multiplyVector3() has been removed. Use vector.applyMatrix3( matrix ) instead.");return e.applyMatrix3(this)};ss.prototype.multiplyVector3Array=function(){console.error("THREE.Matrix3: .multiplyVector3Array() has been removed.")};ss.prototype.applyToBufferAttribute=function(e){console.warn("THREE.Matrix3: .applyToBufferAttribute() has been removed. Use attribute.applyMatrix3( matrix ) instead.");return e.applyMatrix3(this)};ss.prototype.applyToVector3Array=function(){console.error("THREE.Matrix3: .applyToVector3Array() has been removed.")};ss.prototype.getInverse=function(e){console.warn("THREE.Matrix3: .getInverse() has been removed. Use matrixInv.copy( matrix ).invert(); instead.");return this.copy(e).invert()};Ys.prototype.extractPosition=function(e){console.warn("THREE.Matrix4: .extractPosition() has been renamed to .copyPosition().");return this.copyPosition(e)};Ys.prototype.flattenToArrayOffset=function(e,t){console.warn("THREE.Matrix4: .flattenToArrayOffset() has been deprecated. Use .toArray() instead.");return this.toArray(e,t)};Ys.prototype.getPosition=function(){console.warn("THREE.Matrix4: .getPosition() has been removed. Use Vector3.setFromMatrixPosition( matrix ) instead.");return new vs().setFromMatrixColumn(this,3)};Ys.prototype.setRotationFromQuaternion=function(e){console.warn("THREE.Matrix4: .setRotationFromQuaternion() has been renamed to .makeRotationFromQuaternion().");return this.makeRotationFromQuaternion(e)};Ys.prototype.multiplyToArray=function(){console.warn("THREE.Matrix4: .multiplyToArray() has been removed.")};Ys.prototype.multiplyVector3=function(e){console.warn("THREE.Matrix4: .multiplyVector3() has been removed. Use vector.applyMatrix4( matrix ) instead.");return e.applyMatrix4(this)};Ys.prototype.multiplyVector4=function(e){console.warn("THREE.Matrix4: .multiplyVector4() has been removed. Use vector.applyMatrix4( matrix ) instead.");return e.applyMatrix4(this)};Ys.prototype.multiplyVector3Array=function(){console.error("THREE.Matrix4: .multiplyVector3Array() has been removed.")};Ys.prototype.rotateAxis=function(e){console.warn("THREE.Matrix4: .rotateAxis() has been removed. Use Vector3.transformDirection( matrix ) instead.");e.transformDirection(this)};Ys.prototype.crossVector=function(e){console.warn("THREE.Matrix4: .crossVector() has been removed. Use vector.applyMatrix4( matrix ) instead.");return e.applyMatrix4(this)};Ys.prototype.translate=function(){console.error("THREE.Matrix4: .translate() has been removed.")};Ys.prototype.rotateX=function(){console.error("THREE.Matrix4: .rotateX() has been removed.")};Ys.prototype.rotateY=function(){console.error("THREE.Matrix4: .rotateY() has been removed.")};Ys.prototype.rotateZ=function(){console.error("THREE.Matrix4: .rotateZ() has been removed.")};Ys.prototype.rotateByAxis=function(){console.error("THREE.Matrix4: .rotateByAxis() has been removed.")};Ys.prototype.applyToBufferAttribute=function(e){console.warn("THREE.Matrix4: .applyToBufferAttribute() has been removed. Use attribute.applyMatrix4( matrix ) instead.");return e.applyMatrix4(this)};Ys.prototype.applyToVector3Array=function(){console.error("THREE.Matrix4: .applyToVector3Array() has been removed.")};Ys.prototype.makeFrustum=function(e,t,a,r,i,n){console.warn("THREE.Matrix4: .makeFrustum() has been removed. Use .makePerspective( left, right, top, bottom, near, far ) instead.");return this.makePerspective(e,t,r,a,i,n)};Ys.prototype.getInverse=function(e){console.warn("THREE.Matrix4: .getInverse() has been removed. Use matrixInv.copy( matrix ).invert(); instead.");return this.copy(e).invert()};Id.prototype.isIntersectionLine=function(e){console.warn("THREE.Plane: .isIntersectionLine() has been renamed to .intersectsLine().");return this.intersectsLine(e)};ys.prototype.multiplyVector3=function(e){console.warn("THREE.Quaternion: .multiplyVector3() has been removed. Use is now vector.applyQuaternion( quaternion ) instead.");return e.applyQuaternion(this)};ys.prototype.inverse=function(){console.warn("THREE.Quaternion: .inverse() has been renamed to invert().");return this.invert()};Xs.prototype.isIntersectionBox=function(e){console.warn("THREE.Ray: .isIntersectionBox() has been renamed to .intersectsBox().");return this.intersectsBox(e)};Xs.prototype.isIntersectionPlane=function(e){console.warn("THREE.Ray: .isIntersectionPlane() has been renamed to .intersectsPlane().");return this.intersectsPlane(e)};Xs.prototype.isIntersectionSphere=function(e){console.warn("THREE.Ray: .isIntersectionSphere() has been renamed to .intersectsSphere().");return this.intersectsSphere(e)};Cl.prototype.area=function(){console.warn("THREE.Triangle: .area() has been renamed to .getArea().");return this.getArea()};Cl.prototype.barycoordFromPoint=function(e,t){console.warn("THREE.Triangle: .barycoordFromPoint() has been renamed to .getBarycoord().");return this.getBarycoord(e,t)};Cl.prototype.midpoint=function(e){console.warn("THREE.Triangle: .midpoint() has been renamed to .getMidpoint().");return this.getMidpoint(e)};Cl.prototypenormal=function(e){console.warn("THREE.Triangle: .normal() has been renamed to .getNormal().");return this.getNormal(e)};Cl.prototype.plane=function(e){console.warn("THREE.Triangle: .plane() has been renamed to .getPlane().");return this.getPlane(e)};Cl.barycoordFromPoint=function(e,t,a,r,i){console.warn("THREE.Triangle: .barycoordFromPoint() has been renamed to .getBarycoord().");return Cl.getBarycoord(e,t,a,r,i)};Cl.normal=function(e,t,a,r){console.warn("THREE.Triangle: .normal() has been renamed to .getNormal().");return Cl.getNormal(e,t,a,r)};cp.prototype.extractAllPoints=function(e){console.warn("THREE.Shape: .extractAllPoints() has been removed. Use .extractPoints() instead.");return this.extractPoints(e)};cp.prototype.extrude=function(e){console.warn("THREE.Shape: .extrude() has been removed. Use ExtrudeGeometry() instead.");return new mp(this,e)};cp.prototype.makeGeometry=function(e){console.warn("THREE.Shape: .makeGeometry() has been removed. Use ShapeGeometry() instead.");return new _p(this,e)};os.prototype.fromAttribute=function(e,t,a){console.warn("THREE.Vector2: .fromAttribute() has been renamed to .fromBufferAttribute().");return this.fromBufferAttribute(e,t,a)};os.prototype.distanceToManhattan=function(e){console.warn("THREE.Vector2: .distanceToManhattan() has been renamed to .manhattanDistanceTo().");return this.manhattanDistanceTo(e)};os.prototype.lengthManhattan=function(){console.warn("THREE.Vector2: .lengthManhattan() has been renamed to .manhattanLength().");return this.manhattanLength()};vs.prototype.setEulerFromRotationMatrix=function(){console.error("THREE.Vector3: .setEulerFromRotationMatrix() has been removed. Use Euler.setFromRotationMatrix() instead.")};vs.prototype.setEulerFromQuaternion=function(){console.error("THREE.Vector3: .setEulerFromQuaternion() has been removed. Use Euler.setFromQuaternion() instead.")};vs.prototype.getPositionFromMatrix=function(e){console.warn("THREE.Vector3: .getPositionFromMatrix() has been renamed to .setFromMatrixPosition().");return this.setFromMatrixPosition(e)};vs.prototype.getScaleFromMatrix=function(e){console.warn("THREE.Vector3: .getScaleFromMatrix() has been renamed to .setFromMatrixScale().");return this.setFromMatrixScale(e)};vs.prototype.getColumnFromMatrix=function(e,t){console.warn("THREE.Vector3: .getColumnFromMatrix() has been renamed to .setFromMatrixColumn().");return this.setFromMatrixColumn(t,e)};vs.prototype.applyProjection=function(e){console.warn("THREE.Vector3: .applyProjection() has been removed. Use .applyMatrix4( m ) instead.");return this.applyMatrix4(e)};vs.prototype.fromAttribute=function(e,t,a){console.warn("THREE.Vector3: .fromAttribute() has been renamed to .fromBufferAttribute().");return this.fromBufferAttribute(e,t,a)};vs.prototype.distanceToManhattan=function(e){console.warn("THREE.Vector3: .distanceToManhattan() has been renamed to .manhattanDistanceTo().");return this.manhattanDistanceTo(e)};vs.prototype.lengthManhattan=function(){console.warn("THREE.Vector3: .lengthManhattan() has been renamed to .manhattanLength().");return this.manhattanLength()};ms.prototype.fromAttribute=function(e,t,a){console.warn("THREE.Vector4: .fromAttribute() has been renamed to .fromBufferAttribute().");return this.fromBufferAttribute(e,t,a)};ms.prototype.lengthManhattan=function(){console.warn("THREE.Vector4: .lengthManhattan() has been renamed to .manhattanLength().");return this.manhattanLength()};vl.prototype.getChildByName=function(e){console.warn("THREE.Object3D: .getChildByName() has been renamed to .getObjectByName().");return this.getObjectByName(e)};vl.prototype.renderDepth=function(){console.warn("THREE.Object3D: .renderDepth has been removed. Use .renderOrder, instead.")};vl.prototype.translate=function(e,t){console.warn("THREE.Object3D: .translate() has been removed. Use .translateOnAxis( axis, distance ) instead.");return this.translateOnAxis(t,e)};vl.prototype.getWorldRotation=function(){console.error("THREE.Object3D: .getWorldRotation() has been removed. Use THREE.Object3D.getWorldQuaternion( target ) instead.")};vl.prototype.applyMatrix=function(e){console.warn("THREE.Object3D: .applyMatrix() has been renamed to .applyMatrix4().");return this.applyMatrix4(e)};Object.defineProperties(vl.prototype,{eulerOrder:{get:function get(){console.warn("THREE.Object3D: .eulerOrder is now .rotation.order.");return this.rotation.order},set:function set(e){console.warn("THREE.Object3D: .eulerOrder is now .rotation.order.");this.rotation.order=e}},useQuaternion:{get:function get(){console.warn("THREE.Object3D: .useQuaternion has been removed. The library now uses quaternions by default.")},set:function set(){console.warn("THREE.Object3D: .useQuaternion has been removed. The library now uses quaternions by default.")}}});bd.prototype.setDrawMode=function(){console.error("THREE.Mesh: .setDrawMode() has been removed. The renderer now always assumes THREE.TrianglesDrawMode. Transform your geometry via BufferGeometryUtils.toTrianglesDrawMode() if necessary.")};Object.defineProperties(bd.prototype,{drawMode:{get:function get(){console.error("THREE.Mesh: .drawMode has been removed. The renderer now always assumes THREE.TrianglesDrawMode.");return mo},set:function set(){console.error("THREE.Mesh: .drawMode has been removed. The renderer now always assumes THREE.TrianglesDrawMode. Transform your geometry via BufferGeometryUtils.toTrianglesDrawMode() if necessary.")}}});iu.prototype.initBones=function(){console.error("THREE.SkinnedMesh: initBones() has been removed.")};wd.prototype.setLens=function(e,t){console.warn("THREE.PerspectiveCamera.setLens is deprecated. Use .setFocalLength and .filmGauge for a photographic setup.");if(t!==void 0)this.filmGauge=t;this.setFocalLength(e)};Object.defineProperties(dm.prototype,{onlyShadow:{set:function set(){console.warn("THREE.Light: .onlyShadow has been removed.")}},shadowCameraFov:{set:function set(e){console.warn("THREE.Light: .shadowCameraFov is now .shadow.camera.fov.");this.shadow.camera.fov=e}},shadowCameraLeft:{set:function set(e){console.warn("THREE.Light: .shadowCameraLeft is now .shadow.camera.left.");this.shadow.camera.left=e}},shadowCameraRight:{set:function set(e){console.warn("THREE.Light: .shadowCameraRight is now .shadow.camera.right.");this.shadow.camera.right=e}},shadowCameraTop:{set:function set(e){console.warn("THREE.Light: .shadowCameraTop is now .shadow.camera.top.");this.shadow.camera.top=e}},shadowCameraBottom:{set:function set(e){console.warn("THREE.Light: .shadowCameraBottom is now .shadow.camera.bottom.");this.shadow.camera.bottom=e}},shadowCameraNear:{set:function set(e){console.warn("THREE.Light: .shadowCameraNear is now .shadow.camera.near.");this.shadow.camera.near=e}},shadowCameraFar:{set:function set(e){console.warn("THREE.Light: .shadowCameraFar is now .shadow.camera.far.");this.shadow.camera.far=e}},shadowCameraVisible:{set:function set(){console.warn("THREE.Light: .shadowCameraVisible has been removed. Use new THREE.CameraHelper( light.shadow.camera ) instead.")}},shadowBias:{set:function set(e){console.warn("THREE.Light: .shadowBias is now .shadow.bias.");this.shadow.bias=e}},shadowDarkness:{set:function set(){console.warn("THREE.Light: .shadowDarkness has been removed.")}},shadowMapWidth:{set:function set(e){console.warn("THREE.Light: .shadowMapWidth is now .shadow.mapSize.width.");this.shadow.mapSize.width=e}},shadowMapHeight:{set:function set(e){console.warn("THREE.Light: .shadowMapHeight is now .shadow.mapSize.height.");this.shadow.mapSize.height=e}}});Object.defineProperties(Bl.prototype,{length:{get:function get(){console.warn("THREE.BufferAttribute: .length has been deprecated. Use .count instead.");return this.array.length}},dynamic:{get:function get(){console.warn("THREE.BufferAttribute: .dynamic has been deprecated. Use .usage instead.");return this.usage===Wo},set:function set(){console.warn("THREE.BufferAttribute: .dynamic has been deprecated. Use .usage instead.");this.setUsage(Wo)}}});Bl.prototype.setDynamic=function(e){console.warn("THREE.BufferAttribute: .setDynamic() has been deprecated. Use .setUsage() instead.");this.setUsage(!0===e?Wo:Vo);return this};Bl.prototype.copyIndicesArray=function(){console.error("THREE.BufferAttribute: .copyIndicesArray() has been removed.")},Bl.prototype.setArray=function(){console.error("THREE.BufferAttribute: .setArray has been removed. Use BufferGeometry .setAttribute to replace/resize attribute buffers")};rd.prototype.addIndex=function(e){console.warn("THREE.BufferGeometry: .addIndex() has been renamed to .setIndex().");this.setIndex(e)};rd.prototype.addAttribute=function(e,t){console.warn("THREE.BufferGeometry: .addAttribute() has been renamed to .setAttribute().");if(!(t&&t.isBufferAttribute)&&!(t&&t.isInterleavedBufferAttribute)){console.warn("THREE.BufferGeometry: .addAttribute() now expects ( name, attribute ).");return this.setAttribute(e,new Bl(arguments[1],arguments[2]))}if("index"===e){console.warn("THREE.BufferGeometry.addAttribute: Use .setIndex() for index attribute.");this.setIndex(t);return this}return this.setAttribute(e,t)};rd.prototype.addDrawCall=function(e,t,a){if(a!==void 0){console.warn("THREE.BufferGeometry: .addDrawCall() no longer supports indexOffset.")}console.warn("THREE.BufferGeometry: .addDrawCall() is now .addGroup().");this.addGroup(e,t)};rd.prototype.clearDrawCalls=function(){console.warn("THREE.BufferGeometry: .clearDrawCalls() is now .clearGroups().");this.clearGroups()};rd.prototype.computeOffsets=function(){console.warn("THREE.BufferGeometry: .computeOffsets() has been removed.")};rd.prototype.removeAttribute=function(e){console.warn("THREE.BufferGeometry: .removeAttribute() has been renamed to .deleteAttribute().");return this.deleteAttribute(e)};rd.prototype.applyMatrix=function(e){console.warn("THREE.BufferGeometry: .applyMatrix() has been renamed to .applyMatrix4().");return this.applyMatrix4(e)};Object.defineProperties(rd.prototype,{drawcalls:{get:function get(){console.error("THREE.BufferGeometry: .drawcalls has been renamed to .groups.");return this.groups}},offsets:{get:function get(){console.warn("THREE.BufferGeometry: .offsets has been renamed to .groups.");return this.groups}}});Pc.prototype.setDynamic=function(e){console.warn("THREE.InterleavedBuffer: .setDynamic() has been deprecated. Use .setUsage() instead.");this.setUsage(!0===e?Wo:Vo);return this};Pc.prototype.setArray=function(){console.error("THREE.InterleavedBuffer: .setArray has been removed. Use BufferGeometry .setAttribute to replace/resize attribute buffers")};mp.prototype.getArrays=function(){console.error("THREE.ExtrudeGeometry: .getArrays() has been removed.")};mp.prototype.addShapeList=function(){console.error("THREE.ExtrudeGeometry: .addShapeList() has been removed.")};mp.prototype.addShape=function(){console.error("THREE.ExtrudeGeometry: .addShape() has been removed.")};Lc.prototype.dispose=function(){console.error("THREE.Scene: .dispose() has been removed.")};bg.prototype.onUpdate=function(){console.warn("THREE.Uniform: .onUpdate() has been removed. Use object.onBeforeRender() instead.");return this};Object.defineProperties(Ll.prototype,{wrapAround:{get:function get(){console.warn("THREE.Material: .wrapAround has been removed.")},set:function set(){console.warn("THREE.Material: .wrapAround has been removed.")}},overdraw:{get:function get(){console.warn("THREE.Material: .overdraw has been removed.")},set:function set(){console.warn("THREE.Material: .overdraw has been removed.")}},wrapRGB:{get:function get(){console.warn("THREE.Material: .wrapRGB has been removed.");return new zl}},shading:{get:function get(){console.error("THREE."+this.type+": .shading has been removed. Use the boolean .flatShading instead.")},set:function set(e){console.warn("THREE."+this.type+": .shading has been removed. Use the boolean .flatShading instead.");this.flatShading=e===zr}},stencilMask:{get:function get(){console.warn("THREE."+this.type+": .stencilMask has been removed. Use .stencilFuncMask instead.");return this.stencilFuncMask},set:function set(e){console.warn("THREE."+this.type+": .stencilMask has been removed. Use .stencilFuncMask instead.");this.stencilFuncMask=e}},vertexTangents:{get:function get(){console.warn("THREE."+this.type+": .vertexTangents has been removed.")},set:function set(){console.warn("THREE."+this.type+": .vertexTangents has been removed.")}}});Object.defineProperties(Td.prototype,{derivatives:{get:function get(){console.warn("THREE.ShaderMaterial: .derivatives has been moved to .extensions.derivatives.");return this.extensions.derivatives},set:function set(e){console.warn("THREE. ShaderMaterial: .derivatives has been moved to .extensions.derivatives.");this.extensions.derivatives=e}}});Nt.prototype.clearTarget=function(e,t,a,r){console.warn("THREE.WebGLRenderer: .clearTarget() has been deprecated. Use .setRenderTarget() and .clear() instead.");this.setRenderTarget(e);this.clear(t,a,r)};Nt.prototype.animate=function(e){console.warn("THREE.WebGLRenderer: .animate() is now .setAnimationLoop().");this.setAnimationLoop(e)};Nt.prototype.getCurrentRenderTarget=function(){console.warn("THREE.WebGLRenderer: .getCurrentRenderTarget() is now .getRenderTarget().");return this.getRenderTarget()};Nt.prototype.getMaxAnisotropy=function(){console.warn("THREE.WebGLRenderer: .getMaxAnisotropy() is now .capabilities.getMaxAnisotropy().");return this.capabilities.getMaxAnisotropy()};Nt.prototype.getPrecision=function(){console.warn("THREE.WebGLRenderer: .getPrecision() is now .capabilities.precision.");return this.capabilities.precision};Nt.prototype.resetGLState=function(){console.warn("THREE.WebGLRenderer: .resetGLState() is now .state.reset().");return this.state.reset()};Nt.prototype.supportsFloatTextures=function(){console.warn("THREE.WebGLRenderer: .supportsFloatTextures() is now .extensions.get( 'OES_texture_float' ).");return this.extensions.get("OES_texture_float")};Nt.prototype.supportsHalfFloatTextures=function(){console.warn("THREE.WebGLRenderer: .supportsHalfFloatTextures() is now .extensions.get( 'OES_texture_half_float' ).");return this.extensions.get("OES_texture_half_float")};Nt.prototype.supportsStandardDerivatives=function(){console.warn("THREE.WebGLRenderer: .supportsStandardDerivatives() is now .extensions.get( 'OES_standard_derivatives' ).");return this.extensions.get("OES_standard_derivatives")};Nt.prototype.supportsCompressedTextureS3TC=function(){console.warn("THREE.WebGLRenderer: .supportsCompressedTextureS3TC() is now .extensions.get( 'WEBGL_compressed_texture_s3tc' ).");return this.extensions.get("WEBGL_compressed_texture_s3tc")};Nt.prototype.supportsCompressedTexturePVRTC=function(){console.warn("THREE.WebGLRenderer: .supportsCompressedTexturePVRTC() is now .extensions.get( 'WEBGL_compressed_texture_pvrtc' ).");return this.extensions.get("WEBGL_compressed_texture_pvrtc")};Nt.prototype.supportsBlendMinMax=function(){console.warn("THREE.WebGLRenderer: .supportsBlendMinMax() is now .extensions.get( 'EXT_blend_minmax' ).");return this.extensions.get("EXT_blend_minmax")};Nt.prototype.supportsVertexTextures=function(){console.warn("THREE.WebGLRenderer: .supportsVertexTextures() is now .capabilities.vertexTextures.");return this.capabilities.vertexTextures};Nt.prototype.supportsInstancedArrays=function(){console.warn("THREE.WebGLRenderer: .supportsInstancedArrays() is now .extensions.get( 'ANGLE_instanced_arrays' ).");return this.extensions.get("ANGLE_instanced_arrays")};Nt.prototype.enableScissorTest=function(e){console.warn("THREE.WebGLRenderer: .enableScissorTest() is now .setScissorTest().");this.setScissorTest(e)};Nt.prototype.initMaterial=function(){console.warn("THREE.WebGLRenderer: .initMaterial() has been removed.")};Nt.prototype.addPrePlugin=function(){console.warn("THREE.WebGLRenderer: .addPrePlugin() has been removed.")};Nt.prototype.addPostPlugin=function(){console.warn("THREE.WebGLRenderer: .addPostPlugin() has been removed.")};Nt.prototype.updateShadowMap=function(){console.warn("THREE.WebGLRenderer: .updateShadowMap() has been removed.")};Nt.prototype.setFaceCulling=function(){console.warn("THREE.WebGLRenderer: .setFaceCulling() has been removed.")};Nt.prototype.allocTextureUnit=function(){console.warn("THREE.WebGLRenderer: .allocTextureUnit() has been removed.")};Nt.prototype.setTexture=function(){console.warn("THREE.WebGLRenderer: .setTexture() has been removed.")};Nt.prototype.setTexture2D=function(){console.warn("THREE.WebGLRenderer: .setTexture2D() has been removed.")};Nt.prototype.setTextureCube=function(){console.warn("THREE.WebGLRenderer: .setTextureCube() has been removed.")};Nt.prototype.getActiveMipMapLevel=function(){console.warn("THREE.WebGLRenderer: .getActiveMipMapLevel() is now .getActiveMipmapLevel().");return this.getActiveMipmapLevel()};Object.defineProperties(Nt.prototype,{shadowMapEnabled:{get:function get(){return this.shadowMap.enabled},set:function set(e){console.warn("THREE.WebGLRenderer: .shadowMapEnabled is now .shadowMap.enabled.");this.shadowMap.enabled=e}},shadowMapType:{get:function get(){return this.shadowMap.type},set:function set(e){console.warn("THREE.WebGLRenderer: .shadowMapType is now .shadowMap.type.");this.shadowMap.type=e}},shadowMapCullFace:{get:function get(){console.warn("THREE.WebGLRenderer: .shadowMapCullFace has been removed. Set Material.shadowSide instead.")},set:function set(){console.warn("THREE.WebGLRenderer: .shadowMapCullFace has been removed. Set Material.shadowSide instead.")}},context:{get:function get(){console.warn("THREE.WebGLRenderer: .context has been removed. Use .getContext() instead.");return this.getContext()}},vr:{get:function get(){console.warn("THREE.WebGLRenderer: .vr has been renamed to .xr");return this.xr}},gammaInput:{get:function get(){console.warn("THREE.WebGLRenderer: .gammaInput has been removed. Set the encoding for textures via Texture.encoding instead.");return!1},set:function set(){console.warn("THREE.WebGLRenderer: .gammaInput has been removed. Set the encoding for textures via Texture.encoding instead.")}},gammaOutput:{get:function get(){console.warn("THREE.WebGLRenderer: .gammaOutput has been removed. Set WebGLRenderer.outputEncoding instead.");return!1},set:function set(e){console.warn("THREE.WebGLRenderer: .gammaOutput has been removed. Set WebGLRenderer.outputEncoding instead.");this.outputEncoding=!0===e?yo:ho}},toneMappingWhitePoint:{get:function get(){console.warn("THREE.WebGLRenderer: .toneMappingWhitePoint has been removed.");return 1},set:function set(){console.warn("THREE.WebGLRenderer: .toneMappingWhitePoint has been removed.")}}});Object.defineProperties(Rt.prototype,{cullFace:{get:function get(){console.warn("THREE.WebGLRenderer: .shadowMap.cullFace has been removed. Set Material.shadowSide instead.")},set:function set(){console.warn("THREE.WebGLRenderer: .shadowMap.cullFace has been removed. Set Material.shadowSide instead.")}},renderReverseSided:{get:function get(){console.warn("THREE.WebGLRenderer: .shadowMap.renderReverseSided has been removed. Set Material.shadowSide instead.")},set:function set(){console.warn("THREE.WebGLRenderer: .shadowMap.renderReverseSided has been removed. Set Material.shadowSide instead.")}},renderSingleSided:{get:function get(){console.warn("THREE.WebGLRenderer: .shadowMap.renderSingleSided has been removed. Set Material.shadowSide instead.")},set:function set(){console.warn("THREE.WebGLRenderer: .shadowMap.renderSingleSided has been removed. Set Material.shadowSide instead.")}}});Object.defineProperties(gs.prototype,{wrapS:{get:function get(){console.warn("THREE.WebGLRenderTarget: .wrapS is now .texture.wrapS.");return this.texture.wrapS},set:function set(e){console.warn("THREE.WebGLRenderTarget: .wrapS is now .texture.wrapS.");this.texture.wrapS=e}},wrapT:{get:function get(){console.warn("THREE.WebGLRenderTarget: .wrapT is now .texture.wrapT.");return this.texture.wrapT},set:function set(e){console.warn("THREE.WebGLRenderTarget: .wrapT is now .texture.wrapT.");this.texture.wrapT=e}},magFilter:{get:function get(){console.warn("THREE.WebGLRenderTarget: .magFilter is now .texture.magFilter.");return this.texture.magFilter},set:function set(e){console.warn("THREE.WebGLRenderTarget: .magFilter is now .texture.magFilter.");this.texture.magFilter=e}},minFilter:{get:function get(){console.warn("THREE.WebGLRenderTarget: .minFilter is now .texture.minFilter.");return this.texture.minFilter},set:function set(e){console.warn("THREE.WebGLRenderTarget: .minFilter is now .texture.minFilter.");this.texture.minFilter=e}},anisotropy:{get:function get(){console.warn("THREE.WebGLRenderTarget: .anisotropy is now .texture.anisotropy.");return this.texture.anisotropy},set:function set(e){console.warn("THREE.WebGLRenderTarget: .anisotropy is now .texture.anisotropy.");this.texture.anisotropy=e}},offset:{get:function get(){console.warn("THREE.WebGLRenderTarget: .offset is now .texture.offset.");return this.texture.offset},set:function set(e){console.warn("THREE.WebGLRenderTarget: .offset is now .texture.offset.");this.texture.offset=e}},repeat:{get:function get(){console.warn("THREE.WebGLRenderTarget: .repeat is now .texture.repeat.");return this.texture.repeat},set:function set(e){console.warn("THREE.WebGLRenderTarget: .repeat is now .texture.repeat.");this.texture.repeat=e}},format:{get:function get(){console.warn("THREE.WebGLRenderTarget: .format is now .texture.format.");return this.texture.format},set:function set(e){console.warn("THREE.WebGLRenderTarget: .format is now .texture.format.");this.texture.format=e}},type:{get:function get(){console.warn("THREE.WebGLRenderTarget: .type is now .texture.type.");return this.texture.type},set:function set(e){console.warn("THREE.WebGLRenderTarget: .type is now .texture.type.");this.texture.type=e}},generateMipmaps:{get:function get(){console.warn("THREE.WebGLRenderTarget: .generateMipmaps is now .texture.generateMipmaps.");return this.texture.generateMipmaps},set:function set(e){console.warn("THREE.WebGLRenderTarget: .generateMipmaps is now .texture.generateMipmaps.");this.texture.generateMipmaps=e}}});Km.prototype.load=function(e){console.warn("THREE.Audio: .load has been deprecated. Use THREE.AudioLoader instead.");var t=this,a=new Bm;a.load(e,function(e){t.setBuffer(e)});return this};ig.prototype.getData=function(){console.warn("THREE.AudioAnalyser: .getData() is now .getFrequencyData().");return this.getFrequencyData()};Ad.prototype.updateCubeMap=function(e,t){console.warn("THREE.CubeCamera: .updateCubeMap() is now .update().");return this.update(e,t)};Ad.prototype.clear=function(e,t,a,r){console.warn("THREE.CubeCamera: .clear() is now .renderTarget.clear().");return this.renderTarget.clear(e,t,a,r)};cs.crossOrigin=void 0;cs.loadTexture=function(e,t,a,r){console.warn("THREE.ImageUtils.loadTexture has been deprecated. Use THREE.TextureLoader() instead.");var i=new lm;i.setCrossOrigin(this.crossOrigin);var n=i.load(e,a,void 0,r);if(t)n.mapping=t;return n};cs.loadTextureCube=function(e,t,a,r){console.warn("THREE.ImageUtils.loadTextureCube has been deprecated. Use THREE.CubeTextureLoader() instead.");var i=new om;i.setCrossOrigin(this.crossOrigin);var n=i.load(e,a,void 0,r);if(t)n.mapping=t;return n};cs.loadCompressedTexture=function(){console.error("THREE.ImageUtils.loadCompressedTexture has been removed. Use THREE.DDSLoader instead.")};cs.loadCompressedTextureCube=function(){console.error("THREE.ImageUtils.loadCompressedTextureCube has been removed. Use THREE.DDSLoader instead.")};if("undefined"!=typeof __THREE_DEVTOOLS__){__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("register",{detail:{revision:br}}))}if("undefined"!=typeof window){if(window.__THREE__){console.warn("WARNING: Multiple instances of Three.js being imported.")}else{window.__THREE__=br}}var pf=Object.freeze({__proto__:null,ACESFilmicToneMapping:xi,AddEquation:Vr,AddOperation:fi,AdditiveAnimationBlendMode:po,AdditiveBlending:Br,AlphaFormat:en,AlwaysDepth:oi,AlwaysStencilFunc:Ho,AmbientLight:Tm,AmbientLightProbe:Gm,AnimationClip:Jp,AnimationLoader:rm,AnimationMixer:xg,AnimationObjectGroup:vg,AnimationUtils:Fp,ArcCurve:Yu,ArrayCamera:Sc,ArrowHelper:of,Audio:Km,AudioAnalyser:ig,AudioContext:Om,AudioListener:Qm,AudioLoader:Bm,AxesHelper:sf,AxisHelper:function(e){console.warn("THREE.AxisHelper has been renamed to THREE.AxesHelper.");return new sf(e)},BackSide:Ir,BasicDepthPacking:Mo,BasicShadowMap:kr,BinaryTextureLoader:function(e){console.warn("THREE.BinaryTextureLoader has been renamed to THREE.DataTextureLoader.");return new sm(e)},Bone:nu,BooleanKeyframeTrack:Vp,BoundingBoxHelper:function(e,t){console.warn("THREE.BoundingBoxHelper has been deprecated. Creating a THREE.BoxHelper instead.");return new $g(e,t)},Box2:kg,Box3:bs,Box3Helper:ef,BoxBufferGeometry:Sd,BoxGeometry:Sd,BoxHelper:$g,BufferAttribute:Bl,BufferGeometry:rd,BufferGeometryLoader:Lm,ByteType:Vi,Cache:Qp,Camera:Ed,CameraHelper:Qg,CanvasRenderer:function(){console.error("THREE.CanvasRenderer has been removed")},CanvasTexture:zu,CatmullRomCurve3:$u,CineonToneMapping:_i,CircleBufferGeometry:Nu,CircleGeometry:Nu,ClampToEdgeWrapping:Ri,Clock:qm,Color:zl,ColorKeyframeTrack:Wp,CompressedTexture:Du,CompressedTextureLoader:im,ConeBufferGeometry:Ou,ConeGeometry:Ou,CubeCamera:Ad,CubeReflectionMapping:Mi,CubeRefractionMapping:Ti,CubeTexture:kd,CubeTextureLoader:om,CubeUVReflectionMapping:Ai,CubeUVRefractionMapping:ki,CubicBezierCurve:ep,CubicBezierCurve3:tp,CubicInterpolant:Bp,CullFaceBack:Er,CullFaceFront:wr,CullFaceFrontBack:Ar,CullFaceNone:Tr,Curve:qu,CurvePath:lp,CustomBlending:Hr,CustomToneMapping:bi,CylinderBufferGeometry:Fu,CylinderGeometry:Fu,Cylindrical:wg,DataTexture:ou,DataTexture2DArray:oc,DataTexture3D:sc,DataTextureLoader:sm,DataUtils:uf,DecrementStencilOp:Lo,DecrementWrapStencilOp:Io,DefaultLoadingManager:$p,DepthFormat:sn,DepthStencilFormat:ln,DepthTexture:wc,DirectionalLight:Mm,DirectionalLightHelper:Yg,DiscreteInterpolant:Gp,DodecahedronBufferGeometry:Uu,DodecahedronGeometry:Uu,DoubleSide:Dr,DstAlphaFactor:ei,DstColorFactor:ai,DynamicBufferAttribute:function(e,t){console.warn("THREE.DynamicBufferAttribute has been removed. Use new THREE.BufferAttribute().setUsage( THREE.DynamicDrawUsage ) instead.");return new Bl(e,t).setUsage(Wo)},DynamicCopyUsage:Jo,DynamicDrawUsage:Wo,DynamicReadUsage:Xo,EdgesGeometry:ju,EdgesHelper:function(e,t){console.warn("THREE.EdgesHelper has been removed. Use THREE.EdgesGeometry instead.");return new Eu(new ju(e.geometry),new hu({color:t!==void 0?t:16777215}))},EllipseCurve:Xu,EqualDepth:di,EqualStencilFunc:Fo,EquirectangularReflectionMapping:Ei,EquirectangularRefractionMapping:wi,Euler:rl,EventDispatcher:es,ExtrudeBufferGeometry:mp,ExtrudeGeometry:mp,FaceColors:1,FileLoader:am,FlatShading:zr,Float16BufferAttribute:Xl,Float32Attribute:function(e,t){console.warn("THREE.Float32Attribute has been removed. Use new THREE.Float32BufferAttribute() instead.");return new Yl(e,t)},Float32BufferAttribute:Yl,Float64Attribute:function(e,t){console.warn("THREE.Float64Attribute has been removed. Use new THREE.Float64BufferAttribute() instead.");return new Zl(e,t)},Float64BufferAttribute:Zl,FloatType:Yi,Fog:Rc,FogExp2:Cc,Font:function(){console.error("THREE.Font has been moved to /examples/jsm/loaders/FontLoader.js")},FontLoader:function(){console.error("THREE.FontLoader has been moved to /examples/jsm/loaders/FontLoader.js")},FrontSide:Pr,Frustum:Nd,GLBufferAttribute:Mg,GLSL1:Ko,GLSL3:$o,GammaEncoding:vo,GreaterDepth:ui,GreaterEqualDepth:ci,GreaterEqualStencilFunc:Go,GreaterStencilFunc:Bo,GridHelper:Vg,Group:Mc,HalfFloatType:Zi,HemisphereLight:cm,HemisphereLightHelper:Hg,HemisphereLightProbe:Um,IcosahedronBufferGeometry:fp,IcosahedronGeometry:fp,ImageBitmapLoader:Nm,ImageLoader:nm,ImageUtils:cs,ImmediateRenderObject:function(){console.error("THREE.ImmediateRenderObject has been removed.")},IncrementStencilOp:Ro,IncrementWrapStencilOp:Po,InstancedBufferAttribute:cu,InstancedBufferGeometry:Rm,InstancedInterleavedBuffer:Sg,InstancedMesh:fu,Int16Attribute:function(e,t){console.warn("THREE.Int16Attribute has been removed. Use new THREE.Int16BufferAttribute() instead.");return new Vl(e,t)},Int16BufferAttribute:Vl,Int32Attribute:function(e,t){console.warn("THREE.Int32Attribute has been removed. Use new THREE.Int32BufferAttribute() instead.");return new jl(e,t)},Int32BufferAttribute:jl,Int8Attribute:function(e,t){console.warn("THREE.Int8Attribute has been removed. Use new THREE.Int8BufferAttribute() instead.");return new Ul(e,t)},Int8BufferAttribute:Ul,IntType:qi,InterleavedBuffer:Pc,InterleavedBufferAttribute:Dc,Interpolant:Op,InterpolateDiscrete:io,InterpolateLinear:no,InterpolateSmooth:oo,InvertStencilOp:Do,JSONLoader:function(){console.error("THREE.JSONLoader has been removed.")},KeepStencilOp:ko,KeyframeTrack:Hp,LOD:Kc,LatheBufferGeometry:hp,LatheGeometry:hp,Layers:il,LensFlare:function(){console.error("THREE.LensFlare has been moved to /examples/jsm/objects/Lensflare.js")},LessDepth:si,LessEqualDepth:li,LessEqualStencilFunc:Oo,LessStencilFunc:No,Light:dm,LightProbe:Am,Line:Su,Line3:Lg,LineBasicMaterial:hu,LineCurve:ap,LineCurve3:rp,LineDashedMaterial:zp,LineLoop:wu,LinePieces:1,LineSegments:Eu,LineStrip:0,LinearEncoding:ho,LinearFilter:Fi,LinearInterpolant:Up,LinearMipMapLinearFilter:Gi,LinearMipMapNearestFilter:Bi,LinearMipmapLinearFilter:Ui,LinearMipmapNearestFilter:Oi,LinearToneMapping:yi,Loader:em,LoaderUtils:Cm,LoadingManager:Kp,LoopOnce:to,LoopPingPong:ro,LoopRepeat:ao,LuminanceAlphaFormat:nn,LuminanceFormat:rn,MOUSE:Sr,Material:Ll,MaterialLoader:km,Math:ns,MathUtils:ns,Matrix3:ss,Matrix4:Ys,MaxEquation:Xr,Mesh:bd,MeshBasicMaterial:Nl,MeshDepthMaterial:xc,MeshDistanceMaterial:bc,MeshFaceMaterial:function(e){console.warn("THREE.MeshFaceMaterial has been removed. Use an Array instead.");return e},MeshLambertMaterial:Ip,MeshMatcapMaterial:Dp,MeshNormalMaterial:Pp,MeshPhongMaterial:Rp,MeshPhysicalMaterial:Cp,MeshStandardMaterial:kp,MeshToonMaterial:Lp,MinEquation:qr,MirroredRepeatWrapping:Li,MixOperation:gi,MultiMaterial:function(){var e=0<arguments.length&&arguments[0]!==void 0?arguments[0]:[];console.warn("THREE.MultiMaterial has been removed. Use an Array instead.");e.isMultiMaterial=!0;e.materials=e;e.clone=function(){return e.slice()};return e},MultiplyBlending:Gr,MultiplyOperation:mi,NearestFilter:Pi,NearestMipMapLinearFilter:Ni,NearestMipMapNearestFilter:Di,NearestMipmapLinearFilter:zi,NearestMipmapNearestFilter:Ii,NeverDepth:ni,NeverStencilFunc:zo,NoBlending:Fr,NoColors:0,NoToneMapping:hi,NormalAnimationBlendMode:uo,NormalBlending:Or,NotEqualDepth:pi,NotEqualStencilFunc:Uo,NumberKeyframeTrack:jp,Object3D:vl,ObjectLoader:Pm,ObjectSpaceNormalMap:wo,OctahedronBufferGeometry:yp,OctahedronGeometry:yp,OneFactor:Zr,OneMinusDstAlphaFactor:ti,OneMinusDstColorFactor:ri,OneMinusSrcAlphaFactor:$r,OneMinusSrcColorFactor:Qr,OrthographicCamera:Gd,PCFShadowMap:Cr,PCFSoftShadowMap:Rr,PMREMGenerator:nc,ParametricGeometry:function(){console.error("THREE.ParametricGeometry has been moved to /examples/jsm/geometries/ParametricGeometry.js");return new rd},Particle:function(e){console.warn("THREE.Particle has been renamed to THREE.Sprite.");return new Zc(e)},ParticleBasicMaterial:function(e){console.warn("THREE.ParticleBasicMaterial has been renamed to THREE.PointsMaterial.");return new Au(e)},ParticleSystem:function(e,t){console.warn("THREE.ParticleSystem has been renamed to THREE.Points.");return new Pu(e,t)},ParticleSystemMaterial:function(e){console.warn("THREE.ParticleSystemMaterial has been renamed to THREE.PointsMaterial.");return new Au(e)},Path:dp,PerspectiveCamera:wd,Plane:Id,PlaneBufferGeometry:Fd,PlaneGeometry:Fd,PlaneHelper:tf,PointCloud:function(e,t){console.warn("THREE.PointCloud has been renamed to THREE.Points.");return new Pu(e,t)},PointCloudMaterial:function(e){console.warn("THREE.PointCloudMaterial has been renamed to THREE.PointsMaterial.");return new Au(e)},PointLight:bm,PointLightHelper:Og,Points:Pu,PointsMaterial:Au,PolarGridHelper:Wg,PolyhedronBufferGeometry:Bu,PolyhedronGeometry:Bu,PositionalAudio:rg,PropertyBinding:yg,PropertyMixer:ng,QuadraticBezierCurve:ip,QuadraticBezierCurve3:np,Quaternion:ys,QuaternionKeyframeTrack:Xp,QuaternionLinearInterpolant:qp,REVISION:br,RGBADepthPacking:To,RGBAFormat:an,RGBAIntegerFormat:gn,RGBA_ASTC_10x10_Format:Fn,RGBA_ASTC_10x5_Format:Dn,RGBA_ASTC_10x6_Format:zn,RGBA_ASTC_10x8_Format:Nn,RGBA_ASTC_12x10_Format:On,RGBA_ASTC_12x12_Format:Bn,RGBA_ASTC_4x4_Format:wn,RGBA_ASTC_5x4_Format:An,RGBA_ASTC_5x5_Format:kn,RGBA_ASTC_6x5_Format:Cn,RGBA_ASTC_6x6_Format:Rn,RGBA_ASTC_8x5_Format:Ln,RGBA_ASTC_8x6_Format:Pn,RGBA_ASTC_8x8_Format:In,RGBA_BPTC_Format:Un,RGBA_ETC2_EAC_Format:En,RGBA_PVRTC_2BPPV1_Format:Sn,RGBA_PVRTC_4BPPV1_Format:bn,RGBA_S3TC_DXT1_Format:hn,RGBA_S3TC_DXT3_Format:yn,RGBA_S3TC_DXT5_Format:vn,RGBDEncoding:So,RGBEEncoding:_o,RGBEFormat:on,RGBFormat:tn,RGBIntegerFormat:mn,RGBM16Encoding:bo,RGBM7Encoding:xo,RGB_ETC1_Format:Mn,RGB_ETC2_Format:Tn,RGB_PVRTC_2BPPV1_Format:xn,RGB_PVRTC_4BPPV1_Format:_n,RGB_S3TC_DXT1_Format:fn,RGFormat:un,RGIntegerFormat:pn,RawShaderMaterial:Hd,Ray:Xs,Raycaster:Tg,RectAreaLight:Em,RedFormat:dn,RedIntegerFormat:cn,ReinhardToneMapping:vi,RepeatWrapping:Ci,ReplaceStencilOp:Co,ReverseSubtractEquation:jr,RingBufferGeometry:vp,RingGeometry:vp,SRGB8_ALPHA8_ASTC_10x10_Format:Kn,SRGB8_ALPHA8_ASTC_10x5_Format:Zn,SRGB8_ALPHA8_ASTC_10x6_Format:Jn,SRGB8_ALPHA8_ASTC_10x8_Format:Qn,SRGB8_ALPHA8_ASTC_12x10_Format:$n,SRGB8_ALPHA8_ASTC_12x12_Format:eo,SRGB8_ALPHA8_ASTC_4x4_Format:Gn,SRGB8_ALPHA8_ASTC_5x4_Format:Hn,SRGB8_ALPHA8_ASTC_5x5_Format:Vn,SRGB8_ALPHA8_ASTC_6x5_Format:Wn,SRGB8_ALPHA8_ASTC_6x6_Format:jn,SRGB8_ALPHA8_ASTC_8x5_Format:qn,SRGB8_ALPHA8_ASTC_8x6_Format:Xn,SRGB8_ALPHA8_ASTC_8x8_Format:Yn,Scene:Lc,SceneUtils:{createMultiMaterialObject:function createMultiMaterialObject(){console.error("THREE.SceneUtils has been moved to /examples/jsm/utils/SceneUtils.js")},detach:function detach(){console.error("THREE.SceneUtils has been moved to /examples/jsm/utils/SceneUtils.js")},attach:function attach(){console.error("THREE.SceneUtils has been moved to /examples/jsm/utils/SceneUtils.js")}},ShaderChunk:Od,ShaderLib:Ud,ShaderMaterial:Td,ShadowMaterial:Ap,Shape:cp,ShapeBufferGeometry:_p,ShapeGeometry:_p,ShapePath:lf,ShapeUtils:pp,ShortType:Wi,Skeleton:du,SkeletonHelper:Fg,SkinnedMesh:iu,SmoothShading:Nr,Sphere:Bs,SphereBufferGeometry:xp,SphereGeometry:xp,Spherical:Eg,SphericalHarmonics3:wm,SplineCurve:op,SpotLight:hm,SpotLightHelper:Ig,Sprite:Zc,SpriteMaterial:zc,SrcAlphaFactor:Kr,SrcAlphaSaturateFactor:ii,SrcColorFactor:Jr,StaticCopyUsage:Zo,StaticDrawUsage:Vo,StaticReadUsage:qo,StereoCamera:jm,StreamCopyUsage:Qo,StreamDrawUsage:jo,StreamReadUsage:Yo,StringKeyframeTrack:Yp,SubtractEquation:Wr,SubtractiveBlending:Ur,TOUCH:Mr,TangentSpaceNormalMap:Eo,TetrahedronBufferGeometry:bp,TetrahedronGeometry:bp,TextGeometry:function(){console.error("THREE.TextGeometry has been moved to /examples/jsm/geometries/TextGeometry.js");return new rd},Texture:ps,TextureLoader:lm,TorusBufferGeometry:Sp,TorusGeometry:Sp,TorusKnotBufferGeometry:Mp,TorusKnotGeometry:Mp,Triangle:Cl,TriangleFanDrawMode:fo,TriangleStripDrawMode:go,TrianglesDrawMode:mo,TubeBufferGeometry:Tp,TubeGeometry:Tp,UVMapping:Si,Uint16Attribute:function(e,t){console.warn("THREE.Uint16Attribute has been removed. Use new THREE.Uint16BufferAttribute() instead.");return new Wl(e,t)},Uint16BufferAttribute:Wl,Uint32Attribute:function(e,t){console.warn("THREE.Uint32Attribute has been removed. Use new THREE.Uint32BufferAttribute() instead.");return new ql(e,t)},Uint32BufferAttribute:ql,Uint8Attribute:function(e,t){console.warn("THREE.Uint8Attribute has been removed. Use new THREE.Uint8BufferAttribute() instead.");return new Gl(e,t)},Uint8BufferAttribute:Gl,Uint8ClampedAttribute:function(e,t){console.warn("THREE.Uint8ClampedAttribute has been removed. Use new THREE.Uint8ClampedBufferAttribute() instead.");return new Hl(e,t)},Uint8ClampedBufferAttribute:Hl,Uniform:bg,UniformsLib:Bd,UniformsUtils:Md,UnsignedByteType:Hi,UnsignedInt248Type:$i,UnsignedIntType:Xi,UnsignedShort4444Type:Ji,UnsignedShort5551Type:Qi,UnsignedShort565Type:Ki,UnsignedShortType:ji,VSMShadowMap:Lr,Vector2:os,Vector3:vs,Vector4:ms,VectorKeyframeTrack:Zp,Vertex:function(e,t,a){console.warn("THREE.Vertex has been removed. Use THREE.Vector3 instead.");return new vs(e,t,a)},VertexColors:2,VideoTexture:Iu,WebGL1Renderer:kc,WebGLCubeRenderTarget:Cd,WebGLMultipleRenderTargets:fs,WebGLMultisampleRenderTarget:hs,WebGLRenderTarget:gs,WebGLRenderTargetCube:function(e,t,a){console.warn("THREE.WebGLRenderTargetCube( width, height, options ) is now WebGLCubeRenderTarget( size, options ).");return new Cd(e,a)},WebGLRenderer:Nt,WebGLUtils:It,WireframeGeometry:Ep,WireframeHelper:function(e,t){console.warn("THREE.WireframeHelper has been removed. Use THREE.WireframeGeometry instead.");return new Eu(new Ep(e.geometry),new hu({color:t!==void 0?t:16777215}))},WrapAroundEnding:co,XHRLoader:function(e){console.warn("THREE.XHRLoader has been renamed to THREE.FileLoader.");return new am(e)},ZeroCurvatureEnding:so,ZeroFactor:Yr,ZeroSlopeEnding:lo,ZeroStencilOp:Ao,sRGBEncoding:yo}),mf=function(e){_inherits(t,e);var a=_createSuper(t);function t(e){_classCallCheck2(this,t);return a.call(this,e)}_createClass2(t,[{key:"load",value:function load(t,a,r,i){var n=this,o=new am(this.manager);o.setPath(this.path);o.setResponseType("arraybuffer");o.setRequestHeader(this.requestHeader);o.setWithCredentials(this.withCredentials);o.load(t,function(e){try{a(n.parse(e))}catch(a){if(i){i(a)}else{console.error(a)}n.manager.itemError(t)}},r,i)}},{key:"parse",value:function parse(e){function t(e,t,a){for(var r=0,i=e.length;r<i;r++){if(e[r]!==t.getUint8(a+r,!1))return!1}return!0}var a=function(e){if("string"==typeof e){for(var t=new Uint8Array(e.length),a=0;a<e.length;a++){t[a]=255&e.charCodeAt(a)}return t.buffer||t}else{return e}}(e);return function(e){var a=new DataView(e),r=a.getUint32(80,!0);if(84+r*50===a.byteLength){return!0}for(var i=[115,111,108,105,100],n=0;5>n;n++){if(t(i,a,n))return!1}return!0}(a)?function(e){for(var t=new DataView(e),a=t.getUint32(80,!0),i,n,o,s=!1,l,d,c,u,p,m=0;m<70;m++){if(1129270351==t.getUint32(m,!1)&&82==t.getUint8(m+4)&&61==t.getUint8(m+5)){s=!0;l=new Float32Array(3*(3*a));d=t.getUint8(m+6)/255;c=t.getUint8(m+7)/255;u=t.getUint8(m+8)/255;p=t.getUint8(m+9)/255}}for(var f=new rd,h=new Float32Array(3*(3*a)),y=new Float32Array(3*(3*a)),v=0;v<a;v++){var _=84+v*50,x=t.getFloat32(_,!0),S=t.getFloat32(_+4,!0),M=t.getFloat32(_+8,!0);if(s){var w=t.getUint16(_+48,!0);if(0==(32768&w)){i=(31&w)/31;n=(31&w>>5)/31;o=(31&w>>10)/31}else{i=d;n=c;o=u}}for(var A=1;3>=A;A++){var T=_+12*A,E=3*(3*v)+3*(A-1);h[E]=t.getFloat32(T,!0);h[E+1]=t.getFloat32(T+4,!0);h[E+2]=t.getFloat32(T+8,!0);y[E]=x;y[E+1]=S;y[E+2]=M;if(s){l[E]=i;l[E+1]=n;l[E+2]=o}}}f.setAttribute("position",new Bl(h,3));f.setAttribute("normal",new Bl(y,3));if(s){f.setAttribute("color",new Bl(l,3));f.hasColors=!0;f.alpha=p}return f}(a):function(e){var t=new rd,a=0,r=/[\s]+([+-]?(?:\d*)(?:\.\d*)?(?:[eE][+-]?\d+)?)/.source,i=new RegExp("vertex"+r+r+r,"g"),n=new RegExp("normal"+r+r+r,"g"),o=[],s=[],l=new vs,d,c=0,u=0,p=0;while(null!==(d=/solid([\s\S]*?)endsolid/g.exec(e))){u=p;var v=d[0];while(null!==(d=/facet([\s\S]*?)endfacet/g.exec(v))){var m=0,g=0,f=d[0];while(null!==(d=n.exec(f))){l.x=parseFloat(d[1]);l.y=parseFloat(d[2]);l.z=parseFloat(d[3]);g++}while(null!==(d=i.exec(f))){o.push(parseFloat(d[1]),parseFloat(d[2]),parseFloat(d[3]));s.push(l.x,l.y,l.z);m++;p++}if(1!==g){console.error("THREE.STLLoader: Something isn't right with the normal of face number "+a)}if(3!=m){console.error("THREE.STLLoader: Something isn't right with the vertices of face number "+a)}a++}var h=u,y=p-u;t.addGroup(h,y,c);c++}t.setAttribute("position",new Yl(o,3));t.setAttribute("normal",new Yl(s,3));return t}(function(e){if("string"!=typeof e){return Cm.decodeText(new Uint8Array(e))}return e}(e))}}]);return t}(em),gf=function e(t,a){_classCallCheck2(this,e);var r=new hu({color:t.edgeColor,linewidth:1}),i=new kp({color:t.faceColor}),n=new mf;n.load(t.src,function(e){var n=new Mc,o=new vs;if(t.center){e.center()}if(!0===t.scale){e.boundingBox.getSize(o);var c=Math.max(o.x,o.y,o.z);e.scale(10/c,10/c,10/c)}else if(!1!==t.scale){e.scale(t.scale,t.scale,t.scale)}var s=new bd(e,i);s.name="main-mesh";n.add(s);var d=new Eu(new ju(e),r);d.name="edges";n.add(d);a(e,n)})};function Ua(e,t){if(!(e instanceof t)){throw new TypeError("Cannot call a class as a function")}}function Ga(e,t){for(var a=0,r;a<t.length;a++){r=t[a];r.enumerable=r.enumerable||!1;r.configurable=!0;if("value"in r)r.writable=!0;Object.defineProperty(e,r.key,r)}}function Ha(e,t,a){if(t)Ga(e.prototype,t);if(a)Ga(e,a);return e}function Va(e,t,a){if(t in e){Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0})}else{e[t]=a}return e}function Wa(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{},r=Object.keys(a);if("function"==typeof Object.getOwnPropertySymbols){r=r.concat(Object.getOwnPropertySymbols(a).filter(function(e){return Object.getOwnPropertyDescriptor(a,e).enumerable}))}r.forEach(function(t){Va(e,t,a[t])})}return e}function ja(e,t){return qa(e)||Xa(e,t)||Ya()}function qa(e){if(Array.isArray(e))return e}function Xa(e,t){var a=[],r=!0,i=!1,n=void 0;try{for(var o=e[Symbol.iterator](),s;!(r=(s=o.next()).done);r=!0){a.push(s.value);if(t&&a.length===t)break}}catch(e){i=!0;n=e}finally{try{if(!r&&null!=o["return"])o["return"]()}finally{if(i)throw n}}return a}function Ya(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}var ff=function(){},hf={},yf={},vf={mark:ff,measure:ff};try{if("undefined"!=typeof window)hf=window;if("undefined"!=typeof document)yf=document;if("undefined"!=typeof MutationObserver)MutationObserver;if("undefined"!=typeof performance)vf=performance}catch(t){}var _f=hf.navigator||{},xf=_f.userAgent,bf=void 0===xf?"":xf,Sf=hf,Mf=yf,Tf=vf;!!Sf.document;var Ef=!!Mf.documentElement&&!!Mf.head&&"function"==typeof Mf.addEventListener&&"function"==typeof Mf.createElement;~bf.indexOf("MSIE")||~bf.indexOf("Trident/");var wf="fa",Af="svg-inline--fa";(function(){try{return"production"===process.env.NODE_ENV}catch(t){return!1}})();var kf={GROUP:"group",SWAP_OPACITY:"swap-opacity",PRIMARY:"primary",SECONDARY:"secondary"},Cf=Sf.FontAwesomeConfig||{};function Za(e){var t=Mf.querySelector("script["+e+"]");if(t){return t.getAttribute(e)}}function Ja(e){if(""===e)return!0;if("false"===e)return!1;if("true"===e)return!0;return e}if(Mf&&"function"==typeof Mf.querySelector){[["data-family-prefix","familyPrefix"],["data-replacement-class","replacementClass"],["data-auto-replace-svg","autoReplaceSvg"],["data-auto-add-css","autoAddCss"],["data-auto-a11y","autoA11y"],["data-search-pseudo-elements","searchPseudoElements"],["data-observe-mutations","observeMutations"],["data-mutate-approach","mutateApproach"],["data-keep-original-source","keepOriginalSource"],["data-measure-performance","measurePerformance"],["data-show-missing-icons","showMissingIcons"]].forEach(function(e){var t=ja(e,2),a=t[0],r=t[1],i=Ja(Za(a));if(i!==void 0&&null!==i){Cf[r]=i}})}var Rf=Wa({},{familyPrefix:wf,replacementClass:Af,autoReplaceSvg:!0,autoAddCss:!0,autoA11y:!0,searchPseudoElements:!1,observeMutations:!0,mutateApproach:"async",keepOriginalSource:!0,measurePerformance:!1,showMissingIcons:!0},Cf);if(!Rf.autoReplaceSvg)Rf.observeMutations=!1;var Lf=Wa({},Rf);Sf.FontAwesomeConfig=Lf;var Pf=Sf||{};if(!Pf.___FONT_AWESOME___)Pf.___FONT_AWESOME___={};if(!Pf.___FONT_AWESOME___.styles)Pf.___FONT_AWESOME___.styles={};if(!Pf.___FONT_AWESOME___.hooks)Pf.___FONT_AWESOME___.hooks={};if(!Pf.___FONT_AWESOME___.shims)Pf.___FONT_AWESOME___.shims=[];var w=Pf.___FONT_AWESOME___,If=[],Df=function e(){Mf.removeEventListener("DOMContentLoaded",e);zf=1;If.map(function(e){return e()})},zf=!1;if(Ef){zf=(Mf.documentElement.doScroll?/^loaded|^c/:/^loaded|^i|^c/).test(Mf.readyState);if(!zf)Mf.addEventListener("DOMContentLoaded",Df)}"undefined"==typeof global||"undefined"==typeof global.process||"function"!=typeof global.process.emit;"undefined"==typeof setImmediate?setTimeout:setImmediate;var Nf={size:16,x:0,y:0,rotate:0,flipX:!1,flipY:!1};function Qa(e){if(!e||!Ef){return}var t=Mf.createElement("style");t.setAttribute("type","text/css");t.innerHTML=e;for(var a=Mf.head.childNodes,r=null,n=a.length-1;-1<n;n--){var o=a[n],s=(o.tagName||"").toUpperCase();if(-1<["STYLE","LINK"].indexOf(s)){r=o}}Mf.head.insertBefore(t,r);return e}function Ka(){var e=12,t="";while(0<e--){t+="0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ"[0|62*Math.random()]}return t}function $a(e){return"".concat(e).replace(/&/g,"&amp;").replace(/"/g,"&quot;").replace(/'/g,"&#39;").replace(/</g,"&lt;").replace(/>/g,"&gt;")}function er(e){return Object.keys(e||{}).reduce(function(t,a){return t+"".concat(a,"=\"").concat($a(e[a]),"\" ")},"").trim()}function tr(e){return Object.keys(e||{}).reduce(function(t,a){return t+"".concat(a,": ").concat(e[a],";")},"")}function ar(e){return e.size!==Nf.size||e.x!==Nf.x||e.y!==Nf.y||e.rotate!==Nf.rotate||e.flipX||e.flipY}function rr(e){var t=e.transform,a=e.containerWidth,r=e.iconWidth,i={transform:"translate(".concat(a/2," 256)")},n="translate(".concat(32*t.x,", ").concat(32*t.y,") "),o="scale(".concat(t.size/16*(t.flipX?-1:1),", ").concat(t.size/16*(t.flipY?-1:1),") "),s="rotate(".concat(t.rotate," 0 0)"),l={transform:"".concat(n," ").concat(o," ").concat(s)},d={transform:"translate(".concat(-1*(r/2)," -256)")};return{outer:i,inner:l,path:d}}var Ff={x:0,y:0,width:"100%",height:"100%"};function ir(e){var t=1<arguments.length&&arguments[1]!==void 0?arguments[1]:!0;if(e.attributes&&(e.attributes.fill||t)){e.attributes.fill="black"}return e}function nr(e){if("g"===e.tag){return e.children}else{return[e]}}function or(e){var t=e.children,a=e.attributes,r=e.main,i=e.mask,n=e.maskId,o=e.transform,s=r.width,l=r.icon,d=i.width,c=i.icon,u=rr({transform:o,containerWidth:d,iconWidth:s}),p={tag:"rect",attributes:Wa({},Ff,{fill:"white"})},m=l.children?{children:l.children.map(ir)}:{},g={tag:"g",attributes:Wa({},u.inner),children:[ir(Wa({tag:l.tag,attributes:Wa({},l.attributes,u.path)},m))]},f={tag:"g",attributes:Wa({},u.outer),children:[g]},h="mask-".concat(n||Ka()),y="clip-".concat(n||Ka()),v={tag:"mask",attributes:Wa({},Ff,{id:h,maskUnits:"userSpaceOnUse",maskContentUnits:"userSpaceOnUse"}),children:[p,f]},_={tag:"defs",children:[{tag:"clipPath",attributes:{id:y},children:nr(c)},v]};t.push(_,{tag:"rect",attributes:Wa({fill:"currentColor","clip-path":"url(#".concat(y,")"),mask:"url(#".concat(h,")")},Ff)});return{children:t,attributes:a}}function sr(e){var t=e.children,a=e.attributes,r=e.main,i=e.transform,n=e.styles,o=tr(n);if(0<o.length){a.style=o}if(ar(i)){var s=rr({transform:i,containerWidth:r.width,iconWidth:r.width});t.push({tag:"g",attributes:Wa({},s.outer),children:[{tag:"g",attributes:Wa({},s.inner),children:[{tag:r.icon.tag,children:r.icon.children,attributes:Wa({},r.icon.attributes,s.path)}]}]})}else{t.push(r.icon)}return{children:t,attributes:a}}function lr(e){var t=e.children,a=e.main,r=e.mask,i=e.attributes,n=e.styles,o=e.transform;if(ar(o)&&a.found&&!r.found){var s=a.width,l=a.height,d={x:s/l/2,y:.5};i.style=tr(Wa({},n,{"transform-origin":"".concat(d.x+o.x/16,"em ").concat(d.y+o.y/16,"em")}))}return[{tag:"svg",attributes:i,children:t}]}function dr(e){var t=e.prefix,a=e.iconName,r=e.children,i=e.attributes,n=e.symbol,o=!0===n?"".concat(t,"-").concat(Lf.familyPrefix,"-").concat(a):n;return[{tag:"svg",attributes:{style:"display: none;"},children:[{tag:"symbol",attributes:Wa({},i,{id:o}),children:r}]}]}function cr(e){var t=e.icons,a=t.main,r=t.mask,i=e.prefix,n=e.iconName,o=e.transform,s=e.symbol,l=e.title,d=e.maskId,c=e.titleId,u=e.extra,p=e.watchable,m=void 0===p?!1:p,g=r.found?r:a,f=g.width,h=g.height,y="fak"===i,v=y?"":"fa-w-".concat(Math.ceil(16*(f/h))),_=[Lf.replacementClass,n?"".concat(Lf.familyPrefix,"-").concat(n):"",v].filter(function(e){return-1===u.classes.indexOf(e)}).filter(function(e){return""!==e||!!e}).concat(u.classes).join(" "),x={children:[],attributes:Wa({},u.attributes,{"data-prefix":i,"data-icon":n,class:_,role:u.attributes.role||"img",xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 ".concat(f," ").concat(h)})},b=y&&!~u.classes.indexOf("fa-fw")?{width:"".concat(.0625*(16*(f/h)),"em")}:{};if(m){x.attributes["data-fa-i2svg"]=""}if(l)x.children.push({tag:"title",attributes:{id:x.attributes["aria-labelledby"]||"title-".concat(c||Ka())},children:[l]});var S=Wa({},x,{prefix:i,iconName:n,main:a,mask:r,maskId:d,transform:o,symbol:s,styles:Wa({},b,u.styles)}),M=r.found&&a.found?or(S):sr(S),T=M.children,E=M.attributes;S.children=T;S.attributes=E;if(s){return dr(S)}else{return lr(S)}}var Of=function(){};Lf.measurePerformance&&Tf&&Tf.mark&&Tf.measure?Tf:{mark:Of,measure:Of};var Bf=function(e,t){return function(r,a,i,n){return e.call(t,r,a,i,n)}},Uf=function(e,t,a,r){var n=Object.keys(e),o=n.length,s=r!==void 0?Bf(t,r):t,l,d,c;if(a===void 0){l=1;c=e[n[0]]}else{l=0;c=a}for(;l<o;l++){d=n[l];c=s(c,e[d],d,e)}return c};function ur(e,t){var a=2<arguments.length&&arguments[2]!==void 0?arguments[2]:{},r=a.skipHooks,i=void 0===r?!1:r,n=Object.keys(t).reduce(function(e,a){var r=t[a],i=!!r.icon;if(i){e[r.iconName]=r.icon}else{e[a]=r}return e},{});if("function"==typeof w.hooks.addPack&&!i){w.hooks.addPack(e,n)}else{w.styles[e]=Wa({},w.styles[e]||{},n)}if("fas"===e){ur("fa",t)}}var Gf=w.styles,Hf=w.shims,Vf=function(){var e=function(e){return Uf(Gf,function(t,a,r){t[r]=Uf(a,e,{});return t},{})};e(function(e,t,a){if(t[3]){e[t[3]]=a}return e});e(function(e,t,a){var r=t[2];e[a]=a;r.forEach(function(t){e[t]=a});return e});var t=("far"in Gf);Uf(Hf,function(e,a){var r=a[0],i=a[1],n=a[2];if("far"===i&&!t){i="fas"}e[r]={prefix:i,iconName:n};return e},{})};Vf();w.styles;function pr(e,t,a){if(e&&e[t]&&e[t][a]){return{prefix:t,iconName:a,icon:e[t][a]}}}function mr(e){var t=e.tag,a=e.attributes,r=void 0===a?{}:a,i=e.children,n=void 0===i?[]:i;if("string"==typeof e){return $a(e)}else{return"<".concat(t," ").concat(er(r),">").concat(n.map(mr).join(""),"</").concat(t,">")}}function gr(e){this.name="MissingIcon";this.message=e||"Icon unavailable";this.stack=new Error().stack}gr.prototype=Object.create(Error.prototype);gr.prototype.constructor=gr;var Wf={fill:"currentColor"},jf={attributeType:"XML",repeatCount:"indefinite",dur:"2s"};({tag:"path",attributes:Wa({},Wf,{d:"M156.5,447.7l-12.6,29.5c-18.7-9.5-35.9-21.2-51.5-34.9l22.7-22.7C127.6,430.5,141.5,440,156.5,447.7z M40.6,272H8.5 c1.4,21.2,5.4,41.7,11.7,61.1L50,321.2C45.1,305.5,41.8,289,40.6,272z M40.6,240c1.4-18.8,5.2-37,11.1-54.1l-29.5-12.6 C14.7,194.3,10,216.7,8.5,240H40.6z M64.3,156.5c7.8-14.9,17.2-28.8,28.1-41.5L69.7,92.3c-13.7,15.6-25.5,32.8-34.9,51.5 L64.3,156.5z M397,419.6c-13.9,12-29.4,22.3-46.1,30.4l11.9,29.8c20.7-9.9,39.8-22.6,56.9-37.6L397,419.6z M115,92.4 c13.9-12,29.4-22.3,46.1-30.4l-11.9-29.8c-20.7,9.9-39.8,22.6-56.8,37.6L115,92.4z M447.7,355.5c-7.8,14.9-17.2,28.8-28.1,41.5 l22.7,22.7c13.7-15.6,25.5-32.9,34.9-51.5L447.7,355.5z M471.4,272c-1.4,18.8-5.2,37-11.1,54.1l29.5,12.6 c7.5-21.1,12.2-43.5,13.6-66.8H471.4z M321.2,462c-15.7,5-32.2,8.2-49.2,9.4v32.1c21.2-1.4,41.7-5.4,61.1-11.7L321.2,462z M240,471.4c-18.8-1.4-37-5.2-54.1-11.1l-12.6,29.5c21.1,7.5,43.5,12.2,66.8,13.6V471.4z M462,190.8c5,15.7,8.2,32.2,9.4,49.2h32.1 c-1.4-21.2-5.4-41.7-11.7-61.1L462,190.8z M92.4,397c-12-13.9-22.3-29.4-30.4-46.1l-29.8,11.9c9.9,20.7,22.6,39.8,37.6,56.9 L92.4,397z M272,40.6c18.8,1.4,36.9,5.2,54.1,11.1l12.6-29.5C317.7,14.7,295.3,10,272,8.5V40.6z M190.8,50 c15.7-5,32.2-8.2,49.2-9.4V8.5c-21.2,1.4-41.7,5.4-61.1,11.7L190.8,50z M442.3,92.3L419.6,115c12,13.9,22.3,29.4,30.5,46.1 l29.8-11.9C470,128.5,457.3,109.4,442.3,92.3z M397,92.4l22.7-22.7c-15.6-13.7-32.8-25.5-51.5-34.9l-12.6,29.5 C370.4,72.1,384.4,81.5,397,92.4z"})});var qf=Wa({},jf,{attributeName:"opacity"});({tag:"circle",attributes:Wa({},Wf,{cx:"256",cy:"364",r:"28"}),children:[{tag:"animate",attributes:Wa({},jf,{attributeName:"r",values:"28;14;28;28;14;28;"})},{tag:"animate",attributes:Wa({},qf,{values:"1;0;1;1;0;1;"})}]});({tag:"path",attributes:Wa({},Wf,{opacity:"1",d:"M263.7,312h-16c-6.6,0-12-5.4-12-12c0-71,77.4-63.9,77.4-107.8c0-20-17.8-40.2-57.4-40.2c-29.1,0-44.3,9.6-59.2,28.7 c-3.9,5-11.1,6-16.2,2.4l-13.1-9.2c-5.6-3.9-6.9-11.8-2.6-17.2c21.2-27.2,46.4-44.7,91.2-44.7c52.3,0,97.4,29.8,97.4,80.2 c0,67.6-77.4,63.5-77.4,107.8C275.7,306.6,270.3,312,263.7,312z"}),children:[{tag:"animate",attributes:Wa({},qf,{values:"1;0;0;0;0;1;"})}]});({tag:"path",attributes:Wa({},Wf,{opacity:"0",d:"M232.5,134.5l7,168c0.3,6.4,5.6,11.5,12,11.5h9c6.4,0,11.7-5.1,12-11.5l7-168c0.3-6.8-5.2-12.5-12-12.5h-23 C237.7,122,232.2,127.7,232.5,134.5z"}),children:[{tag:"animate",attributes:Wa({},qf,{values:"0;0;1;1;0;0;"})}]});w.styles;function fr(e){var t=e[0],a=e[1],r=e.slice(4),i=ja(r,1),n=i[0],o=null;if(Array.isArray(n)){o={tag:"g",attributes:{class:"".concat(Lf.familyPrefix,"-").concat(kf.GROUP)},children:[{tag:"path",attributes:{class:"".concat(Lf.familyPrefix,"-").concat(kf.SECONDARY),fill:"currentColor",d:n[0]}},{tag:"path",attributes:{class:"".concat(Lf.familyPrefix,"-").concat(kf.PRIMARY),fill:"currentColor",d:n[1]}}]}}else{o={tag:"path",attributes:{fill:"currentColor",d:n}}}return{found:!0,width:t,height:a,icon:o}}w.styles;function hr(){var e=wf,t=Af,a=Lf.familyPrefix,r=Lf.replacementClass,i="svg:not(:root).svg-inline--fa {\n  overflow: visible;\n}\n\n.svg-inline--fa {\n  display: inline-block;\n  font-size: inherit;\n  height: 1em;\n  overflow: visible;\n  vertical-align: -0.125em;\n}\n.svg-inline--fa.fa-lg {\n  vertical-align: -0.225em;\n}\n.svg-inline--fa.fa-w-1 {\n  width: 0.0625em;\n}\n.svg-inline--fa.fa-w-2 {\n  width: 0.125em;\n}\n.svg-inline--fa.fa-w-3 {\n  width: 0.1875em;\n}\n.svg-inline--fa.fa-w-4 {\n  width: 0.25em;\n}\n.svg-inline--fa.fa-w-5 {\n  width: 0.3125em;\n}\n.svg-inline--fa.fa-w-6 {\n  width: 0.375em;\n}\n.svg-inline--fa.fa-w-7 {\n  width: 0.4375em;\n}\n.svg-inline--fa.fa-w-8 {\n  width: 0.5em;\n}\n.svg-inline--fa.fa-w-9 {\n  width: 0.5625em;\n}\n.svg-inline--fa.fa-w-10 {\n  width: 0.625em;\n}\n.svg-inline--fa.fa-w-11 {\n  width: 0.6875em;\n}\n.svg-inline--fa.fa-w-12 {\n  width: 0.75em;\n}\n.svg-inline--fa.fa-w-13 {\n  width: 0.8125em;\n}\n.svg-inline--fa.fa-w-14 {\n  width: 0.875em;\n}\n.svg-inline--fa.fa-w-15 {\n  width: 0.9375em;\n}\n.svg-inline--fa.fa-w-16 {\n  width: 1em;\n}\n.svg-inline--fa.fa-w-17 {\n  width: 1.0625em;\n}\n.svg-inline--fa.fa-w-18 {\n  width: 1.125em;\n}\n.svg-inline--fa.fa-w-19 {\n  width: 1.1875em;\n}\n.svg-inline--fa.fa-w-20 {\n  width: 1.25em;\n}\n.svg-inline--fa.fa-pull-left {\n  margin-right: 0.3em;\n  width: auto;\n}\n.svg-inline--fa.fa-pull-right {\n  margin-left: 0.3em;\n  width: auto;\n}\n.svg-inline--fa.fa-border {\n  height: 1.5em;\n}\n.svg-inline--fa.fa-li {\n  width: 2em;\n}\n.svg-inline--fa.fa-fw {\n  width: 1.25em;\n}\n\n.fa-layers svg.svg-inline--fa {\n  bottom: 0;\n  left: 0;\n  margin: auto;\n  position: absolute;\n  right: 0;\n  top: 0;\n}\n\n.fa-layers {\n  display: inline-block;\n  height: 1em;\n  position: relative;\n  text-align: center;\n  vertical-align: -0.125em;\n  width: 1em;\n}\n.fa-layers svg.svg-inline--fa {\n  -webkit-transform-origin: center center;\n          transform-origin: center center;\n}\n\n.fa-layers-counter, .fa-layers-text {\n  display: inline-block;\n  position: absolute;\n  text-align: center;\n}\n\n.fa-layers-text {\n  left: 50%;\n  top: 50%;\n  -webkit-transform: translate(-50%, -50%);\n          transform: translate(-50%, -50%);\n  -webkit-transform-origin: center center;\n          transform-origin: center center;\n}\n\n.fa-layers-counter {\n  background-color: #ff253a;\n  border-radius: 1em;\n  -webkit-box-sizing: border-box;\n          box-sizing: border-box;\n  color: #fff;\n  height: 1.5em;\n  line-height: 1;\n  max-width: 5em;\n  min-width: 1.5em;\n  overflow: hidden;\n  padding: 0.25em;\n  right: 0;\n  text-overflow: ellipsis;\n  top: 0;\n  -webkit-transform: scale(0.25);\n          transform: scale(0.25);\n  -webkit-transform-origin: top right;\n          transform-origin: top right;\n}\n\n.fa-layers-bottom-right {\n  bottom: 0;\n  right: 0;\n  top: auto;\n  -webkit-transform: scale(0.25);\n          transform: scale(0.25);\n  -webkit-transform-origin: bottom right;\n          transform-origin: bottom right;\n}\n\n.fa-layers-bottom-left {\n  bottom: 0;\n  left: 0;\n  right: auto;\n  top: auto;\n  -webkit-transform: scale(0.25);\n          transform: scale(0.25);\n  -webkit-transform-origin: bottom left;\n          transform-origin: bottom left;\n}\n\n.fa-layers-top-right {\n  right: 0;\n  top: 0;\n  -webkit-transform: scale(0.25);\n          transform: scale(0.25);\n  -webkit-transform-origin: top right;\n          transform-origin: top right;\n}\n\n.fa-layers-top-left {\n  left: 0;\n  right: auto;\n  top: 0;\n  -webkit-transform: scale(0.25);\n          transform: scale(0.25);\n  -webkit-transform-origin: top left;\n          transform-origin: top left;\n}\n\n.fa-lg {\n  font-size: 1.3333333333em;\n  line-height: 0.75em;\n  vertical-align: -0.0667em;\n}\n\n.fa-xs {\n  font-size: 0.75em;\n}\n\n.fa-sm {\n  font-size: 0.875em;\n}\n\n.fa-1x {\n  font-size: 1em;\n}\n\n.fa-2x {\n  font-size: 2em;\n}\n\n.fa-3x {\n  font-size: 3em;\n}\n\n.fa-4x {\n  font-size: 4em;\n}\n\n.fa-5x {\n  font-size: 5em;\n}\n\n.fa-6x {\n  font-size: 6em;\n}\n\n.fa-7x {\n  font-size: 7em;\n}\n\n.fa-8x {\n  font-size: 8em;\n}\n\n.fa-9x {\n  font-size: 9em;\n}\n\n.fa-10x {\n  font-size: 10em;\n}\n\n.fa-fw {\n  text-align: center;\n  width: 1.25em;\n}\n\n.fa-ul {\n  list-style-type: none;\n  margin-left: 2.5em;\n  padding-left: 0;\n}\n.fa-ul > li {\n  position: relative;\n}\n\n.fa-li {\n  left: -2em;\n  position: absolute;\n  text-align: center;\n  width: 2em;\n  line-height: inherit;\n}\n\n.fa-border {\n  border: solid 0.08em #eee;\n  border-radius: 0.1em;\n  padding: 0.2em 0.25em 0.15em;\n}\n\n.fa-pull-left {\n  float: left;\n}\n\n.fa-pull-right {\n  float: right;\n}\n\n.fa.fa-pull-left,\n.fas.fa-pull-left,\n.far.fa-pull-left,\n.fal.fa-pull-left,\n.fab.fa-pull-left {\n  margin-right: 0.3em;\n}\n.fa.fa-pull-right,\n.fas.fa-pull-right,\n.far.fa-pull-right,\n.fal.fa-pull-right,\n.fab.fa-pull-right {\n  margin-left: 0.3em;\n}\n\n.fa-spin {\n  -webkit-animation: fa-spin 2s infinite linear;\n          animation: fa-spin 2s infinite linear;\n}\n\n.fa-pulse {\n  -webkit-animation: fa-spin 1s infinite steps(8);\n          animation: fa-spin 1s infinite steps(8);\n}\n\n@-webkit-keyframes fa-spin {\n  0% {\n    -webkit-transform: rotate(0deg);\n            transform: rotate(0deg);\n  }\n  100% {\n    -webkit-transform: rotate(360deg);\n            transform: rotate(360deg);\n  }\n}\n\n@keyframes fa-spin {\n  0% {\n    -webkit-transform: rotate(0deg);\n            transform: rotate(0deg);\n  }\n  100% {\n    -webkit-transform: rotate(360deg);\n            transform: rotate(360deg);\n  }\n}\n.fa-rotate-90 {\n  -ms-filter: \"progid:DXImageTransform.Microsoft.BasicImage(rotation=1)\";\n  -webkit-transform: rotate(90deg);\n          transform: rotate(90deg);\n}\n\n.fa-rotate-180 {\n  -ms-filter: \"progid:DXImageTransform.Microsoft.BasicImage(rotation=2)\";\n  -webkit-transform: rotate(180deg);\n          transform: rotate(180deg);\n}\n\n.fa-rotate-270 {\n  -ms-filter: \"progid:DXImageTransform.Microsoft.BasicImage(rotation=3)\";\n  -webkit-transform: rotate(270deg);\n          transform: rotate(270deg);\n}\n\n.fa-flip-horizontal {\n  -ms-filter: \"progid:DXImageTransform.Microsoft.BasicImage(rotation=0, mirror=1)\";\n  -webkit-transform: scale(-1, 1);\n          transform: scale(-1, 1);\n}\n\n.fa-flip-vertical {\n  -ms-filter: \"progid:DXImageTransform.Microsoft.BasicImage(rotation=2, mirror=1)\";\n  -webkit-transform: scale(1, -1);\n          transform: scale(1, -1);\n}\n\n.fa-flip-both, .fa-flip-horizontal.fa-flip-vertical {\n  -ms-filter: \"progid:DXImageTransform.Microsoft.BasicImage(rotation=2, mirror=1)\";\n  -webkit-transform: scale(-1, -1);\n          transform: scale(-1, -1);\n}\n\n:root .fa-rotate-90,\n:root .fa-rotate-180,\n:root .fa-rotate-270,\n:root .fa-flip-horizontal,\n:root .fa-flip-vertical,\n:root .fa-flip-both {\n  -webkit-filter: none;\n          filter: none;\n}\n\n.fa-stack {\n  display: inline-block;\n  height: 2em;\n  position: relative;\n  width: 2.5em;\n}\n\n.fa-stack-1x,\n.fa-stack-2x {\n  bottom: 0;\n  left: 0;\n  margin: auto;\n  position: absolute;\n  right: 0;\n  top: 0;\n}\n\n.svg-inline--fa.fa-stack-1x {\n  height: 1em;\n  width: 1.25em;\n}\n.svg-inline--fa.fa-stack-2x {\n  height: 2em;\n  width: 2.5em;\n}\n\n.fa-inverse {\n  color: #fff;\n}\n\n.sr-only {\n  border: 0;\n  clip: rect(0, 0, 0, 0);\n  height: 1px;\n  margin: -1px;\n  overflow: hidden;\n  padding: 0;\n  position: absolute;\n  width: 1px;\n}\n\n.sr-only-focusable:active, .sr-only-focusable:focus {\n  clip: auto;\n  height: auto;\n  margin: 0;\n  overflow: visible;\n  position: static;\n  width: auto;\n}\n\n.svg-inline--fa .fa-primary {\n  fill: var(--fa-primary-color, currentColor);\n  opacity: 1;\n  opacity: var(--fa-primary-opacity, 1);\n}\n\n.svg-inline--fa .fa-secondary {\n  fill: var(--fa-secondary-color, currentColor);\n  opacity: 0.4;\n  opacity: var(--fa-secondary-opacity, 0.4);\n}\n\n.svg-inline--fa.fa-swap-opacity .fa-primary {\n  opacity: 0.4;\n  opacity: var(--fa-secondary-opacity, 0.4);\n}\n\n.svg-inline--fa.fa-swap-opacity .fa-secondary {\n  opacity: 1;\n  opacity: var(--fa-primary-opacity, 1);\n}\n\n.svg-inline--fa mask .fa-primary,\n.svg-inline--fa mask .fa-secondary {\n  fill: black;\n}\n\n.fad.fa-inverse {\n  color: #fff;\n}";if(a!==e||r!==t){var n=new RegExp("\\.".concat(e,"\\-"),"g"),o=new RegExp("\\--".concat(e,"\\-"),"g"),l=new RegExp("\\.".concat(t),"g");i=i.replace(n,".".concat(a,"-")).replace(o,"--".concat(a,"-")).replace(l,".".concat(r))}return i}var Xf=function(){function e(){Ua(this,e);this.definitions={}}Ha(e,[{key:"add",value:function(){for(var e=this,t=arguments.length,a=Array(t),r=0;r<t;r++){a[r]=arguments[r]}var i=a.reduce(this._pullDefinitions,{});Object.keys(i).forEach(function(t){e.definitions[t]=Wa({},e.definitions[t]||{},i[t]);ur(t,i[t]);Vf()})}},{key:"reset",value:function(){this.definitions={}}},{key:"_pullDefinitions",value:function(e,t){var a=t.prefix&&t.iconName&&t.icon?{0:t}:t;Object.keys(a).map(function(t){var r=a[t],i=r.prefix,n=r.iconName,o=r.icon;if(!e[i])e[i]={};e[i][n]=o});return e}}]);return e}();function yr(){if(Lf.autoAddCss&&!Zf){Qa(hr());Zf=!0}}function vr(e,t){Object.defineProperty(e,"abstract",{get:t});Object.defineProperty(e,"html",{get:function(){return e.abstract.map(function(e){return mr(e)})}});Object.defineProperty(e,"node",{get:function(){if(!Ef)return;var t=Mf.createElement("div");t.innerHTML=e.html;return t.children}});return e}function _r(e){var t=e.prefix,a=void 0===t?"fa":t,r=e.iconName;if(!r)return;return pr(Yf.definitions,a,r)||pr(w.styles,a,r)}var Yf=new Xf,Zf=!1,Jf=function(e){return function(t){var a=1<arguments.length&&arguments[1]!==void 0?arguments[1]:{},r=(t||{}).icon?t:_r(t||{}),i=a.mask;if(i){i=(i||{}).icon?i:_r(i||{})}return e(r,Wa({},a,{mask:i}))}}(function(e){var t=1<arguments.length&&arguments[1]!==void 0?arguments[1]:{},a=t.transform,r=void 0===a?Nf:a,i=t.symbol,n=void 0===i?!1:i,o=t.mask,s=void 0===o?null:o,l=t.maskId,d=void 0===l?null:l,c=t.title,u=void 0===c?null:c,p=t.titleId,m=void 0===p?null:p,g=t.classes,f=void 0===g?[]:g,h=t.attributes,y=void 0===h?{}:h,v=t.styles,_=void 0===v?{}:v;if(!e)return;var x=e.prefix,b=e.iconName,S=e.icon;return vr(Wa({type:"icon"},e),function(){yr();if(Lf.autoA11y){if(u){y["aria-labelledby"]="".concat(Lf.replacementClass,"-title-").concat(m||Ka())}else{y["aria-hidden"]="true";y.focusable="false"}}return cr({icons:{main:fr(S),mask:s?fr(s.icon):{found:!1,width:null,height:null,icon:{}}},prefix:x,iconName:b,transform:Wa({},Nf,r),symbol:n,title:u,maskId:d,titleId:m,extra:{attributes:y,styles:_,classes:f}})})}),Qf={prefix:"fas",iconName:"undo",icon:[512,512,[],"f0e2","M212.333 224.333H12c-6.627 0-12-5.373-12-12V12C0 5.373 5.373 0 12 0h48c6.627 0 12 5.373 12 12v78.112C117.773 39.279 184.26 7.47 258.175 8.007c136.906.994 246.448 111.623 246.157 248.532C504.041 393.258 393.12 504 256.333 504c-64.089 0-122.496-24.313-166.51-64.215-5.099-4.622-5.334-12.554-.467-17.42l33.967-33.967c4.474-4.474 11.662-4.717 16.401-.525C170.76 415.336 211.58 432 256.333 432c97.268 0 176-78.716 176-176 0-97.267-78.716-176-176-176-58.496 0-110.28 28.476-142.274 72.333h98.274c6.627 0 12 5.373 12 12v48c0 6.627-5.373 12-12 12z"]},Kf={IDLE:Symbol(),ROTATE:Symbol(),PAN:Symbol(),SCALE:Symbol(),FOV:Symbol(),FOCUS:Symbol(),ZROTATE:Symbol(),TOUCH_MULTI:Symbol(),ANIMATION_FOCUS:Symbol(),ANIMATION_ROTATE:Symbol()},$f={NONE:Symbol(),ONE_FINGER:Symbol(),ONE_FINGER_SWITCHED:Symbol(),TWO_FINGER:Symbol(),MULT_FINGER:Symbol(),CURSOR:Symbol()},eh={x:0,y:0},th={camera:new Ys,gizmos:new Ys},ah={type:"change"},rh={type:"start"},ih={type:"end"},nh=new Tg,oh=new vs,sh=function(e){_inherits(t,e);var a=_createSuper(t);function t(e,r){var i,n=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;_classCallCheck2(this,t);i=a.call(this);_defineProperty2(_assertThisInitialized(i),"onWindowResize",function(){var e=(i._gizmos.scale.x+i._gizmos.scale.y+i._gizmos.scale.z)/3;i._tbRadius=i.calculateTbRadius(i.camera);var t=i._tbRadius/e,a=new Xu(0,0,t,t),r=a.getPoints(i._curvePts),n=new rd().setFromPoints(r);for(var o in i._gizmos.children){i._gizmos.children[o].geometry=n}i.dispatchEvent(ah)});_defineProperty2(_assertThisInitialized(i),"onContextMenu",function(e){if(!i.enabled){return}for(var t=0;t<i.mouseActions.length;t++){if(2==i.mouseActions[t].mouse){e.preventDefault();break}}});_defineProperty2(_assertThisInitialized(i),"onPointerCancel",function(){i._touchStart.splice(0,i._touchStart.length);i._touchCurrent.splice(0,i._touchCurrent.length);i._input=$f.NONE});_defineProperty2(_assertThisInitialized(i),"onPointerDown",function(e){if(0==e.button&&e.isPrimary){i._downValid=!0;i._downEvents.push(e);i._downStart=performance.now()}else{i._downValid=!1}if("touch"==e.pointerType&&i._input!=$f.CURSOR){i._touchStart.push(e);i._touchCurrent.push(e);switch(i._input){case $f.NONE:i._input=$f.ONE_FINGER;i.onSinglePanStart(e,"ROTATE");window.addEventListener("pointermove",i.onPointerMove);window.addEventListener("pointerup",i.onPointerUp);break;case $f.ONE_FINGER:case $f.ONE_FINGER_SWITCHED:i._input=$f.TWO_FINGER;i.onRotateStart();i.onPinchStart();i.onDoublePanStart();break;case $f.TWO_FINGER:i._input=$f.MULT_FINGER;i.onTriplePanStart(e);break;}}else if("touch"!=e.pointerType&&i._input==$f.NONE){var t=null;if(e.ctrlKey||e.metaKey){t="CTRL"}else if(e.shiftKey){t="SHIFT"}i._mouseOp=i.getOpFromAction(e.button,t);if(null!=i._mouseOp){window.addEventListener("pointermove",i.onPointerMove);window.addEventListener("pointerup",i.onPointerUp);i._input=$f.CURSOR;i._button=e.button;i.onSinglePanStart(e,i._mouseOp)}}});_defineProperty2(_assertThisInitialized(i),"onPointerMove",function(e){if("touch"==e.pointerType&&i._input!=$f.CURSOR){switch(i._input){case $f.ONE_FINGER:i.updateTouchEvent(e);i.onSinglePanMove(e,Kf.ROTATE);break;case $f.ONE_FINGER_SWITCHED:var t=i.calculatePointersDistance(i._touchCurrent[0],e)*i._devPxRatio;if(t>=i._switchSensibility){i._input=$f.ONE_FINGER;i.updateTouchEvent(e);i.onSinglePanStart(e,"ROTATE");break}break;case $f.TWO_FINGER:i.updateTouchEvent(e);i.onRotateMove();i.onPinchMove();i.onDoublePanMove();break;case $f.MULT_FINGER:i.updateTouchEvent(e);i.onTriplePanMove(e);break;}}else if("touch"!=e.pointerType&&i._input==$f.CURSOR){var a=null;if(e.ctrlKey||e.metaKey){a="CTRL"}else if(e.shiftKey){a="SHIFT"}var r=i.getOpStateFromAction(i._button,a);if(null!=r){i.onSinglePanMove(e,r)}}if(i._downValid){var n=i.calculatePointersDistance(i._downEvents[i._downEvents.length-1],e)*i._devPxRatio;if(n>i._movementThreshold){i._downValid=!1}}});_defineProperty2(_assertThisInitialized(i),"onPointerUp",function(e){if("touch"==e.pointerType&&i._input!=$f.CURSOR){for(var t=i._touchCurrent.length,a=0;a<t;a++){if(i._touchCurrent[a].pointerId==e.pointerId){i._touchCurrent.splice(a,1);i._touchStart.splice(a,1);break}}switch(i._input){case $f.ONE_FINGER:case $f.ONE_FINGER_SWITCHED:window.removeEventListener("pointermove",i.onPointerMove);window.removeEventListener("pointerup",i.onPointerUp);i._input=$f.NONE;i.onSinglePanEnd();break;case $f.TWO_FINGER:i.onDoublePanEnd(e);i.onPinchEnd(e);i.onRotateEnd(e);i._input=$f.ONE_FINGER_SWITCHED;break;case $f.MULT_FINGER:if(0==i._touchCurrent.length){window.removeEventListener("pointermove",i.onPointerMove);window.removeEventListener("pointerup",i.onPointerUp);i._input=$f.NONE;i.onTriplePanEnd()}break;}}else if("touch"!=e.pointerType&&i._input==$f.CURSOR){window.removeEventListener("pointermove",i.onPointerMove);window.removeEventListener("pointerup",i.onPointerUp);i._input=$f.NONE;i.onSinglePanEnd();i._button=-1}if(e.isPrimary){if(i._downValid){var o=e.timeStamp-i._downEvents[i._downEvents.length-1].timeStamp;if(o<=i._maxDownTime){if(0==i._nclicks){i._nclicks=1;i._clickStart=performance.now()}else{var r=e.timeStamp-i._clickStart,n=i.calculatePointersDistance(i._downEvents[1],i._downEvents[0])*i._devPxRatio;if(r<=i._maxInterval&&n<=i._posThreshold){i._nclicks=0;i._downEvents.splice(0,i._downEvents.length);i.onDoubleTap(e)}else{i._nclicks=1;i._downEvents.shift();i._clickStart=performance.now()}}}else{i._downValid=!1;i._nclicks=0;i._downEvents.splice(0,i._downEvents.length)}}else{i._nclicks=0;i._downEvents.splice(0,i._downEvents.length)}}});_defineProperty2(_assertThisInitialized(i),"onWheel",function(e){if(i.enabled&&i.enableZoom){var l=null;if(e.ctrlKey||e.metaKey){l="CTRL"}else if(e.shiftKey){l="SHIFT"}var d=i.getOpFromAction("WHEEL",l);if(null!=d){e.preventDefault();i.dispatchEvent(rh);var t=e.deltaY/125,a=1;if(0<t){a=1/i.scaleFactor}else if(0>t){a=i.scaleFactor}switch(d){case"ZOOM":i.updateTbState(Kf.SCALE,!0);if(0<t){a=1/Math.pow(i.scaleFactor,t)}else if(0>t){a=Math.pow(i.scaleFactor,-t)}if(i.cursorZoom&&i.enablePan){var c;if(i.camera.isOrthographicCamera){c=i.unprojectOnTbPlane(i.camera,e.clientX,e.clientY,i.domElement).applyQuaternion(i.camera.quaternion).multiplyScalar(1/i.camera.zoom).add(i._gizmos.position)}else if(i.camera.isPerspectiveCamera){c=i.unprojectOnTbPlane(i.camera,e.clientX,e.clientY,i.domElement).applyQuaternion(i.camera.quaternion).add(i._gizmos.position)}i.applyTransformMatrix(i.scale(a,c))}else{i.applyTransformMatrix(i.scale(a,i._gizmos.position))}if(null!=i._grid){i.disposeGrid();i.drawGrid()}i.updateTbState(Kf.IDLE,!1);i.dispatchEvent(ah);i.dispatchEvent(ih);break;case"FOV":if(i.camera.isPerspectiveCamera){i.updateTbState(Kf.FOV,!0);if(0!=e.deltaX){t=e.deltaX/125;a=1;if(0<t){a=1/Math.pow(i.scaleFactor,t)}else if(0>t){a=Math.pow(i.scaleFactor,-t)}}i._v3_1.setFromMatrixPosition(i._cameraMatrixState);var r=i._v3_1.distanceTo(i._gizmos.position),n=r/a;n=ns.clamp(n,i.minDistance,i.maxDistance);var o=r*Math.tan(.5*(ns.DEG2RAD*i.camera.fov)),s=ns.RAD2DEG*(2*Math.atan(o/n));if(s>i.maxFov){s=i.maxFov}else if(s<i.minFov){s=i.minFov}var u=o/Math.tan(ns.DEG2RAD*(s/2));a=r/u;i.setFov(s);i.applyTransformMatrix(i.scale(a,i._gizmos.position,!1))}if(null!=i._grid){i.disposeGrid();i.drawGrid()}i.updateTbState(Kf.IDLE,!1);i.dispatchEvent(ah);i.dispatchEvent(ih);break;}}}});_defineProperty2(_assertThisInitialized(i),"onKeyDown",function(e){if("c"==e.key){if(e.ctrlKey||e.metaKey){i.copyState()}}else if("v"==e.key){if(e.ctrlKey||e.metaKey){i.pasteState()}}});_defineProperty2(_assertThisInitialized(i),"onSinglePanStart",function(e,t){if(i.enabled){i.dispatchEvent(rh);i.setCenter(e.clientX,e.clientY);switch(t){case"PAN":if(!i.enablePan){return}if(-1!=i._animationId){cancelAnimationFrame(i._animationId);i._animationId=-1;i._timeStart=-1;i.activateGizmos(!1);i.dispatchEvent(ah)}i.updateTbState(Kf.PAN,!0);i._startCursorPosition.copy(i.unprojectOnTbPlane(i.camera,eh.x,eh.y,i.domElement));if(i.enableGrid){i.drawGrid();i.dispatchEvent(ah)}break;case"ROTATE":if(!i.enableRotate){return}if(-1!=i._animationId){cancelAnimationFrame(i._animationId);i._animationId=-1;i._timeStart=-1}i.updateTbState(Kf.ROTATE,!0);i._startCursorPosition.copy(i.unprojectOnTbSurface(i.camera,eh.x,eh.y,i.domElement,i._tbRadius));i.activateGizmos(!0);if(i.enableAnimations){i._timePrev=i._timeCurrent=performance.now();i._angleCurrent=i._anglePrev=0;i._cursorPosPrev.copy(i._startCursorPosition);i._cursorPosCurr.copy(i._cursorPosPrev);i._wCurr=0;i._wPrev=i._wCurr}i.dispatchEvent(ah);break;case"FOV":if(!i.camera.isPerspectiveCamera||!i.enableZoom){return}if(-1!=i._animationId){cancelAnimationFrame(i._animationId);i._animationId=-1;i._timeStart=-1;i.activateGizmos(!1);i.dispatchEvent(ah)}i.updateTbState(Kf.FOV,!0);i._startCursorPosition.setY(.5*i.getCursorNDC(eh.x,eh.y,i.domElement).y);i._currentCursorPosition.copy(i._startCursorPosition);break;case"ZOOM":if(!i.enableZoom){return}if(-1!=i._animationId){cancelAnimationFrame(i._animationId);i._animationId=-1;i._timeStart=-1;i.activateGizmos(!1);i.dispatchEvent(ah)}i.updateTbState(Kf.SCALE,!0);i._startCursorPosition.setY(.5*i.getCursorNDC(eh.x,eh.y,i.domElement).y);i._currentCursorPosition.copy(i._startCursorPosition);break;}}});_defineProperty2(_assertThisInitialized(i),"onSinglePanMove",function(e,t){if(i.enabled){var g=t!=i._state;i.setCenter(e.clientX,e.clientY);switch(t){case Kf.PAN:if(i.enablePan){if(g){i.dispatchEvent(ih);i.dispatchEvent(rh);i.updateTbState(t,!0);i._startCursorPosition.copy(i.unprojectOnTbPlane(i.camera,eh.x,eh.y,i.domElement));if(i.enableGrid){i.drawGrid()}i.activateGizmos(!1)}else{i._currentCursorPosition.copy(i.unprojectOnTbPlane(i.camera,eh.x,eh.y,i.domElement));i.applyTransformMatrix(i.pan(i._startCursorPosition,i._currentCursorPosition))}}break;case Kf.ROTATE:if(i.enableRotate){if(g){i.dispatchEvent(ih);i.dispatchEvent(rh);i.updateTbState(t,!0);i._startCursorPosition.copy(i.unprojectOnTbSurface(i.camera,eh.x,eh.y,i.domElement,i._tbRadius));if(i.enableGrid){i.disposeGrid()}i.activateGizmos(!0)}else{i._currentCursorPosition.copy(i.unprojectOnTbSurface(i.camera,eh.x,eh.y,i.domElement,i._tbRadius));var a=i._startCursorPosition.distanceTo(i._currentCursorPosition),r=i._startCursorPosition.angleTo(i._currentCursorPosition),n=Math.max(a/i._tbRadius,r);i.applyTransformMatrix(i.rotate(i.calculateRotationAxis(i._startCursorPosition,i._currentCursorPosition),n));if(i.enableAnimations){i._timePrev=i._timeCurrent;i._timeCurrent=performance.now();i._anglePrev=i._angleCurrent;i._angleCurrent=n;i._cursorPosPrev.copy(i._cursorPosCurr);i._cursorPosCurr.copy(i._currentCursorPosition);i._wPrev=i._wCurr;i._wCurr=i.calculateAngularSpeed(i._anglePrev,i._angleCurrent,i._timePrev,i._timeCurrent)}}}break;case Kf.SCALE:if(i.enableZoom){if(g){i.dispatchEvent(ih);i.dispatchEvent(rh);i.updateTbState(t,!0);i._startCursorPosition.setY(.5*i.getCursorNDC(eh.x,eh.y,i.domElement).y);i._currentCursorPosition.copy(i._startCursorPosition);if(i.enableGrid){i.disposeGrid()}i.activateGizmos(!1)}else{i._currentCursorPosition.setY(.5*i.getCursorNDC(eh.x,eh.y,i.domElement).y);var o=i._currentCursorPosition.y-i._startCursorPosition.y,s=1;if(0>o){s=1/Math.pow(i.scaleFactor,-o*8)}else if(0<o){s=Math.pow(i.scaleFactor,o*8)}i.applyTransformMatrix(i.scale(s,i._gizmos.position))}}break;case Kf.FOV:if(i.enableZoom&&i.camera.isPerspectiveCamera){if(g){i.dispatchEvent(ih);i.dispatchEvent(rh);i.updateTbState(t,!0);i._startCursorPosition.setY(.5*i.getCursorNDC(eh.x,eh.y,i.domElement).y);i._currentCursorPosition.copy(i._startCursorPosition);if(i.enableGrid){i.disposeGrid()}i.activateGizmos(!1)}else{i._currentCursorPosition.setY(.5*i.getCursorNDC(eh.x,eh.y,i.domElement).y);var l=i._currentCursorPosition.y-i._startCursorPosition.y,d=1;if(0>l){d=1/Math.pow(i.scaleFactor,-l*8)}else if(0<l){d=Math.pow(i.scaleFactor,l*8)}i._v3_1.setFromMatrixPosition(i._cameraMatrixState);var c=i._v3_1.distanceTo(i._gizmos.position),u=c/d;u=ns.clamp(u,i.minDistance,i.maxDistance);var p=c*Math.tan(.5*(ns.DEG2RAD*i._fovState)),m=ns.RAD2DEG*(2*Math.atan(p/u));m=ns.clamp(m,i.minFov,i.maxFov);var f=p/Math.tan(ns.DEG2RAD*(m/2));d=c/f;i._v3_2.setFromMatrixPosition(i._gizmoMatrixState);i.setFov(m);i.applyTransformMatrix(i.scale(d,i._v3_2,!1));oh.copy(i._gizmos.position).sub(i.camera.position).normalize().multiplyScalar(f/c);i._m4_1.makeTranslation(oh.x,oh.y,oh.z)}}break;}i.dispatchEvent(ah)}});_defineProperty2(_assertThisInitialized(i),"onSinglePanEnd",function(){if(i._state==Kf.ROTATE){if(!i.enableRotate){return}if(i.enableAnimations){var r=performance.now()-i._timeCurrent;if(120>r){var e=Math.abs((i._wPrev+i._wCurr)/2),a=_assertThisInitialized(i);i._animationId=window.requestAnimationFrame(function(r){a.updateTbState(Kf.ANIMATION_ROTATE,!0);var t=a.calculateRotationAxis(a._cursorPosPrev,a._cursorPosCurr);a.onRotationAnim(r,t,Math.min(e,a.wMax))})}else{i.updateTbState(Kf.IDLE,!1);i.activateGizmos(!1);i.dispatchEvent(ah)}}else{i.updateTbState(Kf.IDLE,!1);i.activateGizmos(!1);i.dispatchEvent(ah)}}else if(i._state==Kf.PAN||i._state==Kf.IDLE){i.updateTbState(Kf.IDLE,!1);if(i.enableGrid){i.disposeGrid()}i.activateGizmos(!1);i.dispatchEvent(ah)}i.dispatchEvent(ih)});_defineProperty2(_assertThisInitialized(i),"onDoubleTap",function(e){if(i.enabled&&i.enablePan&&null!=i.scene){i.dispatchEvent(rh);i.setCenter(e.clientX,e.clientY);var a=i.unprojectOnObj(i.getCursorNDC(eh.x,eh.y,i.domElement),i.camera);if(null!=a&&i.enableAnimations){var r=_assertThisInitialized(i);if(-1!=i._animationId){window.cancelAnimationFrame(i._animationId)}i._timeStart=-1;i._animationId=window.requestAnimationFrame(function(e){r.updateTbState(Kf.ANIMATION_FOCUS,!0);r.onFocusAnim(e,a,r._cameraMatrixState,r._gizmoMatrixState)})}else if(null!=a&&!i.enableAnimations){i.updateTbState(Kf.FOCUS,!0);i.focus(a,i.scaleFactor);i.updateTbState(Kf.IDLE,!1);i.dispatchEvent(ah)}}i.dispatchEvent(ih)});_defineProperty2(_assertThisInitialized(i),"onDoublePanStart",function(){if(i.enabled&&i.enablePan){i.dispatchEvent(rh);i.updateTbState(Kf.PAN,!0);i.setCenter((i._touchCurrent[0].clientX+i._touchCurrent[1].clientX)/2,(i._touchCurrent[0].clientY+i._touchCurrent[1].clientY)/2);i._startCursorPosition.copy(i.unprojectOnTbPlane(i.camera,eh.x,eh.y,i.domElement,!0));i._currentCursorPosition.copy(i._startCursorPosition);i.activateGizmos(!1)}});_defineProperty2(_assertThisInitialized(i),"onDoublePanMove",function(){if(i.enabled&&i.enablePan){i.setCenter((i._touchCurrent[0].clientX+i._touchCurrent[1].clientX)/2,(i._touchCurrent[0].clientY+i._touchCurrent[1].clientY)/2);if(i._state!=Kf.PAN){i.updateTbState(Kf.PAN,!0);i._startCursorPosition.copy(i._currentCursorPosition)}i._currentCursorPosition.copy(i.unprojectOnTbPlane(i.camera,eh.x,eh.y,i.domElement,!0));i.applyTransformMatrix(i.pan(i._startCursorPosition,i._currentCursorPosition,!0));i.dispatchEvent(ah)}});_defineProperty2(_assertThisInitialized(i),"onDoublePanEnd",function(){i.updateTbState(Kf.IDLE,!1);i.dispatchEvent(ih)});_defineProperty2(_assertThisInitialized(i),"onRotateStart",function(){if(i.enabled&&i.enableRotate){i.dispatchEvent(rh);i.updateTbState(Kf.ZROTATE,!0);i._startFingerRotation=i.getAngle(i._touchCurrent[1],i._touchCurrent[0])+i.getAngle(i._touchStart[1],i._touchStart[0]);i._currentFingerRotation=i._startFingerRotation;i.camera.getWorldDirection(i._rotationAxis);if(!i.enablePan&&!i.enableZoom){i.activateGizmos(!0)}}});_defineProperty2(_assertThisInitialized(i),"onRotateMove",function(){if(i.enabled&&i.enableRotate){i.setCenter((i._touchCurrent[0].clientX+i._touchCurrent[1].clientX)/2,(i._touchCurrent[0].clientY+i._touchCurrent[1].clientY)/2);var e;if(i._state!=Kf.ZROTATE){i.updateTbState(Kf.ZROTATE,!0);i._startFingerRotation=i._currentFingerRotation}i._currentFingerRotation=i.getAngle(i._touchCurrent[1],i._touchCurrent[0])+i.getAngle(i._touchStart[1],i._touchStart[0]);if(!i.enablePan){e=new vs().setFromMatrixPosition(i._gizmoMatrixState)}else{i._v3_2.setFromMatrixPosition(i._gizmoMatrixState);e=i.unprojectOnTbPlane(i.camera,eh.x,eh.y,i.domElement).applyQuaternion(i.camera.quaternion).multiplyScalar(1/i.camera.zoom).add(i._v3_2)}var t=ns.DEG2RAD*(i._startFingerRotation-i._currentFingerRotation);i.applyTransformMatrix(i.zRotate(e,t));i.dispatchEvent(ah)}});_defineProperty2(_assertThisInitialized(i),"onRotateEnd",function(){i.updateTbState(Kf.IDLE,!1);i.activateGizmos(!1);i.dispatchEvent(ih)});_defineProperty2(_assertThisInitialized(i),"onPinchStart",function(){if(i.enabled&&i.enableZoom){i.dispatchEvent(rh);i.updateTbState(Kf.SCALE,!0);i._startFingerDistance=i.calculatePointersDistance(i._touchCurrent[0],i._touchCurrent[1]);i._currentFingerDistance=i._startFingerDistance;i.activateGizmos(!1)}});_defineProperty2(_assertThisInitialized(i),"onPinchMove",function(){if(i.enabled&&i.enableZoom){i.setCenter((i._touchCurrent[0].clientX+i._touchCurrent[1].clientX)/2,(i._touchCurrent[0].clientY+i._touchCurrent[1].clientY)/2);if(i._state!=Kf.SCALE){i._startFingerDistance=i._currentFingerDistance;i.updateTbState(Kf.SCALE,!0)}i._currentFingerDistance=Math.max(i.calculatePointersDistance(i._touchCurrent[0],i._touchCurrent[1]),12*i._devPxRatio);var e=i._currentFingerDistance/i._startFingerDistance,t;if(!i.enablePan){t=i._gizmos.position}else{if(i.camera.isOrthographicCamera){t=i.unprojectOnTbPlane(i.camera,eh.x,eh.y,i.domElement).applyQuaternion(i.camera.quaternion).multiplyScalar(1/i.camera.zoom).add(i._gizmos.position)}else if(i.camera.isPerspectiveCamera){t=i.unprojectOnTbPlane(i.camera,eh.x,eh.y,i.domElement).applyQuaternion(i.camera.quaternion).add(i._gizmos.position)}}i.applyTransformMatrix(i.scale(e,t));i.dispatchEvent(ah)}});_defineProperty2(_assertThisInitialized(i),"onPinchEnd",function(){i.updateTbState(Kf.IDLE,!1);i.dispatchEvent(ih)});_defineProperty2(_assertThisInitialized(i),"onTriplePanStart",function(){if(i.enabled&&i.enableZoom){i.dispatchEvent(rh);i.updateTbState(Kf.SCALE,!0);for(var e=0,t=0,a=i._touchCurrent.length,r=0;r<a;r++){e+=i._touchCurrent[r].clientX;t+=i._touchCurrent[r].clientY}i.setCenter(e/a,t/a);i._startCursorPosition.setY(.5*i.getCursorNDC(eh.x,eh.y,i.domElement).y);i._currentCursorPosition.copy(i._startCursorPosition)}});_defineProperty2(_assertThisInitialized(i),"onTriplePanMove",function(){if(i.enabled&&i.enableZoom){for(var e=0,t=0,a=i._touchCurrent.length,r=0;r<a;r++){e+=i._touchCurrent[r].clientX;t+=i._touchCurrent[r].clientY}i.setCenter(e/a,t/a);i._currentCursorPosition.setY(.5*i.getCursorNDC(eh.x,eh.y,i.domElement).y);var n=i._currentCursorPosition.y-i._startCursorPosition.y,o=1;if(0>n){o=1/Math.pow(i.scaleFactor,-n*8)}else if(0<n){o=Math.pow(i.scaleFactor,n*8)}i._v3_1.setFromMatrixPosition(i._cameraMatrixState);var s=i._v3_1.distanceTo(i._gizmos.position),l=s/o;l=ns.clamp(l,i.minDistance,i.maxDistance);var d=s*Math.tan(.5*(ns.DEG2RAD*i._fovState)),c=ns.RAD2DEG*(2*Math.atan(d/l));c=ns.clamp(c,i.minFov,i.maxFov);var u=d/Math.tan(ns.DEG2RAD*(c/2));o=s/u;i._v3_2.setFromMatrixPosition(i._gizmoMatrixState);i.setFov(c);i.applyTransformMatrix(i.scale(o,i._v3_2,!1));oh.copy(i._gizmos.position).sub(i.camera.position).normalize().multiplyScalar(u/s);i._m4_1.makeTranslation(oh.x,oh.y,oh.z);i.dispatchEvent(ah)}});_defineProperty2(_assertThisInitialized(i),"onTriplePanEnd",function(){i.updateTbState(Kf.IDLE,!1);i.dispatchEvent(ih)});_defineProperty2(_assertThisInitialized(i),"setCenter",function(e,t){eh.x=e;eh.y=t});_defineProperty2(_assertThisInitialized(i),"initializeMouseActions",function(){i.setMouseAction("PAN",0,"CTRL");i.setMouseAction("PAN",2);i.setMouseAction("ROTATE",0);i.setMouseAction("ZOOM","WHEEL");i.setMouseAction("ZOOM",1);i.setMouseAction("FOV","WHEEL","SHIFT");i.setMouseAction("FOV",1,"SHIFT")});_defineProperty2(_assertThisInitialized(i),"compareMouseAction",function(e,t){if(e.operation==t.operation){if(e.mouse==t.mouse&&e.key==t.key){return!0}else{return!1}}else{return!1}});_defineProperty2(_assertThisInitialized(i),"setMouseAction",function(e,t){var a=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null,r;if(!["PAN","ROTATE","ZOOM","FOV"].includes(e)||![0,1,2,"WHEEL"].includes(t)||!["CTRL","SHIFT",null].includes(a)){return!1}if("WHEEL"==t){if("ZOOM"!=e&&"FOV"!=e){return!1}}switch(e){case"PAN":r=Kf.PAN;break;case"ROTATE":r=Kf.ROTATE;break;case"ZOOM":r=Kf.SCALE;break;case"FOV":r=Kf.FOV;break;}for(var n={operation:e,mouse:t,key:a,state:r},o=0;o<i.mouseActions.length;o++){if(i.mouseActions[o].mouse==n.mouse&&i.mouseActions[o].key==n.key){i.mouseActions.splice(o,1,n);return!0}}i.mouseActions.push(n);return!0});_defineProperty2(_assertThisInitialized(i),"unsetMouseAction",function(e){for(var t=1<arguments.length&&arguments[1]!==void 0?arguments[1]:null,a=0;a<i.mouseActions.length;a++){if(i.mouseActions[a].mouse==e&&i.mouseActions[a].key==t){i.mouseActions.splice(a,1);return!0}}return!1});_defineProperty2(_assertThisInitialized(i),"getOpFromAction",function(e,t){for(var a,r=0;r<i.mouseActions.length;r++){a=i.mouseActions[r];if(a.mouse==e&&a.key==t){return a.operation}}if(null!=t){for(var n=0;n<i.mouseActions.length;n++){a=i.mouseActions[n];if(a.mouse==e&&null==a.key){return a.operation}}}return null});_defineProperty2(_assertThisInitialized(i),"getOpStateFromAction",function(e,t){for(var a,r=0;r<i.mouseActions.length;r++){a=i.mouseActions[r];if(a.mouse==e&&a.key==t){return a.state}}if(null!=t){for(var n=0;n<i.mouseActions.length;n++){a=i.mouseActions[n];if(a.mouse==e&&null==a.key){return a.state}}}return null});_defineProperty2(_assertThisInitialized(i),"getAngle",function(e,t){return 180*Math.atan2(t.clientY-e.clientY,t.clientX-e.clientX)/Math.PI});_defineProperty2(_assertThisInitialized(i),"updateTouchEvent",function(e){for(var t=0;t<i._touchCurrent.length;t++){if(i._touchCurrent[t].pointerId==e.pointerId){i._touchCurrent.splice(t,1,e);break}}});_defineProperty2(_assertThisInitialized(i),"calculateAngularSpeed",function(e,a,r,i){var n=(i-r)/1e3;if(0==n){return 0}return(a-e)/n});_defineProperty2(_assertThisInitialized(i),"calculatePointersDistance",function(e,t){return Math.sqrt(Math.pow(t.clientX-e.clientX,2)+Math.pow(t.clientY-e.clientY,2))});_defineProperty2(_assertThisInitialized(i),"calculateRotationAxis",function(e,t){i._rotationMatrix.extractRotation(i._cameraMatrixState);i._quat.setFromRotationMatrix(i._rotationMatrix);i._rotationAxis.crossVectors(e,t).applyQuaternion(i._quat);return i._rotationAxis.normalize().clone()});_defineProperty2(_assertThisInitialized(i),"calculateTbRadius",function(e){var t=e.position.distanceTo(i._gizmos.position);if("PerspectiveCamera"==e.type){var a=.5*(ns.DEG2RAD*e.fov),r=Math.atan(e.aspect*Math.tan(a));return Math.tan(Math.min(a,r))*t*i.radiusFactor}else if("OrthographicCamera"==e.type){return Math.min(e.top,e.right)*i.radiusFactor}});_defineProperty2(_assertThisInitialized(i),"focus",function(e,t){var a=2<arguments.length&&arguments[2]!==void 0?arguments[2]:1;oh.copy(e).sub(i._gizmos.position).multiplyScalar(a);i._translationMatrix.makeTranslation(oh.x,oh.y,oh.z);var r=i._gizmoMatrixState.clone();i._gizmoMatrixState.premultiply(i._translationMatrix);i._gizmoMatrixState.decompose(i._gizmos.position,i._gizmos.quaternion,i._gizmos.scale);var n=i._cameraMatrixState.clone();i._cameraMatrixState.premultiply(i._translationMatrix);i._cameraMatrixState.decompose(i.camera.position,i.camera.quaternion,i.camera.scale);if(i.enableZoom){i.applyTransformMatrix(i.scale(t,i._gizmos.position))}i._gizmoMatrixState.copy(r);i._cameraMatrixState.copy(n)});_defineProperty2(_assertThisInitialized(i),"drawGrid",function(){if(null!=i.scene){var e=3,t,a,r,n;if(i.camera.isOrthographicCamera){var o=i.camera.right-i.camera.left,s=i.camera.bottom-i.camera.top;r=Math.max(o,s);n=r/20;t=r/i.camera.zoom*e;a=t/n*i.camera.zoom}else if(i.camera.isPerspectiveCamera){var l=i.camera.position.distanceTo(i._gizmos.position),d=.5*(ns.DEG2RAD*i.camera.fov),c=Math.atan(i.camera.aspect*Math.tan(d));r=2*(Math.tan(Math.max(d,c))*l);n=r/20;t=r*e;a=t/n}if(null==i._grid){i._grid=new Vg(t,a,8947848,8947848);i._grid.position.copy(i._gizmos.position);i._gridPosition.copy(i._grid.position);i._grid.quaternion.copy(i.camera.quaternion);i._grid.rotateX(.5*Math.PI);i.scene.add(i._grid)}}});_defineProperty2(_assertThisInitialized(i),"dispose",function(){if(-1!=i._animationId){window.cancelAnimationFrame(i._animationId)}i.domElement.removeEventListener("pointerdown",i.onPointerDown);i.domElement.removeEventListener("pointercancel",i.onPointerCancel);i.domElement.removeEventListener("wheel",i.onWheel);i.domElement.removeEventListener("contextmenu",i.onContextMenu);window.removeEventListener("pointermove",i.onPointerMove);window.removeEventListener("pointerup",i.onPointerUp);window.removeEventListener("resize",i.onWindowResize);window.removeEventListener("keydown",i.onKeyDown);if(null!==i.scene)i.scene.remove(i._gizmos);i.disposeGrid()});_defineProperty2(_assertThisInitialized(i),"disposeGrid",function(){if(null!=i._grid&&null!=i.scene){i.scene.remove(i._grid);i._grid=null}});_defineProperty2(_assertThisInitialized(i),"easeOutCubic",function(e){return 1-Math.pow(1-e,3)});_defineProperty2(_assertThisInitialized(i),"activateGizmos",function(e){var t=i._gizmos.children[0],a=i._gizmos.children[1],r=i._gizmos.children[2];if(e){t.material.setValues({opacity:1});a.material.setValues({opacity:1});r.material.setValues({opacity:1})}else{t.material.setValues({opacity:.6});a.material.setValues({opacity:.6});r.material.setValues({opacity:.6})}});_defineProperty2(_assertThisInitialized(i),"getCursorNDC",function(e,t,a){var r=a.getBoundingClientRect();i._v2_1.setX(2*((e-r.left)/r.width)-1);i._v2_1.setY(2*((r.bottom-t)/r.height)-1);return i._v2_1.clone()});_defineProperty2(_assertThisInitialized(i),"getCursorPosition",function(e,t,a){i._v2_1.copy(i.getCursorNDC(e,t,a));i._v2_1.x*=.5*(i.camera.right-i.camera.left);i._v2_1.y*=.5*(i.camera.top-i.camera.bottom);return i._v2_1.clone()});_defineProperty2(_assertThisInitialized(i),"setCamera",function(e){e.lookAt(i.target);e.updateMatrix();if("PerspectiveCamera"==e.type){i._fov0=e.fov;i._fovState=e.fov}i._cameraMatrixState0.copy(e.matrix);i._cameraMatrixState.copy(i._cameraMatrixState0);i._cameraProjectionState.copy(e.projectionMatrix);i._zoom0=e.zoom;i._zoomState=i._zoom0;i._initialNear=e.near;i._nearPos0=e.position.distanceTo(i.target)-e.near;i._nearPos=i._initialNear;i._initialFar=e.far;i._farPos0=e.position.distanceTo(i.target)-e.far;i._farPos=i._initialFar;i._up0.copy(e.up);i._upState.copy(e.up);i.camera=e;i.camera.updateProjectionMatrix();i._tbRadius=i.calculateTbRadius(e);i.makeGizmos(i.target,i._tbRadius)});_defineProperty2(_assertThisInitialized(i),"makeGizmos",function(e,t){var a=new Xu(0,0,t,t),r=a.getPoints(i._curvePts),n=new rd().setFromPoints(r),o=new hu({color:16744576,fog:!1,transparent:!0,opacity:.6}),s=new hu({color:8454016,fog:!1,transparent:!0,opacity:.6}),l=new hu({color:8421631,fog:!1,transparent:!0,opacity:.6}),d=new Su(n,o),c=new Su(n,s),u=new Su(n,l),p=.5*Math.PI;d.rotation.x=p;c.rotation.y=p;i._gizmoMatrixState0.identity().setPosition(e);i._gizmoMatrixState.copy(i._gizmoMatrixState0);if(1!=i.camera.zoom){var m=1/i.camera.zoom;i._scaleMatrix.makeScale(m,m,m);i._translationMatrix.makeTranslation(-e.x,-e.y,-e.z);i._gizmoMatrixState.premultiply(i._translationMatrix).premultiply(i._scaleMatrix);i._translationMatrix.makeTranslation(e.x,e.y,e.z);i._gizmoMatrixState.premultiply(i._translationMatrix)}i._gizmoMatrixState.decompose(i._gizmos.position,i._gizmos.quaternion,i._gizmos.scale);i._gizmos.clear();i._gizmos.add(d);i._gizmos.add(c);i._gizmos.add(u)});_defineProperty2(_assertThisInitialized(i),"onFocusAnim",function(e,a,r,n){if(-1==i._timeStart){i._timeStart=e}if(i._state==Kf.ANIMATION_FOCUS){var o=e-i._timeStart,s=o/i.focusAnimationTime;i._gizmoMatrixState.copy(n);if(1<=s){i._gizmoMatrixState.decompose(i._gizmos.position,i._gizmos.quaternion,i._gizmos.scale);i.focus(a,i.scaleFactor);i._timeStart=-1;i.updateTbState(Kf.IDLE,!1);i.activateGizmos(!1);i.dispatchEvent(ah)}else{var l=i.easeOutCubic(s),d=1-l+i.scaleFactor*l;i._gizmoMatrixState.decompose(i._gizmos.position,i._gizmos.quaternion,i._gizmos.scale);i.focus(a,d,l);i.dispatchEvent(ah);var c=_assertThisInitialized(i);i._animationId=window.requestAnimationFrame(function(e){c.onFocusAnim(e,a,r,n.clone())})}}else{i._animationId=-1;i._timeStart=-1}});_defineProperty2(_assertThisInitialized(i),"onRotationAnim",function(e,a,r){if(-1==i._timeStart){i._anglePrev=0;i._angleCurrent=0;i._timeStart=e}if(i._state==Kf.ANIMATION_ROTATE){var t=(e-i._timeStart)/1e3,n=r+-i.dampingFactor*t;if(0<n){i._angleCurrent=.5*-i.dampingFactor*Math.pow(t,2)+r*t+0;i.applyTransformMatrix(i.rotate(a,i._angleCurrent));i.dispatchEvent(ah);var o=_assertThisInitialized(i);i._animationId=window.requestAnimationFrame(function(e){o.onRotationAnim(e,a,r)})}else{i._animationId=-1;i._timeStart=-1;i.updateTbState(Kf.IDLE,!1);i.activateGizmos(!1);i.dispatchEvent(ah)}}else{i._animationId=-1;i._timeStart=-1;if(i._state!=Kf.ROTATE){i.activateGizmos(!1);i.dispatchEvent(ah)}}});_defineProperty2(_assertThisInitialized(i),"pan",function(e,t){var a=2<arguments.length&&arguments[2]!==void 0?arguments[2]:!1,r=e.clone().sub(t);if(i.camera.isOrthographicCamera){r.multiplyScalar(1/i.camera.zoom)}else if(i.camera.isPerspectiveCamera&&a){i._v3_1.setFromMatrixPosition(i._cameraMatrixState0);i._v3_2.setFromMatrixPosition(i._gizmoMatrixState0);var n=i._v3_1.distanceTo(i._v3_2)/i.camera.position.distanceTo(i._gizmos.position);r.multiplyScalar(1/n)}i._v3_1.set(r.x,r.y,0).applyQuaternion(i.camera.quaternion);i._m4_1.makeTranslation(i._v3_1.x,i._v3_1.y,i._v3_1.z);i.setTransformationMatrices(i._m4_1,i._m4_1);return th});_defineProperty2(_assertThisInitialized(i),"reset",function(){i.camera.zoom=i._zoom0;if(i.camera.isPerspectiveCamera){i.camera.fov=i._fov0}i.camera.near=i._nearPos;i.camera.far=i._farPos;i._cameraMatrixState.copy(i._cameraMatrixState0);i._cameraMatrixState.decompose(i.camera.position,i.camera.quaternion,i.camera.scale);i.camera.up.copy(i._up0);i.camera.updateMatrix();i.camera.updateProjectionMatrix();i._gizmoMatrixState.copy(i._gizmoMatrixState0);i._gizmoMatrixState0.decompose(i._gizmos.position,i._gizmos.quaternion,i._gizmos.scale);i._gizmos.updateMatrix();i._tbRadius=i.calculateTbRadius(i.camera);i.makeGizmos(i._gizmos.position,i._tbRadius);i.camera.lookAt(i._gizmos.position);i.updateTbState(Kf.IDLE,!1);i.dispatchEvent(ah)});_defineProperty2(_assertThisInitialized(i),"rotate",function(e,t){var a=i._gizmos.position;i._translationMatrix.makeTranslation(-a.x,-a.y,-a.z);i._rotationMatrix.makeRotationAxis(e,-t);i._m4_1.makeTranslation(a.x,a.y,a.z);i._m4_1.multiply(i._rotationMatrix);i._m4_1.multiply(i._translationMatrix);i.setTransformationMatrices(i._m4_1);return th});_defineProperty2(_assertThisInitialized(i),"copyState",function(){var e;if(i.camera.isOrthographicCamera){e=JSON.stringify({arcballState:{cameraFar:i.camera.far,cameraMatrix:i.camera.matrix,cameraNear:i.camera.near,cameraUp:i.camera.up,cameraZoom:i.camera.zoom,gizmoMatrix:i._gizmos.matrix}})}else if(i.camera.isPerspectiveCamera){e=JSON.stringify({arcballState:{cameraFar:i.camera.far,cameraFov:i.camera.fov,cameraMatrix:i.camera.matrix,cameraNear:i.camera.near,cameraUp:i.camera.up,cameraZoom:i.camera.zoom,gizmoMatrix:i._gizmos.matrix}})}navigator.clipboard.writeText(e)});_defineProperty2(_assertThisInitialized(i),"pasteState",function(){var e=_assertThisInitialized(i);navigator.clipboard.readText().then(function(t){e.setStateFromJSON(t)})});_defineProperty2(_assertThisInitialized(i),"saveState",function(){i._cameraMatrixState0.copy(i.camera.matrix);i._gizmoMatrixState0.copy(i._gizmos.matrix);i._nearPos=i.camera.near;i._farPos=i.camera.far;i._zoom0=i.camera.zoom;i._up0.copy(i.camera.up);if(i.camera.isPerspectiveCamera){i._fov0=i.camera.fov}});_defineProperty2(_assertThisInitialized(i),"scale",function(e,t){var a=2<arguments.length&&arguments[2]!==void 0?arguments[2]:!0,r=t.clone(),n=1/e;if(i.camera.isOrthographicCamera){i.camera.zoom=i._zoomState;i.camera.zoom*=e;if(i.camera.zoom>i.maxZoom){i.camera.zoom=i.maxZoom;n=i._zoomState/i.maxZoom}else if(i.camera.zoom<i.minZoom){i.camera.zoom=i.minZoom;n=i._zoomState/i.minZoom}i.camera.updateProjectionMatrix();i._v3_1.setFromMatrixPosition(i._gizmoMatrixState);i._scaleMatrix.makeScale(n,n,n);i._translationMatrix.makeTranslation(-i._v3_1.x,-i._v3_1.y,-i._v3_1.z);i._m4_2.makeTranslation(i._v3_1.x,i._v3_1.y,i._v3_1.z).multiply(i._scaleMatrix);i._m4_2.multiply(i._translationMatrix);r.sub(i._v3_1);var d=r.clone().multiplyScalar(n);r.sub(d);i._m4_1.makeTranslation(r.x,r.y,r.z);i._m4_2.premultiply(i._m4_1);i.setTransformationMatrices(i._m4_1,i._m4_2);return th}else if(i.camera.isPerspectiveCamera){i._v3_1.setFromMatrixPosition(i._cameraMatrixState);i._v3_2.setFromMatrixPosition(i._gizmoMatrixState);var o=i._v3_1.distanceTo(r),s=o-o*n,l=o-s;if(l<i.minDistance){n=i.minDistance/o;s=o-o*n}else if(l>i.maxDistance){n=i.maxDistance/o;s=o-o*n}oh.copy(r).sub(i._v3_1).normalize().multiplyScalar(s);i._m4_1.makeTranslation(oh.x,oh.y,oh.z);if(a){var c=i._v3_2;o=c.distanceTo(r);s=o-o*n;oh.copy(r).sub(i._v3_2).normalize().multiplyScalar(s);i._translationMatrix.makeTranslation(c.x,c.y,c.z);i._scaleMatrix.makeScale(n,n,n);i._m4_2.makeTranslation(oh.x,oh.y,oh.z).multiply(i._translationMatrix);i._m4_2.multiply(i._scaleMatrix);i._translationMatrix.makeTranslation(-c.x,-c.y,-c.z);i._m4_2.multiply(i._translationMatrix);i.setTransformationMatrices(i._m4_1,i._m4_2)}else{i.setTransformationMatrices(i._m4_1)}return th}});_defineProperty2(_assertThisInitialized(i),"setFov",function(e){if(i.camera.isPerspectiveCamera){i.camera.fov=ns.clamp(e,i.minFov,i.maxFov);i.camera.updateProjectionMatrix()}});_defineProperty2(_assertThisInitialized(i),"setTarget",function(e,t,a){i.target.set(e,t,a);i._gizmos.position.set(e,t,a);i._tbRadius=i.calculateTbRadius(i.camera);i.makeGizmos(i.target,i._tbRadius);i.camera.lookAt(i.target)});_defineProperty2(_assertThisInitialized(i),"zRotate",function(e,t){i._rotationMatrix.makeRotationAxis(i._rotationAxis,t);i._translationMatrix.makeTranslation(-e.x,-e.y,-e.z);i._m4_1.makeTranslation(e.x,e.y,e.z);i._m4_1.multiply(i._rotationMatrix);i._m4_1.multiply(i._translationMatrix);i._v3_1.setFromMatrixPosition(i._gizmoMatrixState).sub(e);i._v3_2.copy(i._v3_1).applyAxisAngle(i._rotationAxis,t);i._v3_2.sub(i._v3_1);i._m4_2.makeTranslation(i._v3_2.x,i._v3_2.y,i._v3_2.z);i.setTransformationMatrices(i._m4_1,i._m4_2);return th});_defineProperty2(_assertThisInitialized(i),"unprojectOnObj",function(e,t){var a=i.getRaycaster();a.near=t.near;a.far=t.far;a.setFromCamera(e,t);for(var r=a.intersectObjects(i.scene.children,!0),n=0;n<r.length;n++){if(r[n].object.uuid!=i._gizmos.uuid&&null!=r[n].face){return r[n].point.clone()}}return null});_defineProperty2(_assertThisInitialized(i),"unprojectOnTbSurface",function(e,t,r,n,o){if("OrthographicCamera"==e.type){i._v2_1.copy(i.getCursorPosition(t,r,n));i._v3_1.set(i._v2_1.x,i._v2_1.y,0);var s=Math.pow(i._v2_1.x,2),d=Math.pow(i._v2_1.y,2),u=Math.pow(i._tbRadius,2);if(s+d<=.5*u){i._v3_1.setZ(Math.sqrt(u-(s+d)))}else{i._v3_1.setZ(.5*u/Math.sqrt(s+d))}return i._v3_1}else if("PerspectiveCamera"==e.type){i._v2_1.copy(i.getCursorNDC(t,r,n));i._v3_1.set(i._v2_1.x,i._v2_1.y,-1);i._v3_1.applyMatrix4(e.projectionMatrixInverse);var p=i._v3_1.clone().normalize(),g=e.position.distanceTo(i._gizmos.position),f=Math.pow(o,2),y=i._v3_1.z,h=Math.sqrt(Math.pow(i._v3_1.x,2)+Math.pow(i._v3_1.y,2));if(0==h){p.set(i._v3_1.x,i._v3_1.y,o);return p}var l=y/h,m=g,v=Math.pow(l,2)+1,_=2*l*m,x=Math.pow(m,2)-f,S=Math.pow(_,2)-4*v*x;if(0<=S){i._v2_1.setX((-_-Math.sqrt(S))/(2*v));i._v2_1.setY(l*i._v2_1.x+m);var M=ns.RAD2DEG*i._v2_1.angle();if(45<=M){var T=Math.sqrt(Math.pow(i._v2_1.x,2)+Math.pow(g-i._v2_1.y,2));p.multiplyScalar(T);p.z+=g;return p}}v=l;_=m;x=.5*-f;S=Math.pow(_,2)-4*v*x;i._v2_1.setX((-_-Math.sqrt(S))/(2*v));i._v2_1.setY(l*i._v2_1.x+m);var E=Math.sqrt(Math.pow(i._v2_1.x,2)+Math.pow(g-i._v2_1.y,2));p.multiplyScalar(E);p.z+=g;return p}});_defineProperty2(_assertThisInitialized(i),"unprojectOnTbPlane",function(e,t,a,r){var n=4<arguments.length&&arguments[4]!==void 0?arguments[4]:!1;if("OrthographicCamera"==e.type){i._v2_1.copy(i.getCursorPosition(t,a,r));i._v3_1.set(i._v2_1.x,i._v2_1.y,0);return i._v3_1.clone()}else if("PerspectiveCamera"==e.type){i._v2_1.copy(i.getCursorNDC(t,a,r));i._v3_1.set(i._v2_1.x,i._v2_1.y,-1);i._v3_1.applyMatrix4(e.projectionMatrixInverse);var o=i._v3_1.clone().normalize(),s=i._v3_1.z,d=Math.sqrt(Math.pow(i._v3_1.x,2)+Math.pow(i._v3_1.y,2)),l;if(n){l=i._v3_1.setFromMatrixPosition(i._cameraMatrixState0).distanceTo(i._v3_2.setFromMatrixPosition(i._gizmoMatrixState0))}else{l=e.position.distanceTo(i._gizmos.position)}if(0==d){o.set(0,0,0);return o}var c=l,u=Math.sqrt(Math.pow(c,2)+Math.pow(-c/(s/d),2));o.multiplyScalar(u);o.z=0;return o}});_defineProperty2(_assertThisInitialized(i),"updateMatrixState",function(){i._cameraMatrixState.copy(i.camera.matrix);i._gizmoMatrixState.copy(i._gizmos.matrix);if(i.camera.isOrthographicCamera){i._cameraProjectionState.copy(i.camera.projectionMatrix);i.camera.updateProjectionMatrix();i._zoomState=i.camera.zoom}else if(i.camera.isPerspectiveCamera){i._fovState=i.camera.fov}});_defineProperty2(_assertThisInitialized(i),"updateTbState",function(e,t){i._state=e;if(t){i.updateMatrixState()}});_defineProperty2(_assertThisInitialized(i),"update",function(){var e=1e-6;if(i.camera.isOrthographicCamera){if(i.camera.zoom>i.maxZoom||i.camera.zoom<i.minZoom){var s=ns.clamp(i.camera.zoom,i.minZoom,i.maxZoom);i.applyTransformMatrix(i.scale(s/i.camera.zoom,i._gizmos.position,!0))}}else if(i.camera.isPerspectiveCamera){var l=i.camera.position.distanceTo(i._gizmos.position);if(l>i.maxDistance+e||l<i.minDistance-e){var d=ns.clamp(l,i.minDistance,i.maxDistance);i.applyTransformMatrix(i.scale(d/l,i._gizmos.position));i.updateMatrixState()}if(i.camera.fov<i.minFov||i.camera.fov>i.maxFov){i.camera.fov=ns.clamp(i.camera.fov,i.minFov,i.maxFov);i.camera.updateProjectionMatrix()}var c=i._tbRadius;i._tbRadius=i.calculateTbRadius(i.camera);if(c<i._tbRadius-e||c>i._tbRadius+e){var t=(i._gizmos.scale.x+i._gizmos.scale.y+i._gizmos.scale.z)/3,a=i._tbRadius/t,r=new Xu(0,0,a,a),n=r.getPoints(i._curvePts),o=new rd().setFromPoints(n);for(var u in i._gizmos.children){i._gizmos.children[u].geometry=o}}}i.camera.lookAt(i._gizmos.position)});_defineProperty2(_assertThisInitialized(i),"setStateFromJSON",function(e){var t=JSON.parse(e);if(t.arcballState!=void 0){i._cameraMatrixState.fromArray(t.arcballState.cameraMatrix.elements);i._cameraMatrixState.decompose(i.camera.position,i.camera.quaternion,i.camera.scale);i.camera.up.copy(t.arcballState.cameraUp);i.camera.near=t.arcballState.cameraNear;i.camera.far=t.arcballState.cameraFar;i.camera.zoom=t.arcballState.cameraZoom;if(i.camera.isPerspectiveCamera){i.camera.fov=t.arcballState.cameraFov}i._gizmoMatrixState.fromArray(t.arcballState.gizmoMatrix.elements);i._gizmoMatrixState.decompose(i._gizmos.position,i._gizmos.quaternion,i._gizmos.scale);i.camera.updateMatrix();i.camera.updateProjectionMatrix();i._gizmos.updateMatrix();i._tbRadius=i.calculateTbRadius(i.camera);var a=new Ys().copy(i._gizmoMatrixState0);i.makeGizmos(i._gizmos.position,i._tbRadius);i._gizmoMatrixState0.copy(a);i.camera.lookAt(i._gizmos.position);i.updateTbState(Kf.IDLE,!1);i.dispatchEvent(ah)}});i.camera=null;i.domElement=r;i.scene=n;i.target=new vs(0,0,0);i.radiusFactor=.67;i.mouseActions=[];i._mouseOp=null;i._v2_1=new os;i._v3_1=new vs;i._v3_2=new vs;i._m4_1=new Ys;i._m4_2=new Ys;i._quat=new ys;i._translationMatrix=new Ys;i._rotationMatrix=new Ys;i._scaleMatrix=new Ys;i._rotationAxis=new vs;i._cameraMatrixState=new Ys;i._cameraProjectionState=new Ys;i._fovState=1;i._upState=new vs;i._zoomState=1;i._nearPos=0;i._farPos=0;i._gizmoMatrixState=new Ys;i._up0=new vs;i._zoom0=1;i._fov0=0;i._initialNear=0;i._nearPos0=0;i._initialFar=0;i._farPos0=0;i._cameraMatrixState0=new Ys;i._gizmoMatrixState0=new Ys;i._button=-1;i._touchStart=[];i._touchCurrent=[];i._input=$f.NONE;i._switchSensibility=32;i._startFingerDistance=0;i._currentFingerDistance=0;i._startFingerRotation=0;i._currentFingerRotation=0;i._devPxRatio=0;i._downValid=!0;i._nclicks=0;i._downEvents=[];i._downStart=0;i._clickStart=0;i._maxDownTime=250;i._maxInterval=300;i._posThreshold=24;i._movementThreshold=24;i._currentCursorPosition=new vs;i._startCursorPosition=new vs;i._grid=null;i._gridPosition=new vs;i._gizmos=new Mc;i._curvePts=128;i._timeStart=-1;i._animationId=-1;i.focusAnimationTime=500;i._timePrev=0;i._timeCurrent=0;i._anglePrev=0;i._angleCurrent=0;i._cursorPosPrev=new vs;i._cursorPosCurr=new vs;i._wPrev=0;i._wCurr=0;i.adjustNearFar=!1;i.scaleFactor=1.1;i.dampingFactor=25;i.wMax=20;i.enableAnimations=!0;i.enableGrid=!1;i.cursorZoom=!1;i.minFov=5;i.maxFov=90;i.enabled=!0;i.enablePan=!0;i.enableRotate=!0;i.enableZoom=!0;i.enableGizmos=!0;i.minDistance=0;i.maxDistance=1/0;i.minZoom=0;i.maxZoom=1/0;i._tbRadius=1;i._state=Kf.IDLE;i.setCamera(e);if(null!=i.scene){i.scene.add(i._gizmos)}i.domElement.style.touchAction="none";i._devPxRatio=window.devicePixelRatio;i.initializeMouseActions();i.domElement.addEventListener("contextmenu",i.onContextMenu);i.domElement.addEventListener("wheel",i.onWheel);i.domElement.addEventListener("pointerdown",i.onPointerDown);i.domElement.addEventListener("pointercancel",i.onPointerCancel);window.addEventListener("keydown",i.onKeyDown);window.addEventListener("resize",i.onWindowResize);return i}_createClass2(t,[{key:"applyTransformMatrix",value:function applyTransformMatrix(e){if(null!=e.camera){this._m4_1.copy(this._cameraMatrixState).premultiply(e.camera);this._m4_1.decompose(this.camera.position,this.camera.quaternion,this.camera.scale);this.camera.updateMatrix();if(this._state==Kf.ROTATE||this._state==Kf.ZROTATE||this._state==Kf.ANIMATION_ROTATE){this.camera.up.copy(this._upState).applyQuaternion(this.camera.quaternion)}}if(null!=e.gizmos){this._m4_1.copy(this._gizmoMatrixState).premultiply(e.gizmos);this._m4_1.decompose(this._gizmos.position,this._gizmos.quaternion,this._gizmos.scale);this._gizmos.updateMatrix()}if(this._state==Kf.SCALE||this._state==Kf.FOCUS||this._state==Kf.ANIMATION_FOCUS){this._tbRadius=this.calculateTbRadius(this.camera);if(this.adjustNearFar){var t=this.camera.position.distanceTo(this._gizmos.position),a=new bs;a.setFromObject(this._gizmos);var d=new Bs;a.getBoundingSphere(d);var r=Math.max(this._nearPos0,d.radius+d.center.length()),i=t-this._initialNear,n=Math.min(r,i);this.camera.near=t-n;var o=Math.min(this._farPos0,-d.radius+d.center.length()),s=t-this._initialFar,l=Math.min(o,s);this.camera.far=t-l;this.camera.updateProjectionMatrix()}else{var c=!1;if(this.camera.near!=this._initialNear){this.camera.near=this._initialNear;c=!0}if(this.camera.far!=this._initialFar){this.camera.far=this._initialFar;c=!0}if(c){this.camera.updateProjectionMatrix()}}}}},{key:"setGizmosVisible",value:function setGizmosVisible(e){this._gizmos.visible=e;this.dispatchEvent(ah)}},{key:"setTbRadius",value:function setTbRadius(e){this.radiusFactor=e;this._tbRadius=this.calculateTbRadius(this.camera);var t=new Xu(0,0,this._tbRadius,this._tbRadius),a=t.getPoints(this._curvePts),r=new rd().setFromPoints(a);for(var i in this._gizmos.children){this._gizmos.children[i].geometry=r}this.dispatchEvent(ah)}},{key:"setTransformationMatrices",value:function setTransformationMatrices(){var e=0<arguments.length&&arguments[0]!==void 0?arguments[0]:null,t=1<arguments.length&&arguments[1]!==void 0?arguments[1]:null;if(null!=e){if(null!=th.camera){th.camera.copy(e)}else{th.camera=e.clone()}}else{th.camera=null}if(null!=t){if(null!=th.gizmos){th.gizmos.copy(t)}else{th.gizmos=t.clone()}}else{th.gizmos=null}}},{key:"getRaycaster",value:function getRaycaster(){return nh}}]);return t}(es),lh=function(e){_inherits(t,e);var a=_createSuper(t);function t(){var e,r=0<arguments.length&&arguments[0]!==void 0?arguments[0]:document.createElement("div");_classCallCheck2(this,t);e=a.call(this);e.element=r;e.element.style.position="absolute";e.element.style.userSelect="none";e.element.setAttribute("draggable",!1);e.addEventListener("removed",function(){this.traverse(function(e){if(e.element instanceof Element&&null!==e.element.parentNode){e.element.parentNode.removeChild(e.element)}})});return e}_createClass2(t,[{key:"copy",value:function copy(e,a){_get(_getPrototypeOf(t.prototype),"copy",this).call(this,e,a);this.element=e.element.cloneNode(!0);return this}}]);return t}(vl);lh.prototype.isCSS2DObject=!0;var dh=new vs,ch=new Ys,uh=new Ys,ph=new vs,_a=new vs,mh=function e(){var n=0<arguments.length&&arguments[0]!==void 0?arguments[0]:{};_classCallCheck2(this,e);var o=this,s,l,d,c,u={objects:new WeakMap},p=n.element!==void 0?n.element:document.createElement("div");p.style.overflow="hidden";this.domElement=p;this.getSize=function(){return{width:s,height:l}};this.render=function(e,a){if(!0===e.autoUpdate)e.updateMatrixWorld();if(null===a.parent)a.updateMatrixWorld();ch.copy(a.matrixWorldInverse);uh.multiplyMatrices(a.projectionMatrix,ch);t(e,e,a);i(e)};this.setSize=function(e,t){s=e;l=t;d=s/2;c=l/2;p.style.width=e+"px";p.style.height=t+"px"};function t(e,r,i){if(e.isCSS2DObject){e.onBeforeRender(o,r,i);dh.setFromMatrixPosition(e.matrixWorld);dh.applyMatrix4(uh);var n=e.element;if(/apple/i.test(navigator.vendor)){n.style.transform="translate(-50%,-50%) translate("+Math.round(dh.x*d+d)+"px,"+Math.round(-dh.y*c+c)+"px)"}else{n.style.transform="translate(-50%,-50%) translate("+(dh.x*d+d)+"px,"+(-dh.y*c+c)+"px)"}n.style.display=e.visible&&-1<=dh.z&&1>=dh.z?"":"none";var s={distanceToCameraSquared:a(i,e)};u.objects.set(e,s);if(n.parentNode!==p){p.appendChild(n)}e.onAfterRender(o,r,i)}for(var m=0,g=e.children.length;m<g;m++){t(e.children[m],r,i)}}function a(e,t){ph.setFromMatrixPosition(e.matrixWorld);_a.setFromMatrixPosition(t.matrixWorld);return ph.distanceToSquared(_a)}function r(e){var t=[];e.traverse(function(e){if(e.isCSS2DObject)t.push(e)});return t}function i(e){for(var t=r(e).sort(function(e,t){var a=u.objects.get(e).distanceToCameraSquared,r=u.objects.get(t).distanceToCameraSquared;return a-r}),a=t.length,i=0,n=t.length;i<n;i++){t[i].element.style.zIndex=a-i}}},gh=function(e){_inherits(t,e);var a=_createSuper(t);function t(e,r){var i;_classCallCheck2(this,t);i=a.call(this);i.animating=!1;i.controls=null;var n=document.createElement("div");n.setAttribute("id","axisHelper");n.setAttribute("style","position: absolute; right: 0px; bottom: 0px; height: 128px; width: 128px");var o=_assertThisInitialized(i);n.addEventListener("pointerup",function(e){e.stopPropagation();o.handleClick(e)});n.addEventListener("pointerdown",function(e){e.stopPropagation()});n.addEventListener("pointermove",function(e){o.handleMove(e)});r.appendChild(n);var s=new zl("#ff3653"),l=new zl("#8adb00"),d=new zl("#2c8fff"),c=[],u=new Tg,p=new os,m=new vl,g=new Gd(-2,2,2,-2,0,4);g.position.set(0,0,2);var f=new Sd(.8,.05,.05).translate(.4,0,0),h=function(e){return new Nl({color:e,toneMapped:!1})},y=new bd(f,h(s)),v=new bd(f,h(l)),_=new bd(f,h(d));v.rotation.z=Math.PI/2;_.rotation.y=-Math.PI/2;i.add(y);i.add(_);i.add(v);var x=function(e){var t=1<arguments.length&&arguments[1]!==void 0?arguments[1]:null,a=document.createElement("canvas");a.width=64;a.height=64;var r=a.getContext("2d");r.beginPath();r.arc(32,32,16,0,2*Math.PI);r.closePath();r.fillStyle=e.getStyle();r.fill();if(null!==t){r.font="24px Arial";r.textAlign="center";r.fillStyle="#000000";r.fillText(t,32,41)}var i=new zu(a);return new zc({map:i,toneMapped:!1})},b=new Zc(x(s,"X"));b.userData.type="posX";var S=new Zc(x(l,"Y"));S.userData.type="posY";var M=new Zc(x(d,"Z"));M.userData.type="posZ";var T=new Zc(x(s));T.userData.type="negX";var E=new Zc(x(l));E.userData.type="negY";var w=new Zc(x(d));w.userData.type="negZ";b.position.x=1;S.position.y=1;M.position.z=1;T.position.x=-1;T.scale.setScalar(.8);E.position.y=-1;E.scale.setScalar(.8);w.position.z=-1;w.scale.setScalar(.8);i.add(b);i.add(S);i.add(M);i.add(T);i.add(E);i.add(w);c.push(b);c.push(S);c.push(M);c.push(T);c.push(E);c.push(w);var A=new vs,k=128,C=2*Math.PI;i.render=function(t){i.quaternion.copy(e.quaternion).invert();i.updateMatrixWorld();A.set(0,0,1);A.applyQuaternion(e.quaternion);if(0<=A.x){b.material.opacity=1;T.material.opacity=.5}else{b.material.opacity=.5;T.material.opacity=1}if(0<=A.y){S.material.opacity=1;E.material.opacity=.5}else{S.material.opacity=.5;E.material.opacity=1}if(0<=A.z){M.material.opacity=1;w.material.opacity=.5}else{M.material.opacity=.5;w.material.opacity=1}var a=r.offsetWidth-k;t.clearDepth();t.setViewport(a,0,k,k);t.render(_assertThisInitialized(i),g)};var R=new vs,L=new ys,P=new vs(0,1,0),I=new ys,D=new ys,z=0,N=new vs,F=function(t,a){switch(t.userData.type){case"posX":R.set(1,0,0);L.setFromEuler(new rl(0,.5*Math.PI,0));break;case"posY":R.set(0,1,0);L.setFromEuler(new rl(.5*-Math.PI,0,0));break;case"posZ":R.set(0,0,1);L.setFromEuler(new rl);break;case"negX":R.set(-1,0,0);L.setFromEuler(new rl(0,.5*-Math.PI,0));break;case"negY":R.set(0,-1,0);L.setFromEuler(new rl(.5*Math.PI,0,0));break;case"negZ":R.set(0,0,-1);L.setFromEuler(new rl(0,Math.PI,0));break;default:console.error("ViewHelper: Invalid axis.");}z=e.position.distanceTo(a);R.multiplyScalar(z).add(a);m.position.copy(a);m.lookAt(e.position);I.copy(m.quaternion);m.lookAt(R);D.copy(m.quaternion);N.copy(P);N.sub(e.up)};i.handleClick=function(e){if(!0===i.animating){return!1}var t=r.getBoundingClientRect(),a=t.left+(r.offsetWidth-k),n=t.top+(r.offsetHeight-k);p.x=2*((e.clientX-a)/k)-1;p.y=2*-((e.clientY-n)/k)+1;u.setFromCamera(p,g);var o=u.intersectObjects(c);if(0<o.length){var s=o[0],l=s.object;F(l,i.controls.target);i.animating=!0;return!0}return!1};i.handleMove=function(e){var t=r.getBoundingClientRect(),a=t.left+(r.offsetWidth-k),i=t.top+(r.offsetHeight-k);p.x=2*((e.clientX-a)/k)-1;p.y=2*-((e.clientY-i)/k)+1;u.setFromCamera(p,g);var n=u.intersectObjects(c);if(0<n.length){r.style.cursor="pointer"}else{r.style.cursor=null}};i.update=function(t){var a=t*C,r=i.controls.target;I.rotateTowards(D,a);e.position.set(0,0,1).applyQuaternion(I).multiplyScalar(z).add(r);e.quaternion.rotateTowards(L,a);var n=e.up.distanceTo(P),o=Math.min(1,a/n);e.up.addScaledVector(N,o);N.multiplyScalar(1-o);if(0===I.angleTo(D)){i.animating=!1}};return i}return t}(vl);gh.prototype.isViewHelper=!0;var fh=function e(t,a,r,i){var n=this;_classCallCheck2(this,e);this.name=t;this.action=a;this.icon=r;this.iconSelected=i;this.dom=document.createElement("a");this.dom.setAttribute("data-action",this.name);this.dom.setAttribute("href","#");this.dom.innerHTML=this.icon;this.dom.setAttribute("title",this.name);this.state=!1;var o=this;this.dom.addEventListener("click",function(t){if(o.iconSelected!==void 0){if(!1===o.state){o.dom.innerHTML=o.iconSelected;o.state=!0}else{o.dom.innerHTML=o.icon;o.state=!1}}o.action(n.name,t);t.stopPropagation();t.preventDefault()},!1)},hh=25,yh=function(){function e(t,a){_classCallCheck2(this,e);var r=this;this.container=t;var i={grid:!0,axis_helper:!0,controls:!0,camera_position:new vs(1,1,1),camera_zoom:1,camera_up:new vs(0,1,0),toolbar:!0,help:!0};if(null!==a){Object.assign(i,a)}this.scene=new Lc;var n=this.getOthographicPosition();this.camera=new Gd(n[0],n[1],n[2],n[3],-2e3,2e3);this.camera.position.copy(i.camera_position);this.camera.position.multiplyScalar(hh);this.camera.zoom=i.camera_zoom;this.camera.up.copy(i.camera_up);this.camera.updateProjectionMatrix();this.scene.add(this.camera);this.a_light=new Tm(4210752,.3);this.scene.add(this.a_light);this.d_light=new Mm(16777215,.6,{castShadow:!0});this.camera.add(this.d_light);this.renderer=new Nt({antialias:!0});this.renderer.setPixelRatio(window.devicePixelRatio);this.renderer.outputEncoding=yo;this.renderer.setSize(t.clientWidth,t.clientHeight);this.renderer.setClearColor(13421772);t.appendChild(this.renderer.domElement);this.labelRenderer=new mh;this.labelRenderer.setSize(t.clientWidth,t.clientHeight);this.labelRenderer.domElement.style.position="absolute";this.labelRenderer.domElement.style.top="0px";t.appendChild(this.labelRenderer.domElement);window.addEventListener("resize",function(){r.resize()});this.controls=new sh(this.camera,this.labelRenderer.domElement,this.scene);this.controls.enabled=i.controls;this.controls.setGizmosVisible(!1);this.grid=new Mc;var o=new Vg(30,30,8947848);o.material.color.setHex(8947848);o.material.vertexColors=!1;this.grid.add(o);var s=new Vg(30,6,2236962);s.material.color.setHex(2236962);s.material.depthFunc=oi;s.material.vertexColors=!1;this.grid.add(s);this.grid.visible=i.grid;this.viewAxes=new gh(this.camera,t);this.viewAxes.controls=this.controls;this.viewAxes.visible=i.axis_helper;this.clock=new qm;this.animating=!1;if(!1!==i.toolbar&&null!==i.toolbar){this.buildToolbar(i)}this.message_dom=document.createElement("div");this.message_dom.setAttribute("id","message_wrapper");this.message_dom.className="invisible opacity-0";this.message_inner=document.createElement("div");this.message_dom.appendChild(this.message_inner);this.message_timeout=null;this.container.appendChild(this.message_dom);if(!1!==i.help&&null!==i.help){this.helpDom=document.createElement("div");this.helpDom.setAttribute("id","help");this.helpDom.innerText="Scroll to zoom / Drag to rotate / Drag & left-click to pan";this.container.appendChild(this.helpDom)}this.animating=!0;this.renderer.setAnimationLoop(function animate(){var e=r.animating,t=r.clock.getDelta();if(!0===r.viewAxes.animating){r.viewAxes.update(t);e=!0}if(e){r.controls.update();r.render();r.animating=!1}});this.controls.addEventListener("change",function(){r.render()})}_createClass2(e,[{key:"getOthographicPosition",value:function getOthographicPosition(){var e=this.container.clientWidth/this.container.clientHeight,t=.5*(45*ns.DEG2RAD),a=Math.atan(e*Math.tan(t)),r=hh*Math.tan(a),i=hh*Math.tan(t);return[-r,r,i,-i]}},{key:"resize",value:function resize(){var e=this.getOthographicPosition();this.camera.left=e[0];this.camera.right=e[1];this.camera.top=e[2];this.camera.bottom=e[3];this.camera.updateProjectionMatrix();this.renderer.setSize(this.container.clientWidth,this.container.clientHeight);this.labelRenderer.setSize(this.container.clientWidth,this.container.clientHeight);this.animating=!0}},{key:"buildToolbar",value:function buildToolbar(){this.toolbar=document.createElement("nav");this.toolbar.setAttribute("id","toolbar");this.container.appendChild(this.toolbar);this.buttons={};var e=this;this.handleEvents=function(t){switch(t){case"reset-view":e.controls.reset();e.showMessage("Reset view");break;}};var t=new fh("reset-view",this.handleEvents,Jf(Qf).html);this.toolbar.appendChild(t.dom);this.buttons.reset_btn=t}},{key:"showMessage",value:function showMessage(e){this.message_inner.innerText=e;this.message_dom.classList.remove("invisible");this.message_dom.classList.remove("opacity-0");var t=this.message_dom;clearTimeout(this.message_timeout);this.message_timeout=setTimeout(function(){t.classList.add("invisible");t.classList.add("opacity-0")},2e3)}},{key:"addContent",value:function addContent(e){this.scene.add(e);this.animating=!0}},{key:"render",value:function render(){this.scene.add(this.grid);this.renderer.setViewport(0,0,this.container.offsetWidth,this.container.offsetHeight);this.renderer.render(this.scene,this.camera);this.scene.remove(this.grid);this.labelRenderer.render(this.scene,this.camera);this.renderer.autoClear=!1;this.viewAxes.render(this.renderer);this.renderer.autoClear=!0}}]);return e}(),vh=document.createElement("template");vh.innerHTML="\n  <style>\n    :host { \n        display: block;\n    }\n    #viewer { width: 100%; height: 100%; position: relative; }\n    #toolbar { \n        top: 10px;\n        left: 10px;\n        position: absolute;\n        text-align: center;\n        background-color: white;\n        opacity: 0.75;\n    }\n    #toolbar a {\n        display: block;\n        padding: 6px 8px 0px;\n        color: #495057;\n    }\n    #toolbar svg {\n        width: 1.1em;\n        height: 1.1em;\n    }\n    #message_wrapper {\n        position: absolute;\n        top: 0;\n        left: 50%;\n        padding: 1em;\n        transform: translateX(-50%);\n        transition: visibility 0.5s, opacity 0.5s;\n    }\n    #message_wrapper > div {\n        background-color: white;\n        opacity: 0.75;\n        padding: 0.25rem;\n    }\n    .invisible {\n        visibility: hidden;\n    }\n    .opacity-0 {\n        opacity: 0;\n    }\n    .label {\n        color: #FFF;\n        padding: 2px;\n        background: rgba( 0, 0, 0, .6 );\n    }\n    #help {\n        position: absolute;\n        bottom: 0;\n        left: 5px;\n        color: #495057;\n        font-size:0.8rem;\n    }\n  </style>\n  <div id=\"viewer\"></div>\n";var _h=function(e){_inherits(t,e);var a=_createSuper(t);function t(){_classCallCheck2(this,t);return a.call(this,"updated",{bubbles:!0})}return t}(_wrapNativeSuper(Event)),xh=function(e){_inherits(t,e);var a=_createSuper(t);function t(){var e;_classCallCheck2(this,t);e=a.call(this);e.geometry=null;e.model=null;e._viewerDOM=null;return e}_createClass2(t,[{key:"connectedCallback",value:function connectedCallback(){var e=this;this._viewerDOM=this.parentElement;if(this.model){this.parentElement.viewer.addContent(this.model)}else{new gf(this,function(t,a){e.geometry=t;e.model=a;var r=new CustomEvent("loaded",{geometry:e.geometry});e.dispatchEvent(r);e._viewerDOM.viewer.addContent(a)})}}},{key:"disconnectedCallback",value:function disconnectedCallback(){if(this.model){this.model.removeFromParent();if(this._viewerDOM){this._viewerDOM.dispatchEvent(new _h);this._viewerDOM=null}}}},{key:"attributeChangedCallback",value:function attributeChangedCallback(e){if(!this.loaded){return}switch(e){case"face-color":this.model.getObjectByName("main-mesh").material.color.setStyle(this.faceColor);break;case"edge-color":this.model.getObjectByName("edges").material.color.setStyle(this.edgeColor);break;}this.dispatchEvent(new _h)}},{key:"loaded",get:function get(){return this.model instanceof vl}},{key:"src",get:function get(){if(!this.hasAttribute("src")||!!!this.getAttribute("src")){var e=this.querySelector("a");if(e){this.setAttribute("src",e.getAttribute("href"))}}return this.getAttribute("src")}},{key:"scale",get:function get(){if(this.hasAttribute("scale")){var e=this.getAttribute("scale");if(""===e||"true"===e){return!0}else{return e}}else{return!1}}},{key:"center",get:function get(){return this.hasAttribute("center")}},{key:"faceColor",get:function get(){if(this.hasAttribute("face-color")){return this.getAttribute("face-color")}return"#9dc2cf"}},{key:"edgeColor",get:function get(){if(this.hasAttribute("edge-color")){return this.getAttribute("edge-color")}return"#ff0000"}}],[{key:"observedAttributes",get:function get(){return["face-color","edge-color"]}}]);return t}(_wrapNativeSuper(HTMLElement)),bh=function(e){_inherits(t,e);var a=_createSuper(t);function t(){var e;_classCallCheck2(this,t);e=a.call(this);e._annotation=void 0;e._modelDOM=void 0;return e}_createClass2(t,[{key:"connectedCallback",value:function connectedCallback(){var e=this;this._modelDOM=this.parentElement;var t=this,a=function(){t._modelDOM.model.add(t.annotation);t.dispatchEvent(new _h)};this._modelDOM.addEventListener("loaded",function(){e._annotation=void 0;a()});if(this._modelDOM.loaded){a()}}},{key:"disconnectedCallback",value:function disconnectedCallback(){if(this._annotation){this._annotation.removeFromParent();if(this._annotation instanceof vl){this._annotation.geometry.dispose();this._annotation.material.dispose()}this._annotation=void 0;if(this._modelDOM){this._modelDOM.dispatchEvent(new _h)}}}},{key:"positionInGeometry",value:function positionInGeometry(){var e=this._modelDOM.geometry,t=this.position.split(";"),a=[],r=_createForOfIteratorHelper(t),i;try{for(r.s();!(i=r.n()).done;){var n=i.value,o=n.split("="),s=_slicedToArray2(o,2),l=s[0],d=s[1];if("absolute"==l){var c=d.split(",").map(function(e){return parseFloat(e)}),u=_slicedToArray2(c,3),p=u[0],m=u[1],g=u[2];a.push(new vs(p,m,g))}else if("vertex"==l){var f=parseInt(d),h=e.getAttribute("position").getX(f),y=e.getAttribute("position").getY(f),v=e.getAttribute("position").getZ(f);a.push(new vs(h,y,v))}}}catch(e){r.e(e)}finally{r.f()}if(1===a.length){return a[0]}return a}},{key:"attributeChangedCallback",value:function attributeChangedCallback(e){if(this._annotation===void 0){return}switch(e){case"color":if(this._annotation instanceof lh){this._annotation.element.style.color=this.color}else{this._annotation.material.color.setStyle(this.color)}break;case"text":if(this._annotation instanceof lh){this._annotation.element.textContent=this.text}break;}this.dispatchEvent(new _h)}},{key:"annotation",get:function get(){if(this._annotation){return this._annotation}var e=new kp({color:this.color});if("sphere"===this.kind){var t=new xp(.5),a=new bd(t,e);a.position.copy(this.positionInGeometry());this._annotation=a}else if("label"===this.kind){var o=document.createElement("div");o.className="label";o.textContent=this.text;o.style.marginTop="-1em";o.style.color=this.color;var s=new lh(o);s.position.copy(this.positionInGeometry());this._annotation=s}else if("cylinder"===this.kind){var l=this.positionInGeometry();if(2!=l.length){console.error("Invalid length")}var r=new Fu(.2,.2,l[0].distanceTo(l[1]),20),i=new bd(r,e),n=new vs;n.addVectors(l[0],l[1]);n.divideScalar(2);i.position.set(n.x,n.y,n.z);var d=new vs;d.subVectors(l[1],l[0]);d.normalize();var c=new ys;c.setFromUnitVectors(new vs(0,1,0),d);i.applyQuaternion(c);this._annotation=i}if(this._annotation){this._annotation.name="annotation"}return this._annotation}},{key:"kind",get:function get(){return this.getAttribute("kind")}},{key:"position",get:function get(){return this.getAttribute("position")}},{key:"color",get:function get(){return this.getAttribute("color")},set:function set(e){if(e){this.setAttribute("color",e)}else{this.removeAttribute("color")}}},{key:"text",get:function get(){return this.getAttribute("text")},set:function set(e){if(e){this.setAttribute("text",e)}else{this.removeAttribute("text")}}}],[{key:"observedAttributes",get:function get(){return["color","text"]}}]);return t}(_wrapNativeSuper(HTMLElement)),Sh=function(e){_inherits(t,e);var a=_createSuper(t);function t(){var e;_classCallCheck2(this,t);e=a.call(this);var r=e.attachShadow({mode:"open"});r.appendChild(vh.content.cloneNode(!0));e.viewer=null;var i=_assertThisInitialized(e);e.addEventListener("updated",function(){if(i.viewer)i.viewer.animating=!0});return e}_createClass2(t,[{key:"connectedCallback",value:function connectedCallback(){this.updateSize();var e={grid:this.grid,axis_helper:this.axisHelper,controls:this.controls,camera_position:new vs(1,1,1),camera_zoom:this.cameraZoom,camera_up:new vs(0,1,0),toolbar:this.toolbar,help:this.help};this.viewer=new yh(this.shadowRoot.getElementById("viewer"),e)}},{key:"updateSize",value:function updateSize(){if(0<this.shadowRoot.styleSheets.length){var e=this.shadowRoot.styleSheets[0].cssRules[0];e.style.height=this.getAttribute("height");e.style.width=this.getAttribute("width");if(this.viewer)this.viewer.resize()}}},{key:"attributeChangedCallback",value:function attributeChangedCallback(e,t,a){switch(e){case"width":case"height":this.updateSize();break;case"axis-helper":if(this.viewer){this.viewer.viewAxes.visible=!(null===a);this.viewer.animating=!0}break;}}},{key:"src",get:function get(){return this.getAttribute("src")}},{key:"cameraZoom",get:function get(){if(this.hasAttribute("camera-zoom")){return parseFloat(this.getAttribute("camera-zoom"))}else{return 1}}},{key:"grid",get:function get(){return this.hasAttribute("grid")}},{key:"axisHelper",get:function get(){return this.hasAttribute("axis-helper")}},{key:"controls",get:function get(){return this.hasAttribute("controls")}},{key:"toolbar",get:function get(){return this.hasAttribute("toolbar")}},{key:"help",get:function get(){return this.hasAttribute("help")}}],[{key:"observedAttributes",get:function get(){return["width","height","axis-helper"]}}]);return t}(_wrapNativeSuper(HTMLElement));customElements.define("threed-viewer",Sh);customElements.define("threed-annotation",bh);customElements.define("threed-model",xh);e.Loader=gf;e.THREE=pf;e.Viewer=yh;Object.defineProperty(e,"__esModule",{value:!0})});
//# sourceMappingURL=threed-viewer.min.js.map
